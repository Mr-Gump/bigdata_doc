{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\u6b22\u8fce\u8bbf\u95ee y=xsinx \u7684\u5927\u6570\u636e\u6587\u6863","text":""},{"location":"#_1","title":"\u6b63\u5728\u66f4\u65b0","text":"<ul> <li> Flume</li> <li> Hive-\u4f01\u4e1a\u7ea7\u8c03\u4f18</li> </ul> <p>\u524d\u5f80Github\u4ed3\u5e93</p>"},{"location":"#_2","title":"\u6587\u6863\u7ed3\u6784","text":"<pre><code>\u251c\u2500\u2500 CNAME\n\u251c\u2500\u2500 assets\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 images\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 zelda-dark-world.png\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 zelda-light-world.png\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 screenshots\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 annotations.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 back-to-top.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 consent.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 content-tabs-link.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 content-tabs.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 creating-your-site.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 feedback-report.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 hide-navigation-toc.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 hide-navigation.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 hide-toc.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 language-selection.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-expand.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-index-off.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-index-on.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-path-off.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-path-on.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-sections.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-tabs-collapsed.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-tabs-sticky.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation-tabs.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 navigation.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 search-highlighting.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 search-share.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 search-suggestions.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 social-cards.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 tags-index.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 tags-search.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 tags.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 toc-integrate.png\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 version-warning.png\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 versioning.png\n\u251c\u2500\u2500 container\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docker.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 k8s.md\n\u251c\u2500\u2500 css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 custom.css\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 termynal.css\n\u251c\u2500\u2500 db\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ck\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ck_01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ck_02.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ck_03.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ck_04.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ck_05.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ck_06.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ck_07.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ck_08.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hbase\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hb_01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hb_02.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hb_03.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hb_04.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hb_05.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 hb_06.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 redis\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 rd_01.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 rd_02.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 rd_03.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 rd_04.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 rd_05.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 rd_06.md\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 rd_07.md\n\u251c\u2500\u2500 engine\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 flink\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_02.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_03.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_04.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_05.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_06.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_07.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_08.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_09.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_10.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_11.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 flink_12.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 flink_watermark.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hive\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_02.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_03.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_04.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_05.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_06.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_07.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_08.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_09.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_10.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_11.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_12.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hive_13.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 hive_14.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 spark\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_02.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_03.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_04.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_05.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_06.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_07.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_08.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_09.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_10.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_11.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_12.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_13.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_14.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_15.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 spark_16.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 spark_streaming\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ss_01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ss_02.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ss_03.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ss_04.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ss_05.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 tez\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 tez_01.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 tez_02.md\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 tez_03.md\n\u251c\u2500\u2500 hadoop\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hdp_01.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hdp_02.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hdp_03.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hdp_04.md\n\u251c\u2500\u2500 index.md\n\u251c\u2500\u2500 interview\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 zjtd\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 zj_01.md\n\u251c\u2500\u2500 js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 custom.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mathjax.js\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 termynal.js\n\u251c\u2500\u2500 mkdocs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 admonitions.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 buttons.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 code-blocks.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 content-tabs.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 data-tables.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 diagrams.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 footnotes.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 formatting.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 grids.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 icons-emojis.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 images.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lists.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mathjax.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 termynal.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 tooltips.md\n\u251c\u2500\u2500 mq\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 kafka\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 kf_01.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 kf_02.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 kf_03.md\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 kf_04.md\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 kf_05.md\n\u251c\u2500\u2500 project\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dataware_01.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dataware_02.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dataware_03.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dataware_04.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 dataware_05.md\n\u251c\u2500\u2500 scala\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.md\n\u251c\u2500\u2500 schedule\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ds.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.md\n\u251c\u2500\u2500 sync\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 datax.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 flinkcdc\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 02.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 flume.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 maxwell\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 01.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 02.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 03.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 04.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 maxwell.md\n\u251c\u2500\u2500 vcs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 git.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 maven.md\n\u2514\u2500\u2500 zookeeper\n    \u251c\u2500\u2500 zk_01.md\n    \u251c\u2500\u2500 zk_02.md\n    \u2514\u2500\u2500 zk_03.md\n</code></pre>"},{"location":"db/ck/ck_01/","title":"\u7b2c1\u7ae0 ClickHouse\u5165\u95e8","text":"<p>ClickHouse \u662f\u4fc4\u7f57\u65af\u7684 Yandex \u4e8e 2016 \u5e74\u5f00\u6e90\u7684\u5217\u5f0f\u5b58\u50a8\u6570\u636e\u5e93\uff08DBMS\uff09\uff0c\u4f7f\u7528 C++ \u8bed\u8a00\u7f16\u5199\uff0c\u4e3b\u8981\u7528\u4e8e\u5728\u7ebf\u5206\u6790\u5904\u7406\u67e5\u8be2\uff08OLAP\uff09\uff0c\u80fd\u591f\u4f7f\u7528SQL\u67e5\u8be2\u5b9e\u65f6\u751f\u6210\u5206\u6790\u6570\u636e\u62a5\u544a\u3002 </p>"},{"location":"db/ck/ck_01/#11-clickhouse","title":"1.1 ClickHouse\u7684\u7279\u70b9","text":""},{"location":"db/ck/ck_01/#111","title":"1.1.1 \u5217\u5f0f\u5b58\u50a8","text":"id Name Age 1 \u5f20\u4e09 18 2 \u674e\u56db 22 3 \u738b\u4e94 34 \u91c7\u7528\u884c\u5f0f\u5b58\u50a8\u65f6\uff0c\u6570\u636e\u5728\u78c1\u76d8\u4e0a\u7684\u7ec4\u7ec7\u7ed3\u6784\u91c7\u7528\u5217\u5f0f\u5b58\u50a8\u65f6\uff0c\u6570\u636e\u5728\u78c1\u76d8\u4e0a\u7684\u7ec4\u7ec7\u7ed3\u6784 <p> \u597d\u5904\u662f\u60f3\u67e5\u67d0\u4e2a\u4eba\u6240\u6709\u7684\u5c5e\u6027\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e00\u6b21\u78c1\u76d8\u67e5\u627e\u52a0\u987a\u5e8f\u8bfb\u53d6\u5c31\u53ef\u4ee5\u3002\u4f46\u662f\u5f53\u60f3\u67e5\u6240\u6709\u4eba\u7684\u5e74\u9f84\u65f6\uff0c\u9700\u8981\u4e0d\u505c\u7684\u67e5\u627e\uff0c\u6216\u8005\u5168\u8868\u626b\u63cf\u624d\u884c\uff0c\u904d\u5386\u7684\u5f88\u591a\u6570\u636e\u90fd\u662f\u4e0d\u9700\u8981\u7684\u3002</p> <p> \u8fd9\u65f6\u60f3\u67e5\u6240\u6709\u4eba\u7684\u5e74\u9f84\u53ea\u9700\u628a\u5e74\u9f84\u90a3\u4e00\u5217\u62ff\u51fa\u6765\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u5217\u5f0f\u50a8\u5b58\u7684\u597d\u5904\uff1a</p> <ol> <li> <p>\u5bf9\u4e8e\u5217\u7684\u805a\u5408\uff0c\u8ba1\u6570\uff0c\u6c42\u548c\u7b49\u7edf\u8ba1\u64cd\u4f5c\u539f\u56e0\u4f18\u4e8e\u884c\u5f0f\u5b58\u50a8\u3002</p> </li> <li> <p>\u7531\u4e8e\u67d0\u4e00\u5217\u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u76f8\u540c\u7684\uff0c\u9488\u5bf9\u4e8e\u6570\u636e\u5b58\u50a8\u66f4\u5bb9\u6613\u8fdb\u884c\u6570\u636e\u538b\u7f29\uff0c\u6bcf\u4e00\u5217\u9009\u62e9\u66f4\u4f18\u7684\u6570\u636e\u538b\u7f29\u7b97\u6cd5\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u6570\u636e\u7684\u538b\u7f29\u6bd4\u91cd\u3002</p> </li> <li> <p>\u7531\u4e8e\u6570\u636e\u538b\u7f29\u6bd4\u66f4\u597d\uff0c\u4e00\u65b9\u9762\u8282\u7701\u4e86\u78c1\u76d8\u7a7a\u95f4\uff0c\u53e6\u4e00\u65b9\u9762\u5bf9\u4e8ecache\u4e5f\u6709\u4e86\u66f4\u5927\u7684\u53d1\u6325\u7a7a\u95f4\u3002</p> </li> </ol>"},{"location":"db/ck/ck_01/#112-dbms","title":"1.1.2 DBMS\u7684\u529f\u80fd","text":"<p>\u51e0\u4e4e\u8986\u76d6\u4e86\u6807\u51c6SQL\u7684\u5927\u90e8\u5206\u8bed\u6cd5\uff0c\u5305\u62ec DDL\u548c DML\uff0c\u4ee5\u53ca\u914d\u5957\u7684\u5404\u79cd\u51fd\u6570\uff0c\u7528\u6237\u7ba1\u7406\u53ca\u6743\u9650\u7ba1\u7406\uff0c\u6570\u636e\u7684\u5907\u4efd\u4e0e\u6062\u590d\u3002</p>"},{"location":"db/ck/ck_01/#113","title":"1.1.3 \u591a\u6837\u5316\u5f15\u64ce","text":"<p>ClickHouse \u548c MySQL \u7c7b\u4f3c\uff0c\u628a\u8868\u7ea7\u7684\u5b58\u50a8\u5f15\u64ce\u63d2\u4ef6\u5316\uff0c\u6839\u636e\u8868\u7684\u4e0d\u540c\u9700\u6c42\u53ef\u4ee5\u8bbe\u5b9a\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u3002\u76ee\u524d\u5305\u62ec\u5408\u5e76\u6811\u3001\u65e5\u5fd7\u3001\u63a5\u53e3\u548c\u5176\u4ed6\u56db\u5927\u7c7b20\u591a\u79cd\u5f15\u64ce\u3002</p>"},{"location":"db/ck/ck_01/#114","title":"1.1.4 \u9ad8\u541e\u5410\u5199\u5165\u80fd\u529b","text":"<p>ClickHouse \u91c7\u7528\u7c7b LSM Tree \u7684\u7ed3\u6784\uff0c\u6570\u636e\u5199\u5165\u540e\u5b9a\u671f\u5728\u540e\u53f0 Compaction\u3002\u901a\u8fc7\u7c7b LSM tree \u7684\u7ed3\u6784\uff0cClickHouse \u5728\u6570\u636e\u5bfc\u5165\u65f6\u5168\u90e8\u662f\u987a\u5e8f append \u5199\uff0c\u5199\u5165\u540e\u6570\u636e\u6bb5\u4e0d\u53ef\u66f4\u6539\uff0c\u5728\u540e\u53f0 compaction \u65f6\u4e5f\u662f\u591a\u4e2a\u6bb5 merge sort \u540e\u987a\u5e8f\u5199\u56de\u78c1\u76d8\u3002\u987a\u5e8f\u5199\u7684\u7279\u6027\uff0c\u5145\u5206\u5229\u7528\u4e86\u78c1\u76d8\u7684\u541e\u5410\u80fd\u529b\uff0c\u5373\u4fbf\u5728 HDD \u4e0a\u4e5f\u6709\u7740\u4f18\u5f02\u7684\u5199\u5165\u6027\u80fd\u3002</p> <p>\u5b98\u65b9\u516c\u5f00 benchmark \u6d4b\u8bd5\u663e\u793a\u80fd\u591f\u8fbe\u5230 50MB - 200MB/s \u7684\u5199\u5165\u541e\u5410\u80fd\u529b\uff0c\u6309\u7167\u6bcf\u884c 100Byte \u4f30\u7b97\uff0c\u5927\u7ea6\u76f8\u5f53\u4e8e 50W - 200W\u6761/s \u7684\u5199\u5165\u901f\u5ea6\u3002</p>"},{"location":"db/ck/ck_01/#115","title":"1.1.5 \u6570\u636e\u5206\u533a\u4e0e\u7ebf\u7a0b\u7ea7\u5e76\u884c","text":"<p>ClickHouse \u5c06\u6570\u636e\u5212\u5206\u4e3a\u591a\u4e2a partition\uff0c\u6bcf\u4e2a partition \u518d\u8fdb\u4e00\u6b65\u5212\u5206\u4e3a\u591a\u4e2a index granularity\uff0c\u7136\u540e\u901a\u8fc7\u591a\u4e2a CPU \u6838\u5fc3\u5206\u522b\u5904\u7406\u5176\u4e2d\u7684\u4e00\u90e8\u5206\u6765\u5b9e\u73b0\u5e76\u884c\u6570\u636e\u5904\u7406\u3002\u5728\u8fd9\u79cd\u8bbe\u8ba1\u4e0b\uff0c\u5355\u6761 Query \u5c31\u80fd\u5229\u7528\u6574\u673a\u6240\u6709 CPU\u3002\u6781\u81f4\u7684\u5e76\u884c\u5904\u7406\u80fd\u529b\uff0c\u6781\u5927\u7684\u964d\u4f4e\u4e86\u67e5\u8be2\u5ef6\u65f6\u3002</p> <p>\u6240\u4ee5\uff0cClickHouse\u5373\u4f7f\u5bf9\u4e8e\u5927\u91cf\u6570\u636e\u7684\u67e5\u8be2\u4e5f\u80fd\u591f\u5316\u6574\u4e3a\u96f6\u5e73\u884c\u5904\u7406\u3002\u4f46\u662f\u6709\u4e00\u4e2a\u5f0a\u7aef\u5c31\u662f\u5bf9\u4e8e\u5355\u6761\u67e5\u8be2\u4f7f\u7528\u591acpu\uff0c\u5c31\u4e0d\u5229\u4e8e\u540c\u65f6\u5e76\u53d1\u591a\u6761\u67e5\u8be2\u3002\u6240\u4ee5\u5bf9\u4e8e\u9ad8qps\u7684\u67e5\u8be2\u4e1a\u52a1\uff0cClickHouse\u5e76\u4e0d\u662f\u5f3a\u9879\u3002</p>"},{"location":"db/ck/ck_01/#12","title":"1.2 \u6027\u80fd\u5bf9\u6bd4","text":"<p>\u67d0\u7f51\u7ad9\u7cbe\u534e\u5e16\u4e2d\u5bf9\u51e0\u6b3e\u6570\u636e\u5e93\u505a\u4e86\u6027\u80fd\u5bf9\u6bd4\u3002</p>"},{"location":"db/ck/ck_01/#121","title":"1.2.1 \u5355\u8868\u67e5\u8be2","text":""},{"location":"db/ck/ck_01/#122","title":"1.2.2 \u5173\u8054\u67e5\u8be2","text":""},{"location":"db/ck/ck_01/#123","title":"1.2.3 \u7ed3\u8bba","text":"<p>ClickHouse \u50cf\u5f88\u591a OLAP \u6570\u636e\u5e93\u4e00\u6837\uff0c\u5355\u8868\u67e5\u8be2\u901f\u5ea6\u4f18\u4e8e\u5173\u8054\u67e5\u8be2\uff0c\u800c\u4e14 ClickHouse \u7684\u4e24\u8005\u5dee\u8ddd\u66f4\u4e3a\u660e\u663e\u3002</p>"},{"location":"db/ck/ck_02/","title":"\u7b2c2\u7ae0 ClickHouse\u7684\u5b89\u88c5","text":""},{"location":"db/ck/ck_02/#21","title":"2.1 \u51c6\u5907\u5de5\u4f5c","text":""},{"location":"db/ck/ck_02/#211","title":"2.1.1 \u786e\u5b9a\u9632\u706b\u5899\u5173\u95ed\u72b6\u6001","text":"<pre><code>$ sudo systemctl status firewalld\nfirewalld.service - firewalld - dynamic firewall daemon\nLoaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)\nActive: inactive (dead)\nDocs: man:firewalld(1)\n</code></pre>"},{"location":"db/ck/ck_02/#212-centos","title":"2.1.2 CentOS\u53d6\u6d88\u6253\u5f00\u6587\u4ef6\u6570\u9650\u5236","text":"<p>1\uff09\u5728 hadoop102 \u7684 <code>/etc/security/limits.conf</code> \u6587\u4ef6\u7684\u672b\u5c3e\u52a0\u5165\u4ee5\u4e0b\u5185\u5bb9</p> <pre><code>* soft nofile 65536 \n* hard nofile 65536 \n* soft nproc 131072 \n* hard nproc 131072\n</code></pre> <p>2\uff09\u5728 hadoop102 \u7684 <code>/etc/security/limits.d/20-nproc.conf</code> \u6587\u4ef6\u7684\u672b\u5c3e\u52a0\u5165\u4ee5\u4e0b\u5185\u5bb9</p> <pre><code>* soft nofile 65536 \n* hard nofile 65536\n* soft nproc 131072 \n* hard nproc 131072\n</code></pre> <p>3\uff09\u6267\u884c\u540c\u6b65\u64cd\u4f5c</p> <pre><code>sudo /home/atguigu/bin/xsync /etc/security/limits.conf\nsudo /home/atguigu/bin/xsync /etc/security/limits.d/20-nproc.conf\n</code></pre>"},{"location":"db/ck/ck_02/#22","title":"2.2 \u5b89\u88c5","text":""},{"location":"db/ck/ck_02/#221","title":"2.2.1 \u4e0b\u8f7d\u5b89\u88c5\u5305","text":"<pre><code>$ curl https://clickhouse.com/ | sh\n---&gt; 100%\nSuccessfully downloaded the ClickHouse binary, you can run it as:\n    ./clickhouse\n</code></pre>"},{"location":"db/ck/ck_02/#222","title":"2.2.2 \u6267\u884c\u5b89\u88c5\u5305","text":"<pre><code>./clickhouse install\n</code></pre>"},{"location":"db/ck/ck_02/#23","title":"2.3 \u542f\u52a8","text":"<pre><code>clickhouse start\n</code></pre>"},{"location":"db/ck/ck_03/","title":"\u7b2c3\u7ae0 \u6570\u636e\u7c7b\u578b","text":""},{"location":"db/ck/ck_03/#31","title":"3.1 \u6574\u578b","text":""},{"location":"db/ck/ck_03/#311-2n-12n-1-1","title":"3.1.1 \u6709\u7b26\u53f7\u6574\u578b\uff08-2n-1~2n-1-1\uff09","text":"\u7c7b\u578b \u8303\u56f4 Int8 [-128 : 127] Int16 [-32768 : 32767] Int32 [-2147483648 : 2147483647] Int64 [-9223372036854775808 : 9223372036854775807]"},{"location":"db/ck/ck_03/#312-02n-1","title":"3.1.2 \u65e0\u7b26\u53f7\u6574\u578b\uff080~2n-1\uff09","text":"\u7c7b\u578b \u8303\u56f4 UInt8 [0 : 255] UInt16 [0 : 65535] UInt32 [0 : 4294967295] UInt64 [0 : 18446744073709551615]"},{"location":"db/ck/ck_03/#313","title":"3.1.3 \u4f7f\u7528\u573a\u666f","text":"<p>\u4e2a\u6570\u3001\u6570\u91cf\u3001\u5b58\u50a8\u578b id \u7b49</p>"},{"location":"db/ck/ck_03/#32","title":"3.2 \u6d6e\u70b9\u578b","text":""},{"location":"db/ck/ck_03/#321","title":"3.2.1 \u7c7b\u578b","text":"<ul> <li> <p>Float32 - float</p> </li> <li> <p>Float64 - double</p> </li> </ul> <p>\u5efa\u8bae\u5c3d\u53ef\u80fd\u4ee5\u6574\u6570\u5f62\u5f0f\u5b58\u50a8\u6570\u636e\u3002\u4f8b\u5982\uff0c\u5c06\u56fa\u5b9a\u7cbe\u5ea6\u7684\u6570\u5b57\u8f6c\u6362\u4e3a\u6574\u6570\u503c\uff0c\u5982\u65f6\u95f4\u7528\u6beb\u79d2\u4e3a\u5355\u4f4d\u8868\u793a\uff0c\u56e0\u4e3a\u6d6e\u70b9\u578b\u8fdb\u884c\u8ba1\u7b97\u65f6\u53ef\u80fd\u5f15\u8d77\u56db\u820d\u4e94\u5165\u7684\u8bef\u5dee\u3002</p> <pre><code>$ select 1.0-0.9 ;\n\nSELECT 1. - 0.9\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500minus(1., 0.9)\u2500\u2510\n\u2502 0.09999999999999998 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n1 rows in set. Elapsed: 0.006 sec.\n</code></pre>"},{"location":"db/ck/ck_03/#322","title":"3.2.2 \u4f7f\u7528\u573a\u666f","text":"<p>\u4e00\u822c\u6570\u636e\u503c\u6bd4\u8f83\u5c0f\uff0c\u4e0d\u6d89\u53ca\u5927\u91cf\u7684\u7edf\u8ba1\u8ba1\u7b97\uff0c\u7cbe\u5ea6\u8981\u6c42\u4e0d\u9ad8\u7684\u65f6\u5019\u3002</p>"},{"location":"db/ck/ck_03/#33","title":"3.3 \u5e03\u5c14\u578b","text":"<p>\u6ca1\u6709\u5355\u72ec\u7684\u7c7b\u578b\u6765\u5b58\u50a8\u5e03\u5c14\u503c\u3002\u53ef\u4ee5\u4f7f\u7528 UInt8 \u7c7b\u578b\uff0c\u53d6\u503c\u9650\u5236\u4e3a 0 \u6216 1\u3002</p>"},{"location":"db/ck/ck_03/#34-decimal","title":"3.4 Decimal \u578b","text":"<p>\u6709\u7b26\u53f7\u7684\u6d6e\u70b9\u6570\uff0c\u53ef\u5728\u52a0\u3001\u51cf\u548c\u4e58\u6cd5\u8fd0\u7b97\u8fc7\u7a0b\u4e2d\u4fdd\u6301\u7cbe\u5ea6\u3002\u5bf9\u4e8e\u9664\u6cd5\uff0c\u6700\u4f4e\u6709\u6548\u6570\u5b57\u4f1a\u88ab\u4e22\u5f03\uff08\u4e0d\u820d\u5165\uff09\u3002</p>"},{"location":"db/ck/ck_03/#341","title":"3.4.1 \u7c7b\u578b","text":"<ul> <li>Decimal32(s)\uff0c\u76f8\u5f53\u4e8e Decimal(9,s)\uff0c\u6709\u6548\u4f4d\u6570\u4e3a 1 ~ 9</li> <li>Decimal64(s)\uff0c\u76f8\u5f53\u4e8e Decimal(18,s)\uff0c\u6709\u6548\u4f4d\u6570\u4e3a 1 ~ 18</li> <li>Decimal128(s)\uff0c\u76f8\u5f53\u4e8e Decimal(38,s)\uff0c\u6709\u6548\u4f4d\u6570\u4e3a 1 ~ 38</li> </ul> <p>s \u6807\u8bc6\u5c0f\u6570\u4f4d</p>"},{"location":"db/ck/ck_03/#342","title":"3.4.2 \u4f7f\u7528\u573a\u666f","text":"<p>\u4e00\u822c\u91d1\u989d\u5b57\u6bb5\u3001\u6c47\u7387\u3001\u5229\u7387\u7b49\u5b57\u6bb5\u4e3a\u4e86\u4fdd\u8bc1\u5c0f\u6570\u70b9\u7cbe\u5ea6\uff0c\u90fd\u4f7f\u7528 Decimal \u8fdb\u884c\u5b58\u50a8\u3002</p>"},{"location":"db/ck/ck_03/#35","title":"3.5 \u5b57\u7b26\u4e32","text":""},{"location":"db/ck/ck_03/#351","title":"3.5.1 \u7c7b\u578b","text":"<ul> <li>String \u5b57\u7b26\u4e32\u53ef\u4ee5\u4efb\u610f\u957f\u5ea6\u7684\u3002\u5b83\u53ef\u4ee5\u5305\u542b\u4efb\u610f\u7684\u5b57\u8282\u96c6\uff0c\u5305\u542b\u7a7a\u5b57\u8282\u3002</li> <li>FixedString(N) \u56fa\u5b9a\u957f\u5ea6 N \u7684\u5b57\u7b26\u4e32\uff0cN \u5fc5\u987b\u662f\u4e25\u683c\u7684\u6b63\u81ea\u7136\u6570\u3002\u5f53\u670d\u52a1\u7aef\u8bfb\u53d6\u957f\u5ea6\u5c0f\u4e8e N \u7684\u5b57\u7b26\u4e32\u65f6\u5019\uff0c\u901a\u8fc7\u5728\u5b57\u7b26\u4e32\u672b\u5c3e\u6dfb\u52a0\u7a7a\u5b57\u8282\u6765\u8fbe\u5230 N \u5b57\u8282\u957f\u5ea6\u3002 \u5f53\u670d\u52a1\u7aef\u8bfb\u53d6\u957f\u5ea6\u5927\u4e8e N \u7684\u5b57\u7b26\u4e32\u65f6\u5019\uff0c\u5c06\u8fd4\u56de\u9519\u8bef\u6d88\u606f\u3002 \u4e0e String \u76f8\u6bd4\uff0c\u6781\u5c11\u4f1a\u4f7f\u7528 FixedString\uff0c\u56e0\u4e3a\u4f7f\u7528\u8d77\u6765\u4e0d\u662f\u5f88\u65b9\u4fbf\u3002</li> </ul>"},{"location":"db/ck/ck_03/#352","title":"3.5.2 \u4f7f\u7528\u573a\u666f","text":"<p>\u540d\u79f0\u3001\u6587\u5b57\u63cf\u8ff0\u3001\u5b57\u7b26\u578b\u7f16\u7801\u3002 \u56fa\u5b9a\u957f\u5ea6\u7684\u53ef\u4ee5\u4fdd\u5b58\u4e00\u4e9b\u5b9a\u957f\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u4e00\u4e9b\u7f16\u7801\uff0c\u6027\u522b\u7b49\u4f46\u662f\u8003\u8651\u5230\u4e00\u5b9a\u7684\u53d8\u5316\u98ce\u9669\uff0c\u5e26\u6765\u6536\u76ca\u4e0d\u591f\u660e\u663e\uff0c\u6240\u4ee5\u5b9a\u957f\u5b57\u7b26\u4e32\u4f7f\u7528\u610f\u4e49\u6709\u9650\u3002</p>"},{"location":"db/ck/ck_03/#36","title":"3.6 \u679a\u4e3e\u7c7b\u578b","text":""},{"location":"db/ck/ck_03/#361","title":"3.6.1 \u7c7b\u578b","text":"<ul> <li>Enum8 :\u7528 'String'= Int8 \u5bf9\u63cf\u8ff0</li> <li>Enum16 :\u7528 'String'= Int16 \u5bf9\u63cf\u8ff0</li> </ul>"},{"location":"db/ck/ck_03/#362","title":"3.6.2 \u7528\u6cd5\u6f14\u793a","text":"<p>1\uff09\u521b\u5efa\u4e00\u4e2a\u5e26\u6709\u4e00\u4e2a\u679a\u4e3e Enum8('hello' = 1, 'world' = 2) \u7c7b\u578b\u7684\u5217 <pre><code>CREATE TABLE t_enum\n(\nx Enum8('hello' = 1, 'world' = 2)\n)\nENGINE = TinyLog;\n</code></pre></p> <p>2\uff09\u8fd9\u4e2a\u00a0x\u00a0\u5217\u53ea\u80fd\u5b58\u50a8\u7c7b\u578b\u5b9a\u4e49\u4e2d\u5217\u51fa\u7684\u503c\uff1a<code>hello</code> \u6216 <code>world</code></p> <pre><code>$ INSERT INTO t_enum VALUES ('hello'), ('world'), ('hello');\nOK\n$ select * from t_enum ; SELECT *\nFROM t_enum\n\n\u250c\u2500x\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 hello \u2502\n\u2502 world \u2502\n\u2502 hello \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>3\uff09\u5982\u679c\u5c1d\u8bd5\u4fdd\u5b58\u4efb\u4f55\u5176\u4ed6\u503c\uff0cClickHouse \u629b\u51fa\u5f02\u5e38</p> <pre><code>$ insert into t_enum values('a')\n\nINSERT INTO t_enum VALUES\n\nException on client:\nCode: 36. DB::Exception: Unknown element 'a' for type Enum8('hello' = 1, 'world' = 2)\n\nConnecting to localhost:9000 as user default.\nConnected to ClickHouse server version 20.4.5 revision 54434.\n</code></pre> <p>4\uff09\u5982\u679c\u9700\u8981\u770b\u5230\u5bf9\u5e94\u884c\u7684\u6570\u503c\uff0c\u5219\u5fc5\u987b\u5c06\u00a0Enum\u00a0\u503c\u8f6c\u6362\u4e3a\u6574\u6570\u7c7b\u578b</p> <pre><code>$ SELECT CAST(x, 'Int8') FROM t_enum;\n\nSELECT CAST(x, 'Int8')\nFROM t_enum\n\n\u250c\u2500CAST(x, 'Int8')\u2500\u2510\n\u2502               1 \u2502\n\u2502               2 \u2502\n\u2502               1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n3 rows in set. Elapsed: 0.003 sec.\n</code></pre>"},{"location":"db/ck/ck_03/#363","title":"3.6.3 \u4f7f\u7528\u573a\u666f","text":"<p>\u5bf9\u4e00\u4e9b\u72b6\u6001\u3001\u7c7b\u578b\u7684\u5b57\u6bb5\u7b97\u662f\u4e00\u79cd\u7a7a\u95f4\u4f18\u5316\uff0c\u4e5f\u7b97\u662f\u4e00\u79cd\u6570\u636e\u7ea6\u675f\u3002\u4f46\u662f\u5b9e\u9645\u4f7f\u7528\u4e2d\u5f80\u5f80\u56e0\u4e3a\u4e00\u4e9b\u6570\u636e\u5185\u5bb9\u7684\u53d8\u5316\u589e\u52a0\u4e00\u5b9a\u7684\u7ef4\u62a4\u6210\u672c\uff0c\u751a\u81f3\u662f\u6570\u636e\u4e22\u5931\u95ee\u9898\u3002\u6240\u4ee5\u8c28\u614e\u4f7f\u7528\u3002</p>"},{"location":"db/ck/ck_03/#37","title":"3.7 \u65f6\u95f4\u7c7b\u578b","text":""},{"location":"db/ck/ck_03/#371","title":"3.7.1 \u7c7b\u578b","text":"\u7c7b\u578b \u8bf4\u660e Date \u63a5\u53d7 \u5e74-\u6708-\u65e5 \u7684\u5b57\u7b26\u4e32\u6bd4\u5982 \u20182019-12-16\u2019 Datetime \u63a5\u53d7 \u5e74-\u6708-\u65e5 \u65f6:\u5206:\u79d2 \u7684\u5b57\u7b26\u4e32\u6bd4\u5982 \u20182019-12-16 20:50:10\u2019 Datetime64 \u63a5\u53d7 \u5e74-\u6708-\u65e5 \u65f6:\u5206:\u79d2.\u4e9a\u79d2 \u7684\u5b57\u7b26\u4e32\u6bd4\u5982\u20182019-12-16 20:50:10.66\u2019"},{"location":"db/ck/ck_03/#38","title":"3.8 \u6570\u7ec4","text":""},{"location":"db/ck/ck_03/#381","title":"3.8.1 \u7c7b\u578b","text":"<ul> <li>Array(T)\uff1a\u7531 T \u7c7b\u578b\u5143\u7d20\u7ec4\u6210\u7684\u6570\u7ec4\u3002</li> </ul> <p>T \u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\uff0c\u5305\u542b\u6570\u7ec4\u7c7b\u578b\u3002 \u4f46\u4e0d\u63a8\u8350\u4f7f\u7528\u591a\u7ef4\u6570\u7ec4\uff0cClickHouse \u5bf9\u591a\u7ef4\u6570\u7ec4\u7684\u652f\u6301\u6709\u9650\u3002\u4f8b\u5982\uff0c\u4e0d\u80fd\u5728 MergeTree \u8868\u4e2d\u5b58\u50a8\u591a\u7ef4\u6570\u7ec4\u3002</p>"},{"location":"db/ck/ck_03/#382","title":"3.8.2 \u7528\u6cd5\u6f14\u793a","text":"\u65b9\u5f0f\u4e00\uff1a\u4f7f\u7528array\u51fd\u6570\u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528\u65b9\u62ec\u53f7 <p> <pre><code>$ SELECT array(1, 2) AS x, toTypeName(x) ;\nSELECT \n    [1, 2] AS x, \n    toTypeName(x)\n\n\u250c\u2500x\u2500\u2500\u2500\u2500\u2500\u252c\u2500toTypeName([1, 2])\u2500\u2510\n\u2502 [1,2] \u2502 Array(UInt8)       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n1 rows in set. Elapsed: 0.009 sec.\n</code></pre> </p> <p> <pre><code>$ SELECT [1, 2] AS x, toTypeName(x);\n\nSELECT \n    [1, 2] AS x, \n    toTypeName(x)\n\n\u250c\u2500x\u2500\u2500\u2500\u2500\u2500\u252c\u2500toTypeName([1, 2])\u2500\u2510\n\u2502 [1,2] \u2502 Array(UInt8)       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n 1 rows in set. Elapsed: 0.009 sec.\n</code></pre> </p>"},{"location":"db/ck/ck_04/","title":"\u7b2c4\u7ae0 \u8868\u5f15\u64ce","text":"<p>\u8868\u5f15\u64ce\u662f ClickHouse \u7684\u4e00\u5927\u7279\u8272\u3002\u53ef\u4ee5\u8bf4\uff0c \u8868\u5f15\u64ce\u51b3\u5b9a\u4e86\u5982\u4f55\u5b58\u50a8\u6807\u7684\u6570\u636e\u3002\u5305\u62ec\uff1a</p> <ul> <li> <p>\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\u548c\u4f4d\u7f6e\uff0c\u5199\u5230\u54ea\u91cc\u4ee5\u53ca\u4ece\u54ea\u91cc\u8bfb\u53d6\u6570\u636e</p> </li> <li> <p>\u652f\u6301\u54ea\u4e9b\u67e5\u8be2\u4ee5\u53ca\u5982\u4f55\u652f\u6301\u3002</p> </li> <li> <p>\u5e76\u53d1\u6570\u636e\u8bbf\u95ee\u3002</p> </li> <li> <p>\u7d22\u5f15\u7684\u4f7f\u7528\uff08\u5982\u679c\u5b58\u5728\uff09\u3002</p> </li> <li> <p>\u662f\u5426\u53ef\u4ee5\u6267\u884c\u591a\u7ebf\u7a0b\u8bf7\u6c42\u3002</p> </li> <li> <p>\u6570\u636e\u590d\u5236\u53c2\u6570\u3002</p> </li> <li> <p>\u8868\u5f15\u64ce\u7684\u4f7f\u7528\u65b9\u5f0f\u5c31\u662f\u5fc5\u987b\u663e\u5f0f\u5728\u521b\u5efa\u8868\u65f6\u5b9a\u4e49\u8be5\u8868\u4f7f\u7528\u7684\u5f15\u64ce\uff0c\u4ee5\u53ca\u5f15\u64ce\u4f7f\u7528\u7684\u76f8\u5173\u53c2\u6570\u3002</p> </li> </ul> <p>\u7279\u522b\u6ce8\u610f</p> <p>\u5f15\u64ce\u7684\u540d\u79f0\u5927\u5c0f\u5199\u654f\u611f</p>"},{"location":"db/ck/ck_04/#41-tinylog","title":"4.1 TinyLog","text":"<p>\u4ee5\u5217\u6587\u4ef6\u7684\u5f62\u5f0f\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\uff0c\u4e0d\u652f\u6301\u7d22\u5f15\uff0c\u6ca1\u6709\u5e76\u53d1\u63a7\u5236\u3002\u4e00\u822c\u4fdd\u5b58\u5c11\u91cf\u6570\u636e\u7684\u5c0f\u8868\uff0c\u751f\u4ea7\u73af\u5883\u4e0a\u4f5c\u7528\u6709\u9650\u3002\u53ef\u4ee5\u7528\u4e8e\u5e73\u65f6\u7ec3\u4e60\u6d4b\u8bd5\u7528\u3002 <pre><code>create table t_tinylog ( id String, name String) engine=TinyLog;\n</code></pre></p>"},{"location":"db/ck/ck_04/#42-memory","title":"4.2 Memory","text":"<p>\u5185\u5b58\u5f15\u64ce\uff0c\u6570\u636e\u4ee5\u672a\u538b\u7f29\u7684\u539f\u59cb\u5f62\u5f0f\u76f4\u63a5\u4fdd\u5b58\u5728\u5185\u5b58\u5f53\u4e2d\uff0c\u670d\u52a1\u5668\u91cd\u542f\u6570\u636e\u5c31\u4f1a\u6d88\u5931\u3002\u8bfb\u5199\u64cd\u4f5c\u4e0d\u4f1a\u76f8\u4e92\u963b\u585e\uff0c\u4e0d\u652f\u6301\u7d22\u5f15\u3002\u7b80\u5355\u67e5\u8be2\u4e0b\u6709\u975e\u5e38\u975e\u5e38\u9ad8\u7684\u6027\u80fd\u8868\u73b0\uff08\u8d85\u8fc710G/s\uff09\u3002 \u4e00\u822c\u7528\u5230\u5b83\u7684\u5730\u65b9\u4e0d\u591a\uff0c\u9664\u4e86\u7528\u6765\u6d4b\u8bd5\uff0c\u5c31\u662f\u5728\u9700\u8981\u975e\u5e38\u9ad8\u7684\u6027\u80fd\uff0c\u540c\u65f6\u6570\u636e\u91cf\u53c8\u4e0d\u592a\u5927\uff08\u4e0a\u9650\u5927\u6982 1 \u4ebf\u884c\uff09\u7684\u573a\u666f\u3002</p>"},{"location":"db/ck/ck_04/#43-mergetree","title":"4.3 MergeTree","text":"<p>ClickHouse \u4e2d\u6700\u5f3a\u5927\u7684\u8868\u5f15\u64ce\u5f53\u5c5e MergeTree\uff08\u5408\u5e76\u6811\uff09\u5f15\u64ce\u53ca\u8be5\u7cfb\u5217\uff08*MergeTree\uff09\u4e2d\u7684\u5176\u4ed6\u5f15\u64ce\uff0c\u652f\u6301\u7d22\u5f15\u548c\u5206\u533a\uff0c\u5730\u4f4d\u53ef\u4ee5\u76f8\u5f53\u4e8e innodb \u4e4b\u4e8e Mysql\u3002 \u800c\u4e14\u57fa\u4e8e MergeTree\uff0c\u8fd8\u884d\u751f\u51fa\u4e86\u5f88\u591a\u5c0f\u5f1f\uff0c\u4e5f\u662f\u975e\u5e38\u6709\u7279\u8272\u7684\u5f15\u64ce\u3002</p>"},{"location":"db/ck/ck_04/#431","title":"4.3.1 \u7528\u6cd5\u6f14\u793a","text":"<p>1\uff09\u5efa\u8868\u8bed\u53e5 <pre><code>create table t_order_mt(\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2),\ncreate_time  Datetime\n) engine =MergeTree\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id,sku_id);\n</code></pre></p> <p>2\uff09\u63d2\u5165\u6570\u636e <pre><code>insert into  t_order_mt values\n(101,'sku_001',1000.00,'2020-06-01 12:00:00') ,\n(102,'sku_002',2000.00,'2020-06-01 11:00:00'),\n(102,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',12000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',600.00,'2020-06-02 12:00:00');\n</code></pre></p> <p>3\uff09\u67e5\u8be2\u6570\u636e</p> <pre><code>$ select * from t_order_mt ;\n\nSELECT *\nFROM t_order_mt\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n12 rows in set. Elapsed: 0.024 sec.\n</code></pre> <p>MergeTree\u5176\u5b9e\u8fd8\u6709\u5f88\u591a\u53c2\u6570(\u7edd\u5927\u591a\u6570\u7528\u9ed8\u8ba4\u503c\u5373\u53ef)\uff0c\u4f46\u662f\u4e09\u4e2a\u53c2\u6570\u662f\u66f4\u52a0\u91cd\u8981\u7684\uff0c\u4e5f\u6d89\u53ca\u4e86\u5173\u4e8eMergeTree\u7684\u5f88\u591a\u6982\u5ff5\u3002</p>"},{"location":"db/ck/ck_04/#partition-by","title":"partition by \u5206\u533a","text":""},{"location":"db/ck/ck_04/#4321","title":"4.3.2.1 \u4f5c\u7528","text":"<p>\u5b66\u8fc7hive\u7684\u5e94\u8be5\u90fd\u4e0d\u964c\u751f\uff0c\u5206\u533a\u7684\u76ee\u7684\u4e3b\u8981\u662f\u964d\u4f4e\u626b\u63cf\u7684\u8303\u56f4\uff0c\u4f18\u5316\u67e5\u8be2\u901f\u5ea6 \u5982\u679c\u6ca1\u6709\u6307\u5b9apartition by \uff0c\u53ea\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5206\u533a\u3002</p>"},{"location":"db/ck/ck_04/#4322","title":"4.3.2.2 \u5206\u533a\u76ee\u5f55","text":"<p>MergeTree \u662f\u4ee5\u5217\u6587\u4ef6+\u7d22\u5f15\u6587\u4ef6+\u8868\u5b9a\u4e49\u6587\u4ef6\u7ec4\u6210\u7684\uff0c\u4f46\u662f\u5982\u679c\u8bbe\u5b9a\u4e86\u5206\u533a\u90a3\u4e48\u8fd9\u4e9b\u6587\u4ef6\u5c31\u4f1a\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u5206\u533a\u76ee\u5f55\u4e2d\u3002</p>"},{"location":"db/ck/ck_04/#4323","title":"4.3.2.3 \u5e76\u884c","text":"<p>\u5206\u533a\u540e\uff0c\u9762\u5bf9\u6d89\u53ca\u8de8\u5206\u533a\u7684\u67e5\u8be2\u7edf\u8ba1\uff0cClickHouse \u4f1a\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u5e76\u884c\u5904\u7406\u3002</p>"},{"location":"db/ck/ck_04/#4324","title":"4.3.2.4 \u6570\u636e\u5199\u5165\u4e0e\u5206\u533a\u5408\u5e76","text":"<p>\u4efb\u4f55\u4e00\u4e2a\u6279\u6b21\u7684\u6570\u636e\u5199\u5165\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e34\u65f6\u5206\u533a\uff0c\u4e0d\u4f1a\u7eb3\u5165\u4efb\u4f55\u4e00\u4e2a\u5df2\u6709\u7684\u5206\u533a\u3002\u5199\u5165\u540e\u7684\u67d0\u4e2a\u65f6\u523b\uff08\u5927\u6982 10 - 15 \u5206\u949f\u540e\uff09\uff0cClickHouse \u4f1a\u81ea\u52a8\u6267\u884c\u5408\u5e76\u64cd\u4f5c\uff08\u7b49\u4e0d\u53ca\u4e5f\u53ef\u4ee5\u624b\u52a8\u901a\u8fc7 optimiz e\u6267\u884c\uff09\uff0c\u628a\u4e34\u65f6\u5206\u533a\u7684\u6570\u636e\uff0c\u5408\u5e76\u5230\u5df2\u6709\u5206\u533a\u4e2d\u3002 <pre><code>optimize table xxxx final;\n</code></pre> 1\uff09\u518d\u6b21\u6267\u884c\u4e0a\u9762\u7684\u63d2\u5165\u64cd\u4f5c <pre><code>insert into  t_order_mt values\n(101,'sku_001',1000.00,'2020-06-01 12:00:00') ,\n(102,'sku_002',2000.00,'2020-06-01 11:00:00'),\n(102,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',12000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',600.00,'2020-06-02 12:00:00');\n</code></pre> 2\uff09\u67e5\u770b\u6570\u636e\u5e76\u6ca1\u6709\u7eb3\u5165\u4efb\u4f55\u5206\u533a</p> <pre><code>$ select * from t_order_mt ;\n\nSELECT *\nFROM t_order_mt\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n12 rows in set. Elapsed: 0.005 sec.\n</code></pre> <p>3\uff09\u624b\u52a8optimize\u4e4b\u540e <pre><code>optimize table t_order_mt final;\n</code></pre> 4\uff09\u518d\u6b21\u67e5\u8be2</p> <pre><code>$ select * from t_order_mt ;\n\nSELECT *\nFROM t_order_mt\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n12 rows in set. Elapsed: 0.006 sec.\n</code></pre>"},{"location":"db/ck/ck_04/#433-primary-key","title":"4.3.3 primary key\u4e3b\u952e","text":"<p>ClickHouse\u4e2d\u7684\u4e3b\u952e\uff0c\u548c\u5176\u4ed6\u6570\u636e\u5e93\u4e0d\u592a\u4e00\u6837\uff0c\u5b83\u53ea\u63d0\u4f9b\u4e86\u6570\u636e\u7684\u4e00\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u5374\u4e0d\u662f\u552f\u4e00\u7ea6\u675f\u3002\u8fd9\u5c31\u610f\u5473\u7740\u662f\u53ef\u4ee5\u5b58\u5728\u76f8\u540c primary key \u7684\u6570\u636e\u7684 \u3002</p> <p>\u4e3b\u952e\u7684\u8bbe\u5b9a\u4e3b\u8981\u4f9d\u636e\u662f\u67e5\u8be2\u8bed\u53e5\u4e2d\u7684 where \u6761\u4ef6\u3002\u6839\u636e\u6761\u4ef6\u901a\u8fc7\u5bf9\u4e3b\u952e\u8fdb\u884c\u67d0\u79cd\u5f62\u5f0f\u7684\u4e8c\u5206\u67e5\u627e\uff0c\u80fd\u591f\u5b9a\u4f4d\u5230\u5bf9\u5e94\u7684 index granularity1\uff0c\u907f\u514d\u4e86\u5168\u8868\u626b\u63cf\u3002</p> <p></p> <p>\u7a00\u758f\u7d22\u5f15\u7684\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u7528\u5f88\u5c11\u7684\u7d22\u5f15\u6570\u636e\uff0c\u5b9a\u4f4d\u66f4\u591a\u7684\u6570\u636e\uff0c\u4ee3\u4ef7\u5c31\u662f\u53ea\u80fd\u5b9a\u4f4d\u5230\u7d22\u5f15\u7c92\u5ea6\u7684\u7b2c\u4e00\u884c\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8fdb\u884c\u4e00\u70b9\u626b\u63cf\u3002</p>"},{"location":"db/ck/ck_04/#434-order-by","title":"4.3.4 order by","text":"<p>order by \u8bbe\u5b9a\u4e86\u5206\u533a\u5185\u7684\u6570\u636e\u6309\u7167\u54ea\u4e9b\u5b57\u6bb5\u987a\u5e8f\u8fdb\u884c\u6709\u5e8f\u4fdd\u5b58\u3002 order by \u662f MergeTree \u4e2d\u552f\u4e00\u4e00\u4e2a\u5fc5\u586b\u9879\uff0c\u751a\u81f3\u6bd4 primary key \u8fd8\u91cd\u8981\uff0c\u56e0\u4e3a\u5f53\u7528\u6237\u4e0d\u8bbe\u7f6e\u4e3b\u952e\u7684\u60c5\u51b5\uff0c\u5f88\u591a\u5904\u7406\u4f1a\u4f9d\u7167 order by \u7684\u5b57\u6bb5\u8fdb\u884c\u5904\u7406\uff08\u6bd4\u5982\u540e\u9762\u4f1a\u8bb2\u7684\u53bb\u91cd\u548c\u6c47\u603b\uff09\u3002</p> <p>\u8981\u6c42</p> <p>\u4e3b\u952e\u5fc5\u987b\u662f order by \u5b57\u6bb5\u7684\u524d\u7f00\u5b57\u6bb5\u3002 \u6bd4\u5982order by \u5b57\u6bb5\u662f (id,sku_id)  \u90a3\u4e48\u4e3b\u952e\u5fc5\u987b\u662fid \u6216\u8005(id,sku_id)</p>"},{"location":"db/ck/ck_04/#44","title":"4.4 \u4e8c\u7ea7\u7d22\u5f15","text":"<p>\u76ee\u524d\u5728 ClickHouse \u7684\u5b98\u7f51\u4e0a\u4e8c\u7ea7\u7d22\u5f15\u7684\u529f\u80fd\u662f\u88ab\u6807\u6ce8\u4e3a\u5b9e\u9a8c\u6027\u7684\u3002</p>"},{"location":"db/ck/ck_04/#441","title":"4.4.1 \u4f7f\u7528\u6f14\u793a","text":"<p>1\uff09\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u524d\u9700\u8981\u589e\u52a0\u8bbe\u7f6e\u662f\u5426\u5141\u8bb8\u4f7f\u7528\u5b9e\u9a8c\u6027\u7684\u4e8c\u7ea7\u7d22\u5f15 <pre><code>set allow_experimental_data_skipping_indices=1;\n</code></pre> 2\uff09\u521b\u5efa\u6d4b\u8bd5\u8868 <pre><code>create table t_order_mt2(\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2),\ncreate_time  Datetime,\nINDEX a total_amount TYPE minmax GRANULARITY 5\n) engine =MergeTree\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> \u5176\u4e2d GRANULARITY N \u662f\u8bbe\u5b9a\u4e8c\u7ea7\u7d22\u5f15\u5bf9\u4e8e\u4e00\u7ea7\u7d22\u5f15\u7c92\u5ea6\u7684\u7c92\u5ea6\u3002</p> <p>3\uff09\u63d2\u5165\u6570\u636e <pre><code>insert into  t_order_mt2 values\n(101,'sku_001',1000.00,'2020-06-01 12:00:00') ,\n(102,'sku_002',2000.00,'2020-06-01 11:00:00'),\n(102,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',12000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',600.00,'2020-06-02 12:00:00');\n</code></pre> 4\uff09\u5bf9\u6bd4\u6548\u679c \u5728\u4f7f\u7528\u4e0b\u9762\u8bed\u53e5\u8fdb\u884c\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u770b\u51fa\u4e8c\u7ea7\u7d22\u5f15\u80fd\u591f\u4e3a\u975e\u4e3b\u952e\u5b57\u6bb5\u7684\u67e5\u8be2\u53d1\u6325\u4f5c\u7528\u3002</p> <pre><code>$ clickhouse-client  --send_logs_level=trace &lt;&lt;&lt; 'select * from t_order_mt2  where total_amount &gt; toDecimal32(900., 2)';\n\n2022.08.06 20:22:52.975118 [ 1508 ] {faf05681-2b91-4f67-a96d-5aed4479caed} &lt;Debug&gt; default.t_order_mt2 (SelectExecutor): Index `a` has dropped 0 granules.\n2022.08.06 20:22:52.975178 [ 1508 ] {faf05681-2b91-4f67-a96d-5aed4479caed} &lt;Debug&gt; default.t_order_mt2 (SelectExecutor): Index `a` has dropped 1 granules.\n</code></pre>"},{"location":"db/ck/ck_04/#45-ttl","title":"4.5 \u6570\u636eTTL","text":"<p>TTL \u5373 Time To Live\uff0cMergeTree \u63d0\u4f9b\u4e86\u53ef\u4ee5\u7ba1\u7406\u6570\u636e\u6216\u8005\u5217\u7684\u751f\u547d\u5468\u671f\u7684\u529f\u80fd\u3002</p>"},{"location":"db/ck/ck_04/#451-ttl","title":"4.5.1 \u5217\u7ea7TTL","text":"<p>1\uff09\u521b\u5efa\u6d4b\u8bd5\u8868 <pre><code>create table t_order_mt3(\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2)  TTL create_time+interval 10 SECOND,\ncreate_time  Datetime ) engine =MergeTree\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> 2\uff09\u63d2\u5165\u6570\u636e\uff08\u6ce8\u610f\uff1a\u6839\u636e\u5b9e\u9645\u65f6\u95f4\u6539\u53d8\uff09 <pre><code>insert into  t_order_mt3 values\n(106,'sku_001',1000.00,'2020-06-12 22:52:30'),\n(107,'sku_002',2000.00,'2020-06-12 22:52:30'),\n(110,'sku_003',600.00,'2020-06-12 22:52:30');\n</code></pre> 3\uff09\u624b\u52a8\u5408\u5e76\uff0c\u67e5\u770b\u6548\u679c  \u5230\u671f\u540e\uff0c\u6307\u5b9a\u7684\u5b57\u6bb5\u6570\u636e\u5f520</p> <pre><code>$ optimize table t_order_mt3 final;\nOK\n$ select * from t_order_mt3 ;\n\nSELECT *\nFROM t_order_mt3\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 107 \u2502 sku_002 \u2502         0.00 \u2502 2020-06-12 22:52:30 \u2502\n\u2502 110 \u2502 sku_003 \u2502         0.00 \u2502 2020-06-12 22:52:30 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 106 \u2502 sku_001 \u2502         0.00 \u2502 2020-06-12 22:52:30 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.008 sec.\n</code></pre>"},{"location":"db/ck/ck_04/#452-ttl","title":"4.5.2 \u8868\u7ea7TTL","text":"<p>\u6570\u636e\u4f1a\u5728 create_time \u4e4b\u540e 10 \u79d2\u4e22\u5931</p> <p>1\uff09\u521b\u5efa\u6307\u5b9a\u8868 <pre><code>create table t_order_mt4(\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2) ,\ncreate_time  Datetime ) engine =MergeTree\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id)\nTTL create_time + INTERVAL 10 SECOND;\n</code></pre></p> <p>2\uff09\u4fee\u6539\u5df2\u6709\u7684\u8868 <pre><code>alter table t_order_mt3 MODIFY TTL create_time + INTERVAL 10 SECOND;\n</code></pre> 3\uff09\u65f6\u95f4\u5468\u671f \u80fd\u591f\u4f7f\u7528\u7684\u65f6\u95f4\u5468\u671f\uff1a</p> <ul> <li>SECOND</li> <li>MINUTE</li> <li>HOUR</li> <li>DAY</li> <li>WEEK</li> <li>MONTH</li> <li>QUARTER</li> <li>YEAR </li> </ul>"},{"location":"db/ck/ck_04/#46-replacingmergetree","title":"4.6 ReplacingMergeTree","text":"<p>ReplacingMergeTree \u662f MergeTree \u7684\u4e00\u4e2a\u6269\u5c55\uff0c\u5b83\u5b58\u50a8\u7279\u6027\u5b8c\u5168\u7ee7\u627f MergeTree\uff0c\u53ea\u662f\u591a\u4e86\u4e00\u4e2a\u53bb\u91cd\u7684\u529f\u80fd\u3002 \u5c3d\u7ba1 MergeTree \u53ef\u4ee5\u8bbe\u7f6e\u4e3b\u952e\uff0c\u4f46\u662f primary key \u5176\u5b9e\u6ca1\u6709\u552f\u4e00\u7ea6\u675f\u7684\u529f\u80fd\u3002\u5982\u679c\u4f60\u60f3\u5904\u7406\u6389\u91cd\u590d\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u501f\u52a9\u8fd9\u4e2a ReplacingMergeTree\u3002</p>"},{"location":"db/ck/ck_04/#461","title":"4.6.1 \u53bb\u91cd\u65f6\u673a","text":"<p>\u6570\u636e\u7684\u53bb\u91cd\u53ea\u4f1a\u5728\u5408\u5e76\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u3002\u5408\u5e76\u4f1a\u5728\u672a\u77e5\u7684\u65f6\u95f4\u5728\u540e\u53f0\u8fdb\u884c\uff0c\u6240\u4ee5\u4f60\u65e0\u6cd5\u9884\u5148\u4f5c\u51fa\u8ba1\u5212\u3002\u6709\u4e00\u4e9b\u6570\u636e\u53ef\u80fd\u4ecd\u672a\u88ab\u5904\u7406\u3002</p>"},{"location":"db/ck/ck_04/#462","title":"4.6.2 \u53bb\u91cd\u8303\u56f4","text":"<p>\u5982\u679c\u8868\u7ecf\u8fc7\u4e86\u5206\u533a\uff0c\u53bb\u91cd\u53ea\u4f1a\u5728\u5206\u533a\u5185\u90e8\u8fdb\u884c\u53bb\u91cd\uff0c\u4e0d\u80fd\u6267\u884c\u8de8\u5206\u533a\u7684\u53bb\u91cd\u3002 \u6240\u4ee5 ReplacingMergeTree \u80fd\u529b\u6709\u9650\uff0c ReplacingMergeTree \u9002\u7528\u4e8e\u5728\u540e\u53f0\u6e05\u9664\u91cd\u590d\u7684\u6570\u636e\u4ee5\u8282\u7701\u7a7a\u95f4\uff0c\u4f46\u662f\u5b83\u4e0d\u4fdd\u8bc1\u6ca1\u6709\u91cd\u590d\u7684\u6570\u636e\u51fa\u73b0\u3002</p>"},{"location":"db/ck/ck_04/#463","title":"4.6.3 \u7528\u6cd5\u6f14\u793a","text":"<p>1\uff09\u521b\u5efa\u8868 <pre><code>create table t_order_rmt(\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2) ,\ncreate_time  Datetime ) engine =ReplacingMergeTree(create_time)\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> ReplacingMergeTree() \u586b\u5165\u7684\u53c2\u6570\u4e3a\u7248\u672c\u5b57\u6bb5\uff0c\u91cd\u590d\u6570\u636e\u4fdd\u7559\u7248\u672c\u5b57\u6bb5\u503c\u6700\u5927\u7684\u3002 \u5982\u679c\u4e0d\u586b\u7248\u672c\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u6309\u7167\u63d2\u5165\u987a\u5e8f\u4fdd\u7559\u6700\u540e\u4e00\u6761\u3002 </p> <p>2\uff09\u5411\u8868\u4e2d\u63d2\u5165\u6570\u636e <pre><code>insert into  t_order_rmt values\n(101,'sku_001',1000.00,'2020-06-01 12:00:00') ,\n(102,'sku_002',2000.00,'2020-06-01 11:00:00'),\n(102,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',12000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',600.00,'2020-06-02 12:00:00');\n</code></pre></p> <p>3\uff09\u6267\u884c\u7b2c\u4e00\u6b21\u67e5\u8be2</p> <pre><code>$ select * from t_order_rmt;\n\nSELECT *\nFROM t_order_rmt\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>4\uff09\u624b\u52a8\u5408\u5e76 <pre><code>OPTIMIZE TABLE t_order_rmt FINAL;\n</code></pre></p> <p>5\uff09\u518d\u6267\u884c\u4e00\u6b21\u67e5\u8be2</p> <pre><code>$ select * from t_order_rmt;\n\nSELECT *\nFROM t_order_rmt\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n4 rows in set. Elapsed: 0.010 sec.\n</code></pre> <p>6\uff09\u901a\u8fc7\u6d4b\u8bd5\u5f97\u5230\u7ed3\u8bba</p> <ol> <li>\u5b9e\u9645\u4e0a\u662f\u4f7f\u7528order by \u5b57\u6bb5\u4f5c\u4e3a\u552f\u4e00\u952e</li> <li>\u53bb\u91cd\u4e0d\u80fd\u8de8\u5206\u533a</li> <li>\u53ea\u6709\u5408\u5e76\u5206\u533a\u624d\u4f1a\u8fdb\u884c\u53bb\u91cd</li> <li>\u8ba4\u5b9a\u91cd\u590d\u7684\u6570\u636e\u4fdd\u7559\uff0c\u7248\u672c\u5b57\u6bb5\u503c\u6700\u5927\u7684</li> <li>\u5982\u679c\u7248\u672c\u5b57\u6bb5\u76f8\u540c\u5219\u6309\u63d2\u5165\u987a\u5e8f\u4fdd\u7559\u6700\u540e\u4e00\u7b14</li> </ol>"},{"location":"db/ck/ck_04/#47-summingmergetree","title":"4.7 SummingMergeTree","text":"<p>\u5bf9\u4e8e\u4e0d\u67e5\u8be2\u660e\u7ec6\uff0c\u53ea\u5173\u5fc3\u4ee5\u7ef4\u5ea6\u8fdb\u884c\u6c47\u603b\u805a\u5408\u7ed3\u679c\u7684\u573a\u666f\u3002\u5982\u679c\u53ea\u4f7f\u7528\u666e\u901a\u7684 MergeTree \u7684\u8bdd\uff0c\u65e0\u8bba\u662f\u5b58\u50a8\u7a7a\u95f4\u7684\u5f00\u9500\uff0c\u8fd8\u662f\u67e5\u8be2\u65f6\u4e34\u65f6\u805a\u5408\u7684\u5f00\u9500\u90fd\u6bd4\u8f83\u5927\u3002 ClickHouse \u4e3a\u4e86\u8fd9\u79cd\u573a\u666f\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u80fd\u591f\u201c\u9884\u805a\u5408\u201d\u7684\u5f15\u64ce SummingMergeTree</p>"},{"location":"db/ck/ck_04/#471","title":"4.7.1 \u7528\u6cd5\u6f14\u793a","text":"<p>1\uff09\u521b\u5efa\u8868 <pre><code>create table t_order_smt(\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2) ,\ncreate_time  Datetime ) engine =SummingMergeTree(total_amount)\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id,sku_id );\n</code></pre> 2\uff09\u63d2\u5165\u6570\u636e <pre><code>insert into  t_order_smt values\n(101,'sku_001',1000.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 11:00:00'),\n(102,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',12000.00,'2020-06-01 13:00:00'),\n(102,'sku_002',600.00,'2020-06-02 12:00:00');\n</code></pre> 3\uff09\u6267\u884c\u7b2c\u4e00\u6b21\u67e5\u8be2</p> <pre><code>$ select * from t_order_smt;\n\nSELECT *\nFROM t_order_smt\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     12000.00 \u2502 2020-06-01 13:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n6 rows in set. Elapsed: 0.005 sec.\n</code></pre> <p>4\uff09\u624b\u52a8\u5408\u5e76 <pre><code>OPTIMIZE TABLE t_order_smt FINAL;\n</code></pre></p> <p>5\uff09\u518d\u6267\u884c\u4e00\u6b21\u67e5\u8be2</p> <pre><code>$ select * from t_order_smt;\n\nSELECT *\nFROM t_order_smt\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 102 \u2502 sku_002 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502     16000.00 \u2502 2020-06-01 11:00:00 \u2502\n\u2502 102 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n4 rows in set. Elapsed: 0.003 sec.\n</code></pre> <p>6\uff09\u901a\u8fc7\u7ed3\u679c\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u7ed3\u8bba</p> <ul> <li>\u4ee5 SummingMergeTree\uff08\uff09\u4e2d\u6307\u5b9a\u7684\u5217\u4f5c\u4e3a\u6c47\u603b\u6570\u636e\u5217</li> <li>\u53ef\u4ee5\u586b\u5199\u591a\u5217\u5fc5\u987b\u6570\u5b57\u5217\uff0c\u5982\u679c\u4e0d\u586b\uff0c\u4ee5\u6240\u6709\u975e\u7ef4\u5ea6\u5217\u4e14\u4e3a\u6570\u5b57\u5217\u7684\u5b57\u6bb5\u4e3a\u6c47\u603b\u6570\u636e\u5217</li> <li>\u4ee5 order by \u7684\u5217\u4e3a\u51c6\uff0c\u4f5c\u4e3a\u7ef4\u5ea6\u5217</li> <li>\u5176\u4ed6\u7684\u5217\u6309\u63d2\u5165\u987a\u5e8f\u4fdd\u7559\u7b2c\u4e00\u884c</li> <li>\u4e0d\u5728\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u805a\u5408</li> </ul> <p>7\uff09\u5f00\u53d1\u5efa\u8bae \u8bbe\u8ba1\u805a\u5408\u8868\u7684\u8bdd\uff0c\u552f\u4e00\u952e\u503c\u3001\u6d41\u6c34\u53f7\u53ef\u4ee5\u53bb\u6389\uff0c\u6240\u6709\u5b57\u6bb5\u5168\u90e8\u662f\u7ef4\u5ea6\u3001\u5ea6\u91cf\u6216\u8005\u65f6\u95f4\u6233\u3002</p> <p>\u80fd\u4e0d\u80fd\u76f4\u63a5\u6267\u884c\u4ee5\u4e0bSQL\u5f97\u5230\u6c47\u603b\u503c</p> <p><code>sql select total_amount from  XXX where province_name=\u2019\u2019 and      create_date=\u2019xxx\u2019</code></p> \u4e0d\u884c\uff0c\u53ef\u80fd\u4f1a\u5305\u542b\u4e00\u4e9b\u8fd8\u6ca1\u6765\u5f97\u53ca\u805a\u5408\u7684\u4e34\u65f6\u660e\u7ec6 <p>\u5982\u679c\u8981\u662f\u83b7\u53d6\u6c47\u603b\u503c\uff0c\u8fd8\u662f\u9700\u8981\u4f7f\u7528 sum \u8fdb\u884c\u805a\u5408\uff0c\u8fd9\u6837\u6548\u7387\u4f1a\u6709\u4e00\u5b9a\u7684\u63d0\u9ad8\uff0c\u4f46\u672c\u8eab ClickHouse \u662f\u5217\u5f0f\u5b58\u50a8\u7684\uff0c\u6548\u7387\u63d0\u5347\u6709\u9650\uff0c\u4e0d\u4f1a\u7279\u522b\u660e\u663e\u3002</p> <p><code>sql select sum(total_amount) from province_name=\u2019\u2019 and create_date=\u2019xxx\u2019</code></p> <ol> <li> <p>\u76f4\u63a5\u7ffb\u8bd1\u7684\u8bdd\u5c31\u662f\u7d22\u5f15\u7c92\u5ea6\uff0c\u6307\u5728\u7a00\u758f\u7d22\u5f15\u4e2d\u4e24\u4e2a\u76f8\u90bb\u7d22\u5f15\u5bf9\u5e94\u6570\u636e\u7684\u95f4\u9694\u3002ClickHouse\u4e2d\u7684MergeTree\u9ed8\u8ba4\u662f8192\u3002\u5b98\u65b9\u4e0d\u5efa\u8bae\u4fee\u6539\u8fd9\u4e2a\u503c\uff0c\u9664\u975e\u8be5\u5217\u5b58\u5728\u5927\u91cf\u91cd\u590d\u503c\uff0c\u6bd4\u5982\u5728\u4e00\u4e2a\u5206\u533a\u4e2d\u51e0\u4e07\u884c\u624d\u6709\u4e00\u4e2a\u4e0d\u540c\u6570\u636e\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"db/ck/ck_05/","title":"\u7b2c5\u7ae0 SQL\u64cd\u4f5c","text":"<p>\u57fa\u672c\u4e0a\u6765\u8bf4\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff08\u4ee5 MySQL \u4e3a\u4f8b\uff09\u7684 SQL \u8bed\u53e5\uff0cClickHouse \u57fa\u672c\u90fd\u652f\u6301\uff0c\u8fd9\u91cc\u4e0d\u4f1a\u4ece\u5934\u8bb2\u89e3 SQL \u8bed\u6cd5\u53ea\u4ecb\u7ecd ClickHouse \u4e0e\u6807\u51c6 SQL\uff08MySQL\uff09\u4e0d\u4e00\u81f4\u7684\u5730\u65b9\u3002</p>"},{"location":"db/ck/ck_05/#51-insert","title":"5.1 Insert","text":"<p>\u57fa\u672c\u4e0e\u6807\u51c6 SQL\uff08MySQL\uff09\u57fa\u672c\u4e00\u81f4</p> <p>1\uff09\u6807\u51c6Insert </p> <pre><code>insert into  [table_name] values(\u2026),(\u2026) </code></pre> <p>2\uff09\u4ece\u8868\u5230\u8868\u7684Insert</p> <pre><code>insert into  [table_name] select a,b,c from [table_name_2]\n</code></pre>"},{"location":"db/ck/ck_05/#52-update-delete","title":"5.2 Update \u548c Delete","text":"<p>ClickHouse \u63d0\u4f9b\u4e86 Delete \u548c Update \u7684\u80fd\u529b\uff0c\u8fd9\u7c7b\u64cd\u4f5c\u88ab\u79f0\u4e3a Mutation\uff08\u7a81\u53d8\uff09\u67e5\u8be2\uff0c\u5b83\u53ef\u4ee5\u770b\u505a Alter \u7684\u4e00\u79cd\u3002</p> <p>\u867d\u7136\u53ef\u4ee5\u5b9e\u73b0\u4fee\u6539\u548c\u5220\u9664\uff0c\u4f46\u662f\u548c\u4e00\u822c\u7684 OLTP \u6570\u636e\u5e93\u4e0d\u4e00\u6837\uff0cMutation \u8bed\u53e5\u662f\u4e00\u79cd\u5f88\u201c\u91cd\u201d\u7684\u64cd\u4f5c\uff0c\u800c\u4e14\u4e0d\u652f\u6301\u4e8b\u52a1\u3002</p> <p>\u201c\u91cd\u201d\u7684\u539f\u56e0\u4e3b\u8981\u662f\u6bcf\u6b21\u4fee\u6539\u6216\u8005\u5220\u9664\u90fd\u4f1a\u5bfc\u81f4\u653e\u5f03\u76ee\u6807\u6570\u636e\u7684\u539f\u6709\u5206\u533a\uff0c\u91cd\u5efa\u65b0\u5206\u533a\u3002\u6240\u4ee5\u5c3d\u91cf\u505a\u6279\u91cf\u7684\u53d8\u66f4\uff0c\u4e0d\u8981\u8fdb\u884c\u9891\u7e41\u5c0f\u6570\u636e\u7684\u64cd\u4f5c\u3002</p> <p>1\uff09\u5220\u9664\u64cd\u4f5c</p> <pre><code>alter table t_order_smt delete where sku_id ='sku_001';\n</code></pre> <p>2\uff09\u4fee\u6539\u64cd\u4f5c</p> <pre><code>alter table t_order_smt update total_amount=toDecimal32(2000.00,2) where id =102;\n</code></pre> <p>\u7531\u4e8e\u64cd\u4f5c\u6bd4\u8f83\u201c\u91cd\u201d\uff0c\u6240\u4ee5 Mutation \u8bed\u53e5\u5206\u4e24\u6b65\u6267\u884c\uff0c\u540c\u6b65\u6267\u884c\u7684\u90e8\u5206\u5176\u5b9e\u53ea\u662f\u8fdb\u884c\u65b0\u589e\u6570\u636e\u65b0\u589e\u5206\u533a\u548c\u628a\u65e7\u5206\u533a\u6253\u4e0a\u903b\u8f91\u4e0a\u7684\u5931\u6548\u6807\u8bb0\u3002\u76f4\u5230\u89e6\u53d1\u5206\u533a\u5408\u5e76\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u5220\u9664\u65e7\u6570\u636e\u91ca\u653e\u78c1\u76d8\u7a7a\u95f4\uff0c\u4e00\u822c\u4e0d\u4f1a\u5f00\u653e\u8fd9\u6837\u7684\u529f\u80fd\u7ed9\u7528\u6237\uff0c\u7531\u7ba1\u7406\u5458\u5b8c\u6210\u3002</p>"},{"location":"db/ck/ck_05/#53","title":"5.3 \u67e5\u8be2\u64cd\u4f5c","text":"<p>ClickHouse \u57fa\u672c\u4e0a\u4e0e\u6807\u51c6 SQL \u5dee\u522b\u4e0d\u5927</p> <ul> <li> <p>\u652f\u6301\u5b50\u67e5\u8be2</p> </li> <li> <p>\u652f\u6301CTE(Common Table Expression \u516c\u7528\u8868\u8868\u8fbe\u5f0f with \u5b50\u53e5)</p> </li> <li> <p>\u652f\u6301\u5404\u79cd JOIN\uff0c \u4f46\u662f JOIN \u64cd\u4f5c\u65e0\u6cd5\u4f7f\u7528\u7f13\u5b58\uff0c\u6240\u4ee5\u5373\u4f7f\u662f\u4e24\u6b21\u76f8\u540c\u7684 JOIN \u8bed\u53e5\uff0cClickHouse \u4e5f\u4f1a\u89c6\u4e3a\u4e24\u6761\u65b0 SQL</p> </li> <li> <p>\u652f\u6301\u7a97\u53e3\u51fd\u6570</p> </li> <li> <p>\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u51fd\u6570</p> </li> <li> <p>GROUP BY \u64cd\u4f5c\u589e\u52a0\u4e86 with rollup\\with cube\\with totals \u7528\u6765\u8ba1\u7b97\u5c0f\u8ba1\u548c\u603b\u8ba1\u3002</p> </li> </ul> <p>1\uff09\u63d2\u5165\u6570\u636e <pre><code>alter table t_order_mt delete where 1=1;\ninsert into  t_order_mt values\n(101,'sku_001',1000.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 12:00:00'),\n(103,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(104,'sku_002',2000.00,'2020-06-01 12:00:00'),\n(105,'sku_003',600.00,'2020-06-02 12:00:00'),\n(106,'sku_001',1000.00,'2020-06-04 12:00:00'),\n(107,'sku_002',2000.00,'2020-06-04 12:00:00'),\n(108,'sku_004',2500.00,'2020-06-04 12:00:00'),\n(109,'sku_002',2000.00,'2020-06-04 12:00:00'),\n(110,'sku_003',600.00,'2020-06-01 12:00:00');\n</code></pre></p> <p>2\uff09with rollup\uff1a\u4ece\u53f3\u81f3\u5de6\u53bb\u6389\u7ef4\u5ea6\u8fdb\u884c\u5c0f\u8ba1</p> <pre><code>$ select id , sku_id,sum(total_amount) from  t_order_mt group by id,sku_id with rollup;\n\n\nSELECT \n    id, \n    sku_id, \n    sum(total_amount)\nFROM t_order_mt\nGROUP BY \n    id, \n    sku_id\n    WITH ROLLUP\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502 110 \u2502 sku_003 \u2502            600.00 \u2502\n\u2502 109 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 107 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 106 \u2502 sku_001 \u2502           1000.00 \u2502\n\u2502 102 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 104 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 103 \u2502 sku_004 \u2502           2500.00 \u2502\n\u2502 108 \u2502 sku_004 \u2502           2500.00 \u2502\n\u2502 105 \u2502 sku_003 \u2502            600.00 \u2502\n\u2502 101 \u2502 sku_001 \u2502           1000.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502 110 \u2502        \u2502            600.00 \u2502\n\u2502 106 \u2502        \u2502           1000.00 \u2502\n\u2502 102 \u2502        \u2502           2000.00 \u2502\n\u2502 105 \u2502        \u2502            600.00 \u2502\n\u2502 109 \u2502        \u2502           2000.00 \u2502\n\u2502 107 \u2502        \u2502           2000.00 \u2502\n\u2502 104 \u2502        \u2502           2000.00 \u2502\n\u2502 103 \u2502        \u2502           2500.00 \u2502\n\u2502 108 \u2502        \u2502           2500.00 \u2502\n\u2502 101 \u2502        \u2502           1000.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500id\u2500\u252c\u2500sku_id\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502  0 \u2502        \u2502          16200.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n21 rows in set. Elapsed: 0.010 sec.\n</code></pre> <p>3\uff09with cube : \u4ece\u53f3\u81f3\u5de6\u53bb\u6389\u7ef4\u5ea6\u8fdb\u884c\u5c0f\u8ba1\uff0c\u518d\u4ece\u5de6\u81f3\u53f3\u53bb\u6389\u7ef4\u5ea6\u8fdb\u884c\u5c0f\u8ba1</p> <pre><code>$select id , sku_id,sum(total_amount) from  t_order_mt group by id,sku_id with cube;\n\nSELECT \n    id, \n    sku_id, \n    sum(total_amount)\nFROM t_order_mt\nGROUP BY \n    id, \n    sku_id\n    WITH CUBE\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502 110 \u2502 sku_003 \u2502            600.00 \u2502\n\u2502 109 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 107 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 106 \u2502 sku_001 \u2502           1000.00 \u2502\n\u2502 102 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 104 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 103 \u2502 sku_004 \u2502           2500.00 \u2502\n\u2502 108 \u2502 sku_004 \u2502           2500.00 \u2502\n\u2502 105 \u2502 sku_003 \u2502            600.00 \u2502\n\u2502 101 \u2502 sku_001 \u2502           1000.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502 110 \u2502        \u2502            600.00 \u2502\n\u2502 106 \u2502        \u2502           1000.00 \u2502\n\u2502 102 \u2502        \u2502           2000.00 \u2502\n\u2502 105 \u2502        \u2502            600.00 \u2502\n\u2502 109 \u2502        \u2502           2000.00 \u2502\n\u2502 107 \u2502        \u2502           2000.00 \u2502\n\u2502 104 \u2502        \u2502           2000.00 \u2502\n\u2502 103 \u2502        \u2502           2500.00 \u2502\n\u2502 108 \u2502        \u2502           2500.00 \u2502\n\u2502 101 \u2502        \u2502           1000.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502  0 \u2502 sku_003 \u2502           1200.00 \u2502\n\u2502  0 \u2502 sku_004 \u2502           5000.00 \u2502\n\u2502  0 \u2502 sku_001 \u2502           2000.00 \u2502\n\u2502  0 \u2502 sku_002 \u2502           8000.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500id\u2500\u252c\u2500sku_id\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502  0 \u2502        \u2502          16200.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n25 rows in set. Elapsed: 0.009 sec.\n</code></pre> <p>4\uff09with totals: \u53ea\u8ba1\u7b97\u5408\u8ba1</p> <pre><code>$ select id , sku_id,sum(total_amount) from  t_order_mt group by id,sku_id with totals;\n\nSELECT \n    id, \n    sku_id, \n    sum(total_amount)\nFROM t_order_mt\nGROUP BY \n    id, \n    sku_id\n    WITH TOTALS\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502 110 \u2502 sku_003 \u2502            600.00 \u2502\n\u2502 109 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 107 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 106 \u2502 sku_001 \u2502           1000.00 \u2502\n\u2502 102 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 104 \u2502 sku_002 \u2502           2000.00 \u2502\n\u2502 103 \u2502 sku_004 \u2502           2500.00 \u2502\n\u2502 108 \u2502 sku_004 \u2502           2500.00 \u2502\n\u2502 105 \u2502 sku_003 \u2502            600.00 \u2502\n\u2502 101 \u2502 sku_001 \u2502           1000.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nTotals:\n\u250c\u2500id\u2500\u252c\u2500sku_id\u2500\u252c\u2500sum(total_amount)\u2500\u2510\n\u2502  0 \u2502        \u2502          16200.00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n10 rows in set. Elapsed: 0.010 sec.\n</code></pre>"},{"location":"db/ck/ck_05/#54-alter","title":"5.4 alter\u64cd\u4f5c","text":"<p>\u540c MySQL \u7684\u4fee\u6539\u5b57\u6bb5\u57fa\u672c\u4e00\u81f4</p> <p>1\uff09\u65b0\u589e\u5b57\u6bb5 <pre><code>alter table tableName  add column  newcolname  String after col1;\n</code></pre></p> <p>2\uff09\u4fee\u6539\u5b57\u6bb5\u7c7b\u578b <pre><code>alter table tableName  modify column  newcolname  String;\n</code></pre></p> <p>3\uff09\u5220\u9664\u5b57\u6bb5 <pre><code>alter table tableName  drop column  newcolname;\n</code></pre></p>"},{"location":"db/ck/ck_05/#55","title":"5.5 \u5bfc\u51fa\u6570\u636e","text":"<p><pre><code>clickhouse-client --query \"select * from t_order_mt where create_time='2020-06-01 12:00:00'\" --format CSVWithNames&gt; /opt/module/data/rs1.csv\n</code></pre> \u66f4\u591a\u652f\u6301\u683c\u5f0f\u53c2\u7167\uff1a</p>"},{"location":"db/ck/ck_06/","title":"\u7b2c6\u7ae0 \u526f\u672c","text":"<p>\u526f\u672c\u7684\u76ee\u7684\u4e3b\u8981\u662f\u4fdd\u969c\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u5373\u4f7f\u4e00\u53f0ClickHouse\u8282\u70b9\u5b95\u673a\uff0c\u90a3\u4e48\u4e5f\u53ef\u4ee5\u4ece\u5176\u4ed6\u670d\u52a1\u5668\u83b7\u5f97\u76f8\u540c\u7684\u6570\u636e\u3002</p>"},{"location":"db/ck/ck_06/#61","title":"6.1 \u526f\u672c\u5199\u5165\u6d41\u7a0b","text":""},{"location":"db/ck/ck_06/#62","title":"6.2 \u914d\u7f6e\u6b65\u9aa4","text":"<p>1\uff09\u542f\u52a8zookeeper\u96c6\u7fa4</p> <p>2\uff09\u5728 hadoop102 \u7684 /etc/clickhouse-server/config.d \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a metrika.xml \u7684\u914d\u7f6e\u6587\u4ef6,\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;yandex&gt;\n&lt;zookeeper-servers&gt;\n&lt;node index=\"1\"&gt;\n&lt;host&gt;hadoop102&lt;/host&gt;\n&lt;port&gt;2181&lt;/port&gt;\n&lt;/node&gt;\n&lt;node index=\"2\"&gt;\n&lt;host&gt;hadoop103&lt;/host&gt;\n&lt;port&gt;2181&lt;/port&gt;\n&lt;/node&gt;\n&lt;node index=\"3\"&gt;\n&lt;host&gt;hadoop104&lt;/host&gt;\n&lt;port&gt;2181&lt;/port&gt;\n&lt;/node&gt;\n&lt;/zookeeper-servers&gt;\n&lt;/yandex&gt;\n</code></pre> <p>3\uff09\u540c\u6b65\u5230 hadoop103 \u548c hadoop104 \u4e0a</p> <pre><code>sudo /home/atguigu/bin/xsync /etc/clickhouse-server/config.d/metrika.xml </code></pre> <p>4\uff09\u5728 hadoop102 \u7684 /etc/clickhouse-server/config.xml \u4e2d\u589e\u52a0</p> <pre><code>&lt;include_from&gt;/etc/clickhouse-server/config.d/metrika.xml&lt;/include_from&gt;\n</code></pre> <p>5\uff09\u540c\u6b65\u5230 hadoop103 \u548c hadoop104 \u4e0a</p> <pre><code>sudo /home/atguigu/bin/xsync /etc/clickhouse-server/config.xml\n</code></pre> <p>6\uff09\u5206\u522b\u5728 hadoop102 \u548c hadoop103 \u4e0a\u542f\u52a8 ClickHouse \u670d\u52a1</p> <pre><code>sudo systemctl start clickhouse-server\n</code></pre> <p>\u6ce8\u610f\uff1a\u6211\u4eec\u6f14\u793a\u526f\u672c\u64cd\u4f5c\u53ea\u9700\u8981\u5728 hadoop102 \u548c hadoop103 \u4e24\u53f0\u670d\u52a1\u5668\u5373\u53ef\uff0c\u4e0a\u9762\u7684\u64cd\u4f5c\uff0c\u6211\u4eec hadoop104 \u53ef\u4ee5\u4f60\u4e0d\u7528\u540c\u6b65\uff0c\u6211\u4eec\u8fd9\u91cc\u4e3a\u4e86\u4fdd\u8bc1\u96c6\u7fa4\u4e2d\u8d44\u6e90\u7684\u4e00\u81f4\u6027\uff0c\u505a\u4e86\u540c\u6b65\u3002</p> <p>7\uff09\u5728 hadoop102 \u548c hadoop103 \u4e0a\u5206\u522b\u5efa\u8868</p> <p>\u526f\u672c\u53ea\u80fd\u540c\u6b65\u6570\u636e\uff0c\u4e0d\u80fd\u540c\u6b65\u8868\u7ed3\u6784\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u6bcf\u53f0\u673a\u5668\u4e0a\u81ea\u5df1\u624b\u52a8\u5efa\u8868</p> hadoop102hadoop103 <pre><code>create table t_order_rep (\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2),\ncreate_time  Datetime\n) engine =ReplicatedMergeTree('/clickhouse/tables/01/t_order_rep','rep_102')\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id,sku_id);\n</code></pre> <pre><code>create table t_order_rep (\nid UInt32,\nsku_id String,\ntotal_amount Decimal(16,2),\ncreate_time  Datetime\n) engine =ReplicatedMergeTree('/clickhouse/tables/01/t_order_rep','rep_103')\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id,sku_id);\n</code></pre> <p>8\uff09\u53c2\u6570\u89e3\u91ca ReplicatedMergeTree \u4e2d\uff0c</p> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5206\u7247\u7684 zk_path \u4e00\u822c\u6309\u7167\uff1a /clickhouse/table/{shard}/{table_name} \u7684\u683c\u5f0f\u5199\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u5206\u7247\u5c31\u5199 01 \u5373\u53ef\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u526f\u672c\u540d\u79f0\uff0c\u76f8\u540c\u7684\u5206\u7247\u526f\u672c\u540d\u79f0\u4e0d\u80fd\u76f8\u540c\u3002</p> <p>9\uff09\u5728 hadoop102 \u4e0a\u6267\u884c insert \u8bed\u53e5</p> <pre><code>insert into t_order_rep values\n(101,'sku_001',1000.00,'2020-06-01 12:00:00'),\n(102,'sku_002',2000.00,'2020-06-01 12:00:00'),\n(103,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(104,'sku_002',2000.00,'2020-06-01 12:00:00'),\n(105,'sku_003',600.00,'2020-06-02 12:00:00');\n</code></pre> <p>10\uff09\u5728 hadoop103 \u4e0a\u6267\u884c select\uff0c\u53ef\u4ee5\u67e5\u8be2\u51fa\u7ed3\u679c\uff0c\u8bf4\u660e\u526f\u672c\u914d\u7f6e\u6b63\u786e</p> <pre><code>$ SELECT * FROM t_order_rep;\n\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 101 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 102 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 103 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 104 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 105 \u2502 sku_003 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n5 rows in set. Elapsed: 0.026 sec.\n</code></pre>"},{"location":"db/ck/ck_07/","title":"\u7b2c7\u7ae0 \u5206\u7247\u96c6\u7fa4","text":"<p>\u526f\u672c\u867d\u7136\u80fd\u591f\u63d0\u9ad8\u6570\u636e\u7684\u53ef\u7528\u6027\uff0c\u964d\u4f4e\u4e22\u5931\u98ce\u9669\uff0c\u4f46\u662f\u6bcf\u53f0\u670d\u52a1\u5668\u5b9e\u9645\u4e0a\u5fc5\u987b\u5bb9\u7eb3\u5168\u91cf\u6570\u636e\uff0c\u5bf9\u6570\u636e\u7684\u6a2a\u5411\u6269\u5bb9\u6ca1\u6709\u89e3\u51b3\u3002</p> <p>\u8981\u89e3\u51b3\u6570\u636e\u6c34\u5e73\u5207\u5206\u7684\u95ee\u9898\uff0c\u9700\u8981\u5f15\u5165\u5206\u7247\u7684\u6982\u5ff5\u3002\u901a\u8fc7\u5206\u7247\u628a\u4e00\u4efd\u5b8c\u6574\u7684\u6570\u636e\u8fdb\u884c\u5207\u5206\uff0c\u4e0d\u540c\u7684\u5206\u7247\u5206\u5e03\u5230\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\uff0c\u518d\u901a\u8fc7 Distributed \u8868\u5f15\u64ce\u628a\u6570\u636e\u62fc\u63a5\u8d77\u6765\u4e00\u540c\u4f7f\u7528\u3002</p> <p>Distributed \u8868\u5f15\u64ce\u672c\u8eab\u4e0d\u5b58\u50a8\u6570\u636e\uff0c\u6709\u70b9\u7c7b\u4f3c\u4e8e MyCat \u4e4b\u4e8e MySql\uff0c\u6210\u4e3a\u4e00\u79cd\u4e2d\u95f4\u4ef6\uff0c\u901a\u8fc7\u5206\u5e03\u5f0f\u903b\u8f91\u8868\u6765\u5199\u5165\u3001\u5206\u53d1\u3001\u8def\u7531\u6765\u64cd\u4f5c\u591a\u53f0\u8282\u70b9\u4e0d\u540c\u5206\u7247\u7684\u5206\u5e03\u5f0f\u6570\u636e\u3002</p> <p>\u6ce8\u610f\uff1aClickHouse\u7684\u96c6\u7fa4\u662f\u8868\u7ea7\u522b\u7684\uff0c\u5b9e\u9645\u4f01\u4e1a\u4e2d\uff0c\u5927\u90e8\u5206\u505a\u4e86\u9ad8\u53ef\u7528\uff0c\u4f46\u662f\u6ca1\u6709\u7528\u5206\u7247\uff0c\u907f\u514d\u964d\u4f4e\u67e5\u8be2\u6027\u80fd\u4ee5\u53ca\u64cd\u4f5c\u96c6\u7fa4\u7684\u590d\u6742\u6027\u3002</p>"},{"location":"db/ck/ck_07/#71-326","title":"7.1 \u96c6\u7fa4\u5199\u5165\u6d41\u7a0b\uff083\u5206\u72472\u526f\u672c\u51716\u4e2a\u8282\u70b9\uff09","text":""},{"location":"db/ck/ck_07/#72-326","title":"7.2 \u96c6\u7fa4\u8bfb\u53d6\u6d41\u7a0b\uff083\u5206\u72472\u526f\u672c\u51716\u4e2a\u8282\u70b9\uff09","text":""},{"location":"db/ck/ck_07/#73-326","title":"7.3 3\u5206\u72472\u526f\u672c\u51716\u4e2a\u8282\u70b9\u96c6\u7fa4\u914d\u7f6e\uff08\u4f9b\u53c2\u8003\uff09","text":"<ol> <li>\u5728 /etc/clickhouse-server/config.d/metrika.xml\u6587\u4ef6\u4e2d\u914d\u7f6e</li> </ol> <p>\u914d\u7f6e\u7684\u4f4d\u7f6e\u8fd8\u662f\u5728\u4e4b\u524d\u7684/etc/clickhouse-server/config.d/metrika.xml\uff0c\u5185\u5bb9\u5982\u4e0b</p> <pre><code>&lt;yandex&gt;\n&lt;clickhouse_remote_servers&gt;\n&lt;gmall_cluster&gt; &lt;!-- \u96c6\u7fa4\u540d\u79f0--&gt; &lt;shard&gt;  &lt;!--\u96c6\u7fa4\u7684\u7b2c\u4e00\u4e2a\u5206\u7247--&gt;\n&lt;internal_replication&gt;true&lt;/internal_replication&gt;\n&lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e00\u4e2a\u526f\u672c--&gt;\n&lt;replica&gt;    &lt;host&gt;hadoop102&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e8c\u4e2a\u526f\u672c--&gt;\n&lt;replica&gt; &lt;host&gt;hadoop103&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;/shard&gt;\n\n&lt;shard&gt;  &lt;!--\u96c6\u7fa4\u7684\u7b2c\u4e8c\u4e2a\u5206\u7247--&gt;\n&lt;internal_replication&gt;true&lt;/internal_replication&gt;\n&lt;replica&gt;    &lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e00\u4e2a\u526f\u672c--&gt;\n&lt;host&gt;hadoop104&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;replica&gt;    &lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e8c\u4e2a\u526f\u672c--&gt;\n&lt;host&gt;hadoop105&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;/shard&gt;\n\n&lt;shard&gt;  &lt;!--\u96c6\u7fa4\u7684\u7b2c\u4e09\u4e2a\u5206\u7247--&gt;\n&lt;internal_replication&gt;true&lt;/internal_replication&gt;\n&lt;replica&gt;     &lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e00\u4e2a\u526f\u672c--&gt;\n&lt;host&gt;hadoop106&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;replica&gt;    &lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e8c\u4e2a\u526f\u672c--&gt;\n&lt;host&gt;hadoop107&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;/shard&gt;\n&lt;/gmall_cluster&gt;\n&lt;/clickhouse_remote_servers&gt;\n&lt;/yandex&gt;\n</code></pre>"},{"location":"db/ck/ck_07/#74","title":"7.4 \u914d\u7f6e\u4e09\u8282\u70b9\u7248\u672c\u96c6\u7fa4\u53ca\u526f\u672c","text":""},{"location":"db/ck/ck_07/#741-2","title":"7.4.1 \u96c6\u7fa4\u53ca\u526f\u672c\u89c4\u5212\uff082\u4e2a\u5206\u7247\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u5206\u7247\u6709\u526f\u672c\uff09","text":"hadoop102hadoop103hadoop104 <pre><code>&lt;macros&gt;\n&lt;shard&gt;01&lt;/shard&gt; &lt;replica&gt;rep_1_1&lt;/replica&gt;\n&lt;/macros&gt;\n</code></pre> <pre><code>&lt;macros&gt;\n&lt;shard&gt;01&lt;/shard&gt; &lt;replica&gt;rep_1_2&lt;/replica&gt;\n&lt;/macros&gt;\n</code></pre> <pre><code>&lt;macros&gt;\n&lt;shard&gt;02&lt;/shard&gt; &lt;replica&gt;rep_2_1&lt;/replica&gt;\n&lt;/macros&gt;\n</code></pre>"},{"location":"db/ck/ck_07/#742","title":"7.4.2 \u914d\u7f6e\u6b65\u9aa4","text":"<p>1\uff09\u5728 hadoop102 \u7684 /etc/clickhouse-server/config.d \u76ee\u5f55\u4e0b\u521b\u5efa metrika-shard.xml \u6587\u4ef6 metrika-shard.xml<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;yandex&gt;\n&lt;clickhouse_remote_servers&gt;\n&lt;gmall_cluster&gt; &lt;!-- \u96c6\u7fa4\u540d\u79f0--&gt; &lt;shard&gt;         &lt;!--\u96c6\u7fa4\u7684\u7b2c\u4e00\u4e2a\u5206\u7247--&gt;\n&lt;internal_replication&gt;true&lt;/internal_replication&gt;\n&lt;replica&gt;    &lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e00\u4e2a\u526f\u672c--&gt;\n&lt;host&gt;hadoop102&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;replica&gt;    &lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e8c\u4e2a\u526f\u672c--&gt;\n&lt;host&gt;hadoop103&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;/shard&gt;\n\n&lt;shard&gt;  &lt;!--\u96c6\u7fa4\u7684\u7b2c\u4e8c\u4e2a\u5206\u7247--&gt;\n&lt;internal_replication&gt;true&lt;/internal_replication&gt;\n&lt;replica&gt;    &lt;!--\u8be5\u5206\u7247\u7684\u7b2c\u4e00\u4e2a\u526f\u672c--&gt;\n&lt;host&gt;hadoop104&lt;/host&gt;\n&lt;port&gt;9000&lt;/port&gt;\n&lt;/replica&gt;\n&lt;/shard&gt;\n&lt;/gmall_cluster&gt;\n&lt;/clickhouse_remote_servers&gt;\n\n&lt;zookeeper-servers&gt;\n&lt;node index=\"1\"&gt;\n&lt;host&gt;hadoop102&lt;/host&gt;\n&lt;port&gt;2181&lt;/port&gt;\n&lt;/node&gt;\n&lt;node index=\"2\"&gt;\n&lt;host&gt;hadoop103&lt;/host&gt;\n&lt;port&gt;2181&lt;/port&gt;\n&lt;/node&gt;\n&lt;node index=\"3\"&gt;\n&lt;host&gt;hadoop104&lt;/host&gt;\n&lt;port&gt;2181&lt;/port&gt;\n&lt;/node&gt;\n&lt;/zookeeper-servers&gt;\n\n&lt;macros&gt;\n&lt;shard&gt;01&lt;/shard&gt;   &lt;!--\u4e0d\u540c\u673a\u5668\u653e\u7684\u5206\u7247\u6570\u4e0d\u4e00\u6837--&gt;\n&lt;replica&gt;rep_1_1&lt;/replica&gt;  &lt;!--\u4e0d\u540c\u673a\u5668\u653e\u7684\u526f\u672c\u6570\u4e0d\u4e00\u6837--&gt;\n&lt;/macros&gt;\n&lt;/yandex&gt;\n</code></pre></p> <p>2\uff09\u5c06 hadoop102 \u7684 metrika-shard.xml \u540c\u6b65\u5230 103 \u548c 104 <pre><code>sudo /home/atguigu/bin/xsync /etc/clickhouse-server/config.d/metrika-shard.xml\n</code></pre></p> <p>3\uff09\u4fee\u6539 103,104 \u4e2d metrika-shard.xml \u5b8f\u7684\u914d\u7f6e</p> hadoop103hadoop104 <pre><code>&lt;macros&gt;\n&lt;shard&gt;01&lt;/shard&gt; &lt;replica&gt;rep_1_2&lt;/replica&gt;\n&lt;/macros&gt;\n</code></pre> <pre><code>&lt;macros&gt;\n&lt;shard&gt;02&lt;/shard&gt; &lt;replica&gt;rep_2_1&lt;/replica&gt;\n&lt;/macros&gt;\n</code></pre> <p>4\uff09\u5728 hadoop102 \u4e0a\u4fee\u6539 /etc/clickhouse-server/config.xml /etc/clickhouse-server/config.xml<pre><code>&lt;include_from&gt;/etc/clickhouse-server/config.d/metrika-shard.xml&lt;/include_from&gt;\n</code></pre></p> <p>5\uff09\u540c\u6b65 /etc/clickhouse-server/config.xml \u5230 103 \u548c 104 <pre><code>sudo /home/atguigu/bin/xsync /etc/clickhouse-server/config.xml\n</code></pre></p> <p>6\uff09\u91cd\u542f\u4e09\u53f0\u670d\u52a1\u5668\u4e0a\u7684 ClickHouse \u670d\u52a1 <pre><code>sudo systemctl stop clickhouse-server\nsudo systemctl start clickhouse-server\n</code></pre></p>"},{"location":"db/ck/ck_07/#743","title":"7.4.3 \u6d4b\u8bd5","text":"<p>1\uff09\u5728 hadoop102 \u4e0a\u6267\u884c\u5efa\u8868\u8bed\u53e5</p> <pre><code>$ CREATE TABLE st_order_mt ON CLUSTER gmall_cluster\n$ (\n$     `id` UInt32, $     `sku_id` String, $     `total_amount` Decimal(16, 2), $     `create_time` Datetime\n$ )\n$ ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/st_order_mt', '{replica}')\n$ PARTITION BY toYYYYMMDD(create_time)\n$ PRIMARY KEY id\n$ ORDER BY (id, sku_id)\n\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\n\u2502 hadoop102 \u2502 9000 \u2502      0 \u2502       \u2502                   2 \u2502                0 \u2502\n\u2502 hadoop104 \u2502 9000 \u2502      0 \u2502       \u2502                   1 \u2502                0 \u2502\n\u2502 hadoop103 \u2502 9000 \u2502      0 \u2502       \u2502                   0 \u2502                0 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.303 sec.\n</code></pre> <p>2\uff09\u67e5\u770b hadoop103 \u548c hadoop104 \u8868\u662f\u5426\u521b\u5efa\u6210\u529f</p> hadoop103hadoop104 <p> <pre><code>$ show tables; SHOW TABLES\n\n\u250c\u2500name\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 st_order_mt \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n2 rows in set. Elapsed: 0.006 sec.\n</code></pre> </p> <p> <pre><code>$ show tables; SHOW TABLES\n\n\u250c\u2500name\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 st_order_mt \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n2 rows in set. Elapsed: 0.006 sec.\n</code></pre> </p> <p>3\uff09\u5728 hadoop102 \u4e0a\u521b\u5efa Distribute \u5206\u5e03\u5f0f\u8868</p> <pre><code>$ CREATE TABLE st_order_mt_all ON CLUSTER gmall_cluster\n$ (\n$     `id` UInt32, \n$     `sku_id` String, \n$     `total_amount` Decimal(16, 2), \n$     `create_time` Datetime\n$ )\n$ ENGINE = Distributed(gmall_cluster, default, st_order_mt, hiveHash(sku_id))\n\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\n\u2502 hadoop102 \u2502 9000 \u2502      0 \u2502       \u2502                   2 \u2502                0 \u2502\n\u2502 hadoop104 \u2502 9000 \u2502      0 \u2502       \u2502                   1 \u2502                0 \u2502\n\u2502 hadoop103 \u2502 9000 \u2502      0 \u2502       \u2502                   0 \u2502                0 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.158 sec.\n</code></pre> <p>\u53c2\u6570\u542b\u4e49</p> <ul> <li>Distributed(\u96c6\u7fa4\u540d\u79f0\uff0c\u5e93\u540d\uff0c\u672c\u5730\u8868\u540d\uff0c\u5206\u7247\u952e)</li> <li>\u5206\u7247\u952e\u5fc5\u987b\u662f\u6574\u578b\u6570\u5b57\uff0c\u6240\u4ee5\u7528hiveHash\u51fd\u6570\u8f6c\u6362\uff0c\u4e5f\u53ef\u4ee5rand()</li> </ul> <p>4\uff09\u5728 hadoop102 \u4e0a\u63d2\u5165\u6d4b\u8bd5\u6570\u636e <pre><code>insert into  st_order_mt_all values\n(201,'sku_001',1000.00,'2020-06-01 12:00:00') ,\n(202,'sku_002',2000.00,'2020-06-01 12:00:00'),\n(203,'sku_004',2500.00,'2020-06-01 12:00:00'),\n(204,'sku_002',2000.00,'2020-06-01 12:00:00'),\n(205,'sku_003',600.00,'2020-06-02 12:00:00');\n</code></pre></p> <p>5\uff09\u901a\u8fc7\u67e5\u8be2\u5206\u5e03\u5f0f\u8868\u548c\u672c\u5730\u8868\u89c2\u5bdf\u8f93\u51fa\u7ed3\u679c</p> <p>\u5206\u5e03\u5f0f\u8868</p> <p><code>sql SELECT *  FROM st_order_mt_all;</code></p> <p>\u672c\u5730\u8868</p> <p><code>sql select * from st_order_mt;</code></p> <p>\u89c2\u5bdf\u6570\u636e\u7684\u5206\u5e03</p> st_order_mt_allhadoop102:st_order_mthadoop103:st_order_mthadoop104:st_order_mt <pre><code>\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 202 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 203 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 204 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 201 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 205 \u2502 sku_003 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 202 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 203 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 204 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 202 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 203 \u2502 sku_004 \u2502      2500.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2502 204 \u2502 sku_002 \u2502      2000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 205 \u2502 sku_003 \u2502       600.00 \u2502 2020-06-02 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500id\u2500\u252c\u2500sku_id\u2500\u2500\u252c\u2500total_amount\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500create_time\u2500\u2510\n\u2502 201 \u2502 sku_001 \u2502      1000.00 \u2502 2020-06-01 12:00:00 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"db/ck/ck_08/","title":"\u7b2c\u516b\u7ae0 Bitmap","text":""},{"location":"db/ck/ck_08/#81-bitmap","title":"8.1 \u4e3a\u4ec0\u4e48\u7528Bitmap","text":""},{"location":"db/ck/ck_08/#811","title":"8.1.1 \u5b58\u50a8\u6210\u672c\u4f4e","text":"<p>\u5047\u8bbe\u6709\u4e2a 1,2,5 \u7684\u6570\u5b57\u96c6\u5408\uff0c\u5982\u679c\u5e38\u89c4\u7684\u5b58\u50a8\u65b9\u6cd5\uff0c\u8981\u7528 3 \u4e2a Int32 \u7a7a\u95f4\u3002\u5176\u4e2d\u4e00\u4e2a Int32 \u5c31\u662f 32 \u4f4d\u7684\u7a7a\u95f4\u3002\u4e09\u4e2a\u5c31\u662f 3 * 32 bit\uff0c\u76f8\u5f53\u4e8e 12 \u4e2a\u5b57\u8282\u3002</p> <p>\u5982\u679c\u7528 Bitmap \u600e\u4e48\u5b58\u50a8\u5462\uff0c\u53ea\u7528 8Bit\uff08 1 \u4e2a\u5b57\u8282\uff09\u5c31\u591f\u4e86\u3002\u6bcf\u4e00\u4f4d\u4ee3\u8868\u4e00\u4e2a\u6570\uff0c\u4f4d\u53f7\u5c31\u662f\u6570\u503c\uff0c1 \u6807\u8bc6\u6709\uff0c0 \u6807\u8bc6\u65e0\u3002\u5982\u4e0b\u56fe\uff1a</p> 7 6 5 4 3 2 1 0 0 0 1 0 0 1 1 0 <p>\u8fd9\u6837\u7684\u4e00\u4e2a\u5b57\u8282\u53ef\u4ee5\u5b58 8 \u4e2a\u6574\u6570\uff0c\u6bcf\u4e00\u4e2a\u6570\u7684\u5b58\u50a8\u6210\u672c\u5b9e\u8d28\u4e0a\u662f 1bit\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4 Bitmap \u7684\u5b58\u50a8\u6210\u672c\u662f Array[Int32] \u7684 1/32,\u662f Array[Int64] \u7684 1/64\u3002</p> <p>\u597d\u5904\u4e00\uff1a \u5982\u679c\u6709\u4e00\u4e2a\u8d85\u5927\u7684\u65e0\u5e8f\u4e14\u4e0d\u91cd\u590d\u7684\u6574\u6570\u96c6\u5408\uff0c\u7528 Bitmap \u7684\u5b58\u50a8\u6210\u672c\u662f\u975e\u5e38\u4f4e\u7684\u3002</p>"},{"location":"db/ck/ck_08/#812","title":"8.1.2 \u5929\u7136\u53bb\u91cd","text":"<p>\u597d\u5904\u4e8c\uff1a \u56e0\u4e3a\u6bcf\u4e2a\u503c\u90fd\u53ea\u5bf9\u5e94\u552f\u4e00\u7684\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u5b58\u50a8\u4e24\u4e2a\u503c\uff0c\u6240\u4ee5 Bitmap \u7ed3\u6784\u53ef\u4ee5\u5929\u7136\u53bb\u91cd\u3002</p>"},{"location":"db/ck/ck_08/#813","title":"8.1.3 \u5feb\u901f\u5b9a\u4f4d","text":"<p>\u5982\u679c\u6709\u4e00\u4e2a\u9700\u6c42\uff0c\u6bd4\u5982\u60f3\u5224\u65ad\u6570\u5b57 \u201c3\u201d \u662f\u5426\u5b58\u5728\u4e8e\u8be5\u96c6\u5408\u4e2d\u3002\u82e5\u662f\u4f20\u7edf\u7684\u6570\u5b57\u96c6\u5408\u5b58\u50a8\uff0c\u90a3\u5c31\u8981\u9010\u4e2a\u904d\u5386\u6bcf\u4e2a\u5143\u7d20\u8fdb\u884c\u5224\u65ad\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(N)\u3002</p> <p>\u4f46\u662f\u82e5\u662f Bitmap \u5b58\u50a8\uff0c\u53ea\u8981\u67e5\u770b\u5bf9\u5e94\u7684\u4e0b\u6807\u6570\u7684\u503c\u662f 0 \u8fd8\u662f 1 \u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u3002</p> <p>\u4f8b\u5982\uff1a\u67e5\u8be2 3</p> 7 6 5 4 \u21923 2 1 0 0 0 1 0 0 1 1 0 <p>\u597d\u5904\u4e09\uff1a\u975e\u5e38\u65b9\u4fbf\u5feb\u901f\u7684\u67e5\u8be2\u67d0\u4e2a\u5143\u7d20\u662f\u5426\u5728\u96c6\u5408\u4e2d\u3002</p>"},{"location":"db/ck/ck_08/#814","title":"8.1.4 \u96c6\u5408\u95f4\u8ba1\u7b97","text":"<p>\u5982\u679c\u6211\u6709\u53e6\u4e00\u4e2a\u96c6\u5408 2\u30013\u30017\uff0c\u6211\u60f3\u67e5\u8be2\u8fd9\u4e24\u4e2a\u96c6\u5408\u7684\u4ea4\u96c6\u3002</p> <p>\u4f20\u7edf\u65b9\u5f0f [1,2,5] \u4e0e [2,3,7] \u53d6\u4ea4\u96c6\u5c31\u8981\u4e24\u5c42\u5faa\u73af\u904d\u5386\u3002</p> <p>\u800c Bitmap \u53ea\u8981\u628a 00100110 \u548c 10001100 \u8fdb\u884c\u4e0e\u64cd\u4f5c\u5c31\u884c\u4e86\u3002\u800c\u8ba1\u7b97\u673a\u505a\u4e0e\u3001\u6216\u3001\u975e\u3001\u5f02\u6216 \u7b49\u7b49\u64cd\u4f5c\u662f\u975e\u5e38\u5feb\u7684\u3002</p> <p></p> <p>\u597d\u5904\u56db\uff1a\u96c6\u5408\u4e0e\u96c6\u5408\u4e4b\u95f4\u7684\u8fd0\u7b97\u975e\u5e38\u5feb\u3002</p>"},{"location":"db/ck/ck_08/#815","title":"8.1.5 \u4f18\u52bf\u573a\u666f","text":"<p>\u7efc\u4e0a\uff0cBitmap \u975e\u5e38\u9002\u5408\u7684\u573a\u666f\uff1a</p> <ul> <li>\u6d77\u91cf\u6570\u636e\u7684\u538b\u7f29\u5b58\u50a8</li> <li>\u53bb\u91cd\u5b58\u50a8</li> <li>\u5224\u65ad\u503c\u5b58\u5728\u4e8e\u96c6\u5408</li> <li>\u96c6\u5408\u4e4b\u95f4\u7684\u4ea4\u5e76\u5dee</li> </ul>"},{"location":"db/ck/ck_08/#816","title":"8.1.6 \u5c40\u9650\u6027","text":"<p>\u5f53\u7136\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u6709\u5c40\u9650\u6027\uff1a</p> <ul> <li>\u53ea\u80fd\u5b58\u50a8\u6b63\u6574\u6570\u800c\u4e0d\u662f\u5b57\u7b26\u4e32</li> <li>\u5b58\u50a8\u7684\u503c\u5fc5\u987b\u662f\u65e0\u5e8f\u4e0d\u91cd\u590d</li> <li>\u4e0d\u9002\u5408\u5b58\u50a8\u7a00\u758f\u7684\u96c6\u5408\uff0c\u6bd4\u5982\u4e00\u4e2a\u96c6\u5408\u5b58\u4e86\u4e09\u4e2a\u6570 [5,1230000,88880000] \u8fd9\u4e09\u4e2a\u6570\uff0c\u7528 Bitmap \u5b58\u50a8\u7684\u8bdd\u5176\u5b9e\u5c31\u4e0d\u592a\u5212\u7b97\u3002\uff08\u4f46\u662f clickhouse \u4f7f\u7528\u7684 RoaringBitmap\uff0c\u4f18\u5316\u4e86\u8fd9\u4e2a\u7a00\u758f\u95ee\u9898\u3002\uff09</li> </ul>"},{"location":"db/ck/ck_08/#82-bitmap","title":"8.2 Bitmap\u5728\u7528\u6237\u5206\u7fa4\u4e2d\u7684\u5e94\u7528","text":""},{"location":"db/ck/ck_08/#821","title":"8.2.1 \u73b0\u72b6","text":"<p>\u9996\u5148\uff0c\u5982\u4e0b\u662f\u7528\u6237\u7684\u6807\u7b7e\u5bbd\u8868</p> \u7528\u6237 \u6027\u522b \u5e74\u9f84 \u504f\u597d 1 \u7537 90\u540e \u6570\u7801 2 \u7537 70\u540e \u4e66\u7c4d 3 \u7537 90\u540e \u7f8e\u98df 4 \u5973 80\u540e \u4e66\u7c4d 5 \u5973 90\u540e \u7f8e\u98df <p>\u5982\u679c\u60f3\u6839\u636e\u6807\u7b7e\u5212\u5206\u4eba\u7fa4\uff0c\u6bd4\u5982\uff1a90\u540e + \u504f\u597d\u7f8e\u98df\u3002</p>"},{"location":"db/ck/ck_08/#822","title":"8.2.2 \u4f20\u7edf\u89e3\u51b3\u65b9\u6848","text":"<p>\u90a3\u4e48\u65e0\u975e\u5bf9\u5217\u503c\u8fdb\u884c\u904d\u5386\u7b5b\u9009\uff0c\u5982\u679c\u4f18\u5316\u4e5f\u5c31\u662f\u5217\u4e0a\u5efa\u7acb\u7d22\u5f15\uff0c\u4f46\u662f\u5f53\u8fd9\u5f20\u8868\u6709 1000 \u4e2a\u6807\u7b7e\u5217\u65f6\uff0c\u5982\u679c\u8981\u7d22\u5f15\u751f\u6548\u5e76\u4e0d\u662f\u6bcf\u5217\u6709\u7d22\u5f15\u5c31\u884c\uff0c\u8981\u6bcf\u79cd\u67e5\u8be2\u7ec4\u5408\u5efa\u4e00\u4e2a\u7d22\u5f15\u624d\u80fd\u751f\u6548\uff0c\u7d22\u5f15\u6570\u91cf\u76f8\u5f53\u4e8e 1000 \u4e2a\u5217\u6392\u5217\u7ec4\u5408\u7684\u4e2a\u6570\uff0c\u8fd9\u663e\u7136\u662f\u4e0d\u53ef\u80fd\u7684\u3002</p>"},{"location":"db/ck/ck_08/#823","title":"8.2.3 \u66f4\u597d\u7684\u65b9\u6848","text":"<p>\u90a3\u4e48\u66f4\u597d\u7684\u529e\u6cd5\u662f\u6309\u5b57\u6bb5\u91cd\u7ec4\u6210 Bitmap\u3002</p> \u5e74\u9f84 Array Bitmap 90\u540e 1,3,5 00101010 80\u540e 4 00010000 70\u540e 2 00000100 \u6027\u522b Array Bitmap \u7537 1,2,3 00001110 \u5973 4,5 00110000 \u504f\u597d Array Bitmap \u6570\u7801 1 00000010 \u7f8e\u98df 3,5 00101000 \u4e66\u7c4d 2,4 00010100 <p>\u5982\u679c\u80fd\u628a\u6570\u636e\u8c03\u6574\u6210\u8fd9\u6837\u7684\u7ed3\u6784\uff0c\u60f3\u8fdb\u884c\u6761\u4ef6\u7ec4\u5408\uff0c\u90a3\u5c31\u7b80\u5355\u4e86\u3002</p> <p>\u6bd4\u5982\uff1a[\u7f8e\u98df] + [90\u540e] = Bitmap[3,5] &amp; Bitmap[1,3,5] = 3,5 \u8fd9\u4e2a\u8ba1\u7b97\u901f\u5ea6\u76f8\u6bd4\u5bbd\u8868\u6761\u4ef6\u7b5b\u9009\u662f\u975e\u5e38\u975e\u5e38\u5feb\u7684\u3002</p>"},{"location":"db/ck/ck_08/#83-clickhousebitmap","title":"8.3  \u5728Clickhouse\u4e2d\u4f7f\u7528Bitmap\u8868","text":"<p>\u8fd8\u662f\u4ee5\u4e0a\u9762\u7684\u8868\u4e3e\u4f8b\uff1a</p>"},{"location":"db/ck/ck_08/#831","title":"8.3.1 \u51c6\u5907\u6d4b\u8bd5\u8868\u548c\u6570\u636e","text":"<p>1\uff09\u521b\u5efa\u6d4b\u8bd5\u5bbd\u8868</p> <pre><code>create table user_tag_merge (   uid UInt64,\ngender String,\nagegroup String,\nfavor String\n)engine=MergeTree()\norder by (uid);\n</code></pre> <p>2\uff09\u63d2\u5165\u6d4b\u8bd5\u6570\u636e\u5230\u5bbd\u8868</p> <pre><code>insert into user_tag_merge values(1,'M','90\u540e','sm');\ninsert into user_tag_merge values(2,'M','70\u540e','sj');\ninsert into user_tag_merge values(3,'M','90\u540e','ms');\ninsert into user_tag_merge values(4,'F','80\u540e','sj');\ninsert into user_tag_merge values(5,'F','90\u540e','ms');\n</code></pre> <p>3\uff09\u521b\u5efaBitmap\u8868</p> <pre><code>create table user_tag_value_bitmap\n( tag_code String,\ntag_value String ,\nus AggregateFunction(groupBitmap,UInt64)\n)engine=AggregatingMergeTree()\npartition by  (tag_code) order by (tag_value);\n</code></pre> <p>Bitmap \u8868\u5fc5\u987b\u9009\u62e9 AggregatingMergeTree \u5f15\u64ce\u3002</p> <p>\u5bf9\u5e94\u7684 Bitmap \u5b57\u6bb5\uff0c\u5fc5\u987b\u662f <code>AggregateFunction(groupBitmap,UInt64)</code>\uff0cgroupBitmap \u6807\u8bc6\u6570\u636e\u7684\u805a\u5408\u65b9\u5f0f\uff0cUInt64 \u6807\u8bc6\u6700\u5927\u53ef\u5b58\u50a8\u7684\u6570\u5b57\u957f\u5ea6\u3002</p> <p>\u4e1a\u52a1\u7ed3\u6784\u4e0a\uff0c\u7a0d\u4f5c\u4e86\u8c03\u6574\u3002\u628a\u4e0d\u540c\u7684\u6807\u7b7e\u653e\u5728\u4e86\u540c\u4e00\u5f20\u8868\u4e2d\uff0c\u4f46\u662f\u56e0\u4e3a\u6839\u636e tag_code \u8fdb\u884c\u4e86\u5206\u533a\uff0c\u6240\u4ee5\u4e0d\u540c\u7684\u6807\u7b7e\u5b9e\u8d28\u4e0a\u8fd8\u662f\u7269\u7406\u5206\u5f00\u7684\u3002</p> <p></p>"},{"location":"db/ck/ck_08/#832","title":"8.3.2 \u5904\u7406\u6b65\u9aa4","text":"<p>1\uff09\u67e5\u770b\u5bbd\u8868\u6570\u636e</p> <pre><code>select agegroup, gender, favor,\nuid from user_tag_merge;\n</code></pre> <p></p> <p>2\uff09\u6bcf\u4e2a\u503c\u524d\u9762\uff0c\u8865\u4e0a\u5b57\u6bb5\u540d\uff0c\u7528()\u7ec4\u5408\u6210\u5143\u7ec4</p> <pre><code>select  ('agegroup', agegroup ),\n('gender',gender ), ('favor',favor ),\nuid from user_tag_merge;\n</code></pre> <p></p> <p>3\uff09\u6bcf\u4e2a\u5217\u7528 <code>[]</code> \u62fc\u63a5\u6210\u6570\u7ec4</p> <pre><code>select  [('agegroup', agegroup),\n('gender',gender), ('favor',favor)] tag_code_value,\nuid from user_tag_merge;\n</code></pre> <p></p> <p>4\uff09\u7528 arrayJoin \u70b8\u5f00\uff0c\u7c7b\u4f3c\u4e8e hive \u4e2d\u7684 explode</p> <pre><code>SELECT\narrayJoin([('agegroup', agegroup), ('gender', gender), ('favor', favor)]) AS tag_code_value,\nuid\nFROM user_tag_merge;\n</code></pre> <p></p> <p>5\uff09\u628a\u5143\u7ec4\u4e2d\u7684\u5b57\u6bb5\u540d\u548c\u5b57\u6bb5\u503c\u62c6\u5f00\uff0c\u5e76\u7528\u8fd9\u4e24\u4e2a\u4f5c\u4e3a\u7ef4\u5ea6\u805a\u5408 uid</p> <pre><code>SELECT\ntag_code_value.1 AS tag_code,\ntag_code_value.2 AS tag_value,\ngroupArray(uid) AS us\nFROM (\nSELECT\narrayJoin([('agegroup', agegroup), ('gender', gender), ('favor', favor)]) AS tag_code_value,\nuid\nFROM user_tag_merge\n) AS tv\nGROUP BY\ntag_code_value.1,\ntag_code_value.2;\n</code></pre> <p></p> <p>6\uff09\u628a groupArray \u66ff\u6362\u6210 groupBitmapState</p> <p>\u8fd9\u5df2\u7ecf\u548c\u6211\u4eec\u8981\u6c42\u7684\u7ed3\u679c\u975e\u5e38\u63a5\u8fd1\u4e86\u3002\u53ea\u4e0d\u8fc7\u5173\u4e8e\u7528\u6237 id \u7684\u805a\u5408\uff0cgroupArray \u5b9e\u73b0\u7684\u662f\u62fc\u63a5\u6210\u7528\u6237 id \u7684\u6570\u7ec4\uff0c\u800c\u6211\u4eec\u60f3\u8981\u7684\u805a\u5408\u662f\uff0c\u805a\u5408\u6210\u4e00\u4e2a Bitmap\u3002 \u90a3\u53ea\u8981\u6539\u4e00\u4e0b\u805a\u5408\u51fd\u6570\u5c31\u53ef\u4ee5\u4e86\u3002</p> <pre><code>SELECT\ntag_code_value.1 AS tag_code,\ntag_code_value.2 AS tag_value,\ngroupBitmapState (uid) AS us\nFROM (\nSELECT\narrayJoin([('agegroup', agegroup), ('gender', gender), ('favor', favor)]) AS tag_code_value,\nuid\nFROM user_tag_merge\n) AS tv\nGROUP BY\ntag_code_value.1,\ntag_code_value.2;\n</code></pre> <p></p> <p>\u8fd9\u91cc\u805a\u5408\u6210 Bitmap \u7684\u5217\u6ca1\u6709\u663e\u793a\u662f\u6b63\u5e38\u7684\uff0c\u56e0\u4e3a Bitmap \u7684\u7ed3\u6784\u672c\u8eab\u65e0\u6cd5\u7528\u6b63\u5e38\u6587\u672c\u663e\u793a\u3002</p> <p>7\uff09\u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u63d2\u5165\u5230 Bitmap \u8868\u4e2d</p> <pre><code>insert into user_tag_value_bitmap\nselect tag_code_value.1 as tag_code,tag_code_value.2 as tag_value ,\ngroupBitmapState( uid ) us\nfrom (\nSELECT\narrayJoin([('agegroup', agegroup), ('gender', gender), ('favor', favor)]) AS tag_code_value,\nuid FROM user_tag_merge\n)tv group by tag_code_value.1,tag_code_value.2;\n</code></pre> <p>8\uff09\u63d2\u5165\u5b8c\u6210\u540e\uff0c\u67e5\u8be2\u4f9d\u65e7\u4e0d\u4f1a\u6b63\u5e38\u663e\u793a</p> <pre><code>select tag_code, tag_value , us from user_tag_value_bitmap ;\n</code></pre> <p></p> <p>9\uff09\u53ef\u4ee5\u901a\u8fc7 bitmapToArray \u51fd\u6570\u9a8c\u8bc1</p> <pre><code>select tag_code, tag_value ,bitmapToArray(us) from user_tag_value_bitmap ;\n</code></pre> <p></p>"},{"location":"db/ck/ck_08/#833-bitmap","title":"8.3.3 \u5bf9Bitmap\u8fdb\u884c\u67e5\u8be2","text":"<p>\u95ee\u9898</p> <p>\u5982\u4f55\u4f7f\u7528 Bitmap \u8868\u67e5\u8be2\u5462\uff1f</p>"},{"location":"db/ck/ck_08/#8331","title":"8.3.3.1 \u6761\u4ef6\u7ec4\u5408\u67e5\u8be2","text":"<p>\u6bd4\u5982\u6211\u60f3\u67e5\u8be2 [90\u540e] + [\u7f8e\u98df] \u7684\u7528\u6237</p> <pre><code>select  bitmapToArray(  bitmapAnd(  (select   us from user_tag_value_bitmap\nwhere tag_value='ms' and tag_code='favor'), (select   us from user_tag_value_bitmap\nwhere tag_value='90\u540e' and tag_code='agegroup') )\n)as res\n</code></pre> <p></p> <p>\u8fd9\u91cc\u9996\u5148\u7528\u6761\u4ef6\u7b5b\u9009\u51fa us, \u6bcf\u4e2a\u4ee3\u8868\u4e00\u4e2a Bitmap \u7ed3\u6784\u7684 uid \u96c6\u5408\uff0c\u627e\u5230\u4e24\u4e2a Bitmap \u540e\u7528 bitmapAnd \u51fd\u6570\u6c42\u4ea4\u96c6\u3002 \u7136\u540e\u4e3a\u4e86\u89c2\u5bdf\u7ed3\u679c\u7528 bitmapToArray \u51fd\u6570\u8f6c\u6362\u6210\u53ef\u89c1\u7684\u6570\u7ec4\u3002</p>"},{"location":"db/ck/ck_08/#8332","title":"8.3.3.2 \u8303\u56f4\u503c\u67e5\u8be2","text":"<p>\u6bd4\u5982\u8981\u53d6 [90\u540e] \u6216\u8005 [80\u540e] + [\u7f8e\u98df]</p> <pre><code>select  bitmapToArray(  bitmapAnd(  (select groupBitmapMergeState(us) us from user_tag_value_bitmap\nwhere tag_value='ms' and tag_code='favor'), (select groupBitmapMergeState(us) from user_tag_value_bitmap\nwhere tag_value in ('90\u540e','80\u540e') and tag_code='agegroup') )\n)as res\n</code></pre> <p></p> <p>\u56e0\u4e3a\u67e5\u8be2\u65f6\uff0c\u6709\u53ef\u80fd\u9700\u8981\u9488\u5bf9\u67d0\u4e00\u4e2a\u6807\u7b7e\uff0c\u53d6\u591a\u4e2a\u503c\uff0c\u751a\u81f3\u662f\u4e00\u4e2a\u533a\u95f4\u8303\u56f4\uff0c\u90a3\u5c31\u4f1a\u6d89\u53ca\u591a\u4e2a\u503c\u7684 userId \u96c6\u5408\uff0c\u56e0\u6b64\u9700\u8981\u5728\u5b50\u67e5\u8be2\u5185\u90e8\u7528 <code>groupBitmapMergeState</code> \u8fdb\u884c\u4e00\u6b21\u5408\u5e76\uff0c\u5176\u5b9e\u5c31\u591a\u4e2a\u96c6\u5408\u53d6\u5e76\u96c6\u3002</p>"},{"location":"db/ck/ck_08/#834","title":"8.3.4 \u51fd\u6570\u603b\u7ed3","text":"\u51fd\u6570 \u8bf4\u660e arrayJoin \u5bbd\u8868\u8f6c Bitmap \u8868\u9700\u8981\u5217\u8f6c\u884c\uff0c\u8981\u7528 arrayJoin \u628a\u591a\u5217\u6570\u7ec4\u70b8\u6210\u884c\u3002 groupBitmapState \u628a\u805a\u5408\u5217\u7684\u6570\u5b57\u503c\u805a\u5408\u6210 Bitmap \u7684\u805a\u5408\u51fd\u6570 bitmapAnd \u6c42\u4e24\u4e2a Bitmap \u503c\u7684\u4ea4\u96c6 bitmapOr \u6c42\u4e24\u4e2a Bitmap \u503c\u7684\u5e76\u96c6 bitmapXor \u6c42\u4e24\u4e2a Bitmap \u503c\u7684\u5dee\u96c6(\u5f02\u6216) bitmapToArray \u628a Bitmap \u8f6c\u6362\u6210\u6570\u503c\u6570\u7ec4 groupBitmapMergeState \u628a\u4e00\u5217\u4e2d\u591a\u4e2a Bitmap \u503c\u8fdb\u884c\u5e76\u96c6\u805a\u5408\u3002 \uff08\u8fde\u7eed\u503c\uff09 bitmapCardinality \u6c42 Bitmap \u5305\u542b\u7684\u503c\u4e2a\u6570"},{"location":"db/hbase/hb_01/","title":"\u7b2c1\u7ae0 HBase\u7b80\u4ecb","text":""},{"location":"db/hbase/hb_01/#11-hbase","title":"1.1 HBase\u5b9a\u4e49","text":"<p>Apache HBase \u662f Hadoop \u6570\u636e\u5e93\uff0c\u4e00\u79cd\u5206\u5e03\u5f0f\u3001\u53ef\u6269\u5c55\u7684\u5927\u6570\u636e\u5b58\u50a8\u3002\u662f\u5f53\u4e0b\u6bd4\u8f83\u706b\u7684 NoSQL \u6570\u636e\u5e93\u4e4b\u4e00\u3002</p>"},{"location":"db/hbase/hb_01/#12-hbase","title":"1.2 HBase\u6570\u636e\u6a21\u578b","text":"<p>HBase \u7684\u8bbe\u8ba1\u7406\u5ff5\u4f9d\u636e Google \u7684 BigTable \u8bba\u6587\uff0c\u8bba\u6587\u4e2d\u5bf9\u4e8e\u6570\u636e\u6a21\u578b\u7684\u9996\u53e5\u4ecb\u7ecd\u3002</p> <p><code>Bigtable \u662f\u4e00\u4e2a\u7a00\u758f\u7684\u3001\u5206\u5e03\u5f0f\u7684\u3001\u6301\u4e45\u7684\u591a\u7ef4\u6392\u5e8f\u6620\u5c04\u3002\u8be5\u6620\u5c04\u7531\u884c\u952e\u3001\u5217\u952e\u548c\u65f6\u95f4\u6233\u7d22\u5f15\uff1b\u6620\u5c04\u4e2d\u7684\u6bcf\u4e2a\u503c\u90fd\u662f\u4e00\u4e2a\u672a\u89e3\u91ca\u7684\u5b57\u8282\u6570\u7ec4\u3002</code> </p> <p>\u6700\u7ec8 HBase \u5173\u4e8e\u6570\u636e\u6a21\u578b\u548c BigTable \u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a</p> <p>HBase \u4f7f\u7528\u4e0e Bigtable \u975e\u5e38\u76f8\u4f3c\u7684\u6570\u636e\u6a21\u578b\u3002\u7528\u6237\u5c06\u6570\u636e\u884c\u5b58\u50a8\u5728\u5e26\u6807\u7b7e\u7684\u8868\u4e2d\u3002\u6570\u636e\u884c\u5177\u6709\u53ef\u6392\u5e8f\u7684\u952e\u548c\u4efb\u610f\u6570\u91cf\u7684\u5217\u3002\u8be5\u8868\u5b58\u50a8\u7a00\u758f\uff0c\u56e0\u6b64\u5982\u679c\u7528\u6237\u559c\u6b22\uff0c\u540c\u4e00\u8868\u4e2d\u7684\u884c\u53ef\u4ee5\u5177\u6709\u75af\u72c2\u53d8\u5316\u7684\u5217\u3002</p> <p>\u6700\u7ec8\u7406\u89e3 HBase \u6570\u636e\u6a21\u578b\u7684\u5173\u952e\u5728\u4e8e\u7a00\u758f\u3001\u5206\u5e03\u5f0f\u3001\u591a\u7ef4\u3001\u6392\u5e8f\u7684\u6620\u5c04\u3002\u5176\u4e2d\u6620\u5c04\u6307\u4ee3\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684 Key-Value \u7ed3\u6784\u3002</p>"},{"location":"db/hbase/hb_01/#121-hbase","title":"1.2.1 HBase\u903b\u8f91\u7ed3\u6784","text":"<p>HBase \u53ef\u4ee5\u7528\u4e8e\u5b58\u50a8\u591a\u79cd\u7ed3\u6784\u7684\u6570\u636e\uff0c\u4ee5 JSON \u4e3a\u4f8b\uff0c\u5b58\u50a8\u7684\u6570\u636e\u539f\u8c8c\u4e3a\uff1a</p> <pre><code>{\n\"row_key1\":{\n\"personal_info\":{\n\"name\":\"zhangsan\",\n\"city\":\"\u5317\u4eac\",\n\"phone\":\"131********\"\n},\n\"office_info\":{\n\"tel\":\"010-1111111\",\n\"address\":\"atguigu\"\n}\n},\n\"row_key11\":{\n\"personal_info\":{\n\"city\":\"\u4e0a\u6d77\",\n\"phone\":\"132********\"\n},\n\"office_info\":{\n\"tel\":\"010-1111111\"\n}\n},\n\"row_key2\":{\n......\n}\n</code></pre> <p> </p> HBase \u903b\u8f91\u7ed3\u6784"},{"location":"db/hbase/hb_01/#122-hbase","title":"1.2.2 HBase\u7269\u7406\u5b58\u50a8\u7ed3\u6784","text":"<p>\u7269\u7406\u5b58\u50a8\u7ed3\u6784\u5373\u4e3a\u6570\u636e\u6620\u5c04\u5173\u7cfb\uff0c\u800c\u5728\u6982\u5ff5\u89c6\u56fe\u7684\u7a7a\u5355\u5143\u683c\uff0c\u5e95\u5c42\u5b9e\u9645\u6839\u672c\u4e0d\u5b58\u50a8\u3002</p> <p> </p> HBase\u7269\u7406\u5b58\u50a8\u7ed3\u6784 <p>1\uff09Name Space</p> <p>\u547d\u540d\u7a7a\u95f4\uff0c\u7c7b\u4f3c\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684 database \u6982\u5ff5\uff0c\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u6709\u591a\u4e2a\u8868\u3002HBase \u4e24\u4e2a\u81ea\u5e26\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u5206\u522b\u662f hbase \u548c default\uff0chbase \u4e2d\u5b58\u653e\u7684\u662f HBase \u5185\u7f6e\u7684\u8868\uff0cdefault \u8868\u662f\u7528\u6237\u9ed8\u8ba4\u4f7f\u7528\u7684\u547d\u540d\u7a7a\u95f4\u3002</p> <p>2\uff09Table</p> <p>\u7c7b\u4f3c\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u8868\u6982\u5ff5\u3002\u4e0d\u540c\u7684\u662f\uff0cHBase \u5b9a\u4e49\u8868\u65f6\u53ea\u9700\u8981\u58f0\u660e\u5217\u65cf\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u58f0\u660e\u5177\u4f53\u7684\u5217\u3002\u56e0\u4e3a\u6570\u636e\u5b58\u50a8\u662f\u7a00\u758f\u7684\uff0c\u6240\u6709\u5f80 HBase \u5199\u5165\u6570\u636e\u65f6\uff0c\u5b57\u6bb5\u53ef\u4ee5\u52a8\u6001\u3001\u6309\u9700\u6307\u5b9a\u3002\u56e0\u6b64\uff0c\u548c\u5173\u7cfb\u578b\u6570\u636e\u5e93\u76f8\u6bd4\uff0cHBase \u80fd\u591f\u8f7b\u677e\u5e94\u5bf9\u5b57\u6bb5\u53d8\u66f4\u7684\u573a\u666f\u3002</p> <p>3\uff09Row</p> <p>HBase \u8868\u4e2d\u7684\u6bcf\u884c\u6570\u636e\u90fd\u7531\u4e00\u4e2a RowKey \u548c\u591a\u4e2a Column\uff08\u5217\uff09\u7ec4\u6210\uff0c\u6570\u636e\u662f\u6309\u7167 RowKey \u7684\u5b57\u5178\u987a\u5e8f\u5b58\u50a8\u7684\uff0c\u5e76\u4e14\u67e5\u8be2\u6570\u636e\u65f6\u53ea\u80fd\u6839\u636e RowKey \u8fdb\u884c\u68c0\u7d22\uff0c\u6240\u4ee5 RowKey \u7684\u8bbe\u8ba1\u5341\u5206\u91cd\u8981\u3002</p> <p>4\uff09Column</p> <p>HBase \u4e2d\u7684\u6bcf\u4e2a\u5217\u90fd\u7531 Column Family(\u5217\u65cf)\u548c Column Qualifier\uff08\u5217\u9650\u5b9a\u7b26\uff09\u8fdb\u884c\u9650\u5b9a\uff0c\u4f8b\u5982 <code>info:name</code>\uff0c<code>info:age</code>\u3002\u5efa\u8868\u65f6\uff0c\u53ea\u9700\u6307\u660e\u5217\u65cf\uff0c\u800c\u5217\u9650\u5b9a\u7b26\u65e0\u9700\u9884\u5148\u5b9a\u4e49\u3002</p> <p>5\uff09TimeStamp</p> <p>\u7528\u4e8e\u6807\u8bc6\u6570\u636e\u7684\u4e0d\u540c\u7248\u672c\uff08 version \uff09\uff0c\u6bcf\u6761\u6570\u636e\u5199\u5165\u65f6\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u4e3a\u5176\u52a0\u4e0a\u8be5\u5b57\u6bb5\uff0c\u5176\u503c\u4e3a\u5199\u5165 HBase \u7684\u65f6\u95f4\u3002</p> <p>6\uff09Cell </p> <p>\u7531 <code>{rowkey, column Family:column Qualifier, timestamp}</code> \u552f\u4e00\u786e\u5b9a\u7684\u5355\u5143\u3002Cell \u4e2d\u7684\u6570\u636e\u5168\u90e8\u662f\u5b57\u8282\u7801\u5f62\u5f0f\u5b58\u8d2e\u3002</p>"},{"location":"db/hbase/hb_01/#13-hbase","title":"1.3 HBase\u57fa\u672c\u67b6\u6784","text":"<p>\u67b6\u6784\u89d2\u8272\uff1a</p> <p>1\uff09Master</p> <p>\u5b9e\u73b0\u7c7b\u4e3a HMaster\uff0c\u8d1f\u8d23\u76d1\u63a7\u96c6\u7fa4\u4e2d\u6240\u6709\u7684 RegionServer \u5b9e\u4f8b\u3002\u4e3b\u8981\u4f5c\u7528\u5982\u4e0b\uff1a</p> <ol> <li>\u7ba1\u7406\u5143\u6570\u636e\u8868\u683c hbase:meta\uff0c\u63a5\u6536\u7528\u6237\u5bf9\u8868\u683c\u521b\u5efa\u4fee\u6539\u5220\u9664\u7684\u547d\u4ee4\u5e76\u6267\u884c</li> <li>\u76d1\u63a7 region \u662f\u5426\u9700\u8981\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\uff0c\u6545\u969c\u8f6c\u79fb\u548c region \u7684\u62c6\u5206</li> </ol> <p>\u901a\u8fc7\u542f\u52a8\u591a\u4e2a\u540e\u53f0\u7ebf\u7a0b\u76d1\u63a7\u5b9e\u73b0\u4e0a\u8ff0\u529f\u80fd\uff1a</p> <p>\u2460 LoadBalancer \u8d1f\u8f7d\u5747\u8861\u5668 \u5468\u671f\u6027\u76d1\u63a7 region \u5206\u5e03\u5728 regionServer \u4e0a\u9762\u662f\u5426\u5747\u8861\uff0c\u7531\u53c2\u6570 hbase.balancer.period \u63a7\u5236\u5468\u671f\u65f6\u95f4\uff0c\u9ed8\u8ba4 5 \u5206\u949f</p> <p>\u2461 CatalogJanitor \u5143\u6570\u636e\u7ba1\u7406\u5668 \u5b9a\u671f\u68c0\u67e5\u548c\u6e05\u7406 hbase:meta \u4e2d\u7684\u6570\u636e\u3002meta \u8868\u5185\u5bb9\u5728\u8fdb\u9636\u4e2d\u4ecb\u7ecd</p> <p>\u2462 MasterProcWAL master \u9884\u5199\u65e5\u5fd7\u5904\u7406\u5668 \u628a master \u9700\u8981\u6267\u884c\u7684\u4efb\u52a1\u8bb0\u5f55\u5230\u9884\u5199\u65e5\u5fd7 WAL \u4e2d\uff0c\u5982\u679c master \u5b95\u673a\uff0c\u8ba9 backupMaster \u8bfb\u53d6\u65e5\u5fd7\u7ee7\u7eed\u5e72</p> <p>2\uff09Region Server</p> <pre><code>Region Server \u5b9e\u73b0\u7c7b\u4e3a HRegionServer\uff0c\u4e3b\u8981\u4f5c\u7528\u5982\u4e0b:\n</code></pre> <ol> <li>\u8d1f\u8d23\u6570\u636e Cell \u7684\u5904\u7406\uff0c\u4f8b\u5982\u5199\u5165\u6570\u636e put\uff0c\u67e5\u8be2\u6570\u636e get \u7b49</li> <li>\u62c6\u5206\u5408\u5e76 region \u7684\u5b9e\u9645\u6267\u884c\u8005\uff0c\u7531 Master \u76d1\u63a7\uff0c\u7531 Region Server \u6267\u884c</li> </ol> <p>3\uff09Zookeeper</p> <p>HBase \u901a\u8fc7 Zookeeper \u6765\u505a Master \u7684\u9ad8\u53ef\u7528\u3001\u8bb0\u5f55 RegionServer \u7684\u90e8\u7f72\u4fe1\u606f\u3001\u5e76\u4e14\u5b58\u50a8\u6709 meta \u8868\u7684\u4f4d\u7f6e\u4fe1\u606f\u3002</p> <p>HBase \u5bf9\u4e8e\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c\u65f6\u76f4\u63a5\u8bbf\u95ee Zookeeper \u7684\uff0c\u5728 2.3 \u7248\u672c\u63a8\u51fa Master Registry \u6a21\u5f0f\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee Master\u3002\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u4f1a\u52a0\u5927\u5bf9 Master \u7684\u538b\u529b\uff0c\u51cf\u8f7b\u5bf9 Zookeeper \u7684\u538b\u529b\u3002</p> <p>4\uff09HDFS </p> <p>HDFS \u4e3a Hbase \u63d0\u4f9b\u6700\u7ec8\u7684\u5e95\u5c42\u6570\u636e\u5b58\u50a8\u670d\u52a1\uff0c\u540c\u65f6\u4e3a HBase \u63d0\u4f9b\u9ad8\u5bb9\u9519\u7684\u652f\u6301\u3002</p>"},{"location":"db/hbase/hb_02/","title":"\u7b2c2\u7ae0 HBase\u5feb\u901f\u5165\u95e8","text":""},{"location":"db/hbase/hb_02/#21-hbase","title":"2.1 HBase\u5b89\u88c5\u90e8\u7f72","text":""},{"location":"db/hbase/hb_02/#211-zookeeper","title":"2.1.1 Zookeeper\u6b63\u5e38\u90e8\u7f72","text":"<p>\u9996\u5148\u4fdd\u8bc1 Zookeeper \u96c6\u7fa4\u7684\u6b63\u5e38\u90e8\u7f72\uff0c\u5e76\u542f\u52a8\u4e4b\u3002</p> <pre><code>zk start\n</code></pre>"},{"location":"db/hbase/hb_02/#212-hadoop","title":"2.1.2 Hadoop\u6b63\u5e38\u90e8\u7f72","text":"<p>Hadoop \u96c6\u7fa4\u7684\u6b63\u5e38\u90e8\u7f72\u5e76\u542f\u52a8\u3002</p> <pre><code>hdp start\n</code></pre>"},{"location":"db/hbase/hb_02/#213-hbase","title":"2.1.3 HBase\u7684\u89e3\u538b","text":"<p>1\uff09\u89e3\u538b Hbase \u5230\u6307\u5b9a\u76ee\u5f55</p> <pre><code>tar -zxvf hbase-2.4.11-bin.tar.gz -C /opt/module/\nmv /opt/module/hbase-2.4.11 /opt/module/hbase\n</code></pre> <p>2\uff09\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> <pre><code>sudo vim /etc/profile.d/my_env.sh\n</code></pre> my_env.sh<pre><code>#HBASE_HOME\nexport HBASE_HOME=/opt/module/hbase\nexport PATH=$PATH:$HBASE_HOME/bin\n</code></pre> <p>3\uff09\u4f7f\u7528 source \u8ba9\u914d\u7f6e\u7684\u73af\u5883\u53d8\u91cf\u751f\u6548</p> <pre><code>source /etc/profile.d/my_env.sh\n</code></pre>"},{"location":"db/hbase/hb_02/#214-hbase","title":"2.1.4 HBase\u7684\u914d\u7f6e\u6587\u4ef6","text":"<p>1\uff09hbase-env.sh \u4fee\u6539\u5185\u5bb9\uff0c\u53ef\u4ee5\u6dfb\u52a0\u5230\u6700\u540e\uff1a</p> hbase-env.sh<pre><code>export HBASE_MANAGES_ZK=false\n</code></pre> <p>2\uff09hbase-site.xml \u4fee\u6539\u5185\u5bb9\uff1a</p> base-site.xml<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n\n&lt;property&gt;\n&lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;\n&lt;value&gt;hadoop102,hadoop103,hadoop104&lt;/value&gt;\n&lt;description&gt;The directory shared by RegionServers.\n    &lt;/description&gt;\n&lt;/property&gt;\n\n&lt;!--    &lt;property&gt;--&gt;\n&lt;!--        &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;--&gt;\n&lt;!--        &lt;value&gt;/export/zookeeper&lt;/value&gt;--&gt;\n&lt;!--        &lt;description&gt; \u8bb0\u5f97\u4fee\u6539ZK\u7684\u914d\u7f6e\u6587\u4ef6 --&gt;\n&lt;!--            ZK\u7684\u4fe1\u606f\u4e0d\u80fd\u4fdd\u5b58\u5230\u4e34\u65f6\u6587\u4ef6\u5939--&gt;\n&lt;!--        &lt;/description&gt;--&gt;\n&lt;!--    &lt;/property&gt;--&gt;\n\n&lt;property&gt;\n&lt;name&gt;hbase.wal.provider&lt;/name&gt;\n&lt;value&gt;filesystem&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n&lt;name&gt;hbase.rootdir&lt;/name&gt;\n&lt;value&gt;hdfs://hadoop102:8020/hbase&lt;/value&gt;\n&lt;description&gt;The directory shared by RegionServers.\n    &lt;/description&gt;\n&lt;/property&gt;\n\n\n&lt;property&gt;\n&lt;name&gt;hbase.cluster.distributed&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre> <p>3\uff09regionservers</p> regionservers<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre> <p>4\uff09\u89e3\u51b3 HBase \u548c Hadoop \u7684 log4j \u517c\u5bb9\u6027\u95ee\u9898\uff0c\u4fee\u6539 HBase \u7684 jar \u5305\uff0c\u4f7f\u7528 Hadoop \u7684 jar \u5305</p> <pre><code>mv /opt/module/hbase/lib/client-facing-thirdparty/slf4j-reload4j-1.7.33.jar /opt/module/hbase/lib/client-facing-thirdparty/slf4j-reload4j-1.7.33.jar.bak\n</code></pre>"},{"location":"db/hbase/hb_02/#215-hbase","title":"2.1.5 HBase\u8fdc\u7a0b\u53d1\u9001\u5230\u5176\u4ed6\u96c6\u7fa4","text":"<pre><code>xsync hbase/\n</code></pre>"},{"location":"db/hbase/hb_02/#216-hbase","title":"2.1.6 HBase\u670d\u52a1\u7684\u542f\u52a8","text":"<p>1\uff09\u5355\u70b9\u542f\u52a8</p> <pre><code>bin/hbase-daemon.sh start master\nbin/hbase-daemon.sh start regionserver\n</code></pre> <p>2\uff09\u7fa4\u542f</p> <pre><code>bin/start-hbase.sh\n</code></pre> <p>3\uff09\u5bf9\u5e94\u7684\u505c\u6b62\u670d\u52a1</p> <pre><code>bin/stop-hbase.sh\n</code></pre>"},{"location":"db/hbase/hb_02/#217-hbase","title":"2.1.7 \u67e5\u770bHBase\u9875\u9762","text":"<p>\u542f\u52a8\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 host:port \u7684\u65b9\u5f0f\u6765\u8bbf\u95ee HBase \u7ba1\u7406\u9875\u9762\uff0c\u4f8b\u5982\uff1a</p> <p>http://hadoop102:16010 </p> <p></p>"},{"location":"db/hbase/hb_02/#218","title":"2.1.8 \u9ad8\u53ef\u7528\uff08\u53ef\u9009\uff09","text":"<p>\u5728 HBase \u4e2d HMaster \u8d1f\u8d23\u76d1\u63a7 HRegionServer \u7684\u751f\u547d\u5468\u671f\uff0c\u5747\u8861 Region Server \u7684\u8d1f\u8f7d\uff0c\u5982\u679c HMaster \u6302\u6389\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a HBase \u96c6\u7fa4\u5c06\u9677\u5165\u4e0d\u5065\u5eb7\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u6b64\u65f6\u7684\u5de5\u4f5c\u72b6\u6001\u5e76\u4e0d\u4f1a\u7ef4\u6301\u592a\u4e45\u3002\u6240\u4ee5 HBase \u652f\u6301\u5bf9 HMaster \u7684\u9ad8\u53ef\u7528\u914d\u7f6e\u3002</p> <p>1\uff09\u5173\u95ed HBase \u96c6\u7fa4\uff08\u5982\u679c\u6ca1\u6709\u5f00\u542f\u5219\u8df3\u8fc7\u6b64\u6b65\uff09</p> <pre><code>bin/stop-hbase.sh\n</code></pre> <p>2\uff09\u5728 conf \u76ee\u5f55\u4e0b\u521b\u5efa backup-masters \u6587\u4ef6</p> <pre><code>touch conf/backup-masters\n</code></pre> <p>3\uff09\u5728 backup-masters \u6587\u4ef6\u4e2d\u914d\u7f6e\u9ad8\u53ef\u7528 HMaster \u8282\u70b9</p> <pre><code>echo hadoop103 &gt; conf/backup-masters\n</code></pre> <p>4\uff09\u5c06\u6574\u4e2a conf \u76ee\u5f55 scp \u5230\u5176\u4ed6\u8282\u70b9</p> <pre><code>xsync conf\n</code></pre> <p>5\uff09\u91cd\u542f hbase ,\u6253\u5f00\u9875\u9762\u6d4b\u8bd5\u67e5\u770b</p> <p>http://hadooo102:16010 </p>"},{"location":"db/hbase/hb_02/#22-hbase-shell","title":"2.2 HBase Shell\u64cd\u4f5c","text":""},{"location":"db/hbase/hb_02/#221","title":"2.2.1 \u57fa\u672c\u64cd\u4f5c","text":"<p>1\uff09\u8fdb\u5165 HBase \u5ba2\u6237\u7aef\u547d\u4ee4\u884c</p> <pre><code>bin/hbase shell\n</code></pre> <p>2\uff09\u67e5\u770b\u5e2e\u52a9\u547d\u4ee4</p> <p>\u80fd\u591f\u5c55\u793a HBase \u4e2d\u6240\u6709\u80fd\u4f7f\u7528\u7684\u547d\u4ee4\uff0c\u4e3b\u8981\u4f7f\u7528\u7684\u547d\u4ee4\u6709 namespace \u547d\u4ee4\u7a7a\u95f4\u76f8\u5173\uff0cDDL \u521b\u5efa\u4fee\u6539\u8868\u683c\uff0cDML \u5199\u5165\u8bfb\u53d6\u6570\u636e\u3002</p> <pre><code>hbase:001:0&gt; help\n</code></pre>"},{"location":"db/hbase/hb_02/#222-namespace","title":"2.2.2 namespace","text":"<p>1\uff09\u521b\u5efa\u547d\u540d\u7a7a\u95f4</p> <p>\u4f7f\u7528\u7279\u5b9a\u7684 help \u8bed\u6cd5\u80fd\u591f\u67e5\u770b\u547d\u4ee4\u5982\u4f55\u4f7f\u7528\u3002</p> <pre><code>hbase:002:0&gt; help 'create_namespace'\n</code></pre> <p>2\uff09\u521b\u5efa\u547d\u540d\u7a7a\u95f4 bigdata</p> <pre><code>hbase:003:0&gt; create_namespace 'bigdata'\n</code></pre> <p>3\uff09\u67e5\u770b\u6240\u6709\u7684\u547d\u540d\u7a7a\u95f4</p> <pre><code>hbase:004:0&gt; list_namespace\n</code></pre>"},{"location":"db/hbase/hb_02/#223-ddl","title":"2.2.3 DDL","text":"<p>1\uff09\u521b\u5efa\u8868</p> <p>\u5728 bigdata \u547d\u540d\u7a7a\u95f4\u4e2d\u521b\u5efa\u8868\u683c student\uff0c\u4e24\u4e2a\u5217\u65cf\u3002info \u5217\u65cf\u6570\u636e\u7ef4\u62a4\u7684\u7248\u672c\u6570\u4e3a 5 \u4e2a\uff0c\u5982\u679c\u4e0d\u5199\u9ed8\u8ba4\u7248\u672c\u6570\u4e3a 1\u3002</p> <pre><code>hbase:005:0&gt; create 'bigdata:student', {NAME =&gt; 'info', VERSIONS =&gt; 5}, {NAME =&gt; 'msg'}\n</code></pre> <p>\u5982\u679c\u521b\u5efa\u8868\u683c\u53ea\u6709\u4e00\u4e2a\u5217\u65cf\uff0c\u6ca1\u6709\u5217\u65cf\u5c5e\u6027\uff0c\u53ef\u4ee5\u7b80\u5199\u3002 \u5982\u679c\u4e0d\u5199\u547d\u540d\u7a7a\u95f4\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\u547d\u540d\u7a7a\u95f4 default\u3002</p> <pre><code>hbase:009:0&gt; create 'student1','info'\n</code></pre> <p>2\uff09\u67e5\u770b\u8868</p> <p>\u67e5\u770b\u8868\u6709\u4e24\u4e2a\u547d\u4ee4\uff1alist \u548c describe list\uff1a\u67e5\u770b\u6240\u6709\u7684\u8868\u540d</p> <pre><code>hbase:013:0&gt; list\n</code></pre> <p>describe\uff1a\u67e5\u770b\u4e00\u4e2a\u8868\u7684\u8be6\u60c5</p> <pre><code>hbase:014:0&gt; describe 'student1'\n</code></pre> <p>3\uff09\u4fee\u6539\u8868 </p> <p>\u8868\u540d\u521b\u5efa\u65f6\u5199\u7684\u6240\u6709\u548c\u5217\u65cf\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u90fd\u53ef\u4ee5\u540e\u7eed\u901a\u8fc7 alter \u4fee\u6539\uff0c\u5305\u62ec\u589e\u52a0\u5220\u9664\u5217\u65cf\u3002</p> <p>\uff081\uff09\u589e\u52a0\u5217\u65cf\u548c\u4fee\u6539\u4fe1\u606f\u90fd\u4f7f\u7528\u8986\u76d6\u7684\u65b9\u6cd5</p> <pre><code>hbase:015:0&gt; alter 'student1',  {NAME =&gt; 'f1', VERSIONS =&gt; 3}\n</code></pre> <p>\uff082\uff09\u5220\u9664\u4fe1\u606f\u4f7f\u7528\u7279\u6b8a\u7684\u8bed\u6cd5</p> <pre><code>hbase:015:0&gt; alter 'student1', NAME =&gt; 'f1', METHOD =&gt; 'delete'\nhbase:016:0&gt; alter 'student1', 'delete' =&gt; 'f1'\n</code></pre> <p>4\uff09\u5220\u9664\u8868 shell \u4e2d\u5220\u9664\u8868\u683c,\u9700\u8981\u5148\u5c06\u8868\u683c\u72b6\u6001\u8bbe\u7f6e\u4e3a\u4e0d\u53ef\u7528\u3002</p> <pre><code>hbase:017:0&gt; disable 'student1'\nhbase:018:0&gt; drop 'student1'\n</code></pre>"},{"location":"db/hbase/hb_02/#224-dml","title":"2.2.4 DML","text":"<p>1\uff09\u5199\u5165\u6570\u636e \u5728 HBase \u4e2d\u5982\u679c\u60f3\u8981\u5199\u5165\u6570\u636e\uff0c\u53ea\u80fd\u6dfb\u52a0\u7ed3\u6784\u4e2d\u6700\u5e95\u5c42\u7684 Cell\u3002\u53ef\u4ee5\u624b\u52a8\u5199\u5165\u65f6\u95f4\u6233\u6307\u5b9a Cell \u7684\u7248\u672c\uff0c\u63a8\u8350\u4e0d\u5199\u9ed8\u8ba4\u4f7f\u7528\u5f53\u524d\u7684\u7cfb\u7edf\u65f6\u95f4\u3002</p> <pre><code>hbase:019:0&gt; put 'bigdata:student','1001','info:name','zhangsan'\nhbase:020:0&gt; put 'bigdata:student','1001','info:name','lisi'\nhbase:021:0&gt; put 'bigdata:student','1001','info:age','18'\n</code></pre> <p>\u5982\u679c\u91cd\u590d\u5199\u5165\u76f8\u540c rowKey\uff0c\u76f8\u540c\u5217\u7684\u6570\u636e\uff0c\u4f1a\u5199\u5165\u591a\u4e2a\u7248\u672c\u8fdb\u884c\u8986\u76d6\u3002</p> <p>2\uff09\u8bfb\u53d6\u6570\u636e</p> <p>\u8bfb\u53d6\u6570\u636e\u7684\u65b9\u6cd5\u6709\u4e24\u4e2a\uff1aget \u548c scan\u3002</p> <p>get \u6700\u5927\u8303\u56f4\u662f\u4e00\u884c\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5217\u7684\u8fc7\u6ee4\uff0c\u8bfb\u53d6\u6570\u636e\u7684\u7ed3\u679c\u4e3a\u591a\u884c Cell\u3002</p> <pre><code>hbase:022:0&gt; get 'bigdata:student','1001'\nhbase:023:0&gt; get 'bigdata:student','1001' , {COLUMN =&gt; 'info:name'}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4fee\u6539\u8bfb\u53d6 Cell \u7684\u7248\u672c\u6570\uff0c\u9ed8\u8ba4\u8bfb\u53d6\u4e00\u4e2a\u3002\u6700\u591a\u80fd\u591f\u8bfb\u53d6\u5f53\u524d\u5217\u65cf\u8bbe\u7f6e\u7684\u7ef4\u62a4\u7248\u672c\u6570\u3002</p> <pre><code>hbase:024:0&gt;get 'bigdata:student','1001' , {COLUMN =&gt; 'info:name', VERSIONS =&gt; 6}\n</code></pre> <p>scan \u662f\u626b\u63cf\u6570\u636e\uff0c\u80fd\u591f\u8bfb\u53d6\u591a\u884c\u6570\u636e\uff0c\u4e0d\u5efa\u8bae\u626b\u63cf\u8fc7\u591a\u7684\u6570\u636e\uff0c\u63a8\u8350\u4f7f\u7528 startRow \u548c stopRow \u6765\u63a7\u5236\u8bfb\u53d6\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u8303\u56f4\u5de6\u95ed\u53f3\u5f00\u3002</p> <pre><code>hbase:025:0&gt; scan 'bigdata:student',{STARTROW =&gt; '1001',STOPROW =&gt; '1002'}\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5b9e\u9645\u5f00\u53d1\u4e2d\u4f7f\u7528 Shell \u7684\u673a\u4f1a\u4e0d\u591a\uff0c\u6240\u6709\u4e30\u5bcc\u7684\u4f7f\u7528\u65b9\u6cd5\u5230 API \u4e2d\u4ecb\u7ecd\u3002</p> <p>3\uff09\u5220\u9664\u6570\u636e</p> <p>\u5220\u9664\u6570\u636e\u7684\u65b9\u6cd5\u6709\u4e24\u4e2a\uff1adelete \u548c deleteall\u3002</p> <p>delete \u8868\u793a\u5220\u9664\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u5373\u4e3a 1 \u4e2a Cell\uff0c\u4e0d\u586b\u5199\u7248\u672c\u9ed8\u8ba4\u5220\u9664\u6700\u65b0\u7684\u4e00\u4e2a\u7248\u672c\u3002</p> <pre><code>hbase:026:0&gt; delete 'bigdata:student','1001','info:name'\n</code></pre> <p>deleteall \u8868\u793a\u5220\u9664\u6240\u6709\u7248\u672c\u7684\u6570\u636e\uff0c\u5373\u4e3a\u5f53\u524d\u884c\u5f53\u524d\u5217\u7684\u591a\u4e2a Cell\u3002\uff08\u6267\u884c\u547d\u4ee4\u4f1a\u6807\u8bb0\u6570\u636e\u4e3a\u8981\u5220\u9664\uff0c\u4e0d\u4f1a\u76f4\u63a5\u5c06\u6570\u636e\u5f7b\u5e95\u5220\u9664\uff0c\u5220\u9664\u6570\u636e\u53ea\u5728\u7279\u5b9a\u65f6\u671f\u6e05\u7406\u78c1\u76d8\u65f6\u8fdb\u884c\uff09</p> <pre><code>hbase:027:0&gt; deleteall 'bigdata:student','1001','info:name'\n</code></pre>"},{"location":"db/hbase/hb_03/","title":"\u7b2c3\u7ae0 HBase API","text":""},{"location":"db/hbase/hb_03/#31","title":"3.1 \u73af\u5883\u51c6\u5907","text":"<p>\u65b0\u5efa\u9879\u76ee\u540e\u5728 pom.xml \u4e2d\u6dfb\u52a0\u4f9d\u8d56\uff1a pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.hbase&lt;/groupId&gt;\n&lt;artifactId&gt;hbase-client&lt;/artifactId&gt;\n&lt;version&gt;2.4.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre></p>"},{"location":"db/hbase/hb_03/#32","title":"3.2\u521b\u5efa\u8fde\u63a5","text":"<p>\u6839\u636e\u5b98\u65b9 API \u4ecb\u7ecd\uff0cHBase \u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u7531 ConnectionFactory \u7c7b\u6765\u521b\u5efa\uff0c\u7528\u6237\u4f7f\u7528\u5b8c\u6210\u4e4b\u540e\u9700\u8981\u624b\u52a8\u5173\u95ed\u8fde\u63a5\u3002\u540c\u65f6\u8fde\u63a5\u662f\u4e00\u4e2a\u91cd\u91cf\u7ea7\u7684\uff0c\u63a8\u8350\u4e00\u4e2a\u8fdb\u7a0b\u4f7f\u7528\u4e00\u4e2a\u8fde\u63a5\uff0c\u5bf9 HBase \u7684\u547d\u4ee4\u901a\u8fc7\u8fde\u63a5\u4e2d\u7684\u4e24\u4e2a\u5c5e\u6027 Admin \u548c Table \u6765\u5b9e\u73b0\u3002</p>"},{"location":"db/hbase/hb_03/#321","title":"3.2.1 \u5355\u7ebf\u7a0b\u521b\u5efa\u8fde\u63a5","text":"<pre><code>package com.atguigu.hbase;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.client.AsyncConnection;\nimport org.apache.hadoop.hbase.client.Connection;\nimport org.apache.hadoop.hbase.client.ConnectionFactory;\n\n\nimport java.io.IOException;\nimport java.util.concurrent.CompletableFuture;\n\npublic class HBaseConnect {\npublic static void main(String[] args) throws IOException {\n\n// 1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nConfiguration conf = new Configuration();\n\n// 2. \u6dfb\u52a0\u914d\u7f6e\u53c2\u6570\nconf.set(\"hbase.zookeeper.quorum\",\"hadoop102,hadoop103,hadoop104\");\n\n\n// 3. \u521b\u5efahbase\u7684\u8fde\u63a5\n// \u9ed8\u8ba4\u4f7f\u7528\u540c\u6b65\u8fde\u63a5\nConnection connection = ConnectionFactory.createConnection(conf);\n\n// \u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u8fde\u63a5\n// \u4e3b\u8981\u5f71\u54cd\u540e\u7eed\u7684DML\u64cd\u4f5c\nCompletableFuture&lt;AsyncConnection&gt; asyncConnection = ConnectionFactory.createAsyncConnection(conf);\n\n// 4. \u4f7f\u7528\u8fde\u63a52\nSystem.out.println(connection);\n\n// 5. \u5173\u95ed\u8fde\u63a5\nconnection.close();\n}\n}\n</code></pre>"},{"location":"db/hbase/hb_03/#322","title":"3.2.2 \u591a\u7ebf\u7a0b\u521b\u5efa\u8fde\u63a5","text":"<p>\u4f7f\u7528\u7c7b\u5355\u4f8b\u6a21\u5f0f,\u786e\u4fdd\u4f7f\u7528\u4e00\u4e2a\u8fde\u63a5\uff0c\u53ef\u4ee5\u540c\u65f6\u7528\u4e8e\u591a\u4e2a\u7ebf\u7a0b\u3002</p> <pre><code>package com.atguigu.hbase;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.hbase.client.AsyncConnection;\nimport org.apache.hadoop.hbase.client.Connection;\nimport org.apache.hadoop.hbase.client.ConnectionFactory;\n\n\nimport java.io.IOException;\nimport java.util.concurrent.CompletableFuture;\n\npublic class HBaseConnect {\n// \u8bbe\u7f6e\u9759\u6001\u5c5e\u6027hbase\u8fde\u63a5\npublic static Connection connection = null;\n\nstatic {\n\n// \u521b\u5efahbase\u7684\u8fde\u63a5\ntry {\n// \u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u6cd5\nconnection = ConnectionFactory.createConnection();\n\n} catch (IOException e) {\nSystem.out.println(\"\u8fde\u63a5\u83b7\u53d6\u5931\u8d25\");\ne.printStackTrace();\n}\n}\n\n/**\n     * \u8fde\u63a5\u5173\u95ed\u65b9\u6cd5,\u7528\u4e8e\u8fdb\u7a0b\u5173\u95ed\u65f6\u8c03\u7528\n     * @throws IOException\n     */\npublic static void closeConnection() throws IOException {\nif (connection != null) {\nconnection.close();\n}\n}\n}\n</code></pre> <p>\u5728 resources \u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u914d\u7f6e\u6587\u4ef6 hbase-site.xml\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\u3002</p> hbase-site.xml<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n&lt;property&gt;\n&lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;\n&lt;value&gt;hadoop102,hadoop103,hadoop104&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre>"},{"location":"db/hbase/hb_03/#33","title":"3.3 \u64cd\u4f5c\u6570\u636e","text":"<p>\u521b\u5efa\u7c7b HBaseDML</p> <pre><code>public class HBaseDML {\n\n// \u6dfb\u52a0\u9759\u6001\u5c5e\u6027connection\u6307\u5411\u5355\u4f8b\u8fde\u63a5\npublic static Connection connection = HBaseConnect.connection;\n}\n</code></pre>"},{"location":"db/hbase/hb_03/#331","title":"3.3.1 \u63d2\u5165\u6570\u636e","text":"<pre><code>/**\n * putCell\u6570\u636e\n * @param nameSpace\n * @param tableName\n * @param rowKey\n * @param family\n * @param column\n * @param value\n * @throws IOException\n */\npublic static void putCell(String nameSpace,String tableName,String rowKey,String family,String column,String value) throws IOException {\n// 1.\u83b7\u53d6table\nTable table = connection.getTable(TableName.valueOf(nameSpace, tableName));\n\n// 2.\u521b\u5efaPut\u5bf9\u8c61\nPut put = new Put(Bytes.toBytes(rowKey));\n\n// 3.\u6dfb\u52a0put\u5c5e\u6027\nput.addColumn(Bytes.toBytes(family),Bytes.toBytes(column),Bytes.toBytes(value));\n\n// 4.put\u6570\u636e\ntable.put(put);\n\n// 5.\u5173\u95ed\u8d44\u6e90\ntable.close();\n}\n\npublic static void main(String[] args) throws IOException {\nputCell(\"bigdata\",\"student\",\"1001\",\"info\",\"name\",\"zhangsan\");\n}\n</code></pre>"},{"location":"db/hbase/hb_03/#332","title":"3.3.2 \u67e5\u8be2\u6570\u636e","text":"<pre><code>/**\n * getCell\u6570\u636e\n * @param nameSpace\n * @param tableName\n * @param rowKey\n * @param family\n * @param column\n * @return\n * @throws IOException\n */\npublic static String getCell(String nameSpace,String tableName,String rowKey,String family,String column) throws IOException {\n\n// 1.\u83b7\u53d6table\nTable table = connection.getTable(TableName.valueOf(nameSpace, tableName));\n\n// 2.\u83b7\u53d6Get\u5bf9\u8c61\nGet get = new Get(Bytes.toBytes(rowKey));\n\n// 3.\u6dfb\u52a0get\u5c5e\u6027\nget.addColumn(Bytes.toBytes(family),Bytes.toBytes(column));\n\n// 4.get\u6570\u636e\n// \u7b80\u4fbf\u7528\u6cd5\n//        byte[] bytes = table.get(get).value();\n//        String value = new String(bytes);\n// \u590d\u6742\u7528\u6cd5\n// 4.1 \u83b7\u53d6result\nResult result = table.get(get);\n// 4.2 \u83b7\u53d6cells\nCell[] cells = result.rawCells();\n// 4.3 \u904d\u5386cells\nString value = \"\";\nfor (Cell cell : cells) {\n// 4.4 \u8f93\u51fa\u6bcf\u4e2acell\nvalue += Bytes.toString(CellUtil.cloneValue(cell)) + \"-\";\n}\n\n// 5.\u5173\u95ed\u8d44\u6e90\ntable.close();\n\nreturn value;\n}\n\npublic static void main(String[] args) throws IOException {\n//        putCell(\"bigdata\",\"student\",\"1001\",\"info\",\"name\",\"zhangsan\");\nString cell = getCell(\"bigdata\", \"student\", \"1001\", \"info\", \"name\");\nSystem.out.println(cell);\n}\n</code></pre>"},{"location":"db/hbase/hb_03/#333","title":"3.3.3 \u626b\u63cf\u6570\u636e","text":"<pre><code>/**\n * \u626b\u63cf\u6570\u636e\n * @param nameSpace\n * @param tableName\n * @param startRow\n * @param stopRow\n * @return\n * @throws IOException\n */\npublic static List&lt;String&gt; scanRows(String nameSpace, String tableName, String startRow, String stopRow) throws IOException {\n\n// 1.\u83b7\u53d6table\nTable table = connection.getTable(TableName.valueOf(nameSpace, tableName));\n\n// 2.\u521b\u5efaScan\u5bf9\u8c61\nScan scan = new Scan().withStartRow(Bytes.toBytes(startRow)).withStopRow(Bytes.toBytes(stopRow));\n\n// 3.\u626b\u63cf\u6570\u636e\nResultScanner scanner = table.getScanner(scan);\n\n// 4.\u83b7\u53d6\u7ed3\u679c\nArrayList&lt;String&gt; arrayList = new ArrayList&lt;&gt;();\nfor (Result result : scanner) {\narrayList.add(Bytes.toString(result.value()));\n}\n\n// 5.\u5173\u95ed\u8d44\u6e90\nscanner.close();\ntable.close();\n\nreturn arrayList;\n}\n\npublic static void main(String[] args) throws IOException {\n//        putCell(\"bigdata\",\"student\",\"1002\",\"info\",\"name\",\"lisi\");\n//        String cell = getCell(\"bigdata\", \"student\", \"1001\", \"info\", \"name\");\n//        System.out.println(cell);\n\nList&lt;String&gt; strings = scanRows(\"bigdata\", \"student\", \"1001\", \"2000\");\n\nfor (String string : strings) {\nSystem.out.println(string);\n}\n}\n</code></pre>"},{"location":"db/hbase/hb_03/#334","title":"3.3.4 \u5e26\u8fc7\u6ee4\u626b\u63cf","text":"<pre><code>/**\n * \u5e26\u8fc7\u6ee4\u7684\u6570\u636e\u626b\u63cf\n * @param namespace\n * @param tableName\n * @param startRow\n * @param stopRow\n * @param columnFamily\n * @param column\n * @param value\n * @throws IOException\n */\npublic static void filterScan(String namespace, String tableName, String startRow, String stopRow,String columnFamily,String column,String value) throws IOException {\n// \u83b7\u53d6table\nTable table = connection.getTable(TableName.valueOf(namespace, tableName));\n\nScan scan = new Scan();\n\nscan.withStartRow(Bytes.toBytes(startRow));\nscan.withStopRow(Bytes.toBytes(stopRow));\n\n// \u521b\u5efa\u8fc7\u6ee4\u5668\u5217\u8868\n// \u9ed8\u8ba4\u8fc7\u6ee4\u6240\u6709,\u53ef\u4ee5\u9009\u62e9\u8fc7\u6ee4\u51fa\u4e00\u4e2a\nFilterList filterList = new FilterList(FilterList.Operator.MUST_PASS_ALL);\n\n// \u5217\u503c\u8fc7\u6ee4\u5668  \u8fc7\u6ee4\u51fa\u5355\u5217\u6570\u636e\nColumnValueFilter columnValueFilter = new ColumnValueFilter(\n// \u5217\u65cf\nBytes.toBytes(columnFamily),\n// \u5217\u540d\nBytes.toBytes(column),\n// \u5339\u914d\u89c4\u5219  \u4e00\u822c\u4e3a\u76f8\u7b49  \u4e5f\u53ef\u4ee5\u662f\u5927\u4e8e\u7b49\u4e8e \u5c0f\u4e8e\u7b49\u4e8e\nCompareOperator.EQUAL,\nBytes.toBytes(value)\n);\n\n// \u5355\u5217\u503c\u8fc7\u6ee4\u5668\n// \u8fc7\u6ee4\u51fa\u7b26\u5408\u6dfb\u52a0\u7684\u6574\u884c\u6570\u636e  \u7ed3\u679c\u5305\u542b\u5176\u4ed6\u5217\nSingleColumnValueFilter singleColumnValueFilter = new SingleColumnValueFilter(\n// \u5217\u65cf\nBytes.toBytes(columnFamily),\n// \u5217\u540d\nBytes.toBytes(column),\n// \u5339\u914d\u89c4\u5219  \u4e00\u822c\u4e3a\u76f8\u7b49  \u4e5f\u53ef\u4ee5\u662f\u5927\u4e8e\u7b49\u4e8e \u5c0f\u4e8e\u7b49\u4e8e\nCompareOperator.EQUAL,\nBytes.toBytes(value)\n);\naddFilter\nfilterList. (singl eColumnValueFilter);\n// \u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a  \u9700\u653e\u5165\u5230\u8fc7\u6ee4\u5668\u5217\u8868\u4e2d\nscan.setFilter(filterList);\n\ntry {\nResultScanner scanner = table.getScanner(scan);\nfor (Result result : scanner) {\nCell[] cells = result.rawCells();\nfor (Cell cell : cells) {\nSystem.out.print(new String(CellUtil.cloneRow(cell)) + \"-\" + new String(CellUtil.cloneFamily(cell)) + \"-\" + new String(CellUtil.cloneQualifier(cell)) + \"-\" + new String(CellUtil.cloneValue(cell)) + '\\t');\n}\n\nSystem.out.println();\n}\n} catch (IOException e) {\ne.printStackTrace();\n}\n\n// \u5173\u95edtable\ntable.close();\n\n}\n</code></pre>"},{"location":"db/hbase/hb_03/#335","title":"3.3.5 \u5220\u9664\u6570\u636e","text":"<pre><code>/**\n * \u5220\u9664column\u6570\u636e\n *\n * @param nameSpace\n * @param tableName\n * @param rowKey\n * @param family\n * @param column\n * @throws IOException\n */\npublic static void deleteColumn(String nameSpace, String tableName, String rowKey, String family, String column) throws IOException {\n\n// 1.\u83b7\u53d6table\nTable table = connection.getTable(TableName.valueOf(nameSpace, tableName));\n\n// 2.\u521b\u5efaDelete\u5bf9\u8c61\nDelete delete = new Delete(Bytes.toBytes(rowKey));\n\n// 3.\u6dfb\u52a0\u5220\u9664\u4fe1\u606f\n// 3.1 \u5220\u9664\u5355\u4e2a\u7248\u672c\n//        delete.addColumn(Bytes.toBytes(family),Bytes.toBytes(column));\n// 3.2 \u5220\u9664\u6240\u6709\u7248\u672c\ndelete.addColumns(Bytes.toBytes(family), Bytes.toBytes(column));\n// 3.3 \u5220\u9664\u5217\u65cf\n//        delete.addFamily(Bytes.toBytes(family));\n\n// 4.\u5220\u9664\u6570\u636e\ntable.delete(delete);\n\n// 5.\u5173\u95ed\u8d44\u6e90\ntable.close();\n}\npublic static void main(String[] args) throws IOException {\n//        putCell(\"bigdata\",\"student\",\"1002\",\"info\",\"name\",\"lisi\");\n//        String cell = getCell(\"bigdata\", \"student\", \"1001\", \"info\", \"name\");\n//        System.out.println(cell);\n//        List&lt;String&gt; strings = scanRows(\"bigdata\", \"student\", \"1001\", \"2000\");\n//        for (String string : strings) {\n//            System.out.println(string);\ndeleteColumn(\"bigdata\", \"student\", \"1001\", \"info\", \"name\");\n}\n</code></pre>"},{"location":"db/hbase/hb_04/","title":"\u7b2c4\u7ae0 HBase\u8fdb\u9636","text":""},{"location":"db/hbase/hb_04/#41-master","title":"4.1 Master\u67b6\u6784","text":"<p>1\uff09Meta \u8868\u683c\u4ecb\u7ecd\uff1a</p> <p>\u5168\u79f0 <code>hbase:meta</code>\uff0c\u53ea\u662f\u5728 list \u547d\u4ee4\u4e2d\u88ab\u8fc7\u6ee4\u6389\u4e86\uff0c\u672c\u8d28\u4e0a\u548c HBase \u7684\u5176\u4ed6\u8868\u683c\u4e00\u6837\u3002 RowKey\uff1a([table],[region start key],[region id]) \u5373 \u8868\u540d\uff0cregion \u8d77\u59cb\u4f4d\u7f6e\u548c regionID\u3002</p> <p>\u5217\uff1a</p> \u5217\u6807\u8bc6\u7b26 \u8bf4\u660e <code>info:regioninfo</code> region \u4fe1\u606f\uff0c\u5b58\u50a8\u4e00\u4e2a HRegionInfo \u5bf9\u8c61 <code>info:server</code> \u5f53\u524d region \u6240\u5904\u7684 RegionServer \u4fe1\u606f\uff0c\u5305\u542b\u7aef\u53e3\u53f7 <code>info:serverstartcode</code> \u5f53\u524d region \u88ab\u5206\u5230 RegionServer \u7684\u8d77\u59cb\u65f6\u95f4 <p>\u5982\u679c\u4e00\u4e2a\u8868\u5904\u4e8e\u5207\u5206\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5373 region \u5207\u5206\uff0c\u8fd8\u4f1a\u591a\u51fa\u4e24\u5217 <code>info:splitA</code> \u548c <code>info:splitB</code>\uff0c\u5b58\u50a8\u503c\u4e5f\u662f HRegionInfo \u5bf9\u8c61\uff0c\u62c6\u5206\u7ed3\u675f\u540e\uff0c\u5220\u9664\u8fd9\u4e24\u5217\u3002</p> <p>\u6ce8\u610f</p> <p>\u5728\u5ba2\u6237\u7aef\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u65f6\u5019\u624d\u4f1a\u8fde\u63a5 Master\uff0c\u5982\u679c\u5bf9\u6570\u636e\u8fdb\u884c\u8bfb\u5199\uff0c\u76f4\u63a5\u8fde\u63a5 zookeeper \u8bfb\u53d6\u76ee\u5f55 /hbase/meta-region-server \u8282\u70b9\u4fe1\u606f\uff0c\u4f1a\u8bb0\u5f55 meta \u8868\u683c\u7684\u4f4d\u7f6e\u3002\u76f4\u63a5\u8bfb\u53d6\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u8bbf\u95ee Master\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u8f7b Master \u7684\u538b\u529b\uff0c\u76f8\u5f53\u4e8e Master \u4e13\u6ce8 meta \u8868\u7684\u5199\u64cd\u4f5c\uff0c\u5ba2\u6237\u7aef\u53ef\u76f4\u63a5\u8bfb\u53d6 meta \u8868\u3002 \u5728 HBase \u7684 2.3 \u7248\u672c\u66f4\u65b0\u4e86\u4e00\u79cd\u65b0\u6a21\u5f0f\uff1aMaster Registry\u3002\u5ba2\u6237\u7aef\u53ef\u4ee5\u8bbf\u95ee Master \u6765\u8bfb\u53d6 meta \u8868\u4fe1\u606f\u3002\u52a0\u5927\u4e86 Master \u7684\u538b\u529b\uff0c\u51cf\u8f7b\u4e86 zookeeper \u7684\u538b\u529b\u3002</p>"},{"location":"db/hbase/hb_04/#42-regionserver","title":"4.2 RegionServer \u67b6\u6784","text":"<p>1\uff09MemStore</p> <p>\u5199\u7f13\u5b58\uff0c\u7531\u4e8e HFile \u4e2d\u7684\u6570\u636e\u8981\u6c42\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u6570\u636e\u662f\u5148\u5b58\u50a8\u5728 MemStore \u4e2d\uff0c\u6392\u597d\u5e8f\u540e\uff0c\u7b49\u5230\u8fbe\u5237\u5199\u65f6\u673a\u624d\u4f1a\u5237\u5199\u5230 HFile\uff0c\u6bcf\u6b21\u5237\u5199\u90fd\u4f1a\u5f62\u6210\u4e00\u4e2a\u65b0\u7684 HFile\uff0c\u5199\u5165\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u5939 store \u4e2d\u3002</p> <p>2\uff09WAL</p> <p>\u7531\u4e8e\u6570\u636e\u8981\u7ecf MemStore \u6392\u5e8f\u540e\u624d\u80fd\u5237\u5199\u5230 HFile\uff0c\u4f46\u628a\u6570\u636e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u4f1a\u6709\u5f88\u9ad8\u7684\u6982\u7387\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6570\u636e\u4f1a\u5148\u5199\u5728\u4e00\u4e2a\u53eb\u505a Write-Ahead Logfile \u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u518d\u5199\u5165 MemStore \u4e2d\u3002\u6240\u4ee5\u5728\u7cfb\u7edf\u51fa\u73b0\u6545\u969c\u7684\u65f6\u5019\uff0c\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u65e5\u5fd7\u6587\u4ef6\u91cd\u5efa\u3002</p> <p>3\uff09BlockCache</p> <p>\u8bfb\u7f13\u5b58\uff0c\u6bcf\u6b21\u67e5\u8be2\u51fa\u7684\u6570\u636e\u4f1a\u7f13\u5b58\u5728 BlockCache \u4e2d\uff0c\u65b9\u4fbf\u4e0b\u6b21\u67e5\u8be2\u3002</p>"},{"location":"db/hbase/hb_04/#42","title":"4.2 \u5199\u6d41\u7a0b","text":"<p>2\uff09\u5199\u6d41\u7a0b\uff1a</p> <p>\u200b    \u5199\u6d41\u7a0b\u987a\u5e8f\u6b63\u5982 API \u7f16\u5199\u987a\u5e8f\uff0c\u9996\u5148\u521b\u5efa HBase \u7684\u91cd\u91cf\u7ea7\u8fde\u63a5</p> <p>\uff081\uff09\u9996\u5148\u8bbf\u95ee zookeeper\uff0c\u83b7\u53d6 <code>hbase:meta</code> \u8868\u4f4d\u4e8e\u54ea\u4e2a Region Server\uff1b</p> <p>\uff082\uff09\u8bbf\u95ee\u5bf9\u5e94\u7684 Region Server\uff0c\u83b7\u53d6 <code>hbase:meta</code> \u8868\uff0c\u5c06\u5176\u7f13\u5b58\u5230\u8fde\u63a5\u4e2d\uff0c\u4f5c\u4e3a\u8fde\u63a5\u5c5e\u6027 MetaCache \uff0c\u7531\u4e8e Meta \u8868\u683c\u5177\u6709\u4e00\u5b9a\u7684\u6570\u636e\u91cf\uff0c\u5bfc\u81f4\u4e86\u521b\u5efa\u8fde\u63a5\u6bd4\u8f83\u6162\uff1b</p> <p>\u200b    \u4e4b\u540e\u4f7f\u7528\u521b\u5efa\u7684\u8fde\u63a5\u83b7\u53d6 Table\uff0c\u8fd9\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u8fde\u63a5\uff0c\u53ea\u6709\u5728\u7b2c\u4e00\u6b21\u521b\u5efa\u7684\u65f6\u5019\u4f1a\u68c0\u67e5\u8868\u683c\u662f\u5426\u5b58\u5728\u8bbf\u95ee RegionServer\uff0c\u4e4b\u540e\u5728\u83b7\u53d6 Table \u65f6\u4e0d\u4f1a\u8bbf\u95ee RegionServer\uff1b</p> <p>\uff083\uff09\u8c03\u7528 Table \u7684 put \u65b9\u6cd5\u5199\u5165\u6570\u636e\uff0c\u6b64\u65f6\u8fd8\u9700\u8981\u89e3\u6790 RowKey\uff0c\u5bf9\u7167\u7f13\u5b58\u7684 MetaCache\uff0c\u67e5\u770b\u5177\u4f53\u5199\u5165\u7684\u4f4d\u7f6e\u6709\u54ea\u4e2a RegionServer\uff1b</p> <p>\uff084\uff09\u5c06\u6570\u636e\u987a\u5e8f\u5199\u5165\uff08\u8ffd\u52a0\uff09\u5230 WAL\uff0c\u6b64\u5904\u5199\u5165\u662f\u76f4\u63a5\u843d\u76d8\u7684\uff0c\u5e76\u8bbe\u7f6e\u4e13\u95e8\u7684\u7ebf\u7a0b\u63a7\u5236 WAL \u9884\u5199\u65e5\u5fd7\u7684\u6eda\u52a8\uff08\u7c7b\u4f3c Flume \uff09\uff1b</p> <p>\uff085\uff09\u6839\u636e\u5199\u5165\u547d\u4ee4\u7684 RowKey \u548c ColumnFamily \u67e5\u770b\u5177\u4f53\u5199\u5165\u5230\u54ea\u4e2a MemStore\uff0c\u5e76\u4e14\u5728 MemStore\u4e2d\u6392\u5e8f\uff1b</p> <p>\uff086\uff09\u5411\u5ba2\u6237\u7aef\u53d1\u9001 ack\uff1b</p> <p>\uff087\uff09\u7b49\u8fbe\u5230 MemStore \u7684\u5237\u5199\u65f6\u673a\u540e\uff0c\u5c06\u6570\u636e\u5237\u5199\u5230\u5bf9\u5e94\u7684 store \u4e2d \u3002</p>"},{"location":"db/hbase/hb_04/#43-memstore-flush","title":"4.3 MemStore Flush","text":"<p>MemStore\u5237\u5199\u7531\u591a\u4e2a\u7ebf\u7a0b\u63a7\u5236\uff0c\u6761\u4ef6\u4e92\u76f8\u72ec\u7acb\uff1a</p> <p>\u4e3b\u8981\u7684\u5237\u5199\u89c4\u5219\u662f\u63a7\u5236\u5237\u5199\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u5728\u6bcf\u4e00\u4e2a\u5237\u5199\u7ebf\u7a0b\u4e2d\u90fd\u4f1a\u8fdb\u884c\u76d1\u63a7</p> <p>\uff081\uff09\u5f53\u67d0\u4e2a Memstroe \u7684\u5927\u5c0f\u8fbe\u5230\u4e86 <code>hbase.hregion.memstore.flush.size</code>\uff08\u9ed8\u8ba4\u503c 128M\uff09\uff0c\u5176\u6240\u5728 region \u7684\u6240\u6709 Memstore \u90fd\u4f1a\u5237\u5199\u3002</p> <p>\u5f53 Memstore \u7684\u5927\u5c0f\u8fbe\u5230\u4e86</p> <p><code>hbase.hregion.memstore.flush.size</code>\uff08\u9ed8\u8ba4\u503c128M\uff09* <code>hbase.hregion.memstore.block.multiplier</code>\uff08\u9ed8\u8ba4\u503c4\uff09 \u65f6\uff0c\u4f1a\u5237\u5199\u540c\u65f6\u963b\u6b62\u7ee7\u7eed\u5f80\u8be5 Memstore\u5199\u6570\u636e\uff08\u7531\u4e8e\u7ebf\u7a0b\u76d1\u63a7\u662f\u5468\u671f\u6027\u7684\uff0c\u6240\u6709\u6709\u53ef\u80fd\u9762\u5bf9\u6570\u636e\u6d2a\u5cf0\uff0c\u5c3d\u7ba1\u53ef\u80fd\u6027\u6bd4\u8f83\u5c0f\uff09</p> <p>\uff082\uff09\u7531 HRegionServer \u4e2d\u7684\u5c5e\u6027 MemStoreFlusher \u5185\u90e8\u7ebf\u7a0b FlushHandler \u63a7\u5236\u3002\u6807\u51c6\u4e3a LOWER_MARK\uff08\u4f4e\u6c34\u4f4d\u7ebf\uff09\u548c HIGH_MARK\uff08\u9ad8\u6c34\u4f4d\u7ebf\uff09\uff0c\u610f\u4e49\u5728\u4e8e\u907f\u514d\u5199\u7f13\u5b58\u4f7f\u7528\u8fc7\u591a\u7684\u5185\u5b58\u9020\u6210 OOM</p> <p>\u5f53 Region Server \u4e2d Memstore \u7684\u603b\u5927\u5c0f\u8fbe\u5230\u4f4e\u6c34\u4f4d\u7ebf</p> <p><code>java_heapsize</code> * <code>hbase.regionserver.global.memstore.size</code>\uff08\u9ed8\u8ba4\u503c0.4\uff09* <code>hbase.regionserver.global.memstore.size.lower.limit</code>\uff08\u9ed8\u8ba4\u503c0.95\uff09</p> <p>Region Server \u4e2d\u7684\u6240\u6709 Memstore \u4f1a\u6309\u7167\u5927\u5c0f\u4ece\u5927\u5230\u5c0f\u5237\u5199\uff0c\u76f4\u5230\u603b MemStore \u5927\u5c0f\u5c0f\u4e8e <code>hbase.regionserver.global.memstore.size.lower.limit</code>\u3002</p> <p>\u5f53 Region Server \u4e2d Memstore \u7684\u603b\u5927\u5c0f\u8fbe\u5230\u9ad8\u6c34\u4f4d\u7ebf</p> <p><code>java_heapsize</code> * <code>hbase.regionserver.global.memstore.size</code>\uff08\u9ed8\u8ba4\u503c0.4\uff09</p> <p>\u65f6\uff0c\u4f1a\u540c\u65f6\u963b\u6b62\u7ee7\u7eed\u5f80\u6240\u6709\u7684 Memstore \u5199\u6570\u636e\u3002</p> <p>\uff083\uff09\u4e3a\u4e86\u907f\u514d\u6570\u636e\u8fc7\u957f\u65f6\u95f4\u5904\u4e8e\u5185\u5b58\u4e4b\u4e2d\uff0c\u5230\u8fbe\u81ea\u52a8\u5237\u5199\u7684\u65f6\u95f4\uff0c\u4e5f\u4f1a\u89e6\u53d1 Memstore Flush\u3002\u7531 HRegionServer \u7684\u5c5e\u6027 PeriodicMemStoreFlusher \u63a7\u5236\u8fdb\u884c\uff0c\u7531\u4e8e\u91cd\u8981\u6027\u6bd4\u8f83\u4f4e\uff0c5min \u624d\u4f1a\u6267\u884c\u4e00\u6b21\u3002</p> <p>\u81ea\u52a8\u5237\u65b0\u7684\u65f6\u95f4\u95f4\u9694\u7531\u8be5\u5c5e\u6027\u8fdb\u884c\u914d\u7f6e <code>hbase.regionserver.optionalcacheflushinterval</code>\uff08\u9ed8\u8ba41\u5c0f\u65f6\uff09\u3002</p> <p>\uff084\uff09\u5f53 WAL \u6587\u4ef6\u7684\u6570\u91cf\u8d85\u8fc7 <code>hbase.regionserver.max.logs</code>\uff0cregion \u4f1a\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u5237\u5199\uff0c\u76f4\u5230 WAL \u6587\u4ef6\u6570\u91cf\u51cf\u5c0f\u5230 <code>hbase.regionserver.max.log</code> \u4ee5\u4e0b\uff08\u8be5\u5c5e\u6027\u540d\u5df2\u7ecf\u5e9f\u5f03\uff0c\u73b0\u65e0\u9700\u624b\u52a8\u8bbe\u7f6e\uff0c\u6700\u5927\u503c\u4e3a 32 \uff09\u3002</p>"},{"location":"db/hbase/hb_04/#44","title":"4.4 \u8bfb\u6d41\u7a0b","text":""},{"location":"db/hbase/hb_04/#441-hfile","title":"4.4.1 HFile\u7ed3\u6784","text":"<p>\u5728\u4e86\u89e3\u8bfb\u6d41\u7a0b\u4e4b\u524d\uff0c\u9700\u8981\u5148\u77e5\u9053\u8bfb\u53d6\u7684\u6570\u636e\u662f\u4ec0\u4e48\u6837\u5b50\u7684\u3002</p> <p>HFile \u662f\u5b58\u50a8\u5728 HDFS \u4e0a\u9762\u6bcf\u4e00\u4e2a store \u6587\u4ef6\u5939\u4e0b\u5b9e\u9645\u5b58\u50a8\u6570\u636e\u7684\u6587\u4ef6\u3002\u91cc\u9762\u5b58\u50a8\u591a\u79cd\u5185\u5bb9\u3002\u5305\u62ec\u6570\u636e\u672c\u8eab\uff08 keyValue \u952e\u503c\u5bf9\uff09\u3001\u5143\u6570\u636e\u8bb0\u5f55\u3001\u6587\u4ef6\u4fe1\u606f\u3001\u6570\u636e\u7d22\u5f15\u3001\u5143\u6570\u636e\u7d22\u5f15\u548c\u4e00\u4e2a\u56fa\u5b9a\u957f\u5ea6\u7684\u5c3e\u90e8\u4fe1\u606f\uff08\u8bb0\u5f55\u6587\u4ef6\u7684\u4fee\u6539\u60c5\u51b5\uff09\u3002</p> <p>\u952e\u503c\u5bf9\u6309\u7167\u5757\u5927\u5c0f\uff08\u9ed8\u8ba4 64K \uff09\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u6570\u636e\u7d22\u5f15\u6309\u7167\u5757\u521b\u5efa\uff0c\u5757\u8d8a\u591a\uff0c\u7d22\u5f15\u8d8a\u5927\u3002\u6bcf\u4e00\u4e2a HFile \u8fd8\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u5e03\u9686\u8fc7\u6ee4\u5668\uff08\u5c31\u50cf\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u5730\u56fe\uff0c\u6587\u4ef6\u4e2d\u6bcf\u6709\u4e00\u79cd key\uff0c\u5c31\u5728\u5bf9\u5e94\u7684\u4f4d\u7f6e\u6807\u8bb0\uff0c\u8bfb\u53d6\u65f6\u53ef\u4ee5\u5927\u81f4\u5224\u65ad\u8981 get \u7684 key \u662f\u5426\u5b58\u5728HFile \u4e2d\uff09\u3002</p> <p>KeyValue\u5185\u5bb9\u5982\u4e0b:</p> Key Value rowlength key\u7684\u957f\u5ea6 row key\u7684\u503c columnfamilylength \u5217\u65cf\u957f\u5ea6 columnfamily \u5217\u65cf columnqualifier \u5217\u540d timestamp \u65f6\u95f4\u6233\uff08\u9ed8\u8ba4\u7cfb\u7edf\u65f6\u95f4\uff09 keytype Put <p>\u7531\u4e8e HFile \u5b58\u50a8\u7ecf\u8fc7\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u65e0\u6cd5\u76f4\u63a5\u67e5\u770b\u3002\u53ef\u4ee5\u901a\u8fc7 HBase \u63d0\u4f9b\u7684\u547d\u4ee4\u6765\u67e5\u770b\u5b58\u50a8\u5728 HDFS \u4e0a\u9762\u7684 HFile \u5143\u6570\u636e\u5185\u5bb9\u3002</p> <pre><code>bin/hbase hfile -m  -f /hbase/data/\u547d\u540d\u7a7a\u95f4 /\u8868\u540d/regionID/\u5217\u65cf/HFile\u540d\n</code></pre>"},{"location":"db/hbase/hb_04/#442","title":"4.4.2 \u8bfb\u6d41\u7a0b","text":"<p>\u521b\u5efa\u8fde\u63a5\u540c\u5199\u6d41\u7a0b\u3002</p> <p>\uff081\uff09\u521b\u5efa Table \u5bf9\u8c61\u53d1\u9001 get \u8bf7\u6c42\u3002</p> <p>\uff082\uff09\u4f18\u5148\u8bbf\u95ee Block Cache \uff0c\u67e5\u627e\u662f\u5426\u4e4b\u524d\u8bfb\u53d6\u8fc7\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bfb\u53d6 HFile \u7684\u7d22\u5f15\u4fe1\u606f\u548c\u5e03\u9686\u8fc7\u6ee4\u5668\u3002</p> <p>\uff083\uff09\u4e0d\u7ba1\u8bfb\u7f13\u5b58\u4e2d\u662f\u5426\u5df2\u7ecf\u6709\u6570\u636e\u4e86\uff08\u53ef\u80fd\u5df2\u7ecf\u8fc7\u671f\u4e86\uff09\uff0c\u90fd\u9700\u8981\u518d\u6b21\u8bfb\u53d6\u5199\u7f13\u5b58\u548c store \u4e2d\u7684\u6587\u4ef6\u3002</p> <p>\uff084\uff09\u6700\u7ec8\u5c06\u6240\u6709\u8bfb\u53d6\u5230\u7684\u6570\u636e\u5408\u5e76\u7248\u672c\uff0c\u6309\u7167 get \u7684\u8981\u6c42\u8fd4\u56de\u5373\u53ef\u3002</p>"},{"location":"db/hbase/hb_04/#443","title":"4.4.3 \u5408\u5e76\u8bfb\u53d6\u6570\u636e\u4f18\u5316","text":"<p>\u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u90fd\u9700\u8981\u8bfb\u53d6\u4e09\u4e2a\u4f4d\u7f6e\uff0c\u6700\u540e\u8fdb\u884c\u7248\u672c\u7684\u5408\u5e76\u3002\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\uff0c\u6240\u4ee5\u7cfb\u7edf\u9700\u8981\u5bf9\u6b64\u4f18\u5316\u3002</p> <p>\uff081\uff09HFile \u5e26\u6709\u7d22\u5f15\u6587\u4ef6\uff0c\u8bfb\u53d6\u5bf9\u5e94 RowKey \u6570\u636e\u4f1a\u6bd4\u8f83\u5feb\u3002</p> <p>\uff082\uff09Block Cache \u4f1a\u7f13\u5b58\u4e4b\u524d\u8bfb\u53d6\u7684\u5185\u5bb9\u548c\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5982\u679c HFile \u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff08\u8bb0\u5f55\u5728 HFile \u5c3e\u4fe1\u606f\u4e2d\uff09\uff0c\u5219\u4e0d\u9700\u8981\u518d\u6b21\u8bfb\u53d6\u3002</p> <p>\uff083\uff09\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u80fd\u591f\u5feb\u901f\u8fc7\u6ee4\u5f53\u524d HFile \u4e0d\u5b58\u5728\u9700\u8981\u8bfb\u53d6\u7684 RowKey\uff0c\u4ece\u800c\u907f\u514d\u8bfb\u53d6\u6587\u4ef6\u3002\uff08\u5e03\u9686\u8fc7\u6ee4\u5668\u4f7f\u7528 HASH \u7b97\u6cd5\uff0c\u4e0d\u662f\u7edd\u5bf9\u51c6\u786e\u7684\uff0c\u51fa\u9519\u4f1a\u9020\u6210\u591a\u626b\u63cf\u4e00\u4e2a\u6587\u4ef6\uff0c\u5bf9\u8bfb\u53d6\u6570\u636e\u7ed3\u679c\u6ca1\u6709\u5f71\u54cd\uff09</p>"},{"location":"db/hbase/hb_04/#45-storefile-compaction","title":"4.5 StoreFile Compaction","text":"<p>\u7531\u4e8e Memstore \u6bcf\u6b21\u5237\u5199\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 HFile\uff0c\u6587\u4ef6\u8fc7\u591a\u8bfb\u53d6\u4e0d\u65b9\u4fbf\uff0c\u6240\u4ee5\u4f1a\u8fdb\u884c\u6587\u4ef6\u7684\u5408\u5e76\uff0c\u6e05\u7406\u6389\u8fc7\u671f\u548c\u5220\u9664\u7684\u6570\u636e\uff0c\u4f1a\u8fdb\u884c StoreFile Compaction\u3002</p> <p>Compaction \u5206\u4e3a\u4e24\u79cd\uff0c\u5206\u522b\u662f Minor Compaction \u548c Major Compaction\u3002Minor Compaction \u4f1a\u5c06\u4e34\u8fd1\u7684\u82e5\u5e72\u4e2a\u8f83\u5c0f\u7684 HFile \u5408\u5e76\u6210\u4e00\u4e2a\u8f83\u5927\u7684 HFile\uff0c\u5e76\u6e05\u7406\u6389\u90e8\u5206\u8fc7\u671f\u548c\u5220\u9664\u7684\u6570\u636e\uff0c\u6709\u7cfb\u7edf\u4f7f\u7528\u4e00\u7ec4\u53c2\u6570\u81ea\u52a8\u63a7\u5236\uff0cMajor Compaction \u4f1a\u5c06\u4e00\u4e2a store \u4e0b\u7684\u6240\u6709\u7684 HFile \u5408\u5e76\u6210\u4e00\u4e2a\u5927 HFile\uff0c\u5e76\u4e14\u4f1a\u6e05\u7406\u6389\u6240\u6709\u8fc7\u671f\u548c\u5220\u9664\u7684\u6570\u636e\uff0c\u7531\u53c2\u6570 <code>hbase.hregion.majorcompaction</code> \u63a7\u5236\uff0c\u9ed8\u8ba4 7 \u5929\u3002</p> <p></p> <p>Minor Compaction \u63a7\u5236\u673a\u5236\uff1a</p> <p>\u53c2\u4e0e\u5230\u5c0f\u5408\u5e76\u7684\u6587\u4ef6\u9700\u8981\u901a\u8fc7\u53c2\u6570\u8ba1\u7b97\u5f97\u5230\uff0c\u6709\u6548\u7684\u53c2\u6570\u6709 5 \u4e2a</p> <ul> <li><code>hbase.hstore.compaction.ratio</code>\uff08\u9ed8\u8ba4 1.2F \uff09\u538b\u7f29\u6587\u4ef6\u9009\u62e9\u7b97\u6cd5\u4e2d\u4f7f\u7528\u7684\u6bd4\u7387</li> <li><code>hbase.hstore.compaction.min</code>\uff08\u9ed8\u8ba4 3 \uff09  \u4e3a Minor Compaction \u7684\u6700\u5c11\u6587\u4ef6\u4e2a\u6570</li> <li><code>hbase.hstore.compaction.max</code>\uff08\u9ed8\u8ba4 10\uff09 \u4e3a Minor Compaction \u6700\u5927\u6587\u4ef6\u4e2a\u6570</li> <li><code>hbase.hstore.compaction.min.size</code>\uff08\u9ed8\u8ba4 128M\uff09\u4e3a\u5355\u4e2a Hfile \u6587\u4ef6\u5927\u5c0f\u6700\u5c0f\u503c\uff0c\u5c0f\u4e8e\u8fd9\u4e2a\u6570\u4f1a\u88ab\u5408\u5e76</li> <li><code>hbase.hstore.compaction.max.size</code>\uff08\u9ed8\u8ba4 Long.MAX_VALUE \uff09\u4e3a\u5355\u4e2a Hfile \u6587\u4ef6\u5927\u5c0f\u6700\u5927\u503c\uff0c\u9ad8\u4e8e\u8fd9\u4e2a\u6570\u4e0d\u4f1a\u88ab\u5408\u5e76</li> </ul> <p>\u5c0f\u5408\u5e76\u673a\u5236\u4e3a\u62c9\u53d6\u6574\u4e2a store \u4e2d\u7684\u6240\u6709\u6587\u4ef6\uff0c\u505a\u6210\u4e00\u4e2a\u96c6\u5408\u3002\u4e4b\u540e\u6309\u7167\u4ece\u65e7\u5230\u65b0\u7684\u987a\u5e8f\u904d\u5386\u3002\u5224\u65ad\u6761\u4ef6\u4e3a\uff1a</p> <p>\u2460 \u8fc7\u5c0f\u5408\u5e76\uff0c\u8fc7\u5927\u4e0d\u5408\u5e76</p> <p>\u2461 \u6587\u4ef6\u5927\u5c0f/<code>hbase.hstore.compaction.ratio</code> &lt; \u5269\u4f59\u6587\u4ef6\u5927\u5c0f\u7684\u603b\u548c \u5219\u53c2\u4e0e\u538b\u7f29\u3002\u6240\u4ee5\u628a\u6bd4\u503c\u8bbe\u7f6e\u8fc7\u5927\uff0c\u5982 10 \u4f1a\u6700\u7ec8\u5408\u5e76\u4e3a 1 \u4e2a\u7279\u522b\u5927\u7684\u6587\u4ef6\uff0c\u76f8\u53cd\uff0c\u8bbe\u7f6e\u4e3a  0.4\uff0c\u4f1a\u6700\u7ec8\u4ea7\u751f 4 \u4e2a storeFile\u3002\u4e0d\u5efa\u8bae\u4fee\u6539\u9ed8\u8ba4\u503c \u2462 \u6ee1\u8db3\u538b\u7f29\u6761\u4ef6\u7684\u6587\u4ef6\u4e2a\u6570\u8fbe\u4e0d\u5230\u4e2a\u6570\u8981\u6c42\uff08 3  &lt;=  count  &lt;=  10\uff09\u5219\u4e0d\u538b\u7f29\u3002</p>"},{"location":"db/hbase/hb_04/#46-region-split","title":"4.6 Region Split","text":"<p>Region \u5207\u5206\u5206\u4e3a\u4e24\u79cd\uff0c\u521b\u5efa\u8868\u683c\u65f6\u5019\u7684\u9884\u5206\u533a\u5373\u81ea\u5b9a\u4e49\u5206\u533a\uff0c\u540c\u65f6\u7cfb\u7edf\u9ed8\u8ba4\u8fd8\u4f1a\u542f\u52a8\u4e00\u4e2a\u5207\u5206\u89c4\u5219\uff0c\u907f\u514d\u5355\u4e2a Region \u4e2d\u7684\u6570\u636e\u91cf\u592a\u5927\u3002</p>"},{"location":"db/hbase/hb_04/#461","title":"4.6.1 \u9884\u5206\u533a\uff08\u81ea\u5b9a\u4e49\u5206\u533a\uff09","text":"<p>\u6bcf\u4e00\u4e2a region \u7ef4\u62a4\u7740 startRow \u4e0e endRowKey\uff0c\u5982\u679c\u52a0\u5165\u7684\u6570\u636e\u7b26\u5408\u67d0\u4e2a region \u7ef4\u62a4\u7684 rowKey \u8303\u56f4\uff0c\u5219\u8be5\u6570\u636e\u4ea4\u7ed9\u8fd9\u4e2a region \u7ef4\u62a4\u3002\u90a3\u4e48\u4f9d\u7167\u8fd9\u4e2a\u539f\u5219\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u6240\u8981\u6295\u653e\u7684\u5206\u533a\u63d0\u524d\u5927\u81f4\u7684\u89c4\u5212\u597d\uff0c\u4ee5\u63d0\u9ad8 HBase \u6027\u80fd\u3002</p> <p>1\uff09\u624b\u52a8\u8bbe\u5b9a\u9884\u5206\u533a</p> <pre><code>create 'staff1','info', SPLITS =&gt; ['1000','2000','3000','4000']\n</code></pre> <p>2\uff09\u751f\u6210 16 \u8fdb\u5236\u5e8f\u5217\u9884\u5206\u533a</p> <pre><code>create 'staff2','info',{NUMREGIONS =&gt; 15, SPLITALGO =&gt; 'HexStringSplit'}\n</code></pre> <p>3\uff09\u6309\u7167\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u89c4\u5219\u9884\u5206\u533a</p> <p>\uff081\uff09\u521b\u5efa splits.txt \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> splits.txt<pre><code>aaaa\nbbbb\ncccc\ndddd\n</code></pre> <p>\uff082\uff09\u7136\u540e\u6267\u884c\uff1a</p> <pre><code>create 'staff3', 'info',SPLITS_FILE =&gt; 'splits.txt'\n</code></pre>"},{"location":"db/hbase/hb_04/#462","title":"4.6.2 \u7cfb\u7edf\u62c6\u5206","text":"<p>\u200b   Region \u7684\u62c6\u5206\u662f\u7531 HRegionServer \u5b8c\u6210\u7684\uff0c\u5728\u64cd\u4f5c\u4e4b\u524d\u9700\u8981\u901a\u8fc7 ZK \u6c47\u62a5 Master\uff0c\u4fee\u6539\u5bf9\u5e94\u7684 meta \u8868\u4fe1\u606f\u6dfb\u52a0\u4e24\u5217 <code>info:splitA</code> \u548c <code>info:splitB</code> \u4fe1\u606f\u3002\u4e4b\u540e\u9700\u8981\u64cd\u4f5c HDFS \u4e0a\u9762\u5bf9\u5e94\u7684\u6587\u4ef6\uff0c\u6309\u7167\u62c6\u5206\u540e\u7684 Region \u8303\u56f4\u8fdb\u884c\u6807\u8bb0\u533a\u5206\uff0c\u5b9e\u9645\u64cd\u4f5c\u4e3a\u521b\u5efa\u6587\u4ef6\u5f15\u7528\uff0c\u4e0d\u4f1a\u632a\u52a8\u6570\u636e\u3002\u521a\u5b8c\u6210\u62c6\u5206\u7684\u65f6\u5019\uff0c\u4e24\u4e2a Region \u90fd\u7531\u539f\u5148\u7684 RegionServer \u7ba1\u7406\u3002\u4e4b\u540e\u6c47\u62a5\u7ed9 Master\uff0c\u7531 Master \u5c06\u4fee\u6539\u540e\u7684\u4fe1\u606f\u5199\u5165\u5230 meta \u8868\u4e2d\u3002\u7b49\u5f85\u4e0b\u4e00\u6b21\u89e6\u53d1\u8d1f\u8f7d\u5747\u8861\u673a\u5236\uff0c\u624d\u4f1a\u4fee\u6539 Region \u7684\u7ba1\u7406\u670d\u52a1\u8005\uff0c\u800c\u6570\u636e\u8981\u7b49\u5230\u4e0b\u4e00\u6b21\u538b\u7f29\u65f6\uff0c\u624d\u4f1a\u5b9e\u9645\u8fdb\u884c\u79fb\u52a8\u3002</p> <p>\u4e0d\u7ba1\u662f\u5426\u4f7f\u7528\u9884\u5206\u533a\uff0c\u7cfb\u7edf\u90fd\u4f1a\u9ed8\u8ba4\u542f\u52a8\u4e00\u5957 Region \u62c6\u5206\u89c4\u5219\u3002\u4e0d\u540c\u7248\u672c\u7684\u62c6\u5206\u89c4\u5219\u6709\u5dee\u522b\u3002\u7cfb\u7edf\u62c6\u5206\u7b56\u7565\u7684\u7236\u7c7b\u4e3a RegionSplitPolicy\uff080.94 \u7248\u672c\u4e4b\u524d =&gt;  ConstantSizeRegionSplitPolicy\uff09\u3002</p> <p>\uff081\uff09\u5f53 1 \u4e2a region \u4e2d\u7684\u67d0\u4e2a Store \u4e0b\u6240\u6709 StoreFile \u7684\u603b\u5927\u5c0f\u8d85\u8fc7 <code>hbase.hregion.max.filesize</code> \uff0810G\uff09\uff0c\u8be5 Region \u5c31\u4f1a\u8fdb\u884c\u62c6\u5206\u3002 0.94 \u7248\u672c\u4e4b\u540e\uff0c2.0 \u7248\u672c\u4e4b\u524d =&gt;  IncreasingToUpperBoundRegionSplitPolicy</p> <p>\uff082\uff09\u5f53 1 \u4e2aregion \u4e2d\u7684\u67d0\u4e2a store \u4e0b\u6240\u6709 StoreFile \u7684\u603b\u5927\u5c0f\u8d85\u8fc7 <code>Min(initialSize*R^3^ ,hbase.hregion.max.filesize\")</code>\uff0c\u8be5 Region \u5c31\u4f1a\u8fdb\u884c\u62c6\u5206\u3002\u5176\u4e2d initialSize \u7684\u9ed8\u8ba4\u503c\u4e3a 2 * <code>hbase.hregion.memstore.flush.size</code> \uff0cR \u4e3a\u5f53\u524d Region Server \u4e2d\u5c5e\u4e8e\u8be5 Table \u7684 Region \u4e2a\u6570\uff080.94\u7248\u672c\u4e4b\u540e\uff09\u3002</p> <p>\u5177\u4f53\u7684\u5207\u5206\u7b56\u7565\u4e3a\uff1a</p> <p>\u7b2c\u4e00\u6b21 split\uff1a13 * 256 = 256MB </p> <p>\u7b2c\u4e8c\u6b21 split\uff1a23 * 256 = 2048MB </p> <p>\u7b2c\u4e09\u6b21 split\uff1a33 * 256 = 6912MB </p> <p>\u7b2c\u56db\u6b21 split\uff1a43 * 256 = 16384MB &gt; 10GB\uff0c\u56e0\u6b64\u53d6\u8f83\u5c0f\u7684\u503c 10GB </p> <p>\u540e\u9762\u6bcf\u6b21 split \u7684 size \u90fd\u662f 10GB \u4e86\u3002 2.0 \u7248\u672c\u4e4b\u540e  =&gt; SteppingSplitPolicy </p> <p>\uff083\uff09Hbase 2.0 \u5f15\u5165\u4e86\u65b0\u7684 split \u7b56\u7565\uff1a\u5982\u679c\u5f53\u524d RegionServer \u4e0a\u8be5\u8868\u53ea\u6709\u4e00\u4e2a Region\uff0c\u6309\u7167 2  * <code>hbase.hregion.memstore.flush.size</code> \u5206\u88c2\uff0c\u5426\u5219\u6309\u7167 <code>hbase.hregion.max.filesize</code> \u5206\u88c2\u3002\u8fd9\u53eb\u5927\u9053\u81f3\u7b80\uff0c\u5b66\u6d77\u62bd\u4e1d\u3002</p>"},{"location":"db/hbase/hb_05/","title":"\u7b2c5\u7ae0 HBase\u4f18\u5316","text":""},{"location":"db/hbase/hb_05/#51-rowkey","title":"5.1 RowKey\u8bbe\u8ba1","text":"<p>\u4e00\u6761\u6570\u636e\u7684\u552f\u4e00\u6807\u8bc6\u5c31\u662f rowkey\uff0c\u90a3\u4e48\u8fd9\u6761\u6570\u636e\u5b58\u50a8\u4e8e\u54ea\u4e2a\u5206\u533a\uff0c\u53d6\u51b3\u4e8e rowkey \u5904\u4e8e\u54ea\u4e2a\u4e00\u4e2a\u9884\u5206\u533a\u7684\u533a\u95f4\u5185\uff0c\u8bbe\u8ba1 rowkey \u7684\u4e3b\u8981\u76ee\u7684 \uff0c\u5c31\u662f\u8ba9\u6570\u636e\u5747\u5300\u7684\u5206\u5e03\u4e8e\u6240\u6709\u7684 region \u4e2d\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u9632\u6b62\u6570\u636e\u503e\u659c\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8c08\u4e00\u8c08 rowkey \u5e38\u7528\u7684\u8bbe\u8ba1\u65b9\u6848\u3002</p> <ul> <li>\u751f\u6210\u968f\u673a\u6570\u3001hash\u3001\u6563\u5217\u503c</li> <li>\u5b57\u7b26\u4e32\u53cd\u8f6c</li> <li>\u5b57\u7b26\u4e32\u62fc\u63a5</li> </ul> <p>\u9700\u6c42</p> <p>\u4f7f\u7528 HBase \u5b58\u50a8\u4e0b\u5217\u6570\u636e\uff0c\u8981\u6c42\u80fd\u591f\u901a\u8fc7 HBase \u7684 API \u8bfb\u53d6\u6570\u636e\u5b8c\u6210\u4e24\u4e2a\u7edf\u8ba1\u9700\u6c42\u3002</p> <ol> <li>\u7edf\u8ba1\u5f20\u4e09\u5728 2021 \u5e74 12 \u6708\u4efd\u6d88\u8d39\u7684\u603b\u91d1\u989d</li> <li>\u7edf\u8ba1\u6240\u6709\u4eba\u5728 2021 \u5e74 12 \u6708\u4efd\u6d88\u8d39\u7684\u603b\u91d1\u989d</li> </ol> user_info.txt<pre><code>user            date                    pay\nzhangsan        2022-01-05 09:08:00     100\nzhangsan        2021-12-30 09:08:00     100\nzhangsanfeng    2022-01-04 09:08:00     200\nlisi            2021-12-31 09:08:00     150\n</code></pre>"},{"location":"db/hbase/hb_05/#511-1","title":"5.1.1 \u5b9e\u73b0\u9700\u6c421","text":"<p>\u4e3a\u4e86\u80fd\u591f\u7edf\u8ba1\u5f20\u4e09\u5728 2021 \u5e74 12 \u6708\u4efd\u6d88\u8d39\u7684\u603b\u91d1\u989d\uff0c\u6211\u4eec\u9700\u8981\u7528 scan \u547d\u4ee4\u80fd\u591f\u5f97\u5230\u5f20\u4e09\u5728\u8fd9\u4e2a\u6708\u6d88\u8d39\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u4e4b\u540e\u5728\u8fdb\u884c\u7d2f\u52a0\u5373\u53ef\u3002scan \u9700\u8981\u586b\u5199 startRow \u548c stopRow\uff1a</p> <pre><code>scan :  startRow -&gt;   zhangsan_2021-12  endRow   -&gt;  zhangsan_2021-12.  </code></pre> <p>\u6ce8\u610f</p> <p>\uff081\uff09\u59d3\u540d\u548c\u65e5\u671f\u7684\u5b57\u6bb5\u76f4\u63a5\u9700\u8981\u6709\u5206\u9694\u7b26\uff0c\u5206\u9694\u7b26\u89c4\u5219\u6309\u7167 ASCII \u7801\u8fdb\u884c\uff0c\u9700\u8981\u907f\u514d\u626b\u63cf\u5230\u7528\u6237 zhangsanfeng \u7684\u6570\u636e</p> <p></p> <p>\uff082\uff09\u6700\u540e\u7684\u65e5\u671f\u7ed3\u5c3e\u5904\u9700\u8981\u4f7f\u7528 ASCII \u7801\u7565\u5927\u4e8e <code>-</code> \u7684\u503c</p> <p>\u6700\u7ec8\u5f97\u5230 rowKey \u7684\u8bbe\u8ba1\u4e3a\uff1a</p> <pre><code>//\u6ce8\u610frowkey\u76f8\u540c\u7684\u6570\u636e\u4f1a\u89c6\u4e3a\u76f8\u540c\u6570\u636e\u8986\u76d6\u6389\u4e4b\u524d\u7684\u7248\u672c\nrowKey:  user_date(yyyy-MM-dd HH:mm:SS)\n</code></pre>"},{"location":"db/hbase/hb_05/#512-2","title":"5.1.2 \u5b9e\u73b0\u9700\u6c422","text":"<p>\u95ee\u9898\u63d0\u51fa\uff1a\u6309\u7167\u9700\u6c42 1 \u7684 rowKey \u8bbe\u8ba1\uff0c\u4f1a\u53d1\u73b0\u5bf9\u4e8e\u9700\u6c42 2\uff0c\u5b8c\u5168\u6ca1\u6709\u529e\u6cd5\u5199 rowKey \u7684\u626b\u63cf\u8303\u56f4\u3002\u6b64\u5904\u80fd\u591f\u770b\u51fa HBase \u8bbe\u8ba1 rowKey \u4f7f\u7528\u7684\u7279\u70b9\u4e3a\uff1a</p> <p>\u9002\u7528\u6027\u5f3a  \u6cdb\u7528\u6027\u5dee  \u80fd\u591f\u5b8c\u7f8e\u5b9e\u73b0\u4e00\u4e2a\u9700\u6c42  \u4f46\u662f\u4e0d\u80fd\u540c\u65f6\u5b9e\u73b0\u591a\u4e2a\u9700\u8981\u3002</p> <p>\u5982\u679c\u60f3\u8981\u540c\u65f6\u5b8c\u6210\u4e24\u4e2a\u9700\u6c42\uff0c\u9700\u8981\u5bf9 rowKey \u51fa\u73b0\u5b57\u6bb5\u7684\u987a\u5e8f\u8fdb\u884c\u8c03\u6574\u3002</p> <p>\u8c03\u6574\u7684\u539f\u5219\u4e3a\uff1a\u53ef\u679a\u4e3e\u7684\u653e\u5728\u524d\u9762\u3002\u5176\u4e2d\u65f6\u95f4\u662f\u53ef\u4ee5\u679a\u4e3e\u7684\uff0c\u7528\u6237\u540d\u79f0\u65e0\u6cd5\u679a\u4e3e\uff0c\u6240\u4ee5\u5fc5\u987b\u628a\u65f6\u95f4\u653e\u5728\u524d\u9762\u3002</p> <pre><code>//\u8bbe\u8ba1\u5982\u4e0b\nrowKey:  date(yyyy-MM)_user_date(-dd HH:mm:SS)\n\u5b9e\u73b0\u9700\u6c421 scan :  startRow -&gt;  2021-12_zhangsan\nendRow   -&gt;   2021-12_zhangsan.\n\u5b9e\u73b0\u9700\u6c422\nscan :  startRow -&gt;  2021-12\nendRow  -&gt;   2021-12.\n</code></pre>"},{"location":"db/hbase/hb_05/#513","title":"5.1.3 \u6dfb\u52a0\u9884\u5206\u533a\u4f18\u5316","text":"<p>\u9884\u5206\u533a\u7684\u5206\u533a\u53f7\u540c\u6837\u9700\u8981\u9075\u5b88 rowKey \u7684 scan \u539f\u5219\u3002\u6240\u6709\u5fc5\u987b\u6dfb\u52a0\u5728 rowKey \u7684\u6700\u524d\u9762\uff0c\u524d\u7f00\u4e3a\u6700\u7b80\u5355\u7684\u6570\u5b57\u3002\u540c\u65f6\u4f7f\u7528 hash \u7b97\u6cd5\u5c06\u7528\u6237\u540d\u548c\u6708\u4efd\u62fc\u63a5\u51b3\u5b9a\u5206\u533a\u53f7\u3002\uff08\u5355\u72ec\u4f7f\u7528\u7528\u6237\u540d\u4f1a\u9020\u6210\u5355\u4e00\u7528\u6237\u6240\u6709\u6570\u636e\u5b58\u50a8\u5728\u4e00\u4e2a\u5206\u533a\uff09</p> <pre><code>000.\n001.\n002.\n...\n119.\n\n//\u6b64\u65f6rowKey\u8bbe\u8ba1\nrowKey:  000(hash[user-\u6708\u4efd])_date(yyyy-MM)_user_date(-dd HH:mm:SS)\n</code></pre> <p>\u7f3a\u70b9\uff1a\u5b9e\u73b0\u9700\u6c42 2 \u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6bcf\u4e2a\u5206\u533a\u90fd\u6709 12 \u6708\u4efd\u7684\u6570\u636e\uff0c\u9700\u8981\u626b\u63cf 120 \u4e2a\u5206\u533a\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a\u63d0\u524d\u5c06\u5206\u533a\u53f7\u548c\u6708\u4efd\u8fdb\u884c\u5bf9\u5e94\u3002</p> <pre><code>000 - 009 \u53f7\u5206\u533a\u5b58\u50a81\u6708\u4efd\u6570\u636e\n...\n110 - 119 \u53f7\u5206\u533a\u5b58\u50a812\u6708\u4efd\u6570\u636e\n\nrowKey\u60c5\u51b5:  000(hash[user]%10 + \u6708\u4efd\u5bf9\u5e94\u7684\u5206\u533a\u5f00\u59cb\u503c)_date(yyyy-MM)_user_date(-dd HH:mm:SS)\n\n\u5b8c\u6210\u9700\u6c422:\n\nscan :  startRow -&gt;  110_2021-12\nendRow  -&gt;   110_2021-12.\n... \u626b\u63cf10\u6b21\nstartRow -&gt;  119_2021-12\nendRow  -&gt;   119_2021-12.\n</code></pre>"},{"location":"db/hbase/hb_05/#52","title":"5.2 \u5185\u5b58\u4f18\u5316","text":"<p>HBase \u64cd\u4f5c\u8fc7\u7a0b\u4e2d\u9700\u8981\u5927\u91cf\u7684\u5185\u5b58\u5f00\u9500\uff0c\u6bd5\u7adf Table \u662f\u53ef\u4ee5\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u4f46\u662f\u4e0d\u5efa\u8bae\u5206\u914d\u975e\u5e38\u5927\u7684\u5806\u5185\u5b58\uff0c\u56e0\u4e3a GC \u8fc7\u7a0b\u6301\u7eed\u592a\u4e45\u4f1a\u5bfc\u81f4 RegionServer \u5904\u4e8e\u957f\u671f\u4e0d\u53ef\u7528\u72b6\u6001\uff0c\u4e00\u822c 16 ~ 36G \u5185\u5b58\u5c31\u53ef\u4ee5\u4e86\uff0c\u5982\u679c\u56e0\u4e3a\u6846\u67b6\u5360\u7528\u5185\u5b58\u8fc7\u9ad8\u5bfc\u81f4\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\uff0c\u6846\u67b6\u4e00\u6837\u4f1a\u88ab\u7cfb\u7edf\u670d\u52a1\u62d6\u6b7b\u3002</p>"},{"location":"db/hbase/hb_05/#53","title":"5.3 \u53c2\u6570\u4f18\u5316","text":"<p>1\uff09Zookeeper\u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4</p> hbase-site.xml<pre><code>\u5c5e\u6027\uff1azookeeper.session.timeout\n\u89e3\u91ca\uff1a\u9ed8\u8ba4\u503c\u4e3a90000\u6beb\u79d2\uff0890s\uff09\u3002\u5f53\u67d0\u4e2aRegionServer\u6302\u6389\uff0c90s\u4e4b\u540eMaster\u624d\u80fd\u5bdf\u89c9\u5230\u3002\u53ef\u9002\u5f53\u51cf\u5c0f\u6b64\u503c\uff0c\u5c3d\u53ef\u80fd\u5feb\u5730\u68c0\u6d4b regionserver \u6545\u969c\uff0c\u53ef\u8c03\u6574\u81f320-30s\u3002\n\n\u770b\u4f60\u80fd\u6709\u90fd\u80fd\u5fcd\u8010\u8d85\u65f6\uff0c\u540c\u65f6\u53ef\u4ee5\u8c03\u6574\u91cd\u8bd5\u65f6\u95f4\u548c\u91cd\u8bd5\u6b21\u6570\nhbase.client.pause\uff08\u9ed8\u8ba4\u503c100ms\uff09\nhbase.client.retries.number\uff08\u9ed8\u8ba415\u6b21\uff09\n</code></pre> <p>2\uff09\u8bbe\u7f6eRPC\u76d1\u542c\u6570\u91cf</p> hbase-site.xml<pre><code>\u5c5e\u6027\uff1ahbase.regionserver.handler.count\n\u89e3\u91ca\uff1a\u9ed8\u8ba4\u503c\u4e3a30\uff0c\u7528\u4e8e\u6307\u5b9aRPC\u76d1\u542c\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u6839\u636e\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u6570\u8fdb\u884c\u8c03\u6574\uff0c\u8bfb\u5199\u8bf7\u6c42\u8f83\u591a\u65f6\uff0c\u589e\u52a0\u6b64\u503c\u3002\n</code></pre> <p>3\uff09\u624b\u52a8\u63a7\u5236 Major Compaction</p> hbase-site.xml<pre><code>\u5c5e\u6027\uff1ahbase.hregion.majorcompaction\n\u89e3\u91ca\uff1a\u9ed8\u8ba4\u503c\uff1a604800000\u79d2\uff087\u5929\uff09\uff0c Major Compaction\u7684\u5468\u671f\uff0c\u82e5\u5173\u95ed\u81ea\u52a8Major Compaction\uff0c\u53ef\u5c06\u5176\u8bbe\u4e3a0\u3002\u5982\u679c\u5173\u95ed\u4e00\u5b9a\u8bb0\u5f97\u81ea\u5df1\u624b\u52a8\u5408\u5e76\uff0c\u56e0\u4e3a\u5927\u5408\u5e76\u975e\u5e38\u6709\u610f\u4e49\n</code></pre> <p>4\uff09\u4f18\u5316HStore\u6587\u4ef6\u5927\u5c0f</p> hbase-site.xml<pre><code>\u5c5e\u6027\uff1ahbase.hregion.max.filesize\n\u89e3\u91ca\uff1a\u9ed8\u8ba4\u503c10737418240\uff0810GB\uff09\uff0c\u5982\u679c\u9700\u8981\u8fd0\u884cHBase\u7684MR\u4efb\u52a1\uff0c\u53ef\u4ee5\u51cf\u5c0f\u6b64\u503c\uff0c\u56e0\u4e3a\u4e00\u4e2aregion\u5bf9\u5e94\u4e00\u4e2amap\u4efb\u52a1\uff0c\u5982\u679c\u5355\u4e2aregion\u8fc7\u5927\uff0c\u4f1a\u5bfc\u81f4map\u4efb\u52a1\u6267\u884c\u65f6\u95f4\u8fc7\u957f\u3002\u8be5\u503c\u7684\u610f\u601d\u5c31\u662f\uff0c\u5982\u679cHFile\u7684\u5927\u5c0f\u8fbe\u5230\u8fd9\u4e2a\u6570\u503c\uff0c\u5219\u8fd9\u4e2aregion\u4f1a\u88ab\u5207\u5206\u4e3a\u4e24\u4e2aHfile\u3002\n</code></pre> <p>5\uff09\u4f18\u5316HBase\u5ba2\u6237\u7aef\u7f13\u5b58 hbase-site.xml<pre><code>\u5c5e\u6027\uff1ahbase.client.write.buffer\n\u89e3\u91ca\uff1a\u9ed8\u8ba4\u503c2097152bytes\uff082M\uff09\u7528\u4e8e\u6307\u5b9aHBase\u5ba2\u6237\u7aef\u7f13\u5b58\uff0c\u589e\u5927\u8be5\u503c\u53ef\u4ee5\u51cf\u5c11RPC\u8c03\u7528\u6b21\u6570\uff0c\u4f46\u662f\u4f1a\u6d88\u8017\u66f4\u591a\u5185\u5b58\uff0c\u53cd\u4e4b\u5219\u53cd\u4e4b\u3002\u4e00\u822c\u6211\u4eec\u9700\u8981\u8bbe\u5b9a\u4e00\u5b9a\u7684\u7f13\u5b58\u5927\u5c0f\uff0c\u4ee5\u8fbe\u5230\u51cf\u5c11RPC\u6b21\u6570\u7684\u76ee\u7684\u3002\n</code></pre></p> <p>6\uff09\u6307\u5b9a scan.next \u626b\u63cf HBase \u6240\u83b7\u53d6\u7684\u884c\u6570</p> hbase-site.xml<pre><code>\u5c5e\u6027\uff1ahbase.client.scanner.caching\n\u89e3\u91ca\uff1a\u7528\u4e8e\u6307\u5b9ascan.next\u65b9\u6cd5\u83b7\u53d6\u7684\u9ed8\u8ba4\u884c\u6570\uff0c\u503c\u8d8a\u5927\uff0c\u6d88\u8017\u5185\u5b58\u8d8a\u5927\u3002\n</code></pre> <p>7\uff09BlockCache \u5360\u7528 RegionServer \u5806\u5185\u5b58\u7684\u6bd4\u4f8b</p> hbase-site.xml<pre><code>\u5c5e\u6027\uff1ahfile.block.cache.size\n\u89e3\u91ca\uff1a\u9ed8\u8ba40.4\uff0c\u8bfb\u8bf7\u6c42\u6bd4\u8f83\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u9002\u5f53\u8c03\u5927\n</code></pre> <p>8\uff09MemStore \u5360\u7528 RegionServer \u5806\u5185\u5b58\u7684\u6bd4\u4f8b</p> hbase-site.xml<pre><code>\u5c5e\u6027\uff1ahbase.regionserver.global.memstore.size\n\u89e3\u91ca\uff1a\u9ed8\u8ba40.4\uff0c\u5199\u8bf7\u6c42\u8f83\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u9002\u5f53\u8c03\u5927\n</code></pre> <p>Lars Hofhansl\uff08\u62c9\u65af\u00b7\u970d\u592b\u6c49\u65af\uff09\u5927\u795e\u63a8\u8350 Region \u8bbe\u7f6e 20G\uff0c\u5237\u5199\u5927\u5c0f\u8bbe\u7f6e 128M\uff0c\u5176\u5b83\u9ed8\u8ba4\u3002</p>"},{"location":"db/hbase/hb_05/#54-jvm","title":"5.4 JVM\u8c03\u4f18","text":"<p>JVM \u8c03\u4f18\u7684\u601d\u8def\u6709\u4e24\u90e8\u5206\uff1a\u4e00\u662f\u5185\u5b58\u8bbe\u7f6e\uff0c\u4e8c\u662f\u5783\u573e\u56de\u6536\u5668\u8bbe\u7f6e\u3002</p> <p>\u200b    \u5783\u573e\u56de\u6536\u7684\u4fee\u6539\u662f\u4f7f\u7528\u5e76\u53d1\u5783\u573e\u56de\u6536\uff0c\u9ed8\u8ba4 PO + PS \u662f\u5e76\u53d1\u5783\u573e\u56de\u6536\u3002\u7406\u7531\u662f HBsae \u5927\u91cf\u4f7f\u7528\u5185\u5b58\u7528\u4e8e\u5b58\u50a8\u6570\u636e\uff0c\u5bb9\u6613\u906d\u9047\u6570\u636e\u6d2a\u5cf0\u9020\u6210 OOM\uff0c\u540c\u65f6\u5199\u7f13\u5b58\u7684\u6570\u636e\u662f\u4e0d\u80fd\u5783\u573e\u56de\u6536\u7684\uff0c\u4e3b\u8981\u56de\u6536\u7684\u5c31\u662f\u8bfb\u7f13\u5b58\uff0c\u800c\u8bfb\u7f13\u5b58\u5783\u573e\u56de\u6536\u4e0d\u5f71\u54cd\u6027\u80fd\uff0c\u6240\u4ee5\u6700\u7ec8\u8bbe\u7f6e\u7684\u6548\u679c\u53ef\u4ee5\u603b\u7ed3\u4e3a\uff1a\u9632\u60a3\u4e8e\u672a\u7136\uff0c\u65e9\u6d17\u65e9\u8f7b\u677e\u3002</p> <p>1\uff09\u8bbe\u7f6e\u4f7f\u7528 CMS \u6536\u96c6\u5668\uff1a</p> <pre><code>-XX:+UseConcMarkSweepGC\n</code></pre> <p>2\uff09\u4fdd\u6301\u65b0\u751f\u4ee3\u5c3d\u91cf\u5c0f\uff0c\u540c\u65f6\u5c3d\u65e9\u5f00\u542f GC\uff0c\u4f8b\u5982\uff1a</p> <pre><code>//\u5728\u5185\u5b58\u5360\u7528\u523070%\u7684\u65f6\u5019\u5f00\u542fGC\n-XX:CMSInitiatingOccupancyFraction=70\n//\u6307\u5b9a\u4f7f\u752870%\uff0c\u4e0d\u8ba9JVM\u52a8\u6001\u8c03\u6574\n-XX:+UseCMSInitiatingOccupancyOnly\n//\u65b0\u751f\u4ee3\u5185\u5b58\u8bbe\u7f6e\u4e3a512m\n-Xmn512m\n//\u5e76\u884c\u6267\u884c\u65b0\u751f\u4ee3\u5783\u573e\u56de\u6536\n-XX:+UseParNewGC\n//\u8bbe\u7f6escanner\u626b\u63cf\u7ed3\u679c\u5360\u7528\u5185\u5b58\u5927\u5c0f\uff0c\u5728hbase-site.xml\u4e2d\uff0c\u8bbe\u7f6ehbase.client.scanner.max.result.size(\u9ed8\u8ba4\u503c\u4e3a2M)\u4e3a eden \u7a7a\u95f4\u7684 1/8 \uff08\u5927\u6982\u572864M\uff09\n\n// \u8bbe\u7f6e\u591a\u4e2a\u4e0emax.result.size * handler.count \u76f8\u4e58\u7684\u7ed3\u679c\u5c0f\u4e8eSurvivor Space(\u65b0\u751f\u4ee3\u7ecf\u8fc7\u5783\u573e\u56de\u6536\u4e4b\u540e\u5b58\u6d3b\u7684\u5bf9\u8c61)\n</code></pre>"},{"location":"db/hbase/hb_05/#55-hbase","title":"5.5 HBase\u4f7f\u7528\u7ecf\u9a8c\u6cd5\u5219","text":"<p>\u5b98\u65b9\u7ed9\u51fa\u4e86\u6743\u5a01\u7684\u4f7f\u7528\u6cd5\u5219\uff1a</p> <ol> <li>Region \u5927\u5c0f\u63a7\u5236 10 - 50G</li> <li>Cell \u5927\u5c0f\u4e0d\u8d85\u8fc7 10M\uff08\u6027\u80fd\u5bf9\u5e94\u5c0f\u4e8e 100K \u7684\u503c\u6709\u4f18\u5316\uff09\uff0c\u5982\u679c\u4f7f\u7528 mob\uff08 Medium-sized Objects \u4e00\u79cd\u7279\u6b8a\u7528\u6cd5\uff09\u5219\u4e0d\u8d85\u8fc7 50M</li> <li>1 \u5f20\u8868\u6709 1 \u5230 3 \u4e2a\u5217\u65cf\uff0c\u4e0d\u8981\u8bbe\u8ba1\u592a\u591a\u3002\u6700\u597d\u5c31 1 \u4e2a\uff0c\u5982\u679c\u4f7f\u7528\u591a\u4e2a\u5c3d\u91cf\u4fdd\u8bc1\u4e0d\u4f1a\u540c\u65f6\u8bfb\u53d6\u591a\u4e2a\u5217\u65cf</li> <li>1 \u5230 2 \u4e2a\u5217\u65cf\u7684\u8868\u683c\uff0c\u8bbe\u8ba1 50 - 100 \u4e2a Region</li> <li>\u5217\u65cf\u540d\u79f0\u8981\u5c3d\u91cf\u77ed\uff0c\u4e0d\u8981\u53bb\u6a21\u4eff RDBMS\uff08\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff09\u5177\u6709\u51c6\u786e\u7684\u540d\u79f0\u548c\u63cf\u8ff0</li> <li>\u5982\u679c RowKey \u8bbe\u8ba1\u65f6\u95f4\u5728\u6700\u524d\u9762\uff0c\u4f1a\u5bfc\u81f4\u6709\u5927\u91cf\u7684\u65e7\u6570\u636e\u5b58\u50a8\u5728\u4e0d\u6d3b\u8dc3\u7684 Region \u4e2d\uff0c\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u4ec5\u4ec5\u4f1a\u64cd\u4f5c\u5c11\u6570\u7684\u6d3b\u52a8 Region\uff0c\u6b64\u65f6\u5efa\u8bae\u589e\u52a0\u66f4\u591a\u7684 Region \u4e2a\u6570</li> <li>\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u5217\u65cf\u7528\u4e8e\u5199\u5165\u6570\u636e\uff0c\u5206\u914d\u5185\u5b58\u8d44\u6e90\u7684\u65f6\u5019\u53ef\u4ee5\u505a\u51fa\u8c03\u6574\uff0c\u5373\u5199\u7f13\u5b58\u4e0d\u4f1a\u5360\u7528\u592a\u591a\u7684\u5185\u5b58</li> </ol>"},{"location":"db/hbase/hb_06/","title":"\u7b2c6\u7ae0 \u6574\u5408Phoenix","text":""},{"location":"db/hbase/hb_06/#61-phoenix","title":"6.1 Phoenix\u7b80\u4ecb","text":""},{"location":"db/hbase/hb_06/#611-phoenix","title":"6.1.1 Phoenix\u5b9a\u4e49","text":"<p>Phoenix \u662f HBase \u7684\u5f00\u6e90 SQL \u76ae\u80a4\u3002\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6 JDBC API \u4ee3\u66ff HBase \u5ba2\u6237\u7aef API \u6765\u521b\u5efa\u8868\uff0c\u63d2\u5165\u6570\u636e\u548c\u67e5\u8be2 HBase \u6570\u636e\u3002</p>"},{"location":"db/hbase/hb_06/#612-phoenix","title":"6.1.2 \u4e3a\u4ec0\u4e48\u4f7f\u7528Phoenix","text":"<p>\u5b98\u65b9\u7ed9\u7684\u89e3\u91ca\u4e3a\uff1a\u5728 Client \u548c HBase \u4e4b\u95f4\u653e\u4e00\u4e2a Phoenix \u4e2d\u95f4\u5c42\u4e0d\u4f1a\u51cf\u6162\u901f\u5ea6\uff0c\u56e0\u4e3a\u7528\u6237\u7f16\u5199\u7684\u6570\u636e\u5904\u7406\u4ee3\u7801\u548c Phoenix \u7f16\u5199\u7684\u6ca1\u6709\u533a\u522b\uff08\u66f4\u4e0d\u7528\u8bf4\u4f60\u5199\u7684\u5783\u573e\u7684\u591a\uff09\uff0c\u4e0d\u4ec5\u5982\u6b64 Phoenix \u5bf9\u4e8e\u7528\u6237\u8f93\u5165\u7684 SQL \u540c\u6837\u4f1a\u6709\u5927\u91cf\u7684\u4f18\u5316\u624b\u6bb5\uff08\u5c31\u50cf Hive \u81ea\u5e26 SQL \u4f18\u5316\u5668\u4e00\u6837\uff09\u3002</p> <p>Phoenix \u5728 5.0 \u7248\u672c\u9ed8\u8ba4\u63d0\u4f9b\u6709\u4e24\u79cd\u5ba2\u6237\u7aef\u4f7f\u7528\uff08\u7626\u5ba2\u6237\u7aef\u548c\u80d6\u5ba2\u6237\u7aef\uff09\uff0c\u5728 5.1.2 \u7248\u672c\u5b89\u88c5\u5305\u4e2d\u5220\u9664\u4e86\u7626\u5ba2\u6237\u7aef\uff0c\u672c\u6587\u4e5f\u4e0d\u518d\u4f7f\u7528\u7626\u5ba2\u6237\u7aef\u3002\u800c\u80d6\u5ba2\u6237\u7aef\u548c\u7528\u6237\u81ea\u5df1\u5199 HBase \u7684 API \u4ee3\u7801\u8bfb\u53d6\u6570\u636e\u4e4b\u540e\u8fdb\u884c\u6570\u636e\u5904\u7406\u662f\u5b8c\u5168\u4e00\u6837\u7684\u3002</p>"},{"location":"db/hbase/hb_06/#62-phoenix","title":"6.2 Phoenix\u5feb\u901f\u5165\u95e8","text":""},{"location":"db/hbase/hb_06/#621","title":"6.2.1 \u5b89\u88c5","text":"<p>1\uff09\u5b98\u7f51\u5730\u5740</p> <p>2\uff09Phoenix\u90e8\u7f72</p> <p>\uff081\uff09\u4e0a\u4f20\u5e76\u89e3\u538btar\u5305</p> <pre><code>tar -zxvf phoenix-hbase-2.4-5.1.2-bin.tar.gz -C /opt/module/\n\nmv phoenix-hbase-2.4-5.1.2-bin/ phoenix\n</code></pre> <p>\uff082\uff09\u590d\u5236 server \u5305\u5e76\u62f7\u8d1d\u5230\u5404\u4e2a\u8282\u70b9\u7684 hbase/lib</p> <pre><code>cd /opt/module/phoenix/\n\ncp phoenix-server-hbase-2.4-5.1.2.jar /opt/module/hbase/lib/\n\nxsync /opt/module/hbase/lib/phoenix-server-hbase-2.4-5.1.2.jar\n</code></pre> <p>\uff083\uff09\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> my_env.sh<pre><code>#phoenix\nexport PHOENIX_HOME=/opt/module/phoenix\nexport PHOENIX_CLASSPATH=$PHOENIX_HOME\nexport PATH=$PATH:$PHOENIX_HOME/bin\n</code></pre> <p>\uff084\uff09\u91cd\u542fHBase</p> <pre><code>stop-hbase.sh\nstart-hbase.sh\n</code></pre> <p>\uff085\uff09\u8fde\u63a5Phoenix</p> <pre><code>/opt/module/phoenix/bin/sqlline.py hadoop102,hadoop103,hadoop104:2181\n</code></pre> <p>\uff086\uff09\u9519\u8bef\u89e3\u51b3</p> <p>\u51fa\u73b0\u4e0b\u9762\u9519\u8bef\u7684\u539f\u56e0\u662f\u4e4b\u524d\u4f7f\u7528\u8fc7 Phoenix\uff0c\u5efa\u8bae\u5220\u9664\u4e4b\u524d\u7684\u8bb0\u5f55\u3002</p> <pre><code>\u8b66\u544a: Failed to load history\njava.lang.IllegalArgumentException: Bad history file syntax! The history file `/home/atguigu/.sqlline/history` may be an older history: please remove it or use a different history file.\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a\u5728 /home/atguigu \u76ee\u5f55\u4e0b\u5220\u9664 .sqlline \u6587\u4ef6\u5939\u3002</p> <pre><code>rm -rf .sqlline/\n</code></pre>"},{"location":"db/hbase/hb_06/#622-phoenix-shell","title":"6.2.2 Phoenix Shell\u64cd\u4f5c","text":""},{"location":"db/hbase/hb_06/#6221-table","title":"6.2.2.1 table","text":"<p>\u5173\u4e8e Phoenix \u7684\u8bed\u6cd5\u5efa\u8bae\u4f7f\u7528\u65f6\u76f4\u63a5\u67e5\u770b\u5b98\u7f51</p> <p>1\uff09\u663e\u793a\u6240\u6709\u8868</p> <pre><code>Show tables;\n</code></pre> <p>2\uff09\u521b\u5efa\u8868 \u76f4\u63a5\u6307\u5b9a\u5355\u4e2a\u5217\u4f5c\u4e3a RowKey\u3002</p> <pre><code>CREATE TABLE IF NOT EXISTS student(\nid VARCHAR primary key,\nname VARCHAR,\nage BIGINT,\naddr VARCHAR);\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5728 Phoenix\u4e2d\uff0c\u8868\u540d\u7b49\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a\u5927\u5199\uff0c\u82e5\u8981\u5c0f\u5199\uff0c\u4f7f\u7528\u53cc\u5f15\u53f7\uff0c\u5982 <code>us_population</code>\u3002</p> <p>\u6307\u5b9a\u591a\u4e2a\u5217\u7684\u8054\u5408\u4f5c\u4e3a RowKey\u3002</p> <pre><code>CREATE TABLE IF NOT EXISTS student1 (\nid VARCHAR NOT NULL,\nname VARCHAR NOT NULL,\nage BIGINT,\naddr VARCHAR CONSTRAINT my_pk PRIMARY KEY (id, name));\n</code></pre> <p>\u6ce8</p> <p>Phoenix \u4e2d\u5efa\u8868\uff0c\u4f1a\u5728 HBase \u4e2d\u521b\u5efa\u4e00\u5f20\u5bf9\u5e94\u7684\u8868\u3002\u4e3a\u4e86\u51cf\u5c11\u6570\u636e\u5bf9\u78c1\u76d8\u7a7a\u95f4\u7684\u5360\u7528\uff0cPhoenix \u9ed8\u8ba4\u4f1a\u5bf9 HBase \u4e2d\u7684\u5217\u540d\u505a\u7f16\u7801\u5904\u7406\u3002\u5177\u4f53\u89c4\u5219\u53ef\u53c2\u8003\u5b98\u7f51\uff0c\u82e5\u4e0d\u60f3\u5bf9\u5217\u540d\u7f16\u7801\uff0c\u53ef\u5728\u5efa\u8868\u8bed\u53e5\u672b\u5c3e\u52a0\u4e0a<code>COLUMN_ENCODED_BYTES = 0;</code></p> <p>3\uff09\u63d2\u5165\u6570\u636e</p> <pre><code>upsert into student values('1001','zhangsan', 10, 'beijing');\n</code></pre> <p>4\uff09\u67e5\u8be2\u8bb0\u5f55</p> <pre><code>select * from student;\nselect * from student where id='1001';\n</code></pre> <p>5\uff09\u5220\u9664\u8bb0\u5f55</p> <pre><code>delete from student where id='1001';\n</code></pre> <p>6\uff09\u5220\u9664\u8868</p> <pre><code>drop table student;\n</code></pre> <p>7\uff09\u9000\u51fa\u547d\u4ee4\u884c</p> <pre><code>!quit\n</code></pre>"},{"location":"db/hbase/hb_06/#6222","title":"6.2.2.2 \u8868\u7684\u6620\u5c04","text":"<p>1\uff09\u8868\u7684\u5173\u7cfb</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c HBase \u4e2d\u5df2\u5b58\u5728\u7684\u8868\uff0c\u901a\u8fc7 Phoenix \u662f\u4e0d\u53ef\u89c1\u7684\u3002\u5982\u679c\u8981\u5728 Phoenix \u4e2d\u64cd\u4f5c HBase \u4e2d\u5df2\u5b58\u5728\u7684\u8868\uff0c\u53ef\u4ee5\u5728 Phoenix \u4e2d\u8fdb\u884c\u8868\u7684\u6620\u5c04\u3002\u6620\u5c04\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a\u89c6\u56fe\u6620\u5c04\u548c\u8868\u6620\u5c04\u3002</p> <p>2\uff09\u547d\u4ee4\u884c\u4e2d\u521b\u5efa\u8868 test</p> <p>HBase \u4e2d test \u7684\u8868\u7ed3\u6784\u5982\u4e0b\uff0c\u4e24\u4e2a\u5217\u65cf info1\u3001info2\u3002</p> Rowkey info1 info2 id name address <p>\uff081\uff09\u542f\u52a8 HBase Shell</p> <pre><code>/opt/module/hbase/bin/hbase shell\n</code></pre> <p>\uff082\uff09\u521b\u5efa HBase \u8868 test</p> <pre><code>create 'test','info1','info2'\n</code></pre> <p>3\uff09\u89c6\u56fe\u6620\u5c04</p> <p>Phoenix \u521b\u5efa\u7684\u89c6\u56fe\u662f\u53ea\u8bfb\u7684\uff0c\u6240\u4ee5\u53ea\u80fd\u7528\u6765\u505a\u67e5\u8be2\uff0c\u65e0\u6cd5\u901a\u8fc7\u89c6\u56fe\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\u7b49\u64cd\u4f5c\u3002\u5728 Phoenix \u4e2d\u521b\u5efa\u5173\u8054 test \u8868\u7684\u89c6\u56fe\u3002</p> <pre><code> create view \"test\"(id varchar primary key,\"info1\".\"name\" varchar, \"info2\".\"address\" varchar);\n</code></pre> <p>\u5220\u9664\u89c6\u56fe</p> <pre><code>drop view \"test\";\n</code></pre> <p>4\uff09\u8868\u6620\u5c04</p> <p>\u5728 Pheonix \u521b\u5efa\u8868\u53bb\u6620\u5c04 HBase \u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u8868\uff0c\u662f\u53ef\u4ee5\u4fee\u6539\u5220\u9664 HBase \u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u6570\u636e\u7684\u3002\u800c\u4e14\uff0c\u5220\u9664 Phoenix \u4e2d\u7684\u8868\uff0c\u90a3\u4e48 HBase \u4e2d\u88ab\u6620\u5c04\u7684\u8868\u4e5f\u4f1a\u88ab\u5220\u9664\u3002</p> <p>\u6ce8</p> <p>\u8fdb\u884c\u8868\u6620\u5c04\u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528\u5217\u540d\u7f16\u7801\uff0c\u9700\u5c06 <code>column_encoded_bytes</code> \u8bbe\u4e3a 0\u3002</p> <pre><code>create table \"test\"(id varchar primary key,\"info1\".\"name\" varchar, \"info2\".\"address\" varchar) column_encoded_bytes=0;\n</code></pre>"},{"location":"db/hbase/hb_06/#6223","title":"6.2.2.3 \u6570\u5b57\u7c7b\u578b\u8bf4\u660e","text":"<p>HBase \u4e2d\u7684\u6570\u5b57\uff0c\u5e95\u5c42\u5b58\u50a8\u4e3a\u8865\u7801\uff0c\u800c Phoenix \u4e2d\u7684\u6570\u5b57\uff0c\u5e95\u5c42\u5b58\u50a8\u4e3a\u5728\u8865\u7801\u7684\u57fa\u7840\u4e0a\uff0c\u5c06\u7b26\u53f7\u4f4d\u53cd\u8f6c\u3002\u6545\u5f53\u5728 Phoenix \u4e2d\u5efa\u8868\u53bb\u6620\u5c04 HBase \u4e2d\u5df2\u5b58\u5728\u7684\u8868\uff0c\u5f53 HBase \u4e2d\u6709\u6570\u5b57\u7c7b\u578b\u7684\u5b57\u6bb5\u65f6\uff0c\u4f1a\u51fa\u73b0\u89e3\u6790\u9519\u8bef\u7684\u73b0\u8c61\u3002</p> HbasePhoenix <pre><code>create 'test_number','info'\nput 'test_number','1001','info:number',Bytes.toBytes(1000)\nscan 'test_number',{COLUMNS =&gt; 'info:number:toLong'}\n</code></pre> <pre><code>create view \"test_number\"(id varchar primary key,\"info\".\"number\" bigint);\nselect * from \"test_number\";\n</code></pre> <p>\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u7684\u65b9\u6848\u6709\u4ee5\u4e0b\u4e24\u79cd\uff1a</p> <p>\uff081\uff09Phoenix \u4e2d\u63d0\u4f9b\u4e86 unsigned_int\uff0cunsigned_long \u7b49\u65e0\u7b26\u53f7\u7c7b\u578b\uff0c\u5176\u5bf9\u6570\u5b57\u7684\u7f16\u7801\u89e3\u7801\u65b9\u5f0f\u548c HBase \u662f\u76f8\u540c\u7684\uff0c\u5982\u679c\u65e0\u9700\u8003\u8651\u8d1f\u6570\uff0c\u90a3\u5728 Phoenix \u4e2d\u5efa\u8868\u65f6\u91c7\u7528\u65e0\u7b26\u53f7\u7c7b\u578b\u662f\u6700\u5408\u9002\u7684\u9009\u62e9\u3002 Phoenix \u6f14\u793a\uff1a</p> <pre><code>drop view \"test_number\";\ncreate view \"test_number\"(id varchar primary key,\"info\".\"number\" unsigned_long);\nselect * from \"test_number\";\n</code></pre> <p>\uff082\uff09\u5982\u9700\u8003\u8651\u8d1f\u6570\u7684\u60c5\u51b5\uff0c\u5219\u53ef\u901a\u8fc7 Phoenix \u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u5c06\u6570\u5b57\u7c7b\u578b\u7684\u6700\u9ad8\u4f4d\uff0c\u5373\u7b26\u53f7\u4f4d\u53cd\u8f6c\u5373\u53ef\uff0c\u81ea\u5b9a\u4e49\u51fd\u6570\u53ef\u53c2\u8003\u5982\u4e0b\u94fe\u63a5</p>"},{"location":"db/hbase/hb_06/#623-phoenix-jdbc","title":"6.2.3 Phoenix JDBC\u64cd\u4f5c","text":"<p>\u6b64\u5904\u6f14\u793a\u4e00\u4e2a\u6807\u51c6\u7684 JDBC \u8fde\u63a5\u64cd\u4f5c\uff0c\u5b9e\u9645\u5f00\u53d1\u4e2d\u4f1a\u76f4\u63a5\u4f7f\u7528\u522b\u7684\u6846\u67b6\u5185\u5d4c\u7684 Phoenix \u8fde\u63a5\u3002</p> <p>1\uff09\u80d6\u5ba2\u6237\u7aef</p> <p>\uff081\uff09maven\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.phoenix&lt;/groupId&gt;\n&lt;artifactId&gt;phoenix-client-hbase-2.4&lt;/artifactId&gt;\n&lt;version&gt;5.1.2&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>\uff082\uff09\u7f16\u5199\u4ee3\u7801</p> <pre><code>package com.atguigu.phoenix;\n\nimport java.sql.*;\nimport java.util.Properties;\n\npublic class PhoenixClient {\npublic static void main(String[] args) throws SQLException {\n// \u6807\u51c6\u7684JDBC\u4ee3\u7801\n// 1.\u6dfb\u52a0\u94fe\u63a5\nString url = \"jdbc:phoenix:hadoop102,hadoop103,hadoop104:2181\";\n\n// 2. \u521b\u5efa\u914d\u7f6e\n// \u6ca1\u6709\u9700\u8981\u6dfb\u52a0\u7684\u5fc5\u8981\u914d\u7f6e  \u56e0\u4e3aPhoenix\u6ca1\u6709\u8d26\u53f7\u5bc6\u7801\nProperties properties = new Properties();\n\n// 3. \u83b7\u53d6\u8fde\u63a5\nConnection connection = DriverManager.getConnection(url, properties);\n// 4.\u7f16\u8bd1SQL\u8bed\u53e5\nPreparedStatement preparedStatement = connection.prepareStatement(\"select * from student\");\n// 5.\u6267\u884c\u8bed\u53e5\nResultSet resultSet = preparedStatement.executeQuery();\n// 6.\u8f93\u51fa\u7ed3\u679c\nwhile (resultSet.next()){\nSystem.out.println(resultSet.getString(1) + \":\" + resultSet.getString(2) + \":\" + resultSet.getString(3));\n}\n\n// 7.\u5173\u95ed\u8d44\u6e90\nconnection.close();\n\n// \u7531\u4e8ePhoenix\u6846\u67b6\u5185\u90e8\u9700\u8981\u83b7\u53d6\u4e00\u4e2aHBase\u8fde\u63a5,\u6240\u4ee5\u4f1a\u5ef6\u8fdf\u5173\u95ed\n// \u4e0d\u5f71\u54cd\u540e\u7eed\u7684\u4ee3\u7801\u6267\u884c\nSystem.out.println(\"hello\");\n}\n}\n</code></pre>"},{"location":"db/hbase/hb_06/#63-phoenix","title":"6.3 Phoenix\u4e8c\u7ea7\u7d22\u5f15","text":""},{"location":"db/hbase/hb_06/#631","title":"6.3.1 \u4e8c\u7ea7\u7d22\u5f15\u914d\u7f6e\u6587\u4ef6","text":"<p>\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u5230 HBase \u7684 HRegionserver \u8282\u70b9\u7684 hbase-site.xml\u3002</p> hbase-site.xml<pre><code>&lt;!-- phoenix regionserver \u914d\u7f6e\u53c2\u6570--&gt;\n&lt;property&gt;\n&lt;name&gt;hbase.regionserver.wal.codec&lt;/name&gt;\n&lt;value&gt;org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"db/hbase/hb_06/#632-global-index","title":"6.3.2 \u5168\u5c40\u7d22\u5f15\uff08global index\uff09","text":"<p>Global Index \u662f\u9ed8\u8ba4\u7684\u7d22\u5f15\u683c\u5f0f\uff0c\u521b\u5efa\u5168\u5c40\u7d22\u5f15\u65f6\uff0c\u4f1a\u5728 HBase \u4e2d\u5efa\u7acb\u4e00\u5f20\u65b0\u8868\u3002\u4e5f\u5c31\u662f\u8bf4\u7d22\u5f15\u6570\u636e\u548c\u6570\u636e\u8868\u662f\u5b58\u653e\u5728\u4e0d\u540c\u7684\u8868\u4e2d\u7684\uff0c\u56e0\u6b64\u5168\u5c40\u7d22\u5f15\u9002\u7528\u4e8e\u591a\u8bfb\u5c11\u5199\u7684\u4e1a\u52a1\u573a\u666f\u3002</p> <p>\u5199\u6570\u636e\u7684\u65f6\u5019\u4f1a\u6d88\u8017\u5927\u91cf\u5f00\u9500\uff0c\u56e0\u4e3a\u7d22\u5f15\u8868\u4e5f\u8981\u66f4\u65b0\uff0c\u800c\u7d22\u5f15\u8868\u662f\u5206\u5e03\u5728\u4e0d\u540c\u7684\u6570\u636e\u8282\u70b9\u4e0a\u7684\uff0c\u8de8\u8282\u70b9\u7684\u6570\u636e\u4f20\u8f93\u5e26\u6765\u4e86\u8f83\u5927\u7684\u6027\u80fd\u6d88\u8017\u3002</p> <p>\u5728\u8bfb\u6570\u636e\u7684\u65f6\u5019 Phoenix \u4f1a\u9009\u62e9\u7d22\u5f15\u8868\u6765\u964d\u4f4e\u67e5\u8be2\u6d88\u8017\u7684\u65f6\u95f4\u3002</p> <p>\u521b\u5efa\u5355\u4e2a\u5b57\u6bb5\u7684\u5168\u5c40\u7d22\u5f15\u3002</p> <pre><code>CREATE INDEX my_index ON my_table (my_col);\n#\u4f8b\u5982\ncreate index my_index on student1(age);\n\n#\u5220\u9664\u7d22\u5f15\nDROP INDEX my_index ON my_table\ndrop index my_index on student1;\n</code></pre> <p>\u67e5\u770b\u4e8c\u7ea7\u7d22\u5f15\u662f\u5426\u6709\u6548\uff0c\u53ef\u4ee5\u4f7f\u7528 explainPlan \u6267\u884c\u8ba1\u5212\uff0c\u6709\u4e8c\u7ea7\u7d22\u5f15\u4e4b\u540e\u4f1a\u53d8\u6210\u8303\u56f4\u626b\u63cf\u3002</p> <pre><code>$ explain select id,name from student1 where age = 10;\n\n+-------------------------------------------------------------------------+----------------+---------------+---------+\n|                                  PLAN                                   | EST_BYTES_READ | EST_ROWS_READ | EST_INF |\n+-------------------------------------------------------------------------+----------------+---------------+---------+\n| CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER MY_INDEX [10] | null           | null          | null    |\n|     SERVER FILTER BY FIRST KEY ONLY                                     | null           | null          | null    |\n+-------------------------------------------------------------------------+----------------+---------------+---------+\n2 rows selected (0.044 seconds)\n</code></pre> <p>\u5982\u679c\u60f3\u67e5\u8be2\u7684\u5b57\u6bb5\u4e0d\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u8bdd\u7d22\u5f15\u8868\u4e0d\u4f1a\u88ab\u4f7f\u7528\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u4f1a\u5e26\u6765\u67e5\u8be2\u901f\u5ea6\u7684\u63d0\u5347\u3002</p> <pre><code>$ explain select id,name,addr from student1 where age = 10;\n\n+-------------------------------------------------------------------+----------------+---------------+-------------+\n|                               PLAN                                | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |\n+-------------------------------------------------------------------+----------------+---------------+-------------+\n| CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER STUDENT1 | null           | null          | null        |\n|     SERVER FILTER BY AGE = 10                                     | null           | null          | null        |\n+-------------------------------------------------------------------+----------------+---------------+-------------+\n2 rows selected (0.024 seconds)\n</code></pre> <p>\u82e5\u60f3\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u53ef\u91c7\u7528\u5982\u4e0b\u65b9\u6848\uff1a 1. \u4f7f\u7528\u5305\u542b\u7d22\u5f15 2. \u4f7f\u7528\u672c\u5730\u7d22\u5f15</p>"},{"location":"db/hbase/hb_06/#633-covered-index","title":"6.3.3 \u5305\u542b\u7d22\u5f15\uff08covered index\uff09","text":"<p>\u521b\u5efa\u643a\u5e26\u5176\u4ed6\u5b57\u6bb5\u7684\u5168\u5c40\u7d22\u5f15\uff08\u672c\u8d28\u8fd8\u662f\u5168\u5c40\u7d22\u5f15\uff09\u3002</p> <pre><code>CREATE INDEX my_index ON my_table (v1) INCLUDE (v2);\n</code></pre> <p>\u5148\u5220\u9664\u4e4b\u524d\u7684\u7d22\u5f15\uff1a</p> <pre><code>drop index my_index on student1;\n#\u521b\u5efa\u5305\u542b\u7d22\u5f15\ncreate index my_index on student1(age) include (addr);\n</code></pre> <p>\u4e4b\u540e\u4f7f\u7528\u6267\u884c\u8ba1\u5212\u67e5\u770b\u6548\u679c</p> <p>\u5982\u679c\u60f3\u67e5\u8be2\u7684\u5b57\u6bb5\u4e0d\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u8bdd\u7d22\u5f15\u8868\u4e0d\u4f1a\u88ab\u4f7f\u7528\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u4f1a\u5e26\u6765\u67e5\u8be2\u901f\u5ea6\u7684\u63d0\u5347\u3002</p> <pre><code>$ explain select id,name,addr from student1 where age = 10;\n\n+-------------------------------------------------------------------------+----------------+---------------+---------+\n|                                  PLAN                                   | EST_BYTES_READ | EST_ROWS_READ | EST_INF |\n+-------------------------------------------------------------------------+----------------+---------------+---------+\n| CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER MY_INDEX [10] | null           | null          | null    |\n+-------------------------------------------------------------------------+----------------+---------------+---------+\n1 row selected (0.112 seconds)\n</code></pre>"},{"location":"db/hbase/hb_06/#634-local-index","title":"6.3.4 \u672c\u5730\u7d22\u5f15\uff08local index\uff09","text":"<p>Local Index \u9002\u7528\u4e8e\u5199\u64cd\u4f5c\u9891\u7e41\u7684\u573a\u666f\u3002</p> <p>\u7d22\u5f15\u6570\u636e\u548c\u6570\u636e\u8868\u7684\u6570\u636e\u662f\u5b58\u653e\u5728\u540c\u4e00\u5f20\u8868\u4e2d\uff08\u4e14\u662f\u540c\u4e00\u4e2a Regio n\uff09\uff0c\u907f\u514d\u4e86\u5728\u5199\u64cd\u4f5c\u7684\u65f6\u5019\u5f80\u4e0d\u540c\u670d\u52a1\u5668\u7684\u7d22\u5f15\u8868\u4e2d\u5199\u7d22\u5f15\u5e26\u6765\u7684\u989d\u5916\u5f00\u9500\u3002</p> <p>my_column\u53ef\u4ee5\u662f\u591a\u4e2a\u3002</p> <pre><code>CREATE LOCAL INDEX my_index ON my_table (my_column);\n</code></pre> <p>\u672c\u5730\u7d22\u5f15\u4f1a\u5c06\u6240\u6709\u7684\u4fe1\u606f\u5b58\u5728\u4e00\u4e2a\u5f71\u5b50\u5217\u65cf\u4e2d\uff0c\u867d\u7136\u8bfb\u53d6\u7684\u65f6\u5019\u4e5f\u662f\u8303\u56f4\u626b\u63cf\uff0c\u4f46\u662f\u6ca1\u6709\u5168\u5c40\u7d22\u5f15\u5feb\uff0c\u4f18\u70b9\u5728\u4e8e\u4e0d\u7528\u5199\u591a\u4e2a\u8868\u4e86\u3002</p> <pre><code>#\u5220\u9664\u4e4b\u524d\u7684\u7d22\u5f15\n\n$ drop index my_index on student1;\n\nCREATE LOCAL INDEX my_index ON student1 (age,addr);\n\n#\u4f7f\u7528\u6267\u884c\u8ba1\u5212\n\n$ explain select id,name,addr from student1 where age = 10;\n\n+---------------------------------------------------------------------------+----------------+---------------+-------+\n|                                   PLAN                                    | EST_BYTES_READ | EST_ROWS_READ | EST_I |\n+---------------------------------------------------------------------------+----------------+---------------+-------+\n| CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER STUDENT1 [2,10] | null           | null          | null  |\n|     SERVER MERGE [0.ADDR]                                                 | null           | null          | null  |\n|     SERVER FILTER BY FIRST KEY ONLY                                       | null           | null          | null  |\n+---------------------------------------------------------------------------+----------------+---------------+-------+\n3 rows selected (0.025 seconds)\n</code></pre>"},{"location":"db/hbase/hb_07/","title":"\u7b2c 7 \u7ae0 \u4e0eHive\u7684\u96c6\u6210","text":""},{"location":"db/hbase/hb_07/#71","title":"7.1 \u4f7f\u7528\u573a\u666f","text":"<p>\u5982\u679c\u5927\u91cf\u7684\u6570\u636e\u5df2\u7ecf\u5b58\u653e\u5728 HBase \u4e0a\u9762\uff0c\u9700\u8981\u5bf9\u5df2\u7ecf\u5b58\u5728\u7684\u6570\u636e\u8fdb\u884c\u6570\u636e\u5206\u6790\u5904\u7406\uff0c\u90a3\u4e48 Phoenix \u5e76\u4e0d\u9002\u5408\u505a\u7279\u522b\u590d\u6742\u7684 SQL \u5904\u7406\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528 Hive \u6620\u5c04 HBase \u7684\u8868\u683c\uff0c\u4e4b\u540e\u5199 HQL \u8fdb\u884c\u5206\u6790\u5904\u7406\u3002</p>"},{"location":"db/hbase/hb_07/#72-hbase-hive","title":"7.2 HBase \u4e0e Hive \u96c6\u6210\u4f7f\u7528","text":"<p>\u5728 hive-site.xml \u4e2d\u6dfb\u52a0 zookeeper \u7684\u5c5e\u6027\uff0c\u5982\u4e0b\uff1a</p> hive-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;hive.zookeeper.quorum&lt;/name&gt;\n&lt;value&gt;hadoop102,hadoop103,hadoop104&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n&lt;name&gt;hive.zookeeper.client.port&lt;/name&gt;\n&lt;value&gt;2181&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>1\uff09\u6848\u4f8b\u4e00</p> <p>\u76ee\u6807\uff1a\u5efa\u7acb Hive \u8868\uff0c\u5173\u8054 HBase \u8868\uff0c\u63d2\u5165\u6570\u636e\u5230 Hive \u8868\u7684\u540c\u65f6\u80fd\u591f\u5f71\u54cd HBase \u8868\u3002</p> <p>\u5206\u6b65\u5b9e\u73b0\uff1a</p> <p>\uff081\uff09\u5728 Hive \u4e2d\u521b\u5efa\u8868\u540c\u65f6\u5173\u8054 HBase</p> <pre><code>CREATE TABLE hive_hbase_emp_table(\nempno int,\nename string,\njob string,\nmgr int,\nhiredate string,\nsal double,\ncomm double,\ndeptno int\n)STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'\nWITH SERDEPROPERTIES(\"hbase.columns.mapping\"=\":key,info:ename,info:job,info:mgr,info:hiredate,info:sal,info:comm,info:deptno\")\nTBLPROPERTIES (\"hbase.table.name\" = \"hbase_emp_table\");\n</code></pre> <p>\u63d0\u793a\uff1a\u5b8c\u6210\u4e4b\u540e\uff0c\u53ef\u4ee5\u5206\u522b\u8fdb\u5165 Hive \u548c HBase \u67e5\u770b\uff0c\u90fd\u751f\u6210\u4e86\u5bf9\u5e94\u7684\u8868\u3002</p> <p>\uff082\uff09\u5728 Hive \u4e2d\u521b\u5efa\u4e34\u65f6\u4e2d\u95f4\u8868\uff0c\u7528\u4e8e load \u6587\u4ef6\u4e2d\u7684\u6570\u636e</p> <p>\u63d0\u793a\uff1a\u4e0d\u80fd\u5c06\u6570\u636e\u76f4\u63a5 load \u8fdb Hive \u6240\u5173\u8054 HBase \u7684\u90a3\u5f20\u8868\u4e2d\u3002</p> <pre><code>CREATE TABLE emp(\nempno int,\nename string,\njob string,\nmgr int,\nhiredate string,\nsal double,\ncomm double,\ndeptno int\n)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>\uff083\uff09\u5411 Hive \u4e2d\u95f4\u8868\u4e2d load \u6570\u636e</p> <pre><code>load data local inpath '/opt/software/emp.txt' into table emp;\n</code></pre> <p>\uff084\uff09\u901a\u8fc7 insert \u547d\u4ee4\u5c06\u4e2d\u95f4\u8868\u4e2d\u7684\u6570\u636e\u5bfc\u5165\u5230 Hive \u5173\u8054 Hbase \u7684\u90a3\u5f20\u8868\u4e2d</p> <pre><code>insert into table hive_hbase_emp_table select * from emp;\n</code></pre> <p>\uff085\uff09\u67e5\u770b Hive \u4ee5\u53ca\u5173\u8054\u7684 HBase \u8868\u4e2d\u662f\u5426\u5df2\u7ecf\u6210\u529f\u7684\u540c\u6b65\u63d2\u5165\u4e86\u6570\u636e</p> <p>Hive\uff1a</p> <pre><code>select * from hive_hbase_emp_table;\n</code></pre> <p>HBase\uff1a</p> <pre><code>scan 'hbase_emp_table'\n</code></pre> <p>2\uff09\u6848\u4f8b\u4e8c</p> <p>\u76ee\u6807\uff1a\u5728 HBase \u4e2d\u5df2\u7ecf\u5b58\u50a8\u4e86\u67d0\u4e00\u5f20\u8868 hbase_emp_table\uff0c\u7136\u540e\u5728 Hive \u4e2d\u521b\u5efa\u4e00\u4e2a\u5916\u90e8\u8868\u6765\u5173\u8054 HBase \u4e2d\u7684 hbase_emp_table \u8fd9\u5f20\u8868\uff0c\u4f7f\u4e4b\u53ef\u4ee5\u501f\u52a9 Hive \u6765\u5206\u6790 HBase \u8fd9\u5f20\u8868\u4e2d\u7684\u6570\u636e\u3002</p> <p>\u6ce8</p> <p>\u8be5\u6848\u4f8b 2 \u7d27\u8ddf\u6848\u4f8b 1 \u7684\u811a\u6b65\uff0c\u6240\u4ee5\u5b8c\u6210\u6b64\u6848\u4f8b\u524d\uff0c\u8bf7\u5148\u5b8c\u6210\u6848\u4f8b 1\u3002</p> <p>\u5206\u6b65\u5b9e\u73b0\uff1a</p> <p>\uff081\uff09\u5728 Hive \u4e2d\u521b\u5efa\u5916\u90e8\u8868</p> <pre><code>CREATE EXTERNAL TABLE relevance_hbase_emp(\nempno int,\nename string,\njob string,\nmgr int,\nhiredate string,\nsal double,\ncomm double,\ndeptno int\n)\nSTORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'\nWITH SERDEPROPERTIES (\"hbase.columns.mapping\" = \":key,info:ename,info:job,info:mgr,info:hiredate,info:sal,info:comm,info:deptno\")\nTBLPROPERTIES (\"hbase.table.name\" = \"hbase_emp_table\");\n</code></pre> <p>\uff082\uff09\u5173\u8054\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 Hive \u51fd\u6570\u8fdb\u884c\u4e00\u4e9b\u5206\u6790\u64cd\u4f5c\u4e86</p> <pre><code>select deptno,avg(sal) monery from relevance_hbase_emp group by deptno ;\n</code></pre>"},{"location":"db/redis/rd_01/","title":"\u7b2c1\u7ae0 NoSQL","text":""},{"location":"db/redis/rd_01/#11-nosql","title":"1.1 NoSQL\u6570\u636e\u5e93","text":""},{"location":"db/redis/rd_01/#111-nosql","title":"1.1.1 NoSQL\u662f\u4ec0\u4e48","text":"<ol> <li> <p>NoSQL( Not Only SQL )\uff0c\u610f\u5373\u201c\u4e0d\u4ec5\u4ec5\u662f SQL \u201d\uff0c\u6cdb\u6307\u975e\u5173\u7cfb\u578b\u7684\u6570\u636e\u5e93\u3002 </p> </li> <li> <p>NoSQL \u4e0d\u62d8\u6ce5\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u8bbe\u8ba1\u8303\u5f0f\uff0c\u653e\u5f03\u4e86\u901a\u7528\u7684\u6280\u672f\u6807\u51c6\uff0c\u4e3a\u67d0\u4e00\u9886\u57df\u7279\u5b9a\u573a\u666f\u800c\u8bbe\u8ba1\uff0c\u4ece\u800c\u4f7f\u6027\u80fd\u3001\u5bb9\u91cf\u3001\u6269\u5c55\u6027\u90fd\u8fbe\u5230\u4e86\u4e00\u5b9a\u7a0b\u5ea6\u7684\u7a81\u7834\u3002</p> </li> </ol>"},{"location":"db/redis/rd_01/#112-nosql","title":"1.1.2 NoSQL\u7684\u7279\u70b9","text":"<ol> <li> <p>\u4e0d\u9075\u5faaSQL\u6807\u51c6</p> </li> <li> <p>\u4e0d\u652f\u6301 ACID 1</p> </li> <li> <p>\u8fdc\u8d85\u4e8e SQL \u7684\u6027\u80fd</p> </li> </ol>"},{"location":"db/redis/rd_01/#113-nosql","title":"1.1.3 NoSQL\u7684\u9002\u7528\u573a\u666f","text":"<ol> <li> <p>\u5bf9\u6570\u636e\u9ad8\u5e76\u53d1\u7684\u8bfb\u5199</p> </li> <li> <p>\u6d77\u91cf\u6570\u636e\u7684\u8bfb\u5199</p> </li> <li> <p>\u5bf9\u6570\u636e\u9ad8\u53ef\u6269\u5c55\u6027\u7684</p> </li> </ol>"},{"location":"db/redis/rd_01/#114-nosql","title":"1.1.4 NoSQL\u7684\u4e0d\u9002\u7528\u573a\u666f","text":"<ol> <li>\u9700\u8981\u4e8b\u52a1\uff08ACID\uff09\u652f\u6301</li> <li>\u57fa\u4e8e SQL \u7684\u7ed3\u6784\u5316\u67e5\u8be2\u5b58\u50a8\uff0c\u5904\u7406\u590d\u6742\u7684\u5173\u7cfb,\u9700\u8981\u5373\u5e2d\u67e5\u8be2\u3002</li> <li>\u7528\u4e0d\u7740 SQL \u7684\u548c\u7528\u4e86 SQL \u4e5f\u4e0d\u884c\u7684\u60c5\u51b5\uff0c\u8bf7\u8003\u8651\u7528 NoSql</li> </ol>"},{"location":"db/redis/rd_01/#12-nosql","title":"1.2 NoSQL\u5bb6\u65cf","text":"Memcached <p>\uff081\uff09\u5f88\u65e9\u51fa\u73b0\u7684NoSQL\u6570\u636e\u5e93</p> <p>\uff082\uff09\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\uff0c\u4e00\u822c\u4e0d\u6301\u4e45\u5316</p> <p>\uff083\uff09\u652f\u6301\u7b80\u5355\u7684key-value\u6a21\u5f0f\uff0c\u6570\u636e\u7c7b\u578b\u652f\u6301\u5355\u4e00</p> <p>\uff084\uff09\u4e00\u822c\u662f\u4f5c\u4e3a\u7f13\u5b58\u6570\u636e\u5e93\u8f85\u52a9\u6301\u4e45\u5316\u7684\u6570\u636e\u5e93</p> Redis <p>\uff081\uff09\u51e0\u4e4e\u8986\u76d6\u4e86Memcached\u7684\u7edd\u5927\u90e8\u5206\u529f\u80fd</p> <p>\uff082\uff09\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\uff0c\u652f\u6301\u6301\u4e45\u5316\uff0c\u4e3b\u8981\u7528\u4f5c\u5907\u4efd\u6062\u590d</p> <p>\uff083\uff09\u652f\u6301\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982 string \u3001 list \u3001 set\u3001zset\u3001hash\u7b49</p> <p>\uff084\uff09\u4e00\u822c\u662f\u4f5c\u4e3a\u7f13\u5b58\u6570\u636e\u5e93\u8f85\u52a9\u6301\u4e45\u5316\u7684\u6570\u636e\u5e93</p> mongoDB <p>\uff081\uff09\u9ad8\u6027\u80fd\u3001\u5f00\u6e90\u3001\u6a21\u5f0f\u81ea\u7531\u7684\u6587\u6863\u578b\u6570\u636e\u5e93</p> <p>\uff082\uff09\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\uff0c\u5982\u679c\u5185\u5b58\u4e0d\u8db3\uff0c\u628a\u4e0d\u5e38\u7528\u7684\u6570\u636e\u4fdd\u5b58\u5230\u786c\u76d8</p> <p>\uff083\uff09\u867d\u7136\u662fkey-value\u6a21\u5f0f\uff0c\u4f46\u662f\u5bf9value(\u5c24\u5176\u662fjson)\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u67e5\u8be2\u529f\u80fd</p> <p>\uff084\uff09\u652f\u6301\u4e8c\u8fdb\u5236\u6570\u636e\u53ca\u5927\u578b\u5bf9\u8c61</p> <p>\uff085\uff09\u53ef\u4ee5\u6839\u636e\u6570\u636e\u7684\u7279\u70b9\u66ff\u4ee3RDBMS(\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf)\uff0c\u6210\u4e3a\u72ec\u7acb\u7684\u6570\u636e\u5e93\u3002\u6216\u8005\u914d\u5408RDBMS\uff0c\u5b58\u50a8\u7279\u5b9a\u7684\u6570\u636e</p> HBase <p>\uff081\uff09Hbase\u662fHadoop\u9879\u76ee\u7684\u6570\u636e\u5e93\uff0c\u4e3b\u8981\u7528\u4e8e\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u968f\u673a\u3001\u5b9e\u65f6\u7684\u8bfb\u5199\u64cd\u4f5c.</p> <p>\uff082\uff09Hbase\u80fd\u652f\u6301\u5230\u6570\u5341\u4ebf\u884c \u00d7 \u767e\u4e07\u5217\u7684\u6570\u636e\u8868</p> Cassandra <p>Cassandra\u7528\u4e8e\u7ba1\u7406\u7531\u5927\u91cf\u5546\u7528\u670d\u52a1\u5668\u6784\u5efa\u8d77\u6765\u7684\u5e9e\u5927\u96c6\u7fa4\u4e0a\u7684\u6d77\u91cf\u6570\u636e\u96c6(PB\u7ea7)</p> Neo4j <p>Neo4j\u662f\u57fa\u4e8e\u56fe\u7ed3\u6784\u7684\u6570\u636e\u5e93\uff0c\u4e00\u822c\u7528\u4e8e\u6784\u5efa\u793e\u4ea4\u7f51\u7edc\u3001\u4ea4\u901a\u7f51\u7edc\u3001\u5730\u56fe\u7b49</p> <ol> <li> <p>ACID\uff0c\u662f\u6307\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff08DBMS\uff09\u5728\u5199\u5165\u6216\u66f4\u65b0\u8d44\u6599\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u4fdd\u8bc1\u4ea4\u6613\uff08transaction\uff09\u662f\u6b63\u786e\u53ef\u9760\u7684\uff0c\u6240\u5fc5\u987b\u5177\u5907\u7684\u56db\u4e2a\u7279\u6027\uff1a\u539f\u5b50\u6027\uff08\u82f1\u8bed\uff1aAtomicity (database systems)\uff09\uff08atomicity\uff0c\u6216\u79f0\u4e0d\u53ef\u5206\u5272\u6027\uff09\u3001\u4e00\u81f4\u6027\uff08consistency\uff09\u3001\u9694\u79bb\u6027\uff08isolation\uff0c\u53c8\u79f0\u72ec\u7acb\u6027\uff09\u3001\u6301\u4e45\u6027\uff08durability\uff09\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"db/redis/rd_02/","title":"\u7b2c2\u7ae0 Redis\u7b80\u4ecb","text":""},{"location":"db/redis/rd_02/#21-redis","title":"2.1 Redis\u5b98\u7f51","text":"<ul> <li> <p>Redis\u5b98\u65b9\u7f51\u7ad9</p> </li> <li> <p>Redis\u4e2d\u6587\u5b98\u65b9\u7f51\u7ad9</p> </li> </ul>"},{"location":"db/redis/rd_02/#22-redis","title":"2.2 Redis\u662f\u4ec0\u4e48","text":"<ol> <li> <p>Redis \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 key-value \u5b58\u50a8\u7cfb\u7edf\u3002</p> </li> <li> <p>\u5b83\u652f\u6301\u5b58\u50a8\u7684 value \u7c7b\u578b\u76f8\u5bf9\u66f4\u591a\uff0c\u5305\u62ec string (\u5b57\u7b26\u4e32)\u3001list (\u94fe\u8868)\u3001set (\u96c6\u5408)\u3001zset (sorted set) \u548c hash\uff08\u54c8\u5e0c\u7c7b\u578b\uff09\u3002</p> </li> <li> <p>Redis \u4f1a\u5468\u671f\u6027\u7684\u628a\u66f4\u65b0\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u6216\u8005\u628a\u4fee\u6539\u64cd\u4f5c\u5199\u5165\u8ffd\u52a0\u7684\u8bb0\u5f55\u6587\u4ef6</p> </li> <li> <p>\u652f\u6301\u9ad8\u53ef\u7528\u548c\u96c6\u7fa4\u6a21\u5f0f\u3002</p> </li> </ol>"},{"location":"db/redis/rd_02/#23-redis","title":"2.3 Redis\u7684\u5e94\u7528\u573a\u666f","text":""},{"location":"db/redis/rd_02/#231","title":"2.3.1 \u914d\u5408\u5173\u7cfb\u578b\u6570\u636e\u5e93\u505a\u9ad8\u901f\u7f13\u5b58","text":"<ol> <li>\u9ad8\u9891\u6b21\uff0c\u70ed\u95e8\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u964d\u4f4e\u6570\u636e\u5e93 IO</li> <li>\u7ecf\u5178\u7684 Cache Aside Pattern\uff08\u65c1\u8def\u7f13\u5b58\u6a21\u5f0f\uff09</li> </ol>"},{"location":"db/redis/rd_02/#232","title":"2.3.2 \u5927\u6570\u636e\u573a\u666f","text":"<ol> <li>\u7f13\u5b58\u6570\u636e</li> <li>\u9700\u8981\u9ad8\u9891\u6b21\u8bbf\u95ee</li> <li>\u6301\u4e45\u5316\u6570\u636e\u8bbf\u95ee\u8f83\u6162</li> </ol> <ol> <li>\u4e34\u65f6\u6570\u636e</li> <li>\u9ad8\u9891\u6b21</li> <li>\u8bfb\u5199\u65f6\u6548\u6027\u9ad8</li> <li>\u603b\u6570\u636e\u91cf\u4e0d\u5927</li> <li>\u4e34\u65f6\u6027</li> <li>\u7528 key \u67e5\u8be2</li> </ol> <ol> <li>\u8ba1\u7b97\u7ed3\u679c</li> <li>\u9ad8\u9891\u6b21\u5199\u5165</li> <li>\u9ad8\u9891\u6b21\u67e5\u8be2</li> <li>\u603b\u6570\u636e\u91cf\u4e0d\u5927</li> </ol>"},{"location":"db/redis/rd_02/#233","title":"2.3.3 \u5229\u7528\u5176\u591a\u6837\u7684\u6570\u636e\u7ed3\u6784\u5b58\u50a8\u7279\u5b9a\u7684\u6570\u636e","text":"<ol> <li>\u6700\u65b0 N \u4e2a\u6570\u636e  \u901a\u8fc7 List \u5b9e\u73b0\u6309\u81ea\u7136\u4e8b\u4ef6\u6392\u5e8f\u7684\u6570\u636e</li> <li>\u6392\u884c\u699c\uff0cTopN  \u5229\u7528 zset (\u6709\u5e8f\u96c6\u5408)</li> <li>\u65f6\u6548\u6027\u7684\u6570\u636e\uff0c\u6bd4\u5982\u624b\u673a\u9a8c\u8bc1\u7801 Expire \u8fc7\u671f</li> <li>\u8ba1\u6570\u5668\uff0c\u79d2\u6740  \u539f\u5b50\u6027\uff0c\u81ea\u589e\u65b9\u6cd5 INCR\u3001DECR</li> <li>\u53bb\u9664\u5927\u91cf\u6570\u636e\u4e2d\u7684\u91cd\u590d\u6570\u636e \u5229\u7528 set \u96c6\u5408</li> <li>\u6784\u5efa\u961f\u5217\u5229\u7528 list \u96c6\u5408</li> <li>\u53d1\u5e03\u8ba2\u9605\u6d88\u606f\u7cfb\u7edf  pub/sub \u6a21\u5f0f</li> </ol>"},{"location":"db/redis/rd_03/","title":"\u7b2c3\u7ae0 Redis\u5b89\u88c5","text":""},{"location":"db/redis/rd_03/#31-redis","title":"3.1 \u5173\u4e8eRedis\u7248\u672c","text":"<p>Windows \u4e0b\u5b89\u88c5 Redis</p> <p>\u4e0d\u7528\u8003\u8651\u5728 Windows \u73af\u5883\u4e0b\u5bf9 Redis \u7684\u652f\u6301\uff0cRedis \u5b98\u65b9\u6ca1\u6709\u63d0\u4f9b\u5bf9 Windows \u73af\u5883\u7684\u652f\u6301\uff0c\u662f\u5fae\u8f6f\u7684\u5f00\u6e90\u5c0f\u7ec4\u5f00\u53d1\u4e86\u5bf9 Redis \u5bf9 Windows \u7684\u652f\u6301\u3002</p>"},{"location":"db/redis/rd_03/#32","title":"3.2 \u5b89\u88c5","text":"<p>1\uff09\u5b89\u88c5\u65b0\u7248 gcc \u7f16\u8bd1\u5668 <pre><code>sudo yum -y install gcc-c++ </code></pre></p> <p>2\uff09\u4e0a\u4f20 redis-6.2.1.tar.gz \u5b89\u88c5\u5305\u5230 /opt/software \u76ee\u5f55\u4e0b</p> <p>3\uff09\u89e3\u538b redis-6.2.1.tar.gz \u5230 /opt/module \u76ee\u5f55\u4e0b</p> <pre><code>tar -zxvf redis-6.2.1.tar.gz -C /opt/module/\n</code></pre> <p>4\uff09\u4e4b\u540e\u8fdb\u5165\u5b89\u88c5\u5305\u7684 src \u76ee\u5f55\uff0c\u7f16\u8f91 Makefile \u6587\u4ef6\uff0c\u4fee\u6539\u8f6f\u4ef6\u5b89\u88c5\u8def\u5f84\u5982\u4e0b:</p> <p>Makefile<pre><code>#\u4fee\u6539\u5982\u4e0b\nPREFIX?=/home/atguigu\n</code></pre> 5\uff09\u5728 Redis \u7684\u89e3\u538b\u8def\u5f84\u4e0b\u6267\u884c\u7f16\u8bd1\u548c\u5b89\u88c5\u547d\u4ee4</p> <pre><code>make &amp;&amp; make install\n</code></pre>"},{"location":"db/redis/rd_03/#33-homeatguigubin","title":"3.3 \u67e5\u770b\u5b89\u88c5\u76ee\u5f55 /home/atguigu/bin","text":"\u6587\u4ef6 \u8bf4\u660e redis-benchmark \u6027\u80fd\u6d4b\u8bd5\u5de5\u5177\uff0c\u53ef\u4ee5\u5728\u81ea\u5df1\u672c\u5b50\u8fd0\u884c\uff0c\u770b\u770b\u81ea\u5df1\u672c\u5b50\u6027\u80fd\u5982\u4f55(\u670d\u52a1\u542f\u52a8\u8d77\u6765\u540e\u6267\u884c) redis-check-aof \u4fee\u590d\u6709\u95ee\u9898\u7684 AOF \u6587\u4ef6 redis-check-dump \u4fee\u590d\u6709\u95ee\u9898\u7684 RDB \u6587\u4ef6 redis-sentinel \u542f\u52a8 Redis \u54e8\u5175\u670d\u52a1 redis-server Redis \u670d\u52a1\u5668\u542f\u52a8\u547d\u4ee4 redis-cli \u5ba2\u6237\u7aef\uff0c\u64cd\u4f5c\u5165\u53e3"},{"location":"db/redis/rd_03/#34-redis","title":"3.4 Redis\u7684\u542f\u52a8","text":"<p>1\uff09\u62f7\u8d1d\u4e00\u4efd redis.conf \u914d\u7f6e\u6587\u4ef6\u5230\u5de5\u4f5c\u76ee\u5f55</p> <pre><code>mkdir myredis\ncd myredis\ncp /opt/module/redis-6.2.1/redis.conf .\n</code></pre> <p>2\uff09\u7ed1\u5b9a\u4e3b\u673a IP\uff0c\u4fee\u6539 bind \u5c5e\u6027</p> redis.conf<pre><code>bind 0.0.0.0\n</code></pre> <p>3\uff09\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u542f\u52a8 </p> <pre><code>redis-server redis.conf\n</code></pre>"},{"location":"db/redis/rd_03/#35","title":"3.5 \u5ba2\u6237\u7aef\u8bbf\u95ee","text":"<p>1\uff09\u4f7f\u7528 redis-cli \u547d\u4ee4\u8bbf\u95ee\u542f\u52a8\u597d\u7684 Redis\uff0c\u9ed8\u8ba4\u7aef\u53e3\u4e3a 63791</p> <pre><code>$ redis-cli 127.0.0.1:6379&gt; \n</code></pre> <p>2\uff09\u5982\u679c\u6709\u591a\u4e2a Redis \u540c\u65f6\u542f\u52a8\uff0c\u6216\u8005\u7aef\u53e3\u505a\u4e86\u4fee\u6539,\u5219\u9700\u6307\u5b9a\u7aef\u53e3\u53f7\u8bbf\u95ee</p> <pre><code>$ redis-cli -p 6379\n127.0.0.1:6379&gt; \n</code></pre> <p>3\uff09\u5982\u679c\u8bbf\u95ee\u975e\u672c\u673a Redis\uff0c\u9700\u8981\u6307\u5b9a host \u6765\u8bbf\u95ee</p> <pre><code>$ redis-cli -h 127.0.0.1 -p 6379\n127.0.0.1:6379&gt; \n</code></pre> <p>4\uff09\u901a\u8fc7 ping \u547d\u4ee4\u6d4b\u8bd5\u9a8c\u8bc1 </p> <pre><code>$ ping\nPONG\n</code></pre>"},{"location":"db/redis/rd_03/#36-redis","title":"3.6 \u5173\u95edRedis\u670d\u52a1","text":"<p>\u5982\u679c\u8fd8\u672a\u901a\u8fc7\u5ba2\u6237\u7aef\u8bbf\u95ee\uff0c\u53ef\u76f4\u63a5  <pre><code>redis-cli shutdown\n</code></pre></p> <p>\u5982\u679c\u5df2\u7ecf\u8fdb\u5165\u5ba2\u6237\u7aef,\u76f4\u63a5 shutdown\u5373\u53ef <pre><code>127.0.0.1:6379&gt; shutdown\n</code></pre></p> <ol> <li> <p>6379 \u5728\u662f\u624b\u673a\u6309\u952e\u4e0a MERZ \u5bf9\u5e94\u7684\u53f7\u7801\uff0c\u800c MERZ \u53d6\u81ea\u610f\u5927\u5229\u6b4c\u5973 Alessia Merz \u7684\u540d\u5b57\u3002MERZ \u957f\u671f\u4ee5\u6765\u88ab Redis \u4f5c\u8005 antirez \u53ca\u5176\u670b\u53cb\u5f53\u4f5c\u611a\u8822\u7684\u4ee3\u540d\u8bcd\uff0c\u6240\u4ee5\u5c31\u9009\u4e86\u8fd9\u4e2a 6379\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"db/redis/rd_04/","title":"\u7b2c4\u7ae0 Redis\u7684\u4e94\u5927\u6570\u636e\u7c7b\u578b","text":""},{"location":"db/redis/rd_04/#41","title":"4.1 \u5e2e\u52a9\u624b\u518c","text":"<p>http://redisdoc.com/</p>"},{"location":"db/redis/rd_04/#42-rediskey","title":"4.2 redis\u952e(key)","text":"<p>1\uff09\u67e5\u770b\u5f53\u524d\u5e93\u7684\u6240\u6709\u952e</p> <pre><code>127.0.0.1:6379&gt; keys *\n</code></pre> <p>2\uff09\u5224\u65ad\u67d0\u4e2a\u952e\u662f\u5426\u5b58\u5728 <pre><code>127.0.0.1:6379&gt; exists &lt;key&gt;\n</code></pre></p> <p>3\uff09\u67e5\u770b\u952e\u5bf9\u5e94\u7684value\u7684\u7c7b\u578b <pre><code>127.0.0.1:6379&gt; type &lt;key&gt;\n</code></pre></p> <p>4\uff09\u5220\u9664\u67d0\u4e2a\u952e <pre><code>127.0.0.1:6379&gt; del &lt;key&gt;\n</code></pre></p> <p>5\uff09\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 <pre><code>127.0.0.1:6379&gt; expire &lt;key&gt; &lt;second&gt;\n</code></pre></p> <p>6\uff09\u67e5\u770b\u8fc7\u671f\u65f6\u95f4\uff0c-1 \u8868\u793a\u6c38\u4e0d\u8fc7\u671f\uff0c-2 \u8868\u793a\u5df2\u8fc7\u671f <pre><code>127.0.0.1:6379&gt; ttl &lt;key&gt;\n</code></pre></p> <p>7\uff09\u67e5\u770b\u5f53\u524d\u5e93\u4e2d key \u7684\u6570\u91cf <pre><code>127.0.0.1:6379&gt; dbsize\n</code></pre></p> <p>8\uff09\u6e05\u7a7a\u5f53\u524d\u5e93 <pre><code>127.0.0.1:6379&gt; flushdb\n</code></pre></p> <p>9\uff09\u6e05\u7a7a\u6240\u6709\u5e93 <pre><code>127.0.0.1:6379&gt; flushall\n</code></pre></p>"},{"location":"db/redis/rd_04/#43-string","title":"4.3 String","text":""},{"location":"db/redis/rd_04/#431","title":"4.3.1\u7279\u70b9","text":"<ol> <li>String \u662f Redis \u6700\u57fa\u672c\u7684\u7c7b\u578b\uff0c\u9002\u5408\u4fdd\u5b58\u5355\u503c\u7c7b\u578b\uff0c\u5373\u4e00\u4e2a key \u5bf9\u5e94\u4e00\u4e2a value </li> <li>String \u7c7b\u578b\u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u3002\u610f\u5473\u7740 Redis \u7684 String \u53ef\u4ee5\u5305\u542b\u4efb\u4f55\u6570\u636e\u3002\u6bd4\u5982 jpg \u56fe\u7247\u6216\u8005\u5e8f\u5217\u5316\u7684\u5bf9\u8c61 \u3002</li> <li>\u4e00\u4e2a Redis \u4e2d\u5b57\u7b26\u4e32 value \u6700\u591a\u53ef\u4ee5\u662f 512M</li> </ol>"},{"location":"db/redis/rd_04/#432","title":"4.3.2 \u5e38\u7528\u64cd\u4f5c","text":"<p>1\uff09\u6dfb\u52a0\u952e\u503c\u5bf9 <pre><code>127.0.0.1:6379&gt; set &lt;key&gt; &lt;value&gt;\n</code></pre></p> <p>2\uff09\u83b7\u53d6\u952e\u7684\u503c <pre><code>127.0.0.1:6379&gt; get &lt;key&gt;\n</code></pre></p> <p>3\uff09\u5c06\u7ed9\u5b9a\u7684  <code>&lt;value&gt;</code> \u8ffd\u52a0\u5230\u539f\u503c\u7684\u672b\u5c3e <pre><code>127.0.0.1:6379&gt; append &lt;key&gt; &lt;value&gt;\n</code></pre></p> <p>4\uff09\u83b7\u53d6\u503c\u7684\u957f\u5ea6 <pre><code>127.0.0.1:6379&gt; strlen &lt;key&gt;\n</code></pre></p> <p>5\uff09\u5f53 key \u4e0d\u5b58\u5728\u65f6\u8bbe\u7f6e key \u7684\u503c <pre><code>127.0.0.1:6379&gt; setnx &lt;key&gt; &lt;value&gt;\n</code></pre></p> <p>6\uff09\u5c06 key \u4e2d\u5b58\u50a8\u7684\u6570\u5b57\u503c\u589e 1 <pre><code>127.0.0.1:6379&gt; incr &lt;key&gt;\n</code></pre></p> <p>7\uff09\u5c06 key \u4e2d\u5b58\u50a8\u7684\u6570\u5b57\u503c\u51cf 1 <pre><code>127.0.0.1:6379&gt; decr &lt;key&gt;\n</code></pre></p> <p>8\uff09\u5c06 key \u4e2d\u5b58\u50a8\u7684\u6570\u5b57\u503c\u6309\u7167\u6307\u5b9a\u6b65\u957f\u589e <pre><code>127.0.0.1:6379&gt; incrby &lt;key&gt; &lt;\u6b65\u957f&gt;\n</code></pre></p> <p>9\uff09\u5c06 key \u4e2d\u5b58\u50a8\u7684\u6570\u5b57\u503c\u6309\u7167\u6307\u5b9a\u6b65\u957f\u51cf <pre><code>127.0.0.1:6379&gt; decrby &lt;key&gt; &lt;\u6b65\u957f&gt;\n</code></pre></p> <p>10\uff09\u540c\u65f6\u6dfb\u52a0\u4e00\u4e2a\u6216\u8005\u591a\u4e2a key <pre><code>127.0.0.1:6379&gt; mset &lt;k1&gt; &lt;v1&gt; &lt;k2&gt; &lt;v2&gt;\n</code></pre></p> <p>11\uff09\u540c\u65f6\u83b7\u53d6\u4e00\u4e2a\u6216\u8005\u591a\u4e2a key \u7684\u503c <pre><code>127.0.0.1:6379&gt; mget &lt;k1&gt; &lt;k2&gt; &lt;k3&gt;\n</code></pre></p> <p>12\uff09\u540c\u65f6\u6dfb\u52a0\u4e00\u4e2a\u6216\u8005\u591a\u4e2a key\uff0c\u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u7ed9\u5b9a\u7684 key \u90fd\u4e0d\u5b58\u5728 <pre><code>127.0.0.1:6379&gt; msetnx &lt;k1&gt; &lt;v1&gt; &lt;k2&gt; &lt;v2&gt;\n</code></pre></p> <p>13\uff09\u83b7\u53d6\u503c\u7684\u5b50\u4e32 <pre><code>127.0.0.1:6379&gt; getrange &lt;key&gt; &lt;start&gt; &lt;end&gt;\n</code></pre></p> <p>14\uff09\u4ece\u6307\u5b9a\u7684\u5f00\u59cb\u4f4d\u7f6e\u8986\u76d6\u65e7\u503c <pre><code>127.0.0.1:6379&gt; setrange &lt;key&gt; &lt;start&gt; &lt;value&gt;\n</code></pre></p> <p>15\uff09\u540c\u65f6\u8bbe\u7f6e\u503c\u548c\u8fc7\u671f\u65f6\u95f4 <pre><code>127.0.0.1:6379&gt; setex &lt;key&gt; &lt;seconds&gt; &lt;value&gt;\n</code></pre></p> <p>16\uff09\u8bbe\u7f6e\u65b0\u503c\u7684\u540c\u65f6\u83b7\u53d6\u65e7\u503c <pre><code>127.0.0.1:6379&gt; getset &lt;key&gt; &lt;value&gt;\n</code></pre></p>"},{"location":"db/redis/rd_04/#44-list","title":"4.4 List","text":""},{"location":"db/redis/rd_04/#441","title":"4.4.1 \u7279\u70b9","text":"<ol> <li>\u5355\u952e\u591a\u503c</li> <li>Redis List \u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6309\u7167\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\u3002\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u5230\u5217\u8868\u7684\u5934\u90e8\uff08\u5de6\u8fb9\uff09\u6216\u8005\u5c3e\u90e8\uff08\u53f3\u8fb9\uff09</li> <li>\u5b83\u7684\u5e95\u5c42\u5b9e\u9645\u662f\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u5bf9\u4e24\u7aef\u7684\u64cd\u4f5c\u6027\u80fd\u5f88\u9ad8\uff0c\u901a\u8fc7\u7d22\u5f15\u4e0b\u6807\u7684\u64cd\u4f5c\u4e2d\u95f4\u7684\u8282\u70b9\u6027\u80fd\u4f1a\u8f83\u5dee </li> </ol>"},{"location":"db/redis/rd_04/#442","title":"4.4.2 \u5e38\u7528\u64cd\u4f5c","text":"<p>1\uff09\u4ece\u5de6\u8fb9\u63d2\u5165\u4e00\u4e2a\u6216\u591a\u4e2a\u503c <pre><code>127.0.0.1:6379&gt; lpush &lt;key&gt; &lt;element\u2026&gt; </code></pre></p> <p>2\uff09\u4ece\u53f3\u8fb9\u63d2\u5165\u4e00\u4e2a\u6216\u591a\u4e2a\u503c <pre><code>127.0.0.1:6379&gt; rpush &lt;key&gt; &lt;element\u2026&gt;\n</code></pre></p> <p>3\uff09\u4ece\u5de6\u8fb9\u5220\u9664\u4e00\u4e2a\u503c\uff08\u503c\u5728\u952e\u5728\uff0c\u503c\u5149\u952e\u4ea1\uff09 <pre><code>127.0.0.1:6379&gt; lpop &lt;key&gt; </code></pre></p> <p>4\uff09\u4ece\u53f3\u8fb9\u5220\u9664\u4e00\u4e2a\u503c\uff08\u503c\u5728\u952e\u5728\uff0c\u503c\u5149\u952e\u4ea1\uff09 <pre><code>127.0.0.1:6379&gt; rpop &lt;key&gt; </code></pre></p> <p>5\uff09\u4ece key1 \u5217\u8868\u53f3\u8fb9\u5220\u9664\u4e00\u4e2a\u503c\uff0c\u63d2\u5165\u5230 key2 \u5217\u8868\u5de6\u8fb9 <pre><code>127.0.0.1:6379&gt; rpoplpush &lt;key1&gt; &lt;key2&gt;\n</code></pre></p> <p>6\uff09\u6309\u7167\u7d22\u5f15\u4e0b\u6807\u8303\u56f4\u83b7\u53d6\u5143\u7d20\uff08\u4ece\u5de6\u5230\u53f3\uff09 <pre><code>127.0.0.1:6379&gt; lrange &lt;key&gt; &lt;start&gt; &lt;stop&gt;\n</code></pre></p> <p>7\uff09\u6309\u7167\u7d22\u5f15\u4e0b\u6807\u83b7\u53d6\u5143\u7d20\uff08\u4ece\u5de6\u5230\u53f3\uff09 <pre><code>127.0.0.1:6379&gt; lindex &lt;key&gt; &lt;index&gt;\n</code></pre></p> <p>8\uff09\u83b7\u53d6\u5217\u8868\u957f\u5ea6 <pre><code>127.0.0.1:6379&gt; llen &lt;key&gt;\n</code></pre></p> <p>9\uff09\u5728\u6307\u5b9a <code>&lt;value&gt;</code> \u7684\u524d\u9762\u6216\u8005\u540e\u9762\u63d2\u5165 <code>&lt;newvalue&gt;</code> <pre><code>127.0.0.1:6379&gt; linsert &lt;key&gt; before|after &lt;pivot&gt; &lt;element&gt;\n</code></pre></p> <p>10\uff09 \u4ece\u5de6\u8fb9\u5220\u9664 count \u4e2a\u6307\u5b9a\u7684 value <pre><code>127.0.0.1:6379&gt; lrem &lt;key&gt; &lt;count&gt; &lt;element&gt;\n</code></pre></p>"},{"location":"db/redis/rd_04/#45-set","title":"4.5 Set","text":""},{"location":"db/redis/rd_04/#451","title":"4.5.1 \u7279\u70b9","text":"<ol> <li>Set \u4e2d\u7684\u5143\u7d20\u662f\u65e0\u5e8f\u4e0d\u91cd\u590d\u7684\uff0c\u5f53\u4f60\u9700\u8981\u5b58\u50a8\u4e00\u4e2a\u5217\u8868\u6570\u636e\uff0c\u53c8\u4e0d\u5e0c\u671b\u51fa\u73b0\u91cd\u590d\u6570\u636e\u65f6\uff0cSet \u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u5e76\u4e14 Set \u63d0\u4f9b\u4e86\u5224\u65ad\u67d0\u4e2a\u6210\u5458\u662f\u5426\u5728\u4e00\u4e2a Set \u96c6\u5408\u5185\u7684\u91cd\u8981\u63a5\u53e3\u3002</li> <li>Redis \u7684 Set \u662f String \u7c7b\u578b\u7684\u65e0\u5e8f\u96c6\u5408\u3002\u5b83\u5e95\u5c42\u5176\u5b9e\u662f\u4e00\u4e2a value \u4e3a null \u7684 hash \u8868,\u6240\u4ee5\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u67e5\u627e\u7684\u590d\u6742\u5ea6\u90fd\u662f O(1)\u3002</li> </ol>"},{"location":"db/redis/rd_04/#452","title":"4.5.2 \u5e38\u7528\u64cd\u4f5c","text":"<p>1\uff09\u5c06\u4e00\u4e2a\u6216\u8005\u591a\u4e2a member \u5143\u7d20\u52a0\u5165\u5230\u96c6\u5408\u4e2d\uff0c\u5df2\u7ecf\u5b58\u5728\u7684 member \u5c06\u88ab\u5ffd\u7565 <pre><code>127.0.0.1:6379&gt; sadd &lt;key&gt; &lt;member\u2026&gt;\n</code></pre></p> <p>2\uff09\u53d6\u51fa\u96c6\u5408\u7684\u6240\u6709\u503c <pre><code>127.0.0.1:6379&gt; smemebers  &lt;key&gt;\n</code></pre></p> <p>3\uff09\u5224\u65ad\u96c6\u5408 <code>&lt;key&gt;</code> \u662f\u5426\u5305\u542b\u6307\u5b9a\u7684 member\uff0c\u5305\u542b\u8fd4\u56de 1\uff0c\u4e0d\u5305\u542b\u8fd4\u56de 0 <pre><code>127.0.0.1:6379&gt; sismember &lt;key&gt; &lt;member&gt;\n</code></pre></p> <p>4\uff09\u8fd4\u56de\u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570 <pre><code>127.0.0.1:6379&gt; scard &lt;key&gt;\n</code></pre></p> <p>5\uff09\u4ece\u96c6\u5408\u4e2d\u5220\u9664\u6307\u5b9a\u7684\u5143\u7d20 <pre><code>127.0.0.1:6379&gt; srem &lt;key&gt; &lt;member\u2026&gt;\n</code></pre></p> <p>6\uff09\u968f\u673a\u4ece\u96c6\u5408\u4e2d\u5220\u9664\u4e00\u4e2a\u503c\uff0c\u4f1a\u4ece\u96c6\u5408\u4e2d\u5220\u9664\u5220\u9664\u7684\u503c <pre><code>127.0.0.1:6379&gt; spop &lt;key&gt;\n</code></pre></p> <p>7\uff09\u968f\u673a\u4ece\u96c6\u5408\u4e2d\u53d6\u51fan\u4e2a\u503c\uff0c\u4e0d\u4f1a\u4ece\u96c6\u5408\u4e2d\u5220\u9664 <pre><code>127.0.0.1:6379&gt; srandmember &lt;key&gt; &lt;count&gt;\n</code></pre></p> <p>8\uff09\u8fd4\u56de\u591a\u4e2a\u96c6\u5408\u7684\u4ea4\u96c6\u5143\u7d20 <pre><code>127.0.0.1:6379&gt; sinter &lt;key\u2026&gt;\n</code></pre></p> <p>9\uff09\u8fd4\u56de\u591a\u4e2a\u96c6\u5408\u7684\u5e76\u96c6\u5143\u7d20 <pre><code>127.0.0.1:6379&gt; sunion &lt;key\u2026&gt; </code></pre></p> <p>10\uff09\u8fd4\u56de\u591a\u4e2a\u96c6\u5408\u7684\u5dee\u96c6\u5143\u7d20 <pre><code>127.0.0.1:6379&gt; sdiff &lt;key\u2026&gt; </code></pre></p>"},{"location":"db/redis/rd_04/#46-zset","title":"4.6 Zset","text":""},{"location":"db/redis/rd_04/#461","title":"4.6.1 \u7279\u70b9","text":"<ol> <li>Redis \u6709\u5e8f\u96c6\u5408 zset \u4e0e\u666e\u901a\u96c6\u5408 set \u975e\u5e38\u76f8\u4f3c\uff0c\u662f\u4e00\u4e2a\u6ca1\u6709\u91cd\u590d\u5143\u7d20\u7684\u5b57\u7b26\u4e32\u96c6\u5408\u3002\u4e0d\u540c\u4e4b\u5904\u662f\u6709\u5e8f\u96c6\u5408\u7684\u6bcf\u4e2a\u6210\u5458\u90fd\u5173\u8054\u4e86\u4e00\u4e2a\u8bc4\u5206\uff08score\uff09 \uff0c\u8fd9\u4e2a\u8bc4\u5206\uff08score\uff09\u88ab\u7528\u6765\u6309\u7167\u4ece\u6700\u4f4e\u5206\u5230\u6700\u9ad8\u5206\u7684\u65b9\u5f0f\u6392\u5e8f\u96c6\u5408\u4e2d\u7684\u6210\u5458\u3002\u96c6\u5408\u7684\u6210\u5458\u662f\u552f\u4e00\u7684\uff0c\u4f46\u662f\u8bc4\u5206\u53ef\u4ee5\u662f\u91cd\u590d\u4e86 \u3002 \uff082\uff09\u56e0\u4e3a\u5143\u7d20\u662f\u6709\u5e8f\u7684, \u6240\u4ee5\u4f60\u4e5f\u53ef\u4ee5\u5f88\u5feb\u7684\u6839\u636e\u8bc4\u5206\uff08score\uff09\u6216\u8005\u6b21\u5e8f\uff08position\uff09\u6765\u83b7\u53d6\u4e00\u4e2a\u8303\u56f4\u7684\u5143\u7d20\u3002\u8bbf\u95ee\u6709\u5e8f\u96c6\u5408\u7684\u4e2d\u95f4\u5143\u7d20\u4e5f\u662f\u975e\u5e38\u5feb\u7684,\u56e0\u6b64\u4f60\u80fd\u591f\u4f7f\u7528\u6709\u5e8f\u96c6\u5408\u4f5c\u4e3a\u4e00\u4e2a\u6ca1\u6709\u91cd\u590d\u6210\u5458\u7684\u667a\u80fd\u5217\u8868\u3002</li> </ol>"},{"location":"db/redis/rd_04/#462","title":"4.6.2 \u5e38\u7528\u64cd\u4f5c","text":"<p>1\uff09\u5f80\u96c6\u5408\u4e2d\u6dfb\u52a0\u6307\u5b9a\u7684 member \u53ca score <pre><code>127.0.0.1:6379&gt; zadd &lt;key&gt; [&lt;score&gt; &lt;member&gt; \u2026 ]\n</code></pre></p> <p>2\uff09\u4ece\u96c6\u5408\u4e2d\u53d6\u51fa\u6307\u5b9a\u4e0b\u6807\u8303\u56f4\u7684\u6570\u636e\uff0c\u6b63\u5e8f\u53d6 <pre><code>127.0.0.1:6379&gt; zrange &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES] </code></pre></p> <p>3\uff09\u4ece\u96c6\u5408\u4e2d\u53d6\u51fa\u6307\u5b9a\u4e0b\u6807\u8303\u56f4\u7684\u6570\u636e\uff0c\u5012\u5e8f\u53d6 <pre><code>127.0.0.1:6379&gt; zrevrange &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES] </code></pre></p> <p>4\uff09\u4ece\u96c6\u5408\u4e2d\u53d6\u51fa\u6307\u5b9a score \u8303\u56f4\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u4ece\u5c0f\u5230\u5927 <pre><code>127.0.0.1:6379&gt; zrangebyscore &lt;key&gt; &lt;min&gt; &lt;max&gt; [WITHSCORES]\n</code></pre></p> <p>5\uff09\u4ece\u96c6\u5408\u4e2d\u53d6\u51fa\u6307\u5b9a score \u8303\u56f4\u7684\u6570\u636e\uff0c\u4ece\u5927\u5230\u5c0f <pre><code>127.0.0.1:6379&gt; zrevrangebyscore  &lt;key&gt;  &lt;max&gt; &lt;min&gt; [WITHSCORES]\n</code></pre></p> <p>6\uff09\u7ed9\u96c6\u5408\u4e2d\u6307\u5b9a member \u7684 score \u589e\u52a0 increment <pre><code>127.0.0.1:6379&gt; zincrby &lt;key&gt; &lt;increment&gt; &lt;member&gt;\n</code></pre></p> <p>7\uff09\u5220\u9664\u96c6\u5408\u4e2d\u6307\u5b9a\u7684 member <pre><code>127.0.0.1:6379&gt; zrem &lt;key&gt; &lt;member\u2026&gt;\n</code></pre></p> <p>8\uff09\u7edf\u8ba1\u6307\u5b9a score \u8303\u56f4\u7684\u5143\u7d20\u4e2a\u6570 <pre><code>127.0.0.1:6379&gt; zcount &lt;key&gt; &lt;min&gt; &lt;max&gt;\n</code></pre></p> <p>9\uff09\u8fd4\u56de\u96c6\u5408\u4e2d\u6307\u5b9a member \u7684\u6392\u540d\uff0c\u6392\u540d\u4ece 0 \u5f00\u59cb <pre><code>127.0.0.1:6379&gt; zrank   &lt;key&gt;  &lt;member&gt;\n</code></pre></p>"},{"location":"db/redis/rd_04/#47-hash","title":"4.7 Hash","text":""},{"location":"db/redis/rd_04/#471","title":"4.7.1 \u7279\u70b9","text":"<ol> <li>Redis hash \u662f\u4e00\u4e2a\u952e\u503c\u5bf9\u96c6\u5408</li> <li>Redis hash \u7684\u503c\u662f\u7531\u591a\u4e2a field \u548c value \u7ec4\u6210\u7684\u6620\u5c04\u8868</li> <li>\u7c7b\u4f3cJava\u91cc\u9762\u7684 <code>Map&lt;String,Object&gt;</code></li> </ol>"},{"location":"db/redis/rd_04/#472-user-redis","title":"4.7.2 \u5206\u6790\u4e00\u4e2a\u95ee\u9898: \u73b0\u6709\u4e00\u4e2aUser \u5bf9\u8c61\uff0c\u5728Redis\u4e2d\u5982\u4f55\u5b58?","text":"<p>1\uff09\u7b2c\u4e00\u79cd\u65b9\u6848:  \u7528\u6237 ID \u4e3a key ,VALUE \u4e3a JavaBean \u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32</p> <p></p> <p>2\uff09\u7b2c\u4e8c\u79cd\u65b9\u6848: \u7528\u6237 ID + \u5c5e\u6027\u540d\u4f5c\u4e3a key, \u5c5e\u6027\u503c\u4f5c\u4e3a value</p> <p></p> <p>3\uff09\u7b2c\u4e09\u79cd\u65b9\u6848: \u901a\u8fc7 key (\u7528\u6237 ID ) + field (\u5c5e\u6027\u6807\u7b7e) \u5c31\u53ef\u4ee5\u64cd\u4f5c\u5bf9\u5e94\u5c5e\u6027\u6570\u636e\u4e86\uff0c\u65e2\u4e0d\u9700\u8981\u91cd\u590d\u5b58\u50a8\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u5e26\u6765\u5e8f\u5217\u5316\u548c\u5e76\u53d1\u4fee\u6539\u63a7\u5236\u7684\u95ee\u9898</p> <p></p>"},{"location":"db/redis/rd_04/#473","title":"4.7.3 \u5e38\u7528\u64cd\u4f5c","text":"<p>1\uff09\u7ed9\u96c6\u5408\u4e2d\u6dfb\u52a0\u6307\u5b9a\u7684 <code>&lt;field&gt;</code> -<code>&lt;value&gt;</code> <pre><code>127.0.0.1:6379&gt; hset &lt;key&gt;  [&lt;field&gt; &lt;value&gt; \u2026]\n</code></pre></p> <p>2\uff09\u7ed9\u96c6\u5408\u4e2d\u6dfb\u52a0\u6307\u5b9a\u7684 <code>&lt;field&gt;</code> -  <code>&lt;value&gt;</code>\uff0c\u5f53\u6307\u5b9a\u7684 field \u4e0d\u5b58\u5728\u65f6 <pre><code>127.0.0.1:6379&gt; hsetnx &lt;key&gt; &lt;field&gt; &lt;value&gt; </code></pre></p> <p>3\uff09\u53d6\u51fa\u96c6\u5408\u4e2d\u6307\u5b9a field \u7684 value <pre><code>127.0.0.1:6379&gt; hget &lt;key&gt; &lt;field&gt; </code></pre></p> <p>4\uff09\u5224\u65ad\u96c6\u5408\u4e2d\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684 field <pre><code>127.0.0.1:6379&gt; hexists &lt;key&gt; &lt;field&gt; </code></pre></p> <p>5\uff09\u5217\u51fa\u96c6\u5408\u4e2d\u6240\u6709\u7684 field <pre><code>127.0.0.1:6379&gt; hkeys &lt;key&gt; </code></pre></p> <p>6\uff09\u5217\u51fa\u96c6\u5408\u4e2d\u6240\u6709\u7684 value <pre><code>127.0.0.1:6379&gt; hvals &lt;key&gt; </code></pre></p> <p>7\uff09\u7ed9\u96c6\u5408\u4e2d\u6307\u5b9a filed \u7684 value \u503c\u589e\u52a0 increment <pre><code>127.0.0.1:6379&gt; hincrby  &lt;key&gt; &lt;field&gt; &lt;increment&gt; </code></pre></p>"},{"location":"db/redis/rd_05/","title":"\u7b2c5\u7ae0 Redis\u7684\u76f8\u5173\u914d\u7f6e","text":"<p>1\uff09\u8ba1\u91cf\u5355\u4f4d\u8bf4\u660e,\u5927\u5c0f\u5199\u4e0d\u654f\u611f \u8ba1\u91cf\u5355\u4f4d<pre><code># 1k =&gt; 1000 bytes\n# 1kb =&gt; 1024 bytes\n# 1m =&gt; 1000000 bytes\n# 1mb =&gt; 1024*1024 bytes\n# 1g =&gt; 1000000000 bytes\n# 1gb =&gt; 1024*1024*1024 bytes\n</code></pre></p> <p>2\uff09bind \u9ed8\u8ba4\u60c5\u51b5 <code>bind=127.0.0.1</code> \u53ea\u80fd\u63a5\u53d7\u672c\u673a\u7684\u8bbf\u95ee\u8bf7\u6c42 \u4e0d\u5199\u7684\u60c5\u51b5\u4e0b\uff0c\u65e0\u9650\u5236\u63a5\u53d7\u4efb\u4f55 ip \u5730\u5740\u7684\u8bbf\u95ee\uff0c\u751f\u4ea7\u73af\u5883\u80af\u5b9a\u8981\u5199\u4f60\u5e94\u7528\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u5982\u679c\u5f00\u542f\u4e86 protected-mode\uff0c\u90a3\u4e48\u5728\u6ca1\u6709\u8bbe\u5b9a bind ip \u4e14\u6ca1\u6709\u8bbe\u5bc6\u7801\u7684\u60c5\u51b5\u4e0b\uff0cRedis \u53ea\u5141\u8bb8\u63a5\u53d7\u672c\u673a\u7684\u8bf7\u6c42 redis.conf<pre><code>#bind 127.0.0.1\nprotected-mode no\n</code></pre></p> <p>3\uff09port \u670d\u52a1\u7aef\u53e3\u53f7 redis.conf<pre><code>port 6379\n</code></pre></p> <p>4\uff09daemonize \u662f\u5426\u4e3a\u540e\u53f0\u8fdb\u7a0b redis.conf<pre><code>daemonize yes\n</code></pre></p> <p>5\uff09pidfile \u5b58\u653e pid \u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e0d\u540c\u7684 pid \u6587\u4ef6 redis.conf<pre><code>pidfile /var/run/redis_6379.pid\n</code></pre></p> <p>6\uff09log file \u65e5\u5fd7\u6587\u4ef6\u5b58\u50a8\u4f4d\u7f6e redis.conf<pre><code>logfile \"\"\n</code></pre></p> <p>7\uff09database \u8bbe\u5b9a\u5e93\u7684\u6570\u91cf \u9ed8\u8ba416 redis.conf<pre><code>databases 16\n</code></pre></p> <p>8\uff09requirepass \u8bbe\u7f6e\u5bc6\u7801 redis.conf<pre><code>requirepass 123456\n</code></pre></p> <p>9\uff09maxmemory \u8bbe\u7f6e Redis \u53ef\u4ee5\u4f7f\u7528\u7684\u5185\u5b58\u91cf\u3002\u4e00 \u65e6\u5230\u8fbe\u5185\u5b58\u4f7f\u7528\u4e0a\u9650\uff0cRedis \u5c06\u4f1a\u8bd5\u56fe\u79fb\u9664\u5185\u90e8\u6570\u636e\uff0c\u79fb\u9664\u89c4\u5219\u53ef\u4ee5\u901a\u8fc7 maxmemory-policy \u6765\u6307\u5b9a\u3002\u5982\u679c Redis \u65e0\u6cd5\u6839\u636e\u79fb\u9664\u89c4\u5219\u6765\u79fb\u9664\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u6216\u8005\u8bbe\u7f6e\u4e86\u201c\u4e0d\u5141\u8bb8\u79fb\u9664\u201d\uff0c \u90a3\u4e48 Redis \u5219\u4f1a\u9488\u5bf9\u90a3\u4e9b\u9700\u8981\u7533\u8bf7\u5185\u5b58\u7684\u6307\u4ee4\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u6bd4\u5982 SET\u3001LPUSH \u7b49\u3002 redis.conf<pre><code>maxmemory &lt;bytes&gt;\n</code></pre></p> <p>10\uff09maxmemory-policy</p> <p>\u79fb\u9664\u7b56\u7565</p> redis.conf<pre><code>maxmemory-policy noeviction \n</code></pre> maxmemory-policy \u8bf4\u660e volatile-lru \u4f7f\u7528 LRU \u7b97\u6cd5\u79fb\u9664 key\uff0c\u53ea\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e allkeys-lru \u4f7f\u7528 LRU \u7b97\u6cd5\u79fb\u9664 key volatile-lfu \u4f7f\u7528 LFU \u7b56\u7565\u79fb\u9664 key,\u53ea\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e allkeys-lfu \u4f7f\u7528 LFU \u7b56\u7565\u79fb\u9664 key volatile-random \u5728\u8fc7\u671f\u96c6\u5408\u4e2d\u79fb\u9664\u968f\u673a\u7684 key\uff0c\u53ea\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e allkeys-random \u79fb\u9664\u968f\u673a\u7684 key volatile-ttl \u79fb\u9664\u90a3\u4e9b TTL \u503c\u6700\u5c0f\u7684 key\uff0c\u5373\u90a3\u4e9b\u6700\u8fd1\u8981\u8fc7\u671f\u7684 key noeviction \u4e0d\u8fdb\u884c\u79fb\u9664\u3002\u9488\u5bf9\u5199\u64cd\u4f5c\uff0c\u53ea\u662f\u8fd4\u56de\u9519\u8bef\u4fe1\u606f <p>11\uff09maxmemory-samples</p> <p>\u8bbe\u7f6e\u6837\u672c\u6570\u91cf\uff0cLRU \u7b97\u6cd5\u548c\u6700\u5c0f TTL \u7b97\u6cd5\u90fd\u5e76\u975e\u662f\u7cbe\u786e\u7684\u7b97\u6cd5\uff0c\u800c\u662f\u4f30\u7b97\u503c\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u6837\u672c\u7684\u5927\u5c0f\u3002\u4e00\u822c\u8bbe\u7f6e 3 \u5230 7 \u7684\u6570\u5b57\uff0c\u6570\u503c\u8d8a\u5c0f\u6837\u672c\u8d8a\u4e0d\u51c6\u786e\uff0c\u4f46\u662f\u6027\u80fd\u6d88\u8017\u4e5f\u8d8a\u5c0f\u3002</p> redis.conf<pre><code>maxmemory-samples 5\n</code></pre>"},{"location":"db/redis/rd_06/","title":"\u7b2c6\u7ae0 Jedis","text":"<p>Jedis \u662f Redis \u7684 Java \u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u901a\u8fc7 Java \u4ee3\u7801\u7684\u65b9\u5f0f\u64cd\u4f5c Redis</p>"},{"location":"db/redis/rd_06/#61","title":"6.1 \u73af\u5883\u51c6\u5907","text":"<p>1\uff09\u6dfb\u52a0\u4f9d\u8d56</p> pom<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;redis.clients&lt;/groupId&gt;\n&lt;artifactId&gt;jedis&lt;/artifactId&gt;\n&lt;version&gt;3.3.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"db/redis/rd_06/#62","title":"6.2 \u57fa\u672c\u6d4b\u8bd5","text":"<p>1\uff09\u6d4b\u8bd5\u8fde\u901a</p> <pre><code>public class JedisTest {\npublic static void main(String[] args) {\nJedis jedis = new Jedis(\"hadoop102\",6379);\nString ping = jedis.ping();\nSystem.out.println(ping);\n}\n}\n</code></pre> <p>2\uff09\u8fde\u63a5\u6c60</p> <p>\u8fde\u63a5\u6c60\u4e3b\u8981\u7528\u6765\u8282\u7701\u6bcf\u6b21\u8fde\u63a5 redis \u670d\u52a1\u5e26\u6765\u7684\u8fde\u63a5\u6d88\u8017\uff0c\u5c06\u8fde\u63a5\u597d\u7684\u5b9e\u4f8b\u53cd\u590d\u5229\u7528</p> <pre><code>public static JedisPool pool =  null ;\n\npublic static Jedis getJedis(){\nif(pool == null ){\n//\u4e3b\u8981\u914d\u7f6e\nJedisPoolConfig jedisPoolConfig =new JedisPoolConfig();\njedisPoolConfig.setMaxTotal(10); //\u6700\u5927\u53ef\u7528\u8fde\u63a5\u6570\njedisPoolConfig.setMaxIdle(5); //\u6700\u5927\u95f2\u7f6e\u8fde\u63a5\u6570\njedisPoolConfig.setMinIdle(5); //\u6700\u5c0f\u95f2\u7f6e\u8fde\u63a5\u6570\njedisPoolConfig.setBlockWhenExhausted(true); //\u8fde\u63a5\u8017\u5c3d\u662f\u5426\u7b49\u5f85\njedisPoolConfig.setMaxWaitMillis(2000); //\u7b49\u5f85\u65f6\u95f4\njedisPoolConfig.setTestOnBorrow(true); //\u53d6\u8fde\u63a5\u7684\u65f6\u5019\u8fdb\u884c\u4e00\u4e0b\u6d4b\u8bd5 ping pong\npool = new JedisPool(jedisPoolConfig,\"hadoop102\",6379) ;\n}\n\nreturn pool.getResource();\n}   public static void main(String[] args) {\n//Jedis jedis = new Jedis(\"hadoop202\",6379);\nJedis jedis = getJedis();\nString ping = jedis.ping();\nSystem.out.println(ping);\n}\n</code></pre>"},{"location":"db/redis/rd_07/","title":"\u7b2c7\u7ae0 Redis \u6301\u4e45\u5316","text":""},{"location":"db/redis/rd_07/#71","title":"7.1 \u4e24\u79cd\u65b9\u5f0f","text":"<p>Redis \u63d0\u4f9b\u4e86 2 \u4e2a\u4e0d\u540c\u5f62\u5f0f\u7684\u6301\u4e45\u5316\u65b9\u5f0f  RDB  \u548c  AOF\u3002</p> <p>RDB \u4e3a\u5feb\u7167\u5907\u4efd\uff0c\u4f1a\u5728\u5907\u4efd\u65f6\u5c06\u5185\u5b58\u4e2d\u7684\u6240\u6709\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002</p> <p>AOF \u4e3a\u65e5\u5fd7\u5907\u4efd\uff0c\u4f1a\u5c06\u6240\u6709\u5199\u64cd\u4f5c\u547d\u4ee4\u8bb0\u5f55\u5728\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"db/redis/rd_07/#72-rdbredis-database","title":"7.2 RDB\uff08Redis Database\uff09","text":""},{"location":"db/redis/rd_07/#721","title":"7.2.1 \u662f\u4ec0\u4e48","text":"<p>\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5185\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u96c6\u5feb\u7167\u5199\u5165\u78c1\u76d8\uff0c\u4e5f\u5c31\u662f\u884c\u8bdd\u8bb2\u7684 Snapshot \u5feb\u7167\uff0c\u5b83\u6062\u590d\u65f6\u662f\u5c06\u5feb\u7167\u6587\u4ef6\u76f4\u63a5\u8bfb\u5230\u5185\u5b58\u91cc\u3002</p>"},{"location":"db/redis/rd_07/#722","title":"7.2.2 \u5982\u4f55\u6267\u884c\u6301\u4e45\u5316","text":"<p>Redis \u4f1a\u5355\u72ec\u521b\u5efa\uff08fork\uff09\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u4f1a\u5148\u5c06\u6570\u636e\u5199\u5165\u5230\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u4e2d\uff0c\u5f85\u6301\u4e45\u5316\u8fc7\u7a0b\u90fd\u7ed3\u675f\u4e86\uff0c\u518d\u7528\u8fd9\u4e2a\u4e34\u65f6\u6587\u4ef6\u66ff\u6362\u4e0a\u6b21\u6301\u4e45\u5316\u597d\u7684\u6587\u4ef6\u3002\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8fdb\u7a0b\u662f\u4e0d\u8fdb\u884c\u4efb\u4f55 IO \u64cd\u4f5c\u7684\uff0c\u8fd9\u5c31\u786e\u4fdd\u4e86\u6781\u9ad8\u7684\u6027\u80fd\u5982\u679c\u9700\u8981\u8fdb\u884c\u5927\u89c4\u6a21\u6570\u636e\u7684\u6062\u590d\uff0c\u4e14\u5bf9\u4e8e\u6570\u636e\u6062\u590d\u7684\u5b8c\u6574\u6027\u4e0d\u662f\u975e\u5e38\u654f\u611f\uff0c\u90a3 RDB \u65b9\u5f0f\u8981\u6bd4 AOF \u65b9\u5f0f\u66f4\u52a0\u7684\u9ad8\u6548\u3002RDB \u7684\u7f3a\u70b9\u662f\u6700\u540e\u4e00\u6b21\u6301\u4e45\u5316\u540e\u7684\u6570\u636e\u53ef\u80fd\u4e22\u5931\u3002</p>"},{"location":"db/redis/rd_07/#723-rdb","title":"7.2.3 RDB\u6587\u4ef6","text":"<p>1\uff09RDB \u4fdd\u5b58\u7684\u6587\u4ef6</p> <p>\u5728 redis.conf \u4e2d\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3a dump.rdb redis.conf<pre><code> dbfilename dump.rdb\n</code></pre> 2\uff09RDB \u6587\u4ef6\u7684\u4fdd\u5b58\u8def\u5f84</p> <p>\u9ed8\u8ba4\u4e3a Redis \u542f\u52a8\u65f6\u547d\u4ee4\u884c\u6240\u5728\u7684\u76ee\u5f55\u4e0b,\u4e5f\u53ef\u4ee5\u4fee\u6539</p> redis.conf<pre><code>dir ./\n</code></pre>"},{"location":"db/redis/rd_07/#724-rdb","title":"7.2.4 RDB\u4fdd\u5b58\u7b56\u7565","text":"redis.conf<pre><code>#   save &lt;seconds&gt; &lt;changes&gt;\n\n#   Will save the DB if both the given number of seconds and the given \n#   number of write operations against the DB occurred.\n#\n#   In the example below the behaviour will be to save:\n#   after 900 sec (15 min) if at least 1 key changed\n#   after 300 sec (5 min) if at least 10 keys changed\n#   after 60 sec if at least 10000 keys changed\n#   Note: you can disable saving completely by commenting out all \"save\" lines.\nsave 900 1\nsave 300 10\nsave 60 10000\n</code></pre>"},{"location":"db/redis/rd_07/#725","title":"7.2.5 \u624b\u52a8\u4fdd\u5b58","text":"\u547d\u4ee4 \u8bf4\u660e save \u53ea\u7ba1\u4fdd\u5b58\uff0c\u5176\u5b83\u4e0d\u7ba1\uff0c\u5168\u90e8\u963b\u585e bgsave \u6309\u7167\u4fdd\u5b58\u7b56\u7565\u81ea\u52a8\u4fdd\u5b58 shutdown \u670d\u52a1\u4f1a\u7acb\u523b\u6267\u884c\u5907\u4efd\u540e\u518d\u5173\u95ed flushall \u5c06\u6e05\u7a7a\u540e\u7684\u6570\u636e\u5907\u4efd"},{"location":"db/redis/rd_07/#726-rdb","title":"7.2.6 RDB\u5907\u4efd\u6062\u590d","text":"<p>1\uff09\u5907\u4efd</p> <p>\u5c06 dump.rdb \u6587\u4ef6\u62f7\u8d1d\u5230\u8981\u5907\u4efd\u7684\u4f4d\u7f6e</p> <p>2\uff09\u6062\u590d \u5173\u95ed Redis\uff0c\u628a\u5907\u4efd\u7684\u6587\u4ef6\u62f7\u8d1d\u5230\u5de5\u4f5c\u76ee\u5f55\u4e0b,\u542f\u52a8 redis,\u5907\u4efd\u6570\u636e\u4f1a\u76f4\u63a5\u52a0\u8f7d\u3002</p>"},{"location":"db/redis/rd_07/#727-rdb","title":"7.2.7 RDB\u5176\u4ed6\u914d\u7f6e","text":"<p>1\uff09\u8fdb\u884c RDB \u4fdd\u5b58\u65f6\uff0c\u5c06\u6587\u4ef6\u538b\u7f29 redis.conf<pre><code>rdbcompression yes\n</code></pre></p> <p>2\uff09\u6587\u4ef6\u6821\u9a8c </p> <p>\u5728\u5b58\u50a8\u5feb\u7167\u540e\uff0c\u8fd8\u53ef\u4ee5\u8ba9 Redis \u4f7f\u7528 CRC64 \u7b97\u6cd5\u6765\u8fdb\u884c\u6570\u636e\u6821\u9a8c\uff0c\u4f46\u662f\u8fd9\u6837\u505a\u4f1a\u589e\u52a0\u5927\u7ea6 10% \u7684\u6027\u80fd\u6d88\u8017\uff0c\u5982\u679c\u5e0c\u671b\u83b7\u53d6\u5230\u6700\u5927\u7684\u6027\u80fd\u63d0\u5347\uff0c\u53ef\u4ee5\u5173\u95ed\u6b64\u529f\u80fd redis.conf<pre><code>rdbchecksum yes\n</code></pre></p>"},{"location":"db/redis/rd_07/#728-rdb","title":"7.2.8 RDB\u4f18\u7f3a\u70b9","text":"<p>1\uff09\u4f18\u70b9: </p> <p>\u8282\u7701\u78c1\u76d8\u7a7a\u95f4,\u6062\u590d\u901f\u5ea6\u5feb</p> <p>2\uff09\u7f3a\u70b9: </p> <p>\u867d\u7136 Redis \u5728 fork \u65f6\u4f7f\u7528\u4e86\u5199\u65f6\u62f7\u8d1d\u6280\u672f,\u4f46\u662f\u5982\u679c\u6570\u636e\u5e9e\u5927\u65f6\u8fd8\u662f\u6bd4\u8f83\u6d88\u8017\u6027\u80fd\u3002\u5728\u5907\u4efd\u5468\u671f\u5728\u4e00\u5b9a\u95f4\u9694\u65f6\u95f4\u505a\u4e00\u6b21\u5907\u4efd\uff0c\u6240\u4ee5\u5982\u679c Redis \u610f\u5916 down \u6389\u7684\u8bdd\uff0c\u5c31\u4f1a\u4e22\u5931\u6700\u540e\u4e00\u6b21\u5feb\u7167\u540e\u7684\u6240\u6709\u4fee\u6539</p>"},{"location":"db/redis/rd_07/#73-aofappend-only-file","title":"7.3 AOF\uff08Append Only File\uff09","text":""},{"location":"db/redis/rd_07/#731","title":"7.3.1 \u662f\u4ec0\u4e48","text":"<p>\u4ee5\u65e5\u5fd7\u7684\u5f62\u5f0f\u6765\u8bb0\u5f55\u6bcf\u4e2a\u5199\u64cd\u4f5c\uff0c\u5c06 Redis \u6267\u884c\u8fc7\u7684\u6240\u6709\u5199\u6307\u4ee4\u8bb0\u5f55\u4e0b\u6765(\u8bfb\u64cd\u4f5c\u4e0d\u8bb0\u5f55)\uff0c\u53ea\u8bb8\u8ffd\u52a0\u6587\u4ef6\u4f46\u4e0d\u53ef\u4ee5\u6539\u5199\u6587\u4ef6\uff0cRedis \u542f\u52a8\u4e4b\u521d\u4f1a\u8bfb\u53d6\u8be5\u6587\u4ef6\u91cd\u65b0\u6784\u5efa\u6570\u636e\uff0c\u6362\u8a00\u4e4b\uff0cRedis \u91cd\u542f\u7684\u8bdd\u5c31\u6839\u636e\u65e5\u5fd7\u6587\u4ef6\u7684\u5185\u5bb9\u5c06\u5199\u6307\u4ee4\u4ece\u524d\u5230\u540e\u6267\u884c\u4e00\u6b21\u4ee5\u5b8c\u6210\u6570\u636e\u7684\u6062\u590d\u5de5\u4f5c\u3002</p>"},{"location":"db/redis/rd_07/#732-aof","title":"7.3.2 \u5f00\u542fAOF","text":"<p>1\uff09AOF \u9ed8\u8ba4\u4e0d\u5f00\u542f\uff0c\u9700\u8981\u624b\u52a8\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e redis.conf<pre><code>appendonly no\n</code></pre> 2\uff09AOF \u6587\u4ef6 redis.conf<pre><code>appendfilename \"appendonly.aof\"\n</code></pre> 3\uff09AOF \u6587\u4ef6\u4fdd\u5b58\u7684\u4f4d\u7f6e\uff0c\u4e0e RDB \u7684\u8def\u5f84\u4e00\u81f4 redis.conf<pre><code>dir ./\n</code></pre></p>"},{"location":"db/redis/rd_07/#733-aof","title":"7.3.3 AOF\u540c\u6b65\u9891\u7387","text":"redis.conf<pre><code># no: don't fsync, just let the OS flush the data when it wants. Faster.\n# always: fsync after every write to the append only log. Slow, Safest.\n# everysec: fsync only one time every second. Compromise.\n</code></pre>"},{"location":"db/redis/rd_07/#734-aof","title":"7.3.4 AOF\u6587\u4ef6\u635f\u574f\u6062\u590d","text":"<pre><code>redis-check-aof  --fix  appendonly.aof      </code></pre>"},{"location":"db/redis/rd_07/#735-aof","title":"7.3.5 AOF\u5907\u4efd","text":"<p>AOF \u7684\u5907\u4efd\u673a\u5236\u548c\u6027\u80fd\u867d\u7136\u548c RDB \u4e0d\u540c, \u4f46\u662f\u5907\u4efd\u548c\u6062\u590d\u7684\u64cd\u4f5c\u540c RDB \u4e00\u6837\uff0c\u90fd\u662f\u62f7\u8d1d\u5907\u4efd\u6587\u4ef6\uff0c\u9700\u8981\u6062\u590d\u65f6\u518d\u62f7\u8d1d\u5230 Redis \u5de5\u4f5c\u76ee\u5f55\u4e0b\uff0c\u542f\u52a8\u7cfb\u7edf\u5373\u52a0\u8f7d</p>"},{"location":"db/redis/rd_07/#736-rewrite","title":"7.3.6 Rewrite","text":"<p>AOF \u91c7\u7528\u6587\u4ef6\u8ffd\u52a0\u65b9\u5f0f\uff0c\u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\u4e3a\u907f\u514d\u51fa\u73b0\u6b64\u79cd\u60c5\u51b5\uff0c\u65b0\u589e\u4e86\u91cd\u5199\u673a\u5236,\u5f53 AOF \u6587\u4ef6\u7684\u5927\u5c0f\u8d85\u8fc7\u6240\u8bbe\u5b9a\u7684\u9608\u503c\u65f6\uff0cRedis \u5c31\u4f1a\u542f\u52a8 AOF \u6587\u4ef6\u7684\u91cd\u5199\uff0c\u53ea\u4fdd\u7559\u53ef\u4ee5\u6062\u590d\u6570\u636e\u7684\u6700\u5c0f\u6307\u4ee4\u96c6.\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 bgrewriteaof \u624b\u52a8\u5f00\u59cb\u91cd\u5199\u3002</p> <p>\u91cd\u5199\u867d\u7136\u53ef\u4ee5\u8282\u7ea6\u5927\u91cf\u78c1\u76d8\u7a7a\u95f4\uff0c\u51cf\u5c11\u6062\u590d\u65f6\u95f4\u3002\u4f46\u662f\u6bcf\u6b21\u91cd\u5199\u8fd8\u662f\u6709\u4e00\u5b9a\u7684\u8d1f\u62c5\u7684\uff0c\u56e0\u6b64\u8bbe\u5b9aRedis \u8981\u6ee1\u8db3\u4e00\u5b9a\u6761\u4ef6\u624d\u4f1a\u8fdb\u884c\u91cd\u5199\u3002</p> <p>\u7cfb\u7edf\u8f7d\u5165\u65f6\u6216\u8005\u4e0a\u6b21\u91cd\u5199\u5b8c\u6bd5\u65f6\uff0cRedis \u4f1a\u8bb0\u5f55\u6b64\u65f6 AOF \u5927\u5c0f\uff0c\u8bbe\u4e3a base_size,\u5982\u679c Redis \u7684 AOF \u5f53\u524d\u5927\u5c0f &gt;=  base_size + base_size * 100% (\u9ed8\u8ba4) \u4e14\u5f53\u524d\u5927\u5c0f &gt;= 64mb(\u9ed8\u8ba4) \u7684\u60c5\u51b5\u4e0b\uff0cRedis \u4f1a\u5bf9AOF\u8fdb\u884c\u91cd\u5199\u3002</p> redis.conf<pre><code>auto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n</code></pre>"},{"location":"db/redis/rd_07/#737-aof","title":"7.3.7 AOF\u7684\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9: 1. \u5907\u4efd\u673a\u5236\u66f4\u7a33\u5065\uff0c\u4e22\u5931\u6570\u636e\u6982\u7387\u66f4\u4f4e\u3002 2. \u53ef\u8bfb\u7684\u65e5\u5fd7\u6587\u672c\uff0c\u901a\u8fc7\u64cd\u4f5cAOF\u6587\u4ef6\uff0c\u53ef\u4ee5\u5904\u7406\u8bef\u64cd\u4f5c\u3002</p> <p>\u7f3a\u70b9: 1. \u6bd4\u8d77RDB\u5360\u7528\u66f4\u591a\u7684\u78c1\u76d8\u7a7a\u95f4 2. \u6062\u590d\u5907\u4efd\u901f\u5ea6\u8981\u6162 3. \u6bcf\u6b21\u5199\u90fd\u540c\u6b65\u7684\u8bdd\uff0c\u6709\u4e00\u5b9a\u7684\u6027\u80fd\u538b\u529b 4. \u5b58\u5728\u4e2a\u522b bug\uff0c\u9020\u6210\u4e0d\u80fd\u6062\u590d</p>"},{"location":"db/redis/rd_07/#74","title":"7.4 \u6301\u4e45\u5316\u7684\u4f18\u5148\u7ea7","text":"<p>AOF \u7684\u4f18\u5148\u7ea7\u5927\u4e8e RDB\uff0c\u5982\u679c\u540c\u65f6\u5f00\u542f\u4e86 AOF \u548c RDB\uff0cRedis \u670d\u52a1\u542f\u52a8\u65f6\u6062\u590d\u6570\u636e\u4ee5 AOF \u4e3a\u51c6\u3002</p>"},{"location":"db/redis/rd_07/#75-rdbaof","title":"7.5 RDB\u548cAOF\u7528\u54ea\u4e2a\u597d","text":"<ul> <li>\u5b98\u65b9\u63a8\u8350\u4e24\u4e2a\u90fd\u542f\u7528\u3002</li> <li>\u5982\u679c\u5bf9\u6570\u636e\u4e0d\u654f\u611f\uff0c\u53ef\u4ee5\u9009\u5355\u72ec\u7528RDB</li> <li>\u4e0d\u5efa\u8bae\u5355\u72ec\u7528 AOF\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u51fa\u73b0Bug\u3002</li> <li>\u5982\u679c\u53ea\u662f\u505a\u7eaf\u5185\u5b58\u7f13\u5b58\uff0c\u53ef\u4ee5\u90fd\u4e0d\u7528</li> </ul>"},{"location":"engine/flink/flink_01/","title":"\u7b2c 1 \u7ae0 \u521d\u8bc6 Flink","text":"<p>Flink \u662f Apache \u57fa\u91d1\u4f1a\u65d7\u4e0b\u7684\u4e00\u4e2a\u5f00\u6e90\u5927\u6570\u636e\u5904\u7406\u6846\u67b6\u3002\u76ee\u524d\uff0cFlink \u5df2\u7ecf\u6210\u4e3a\u5404\u5927\u516c\u53f8 \u5927\u6570\u636e\u5b9e\u65f6\u5904\u7406\u7684\u53d1\u529b\u91cd\u70b9\uff0c\u7279\u522b\u662f\u56fd\u5185\u4ee5\u963f\u91cc\u4e3a\u4ee3\u8868\u7684\u4e00\u4f17\u4e92\u8054\u7f51\u5927\u5382\u90fd\u5728\u5168\u529b\u6295\u5165\uff0c\u4e3a Flink \u793e\u533a\u8d21\u732e\u4e86\u5927\u91cf\u6e90\u7801\u3002\u5982\u4eca Flink \u5df2\u88ab\u5f88\u591a\u4eba\u8ba4\u4e3a\u662f\u5927\u6570\u636e\u5b9e\u65f6\u5904\u7406\u7684\u65b9\u5411\u548c\u672a\u6765\uff0c\u8bb8\u591a\u516c\u53f8\u4e5f\u90fd\u5728\u62db\u8058\u548c\u50a8\u5907\u638c\u63e1 Flink \u6280\u672f\u7684\u4eba\u624d\u3002</p> <p>Question</p> <p>\u90a3 Flink \u5230\u5e95\u662f\u4ec0\u4e48\uff0c\u53c8\u6709\u4ec0\u4e48\u6837\u7684\u4f18\u70b9\uff0c\u80fd\u591f\u8ba9\u5927\u5bb6\u5bf9\u5b83\u5982\u6b64\u9752\u7750\u5462\uff1f</p> <p>\u672c\u7ae0\u6211\u4eec\u5c31\u6765\u505a\u4e00\u4e2a\u8be6\u7ec6\u7684\u4e86\u89e3\u3002\u9996\u5148\u8bb2\u8ff0 Flink \u7684\u6e90\u8d77\u548c\u8bbe\u8ba1\u7406\u5ff5\uff0c\u63a5\u7740\u4ecb\u7ecd Flink \u5982\u4eca\u7684\u5e94\u7528\u9886\u57df\uff1b\u8fdb\u800c\u901a\u8fc7\u68b3\u7406\u6570\u636e\u5904\u7406\u67b6\u6784\u7684\u53d1\u5c55\u6f14\u53d8\uff0c\u89e3\u7b54\u4e3a\u4ec0\u4e48\u8981\u7528 Flink \u7684\u7591\u95ee\u3002\u8fdb\u800c\u68b3\u7406 Flink \u7684\u7279\u70b9\uff0c\u5e76\u540c\u53e6\u4e00\u4e2a\u6d41\u884c\u7684\u5927\u6570\u636e\u5904\u7406\u6846\u67b6 Spark \u8fdb\u884c\u6bd4\u8f83\uff0c\u4ece\u800c\u66f4\u6df1\u523b\u5730\u7406\u89e3 Flink \u7684\u5e95\u5c42\u67b6\u6784\u548c\u4f18\u52bf\u6240\u5728\u3002</p>"},{"location":"engine/flink/flink_01/#11-flink","title":"1.1 Flink \u7684\u6e90\u8d77\u548c\u8bbe\u8ba1\u7406\u5ff5","text":"<p>Flink \u8d77\u6e90\u4e8e\u4e00\u4e2a\u53eb\u4f5c Stratosphere \u7684\u9879\u76ee\uff0c\u5b83\u662f\u7531 3 \u6240\u5730\u5904\u67cf\u6797\u7684\u5927\u5b66\u548c\u6b27\u6d32\u5176\u4ed6\u4e00\u4e9b\u5927\u5b66\u5728 2010 ~ 2014 \u5e74\u5171\u540c\u8fdb\u884c\u7684\u7814\u7a76\u9879\u76ee\uff0c\u7531\u67cf\u6797\u7406\u5de5\u5927\u5b66\u7684\u6559\u6388\u6c83\u514b\u5c14\u00b7\u9a6c\u5c14\u79d1\uff08Volker Markl\uff09 \u9886\u8854\u5f00\u53d1\u30022014 \u5e74 4 \u6708\uff0cStratosphere \u7684\u4ee3\u7801\u88ab\u590d\u5236\u5e76\u6350\u8d60\u7ed9\u4e86 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\uff0cFlink \u5c31\u662f\u5728\u6b64\u57fa\u7840\u4e0a\u88ab\u91cd\u65b0\u8bbe\u8ba1\u51fa\u6765\u7684\u3002</p> <p>\u5728\u5fb7\u8bed\u4e2d\uff0c<code>flink</code> \u4e00\u8bcd\u8868\u793a\u201c\u5feb\u901f\u3001\u7075\u5de7\u201d\u3002\u9879\u76ee\u7684 logo \u662f\u4e00\u53ea\u5f69\u8272\u7684\u677e\u9f20\uff0c\u5f53\u7136\u4e86\uff0c \u8fd9\u4e0d\u4ec5\u662f\u56e0\u4e3a Apache \u5927\u6570\u636e\u9879\u76ee\u5bf9\u52a8\u7269\u7684\u559c\u597d\uff08\u662f\u5426\u8054\u60f3\u5230\u4e86 Hadoop\u3001Hive\uff1f\uff09\uff0c\u66f4\u662f\u56e0\u4e3a\u677e\u9f20\u8fd9\u79cd\u5c0f\u52a8\u7269\u5b8c\u7f8e\u5730\u4f53\u73b0\u4e86\u201c\u5feb\u901f\u3001\u7075\u5de7\u201d\u7684\u7279\u70b9\u3002\u5173\u4e8e logo \u7684\u989c\u8272\uff0c\u8fd8\u4e00\u4e2a\u6709\u8da3\u7684\u7f18\u7531\uff1a \u67cf\u6797\u5f53\u5730\u7684\u677e\u9f20\u975e\u5e38\u6f02\u4eae\uff0c\u989c\u8272\u662f\u8ff7\u4eba\u7684\u7ea2\u68d5\u8272\uff1b\u800c Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684 logo\uff0c\u521a\u597d\u4e5f\u662f\u4e00 \u6839\u4ee5\u7ea2\u68d5\u8272\u4e3a\u4e3b\u7684\u6e10\u53d8\u8272\u7fbd\u6bdb\u3002\u4e8e\u662f\uff0cFlink \u7684\u677e\u9f20 logo \u5c31\u8bbe\u8ba1\u6210\u4e86\u7ea2\u68d5\u8272\uff0c\u800c\u4e14\u62e5\u6709\u4e00\u4e2a\u6f02\u4eae\u7684\u6e10\u53d8\u8272\u5c3e\u5df4\uff0c\u5c3e\u5df4\u7684\u914d\u8272\u4e0e Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684 logo \u4e00\u81f4\u3002\u8fd9\u53ea\u677e\u9f20\u8272\u5f69\u70ab\u76ee\uff0c\u65e2\u547c\u5e94\u4e86 Apache \u7684\u98ce\u683c\uff0c\u4f3c\u4e4e\u4e5f\u9884\u793a\u7740 Flink \u672a\u6765\u5c06\u8981\u5927\u653e\u5f02\u5f69\u3002Flink \u7684 logo \u5982\u56fe 1-1 \u6240\u793a\u3002</p> <p></p> <p>\u4ece\u547d\u540d\u4e0a\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u51fa Flink \u9879\u76ee\u5bf9\u4e8e\u81ea\u8eab\u7279\u70b9\u7684\u5b9a\u4f4d\uff0c\u90a3\u5c31\u662f\u5bf9\u4e8e\u5927\u6570\u636e\u5904\u7406\uff0c\u8981\u505a\u5230\u5feb\u901f\u548c\u7075\u6d3b\u3002</p> <ul> <li>2014 \u5e74 8 \u6708\uff0cFlink \u7b2c\u4e00\u4e2a\u7248\u672c 0.6 \u6b63\u5f0f\u53d1\u5e03\uff08\u81f3\u4e8e 0.5 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u90a3\u5c31\u662f\u5728 Stratosphere \u540d\u4e0b\u7684\u4e86\uff09\u3002\u4e0e\u6b64\u540c\u65f6 Flink \u7684\u51e0\u4f4d\u6838\u5fc3\u5f00\u53d1\u8005\u521b\u529e\u4e86 Data Artisans \u516c\u53f8\uff0c \u4e3b\u8981\u505a Flink \u7684\u5546\u4e1a\u5e94\u7528\uff0c\u5e2e\u52a9\u4f01\u4e1a\u90e8\u7f72\u5927\u89c4\u6a21\u6570\u636e\u5904\u7406\u89e3\u51b3\u65b9\u6848</li> <li>2014 \u5e74 12 \u6708\uff0cFlink \u9879\u76ee\u5b8c\u6210\u4e86\u5b75\u5316\uff0c\u4e00\u8dc3\u6210\u4e3a Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u9879\u76ee</li> <li>2015 \u5e74 4 \u6708\uff0cFlink \u53d1\u5e03\u4e86\u91cc\u7a0b\u7891\u5f0f\u7684\u91cd\u8981\u7248\u672c 0.9.0\uff0c\u5f88\u591a\u56fd\u5185\u5916\u5927\u516c\u53f8\u4e5f\u6b63\u662f\u4ece\u8fd9\u65f6\u5f00\u59cb\u5173\u6ce8\u3001\u5e76\u53c2\u4e0e\u5230 Flink \u793e\u533a\u5efa\u8bbe\u7684</li> <li>2019 \u5e74 1 \u6708\uff0c\u957f\u671f\u5bf9 Flink \u6295\u5165\u7814\u53d1\u7684\u963f\u91cc\u5df4\u5df4\uff0c\u4ee5 9000 \u4e07\u6b27\u5143\u7684\u4ef7\u683c\u6536\u8d2d\u4e86 Data Artisans \u516c\u53f8\uff1b\u4e4b\u540e\u53c8\u5c06\u81ea\u5df1\u7684\u5185\u90e8\u7248\u672c Blink \u5f00\u6e90\uff0c\u7ee7\u800c\u4e0e 8 \u6708\u4efd\u53d1\u5e03\u7684 Flink 1.9.0 \u7248\u672c\u8fdb\u884c\u4e86\u5408\u5e76\u3002\u81ea\u6b64\u4e4b\u540e\uff0cFlink \u88ab\u8d8a\u6765\u8d8a\u591a\u7684\u4eba\u6240\u719f\u77e5\uff0c\u6210\u4e3a\u5f53\u524d\u6700\u706b\u7684\u65b0\u4e00\u4ee3\u5927\u6570\u636e\u5904\u7406\u6846\u67b6</li> </ul> <p>\u7531\u6b64\u53ef\u89c1\uff0cFlink \u4ece\u771f\u6b63\u8d77\u6b65\u5230\u706b\u7206\uff0c\u53ea\u4e0d\u8fc7\u51e0\u5e74\u65f6\u95f4\u3002\u5728\u8fd9\u77ed\u77ed\u51e0\u5e74\u5185\uff0cFlink \u4ece\u6700\u521d\u7684\u7b2c\u4e00\u4e2a\u7a33\u5b9a\u7248\u672c 0.9\uff0c\u5230\u76ee\u524d\u672c\u4e66\u7f16\u5199\u671f\u95f4\u5df2\u7ecf\u53d1\u5e03\u5230\u4e86 1.13.0\uff0c\u8fd9\u671f\u95f4\u4e0d\u65ad\u6709\u65b0\u529f\u80fd\u65b0\u7279\u6027\u52a0\u5165\u3002\u4ece\u4e00\u5f00\u59cb\uff0cFlink \u5c31\u62e5\u6709\u4e00\u4e2a\u975e\u5e38\u6d3b\u8dc3\u7684\u793e\u533a\uff0c\u800c\u4e14\u4e00\u76f4\u5728\u5feb\u901f\u6210\u957f\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0cFlink \u7684\u4ee3\u7801\u8d21\u732e\u8005\uff08Contributors\uff09\u5df2\u7ecf\u8d85\u8fc7 800 \u4eba\uff0c\u5e76\u4e14 Flink \u5df2\u7ecf\u53d1\u5c55\u6210\u4e3a\u6700\u590d\u6742\u7684\u5f00\u6e90\u6d41\u5904\u7406\u5f15\u64ce\u4e4b\u4e00\uff0c\u5f97\u5230\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\u3002</p> <p>\u6839\u636e Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u53d1\u5e03\u7684 2020 \u5e74\u5ea6\u62a5\u544a\uff0cFlink \u9879\u76ee\u7684\u793e\u533a\u53c2\u4e0e\u548c\u8d21\u732e\u4f9d\u65e7\u975e\u5e38\u6d3b\u8dc3\uff0c\u5728 Apache \u65d7\u4e0b\u7684\u4f17\u591a\u9879\u76ee\u4e2d\u4fdd\u6301\u7740\u591a\u9879\u9886\u5148\uff1a</p> <ul> <li>\u90ae\u4ef6\u5217\u8868\uff08Mailing List\uff09\u6d3b\u8dc3\u5ea6\uff0c\u6392\u540d\u7b2c\u4e00</li> <li>\u4ee3\u7801\u63d0\u4ea4\uff08Commits\uff09\u6570\uff0c\u6392\u540d\u7b2c\u4e8c</li> <li>GitHub \u8bbf\u95ee\u91cf\uff0c\u6392\u540d\u7b2c\u4e8c</li> </ul> <p>Flink \u5c31\u50cf\u4e00\u5217\u9ad8\u901f\u884c\u8fdb\u7684\u5217\u8f66\uff0c\u5411\u6211\u4eec\u547c\u5578\u800c\u6765\uff0c\u671d\u7740\u672a\u6765\u66f4\u5b9e\u65f6\u3001\u66f4\u7a33\u5b9a\u7684\u5927\u6570\u636e\u5904\u7406\u5954\u53bb\u3002\u8fd9\u8f86\u901a\u5411\u672a\u6765\u7684\u8f66\uff0c\u6211\u4eec\u4e0a\u8f66\u53ef\u4ee5\u8fdf\uff0c\u4f46\u4e00\u5b9a\u4e0d\u8981\u9519\u8fc7\u3002</p> <p>\u6211\u4eec\u9700\u8981\u8bb0\u4f4f Flink \u7684\u5b98\u7f51\u4e3b\u9875\u5730\u5740\uff1ahttps://flink.apache.org/</p> <p>\u5728 Flink \u5b98\u7f51\u4e3b\u9875\u7684\u9876\u90e8\u53ef\u4ee5\u770b\u5230\uff0c\u9879\u76ee\u7684\u6838\u5fc3\u76ee\u6807\uff0c\u662f\u201c\u6570\u636e\u6d41\u4e0a\u7684\u6709\u72b6\u6001\u8ba1\u7b97\u201d\uff08Stateful Computations over Data Streams\uff09\u3002</p> <p>\u5177\u4f53\u5b9a\u4f4d\u662f\uff1aApache Flink \u662f\u4e00\u4e2a\u6846\u67b6\u548c\u5206\u5e03\u5f0f\u5904\u7406\u5f15\u64ce\uff0c\u5982\u56fe\u6240\u793a\uff0c\u7528\u4e8e\u5bf9\u65e0\u754c\u548c\u6709\u754c\u6570\u636e\u6d41\u8fdb\u884c\u6709\u72b6\u6001\u8ba1\u7b97\u3002Flink \u88ab\u8bbe\u8ba1\u5728\u6240\u6709\u5e38\u89c1\u7684\u96c6\u7fa4\u73af\u5883\u4e2d\u8fd0\u884c\uff0c\u4ee5\u5185\u5b58\u6267\u884c\u901f\u5ea6\u548c\u4efb\u610f\u89c4\u6a21\u6765\u6267\u884c\u8ba1\u7b97\u3002</p> <p></p> <p>\u8fd9\u91cc\u6709\u5f88\u591a\u4e13\u4e1a\u8bcd\u6c47\uff0c\u6211\u4eec\u4ece\u4e2d\u81f3\u5c11\u53ef\u4ee5\u63d0\u70bc\u51fa\u4e00\u4e9b\u5bb9\u6613\u7406\u89e3\u7684\u4fe1\u606f\uff1aFlink \u662f\u4e00\u4e2a\u201c\u6846\u67b6\u201d\uff0c\u662f\u4e00\u4e2a\u6570\u636e\u5904\u7406\u7684\u201c\u5f15\u64ce\u201d\uff1b\u65e2\u7136\u662f\u201c\u5206\u5e03\u5f0f\u201d\uff0c\u5f53\u7136\u662f\u4e3a\u4e86\u5e94\u4ed8\u5927\u89c4\u6a21\u6570\u636e\u7684\u5e94\u7528\u573a\u666f\u4e86\uff1b\u53e6\u5916\uff0cFlink \u5904\u7406\u7684\u662f\u6570\u636e\u6d41\u3002\u6240\u4ee5\uff0cFlink \u662f\u4e00\u4e2a\u6d41\u5f0f\u5927\u6570\u636e\u5904\u7406\u5f15\u64ce\u3002</p> <p>\u800c\u201c\u5185\u5b58\u6267\u884c\u901f\u5ea6\u201d\u548c\u201c\u4efb\u610f\u89c4\u6a21\u201d\uff0c\u7a81\u51fa\u4e86 Flink \u7684\u4e24\u4e2a\u7279\u70b9\uff1a\u901f\u5ea6\u5feb\u3001\u53ef\u6269\u5c55\u6027\u5f3a\u2014\u8fd9\u8bf4\u7684\u81ea\u7136\u5c31\u662f\u5c0f\u677e\u9f20\u7684\u201c\u5feb\u901f\u201d\u548c\u201c\u7075\u5de7\u201d\u4e86\u3002</p> <p>\u90a3\u4ec0\u4e48\u53eb\u4f5c\u201c\u65e0\u754c\u548c\u6709\u754c\u6570\u636e\u6d41\u201d\uff0c\u4ec0\u4e48\u53c8\u53eb\u4f5c\u201c\u6709\u72b6\u6001\u8ba1\u7b97\u201d\u5462\uff1f\u8fd9\u6d89\u53ca\u6d41\u5904\u7406\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u7eed\u7684\u7ae0\u8282\u4e00\u4e00\u5c55\u5f00\u3002</p>"},{"location":"engine/flink/flink_01/#12-flink","title":"1.2 Flink \u7684\u5e94\u7528","text":"<p>Flink \u662f\u4e00\u4e2a\u5927\u6570\u636e\u6d41\u5904\u7406\u5f15\u64ce\uff0c\u5b83\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684\u884c\u4e1a\u63d0\u4f9b\u5927\u6570\u636e\u5b9e\u65f6\u5904\u7406\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u968f\u7740 Flink \u7684\u5feb\u901f\u53d1\u5c55\u5b8c\u5584\uff0c\u5982\u4eca\u5728\u4e16\u754c\u8303\u56f4\u8bb8\u591a\u516c\u53f8\u90fd\u53ef\u4ee5\u89c1\u5230 Flink \u7684\u8eab\u5f71\u3002</p> <p>\u76ee\u524d\u5728\u5168\u7403\u8303\u56f4\u5185\uff0c\u5317\u7f8e\u3001\u6b27\u6d32\u548c\u91d1\u7816\u56fd\u5bb6\u5747\u662f Flink \u7684\u5e94\u7528\u70ed\u95e8\u533a\u57df\u3002\u5f53\u7136\uff0c\u8fd9\u4e9b\u5730\u533a\u5176\u5b9e\u4e5f\u5c31\u662f IT\u3001\u4e92\u8054\u7f51\u884c\u4e1a\u8f83\u53d1\u8fbe\u7684\u5730\u533a\u3002</p> <p>Flink \u5728\u56fd\u5185\u70ed\u5ea6\u5c24\u5176\u9ad8\uff0c\u4e00\u65b9\u9762\u662f\u56e0\u4e3a\u963f\u91cc\u7684\u8d21\u732e\u548c\u5e26\u5934\u6548\u5e94\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u8ddf\u4e2d\u56fd\u7684\u5e94\u7528\u573a\u666f\u5bc6\u5207\u76f8\u5173\u3002\u4e2d\u56fd\u7684\u4eba\u53e3\u89c4\u6a21\u4e0e\u4e92\u8054\u7f51\u4f7f\u7528\u666e\u53ca\u7a0b\u5ea6\uff0c\u51b3\u5b9a\u4e86\u5bf9\u5927\u6570\u636e\u5904\u7406\u7684\u901f\u5ea6\u8981\u6c42\u8d8a\u6765\u8d8a\u9ad8\uff0c\u4e5f\u8feb\u4f7f\u4e2d\u56fd\u7684\u4e92\u8054\u7f51\u4f01\u4e1a\u53bb\u8ffd\u9010\u66f4\u9ad8\u7684\u6570\u636e\u5904\u7406\u6548\u7387\u3002\u8bd5\u60f3\u5728\u4e2d\u56fd\uff0c\u4e00\u4e2a\u7f51\u7ad9\u53ef\u80fd\u8981\u9762\u5bf9\u6570\u4ebf\u7684\u65e5\u6d3b\u7528\u6237\u3001\u6bcf\u79d2\u6570\u4ebf\u6b21\u7684\u8ba1\u7b97\u5cf0\u503c\uff0c\u8fd9\u5bf9\u5f88\u591a\u56fd\u5916\u7684\u516c\u53f8\u6765\u8bf4\u662f\u65e0\u6cd5\u60f3\u8c61\u7684\u3002\u800c Flink \u6070\u597d\u7ed9\u6211\u4eec\u9ad8\u901f\u51c6\u786e\u7684\u5904\u7406\u6d77\u91cf\u6d41\u5f0f\u6570\u636e\u63d0\u4f9b\u4e86\u53ef\u80fd\u3002</p>"},{"location":"engine/flink/flink_01/#121-flink","title":"1.2.1 Flink \u5728\u4f01\u4e1a\u4e2d\u7684\u5e94\u7528","text":"<p>Flink \u4e3a\u5168\u7403\u8bb8\u591a\u516c\u53f8\u548c\u4f01\u4e1a\u7684\u5173\u952e\u4e1a\u52a1\u5e94\u7528\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u652f\u6301\u3002</p> <p>\u5bf9\u4e8e\u6570\u636e\u5904\u7406\u800c\u8a00\uff0c\u4efb\u4f55\u884c\u4e1a\u3001\u4efb\u4f55\u516c\u53f8\u7684\u9700\u6c42\u5176\u5b9e\u90fd\u662f\u4e00\u6837\u7684\uff1a\u6570\u636e\u89c4\u6a21\u5927\u3001\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u3001\u786e\u4fdd\u7ed3\u679c\u51c6\u786e\u3001\u65b9\u4fbf\u6269\u5c55\u3001\u6545\u969c\u540e\u53ef\u6062\u590d\u2014\u2014\u800c\u8fd9\u4e9b\u8981\u6c42\uff0c\u4f5c\u4e3a\u65b0\u4e00\u4ee3\u5927\u6570\u636e\u6d41\u5f0f\u5904\u7406\u5f15\u64ce\u7684 Flink \u7edf\u7edf\u53ef\u4ee5\u6ee1\u8db3\uff01\u8fd9\u4e5f\u6b63\u662f Flink \u5728\u5168\u4e16\u754c\u8303\u56f4\u5f97\u5230\u5e7f\u6cdb\u5e94\u7528\u7684\u539f\u56e0\u3002</p> <p>\u4ee5\u4e0b\u662f Flink \u5b98\u7f51\u5217\u51fa\u7684\u77e5\u540d\u4f01\u4e1a\u7528\u6237\uff0c\u4ed6\u4eec\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6709\u5404\u79cd\u5404\u6837\u6709\u8da3\u7684\u5e94\u7528\u3002</p> <p></p> <p>\u4ee5\u5927\u5bb6\u719f\u6089\u7684\u963f\u91cc\u4e3a\u4f8b\u3002\u963f\u91cc\u5df4\u5df4\u8fd9\u4e2a\u5e9e\u5927\u7684\u7535\u5546\u516c\u53f8\uff0c\u4e3a\u4e70\u65b9\u548c\u5356\u65b9\u63d0\u4f9b\u4e86\u4ea4\u6613\u5e73\u53f0\u3002 \u5b83\u7684\u4e2a\u6027\u5316\u641c\u7d22\u548c\u5b9e\u65f6\u63a8\u8350\u529f\u80fd\u5c31\u662f\u901a\u8fc7 Blink \u5b9e\u73b0\u7684\uff08\u5f53\u7136\u6211\u4eec\u77e5\u9053\uff0cBlink \u5c31\u662f\u57fa\u4e8e Flink \u7684\uff0c\u73b0\u5728\u4e24\u8005\u4e5f\u5df2\u5408\u4f53\uff09\u3002\u7528\u6237\u6240\u8d2d\u4e70\u6216\u8005\u6d4f\u89c8\u7684\u5546\u54c1\uff0c\u53ef\u4ee5\u88ab\u7528\u4f5c\u63a8\u8350\u7684\u4f9d\u636e\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u7ecf\u5e38\u53d1\u73b0\u201c\u521a\u770b\u8fc7\u4ec0\u4e48\u3001\u7f51\u7ad9\u5c31\u63a8\u51fa\u6765\u4e86\u201d\u3002\u5f53\u7528\u6237\u6570\u636e\u91cf\u975e\u5e38\u5e9e\u5927\u65f6\uff0c\u5feb\u901f\u5730\u5206\u6790\u54cd\u5e94\u3001 \u5b9e\u65f6\u505a\u51fa\u7cbe\u51c6\u7684\u63a8\u8350\u5c31\u663e\u5f97\u5c24\u4e3a\u56f0\u96be\u3002\u800c Flink \u8fd9\u6837\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u5927\u6570\u636e\u6d41\u5904\u7406\u5f15\u64ce\uff0c\u5c31\u80fd\u505a\u5230\u8fd9\u4e9b\u3002\u8fd9\u4e5f\u662f\u963f\u91cc\u5728 Flink \u4e0a\u5145\u5206\u53d1\u529b\u5e76\u6210\u4e3a\u5f15\u9886\u8005\u7684\u539f\u56e0\u3002</p>"},{"location":"engine/flink/flink_01/#122-flink","title":"1.2.2 Flink \u4e3b\u8981\u7684\u5e94\u7528\u573a\u666f","text":"<p>Question</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5404\u79cd\u884c\u4e1a\u7684\u4f17\u591a\u516c\u53f8\u90fd\u5728\u4f7f\u7528 Flink\uff0c\u90a3\u5230\u5e95\u4ed6\u4eec\u7528 Flink \u6765\u5904\u7406\u4ec0\u4e48\u9700\u6c42\u5462\uff1f \u6362\u53e5\u8bdd\u8bf4\uff0c\u4ec0\u4e48\u7684\u573a\u666f\u6700\u9002\u5408 Flink \u5927\u663e\u8eab\u624b\u5462\uff1f</p> <p>\u56de\u5230 Flink \u672c\u8eab\u7684\u5b9a\u4f4d\uff0c\u5b83\u662f\u4e00\u4e2a\u5927\u6570\u636e\u6d41\u5f0f\u5904\u7406\u5f15\u64ce\uff0c\u5904\u7406\u7684\u662f\u6d41\u5f0f\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u201c\u6570\u636e\u6d41\u201d\uff08Data Flow\uff09\u3002\u987e\u540d\u601d\u4e49\uff0c\u6570\u636e\u6d41\u7684\u542b\u4e49\u662f\uff0c\u6570\u636e\u5e76\u4e0d\u662f\u6536\u96c6\u597d\u7684\uff0c\u800c\u662f\u50cf\u6c34\u6d41\u4e00\u6837\uff0c \u662f\u4e00\u7ec4\u6709\u5e8f\u7684\u6570\u636e\u5e8f\u5217\uff0c\u9010\u4e2a\u5230\u6765\u3001\u9010\u4e2a\u5904\u7406\u3002\u7531\u4e8e\u6570\u636e\u6765\u5230\u4e4b\u540e\u5c31\u4f1a\u88ab\u5373\u523b\u5904\u7406\uff0c\u6240\u4ee5\u6d41\u5904\u7406\u7684\u4e00\u5927\u7279\u70b9\u5c31\u662f\u201c\u5feb\u901f\u201d\uff0c\u4e5f\u5c31\u662f\u826f\u597d\u7684\u5b9e\u65f6\u6027\u3002Flink \u9002\u5408\u7684\u573a\u666f\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u9700\u8981\u5b9e\u65f6\u5904\u7406\u6570\u636e\u6d41\u7684\u573a\u666f\u3002</p> <p>\u5177\u4f53\u6765\u770b\uff0c\u4e00\u4e9b\u884c\u4e1a\u4e2d\u7684\u5178\u578b\u5e94\u7528\u6709\uff1a</p>"},{"location":"engine/flink/flink_01/#_1","title":"\u7535\u5546\u548c\u5e02\u573a\u8425\u9500","text":"<p>\u4e3e\u4f8b\uff1a\u5b9e\u65f6\u6570\u636e\u62a5\u8868\u3001\u5e7f\u544a\u6295\u653e\u3001\u5b9e\u65f6\u63a8\u8350</p> <p>\u5728\u7535\u5546\u884c\u4e1a\u4e2d\uff0c\u7f51\u7ad9\u70b9\u51fb\u91cf\u662f\u7edf\u8ba1 PV\u3001UV \u7684\u91cd\u8981\u6765\u6e90\uff0c\u4e5f\u662f\u5982\u4eca\u201c\u6d41\u91cf\u7ecf\u6d4e\u201d\u7684\u6700\u4e3b\u8981\u6570\u636e\u6307\u6807\u3002\u5f88\u591a\u516c\u53f8\u7684\u8425\u9500\u7b56\u7565\uff0c\u6bd4\u5982\u5e7f\u544a\u7684\u6295\u653e\uff0c\u4e5f\u662f\u57fa\u4e8e\u70b9\u51fb\u91cf\u6765\u51b3\u5b9a\u7684\u3002\u53e6\u5916\uff0c\u5728\u7f51\u7ad9\u4e0a\u63d0\u4f9b\u7ed9\u7528\u6237\u7684\u5b9e\u65f6\u63a8\u8350\uff0c\u5f80\u5f80\u4e5f\u662f\u57fa\u4e8e\u5f53\u524d\u7528\u6237\u7684\u70b9\u51fb\u884c\u4e3a\u505a\u51fa\u7684\u3002</p> <p>\u7f51\u7ad9\u83b7\u5f97\u7684\u70b9\u51fb\u6570\u636e\u53ef\u80fd\u662f\u8fde\u7eed\u4e14\u4e0d\u5747\u5300\u7684\uff0c\u8fd8\u53ef\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5927\u91cf\u4ea7\u751f\uff0c\u8fd9\u662f\u5178\u578b\u7684\u6570\u636e\u6d41\u3002\u5982\u679c\u6211\u4eec\u5e0c\u671b\u628a\u5b83\u4eec\u5168\u90e8\u6536\u96c6\u8d77\u6765\uff0c\u518d\u53bb\u5206\u6790\u5904\u7406\uff0c\u5c31\u4f1a\u9762\u4e34\u5f88\u591a\u95ee\u9898\uff1a\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u5f88\u5927\u7684\u7a7a\u95f4\u6765\u5b58\u50a8\u6570\u636e\uff1b\u5176\u6b21\uff0c\u6536\u96c6\u6570\u636e\u7684\u8fc7\u7a0b\u8017\u53bb\u4e86\u5927\u91cf\u65f6\u95f4\uff0c\u7edf\u8ba1\u5206\u6790\u7ed3\u679c\u7684\u5b9e\u65f6\u6027\u5c31\u5927\u5927\u964d\u4f4e\u4e86\uff1b\u53e6\u5916\uff0c\u5206\u5e03\u5f0f\u5904\u7406\u65e0\u6cd5\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\uff0c\u5982\u679c\u6211\u4eec\u53ea\u4ee5\u6570\u636e\u8fdb\u5165\u7cfb\u7edf\u7684\u65f6\u95f4\u4e3a\u51c6\uff0c \u53ef\u80fd\u5bfc\u81f4\u6700\u7ec8\u7ed3\u679c\u8ba1\u7b97\u9519\u8bef\u3002</p> <p>\u6211\u4eec\u9700\u8981\u7684\u662f\u76f4\u63a5\u5904\u7406\u6570\u636e\u6d41\uff0c\u800c Flink \u5c31\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9\u3002</p>"},{"location":"engine/flink/flink_01/#iot","title":"\u7269\u8054\u7f51\uff08IOT\uff09","text":"<p>\u4e3e\u4f8b\uff1a\u4f20\u611f\u5668\u5b9e\u65f6\u6570\u636e\u91c7\u96c6\u548c\u663e\u793a\u3001\u5b9e\u65f6\u62a5\u8b66\uff0c\u4ea4\u901a\u8fd0\u8f93\u4e1a</p> <p>\u7269\u8054\u7f51\u662f\u6d41\u6570\u636e\u88ab\u666e\u904d\u5e94\u7528\u7684\u9886\u57df\u3002\u5404\u79cd\u4f20\u611f\u5668\u4e0d\u505c\u83b7\u5f97\u6d4b\u91cf\u6570\u636e\uff0c\u5e76\u5c06\u5b83\u4eec\u4ee5\u6d41\u7684\u5f62\u5f0f\u4f20\u8f93\u81f3\u6570\u636e\u4e2d\u5fc3\u3002\u800c\u6570\u636e\u4e2d\u5fc3\u4f1a\u5c06\u6570\u636e\u5904\u7406\u5206\u6790\u4e4b\u540e\uff0c\u5f97\u5230\u8fd0\u884c\u72b6\u6001\u6216\u8005\u62a5\u8b66\u4fe1\u606f\uff0c\u5b9e\u65f6\u5730\u663e\u793a\u5728\u76d1\u63a7\u5c4f\u5e55\u4e0a\u3002\u6240\u4ee5\u5728\u7269\u8054\u7f51\u4e2d\uff0c\u4f4e\u5ef6\u8fdf\u7684\u6570\u636e\u4f20\u8f93\u548c\u5904\u7406\uff0c\u4ee5\u53ca\u51c6\u786e\u7684\u6570\u636e\u5206\u6790\u901a\u5e38\u5f88\u5173\u952e\u3002</p> <p>\u4ea4\u901a\u8fd0\u8f93\u4e1a\u4e5f\u4f53\u73b0\u4e86\u6d41\u5904\u7406\u7684\u91cd\u8981\u6027\u3002\u6bd4\u5982\u8bf4\uff0c\u5982\u4eca\u9ad8\u94c1\u8fd0\u884c\u4e3b\u8981\u5c31\u662f\u4f9d\u9760\u4f20\u611f\u5668\u68c0\u6d4b\u6570\u636e\uff0c\u6d4b\u91cf\u6570\u636e\u5305\u62ec\u5217\u8f66\u7684\u901f\u5ea6\u548c\u4f4d\u7f6e\uff0c\u4ee5\u53ca\u8f68\u9053\u5468\u8fb9\u7684\u72b6\u51b5\u3002\u8fd9\u4e9b\u6570\u636e\u4f1a\u4ece\u8f68\u9053\u4f20\u7ed9\u5217\u8f66\uff0c\u518d\u4ece\u5217\u8f66\u4f20\u5230\u6cbf\u9014\u7684\u5176\u4ed6\u4f20\u611f\u5668\uff1b\u4e0e\u6b64\u540c\u65f6\uff0c\u6570\u636e\u62a5\u544a\u4e5f\u88ab\u53d1\u9001\u56de\u63a7\u5236\u4e2d\u5fc3\u3002\u56e0\u4e3a\u5217\u8f66\u5904\u4e8e\u9ad8\u901f\u884c\u9a76\u72b6\u6001\uff0c\u56e0\u6b64\u6570\u636e\u5904\u7406\u7684\u5b9e\u65f6\u6027\u8981\u6c42\u662f\u6781\u9ad8\u7684\u3002\u5982\u679c\u6d41\u6570\u636e\u6ca1\u6709\u88ab\u53ca\u65f6\u6b63\u786e\u5904\u7406\uff0c\u8c03\u6574\u610f\u89c1\u548c\u8b66\u544a\u5c31\u4e0d\u80fd\u76f8\u5e94\u4ea7\u751f\uff0c\u540e\u679c\u53ef\u80fd\u4f1a\u975e\u5e38\u4e25\u91cd\u3002</p>"},{"location":"engine/flink/flink_01/#_2","title":"\u7269\u6d41\u914d\u9001\u548c\u670d\u52a1\u4e1a","text":"<p>\u4e3e\u4f8b\uff1a\u8ba2\u5355\u72b6\u6001\u5b9e\u65f6\u66f4\u65b0\u3001\u901a\u77e5\u4fe1\u606f\u63a8\u9001</p> <p>\u5728\u5f88\u591a\u670d\u52a1\u578b\u5e94\u7528\u4e2d\uff0c\u90fd\u4f1a\u6d89\u53ca\u8ba2\u5355\u72b6\u6001\u7684\u66f4\u65b0\u548c\u901a\u77e5\u7684\u63a8\u9001\u3002\u8fd9\u4e9b\u4fe1\u606f\u57fa\u4e8e\u4e8b\u4ef6\u89e6\u53d1\uff0c \u4e0d\u5747\u5300\u5730\u8fde\u7eed\u4e0d\u65ad\u751f\u6210\uff0c\u5904\u7406\u4e4b\u540e\u9700\u8981\u53ca\u65f6\u4f20\u9012\u7ed9\u7528\u6237\u3002\u8fd9\u4e5f\u662f\u975e\u5e38\u5178\u578b\u7684\u6570\u636e\u6d41\u7684\u5904\u7406\u3002</p>"},{"location":"engine/flink/flink_01/#_3","title":"\u94f6\u884c\u548c\u91d1\u878d\u4e1a","text":"<p>\u4e3e\u4f8b\uff1a\u5b9e\u65f6\u7ed3\u7b97\u548c\u901a\u77e5\u63a8\u9001\uff0c\u5b9e\u65f6\u68c0\u6d4b\u5f02\u5e38\u884c\u4e3a</p> <p>\u94f6\u884c\u548c\u91d1\u878d\u4e1a\u662f\u53e6\u4e00\u4e2a\u5178\u578b\u7684\u5e94\u7528\u884c\u4e1a\u3002\u7528\u6237\u7684\u4ea4\u6613\u884c\u4e3a\u662f\u8fde\u7eed\u5927\u91cf\u53d1\u751f\u7684\uff0c\u94f6\u884c\u9762\u5bf9\u7684\u662f\u6d77\u91cf\u7684\u6d41\u5f0f\u6570\u636e\u3002\u7531\u4e8e\u8981\u5904\u7406\u7684\u4ea4\u6613\u6570\u636e\u91cf\u592a\u5927\uff0c\u4ee5\u524d\u7684\u94f6\u884c\u662f\u6309\u5929\u7ed3\u7b97\u7684\uff0c\u6c47\u6b3e\u4e00\u822c\u90fd\u8981\u9694\u5929\u624d\u80fd\u5230\u8d26\u3002\u6240\u4ee5\u6709\u4e00\u4e2a\u8bf4\u6cd5\u53eb\u4f5c\u201c\u94f6\u884c\u5bb6\u5de5\u4f5c\u65f6\u95f4\u201d\uff0c\u8bf4\u7684\u5c31\u662f\u94f6\u884c\u5bb6\u4e0d\u4ec5\u4e0d\u9700\u8981 996\uff0c\u751a\u81f3\u4e0b\u5348\u65e9\u65e9\u5c31\u4e0b\u73ed\u4e86\uff1a\u56e0\u4e3a\u94f6\u884c\u9700\u8981\u65e9\u70b9\u5173\u95e8\u8fdb\u884c\u7ed3\u7b97\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u7b2c\u4e8c\u5929\u8425\u4e1a\u4e4b\u524d\u7b97\u51fa\u51c6\u786e\u7684\u8d26\u3002\u8fd9\u663e\u7136\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u5feb\u901f\u4ea4\u6613\u7684\u9700\u6c42\u3002\u5728\u5168\u7403\u5316\u7ecf\u6d4e\u4e2d\uff0c\u80fd\u591f\u63d0\u4f9b 24 \u5c0f\u65f6\u670d\u52a1\u53d8\u5f97\u8d8a\u6765\u8d8a\u91cd\u8981\u3002\u73b0\u5728\u4ea4\u6613\u548c\u62a5\u8868\u90fd\u4f1a\u5feb\u901f\u51c6\u786e\u5730\u751f\u6210\uff0c\u6211\u4eec\u8de8\u884c\u8f6c\u8d26\u4e5f\u53ef\u4ee5\u505a\u5230\u77ac\u95f4\u5230\u8d26\uff0c\u8fd8\u53ef\u4ee5\u63a5\u5230\u5b9e\u65f6\u7684\u63a8\u9001\u901a\u77e5\u3002\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u80fd\u591f\u5b9e\u65f6\u5904\u7406\u6570\u636e\u6d41\u3002</p> <p>\u53e6\u5916\uff0c\u4fe1\u7528\u5361\u6b3a\u8bc8\u7684\u68c0\u6d4b\u4e5f\u9700\u8981\u53ca\u65f6\u7684\u76d1\u63a7\u548c\u62a5\u8b66\u3002\u4e00\u4e9b\u91d1\u878d\u4ea4\u6613\u5e02\u573a\uff0c\u5bf9\u5f02\u5e38\u4ea4\u6613\u884c\u4e3a\u7684\u53ca\u65f6\u68c0\u6d4b\u53ef\u4ee5\u66f4\u597d\u5730\u8fdb\u884c\u98ce\u9669\u63a7\u5236\uff1b\u8fd8\u53ef\u4ee5\u5bf9\u5f02\u5e38\u767b\u5f55\u8fdb\u884c\u68c0\u6d4b\uff0c\u4ece\u800c\u53d1\u73b0\u9493\u9c7c\u5f0f\u653b\u51fb\uff0c\u4ece\u800c\u907f\u514d\u5de8\u5927\u7684\u635f\u5931\u3002</p>"},{"location":"engine/flink/flink_01/#13","title":"1.3 \u6d41\u5f0f\u6570\u636e\u5904\u7406\u7684\u53d1\u5c55\u548c\u6f14\u53d8","text":"<p>\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\uff0cFlink \u7684\u4e3b\u8981\u5e94\u7528\u573a\u666f\uff0c\u5c31\u662f\u5904\u7406\u5927\u89c4\u6a21\u7684\u6570\u636e\u6d41\u3002\u90a3\u4e3a\u4ec0\u4e48\u4e00\u5b9a\u8981\u7528 Flink \u5462\uff1f\u6570\u636e\u5904\u7406\u8fd8\u6709\u6ca1\u6709\u5176\u4ed6\u7684\u65b9\u5f0f\uff1f\u8981\u89e3\u7b54\u8fd9\u4e2a\u7591\u60d1\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5148\u4ece\u6d41\u5904\u7406\u548c\u6279\u5904\u7406\u7684\u6982\u5ff5\u8bb2\u8d77\u3002</p>"},{"location":"engine/flink/flink_01/#131","title":"1.3.1 \u6d41\u5904\u7406\u548c\u6279\u5904\u7406","text":"<p>\u6570\u636e\u5904\u7406\u6709\u4e0d\u540c\u7684\u65b9\u5f0f\u3002</p> <p>\u5bf9\u4e8e\u5177\u4f53\u5e94\u7528\u6765\u8bf4\uff0c\u6709\u4e9b\u573a\u666f\u6570\u636e\u662f\u4e00\u4e2a\u4e00\u4e2a\u6765\u7684\uff0c\u662f\u4e00\u7ec4\u6709\u5e8f\u7684\u6570\u636e\u5e8f\u5217\uff0c\u6211\u4eec\u628a\u5b83\u53eb\u4f5c\u201c\u6570\u636e\u6d41\u201d\uff1b\u800c\u6709\u4e9b\u573a\u666f\u7684\u6570\u636e\uff0c\u672c\u8eab\u5c31\u662f\u4e00\u6279\u540c\u65f6\u5230\u6765\uff0c\u662f\u4e00\u4e2a\u6709\u9650\u7684\u6570\u636e\u96c6\uff0c\u8fd9\u5c31\u662f\u6279\u91cf\u6570\u636e\uff08\u6709\u65f6\u4e5f\u76f4\u63a5\u53eb\u6570\u636e\u96c6\uff09\u3002</p> <p>\u5bb9\u6613\u60f3\u5230\uff0c\u5904\u7406\u6570\u636e\u6d41\uff0c\u5f53\u7136\u5e94\u8be5\u201c\u6765\u4e00\u4e2a\u5c31\u5904\u7406\u4e00\u4e2a\u201d\uff0c\u8fd9\u79cd\u6570\u636e\u5904\u7406\u6a21\u5f0f\u5c31\u53eb\u4f5c\u6d41\u5904\u7406\uff1b\u56e0\u4e3a\u8fd9\u79cd\u5904\u7406\u662f\u5373\u65f6\u7684\uff0c\u6240\u4ee5\u4e5f\u53eb\u5b9e\u65f6\u5904\u7406\u3002\u4e0e\u4e4b\u5bf9\u5e94\uff0c\u5904\u7406\u6279\u91cf\u6570\u636e\u81ea\u7136\u5c31\u5e94\u8be5\u4e00\u6279\u8bfb\u5165\u3001\u4e00\u8d77\u8ba1\u7b97\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5c31\u53eb\u4f5c\u6279\u5904\u7406\uff0c\u4e5f\u53eb\u4f5c\u79bb\u7ebf\u5904\u7406\u3002</p> <p>\u90a3\u771f\u5b9e\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u5230\u5e95\u662f\u6570\u636e\u6d41\u66f4\u5e38\u89c1\u3001\u8fd8\u662f\u6279\u91cf\u6570\u636e\u66f4\u5e38\u89c1\u5462\uff1f</p> <p>\u751f\u6d3b\u4e2d\uff0c\u8fd9\u4e24\u79cd\u5f62\u5f0f\u7684\u6570\u636e\u90fd\u3002\u6bd4\u5982\u6211\u4eec\u65e5\u5e38\u53d1\u4fe1\u606f\uff0c\u53ef\u4ee5\u4e00\u53e5\u4e00\u53e5\u5730\u8bf4\uff0c\u4e5f\u53ef\u4ee5\u5199\u4e00\u5927\u6bb5\u4e00\u8d77\u53d1\u8fc7\u53bb\u3002\u4e00\u53e5\u4e00\u53e5\u7684\u4fe1\u606f\uff0c\u5c31\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u6570\u636e\uff0c\u5b83\u4eec\u6784\u6210\u7684\u5e8f\u5217\u5c31\u662f\u4e00\u4e2a\u6570\u636e\u6d41\uff1b\u800c\u4e00\u5927\u6bb5\u4fe1\u606f\uff0c\u662f\u4e00\u7ec4\u6570\u636e\u7684\u96c6\u5408\uff0c\u5bf9\u5e94\u5c31\u662f\u6279\u91cf\u6570\u636e\uff08\u6570\u636e\u96c6\uff09\u3002</p> <p>\u5f53\u7136\uff0c\u6709\u7ecf\u9a8c\u7684\u4eba\u90fd\u4f1a\u77e5\u9053\uff0c\u4e00\u53e5\u4e00\u53e5\u5730\u53d1\uff0c\u4f60\u4e00\u8a00\u6211\u4e00\u8bed\uff0c\u6709\u6765\u6709\u5f80\u8fd9\u624d\u53eb\u804a\u5929\uff1b\u4e00\u5927\u6bb5\u4fe1\u606f\u76f4\u63a5\u7838\u8fc7\u53bb\uff0c\u522b\u4eba\u770b\u7740\u90fd\u773c\u6655\uff0c\u5f88\u5bb9\u6613\u5c31\u6ca1\u4e0b\u6587\u4e86\u2014\u2014\u5982\u679c\u662f\u5f88\u91cd\u8981\u7684\u6574\u7bc7\u5185\u5bb9\uff08\u6bd4\u5982\u8868\u767d\u4fe1\uff09\uff0c\u5199\u6210\u6587\u6863\u6216\u8005\u90ae\u4ef6\u53d1\u8fc7\u53bb\u53ef\u80fd\u6548\u679c\u4f1a\u66f4\u597d\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u770b\u5230\uff0c\u201c\u804a\u5929\u201d\u8fd9\u4e2a\u751f\u6d3b\u573a\u666f\uff0c\u6570\u636e\u7684\u751f\u6210\u3001\u4f20\u9012\u548c\u63a5\u6536\u5904\u7406\uff0c\u90fd\u662f\u6d41\u5f0f\u7684\uff1b\u800c \u201c\u5199\u4fe1\u201d\u7684\u573a\u666f\uff0c\u6570\u636e\u7684\u751f\u6210\u5c3d\u7ba1\u5e94\u8be5\u4e5f\u662f\u6d41\u5f0f\u7684\uff08\u5b57\u603b\u5f97\u4e00\u4e2a\u4e2a\u5199\uff09\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u6536\u96c6\u8d77\u6765\uff0c\u7edf\u4e00\u4f20\u8f93\u3001\u7edf\u4e00\u5904\u7406\uff08\u5f53\u7136\u6211\u4eec\u8fd8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8f83\u771f\uff1a\u5904\u7406\u4e5f\u662f\u6d41\u5f0f\u7684\uff0c\u5b57\u5f97\u4e00\u4e2a\u4e00\u4e2a\u8bfb\uff09\u3002 \u4e0d\u8bba\u4f20\u8f93\u5904\u7406\u7684\u65b9\u5f0f\u662f\u600e\u6837\u7684\uff0c\u6570\u636e\u7684\u751f\u6210\uff0c\u4e00\u822c\u90fd\u662f\u6d41\u5f0f\u7684\u3002</p> <p>\u5728 IT \u5e94\u7528\u573a\u666f\u4e2d\uff0c\u8fd9\u4e00\u70b9\u4f1a\u4f53\u73b0\u5f97\u66f4\u52a0\u660e\u663e\u3002\u4f01\u4e1a\u7684\u7edd\u5927\u591a\u6570\u5e94\u7528\u7a0b\u5e8f\uff0c\u90fd\u662f\u5728\u4e0d\u505c\u5730\u63a5\u6536\u7528\u6237\u8bf7\u6c42\u3001\u8bb0\u5f55\u7528\u6237\u884c\u4e3a\u548c\u7cfb\u7edf\u65e5\u5fd7\uff0c\u6216\u8005\u6301\u7eed\u63a5\u6536\u91c7\u96c6\u5230\u7684\u72b6\u6001\u4fe1\u606f\u3002\u6240\u4ee5\u6570\u636e\u4f1a\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u6301\u7eed\u751f\u6210\uff0c\u5f62\u6210\u4e00\u4e2a\u6709\u5e8f\u7684\u6570\u636e\u5e8f\u5217\u2014\u2014\u8fd9\u5c31\u662f\u5178\u578b\u7684\u6570\u636e\u6d41\u3002</p> <p>Question</p> <p>\u6240\u4ee5\u6d41\u6570\u636e\u66f4\u771f\u5b9e\u5730\u53cd\u6620\u4e86\u6211\u4eec\u7684\u751f\u6d3b\u65b9\u5f0f\u3002\u771f\u5b9e\u573a\u666f\u4e2d\u4ea7\u751f\u7684\uff0c\u4e00\u822c\u90fd\u662f\u6570\u636e\u6d41\u3002\u90a3\u5904\u7406\u6570\u636e\u6d41\uff0c\u5c31\u4e00\u5b9a\u8981\u7528\u6d41\u5904\u7406\u7684\u65b9\u5f0f\u5417\uff1f</p> <p>\u8fd9\u4e2a\u95ee\u9898\u4f3c\u4e4e\u95ee\u5f97\u6709\u70b9\u65e0\u5398\u5934\u3002\u4e0d\u8fc7\u4ed4\u7ec6\u4e00\u60f3\u5c31\u4f1a\u53d1\u73b0\uff0c\u5f88\u591a\u6570\u636e\u6d41\u7684\u573a\u666f\u5176\u5b9e\u4e5f\u53ef\u4ee5\u7528 \u201c\u6512\u4e00\u6279\u201d\u7684\u65b9\u5f0f\u6765\u5904\u7406\u3002\u6bd4\u5982\u804a\u5929\uff0c\u6211\u4eec\u53ef\u4ee5\u6536\u5230\u4e00\u6761\u4fe1\u606f\u5c31\u56de\u4e00\u6761\uff1b\u4e5f\u53ef\u4ee5\u6512\u5f88\u591a\u6761\u4e00\u8d77\u56de\u590d\u3002\u5bf9\u4e8e\u5e94\u7528\u7a0b\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u628a\u8981\u5904\u7406\u7684\u6570\u636e\u5148\u6536\u96c6\u9f50\uff0c\u7136\u540e\u624d\u4e00\u5e76\u5904\u7406\u3002</p> <p>\u4f46\u662f\u8fd9\u6837\u505a\u7684\u7f3a\u70b9\u4e5f\u975e\u5e38\u660e\u663e\uff1a\u6570\u636e\u5904\u7406\u4e0d\u591f\u53ca\u65f6\uff0c\u5b9e\u65f6\u6027\u53d8\u5dee\u4e86\u3002\u6d41\u5904\u7406\uff0c\u662f\u771f\u6b63\u7684\u5373\u65f6\u5904\u7406\uff0c\u6ca1\u6709\u201c\u6512\u6279\u201d\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u6240\u4ee5\u4f1a\u66f4\u5feb\u3001\u5b9e\u65f6\u6027\u66f4\u597d\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u6279\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5fc5\u987b\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u65f6\u95f4\u8282\u70b9\u7ed3\u675f\u201c\u6512\u6279\u201d\u7684\u8fc7\u7a0b\u3001\u5f00\u59cb\u8ba1\u7b97\u3002 \u800c\u6570\u636e\u6d41\u662f\u8fde\u7eed\u4e0d\u65ad\u3001\u65e0\u4f11\u65e0\u6b62\u7684\uff0c\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u5728\u67d0\u4e00\u65f6\u523b\u8bf4\uff1a\u201c\u597d\uff01\u73b0\u5728\u6536\u96c6\u9f50\u6240\u6709\u6570\u636e\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u5206\u6790\u4e86\u3002\u201d\u5982\u679c\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u201c\u6301\u7eed\u8ba1\u7b97\u201d\uff0c\u5c31\u5fc5\u987b\u91c7\u7528\u6d41\u5904\u7406\u7684\u65b9\u5f0f\uff0c\u6765\u5904\u7406\u6570\u636e\u6d41\u3002</p> <p>\u5f88\u663e\u7136\uff0c\u5bf9\u4e8e\u6d41\u5f0f\u6570\u636e\uff0c\u7528\u6d41\u5904\u7406\u662f\u6700\u597d\u3001\u4e5f\u6700\u5408\u7406\u7684\u65b9\u5f0f\u3002</p> <p>\u4f46\u6211\u4eec\u77e5\u9053\uff0c\u4f20\u7edf\u7684\u6570\u636e\u5904\u7406\u67b6\u6784\u5e76\u4e0d\u662f\u8fd9\u6837\u3002\u65e0\u8bba\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\u3001\u8fd8\u662f\u6570\u636e\u4ed3\u5e93\uff0c\u90fd\u503e\u5411\u4e8e\u5148\u201c\u6536\u96c6\u6570\u636e\u201d\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\u3002\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7528\u6d41\u5904\u7406\u7684\u65b9\u5f0f\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\uff0c\u5206\u5e03\u5f0f\u6279\u5904\u7406\u5728\u67b6\u6784\u4e0a\u66f4\u5bb9\u6613\u5b9e\u73b0\u3002\u60f3\u60f3\u751f\u6d3b\u4e2d\u53d1\u6d88\u606f\u804a\u5929\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u4e86\uff1a\u5982\u679c\u6765 \u4e00\u6761\u6d88\u606f\u5c31\u7acb\u5373\u5904\u7406\uff0c\u201c\u5fae\u4fe1\u79d2\u56de\u201d\uff0c\u8fd9\u6837\u505a\u4e00\u5b9a\u4f1a\u5f88\u53d7\u4eba\u6b22\u8fce\uff1b\u4f46\u662f\u8fd9\u8981\u6c42\u81ea\u5df1\u5fc5\u987b\u65f6\u523b\u5173\u6ce8\u65b0\u6d88\u606f\uff0c\u8fd9\u4f1a\u8017\u8d39\u5927\u91cf\u7cbe\u529b\uff0c\u5de5\u4f5c\u6548\u7387\u4f1a\u53d7\u5230\u5f88\u5927\u5f71\u54cd\u3002\u5982\u679c\u9694\u4e00\u6bb5\u65f6\u95f4\u67e5\u4e00\u4e0b\u65b0\u6d88\u606f\uff0c\u505a\u4e2a \u201c\u6279\u5904\u7406\u201d\uff0c\u538b\u529b\u660e\u663e\u5c31\u5c0f\u591a\u4e86\u3002\u5f53\u7136\uff0c\u8fd9\u6837\u7684\u4ee3\u4ef7\u5c31\u662f\u53ef\u80fd\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u6709\u4e9b\u6d88\u606f\uff0c\u9020\u6210\u4e00\u5b9a\u7684\u540e\u679c\u3002</p> <p>\u60f3\u8981\u5f04\u6e05\u695a\u6d41\u5904\u7406\u7684\u53d1\u5c55\u6f14\u53d8\uff0c\u6211\u4eec\u5148\u8981\u4e86\u89e3\u4f20\u7edf\u7684\u6570\u636e\u5904\u7406\u67b6\u6784\u3002</p>"},{"location":"engine/flink/flink_01/#132","title":"1.3.2 \u4f20\u7edf\u4e8b\u52a1\u5904\u7406","text":"<p>IT \u4e92\u8054\u7f51\u516c\u53f8\u5f80\u5f80\u4f1a\u7528\u4e0d\u540c\u7684\u5e94\u7528\u7a0b\u5e8f\u6765\u5904\u7406\u5404\u79cd\u4e1a\u52a1\u3002\u6bd4\u5982\u5185\u90e8\u4f7f\u7528\u7684\u4f01\u4e1a\u8d44\u6e90\u89c4\u5212 \uff08ERP\uff09\u7cfb\u7edf\u3001\u5ba2\u6237\u5173\u7cfb\u7ba1\u7406\uff08CRM\uff09\u7cfb\u7edf\uff0c\u8fd8\u6709\u9762\u5411\u5ba2\u6237\u7684 Web \u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u4e9b\u7cfb\u7edf\u4e00\u822c\u90fd\u4f1a\u8fdb\u884c\u5206\u5c42\u8bbe\u8ba1\uff1a\u201c\u8ba1\u7b97\u5c42\u201d\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u672c\u8eab\uff0c\u7528\u4e8e\u6570\u636e\u8ba1\u7b97\u548c\u5904\u7406\uff1b\u800c\u201c\u5b58\u50a8\u5c42\u201d\u5f80\u5f80\u662f\u4f20\u7edf\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u7528\u4e8e\u6570\u636e\u5b58\u50a8\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u91cc\u7684\u5e94\u7528\u7a0b\u5e8f\u5728\u5904\u7406\u6570\u636e\u7684\u6a21\u5f0f\u4e0a\u6709\u5171\u540c\u4e4b\u5904\uff1a\u63a5\u6536\u7684\u6570\u636e\u662f\u6301\u7eed\u751f\u6210\u7684\u4e8b\u4ef6\uff0c\u6bd4\u5982\u7528\u6237\u7684\u70b9\u51fb\u884c\u4e3a\uff0c\u5ba2\u6237\u4e0b\u7684\u8ba2\u5355\uff0c\u6216\u8005\u64cd\u4f5c\u4eba\u5458\u53d1\u51fa\u7684\u8bf7\u6c42\u3002\u5904\u7406\u4e8b\u4ef6\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u5148\u8bfb\u53d6\u8fdc\u7a0b\u6570\u636e\u5e93\u7684\u72b6\u6001\uff0c\u7136\u540e\u6309\u7167\u5904\u7406\u903b\u8f91\u5f97\u5230\u7ed3\u679c\uff0c\u5c06\u54cd\u5e94\u8fd4\u56de\u7ed9\u7528\u6237\uff0c\u5e76\u66f4\u65b0\u6570\u636e\u5e93\u72b6\u6001\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u7cfb\u7edf\u53ef\u4ee5\u670d\u52a1\u4e8e\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u5b83\u4eec\u6709\u65f6\u4f1a\u8bbf\u95ee\u76f8\u540c\u7684\u6570\u636e\u5e93\u6216\u8868\u3002</p> <p>\u8fd9\u5c31\u662f\u4f20\u7edf\u7684\u201c\u4e8b\u52a1\u5904\u7406\u201d\u67b6\u6784\u3002\u7cfb\u7edf\u6240\u5904\u7406\u7684\u8fde\u7eed\u4e0d\u65ad\u7684\u4e8b\u4ef6\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6570\u636e\u6d41\u3002 \u800c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u7cfb\u7edf\u90fd\u5728\u6536\u5230\u4e4b\u540e\u8fdb\u884c\u76f8\u5e94\u7684\u5904\u7406\uff0c\u8fd9\u4e5f\u662f\u7b26\u5408\u6d41\u5904\u7406\u7684\u539f\u5219\u7684\u3002\u6240\u4ee5\u53ef\u4ee5\u8bf4\uff0c\u4f20\u7edf\u7684\u4e8b\u52a1\u5904\u7406\uff0c\u5c31\u662f\u6700\u57fa\u672c\u7684\u6d41\u5904\u7406\u67b6\u6784\u3002</p> <p>\u5bf9\u4e8e\u5404\u79cd\u4e8b\u4ef6\u8bf7\u6c42\uff0c\u4e8b\u52a1\u5904\u7406\u7684\u65b9\u5f0f\u80fd\u591f\u4fdd\u8bc1\u5b9e\u65f6\u54cd\u5e94\uff0c\u597d\u5904\u662f\u4e00\u76ee\u4e86\u7136\u7684\u3002\u4f46\u662f\u6211\u4eec\u77e5\u9053\uff0c\u8fd9\u6837\u7684\u67b6\u6784\u5bf9\u8868\u548c\u6570\u636e\u5e93\u7684\u8bbe\u8ba1\u8981\u6c42\u5f88\u9ad8\uff1b\u5f53\u6570\u636e\u89c4\u6a21\u8d8a\u6765\u8d8a\u5e9e\u5927\u3001\u7cfb\u7edf\u8d8a\u6765\u8d8a\u590d\u6742\u65f6\uff0c \u53ef\u80fd\u9700\u8981\u5bf9\u8868\u8fdb\u884c\u91cd\u6784\uff0c\u800c\u4e14\u4e00\u6b21\u8054\u8868\u67e5\u8be2\u4e5f\u4f1a\u82b1\u8d39\u5927\u91cf\u7684\u65f6\u95f4\uff0c\u751a\u81f3\u4e0d\u80fd\u53ca\u65f6\u5f97\u5230\u8fd4\u56de\u7ed3\u679c\u3002 \u4e8e\u662f\uff0c\u4f5c\u4e3a\u7a0b\u5e8f\u5458\u5c31\u53ea\u597d\u5c06\u66f4\u591a\u7684\u7cbe\u529b\u653e\u5728\u8868\u7684\u8bbe\u8ba1\u548c\u91cd\u6784\uff0c\u4ee5\u53ca SQL \u7684\u8c03\u4f18\u4e0a\uff0c\u800c\u65e0\u6cd5\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\u7684\u5b9e\u73b0\u4e86\u2014\u2014\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u8fd9\u79cd\u5de5\u4f5c\u8d39\u529b\u8d39\u65f6\uff0c\u5374\u6ca1\u6cd5\u76f4\u63a5\u4f53\u73b0\u5728\u4ea7\u54c1\u4e0a\u7ed9\u8001\u677f\u770b\uff0c\u7b80\u76f4\u5c31\u662f\u5669\u68a6\u3002</p> <p>Question</p> <p>\u90a3\u6709\u6ca1\u6709\u66f4\u5408\u7406\u3001\u66f4\u9ad8\u6548\u7684\u5904\u7406\u67b6\u6784\u5462\uff1f</p>"},{"location":"engine/flink/flink_01/#133","title":"1.3.3 \u6709\u72b6\u6001\u7684\u6d41\u5904\u7406","text":"<p>\u4e0d\u96be\u60f3\u5230\uff0c\u5982\u679c\u6211\u4eec\u5bf9\u4e8e\u4e8b\u4ef6\u6d41\u7684\u5904\u7406\u975e\u5e38\u7b80\u5355\uff0c\u4f8b\u5982\u6536\u5230\u4e00\u6761\u8bf7\u6c42\u5c31\u8fd4\u56de\u4e00\u4e2a\u201c\u6536\u5230\u201d\uff0c \u90a3\u5c31\u53ef\u4ee5\u7701\u53bb\u6570\u636e\u5e93\u7684\u67e5\u8be2\u548c\u66f4\u65b0\u4e86\u3002\u4f46\u662f\u8fd9\u6837\u7684\u5904\u7406\u662f\u6ca1\u4ec0\u4e48\u5b9e\u9645\u610f\u4e49\u7684\u3002\u5728\u73b0\u5b9e\u7684\u5e94\u7528\u4e2d\uff0c \u5f80\u5f80\u9700\u8981\u8fd8\u5176\u4ed6\u4e00\u4e9b\u989d\u5916\u6570\u636e\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u9700\u8981\u7684\u989d\u5916\u6570\u636e\u4fdd\u5b58\u6210\u4e00\u4e2a\u201c\u72b6\u6001\u201d\uff0c\u7136\u540e\u9488\u5bf9\u8fd9\u6761\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u4e14\u66f4\u65b0\u72b6\u6001\u3002\u5728\u4f20\u7edf\u67b6\u6784\u4e2d\uff0c\u8fd9\u4e2a\u72b6\u6001\u5c31\u662f\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u91cc\u7684\u3002\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u201c\u6709\u72b6\u6001\u7684\u6d41\u5904\u7406\u201d\u3002</p> <p>\u4e3a\u4e86\u52a0\u5feb\u8bbf\u95ee\u901f\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u72b6\u6001\u4fdd\u5b58\u5728\u672c\u5730\u5185\u5b58\uff0c\u5982\u56fe\u6240\u793a\u3002\u5f53\u5e94\u7528\u6536\u5230\u4e00\u4e2a\u65b0\u4e8b\u4ef6\u65f6\uff0c\u5b83\u53ef\u4ee5\u4ece\u72b6\u6001\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u66f4\u65b0\u72b6\u6001\u3002\u800c\u5f53\u72b6\u6001\u662f\u4ece\u5185\u5b58\u4e2d\u8bfb\u5199\u7684\u65f6\u5019\uff0c \u8fd9\u5c31\u548c\u8bbf\u95ee\u672c\u5730\u53d8\u91cf\u6ca1\u4ec0\u4e48\u533a\u522b\u4e86\uff0c\u5b9e\u65f6\u6027\u53ef\u4ee5\u5f97\u5230\u6781\u5927\u7684\u63d0\u5347\u3002</p> <p>\u53e6\u5916\uff0c\u6570\u636e\u89c4\u6a21\u589e\u5927\u65f6\uff0c\u6211\u4eec\u4e5f\u4e0d\u9700\u8981\u505a\u91cd\u6784\uff0c\u53ea\u9700\u8981\u6784\u5efa\u5206\u5e03\u5f0f\u96c6\u7fa4\uff0c\u5404\u81ea\u5728\u672c\u5730\u8ba1\u7b97\u5c31\u53ef\u4ee5\u4e86\uff0c\u53ef\u6269\u5c55\u6027\u4e5f\u53d8\u5f97\u66f4\u597d\u3002</p> <p>\u56e0\u4e3a\u91c7\u7528\u7684\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u4fdd\u62a4\u672c\u5730\u72b6\u6001\uff0c\u9632\u6b62\u5728\u6545\u969c\u65f6\u6570\u636e\u4e22\u5931\u3002\u6211\u4eec\u53ef\u4ee5\u5b9a\u671f\u5730\u5c06\u5e94\u7528\u72b6\u6001\u7684\u4e00\u81f4\u6027\u68c0\u67e5\u70b9\uff08checkpoint\uff09\u5b58\u76d8\uff0c\u5199\u5165\u8fdc\u7a0b\u7684\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u9047\u5230\u6545\u969c\u65f6\u518d\u53bb\u8bfb\u53d6\u8fdb\u884c\u6062\u590d\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u66f4\u597d\u7684\u5bb9\u9519\u6027\u3002</p> <p> </p> \u6709\u72b6\u6001\u6d41\u5904\u7406 <p>\u6709\u72b6\u6001\u7684\u6d41\u5904\u7406\u662f\u4e00\u79cd\u901a\u7528\u800c\u4e14\u7075\u6d3b\u7684\u8bbe\u8ba1\u67b6\u6784\uff0c\u53ef\u7528\u4e8e\u8bb8\u591a\u4e0d\u540c\u7684\u573a\u666f\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6709\u4ee5\u4e0b\u51e0\u79cd\u5178\u578b\u5e94\u7528\u3002</p>"},{"location":"engine/flink/flink_01/#1-event-driven","title":"1. \u4e8b\u4ef6\u9a71\u52a8\u578b\uff08Event-Driven\uff09\u5e94\u7528","text":"<p>\u4e8b\u4ef6\u9a71\u52a8\u578b\u5e94\u7528\u662f\u4e00\u7c7b\u5177\u6709\u72b6\u6001\u7684\u5e94\u7528\uff0c\u5b83\u4ece\u4e00\u4e2a\u6216\u591a\u4e2a\u4e8b\u4ef6\u6d41\u63d0\u53d6\u6570\u636e\uff0c\u5e76\u6839\u636e\u5230\u6765\u7684\u4e8b\u4ef6\u89e6\u53d1\u8ba1\u7b97\u3001\u72b6\u6001\u66f4\u65b0\u6216\u5176\u4ed6\u5916\u90e8\u52a8\u4f5c\u3002\u6bd4\u8f83\u5178\u578b\u7684\u5c31\u662f\u4ee5 Kafka \u4e3a\u4ee3\u8868\u7684\u6d88\u606f\u961f\u5217\u51e0\u4e4e\u90fd\u662f\u4e8b\u4ef6\u9a71\u52a8\u578b\u5e94\u7528\u3002</p> <p>\u8fd9\u5176\u5b9e\u8ddf\u4f20\u7edf\u4e8b\u52a1\u5904\u7406\u672c\u8d28\u4e0a\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u5728\u4e8e\u57fa\u4e8e\u6709\u72b6\u6001\u6d41\u5904\u7406\u7684\u4e8b\u4ef6\u9a71\u52a8\u5e94\u7528\uff0c\u4e0d\u518d\u9700\u8981\u67e5\u8be2\u8fdc\u7a0b\u6570\u636e\u5e93\uff0c\u800c\u662f\u5728\u672c\u5730\u8bbf\u95ee\u5b83\u4eec\u7684\u6570\u636e\uff0c\u5982\u56fe\u6240\u793a\uff0c\u8fd9\u6837\u5728\u541e\u5410\u91cf\u548c\u5ef6\u8fdf\u65b9\u9762\u5c31\u53ef\u4ee5\u6709\u66f4\u597d\u7684\u6027\u80fd\u3002</p> <p>\u53e6\u5916\u8fdc\u7a0b\u6301\u4e45\u6027\u5b58\u50a8\u7684\u68c0\u67e5\u70b9\u4fdd\u8bc1\u4e86\u5e94\u7528\u53ef\u4ee5\u4ece\u6545\u969c\u4e2d\u6062\u590d\u3002\u68c0\u67e5\u70b9\u53ef\u4ee5\u5f02\u6b65\u548c\u589e\u91cf\u5730\u5b8c\u6210\uff0c\u56e0\u6b64\u5bf9\u6b63\u5e38\u8ba1\u7b97\u7684\u5f71\u54cd\u975e\u5e38\u5c0f\u3002</p>"},{"location":"engine/flink/flink_01/#2-data-analysis","title":"2. \u6570\u636e\u5206\u6790\uff08Data Analysis\uff09\u578b\u5e94\u7528","text":"<p>\u6240\u8c13\u7684\u6570\u636e\u5206\u6790\uff0c\u5c31\u662f\u4ece\u539f\u59cb\u6570\u636e\u4e2d\u63d0\u53d6\u4fe1\u606f\u548c\u53d1\u6398\u89c4\u5f8b\u3002\u4f20\u7edf\u4e0a\uff0c\u6570\u636e\u5206\u6790\u4e00\u822c\u662f\u5148\u5c06\u6570\u636e\u590d\u5236\u5230\u6570\u636e\u4ed3\u5e93\uff08Data Warehouse\uff09\uff0c\u7136\u540e\u8fdb\u884c\u6279\u91cf\u67e5\u8be2\u3002\u5982\u679c\u6570\u636e\u6709\u4e86\u66f4\u65b0\uff0c\u5fc5\u987b\u5c06\u6700\u65b0\u6570\u636e\u6dfb\u52a0\u5230\u8981\u5206\u6790\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u7136\u540e\u91cd\u65b0\u8fd0\u884c\u67e5\u8be2\u6216\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5982\u4eca\uff0cApache Hadoop \u751f\u6001\u7cfb\u7edf\u7684\u7ec4\u4ef6\uff0c\u5df2\u7ecf\u662f\u8bb8\u591a\u4f01\u4e1a\u5927\u6570\u636e\u67b6\u6784\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u7ec4\u6210\u90e8\u5206\u3002\u73b0\u5728\u7684\u505a\u6cd5\u4e00\u822c\u662f\u5c06\u5927\u91cf\u6570\u636e\uff08\u5982\u65e5\u5fd7\u6587\u4ef6\uff09\u5199\u5165 Hadoop \u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff08HDFS\uff09\u3001 S3 \u6216 HBase \u7b49\u6279\u91cf\u5b58\u50a8\u6570\u636e\u5e93\uff0c\u4ee5\u8f83\u4f4e\u7684\u6210\u672c\u8fdb\u884c\u5927\u5bb9\u91cf\u5b58\u50a8\u3002\u7136\u540e\u53ef\u4ee5\u901a\u8fc7 SQL-on-Hadoop \u7c7b\u7684\u5f15\u64ce\u67e5\u8be2\u548c\u5904\u7406\u6570\u636e\uff0c\u6bd4\u5982\u5927\u5bb6\u719f\u6089\u7684 Hive\u3002\u8fd9\u79cd\u5904\u7406\u65b9\u5f0f\uff0c\u662f\u5178\u578b\u7684\u6279\u5904\u7406\uff0c\u7279\u70b9\u662f\u53ef\u4ee5\u5904\u7406\u6d77\u91cf\u6570\u636e\uff0c\u4f46\u5b9e\u65f6\u6027\u8f83\u5dee\uff0c\u6240\u4ee5\u4e5f\u53eb\u79bb\u7ebf\u5206\u6790\u3002</p> <p>\u5982\u679c\u6211\u4eec\u6709\u4e86\u4e00\u4e2a\u590d\u6742\u7684\u6d41\u5904\u7406\u5f15\u64ce\uff0c\u6570\u636e\u5206\u6790\u5176\u5b9e\u4e5f\u53ef\u4ee5\u5b9e\u65f6\u6267\u884c\u3002\u6d41\u5f0f\u67e5\u8be2\u6216\u5e94\u7528\u7a0b\u5e8f\u4e0d\u662f\u8bfb\u53d6\u6709\u9650\u7684\u6570\u636e\u96c6\uff0c\u800c\u662f\u63a5\u6536\u5b9e\u65f6\u4e8b\u4ef6\u6d41\uff0c\u4e0d\u65ad\u751f\u6210\u548c\u66f4\u65b0\u7ed3\u679c\u3002\u7ed3\u679c\u8981\u4e48\u5199\u5165\u5916\u90e8\u6570\u636e\u5e93\uff0c\u8981\u4e48\u4f5c\u4e3a\u5185\u90e8\u72b6\u6001\u8fdb\u884c\u7ef4\u62a4\u3002</p> <p>Apache Flink \u540c\u65f6\u652f\u6301\u6d41\u5f0f\u4e0e\u6279\u5904\u7406\u7684\u6570\u636e\u5206\u6790\u5e94\u7528\u3002</p> <p>\u4e0e\u6279\u5904\u7406\u5206\u6790\u76f8\u6bd4\uff0c\u6d41\u5904\u7406\u5206\u6790\u6700\u5927\u7684\u4f18\u52bf\u5c31\u662f\u4f4e\u5ef6\u8fdf\uff0c\u771f\u6b63\u5b9e\u73b0\u4e86\u5b9e\u65f6\u3002\u53e6\u5916\uff0c\u6d41\u5904\u7406\u4e0d\u9700\u8981\u53bb\u5355\u72ec\u8003\u8651\u65b0\u6570\u636e\u7684\u5bfc\u5165\u548c\u5904\u7406\uff0c\u5b9e\u65f6\u66f4\u65b0\u672c\u6765\u5c31\u662f\u6d41\u5904\u7406\u7684\u57fa\u672c\u6a21\u5f0f\u3002\u5f53\u524d\u4f01\u4e1a\u5bf9\u6d41\u5f0f\u6570\u636e\u5904\u7406\u7684\u4e00\u4e2a\u70ed\u70b9\u5e94\u7528\u5c31\u662f\u5b9e\u65f6\u6570\u4ed3\uff0c\u5f88\u591a\u516c\u53f8\u6b63\u662f\u57fa\u4e8e Flink \u6765\u5b9e\u73b0\u7684\u3002</p>"},{"location":"engine/flink/flink_01/#3-data-pipeline","title":"3. \u6570\u636e\u7ba1\u9053\uff08Data Pipeline\uff09\u578b\u5e94\u7528","text":"<p>ETL \u4e5f\u5c31\u662f\u6570\u636e\u7684\u63d0\u53d6\u3001\u8f6c\u6362\u3001\u52a0\u8f7d\uff0c\u662f\u5728\u5b58\u50a8\u7cfb\u7edf\u4e4b\u95f4\u8f6c\u6362\u548c\u79fb\u52a8\u6570\u636e\u7684\u5e38\u7528\u65b9\u6cd5\u3002 \u5728\u6570\u636e\u5206\u6790\u7684\u5e94\u7528\u4e2d\uff0c\u901a\u5e38\u4f1a\u5b9a\u671f\u89e6\u53d1 ETL \u4efb\u52a1\uff0c\u5c06\u6570\u636e\u4ece\u4e8b\u52a1\u6570\u636e\u5e93\u7cfb\u7edf\u590d\u5236\u5230\u5206\u6790\u6570\u636e \u5e93\u6216\u6570\u636e\u4ed3\u5e93\u3002</p> <p>\u6240\u8c13\u6570\u636e\u7ba1\u9053\u7684\u4f5c\u7528\u4e0e ETL \u7c7b\u4f3c\u3002\u5b83\u4eec\u53ef\u4ee5\u8f6c\u6362\u548c\u6269\u5c55\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5728\u5b58\u50a8\u7cfb\u7edf\u4e4b\u95f4\u79fb\u52a8\u6570\u636e\u3002\u4e0d\u8fc7\u5982\u679c\u6211\u4eec\u7528\u6d41\u5904\u7406\u67b6\u6784\u6765\u642d\u5efa\u6570\u636e\u7ba1\u9053\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u5c31\u53ef\u4ee5\u8fde\u7eed\u8fd0\u884c\uff0c\u800c\u4e0d\u9700\u8981\u518d\u53bb\u5468\u671f\u6027\u89e6\u53d1\u4e86\u3002\u6bd4\u5982\uff0c\u6570\u636e\u7ba1\u9053\u53ef\u4ee5\u7528\u6765\u76d1\u63a7\u6587\u4ef6\u7cfb\u7edf\u76ee\u5f55\u4e2d\u7684\u65b0\u6587\u4ef6\uff0c\u5c06\u6570\u636e\u5199\u5165\u4e8b\u4ef6\u65e5\u5fd7\u3002\u8fde\u7eed\u6570\u636e\u7ba1\u9053\u7684\u660e\u663e\u4f18\u52bf\u662f\u51cf\u5c11\u4e86\u5c06\u6570\u636e\u79fb\u52a8\u5230\u76ee\u7684\u5730\u7684\u5ef6\u8fdf\uff0c\u800c\u4e14\u66f4\u52a0\u901a\u7528\uff0c\u53ef\u4ee5\u7528\u4e8e\u66f4\u591a\u7684\u573a\u666f\u3002</p> <p>\u6709\u72b6\u6001\u7684\u6d41\u5904\u7406\u67b6\u6784\u4e0a\u5176\u5b9e\u5e76\u4e0d\u590d\u6742\uff0c\u5f88\u591a\u7528\u6237\u57fa\u4e8e\u8fd9\u79cd\u601d\u60f3\u5f00\u53d1\u51fa\u4e86\u81ea\u5df1\u7684\u6d41\u5904\u7406\u7cfb\u7edf\uff0c\u8fd9\u5c31\u662f\u7b2c\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u3002Apache Storm \u5c31\u662f\u5176\u4e2d\u7684\u4ee3\u8868\u3002Storm \u53ef\u4ee5\u8bf4\u662f\u5f00\u6e90\u6d41\u5904\u7406\u7684\u5148\u950b\uff0c\u6700\u65e9\u662f\u7531 Nathan Marz \u548c\u521b\u4e1a\u516c\u53f8 BackType \u7684\u4e00\u4e2a\u56e2\u961f\u5f00\u53d1\u7684\uff0c\u540e\u6765\u624d\u6210\u4e3a Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u5c5e\u7684\u9879\u76ee\u3002Storm \u63d0\u4f9b\u4e86\u4f4e\u5ef6\u8fdf\u7684\u6d41\u5904\u7406\uff0c\u4f46\u662f\u5b83\u4e5f\u4e3a\u5b9e\u65f6\u6027\u4ed8\u51fa\u4e86\u4ee3\u4ef7\uff1a\u5f88\u96be\u5b9e\u73b0\u9ad8\u541e\u5410\uff0c \u800c\u4e14\u65e0\u6cd5\u4fdd\u8bc1\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002 \u7528\u66f4\u4e13\u4e1a\u7684\u8bdd\u8bf4\uff0c \u5b83\u5e76\u4e0d\u80fd\u4fdd\u8bc1 \u201c \u7cbe\u786e\u4e00\u6b21 \u201d \uff08 exactly-once \uff09\uff1b\u5373\u4fbf\u662f\u5b83\u80fd\u591f\u4fdd\u8bc1\u7684\u4e00\u81f4\u6027\u7ea7\u522b\uff0c \u5f00\u9500\u4e5f\u76f8\u5f53\u5927\u3002 \u5173\u4e8e\u72b6\u6001\u4e00\u81f4\u6027\u548c exactly-once\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u7eed\u7684\u7ae0\u8282\u4e2d\u5c55\u5f00\u8ba8\u8bba\u3002</p>"},{"location":"engine/flink/flink_01/#134-lambda","title":"1.3.4 Lambda \u67b6\u6784","text":"<p>Question</p> <p>\u5bf9\u4e8e\u6709\u72b6\u6001\u7684\u6d41\u5904\u7406\uff0c\u5f53\u6570\u636e\u8d8a\u6765\u8d8a\u591a\u65f6\uff0c\u6211\u4eec\u5fc5\u987b\u7528\u5206\u5e03\u5f0f\u7684\u96c6\u7fa4\u67b6\u6784\u6765\u83b7\u53d6\u66f4\u5927\u7684\u541e\u5410\u91cf\u3002\u4f46\u662f\u5206\u5e03\u5f0f\u67b6\u6784\u4f1a\u5e26\u6765\u53e6\u4e00\u4e2a\u95ee\u9898\uff1a\u600e\u6837\u4fdd\u8bc1\u6570\u636e\u5904\u7406\u7684\u987a\u5e8f\u662f\u6b63\u786e\u7684\u5462\uff1f</p> <p>\u5bf9\u4e8e\u6279\u5904\u7406\u6765\u8bf4\uff0c\u8fd9\u5e76\u4e0d\u662f\u4e00\u4e2a\u95ee\u9898\u3002\u56e0\u4e3a\u6240\u6709\u6570\u636e\u90fd\u5df2\u6536\u96c6\u5b8c\u6bd5\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u3001\u6392\u5217\u6570\u636e\uff0c\u5f97\u5230\u60f3\u8981\u7684\u7ed3\u679c\u3002\u53ef\u5982\u679c\u6211\u4eec\u91c7\u7528\u201c\u6765\u4e00\u4e2a\u5904\u7406\u4e00\u4e2a\u201d\u7684\u6d41\u5904\u7406\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0 \u201c\u4e71\u5e8f\u201d\u7684\u73b0\u8c61\uff1a\u672c\u6765\u5148\u53d1\u751f\u7684\u4e8b\u4ef6\uff0c\u56e0\u4e3a\u5206\u5e03\u5904\u7406\u7684\u539f\u56e0\u6ede\u540e\u4e86\u3002\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f</p> <p>\u4ee5 Storm \u4e3a\u4ee3\u8868\u7684\u7b2c\u4e00\u4ee3\u5206\u5e03\u5f0f\u5f00\u6e90\u6d41\u5904\u7406\u5668\uff0c\u4e3b\u8981\u4e13\u6ce8\u4e8e\u5177\u6709\u6beb\u79d2\u5ef6\u8fdf\u7684\u4e8b\u4ef6\u5904\u7406\uff0c\u7279\u70b9\u5c31\u662f\u4e00\u4e2a\u5b57\u201c\u5feb\u201d\uff1b\u800c\u5bf9\u4e8e\u51c6\u786e\u6027\u548c\u7ed3\u679c\u7684\u4e00\u81f4\u6027\uff0c\u662f\u4e0d\u63d0\u4f9b\u5185\u7f6e\u652f\u6301\u7684\uff0c\u56e0\u4e3a\u7ed3\u679c\u6709\u53ef\u80fd\u53d6\u51b3\u4e8e\u5230\u8fbe\u4e8b\u4ef6\u7684\u65f6\u95f4\u548c\u987a\u5e8f\u3002\u53e6\u5916\uff0c\u7b2c\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u901a\u8fc7\u68c0\u67e5\u70b9\u6765\u4fdd\u8bc1\u5bb9\u9519\u6027\uff0c\u4f46\u662f\u6545\u969c\u6062 \u590d\u7684\u65f6\u5019\uff0c\u5373\u4f7f\u4e8b\u4ef6\u4e0d\u4f1a\u4e22\u5931\uff0c\u4e5f\u6709\u53ef\u80fd\u88ab\u91cd\u590d\u5904\u7406\u2014\u2014\u6240\u4ee5\u65e0\u6cd5\u4fdd\u8bc1 exactly-once\u3002</p> <p>\u4e0e\u6279\u5904\u7406\u5668\u76f8\u6bd4\uff0c\u53ef\u4ee5\u8bf4\u7b2c\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u727a\u7272\u4e86\u7ed3\u679c\u7684\u51c6\u786e\u6027\uff0c\u7528\u6765\u6362\u53d6\u66f4\u4f4e\u7684\u5ef6\u8fdf\u3002\u800c \u6279\u5904\u7406\u5668\u6070\u597d\u53cd\u8fc7\u6765\uff0c\u727a\u7272\u4e86\u5b9e\u65f6\u6027\uff0c\u6362\u53d6\u4e86\u7ed3\u679c\u7684\u51c6\u786e\u3002</p> <p>\u6211\u4eec\u81ea\u7136\u60f3\u5230\uff0c\u5982\u679c\u53ef\u4ee5\u8ba9\u4e8c\u8005\u505a\u4e2a\u7ed3\u5408\uff0c\u4e0d\u5c31\u53ef\u4ee5\u540c\u65f6\u63d0\u4f9b\u5feb\u901f\u548c\u51c6\u786e\u7684\u7ed3\u679c\u4e86\u5417\uff1f\u6b63\u662f\u57fa\u4e8e\u8fd9\u6837\u7684\u601d\u60f3\uff0cLambda \u67b6\u6784\u88ab\u8bbe\u8ba1\u51fa\u6765\uff0c\u5982\u56fe\u6240\u793a\u3002\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u8fd9\u662f\u7b2c\u4e8c\u4ee3\u6d41\u5904\u7406\u67b6\u6784\uff0c\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u5b83\u53ea\u662f\u7b2c\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u548c\u6279\u5904\u7406\u5668\u7684\u7b80\u5355\u5408\u5e76\u3002</p> <p></p> <p>Lambda \u67b6\u6784\u4e3b\u4f53\u662f\u4f20\u7edf\u6279\u5904\u7406\u67b6\u6784\u7684\u589e\u5f3a\u3002\u5b83\u7684\u201c\u6279\u5904\u7406\u5c42\u201d\uff08Batch Layer\uff09\u5c31\u662f\u7531\u4f20\u7edf \u7684\u6279\u5904\u7406\u5668\u548c\u5b58\u50a8\u7ec4\u6210\uff0c\u800c\u201c\u5b9e\u65f6\u5c42\u201d\uff08Speed Layer\uff09\u5219\u7531\u4f4e\u5ef6\u8fdf\u7684\u6d41\u5904\u7406\u5668\u5b9e\u73b0\u3002\u6570\u636e\u5230\u8fbe\u4e4b\u540e\uff0c\u4e24\u5c42\u5904\u7406\u53cc\u7ba1\u9f50\u4e0b\uff0c\u4e00\u65b9\u9762\u7531\u6d41\u5904\u7406\u5668\u8fdb\u884c\u5b9e\u65f6\u5904\u7406\uff0c\u53e6\u4e00\u65b9\u9762\u5199\u5165\u6279\u5904\u7406\u5b58\u50a8\u7a7a\u95f4\uff0c \u7b49\u5f85\u6279\u5904\u7406\u5668\u6279\u91cf\u8ba1\u7b97\u3002\u6d41\u5904\u7406\u5668\u5feb\u901f\u8ba1\u7b97\u51fa\u4e00\u4e2a\u8fd1\u4f3c\u7ed3\u679c\uff0c\u5e76\u5c06\u5b83\u4eec\u5199\u5165\u201c\u6d41\u5904\u7406\u8868\u201d\u4e2d\u3002 \u800c\u6279\u5904\u7406\u5668\u4f1a\u5b9a\u671f\u5904\u7406\u5b58\u50a8\u4e2d\u7684\u6570\u636e\uff0c\u5c06\u51c6\u786e\u7684\u7ed3\u679c\u5199\u5165\u6279\u5904\u7406\u8868\uff0c\u5e76\u4ece\u5feb\u901f\u8868\u4e2d\u5220\u9664\u4e0d\u51c6\u786e\u7684\u7ed3\u679c\u3002\u6700\u7ec8\uff0c\u5e94\u7528\u7a0b\u5e8f\u4f1a\u5408\u5e76\u5feb\u901f\u8868\u548c\u6279\u5904\u7406\u8868\u4e2d\u7684\u7ed3\u679c\uff0c\u5e76\u5c55\u793a\u51fa\u6765\u3002</p> <p>Lambda \u67b6\u6784\u73b0\u5728\u5df2\u7ecf\u4e0d\u518d\u662f\u6700\u5148\u8fdb\u7684\uff0c\u4f46\u4ecd\u5728\u8bb8\u591a\u5730\u65b9\u4f7f\u7528\u3002\u5b83\u7684\u4f18\u70b9\u975e\u5e38\u660e\u663e\uff0c\u5c31\u662f\u517c\u5177\u4e86\u6279\u5904\u7406\u5668\u548c\u7b2c\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u7684\u7279\u70b9\uff0c\u540c\u65f6\u4fdd\u8bc1\u4e86\u4f4e\u5ef6\u8fdf\u548c\u7ed3\u679c\u7684\u51c6\u786e\u6027\u3002\u800c\u5b83\u7684\u7f3a\u70b9\u540c\u6837\u975e\u5e38\u660e\u663e\u3002\u9996\u5148\uff0cLambda \u67b6\u6784\u672c\u8eab\u5c31\u5f88\u96be\u5efa\u7acb\u548c\u7ef4\u62a4\uff1b\u800c\u4e14\uff0c\u5b83\u9700\u8981\u6211\u4eec\u5bf9\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c \u505a\u51fa\u4e24\u5957\u8bed\u4e49\u4e0a\u7b49\u6548\u7684\u903b\u8f91\u5b9e\u73b0\uff0c\u56e0\u4e3a\u6279\u5904\u7406\u548c\u6d41\u5904\u7406\u662f\u4e24\u5957\u5b8c\u5168\u72ec\u7acb\u7684\u7cfb\u7edf\uff0c\u5b83\u4eec\u7684 API \u4e5f\u5b8c\u5168\u4e0d\u540c\u3002\u4e3a\u4e86\u5b9e\u73b0\u4e00\u4e2a\u5e94\u7528\uff0c\u4ed8\u51fa\u4e86\u53cc\u500d\u7684\u5de5\u4f5c\u91cf\uff0c\u8fd9\u5bf9\u7a0b\u5e8f\u5458\u663e\u7136\u4e0d\u591f\u53cb\u597d\u3002</p>"},{"location":"engine/flink/flink_01/#135","title":"1.3.5 \u65b0\u4e00\u4ee3\u6d41\u5904\u7406\u5668","text":"<p>\u4e4b\u524d\u7684\u5206\u5e03\u5f0f\u6d41\u5904\u7406\u67b6\u6784\uff0c\u90fd\u6709\u660e\u663e\u7684\u7f3a\u9677\uff0c\u4eba\u4eec\u4e5f\u4e00\u76f4\u6ca1\u6709\u653e\u5f03\u5bf9\u6d41\u5904\u7406\u5668\u7684\u6539\u8fdb\u548c\u5b8c\u5584\u3002\u7ec8\u4e8e\uff0c\u5728\u539f\u6709\u6d41\u5904\u7406\u5668\u7684\u57fa\u7840\u4e0a\uff0c\u65b0\u4e00\u4ee3\u5206\u5e03\u5f0f\u5f00\u6e90\u6d41\u5904\u7406\u5668\u8bde\u751f\u4e86\u3002\u4e3a\u4e86\u4e0e\u4e4b\u524d\u7684\u7cfb\u7edf\u533a\u5206\uff0c\u6211\u4eec\u4e00\u822c\u79f0\u4e4b\u4e3a\u7b2c\u4e09\u4ee3\u6d41\u5904\u7406\u5668\uff0c\u4ee3\u8868\u5f53\u7136\u5c31\u662f Flink\u3002</p> <p>\u7b2c\u4e09\u4ee3\u6d41\u5904\u7406\u5668\u901a\u8fc7\u5de7\u5999\u7684\u8bbe\u8ba1\uff0c\u5b8c\u7f8e\u89e3\u51b3\u4e86\u4e71\u5e8f\u6570\u636e\u5bf9\u7ed3\u679c\u6b63\u786e\u6027\u7684\u5f71\u54cd\u3002\u8fd9\u4e00\u4ee3\u7cfb\u7edf\u8fd8\u505a\u5230\u4e86\u7cbe\u786e\u4e00\u6b21\uff08exactly-once\uff09\u7684\u4e00\u81f4\u6027\u4fdd\u969c\uff0c\u662f\u7b2c\u4e00\u4e2a\u5177\u6709\u4e00\u81f4\u6027\u548c\u51c6\u786e\u7ed3\u679c\u7684\u5f00\u6e90\u6d41\u5904\u7406\u5668\u3002\u53e6\u5916\uff0c\u5148\u524d\u7684\u6d41\u5904\u7406\u5668\u4ec5\u80fd\u5728\u9ad8\u541e\u5410\u548c\u4f4e\u5ef6\u8fdf\u4e2d\u4e8c\u9009\u4e00\uff0c\u800c\u65b0\u4e00\u4ee3\u7cfb\u7edf\u80fd\u591f\u540c\u65f6\u63d0\u4f9b\u8fd9\u4e24\u4e2a\u7279\u6027\u3002\u6240\u4ee5\u53ef\u4ee5\u8bf4\uff0c\u8fd9\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u4ec5\u51ed\u4e00\u5957\u7cfb\u7edf\u5c31\u5b8c\u6210\u4e86 Lambda \u67b6\u6784\u4e24\u5957\u7cfb\u7edf\u7684\u5de5\u4f5c\uff0c\u5b83\u7684\u51fa\u73b0\u4f7f\u5f97 Lambda \u67b6\u6784\u9eef\u7136\u5931\u8272\u3002</p> <p>\u9664\u4e86\u4f4e\u5ef6\u8fdf\u3001\u5bb9\u9519\u548c\u7ed3\u679c\u51c6\u786e\u6027\u4e4b\u5916\uff0c\u65b0\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u8fd8\u5728\u4e0d\u65ad\u6dfb\u52a0\u65b0\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u9ad8\u53ef\u7528\u7684\u8bbe\u7f6e\uff0c\u4ee5\u53ca\u4e0e\u8d44\u6e90\u7ba1\u7406\u5668\uff08\u5982 YARN \u6216 Kubernetes\uff09\u7684\u7d27\u5bc6\u96c6\u6210\u7b49\u7b49\u3002</p> <p>\u5728\u4e0b\u4e00\u8282\uff0c\u6211\u4eec\u4f1a\u5c06 Flink \u7684\u7279\u6027\u505a\u4e00\u4e2a\u603b\u7ed3\uff0c\u4ece\u4e2d\u53ef\u4ee5\u4f53\u4f1a\u5230\u65b0\u4e00\u4ee3\u6d41\u5904\u7406\u5668\u7684\u5f3a\u5927\u3002</p>"},{"location":"engine/flink/flink_01/#14-flink","title":"1.4 Flink \u7684\u7279\u6027\u603b\u7ed3","text":"<p>Flink \u662f\u7b2c\u4e09\u4ee3\u5206\u5e03\u5f0f\u6d41\u5904\u7406\u5668\uff0c\u5b83\u7684\u529f\u80fd\u4e30\u5bcc\u800c\u5f3a\u5927\u3002</p>"},{"location":"engine/flink/flink_01/#141-flink","title":"1.4.1 Flink \u7684\u6838\u5fc3\u7279\u6027","text":"<p>Flink \u533a\u522b\u4e0e\u4f20\u7edf\u6570\u636e\u5904\u7406\u6846\u67b6\u7684\u7279\u6027\u5982\u4e0b</p> <ul> <li>\u9ad8\u541e\u5410\u548c\u4f4e\u5ef6\u8fdf\u3002\u6bcf\u79d2\u5904\u7406\u6570\u767e\u4e07\u4e2a\u4e8b\u4ef6\uff0c\u6beb\u79d2\u7ea7\u5ef6\u8fdf</li> <li>\u7ed3\u679c\u7684\u51c6\u786e\u6027\u3002Flink \u63d0\u4f9b\u4e86\u4e8b\u4ef6\u65f6\u95f4\uff08event-time\uff09\u548c\u5904\u7406\u65f6\u95f4\uff08processing-time\uff09 \u8bed\u4e49\u3002\u5bf9\u4e8e\u4e71\u5e8f\u4e8b\u4ef6\u6d41\uff0c\u4e8b\u4ef6\u65f6\u95f4\u8bed\u4e49\u4ecd\u7136\u80fd\u63d0\u4f9b\u4e00\u81f4\u4e14\u51c6\u786e\u7684\u7ed3\u679c</li> <li>\u7cbe\u786e\u4e00\u6b21\uff08exactly-once\uff09\u7684\u72b6\u6001\u4e00\u81f4\u6027\u4fdd\u8bc1</li> <li>\u53ef\u4ee5\u8fde\u63a5\u5230\u6700\u5e38\u7528\u7684\u5b58\u50a8\u7cfb\u7edf\uff0c\u5982 Apache Kafka\u3001Apache Cassandra\u3001Elasticsearch\u3001JDBC\u3001Kinesis \u548c\uff08\u5206\u5e03\u5f0f\uff09\u6587\u4ef6\u7cfb\u7edf\uff0c\u5982 HDFS \u548c S3</li> <li>\u9ad8\u53ef\u7528\u3002\u672c\u8eab\u9ad8\u53ef\u7528\u7684\u8bbe\u7f6e\uff0c\u52a0\u4e0a\u4e0e K8s\uff0cYARN \u548c Mesos \u7684\u7d27\u5bc6\u96c6\u6210\uff0c\u518d\u52a0\u4e0a\u4ece\u6545\u969c\u4e2d\u5feb\u901f\u6062\u590d\u548c\u52a8\u6001\u6269\u5c55\u4efb\u52a1\u7684\u80fd\u529b\uff0cFlink \u80fd\u505a\u5230\u4ee5\u6781\u5c11\u7684\u505c\u673a\u65f6\u95f4 7\u00d724 \u5168\u5929\u5019 \u8fd0\u884c</li> <li>\u80fd\u591f\u66f4\u65b0\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u5e76\u5c06\u4f5c\u4e1a\uff08jobs\uff09\u8fc1\u79fb\u5230\u4e0d\u540c\u7684 Flink \u96c6\u7fa4\uff0c\u800c\u4e0d\u4f1a\u4e22\u5931\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001</li> </ul>"},{"location":"engine/flink/flink_01/#142-api","title":"1.4.2 \u5206\u5c42 API","text":"<p>\u9664\u4e86\u4e0a\u8ff0\u8fd9\u4e9b\u7279\u6027\u4e4b\u5916\uff0cFlink \u8fd8\u662f\u4e00\u4e2a\u975e\u5e38\u6613\u4e8e\u5f00\u53d1\u7684\u6846\u67b6\uff0c\u56e0\u4e3a\u5b83\u62e5\u6709\u6613\u4e8e\u4f7f\u7528\u7684\u5206 \u5c42 API\uff0c\u6574\u4f53 API \u5206\u5c42\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u6700\u5e95\u5c42\u7ea7\u7684\u62bd\u8c61\u4ec5\u4ec5\u63d0\u4f9b\u4e86\u6709\u72b6\u6001\u6d41\uff0c \u5b83\u5c06\u5904\u7406\u51fd\u6570\uff08 Process Function \uff09\u5d4c\u5165\u5230\u4e86 DataStream API \u4e2d\u3002\u5e95\u5c42\u5904\u7406\u51fd\u6570\uff08Process Function\uff09\u4e0e DataStream API \u76f8\u96c6\u6210\uff0c\u53ef\u4ee5\u5bf9\u67d0\u4e9b\u64cd\u4f5c\u8fdb\u884c\u62bd\u8c61\uff0c\u5b83\u5141\u8bb8\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u72b6\u6001\u5904\u7406\u6765\u81ea\u4e00\u4e2a\u6216\u591a\u4e2a\u6570\u636e\u6d41\u7684\u4e8b\u4ef6\uff0c\u4e14\u72b6\u6001\u5177\u6709\u4e00\u81f4\u6027\u548c\u5bb9\u9519\u4fdd\u8bc1\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u7528\u6237\u53ef\u4ee5\u6ce8\u518c\u4e8b\u4ef6\u65f6\u95f4\u5e76\u5904\u7406\u65f6\u95f4\u56de\u8c03\uff0c\u4ece\u800c\u4f7f\u7a0b\u5e8f\u53ef\u4ee5\u5904\u7406\u590d\u6742\u7684\u8ba1\u7b97\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5927\u591a\u6570\u5e94\u7528\u5e76\u4e0d\u9700\u8981\u4e0a\u8ff0\u7684\u5e95\u5c42\u62bd\u8c61\uff0c\u800c\u662f\u76f4\u63a5\u9488\u5bf9\u6838\u5fc3 API\uff08Core APIs\uff09 \u8fdb\u884c\u7f16\u7a0b\uff0c\u6bd4\u5982 DataStream API\uff08\u7528\u4e8e\u5904\u7406\u6709\u754c\u6216\u65e0\u754c\u6d41\u6570\u636e\uff09\u4ee5\u53ca DataSet API\uff08\u7528\u4e8e\u5904\u7406\u6709\u754c \u6570\u636e\u96c6\uff09\u3002\u8fd9\u4e9b API \u4e3a\u6570\u636e\u5904\u7406\u63d0\u4f9b\u4e86\u901a\u7528\u7684\u6784\u5efa\u6a21\u5757\uff0c\u6bd4\u5982\u7531\u7528\u6237\u5b9a\u4e49\u7684\u591a\u79cd\u5f62\u5f0f\u7684\u8f6c\u6362 \uff08transformations\uff09\u3001\u8fde\u63a5\uff08joins\uff09\u3001\u805a\u5408\uff08aggregations\uff09\u3001\u7a97\u53e3\uff08windows\uff09\u64cd\u4f5c\u7b49\u3002DataSet API \u4e3a\u6709\u754c\u6570\u636e\u96c6\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u652f\u6301\uff0c\u4f8b\u5982\u5faa\u73af\u4e0e\u8fed\u4ee3\u3002\u8fd9\u4e9b API \u5904\u7406\u7684\u6570\u636e\u7c7b\u578b\u4ee5\u7c7b\uff08classes\uff09 \u7684\u5f62\u5f0f\u7531\u5404\u81ea\u7684\u7f16\u7a0b\u8bed\u8a00\u6240\u8868\u793a\u3002</p> <p>Table API \u662f\u4ee5\u8868\u4e3a\u4e2d\u5fc3\u7684\u58f0\u660e\u5f0f\u7f16\u7a0b\uff0c\u5176\u4e2d\u8868\u5728\u8868\u8fbe\u6d41\u6570\u636e\u65f6\u4f1a\u52a8\u6001\u53d8\u5316\u3002Table API \u9075\u5faa\u5173\u7cfb\u6a21\u578b\uff1a\u8868\u6709\u4e8c\u7ef4\u6570\u636e\u7ed3\u6784\uff08schema\uff09\uff08\u7c7b\u4f3c\u4e8e\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u7684\u8868\uff09\uff0c\u540c\u65f6 API \u63d0\u4f9b\u53ef\u6bd4\u8f83\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982 select\u3001join\u3001group-by\u3001aggregate \u7b49\u3002</p> <p>\u5c3d\u7ba1 Table API \u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u7c7b\u578b\u7684\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\uff08UDF\uff09\u8fdb\u884c\u6269\u5c55\uff0c\u4ecd\u4e0d\u5982\u6838\u5fc3 API \u66f4\u5177\u8868\u8fbe\u80fd\u529b\uff0c\u4f46\u662f\u4f7f\u7528\u8d77\u6765\u4ee3\u7801\u91cf\u66f4\u5c11\uff0c\u66f4\u52a0\u7b80\u6d01\u3002\u9664\u6b64\u4e4b\u5916\uff0cTable API \u7a0b\u5e8f\u5728\u6267\u884c\u4e4b\u524d\u4f1a\u4f7f\u7528\u5185\u7f6e\u4f18\u5316\u5668\u8fdb\u884c\u4f18\u5316\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u8868\u4e0e DataStream/DataSet \u4e4b\u95f4\u65e0\u7f1d\u5207\u6362\uff0c \u4ee5\u5141\u8bb8\u7a0b\u5e8f\u5c06 Table API \u4e0e DataStream \u4ee5\u53ca DataSet \u6df7\u5408\u4f7f\u7528\u3002</p> <p>Flink \u63d0\u4f9b\u7684\u6700\u9ad8\u5c42\u7ea7\u7684\u62bd\u8c61\u662f SQL\u3002\u8fd9\u4e00\u5c42\u62bd\u8c61\u5728\u8bed\u6cd5\u4e0e\u8868\u8fbe\u80fd\u529b\u4e0a\u4e0e Table API \u7c7b\u4f3c\uff0c \u4f46\u662f\u662f\u4ee5 SQL \u67e5\u8be2\u8868\u8fbe\u5f0f\u7684\u5f62\u5f0f\u8868\u73b0\u7a0b\u5e8f\u3002SQL \u62bd\u8c61\u4e0e Table API \u4ea4\u4e92\u5bc6\u5207\uff0c\u540c\u65f6 SQL \u67e5\u8be2\u53ef\u4ee5\u76f4\u63a5\u5728 Table API \u5b9a\u4e49\u7684\u8868\u4e0a\u6267\u884c\u3002</p> <p>\u76ee\u524d Flink SQL \u548c Table API \u8fd8\u5728\u5f00\u53d1\u5b8c\u5584\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5f88\u591a\u5927\u5382\u90fd\u4f1a\u4e8c\u6b21\u5f00\u53d1\u7b26\u5408\u81ea\u5df1\u9700\u8981\u7684\u5de5\u5177\u5305\u3002\u800c DataSet \u4f5c\u4e3a\u6279\u5904\u7406 API \u5b9e\u9645\u5e94\u7528\u8f83\u5c11\uff0c2020 \u5e74 12 \u6708 8 \u65e5\u53d1\u5e03\u7684\u65b0\u7248\u672c 1.12.0, \u5df2\u7ecf\u5b8c\u5168\u5b9e\u73b0\u4e86\u771f\u6b63\u7684\u6d41\u6279\u4e00\u4f53\uff0cDataSet API \u5df2\u5904\u4e8e\u8f6f\u6027\u5f03\u7528\uff08soft deprecated\uff09\u7684\u72b6\u6001\u3002\u7528 DataStream API \u5199\u597d\u7684\u4e00\u5957\u4ee3\u7801, \u5373\u53ef\u4ee5\u5904\u7406\u6d41\u6570\u636e, \u4e5f\u53ef\u4ee5\u5904\u7406\u6279\u6570\u636e\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u4e0d\u540c\u7684\u6267\u884c\u6a21\u5f0f\u3002\u8fd9\u4e0e\u4e4b\u524d\u7248\u672c\u5904\u7406\u6709\u754c\u6d41\u7684\u65b9\u5f0f\u662f\u4e0d\u4e00\u6837\u7684\uff0cFlink \u5df2\u4e13\u95e8\u5bf9\u6279\u5904\u7406\u6570\u636e\u505a\u4e86\u4f18\u5316\u5904\u7406\u3002</p>"},{"location":"engine/flink/flink_01/#15-flink-vs-spark","title":"1.5 Flink vs Spark","text":"<p>\u8c08\u5230\u5927\u6570\u636e\u5904\u7406\u5f15\u64ce\uff0c\u4e0d\u80fd\u4e0d\u63d0 Spark\u3002Apache Spark \u662f\u4e00\u4e2a\u901a\u7528\u5927\u89c4\u6a21\u6570\u636e\u5206\u6790\u5f15\u64ce\u3002 \u5b83\u63d0\u51fa\u7684\u5185\u5b58\u8ba1\u7b97\u6982\u5ff5\u8ba9\u5927\u5bb6\u8033\u76ee\u4e00\u65b0\uff0c\u5f97\u4ee5\u4ece Hadoop \u7e41\u91cd\u7684 MapReduce \u7a0b\u5e8f\u4e2d\u89e3\u8131\u51fa\u6765\uff0c \u53ef\u4ee5\u8bf4\u662f\u5212\u65f6\u4ee3\u7684\u5927\u6570\u636e\u5904\u7406\u6846\u67b6\u3002\u9664\u4e86\u8ba1\u7b97\u901f\u5ea6\u5feb\u3001\u53ef\u6269\u5c55\u6027\u5f3a\uff0cSpark \u8fd8\u4e3a\u6279\u5904\u7406\uff08Spark SQL\uff09\u3001\u6d41\u5904\u7406\uff08Spark Streaming\uff09\u3001\u673a\u5668\u5b66\u4e60\uff08Spark MLlib\uff09\u3001\u56fe\u8ba1\u7b97\uff08Spark GraphX\uff09\u63d0\u4f9b \u4e86\u7edf\u4e00\u7684\u5206\u5e03\u5f0f\u6570\u636e\u5904\u7406\u5e73\u53f0\uff0c\u6574\u4e2a\u751f\u6001\u7ecf\u8fc7\u591a\u5e74\u7684\u84ec\u52c3\u53d1\u5c55\u5df2\u7ecf\u975e\u5e38\u5b8c\u5584\u3002</p> <p>\u7136\u800c\u6b63\u5728\u5927\u5bb6\u8ba4\u4e3a Spark \u5df2\u7ecf\u5982\u65e5\u4e2d\u5929\u3001\u5373\u5c06\u4e00\u7edf\u5929\u4e0b\u4e4b\u9645\uff0cFlink \u5982\u4e00\u9897\u65b0\u661f\u5f02\u519b\u7a81\u8d77\uff0c \u4f7f\u5f97\u5927\u6570\u636e\u5904\u7406\u7684\u6c5f\u6e56\u518d\u8d77\u98ce\u4e91\u3002\u5f88\u591a\u8bfb\u8005\u5728\u6700\u521d\u63a5\u89e6\u90fd\u4f1a\u6709\u8fd9\u6837\u7684\u7591\u95ee\uff1a\u60f3\u5b66\u4e60\u4e00\u4e2a\u5927\u6570\u636e\u5904\u7406\u6846\u67b6\uff0c\u5230\u5e95\u9009\u62e9 Spark\uff0c\u8fd8\u662f Flink \u5462\uff1f</p> <p>\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u4e86\u89e3\u4e24\u8005\u7684\u4e3b\u8981\u533a\u522b\uff0c\u7406\u89e3\u5b83\u4eec\u5728\u4e0d\u540c\u9886\u57df\u7684\u4f18\u52bf\u3002</p>"},{"location":"engine/flink/flink_01/#151","title":"1.5.1 \u6570\u636e\u5904\u7406\u67b6\u6784","text":"<p>\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\uff0c\u6570\u636e\u5904\u7406\u7684\u57fa\u672c\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5206\u4e3a\u6279\u5904\u7406\u548c\u6d41\u5904\u7406\u4e24\u79cd\u3002</p> <p>\u6279\u5904\u7406\u9488\u5bf9\u7684\u662f\u6709\u754c\u6570\u636e\u96c6\uff0c\u975e\u5e38\u9002\u5408\u9700\u8981\u8bbf\u95ee\u6d77\u91cf\u7684\u5168\u90e8\u6570\u636e\u624d\u80fd\u5b8c\u6210\u7684\u8ba1\u7b97\u5de5\u4f5c\uff0c\u4e00 \u822c\u7528\u4e8e\u79bb\u7ebf\u7edf\u8ba1\u3002</p> <p>\u6d41\u5904\u7406\u4e3b\u8981\u9488\u5bf9\u7684\u662f\u6570\u636e\u6d41\uff0c\u7279\u70b9\u662f\u65e0\u754c\u3001\u5b9e\u65f6, \u5bf9\u7cfb\u7edf\u4f20\u8f93\u7684\u6bcf\u4e2a\u6570\u636e\u4f9d\u6b21\u6267\u884c\u64cd\u4f5c\uff0c \u4e00\u822c\u7528\u4e8e\u5b9e\u65f6\u7edf\u8ba1\u3002</p> <p>\u4ece\u6839\u672c\u4e0a\u8bf4\uff0cSpark \u548c Flink \u91c7\u7528\u4e86\u5b8c\u5168\u4e0d\u540c\u7684\u6570\u636e\u5904\u7406\u65b9\u5f0f\u3002\u53ef\u4ee5\u8bf4\uff0c\u4e24\u8005\u7684\u4e16\u754c\u89c2\u662f\u622a\u7136\u76f8\u53cd\u7684\u3002</p> <p>Spark \u4ee5\u6279\u5904\u7406\u4e3a\u6839\u672c\uff0c\u5e76\u5c1d\u8bd5\u5728\u6279\u5904\u7406\u4e4b\u4e0a\u652f\u6301\u6d41\u8ba1\u7b97\uff1b\u5728 Spark \u7684\u4e16\u754c\u89c2\u4e2d\uff0c\u4e07\u7269\u7686\u6279\u6b21\uff0c\u79bb\u7ebf\u6570\u636e\u662f\u4e00\u4e2a\u5927\u6279\u6b21\uff0c\u800c\u5b9e\u65f6\u6570\u636e\u5219\u662f\u7531\u4e00\u4e2a\u4e00\u4e2a\u65e0\u9650\u7684\u5c0f\u6279\u6b21\u7ec4\u6210\u7684\u3002\u6240\u4ee5\u5bf9\u4e8e\u6d41\u5904\u7406\u6846\u67b6 Spark Streaming \u800c\u8a00\uff0c \u5176\u5b9e\u5e76\u4e0d\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u201c\u6d41\u201d\u5904\u7406\uff0c \u800c\u662f\u201c\u5fae\u6279\u6b21\u201d \uff08micro-batching\uff09\u5904\u7406\u3002</p> <p></p> <p>\u800c Flink \u5219\u8ba4\u4e3a\uff0c\u6d41\u5904\u7406\u624d\u662f\u6700\u57fa\u672c\u7684\u64cd\u4f5c\uff0c\u6279\u5904\u7406\u4e5f\u53ef\u4ee5\u7edf\u4e00\u4e3a\u6d41\u5904\u7406\u3002\u5728 Flink \u7684\u4e16\u754c\u89c2\u4e2d\uff0c\u4e07\u7269\u7686\u6d41\uff0c\u5b9e\u65f6\u6570\u636e\u662f\u6807\u51c6\u7684\u3001\u6ca1\u6709\u754c\u9650\u7684\u6d41\uff0c\u800c\u79bb\u7ebf\u6570\u636e\u5219\u662f\u6709\u754c\u9650\u7684\u6d41\u3002\u5982\u56fe\u6240\u793a\uff0c\u5c31\u662f\u6240\u8c13\u7684\u65e0\u754c\u6d41\u548c\u6709\u754c\u6d41\u3002</p>"},{"location":"engine/flink/flink_01/#1-unbounded-data-stream","title":"1. \u65e0\u754c\u6570\u636e\u6d41\uff08Unbounded Data Stream\uff09","text":"<p>\u6240\u8c13\u65e0\u754c\u6570\u636e\u6d41\uff0c\u5c31\u662f\u6709\u5934\u6ca1\u5c3e\uff0c\u6570\u636e\u7684\u751f\u6210\u548c\u4f20\u9012\u4f1a\u5f00\u59cb\u4f46\u6c38\u8fdc\u4e0d\u4f1a\u7ed3\u675f\uff0c\u5982\u56fe\u6240\u793a\u3002\u6211\u4eec\u65e0\u6cd5\u7b49\u5f85\u6240\u6709\u6570\u636e\u90fd\u5230\u8fbe\uff0c\u56e0\u4e3a\u8f93\u5165\u662f\u65e0\u754c\u7684\uff0c\u6c38\u65e0\u6b62\u5883\uff0c\u6570\u636e\u6ca1\u6709\u201c\u90fd\u5230\u8fbe\u201d\u7684 \u65f6\u5019\u3002\u6240\u4ee5\u5bf9\u4e8e\u65e0\u754c\u6570\u636e\u6d41\uff0c\u5fc5\u987b\u8fde\u7eed\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u8bf4\u5fc5\u987b\u5728\u83b7\u53d6\u6570\u636e\u540e\u7acb\u5373\u5904\u7406\u3002\u5728\u5904\u7406\u65e0\u754c\u6d41\u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u7ed3\u679c\u7684\u6b63\u786e\u6027\uff0c\u6211\u4eec\u5fc5\u987b\u80fd\u591f\u505a\u5230\u6309\u7167\u987a\u5e8f\u5904\u7406\u6570\u636e\u3002</p>"},{"location":"engine/flink/flink_01/#2-bounded-data-stream","title":"2. \u6709\u754c\u6570\u636e\u6d41\uff08Bounded Data Stream\uff09","text":"<p>\u5bf9\u5e94\u7684\uff0c\u6709\u754c\u6570\u636e\u6d41\u6709\u660e\u786e\u5b9a\u4e49\u7684\u5f00\u59cb\u548c\u7ed3\u675f\uff0c\u5982\u56fe\u6240\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u83b7\u53d6\u6240\u6709\u6570\u636e\u6765\u5904\u7406\u6709\u754c\u6d41\u3002\u5904\u7406\u6709\u754c\u6d41\u5c31\u4e0d\u9700\u8981\u4e25\u683c\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\u4e86\uff0c\u56e0\u4e3a\u603b\u53ef\u4ee5\u5bf9\u6709\u754c\u6570\u636e\u96c6\u8fdb\u884c\u6392\u5e8f\u3002\u6709\u754c\u6d41\u7684\u5904\u7406\u4e5f\u5c31\u662f\u6279\u5904\u7406\u3002</p> <p></p> <p>\u6b63\u56e0\u4e3a\u8fd9\u79cd\u67b6\u6784\u4e0a\u7684\u4e0d\u540c\uff0cSpark \u548c Flink \u5728\u4e0d\u540c\u7684\u5e94\u7528\u9886\u57df\u4e0a\u8868\u73b0\u4f1a\u6709\u5dee\u522b\u3002\u4e00\u822c\u6765\u8bf4\uff0c Spark \u57fa\u4e8e\u5fae\u6279\u5904\u7406\u7684\u65b9\u5f0f\u505a\u540c\u6b65\u603b\u6709\u4e00\u4e2a\u201c\u6512\u6279\u201d\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u4f1a\u6709\u989d\u5916\u5f00\u9500\uff0c\u56e0\u6b64\u65e0\u6cd5\u5728\u6d41\u5904\u7406\u7684\u4f4e\u5ef6\u8fdf\u4e0a\u505a\u5230\u6781\u81f4\u3002\u5728\u4f4e\u5ef6\u8fdf\u6d41\u5904\u7406\u573a\u666f\uff0cFlink \u5df2\u7ecf\u6709\u660e\u663e\u7684\u4f18\u52bf\u3002\u800c\u5728\u6d77\u91cf\u6570\u636e \u7684\u6279\u5904\u7406\u9886\u57df\uff0cSpark \u80fd\u591f\u5904\u7406\u7684\u541e\u5410\u91cf\u66f4\u5927\uff0c\u52a0\u4e0a\u5176\u5b8c\u5584\u7684\u751f\u6001\u548c\u6210\u719f\u6613\u7528\u7684 API\uff0c\u76ee\u524d\u540c \u6837\u4f18\u52bf\u6bd4\u8f83\u660e\u663e\u3002</p>"},{"location":"engine/flink/flink_01/#152","title":"1.5.2 \u6570\u636e\u6a21\u578b\u548c\u8fd0\u884c\u67b6\u6784","text":"<p>\u9664\u4e86\u4e09\u89c2\u4e0d\u5408\uff0cSpark \u548c Flink \u5728\u5e95\u5c42\u5b9e\u73b0\u6700\u4e3b\u8981\u7684\u5dee\u522b\u5c31\u5728\u4e8e\u6570\u636e\u6a21\u578b\u4e0d\u540c\u3002</p> <p>Spark \u5e95\u5c42\u6570\u636e\u6a21\u578b\u662f\u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6\uff08RDD\uff09\uff0cSpark Streaming \u8fdb\u884c\u5fae\u6279\u5904\u7406\u7684\u5e95\u5c42\u63a5\u53e3 DStream\uff0c\u5b9e\u9645\u4e0a\u5904\u7406\u7684\u4e5f\u662f\u4e00\u7ec4\u7ec4\u5c0f\u6279\u6570\u636e RDD \u7684\u96c6\u5408\u3002\u53ef\u4ee5\u770b\u51fa\uff0cSpark \u5728\u8bbe\u8ba1\u4e0a\u672c\u8eab\u5c31\u662f\u4ee5\u6279\u91cf\u7684\u6570\u636e\u96c6\u4f5c\u4e3a\u57fa\u51c6\u7684\uff0c\u66f4\u52a0\u9002\u5408\u6279\u5904\u7406\u7684\u573a\u666f\u3002</p> <p>\u800c Flink \u7684\u57fa\u672c\u6570\u636e\u6a21\u578b\u662f\u6570\u636e\u6d41\uff08DataFlow\uff09\uff0c\u4ee5\u53ca\u4e8b\u4ef6\uff08Event\uff09\u5e8f\u5217\u3002Flink \u57fa\u672c\u4e0a\u662f\u5b8c\u5168\u6309\u7167 Google \u7684 DataFlow \u6a21\u578b\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u4ece\u5e95\u5c42\u6570\u636e\u6a21\u578b\u4e0a\u770b\uff0cFlink \u662f\u4ee5\u5904\u7406\u6d41\u5f0f\u6570\u636e\u4f5c\u4e3a\u8bbe\u8ba1\u76ee\u6807\u7684\uff0c\u66f4\u52a0\u9002\u5408\u6d41\u5904\u7406\u7684\u573a\u666f\u3002</p> <p>\u6570\u636e\u6a21\u578b\u4e0d\u540c\uff0c\u5bf9\u5e94\u5728\u8fd0\u884c\u5904\u7406\u7684\u6d41\u7a0b\u4e0a\uff0c\u81ea\u7136\u4e5f\u4f1a\u6709\u4e0d\u540c\u7684\u67b6\u6784\u3002Spark \u505a\u6279\u8ba1\u7b97\uff0c\u9700\u8981\u5c06\u4efb\u52a1\u5bf9\u5e94\u7684 DAG \u5212\u5206\u9636\u6bb5\uff08Stage\uff09\uff0c\u4e00\u4e2a\u5b8c\u6210\u540e\u7ecf\u8fc7 shuffle \u518d\u8fdb\u884c\u4e0b\u4e00\u9636\u6bb5\u7684\u8ba1\u7b97\u3002\u800c Flink \u662f\u6807\u51c6\u7684\u6d41\u5f0f\u6267\u884c\u6a21\u5f0f\uff0c\u4e00\u4e2a\u4e8b\u4ef6\u5728\u4e00\u4e2a\u8282\u70b9\u5904\u7406\u5b8c\u540e\u53ef\u4ee5\u76f4\u63a5\u53d1\u5f80\u4e0b\u4e00\u4e2a\u8282\u70b9\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"engine/flink/flink_01/#153-spark-flink","title":"1.5.3 Spark \u8fd8\u662f Flink\uff1f","text":"<p>\u901a\u8fc7\u524d\u6587\u7684\u5206\u6790\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u770b\u51fa\uff0cSpark \u548c Flink \u53ef\u4ee5\u8bf4\u76ee\u524d\u662f\u5404\u64c5\u80dc\u573a\uff0c\u6279\u5904\u7406\u9886\u57df Spark \u79f0\u738b\uff0c\u800c\u5728\u6d41\u5904\u7406\u65b9\u9762 Flink \u5f53\u4ec1\u4e0d\u8ba9\u3002\u5177\u4f53\u5230\u9879\u76ee\u5e94\u7528\u4e2d\uff0c\u4e0d\u4ec5\u8981\u770b\u662f\u6d41\u5904\u7406\u8fd8\u662f\u6279\u5904\u7406\uff0c\u8fd8\u9700\u8981\u5728\u5ef6\u8fdf\u3001\u541e\u5410\u91cf\u3001\u53ef\u9760\u6027\uff0c\u4ee5\u53ca\u5f00\u53d1\u5bb9\u6613\u5ea6\u7b49\u591a\u4e2a\u65b9\u9762\u8fdb\u884c\u6743\u8861\u3002 </p> <p>\u5982\u679c\u5728\u5de5\u4f5c\u4e2d\u9700\u8981\u4ece Spark \u548c Flink \u8fd9\u4e24\u4e2a\u4e3b\u6d41\u6846\u67b6\u4e2d\u9009\u62e9\u4e00\u4e2a\u6765\u8fdb\u884c\u5b9e\u65f6\u6d41\u5904\u7406\uff0c\u6211\u4eec\u66f4\u52a0\u63a8\u8350\u4f7f\u7528 Flink\uff0c\u4e3b\u8981\u7684\u539f\u56e0\u6709\uff1a</p> <ul> <li>Flink \u7684\u5ef6\u8fdf\u662f\u6beb\u79d2\u7ea7\u522b\uff0c\u800c Spark Streaming \u7684\u5ef6\u8fdf\u662f\u79d2\u7ea7\u5ef6\u8fdf</li> <li>Flink \u63d0\u4f9b\u4e86\u4e25\u683c\u7684\u7cbe\u786e\u4e00\u6b21\u6027\u8bed\u4e49\u4fdd\u8bc1</li> <li>Flink \u7684\u7a97\u53e3 API \u66f4\u52a0\u7075\u6d3b\u3001\u8bed\u4e49\u66f4\u4e30\u5bcc</li> <li>Flink \u63d0\u4f9b\u4e8b\u4ef6\u65f6\u95f4\u8bed\u4e49\uff0c\u53ef\u4ee5\u6b63\u786e\u5904\u7406\u5ef6\u8fdf\u6570\u636e</li> <li>Flink \u63d0\u4f9b\u4e86\u66f4\u52a0\u7075\u6d3b\u7684\u5bf9\u72b6\u6001\u7f16\u7a0b\u7684 API</li> </ul> <p>\u57fa\u4e8e\u4ee5\u4e0a\u7279\u70b9\uff0c\u4f7f\u7528 Flink \u53ef\u4ee5\u89e3\u653e\u7a0b\u5e8f\u5458, \u52a0\u5feb\u7f16\u7a0b\u6548\u7387, \u628a\u672c\u6765\u9700\u8981\u7a0b\u5e8f\u5458\u82b1\u5927\u529b\u6c14\u624b\u52a8\u5b8c\u6210\u7684\u5de5\u4f5c\u4ea4\u7ed9\u6846\u67b6\u5b8c\u6210\u3002</p> <p>\u5f53\u7136\uff0c\u5728\u6d77\u91cf\u6570\u636e\u7684\u6279\u5904\u7406\u65b9\u9762\uff0cSpark \u8fd8\u662f\u5177\u6709\u660e\u663e\u7684\u4f18\u52bf\u3002\u800c\u4e14 Spark \u7684\u751f\u6001\u66f4\u52a0\u6210\u719f\uff0c\u4e5f\u4f1a\u4f7f\u5176\u5728\u5e94\u7528\u4e2d\u66f4\u4e3a\u65b9\u4fbf\u3002\u76f8\u4fe1\u968f\u7740 Flink \u7684\u5feb\u901f\u53d1\u5c55\u548c\u5b8c\u5584\uff0c\u8fd9\u65b9\u9762\u7684\u5dee\u8ddd\u4f1a\u8d8a\u6765\u8d8a\u5c0f\u3002</p> <p>\u53e6\u5916\uff0cSpark 2.0 \u4e4b\u540e\u65b0\u589e\u7684 Structured Streaming \u6d41\u5904\u7406\u5f15\u64ce\u501f\u9274 DataFlow \u8fdb\u884c\u4e86\u5927\u91cf\u4f18\u5316\uff0c\u540c\u6837\u505a\u5230\u4e86\u4f4e\u5ef6\u8fdf\u3001\u65f6\u95f4\u6b63\u786e\u6027\u4ee5\u53ca\u7cbe\u786e\u4e00\u6b21\u6027\u8bed\u4e49\u4fdd\u8bc1\uff1bSpark 2.3 \u4ee5\u540e\u5f15\u5165\u7684\u8fde\u7eed\u5904\u7406\uff08Continuous Processing\uff09\u6a21\u5f0f\uff0c\u66f4\u662f\u53ef\u4ee5\u5728\u81f3\u5c11\u4e00\u6b21\u8bed\u4e49\u4fdd\u8bc1\u4e0b\u505a\u5230 1 \u6beb\u79d2\u7684\u5ef6\u8fdf\u3002\u800c Flink \u81ea 1.9 \u7248\u672c\u5408\u5e76 Blink \u4ee5\u6765\uff0c\u5728 SQL \u7684\u8868\u8fbe\u548c\u6279\u5904\u7406\u7684\u80fd\u529b\u4e0a\u540c\u6837\u6709\u4e86\u957f\u8db3\u7684\u8fdb\u6b65\u3002</p> <p>\u90a3\u5982\u679c\u73b0\u5728\u8981\u5b66\u4e60\u4e00\u95e8\u6846\u67b6\u7684\u8bdd\uff0c\u4f18\u5148\u9009 Spark \u8fd8\u662f Flink \u5462\uff1f\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4e0d\u540c\u7684\u6846\u67b6\u5404\u6709\u5229\u5f0a\uff0c\u540c\u65f6\u5b83\u4eec\u4e5f\u5728\u4e92\u76f8\u501f\u9274\u3001\u53d6\u957f\u8865\u77ed\u3001\u4e0d\u65ad\u53d1\u5c55\uff0c\u81f3\u4e8e\u672a\u6765\u662f Spark \u8fd8\u662f Flink\u3001 \u751a\u81f3\u662f\u5176\u4ed6\u65b0\u5d1b\u8d77\u7684\u5904\u7406\u5f15\u64ce\u4e00\u7edf\u6c5f\u6e56\uff0c\u90fd\u662f\u6709\u53ef\u80fd\u7684\u3002\u4f5c\u4e3a\u6280\u672f\u4eba\u5458\uff0c\u6211\u4eec\u5e94\u8be5\u5bf9\u4e0d\u540c\u7684\u67b6\u6784\u548c\u601d\u60f3\u90fd\u6709\u6240\u4e86\u89e3\uff0c\u8df3\u51fa\u67d0\u4e2a\u6846\u67b6\u7684\u9650\u5236\uff0c\u624d\u80fd\u770b\u5230\u66f4\u5e7f\u9614\u7684\u4e16\u754c\u3002\u5230\u5e95 Spark \u8fd8\u662f Flink\uff1f \u2014\u2014\u5c0f\u5b69\u5b50\u624d\u505a\u9009\u62e9\u9898\uff01</p>"},{"location":"engine/flink/flink_02/","title":"\u7b2c\u4e8c\u7ae0 Flink\u8fd0\u884c\u65f6\u67b6\u6784","text":""},{"location":"engine/flink/flink_02/#21-flink","title":"2.1 Flink\u4e3b\u4ece\u67b6\u6784","text":"<ul> <li>Flink \u8fd0\u884c\u65f6\u67b6\u6784\u7531\u4e24\u79cd\u7c7b\u578b\u7684\u8fdb\u7a0b\u7ec4\u6210</li> <li>\u4e00\u4e2a JobManager\uff08\u4f5c\u4e1a\u7ba1\u7406\u5668\uff0cMaster \u8fdb\u7a0b\uff09</li> <li> <p>\u4e00\u4e2a\u6216\u8005\u591a\u4e2a TaskManager\uff08\u4efb\u52a1\u7ba1\u7406\u5668\uff0cSlave \u8fdb\u7a0b\uff09</p> </li> <li> <p>\u5178\u578b\u7684Master-Slave\uff08\u4e3b\u4ece\uff09\u67b6\u6784</p> </li> </ul> <p></p>"},{"location":"engine/flink/flink_02/#22","title":"2.2 \u4f5c\u4e1a\u7ba1\u7406\u5668","text":"<p>\u4f5c\u4e1a\u7ba1\u7406\u5668\u662f\u4e00\u4e2a JVM \u8fdb\u7a0b\u3002\u8fdb\u7a0b\u4e2d\u5305\u542b\u4e09\u7c7b\u7ebf\u7a0b\uff1a</p> <ul> <li>Flink \u7684\u8d44\u6e90\u7ba1\u7406\u5668\uff08ResourceManager\uff09\uff1a\u8d44\u6e90\u662f\u4efb\u52a1\u7ba1\u7406\u5668\u4e2d\u7684\u4efb\u52a1\u63d2\u69fd\uff08Task Slot\uff09</li> <li>\u5206\u53d1\u5668\uff08WebUI\uff09\uff1a\u63d0\u4ea4\u4efb\u52a1\u548c\u76d1\u63a7\u96c6\u7fa4\u548c\u4efb\u52a1</li> <li>JobMaster\uff08\u4f5c\u4e1a\u4e3b\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u4f5c\u4e1a\u5bf9\u5e94\u4e00\u4e2a\uff09\uff1a\u8c03\u5ea6\u4efb\u52a1\uff0c\u5c06 DAG \u90e8\u7f72\u5230\u4efb\u52a1\u7ba1\u7406\u5668\u3002</li> </ul> <p></p> <p>JobMaster \u7531\u4e8e\u662f\u6bcf\u4e2a\u4f5c\u4e1a\u5bf9\u5e94\u4e00\u4e2a\uff0c\u6240\u4ee5\u53ef\u80fd\u6709\u591a\u4e2a JobMaster \u7ebf\u7a0b\u3002</p>"},{"location":"engine/flink/flink_02/#23","title":"2.3 \u4efb\u52a1\u7ba1\u7406\u5668","text":"<ul> <li>\u4efb\u52a1\u7ba1\u7406\u5668\u4e5f\u662f\u4e00\u4e2a JVM \u8fdb\u7a0b\u3002\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u4efb\u52a1\u63d2\u69fd</li> <li>\u4efb\u52a1\u63d2\u69fd\u662f Flink \u7684\u6700\u5c0f\u8ba1\u7b97\u5355\u5143</li> <li>\u6bcf\u4e2a\u4efb\u52a1\u63d2\u69fd\u662f\u4e00\u4e2a\u5185\u5b58\u5206\u7247\uff0c\u6bcf\u4e2a\u4efb\u52a1\u63d2\u69fd\u5360\u7528\u4e00\u6bb5\u5185\u5b58</li> <li>\u4e00\u4e2a\u4efb\u52a1\u63d2\u69fd\u4e2d\u81f3\u5c11\u8fd0\u884c\u4e00\u4e2a\u7ebf\u7a0b</li> <li>\u4efb\u52a1\u63d2\u69fd\u5185\u5b58\u5927\u5c0f = \u4efb\u52a1\u7ba1\u7406\u5668\u7684 JVM \u5806\u5185\u5b58 / \u4efb\u52a1\u63d2\u69fd\u6570\u91cf</li> </ul>"},{"location":"engine/flink/flink_02/#24","title":"2.4 \u4efb\u52a1\u63d2\u69fd","text":"<ul> <li>\u4e0d\u540c\u7b97\u5b50\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u4efb\u52a1\u63d2\u69fd</li> <li>\u76f8\u540c\u7b97\u5b50\u7684\u4e0d\u540c\u5e76\u884c\u5b50\u4efb\u52a1\u4e0d\u80fd\u5171\u4eab\u540c\u4e00\u4e2a\u4efb\u52a1\u63d2\u69fd</li> <li>\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u662f N\uff08<code>.map().setParallelism(N)</code>\uff09\uff0c\u90a3\u4e48\u7b97\u5b50\u5c31\u6709 N \u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u5e76\u4e14\u5fc5\u987b\u5360\u7528 N \u4e2a\u4efb\u52a1\u63d2\u69fd\u3002</li> </ul> <p>\u7ed9\u5b9a\u4ee5\u4e0b\u7a0b\u5e8f\u4ee5\u53ca 6 \u4e2a\u4efb\u52a1\u63d2\u69fd\uff0c\u90a3\u4e48\u53ef\u80fd\u7684\u4efb\u52a1\u8c03\u5ea6\u60c5\u5f62\u5982\u4e0b\u56fe\uff1a</p> <pre><code>source.setParallelism(2)\n.map.setParallelism(2)\n.keyBy.window\n.reduce.setParallelism(2)\n.sink.setParallelism(1)\n</code></pre> <p></p> <p>\u7ed9\u5b9a\u4ee5\u4e0b\u7a0b\u5e8f\u4ee5\u53ca 6 \u4e2a\u4efb\u52a1\u63d2\u69fd\uff0c\u53ef\u80fd\u7684\u8c03\u5ea6\u60c5\u5f62\u5982\u4e0b\u56fe\uff1a</p> <pre><code>source.setParallelism(6)\n.map.setParallelism(6)\n.keyBy.window\n.reduce.setParallelism(6)\n.sink.setParallelism(1)\n</code></pre> <p></p> <p></p>"},{"location":"engine/flink/flink_02/#25","title":"2.5 \u5e76\u884c\u5ea6\u7684\u8bbe\u7f6e","text":"<p>\u5e76\u884c\u5ea6\u6307\u7684\u662f\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u3002</p> <p>\u7b97\u5b50\u5e76\u884c\u5ea6\u7684\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7\u96c6\u7fa4\u53ef\u7528\u4efb\u52a1\u63d2\u69fd\u7684\u6570\u91cf\u3002</p> <p>\u4ece\u4e0a\u5230\u4e0b\uff0c\u4f18\u5148\u7ea7\u5347\u9ad8\u3002</p> <ol> <li>\u4efb\u52a1\u7ba1\u7406\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\uff1a<code>flink-conf.yaml</code>\u4e2d\u7684\u914d\u7f6e\u9879<code>parallelism.default: 1</code></li> <li>\u5728\u547d\u4ee4\u884c\u6216\u8005 WebUI \u63d0\u4ea4\u4efb\u52a1\u65f6\u6307\u5b9a\u5e76\u884c\u5ea6\uff1a<code>./bin/flink run jar\u5305 -p 16</code></li> <li>\u5168\u5c40\u5e76\u884c\u5ea6\uff1a<code>env.setParallelism(1)</code></li> <li>\u9488\u5bf9\u7b97\u5b50\u8bbe\u7f6e\u5e76\u884c\u5ea6\uff1a<code>.print().setParallelism(1)</code></li> </ol>"},{"location":"engine/flink/flink_02/#26","title":"2.6 \u5e76\u884c\u5ea6\u8bbe\u7f6e\u7684\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u4e0d\u8981\u8bbe\u7f6e\u5168\u5c40\u5e76\u884c\u5ea6\uff0c\u56e0\u4e3a\u6ca1\u529e\u6cd5\u5728\u547d\u4ee4\u884c\u6216\u8005 WebUI \u63d0\u4ea4\u4efb\u52a1\u65f6\u505a\u52a8\u6001\u6269\u5bb9\u3002</li> <li>\u9488\u5bf9\u67d0\u4e9b\u7b97\u5b50\u8bbe\u7f6e\u5e76\u884c\u5ea6\uff0c\u4f8b\u5982\u6570\u636e\u6e90\uff0c\u4e3a\u4e86\u4e0d\u6539\u53d8\u6570\u636e\u7684\u987a\u5e8f\uff0c\u8bbe\u7f6e\u6570\u636e\u6e90\u7684\u5e76\u884c\u5ea6\u4e3a 1\u3002</li> <li>\u5728\u63d0\u4ea4\u4efb\u52a1\u65f6\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u52a8\u6001\u6269\u5bb9\u3002</li> </ol> <pre><code>env\n.source.setParallelism(1)\n.keyBy\n.reduce // \u4e0d\u9488\u5bf9reduce\u8bbe\u7f6e\u5e76\u884c\u5ea6\n.print.setParallelism(1)\n</code></pre> <p>\u7b2c\u4e00\u6b21\u63d0\u4ea4\u4efb\u52a1</p> <pre><code>$ flink run jar\u5305 -p 8\n</code></pre> <p>\u90a3\u4e48 <code>reduce</code> \u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u662f 8\uff0c<code>source</code> \u548c <code>print</code> \u7684\u5e76\u884c\u5ea6\u662f 1\u3002</p> <p>\u52a8\u6001\u6269\u5bb9</p> <pre><code>$ flink run jar\u5305 -p 16\n</code></pre> <p>\u90a3\u4e48 <code>reduce</code> \u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u662f 16\uff0c<code>source</code> \u548c <code>print</code> \u7684\u5e76\u884c\u5ea6\u662f 1\u3002</p>"},{"location":"engine/flink/flink_02/#27","title":"2.7 \u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b","text":"<p>\u72ec\u7acb\u96c6\u7fa4\u7684\u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b\u3002\u4ee5\u4e0b\u793a\u610f\u56fe 1 \u4e2a\u4f5c\u4e1a\u7ba1\u7406\u5668\u30023 \u4e2a\u4efb\u52a1\u7ba1\u7406\u5668\u3002\u5171\u5360\u7528 4 \u53f0\u673a\u5668\u3002</p> <p></p> <ul> <li>\u5728\u96c6\u7fa4\u542f\u52a8\u65f6\uff0c\u4efb\u52a1\u7ba1\u7406\u5668\u4f1a\u5411\u8d44\u6e90\u7ba1\u7406\u5668\u6ce8\u518c\u81ea\u5df1\u7684\u4efb\u52a1\u63d2\u69fd</li> <li>\u4efb\u52a1\u7ba1\u7406\u5668\u4e4b\u95f4\u5b58\u5728\u6570\u636e\u7684\u4ea4\u6362</li> </ul>"},{"location":"engine/flink/flink_02/#flinkdag","title":"Flink\u4e2d\u7684DAG\uff08\u6709\u5411\u65e0\u73af\u56fe\uff09\u6570\u636e\u7ed3\u6784","text":"<ul> <li>StreamGraph\uff1a\u662f\u6839\u636e\u7528\u6237\u901a\u8fc7 Stream API \u7f16\u5199\u7684\u4ee3\u7801\u751f\u6210\u7684\u6700\u521d\u7684\u6709\u5411\u65e0\u73af\u56fe\u3002\u7528\u6765\u8868\u793a\u7a0b\u5e8f\u7684\u62d3\u6251\u7ed3\u6784\u3002\u6e90\u7801\uff1a<code>StreamGraph.java</code></li> <li>JobGraph\uff1aStreamGraph \u5728\u7f16\u8bd1\u7684\u9636\u6bb5\u7ecf\u8fc7\u4f18\u5316\u540e\u751f\u6210\u4e86 JobGraph\uff08\u6e90\u7801\uff1a<code>JobGraph.java</code>\uff09\uff0cJobGraph \u5c31\u662f\u63d0\u4ea4\u7ed9\u4f5c\u4e1a\u7ba1\u7406\u5668\u7684\u6570\u636e\u7ed3\u6784\u3002\u4e3b\u8981\u7684\u4f18\u5316\u4e3a\uff0c\u5c06\u591a\u4e2a\u7b26\u5408\u6761\u4ef6\uff08\u6ca1\u6709 shuffle\uff0c\u5e76\u884c\u5ea6\u76f8\u540c\uff09\u7684\u7b97\u5b50\u4e32\u5728\u4e00\u8d77\u4f5c\u4e3a\u4e00\u4e2a\u7b97\u5b50\u94fe\u8282\u70b9\u3002\u4fdd\u8bc1\u540c\u4e00\u4e2a\u7b97\u5b50\u94fe\u8282\u70b9\u91cc\u9762\u7684\u6240\u6709\u7b97\u5b50\u90fd\u5728\u540c\u4e00\u4e2a\u4efb\u52a1\u63d2\u69fd\u7684\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002\u8fd9\u6837\u7b97\u5b50\u4e4b\u95f4\u7684\u6570\u636e\u5c31\u662f\u672c\u5730\u8f6c\u53d1\uff08\u65e0\u9700\u5e8f\u5217\u5316\u53cd\u5e8f\u5217\u5316\u548c\u7f51\u7edc IO\uff09\u3002\u4e24\u4e2a\u6761\u4ef6\uff1a</li> <li>\u4e24\u4e2a\u7b97\u5b50\u4e4b\u95f4\u6ca1\u6709 shuffle \u5b58\u5728</li> <li>\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u5fc5\u987b\u76f8\u540c</li> <li>ExecutionGraph\uff1a\u4f5c\u4e1a\u7ba1\u7406\u5668\u6839\u636e JobGraph \u751f\u6210 ExecutionGraph\uff08\u6e90\u7801\uff1a<code>ExecutionGraph.java</code>\uff09\u3002ExecutionGraph \u662f JobGraph \u7684\u5e76\u884c\u5316\u7248\u672c\uff0c\u662f\u8c03\u5ea6\u5c42\u6700\u6838\u5fc3\u7684\u6570\u636e\u7ed3\u6784\u3002</li> <li>\u7269\u7406\u6267\u884c\u56fe\uff1aJobMaster \u7ebf\u7a0b\u6839\u636e ExecutionGraph \u5bf9\u4f5c\u4e1a\u8fdb\u884c\u8c03\u5ea6\u540e\uff0c\u5728\u5404\u4e2a\u4efb\u52a1\u7ba1\u7406\u5668\u4e0a\u90e8\u7f72 Task \u540e\u5f62\u6210\u7684\u201c\u56fe\u201d\uff0c\u5e76\u4e0d\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u6570\u636e\u7ed3\u6784\u3002</li> </ul> <p>\u6211\u4eec\u770b\u4e00\u4e0b\u5982\u4e0b\u4f2a\u4ee3\u7801\u7684 DAG \u662f\u5982\u4f55\u8fdb\u884c\u8f6c\u6362\u7684\u3002</p> <pre><code>source.setParallelism(1)\n.flatMap().setParallelism(2)\n.keyBy()\n.reduce().setParallelism(2)\n.sink().setParallelism(2)\n</code></pre> <p>\u9996\u5148\u751f\u6210\u7684\u662f StreamGraph\u3002</p> <p></p> <p>StreamGraph \u5728\u5ba2\u6237\u7aef\u7f16\u8bd1\u65f6\u751f\u6210\u4e86 JobGraph\u3002</p> <ul> <li>source \u548c flatMap \u7531\u4e8e\u5e76\u884c\u5ea6\u4e0d\u540c\uff0c\u6240\u4ee5\u65e0\u6cd5\u5408\u5e76\u6210\u4e00\u4e2a\u7b97\u5b50\u94fe</li> <li>flatMap \u548c reduce \u867d\u7136\u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u4f46\u7531\u4e8e\u7b97\u5b50\u4e4b\u95f4\u5b58\u5728 shuffle \u6240\u4ee5\u4e5f\u65e0\u6cd5\u5408\u5e76\u6210\u4e00\u4e2a\u7b97\u5b50\u94fe</li> <li>reduce \u548c sink \u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u4e14\u4e0d\u5b58\u5728 shuffle\uff0c\u6240\u4ee5\u53ef\u4ee5\u5408\u6210\u4e00\u4e2a\u7b97\u5b50\u94fe</li> </ul> <p></p> <p>\u5c06 JobGraph \u63d0\u4ea4\u5230\u4f5c\u4e1a\u7ba1\u7406\u5668\uff0c\u4f1a\u751f\u6210 ExecutionGraph\uff0c\u4e5f\u5c31\u662f\u5c06\u7b97\u5b50\u6309\u7167\u5e76\u884c\u5ea6\u62c6\u5206\u6210\u591a\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u3002</p> <p>ExecutionGraph \u4e2d\u7684\u6bcf\u4e2a\u9876\u70b9\u90fd\u8981\u5360\u7528\u4e00\u4e2a\u7ebf\u7a0b\u3002\u6240\u4ee5\u4e0b\u56fe\u4e2d\u5171\u6709 5 \u4e2a\u9876\u70b9\uff0c\u9700\u8981 5 \u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u3002\u6bcf\u4e2a\u9876\u70b9\uff08\u7ebf\u7a0b\uff09\u5bf9\u5e94\u4e86\u6e90\u7801\u4e2d\u7684\u4e00\u4e2a <code>Task.java</code> \u7684\u5b9e\u4f8b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4f1a\u5360\u7528\u51e0\u4e2a\u4efb\u52a1\u63d2\u69fd\uff1f</p> <p>\u6700\u5c11\u9700\u8981\u5360\u7528 2 \u4e2a\u4efb\u52a1\u63d2\u69fd\u3002</p> <ul> <li>\u7b2c\u4e00\u4e2a\u4efb\u52a1\u63d2\u69fd\uff1a<code>source[1]</code>\uff0c<code>flatMap[1/2]</code>\uff0c<code>reduce-&gt;sink[1/2]</code></li> <li>\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u63d2\u69fd\uff1a<code>flatMap[2/2]</code>\uff0c<code>reduce-&gt;sink[2/2]</code></li> </ul> <p>\u6700\u591a\u5360\u7528 5 \u4e2a\u4efb\u52a1\u63d2\u69fd\u3002\u4e5f\u5c31\u662f 5 \u4e2a\u9876\u70b9\u7684\u7ebf\u7a0b\u5206\u522b\u5360\u7528\u4e00\u4e2a\u4efb\u52a1\u63d2\u69fd\u3002</p> <p>JobMaster \u5c06 ExecutionGraph \u90e8\u7f72\u5230\u4efb\u52a1\u7ba1\u7406\u5668\u6267\u884c\u3002</p>"},{"location":"engine/flink/flink_03/","title":"\u7b2c3\u7ae0 DataStream API","text":""},{"location":"engine/flink/flink_03/#31","title":"3.1 \u81ea\u5b9a\u4e49\u6570\u636e\u6e90","text":""},{"location":"engine/flink/flink_03/#311-pojo-class","title":"3.1.1 POJO CLASS","text":"<ul> <li>\u5fc5\u987b\u662f\u516c\u6709\u7c7b</li> <li>\u6240\u6709\u5b57\u6bb5\u5fc5\u987b\u662f\u516c\u6709\u5b57\u6bb5</li> <li>\u5fc5\u987b\u6709\u7a7a\u6784\u9020\u5668</li> </ul>"},{"location":"engine/flink/flink_03/#312-sourcefunction","title":"3.1.2 SourceFunction","text":"<p>SourceFunction\\ \u7684\u6cdb\u578b\u662f\u6570\u636e\u6e90\u4e2d\u7684\u6570\u636e\u7684\u7c7b\u578b\u3002 <p>\u5355\u5e76\u884c\u5ea6\u7684\u6570\u636e\u6e90\u3002\u5e76\u884c\u5ea6\u53ea\u80fd\u8bbe\u7f6e\u4e3a 1\u3002</p> <ul> <li>run \u65b9\u6cd5\u7528\u6765\u53d1\u9001\u6570\u636e\uff0c\u7531\u201c\u7a0b\u5e8f\u542f\u52a8\u201d\u4e8b\u4ef6\u89e6\u53d1\u6267\u884c\u3002</li> <li><code>ctx.collect</code> \u5411\u4e0b\u6e38\u53d1\u9001\u6570\u636e\u3002</li> <li>ctx.collectWithTimestamp \u5411\u4e0b\u6e38\u53d1\u9001\u6570\u636e\uff0c\u5e76\u6307\u5b9a\u6570\u636e\u7684\u4e8b\u4ef6\u65f6\u95f4\u3002</li> <li> <p>ctx.emitWatermark \u5411\u4e0b\u6e38\u53d1\u9001\u6c34\u4f4d\u7ebf\u4e8b\u4ef6\u3002</p> </li> <li> <p>cancel\u65b9\u6cd5\u5728\u53d6\u6d88\u4efb\u52a1\u65f6\u6267\u884c\uff0c\u7531\u201c\u53d6\u6d88\u4efb\u52a1\u201d\u4e8b\u4ef6\u89e6\u53d1\u6267\u884c\u3002</p> </li> <li>\u5728 WebUI \u4e0a\u70b9\u51fb\u53d6\u6d88\u4efb\u52a1\u6309\u94ae</li> <li>\u5728\u547d\u4ee4\u884c <code>flink cancel JobID</code></li> </ul> <p>\u7f16\u5199 Flink \u7a0b\u5e8f\u65f6\uff0c\u8981\u6ce8\u610f\u6cdb\u578b\u548c\u65b9\u6cd5\u7684\u53c2\u6570\u7c7b\u578b\uff01</p> <p>\u5176\u4ed6\u81ea\u5b9a\u4e49\u6570\u636e\u6e90 API</p> <ul> <li>ParallelSourceFunction\\\uff1a\u5e76\u884c\u6570\u636e\u6e90 <li>RichSourceFunction\\\uff1a\u5bcc\u51fd\u6570\u7248\u672c <li>RichParallelSourceFunction\\\uff1a\u5e76\u884c\u6570\u636e\u6e90\u7684\u5bcc\u51fd\u6570\u7248\u672c"},{"location":"engine/flink/flink_03/#32","title":"3.2 \u57fa\u672c\u8f6c\u6362\u7b97\u5b50","text":"<p>map, flatMap, filter</p> <p>\u4ee3\u8868\u7b97\u5b50\uff1aflatMap</p> <p>\u57fa\u672c\u8f6c\u6362\u7b97\u5b50\u90fd\u662f\u65e0\u72b6\u6001\u7b97\u5b50\uff08\u5728\u8f93\u5165\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u8f93\u51fa\u4e00\u5b9a\u76f8\u540c\uff09\u3002</p> <p>\u4e3e\u4e2a\u65e0\u72b6\u6001\u51fd\u6570\u7684\u4f8b\u5b50</p> <p>\u6570\u5b66\u51fd\u6570\uff1ay = f(x)</p> <pre><code>int add(int n) {\nreturn n + 1;\n}\n\nadd(1); // =&gt; 2\nadd(1); // =&gt; 2\n</code></pre> <ul> <li>MapFunction \u7684\u8bed\u4e49\uff1a\u9488\u5bf9\u6d41\u6216\u8005\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\uff0c\u8f93\u51fa\u4e00\u4e2a\u5143\u7d20\u3002 <li>FlatMapFunction \u7684\u8bed\u4e49\uff1a\u9488\u5bf9\u6d41\u6216\u8005\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u8f93\u51fa0\u4e2a\u30011\u4e2a\u6216\u8005\u591a\u4e2a\u5143\u7d20\u3002 <li>FilterFunction\\ \u7684\u8bed\u4e49\uff1a\u9488\u5bf9\u6d41\u6216\u8005\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u8f93\u51fa0\u4e2a\u6216\u80051\u4e2a\u5143\u7d20\u3002 <p>flatMap \u662f map \u548c filter \u7684\u6cdb\u5316\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u4f7f\u7528 flatMap \u6765\u5b9e\u73b0 map \u548c filter \u7684\u529f\u80fd\u3002</p>"},{"location":"engine/flink/flink_03/#33","title":"3.3 \u903b\u8f91\u5206\u533a\u7b97\u5b50","text":"<p>\u4ee3\u8868\u7b97\u5b50\uff1areduce</p> <ul> <li>keyBy \u7684\u4f5c\u7528\uff1a</li> <li>\u6307\u5b9a\u6570\u636e\u7684 key\u3002</li> <li>\u6839\u636e key \u8ba1\u7b97\u51fa\u6570\u636e\u8981\u53bb\u4e0b\u6e38\u7b97\u5b50 reduce \u7684\u54ea\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u3002</li> <li>\u5c06\u6570\u636e\u53d1\u9001\u5230\u4e0b\u6e38\u7b97\u5b50 reduce \u7684\u5bf9\u5e94\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002</li> <li>\u7ec8\u6781\u76ee\u6807\uff1a\u76f8\u540c key \u7684\u6570\u636e\u4e00\u5b9a\u4f1a\u53d1\u9001\u5230\u4e0b\u6e38\u7b97\u5b50 reduce \u7684\u540c\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002</li> <li>\u4e0d\u540c key \u7684\u6570\u636e\u4e5f\u53ef\u80fd\u53d1\u9001\u5230\u4e0b\u6e38\u7b97\u5b50 reduce \u7684\u540c\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002</li> </ul> <p>keyBy \u4e0d\u662f\u4e00\u4e2a\u7b97\u5b50\uff0c\u56e0\u4e3a\u4e0d\u5177\u5907\u8ba1\u7b97\u529f\u80fd\u3002keyBy \u7684\u4f5c\u7528\u53ea\u662f\u4e3a\u6570\u636e\u6307\u5b9a key\uff0c\u5e76\u5c06\u6570\u636e\u8def\u7531\u5230\u5bf9\u5e94\u7684 reduce \u7684\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002</p> <p>reduce \u662f\u6709\u72b6\u6001\u7b97\u5b50\uff08\u8f93\u5165\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u8f93\u51fa\u4e0d\u4e00\u5b9a\u76f8\u540c\uff09\u3002</p> <p>\u4e3e\u4e2a\u6709\u72b6\u6001\u51fd\u6570\u7684\u4f8b\u5b50\u3002\u4e0b\u9762\u7684\u51fd\u6570\u5c06\u5168\u5c40\u53d8\u91cf <code>count</code> \u4f5c\u4e3a\u5185\u90e8\u72b6\u6001\u7ef4\u62a4\u3002</p> <pre><code>int count = 0;    // \u521d\u59cb\u5316\u5168\u5c40\u53d8\u91cfcount\nint add(int n) {\ncount += n;\nreturn count;\n}\n\nadd(1); // =&gt; 1\nadd(1); // =&gt; 2\nadd(1); // =&gt; 3\n</code></pre> <ul> <li>ReduceFunction\\ \u7684\u8bed\u4e49\uff1a\u7b2c\u4e00\u6761\u5143\u7d20\u5230\u6765\uff0c\u4e0d\u8c03\u7528 <code>reduce</code> \u65b9\u6cd5\uff0c\u800c\u662f\u76f4\u63a5\u4f5c\u4e3a\u7d2f\u52a0\u5668\u4fdd\u5b58\uff0c\u5e76\u5c06\u7d2f\u52a0\u5668\u8f93\u51fa\u3002\u7b2c\u4e8c\u6761\u4ee5\u53ca\u4e4b\u540e\u7684\u5143\u7d20\u5230\u6765\uff0c\u8c03\u7528 <code>reduce</code> \u65b9\u6cd5\uff0c\u548c\u7d2f\u52a0\u5668\u8fdb\u884c\u7d2f\u52a0\u64cd\u4f5c\u5e76\u66f4\u65b0\u7d2f\u52a0\u5668\uff0c\u7136\u540e\u5c06\u7d2f\u52a0\u5668\u8f93\u51fa\u3002reduce \u65b9\u6cd5\u5b9a\u4e49\u7684\u662f\u8f93\u5165\u5143\u7d20\u548c\u7d2f\u52a0\u5668\u7684\u7d2f\u52a0\u89c4\u5219\u3002 <pre><code>\u8f93\u5165\u6570\u636e\u7684 key \u5bf9\u5e94\u7684\u65b0\u7d2f\u52a0\u5668 reduce(\u8f93\u5165\u6570\u636e\u7684 key \u5bf9\u5e94\u7684\u65e7\u7d2f\u52a0\u5668\uff0c\u8f93\u5165\u6570\u636e)\n</code></pre> <ul> <li>\u6bcf\u4e2a key \u90fd\u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u7d2f\u52a0\u5668\uff0c\u8f93\u5165\u6570\u636e\u66f4\u65b0\u5b8c\u7d2f\u52a0\u5668\u4e4b\u540e\uff0c\u76f4\u63a5\u88ab\u4e22\u5f03\u3002</li> <li>reduce \u53ea\u80fd\u5728 keyBy \u4e4b\u540e\u4f7f\u7528\u3002</li> </ul>"},{"location":"engine/flink/flink_03/#331-reduce-key","title":"3.3.1 reduce \u7b97\u5b50\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u5982\u4f55\u9488\u5bf9\u6bcf\u4e2a key \u7ef4\u62a4\u5404\u81ea\u7684\u7d2f\u52a0\u5668\u5462\uff1f","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b Flink \u4ee3\u7801\uff1a</p> <pre><code>env\n.fromElements(1,2,3,4,5,6,7,8)\n.setParallelism(1)\n.keyBy(r -&gt; r % 3)\n.reduce(new ReduceFunction&lt;Integer&gt;() {\n@Override\npublic Integer reduce(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n})\n.setParallelism(4)\n.print()\n.setParallelism(4);\n</code></pre> <p>\u90a3\u4e48 keyBy \u5bf9\u6570\u636e\u7684\u8def\u7531\u65b9\u5f0f\u662f\uff1a</p> <ul> <li>1,4,7 \u8def\u7531\u5230 reduce \u7684\u7b2c 3\uff08\u7d22\u5f15\u4e3a 2\uff09\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1</li> <li>3,6 \u8def\u7531\u5230 reduce \u7684\u7b2c 3\uff08\u7d22\u5f15\u4e3a 2\uff09\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1</li> <li>2,5,8 \u8def\u7531\u5230 reduce \u7684\u7b2c 4\uff08\u7d22\u5f15\u4e3a 3\uff09\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1</li> </ul> <p></p>"},{"location":"engine/flink/flink_03/#34","title":"3.4 \u6570\u636e\u91cd\u5206\u5e03","text":"<p>\u5c06\u6570\u636e\u53d1\u9001\u5230\u4e0b\u6e38\u7b97\u5b50\u7684\u4e0d\u540c\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u3002</p> <ul> <li><code>shuffle()</code>\uff1a\u968f\u673a\u5411\u4e0b\u6e38\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u53d1\u9001\u6570\u636e\u3002\u8fd9\u91cc\u7684 shuffle \u548c\u4e4b\u524d keyBy \u7684 shuffle \u4e0d\u662f\u4e00\u56de\u4e8b\u513f\uff01</li> <li><code>rebalance()</code>\uff1a\u5c06\u6570\u636e\u8f6e\u8be2\u53d1\u9001\u5230\u4e0b\u6e38\u7684\u6240\u6709\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002round-robin\u3002</li> <li><code>rescale()</code>\uff1a\u5c06\u6570\u636e\u8f6e\u8be2\u53d1\u9001\u5230\u4e0b\u6e38\u7684\u90e8\u5206\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002\u7528\u5728\u4e0b\u6e38\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u662f\u4e0a\u6e38\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u7684\u6574\u6570\u500d\u7684\u60c5\u51b5\u3002round-robin\u3002</li> <li><code>broadcast()</code>\uff1a\u5c06\u6570\u636e\u5e7f\u64ad\u5230\u4e0b\u6e38\u7684\u6240\u6709\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002</li> <li><code>global()</code>\uff1a\u5c06\u6240\u6709\u6570\u636e\u53d1\u9001\u5230\u4e0b\u6e38\u7684\u7b2c\u4e00\u4e2a\uff08\u7d22\u5f15\u4e3a 0\uff09\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u3002</li> <li><code>custom()</code>\uff1a\u81ea\u5b9a\u4e49\u5206\u533a\u3002\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5c06\u67d0\u4e2a <code>key</code> \u7684\u6570\u636e\u53d1\u9001\u5230\u4e0b\u6e38\u7684\u54ea\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u53bb\u3002</li> </ul>"},{"location":"engine/flink/flink_03/#35","title":"3.5 \u5bcc\u51fd\u6570","text":"<p>\u7b97\u5b50\u7684\u6bcf\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u90fd\u6709\u81ea\u5df1\u7684\u751f\u547d\u5468\u671f\u3002</p> <ul> <li><code>open</code> \u65b9\u6cd5\uff1a\u5728\u7b97\u5b50\u7684\u8ba1\u7b97\u903b\u8f91\u6267\u884c\u524d\u6267\u884c\u4e00\u6b21\uff0c\u9002\u5408\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u7684\u5de5\u4f5c\uff08\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\uff0c\u6253\u5f00\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5\uff0c\u6253\u5f00\u4e00\u4e2a\u6570\u636e\u5e93\u7684\u8fde\u63a5\uff09\u3002\u751f\u547d\u5468\u671f\u7684\u5f00\u59cb\u3002</li> <li><code>close</code> \u65b9\u6cd5\uff1a\u5728\u7b97\u5b50\u7684\u8ba1\u7b97\u903b\u8f91\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u6267\u884c\u4e00\u6b21\uff0c\u9002\u5408\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\u3002\uff08\u5173\u95ed\u4e00\u4e2a\u6587\u4ef6\uff0c\u5173\u95ed\u7f51\u7edc\u8fde\u63a5\uff0c\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\uff09\u3002\u751f\u547d\u5468\u671f\u7684\u7ed3\u675f\u3002</li> <li><code>getRuntimeContext()</code> \u65b9\u6cd5\uff1a\u7528\u6765\u83b7\u53d6\u7b97\u5b50\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u4e00\u4e9b\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002\u6bd4\u5982\u5f53\u524d\u7b97\u5b50\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u7d22\u5f15\u7b49\u7b49\u3002</li> </ul> <p>\u4e3e\u4e00\u4e9b\u4f8b\u5b50</p> <ul> <li>MapFunction  RichMapFunction</li> <li>FilterFunction  RichFilterFunction</li> <li>FlatMapFunction  RichFlatMapFunction</li> <li>ReduceFunction  RichReduceFunction</li> <li>SourceFunction  RichSourceFunction</li> <li>SinkFunction  RichSinkFunction</li> </ul>"},{"location":"engine/flink/flink_03/#36","title":"3.6 \u81ea\u5b9a\u4e49\u8f93\u51fa","text":"<p>SinkFunction\\\uff1a\u6cdb\u578b\u662f\u8981\u8f93\u51fa\u7684\u6570\u636e\u7684\u6cdb\u578b <p>RichSinkFunction\\"},{"location":"engine/flink/flink_04/","title":"\u7b2c\u56db\u7ae0 \u5e95\u5c42API","text":"<p>\u5e95\u5c42API\uff08\u5904\u7406\u51fd\u6570\uff09\u90fd\u662f\u5bcc\u51fd\u6570\u3002</p>"},{"location":"engine/flink/flink_04/#41-processfunction","title":"4.1 ProcessFunction","text":"<p>\u7528\u6765\u505a\u57fa\u672c\u8f6c\u6362\u3002\u9488\u5bf9\u6ca1\u6709 <code>.keyBy</code> \u7684\u6570\u636e\u6d41\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>ProcessFunction</code> \u63a5\u53e3\uff0c\u9488\u5bf9\u6d41\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8f93\u51fa 0 \u4e2a\u30011 \u4e2a\u6216\u8005\u591a\u4e2a\u5143\u7d20\u3002\uff08\u52a0\u5f3a\u7248 <code>RichFlatMapFunction</code> \uff09</p> <ul> <li><code>ProcessFunction&lt;IN, OUT&gt;</code>\uff1aIN \u662f\u8f93\u5165\u7684\u6cdb\u578b\uff0cOUT \u662f\u8f93\u51fa\u7684\u6cdb\u578b</li> <li><code>processElement</code>\uff1a\u6bcf\u6765\u4e00\u6761\u6570\u636e\uff0c\u89e6\u53d1\u4e00\u6b21\u8c03\u7528\u3002</li> <li>\u4f7f\u7528 <code>.process(new ProcessFunction&lt;IN, OUT&gt;)</code> \u6765\u8c03\u7528\u3002</li> </ul>"},{"location":"engine/flink/flink_04/#42-keyedprocessfunction","title":"4.2 KeyedProcessFunction","text":"<p>\u9488\u5bf9 keyBy \u4e4b\u540e\u7684\u952e\u63a7\u6d41\uff08 KeyedStream \uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 KeyedProcessFunction</p> <ul> <li><code>KeyedProcessFunction&lt;KEY, IN, OUT&gt;</code>\uff1aKEY \u662f key \u7684\u6cdb\u578b\uff0cIN \u662f\u8f93\u5165\u7684\u6cdb\u578b\uff0cOUT \u662f\u8f93\u51fa\u7684\u6cdb\u578b\u3002</li> <li><code>processElement</code>\uff1a\u6765\u4e00\u6761\u6570\u636e\uff0c\u89e6\u53d1\u8c03\u7528\u4e00\u6b21\u3002</li> <li><code>onTimer</code>\uff1a\u5b9a\u65f6\u5668\u3002\u65f6\u95f4\u5230\u8fbe\u67d0\u4e00\u4e2a\u65f6\u95f4\u6233\u89e6\u53d1\u8c03\u7528\u3002</li> </ul> <p></p> <p>\u5b9a\u65f6\u5668\u961f\u5217\u662f\u5b9a\u65f6\u5668\u65f6\u95f4\u6233\u7ec4\u6210\u7684\u6570\u7ec4\u3002</p> <p>\u6570\u7ec4\u7ecf\u8fc7\u4e86\u5806\u6392\u5e8f\uff08\u4f18\u5148\u961f\u5217\uff09\u3002</p> <ul> <li>\u6bcf\u4e2a key \u90fd\u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u5b9a\u65f6\u5668\uff0c\u6bcf\u4e2a key \u90fd\u53ea\u80fd\u8bbf\u95ee\u81ea\u5df1\u7684\u5b9a\u65f6\u5668\u3002\u5c31\u597d\u50cf\u6bcf\u4e2a key \u90fd\u53ea\u80fd\u8bbf\u95ee\u81ea\u5df1\u7684\u7d2f\u52a0\u5668\u4e00\u6837\u3002</li> <li>\u9488\u5bf9\u6bcf\u4e2a key\uff0c\u5728\u67d0\u4e2a\u65f6\u95f4\u6233\u53ea\u80fd\u6ce8\u518c\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5b9a\u65f6\u5668\u4e0d\u80fd\u91cd\u590d\u6ce8\u518c\uff0c\u5982\u679c\u67d0\u4e2a\u65f6\u95f4\u6233\u5df2\u7ecf\u6ce8\u518c\u4e86\u5b9a\u65f6\u5668\uff0c\u90a3\u4e48\u518d\u5bf9\u8fd9\u4e2a\u65f6\u95f4\u6233\u6ce8\u518c\u5b9a\u65f6\u5668\u5c31\u4e0d\u8d77\u4f5c\u7528\u4e86\u3002\u5e42\u7b49\u6027\u3002</li> <li><code>.registerProcessingTimeTimer(ts)</code>\uff1a\u5728\u673a\u5668\u65f6\u95f4\u6233 ts \u6ce8\u518c\u4e86\u4e00\u4e2a\u5b9a\u65f6\u5668\uff08 onTimer \uff09\u3002</li> <li>\u7ef4\u62a4\u7684\u5185\u90e8\u72b6\u6001</li> <li>\u72b6\u6001\u53d8\u91cf</li> <li>\u5b9a\u65f6\u5668</li> <li>\u5185\u90e8\u72b6\u6001\u4f1a\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u4f5c\u4e3a\u68c0\u67e5\u70b9\u4fdd\u5b58\u5230\u72b6\u6001\u540e\u7aef\uff08\u4f8b\u5982 HDFS \uff09\u3002</li> <li>processElement \u65b9\u6cd5\u548c onTimer \u65b9\u6cd5\uff1a\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u662f\u539f\u5b50\u6027\u7684\uff0c\u65e0\u6cd5\u5e76\u53d1\u6267\u884c\u3002\u67d0\u4e2a\u65f6\u523b\u53ea\u80fd\u6267\u884c\u4e00\u4e2a\u65b9\u6cd5\u3002\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u90fd\u6709\u53ef\u80fd\u64cd\u4f5c\u76f8\u540c\u7684\u72b6\u6001\u53d8\u91cf\u3002\u4f8b\u5982\uff1a\u5230\u8fbe\u4e86\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u6b64\u65f6 onTimer \u6b63\u5728\u6267\u884c\uff0c\u5219\u5fc5\u987b\u7b49\u5f85 onTimer \u6267\u884c\u5b8c\u4ee5\u540e\uff0c\u518d\u8c03\u7528 processElement\u3002\u518d\u6bd4\u5982\uff1a\u5230\u8fbe\u4e86\u4e00\u4e2a\u6c34\u4f4d\u7ebf\uff0c\u60f3\u89e6\u53d1 onTimer\uff0c\u4f46\u6b64\u65f6 processElement \u6b63\u5728\u6267\u884c\uff0c\u90a3\u4e48\u5fc5\u987b\u7b49\u5f85 processElement \u6267\u884c\u5b8c\u4ee5\u540e\u518d\u6267\u884c onTimer\u3002</li> <li>\u5f53\u6c34\u4f4d\u7ebf\u5230\u8fbe KeyedProcessFunction\uff0c\u5982\u679c\u8fd9\u6761\u6c34\u4f4d\u7ebf\u89e6\u53d1\u4e86 onTimer \u7684\u6267\u884c\uff0c\u5219\u5fc5\u987b\u7b49\u5f85 onTimer \u6267\u884c\u5b8c\u4ee5\u540e\uff0c\u6c34\u4f4d\u7ebf\u624d\u80fd\u5411\u4e0b\u6e38\u53d1\u9001\u3002</li> <li>\u5f53\u6c34\u4f4d\u7ebf\u5230\u8fbe ProcessWindowFunction\uff0c\u5982\u679c\u8fd9\u6761\u6c34\u4f4d\u7ebf\u89e6\u53d1\u4e86 process \u65b9\u6cd5\u7684\u6267\u884c\uff0c\u5219\u5fc5\u987b\u7b49\u5f85 process \u65b9\u6cd5\u6267\u884c\u5b8c\u4ee5\u540e\uff0c\u6c34\u4f4d\u7ebf\u624d\u80fd\u5411\u4e0b\u6e38\u53d1\u9001\u3002</li> </ul> <p>\u5728 KeyedProcessFunction \u4e2d\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u7ef4\u62a4\u4e86\u591a\u5f20 HashMap\uff0c\u6bcf\u4e2a\u72b6\u6001\u53d8\u91cf\u7684\u5b9a\u4e49\u90fd\u4f1a\u521d\u59cb\u5316\u4e00\u5f20 HashMap\uff0c\u540c\u65f6\u8fd8\u6709\u4e00\u5f20\u7ef4\u62a4\u6bcf\u4e2a key \u7684\u5b9a\u65f6\u5668\u961f\u5217\u7684 HashMap\u3002</p>"},{"location":"engine/flink/flink_04/#43-","title":"4.3 \u903b\u8f91\u5206\u533a\u7ef4\u62a4\u7684\u72b6\u6001-\u952e\u63a7\u72b6\u6001\u53d8\u91cf","text":"<p>\u6bcf\u4e2a key \u90fd\u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u72b6\u6001\u53d8\u91cf\u3002</p> <ul> <li>ValueState\uff1a\u503c\u72b6\u6001\u53d8\u91cf\u3002\u7c7b\u4f3c Java \u7684\u666e\u901a\u53d8\u91cf\u4e00\u6837\u4f7f\u7528\u3002</li> <li>ListState\uff1a\u5217\u8868\u72b6\u6001\u53d8\u91cf\u3002\u7c7b\u4f3c Java \u7684 ArrayList \u4e00\u6837\u4f7f\u7528\u3002</li> <li>MapState\uff1a\u5b57\u5178\u72b6\u6001\u53d8\u91cf\u3002\u7c7b\u4f3c Java \u7684 HashMap \u4e00\u6837\u4f7f\u7528\u3002</li> </ul>"},{"location":"engine/flink/flink_04/#431-valuestate-","title":"4.3.1 ValueState-\u503c\u72b6\u6001\u53d8\u91cf","text":"<ul> <li>\u6bcf\u4e2a key \u90fd\u53ea\u80fd\u8bbf\u95ee\u81ea\u5df1\u7684\u72b6\u6001\u53d8\u91cf\uff0c\u72b6\u6001\u53d8\u91cf\u662f\u6bcf\u4e2a key \u72ec\u6709\u7684\u3002</li> <li>\u5728 <code>processElement(IN, CTX, OUT)</code> \u65b9\u6cd5\u4e2d\u64cd\u4f5c\u7684\u72b6\u6001\u53d8\u91cf\uff0c\u662f\u8f93\u5165\u6570\u636e <code>IN</code> \u7684 key \u6240\u5bf9\u5e94\u7684\u72b6\u6001\u53d8\u91cf\u3002</li> <li>\u72b6\u6001\u53d8\u91cf\u662f\u5355\u4f8b\uff0c\u53ea\u4f1a\u88ab\u521d\u59cb\u5316\u4e00\u6b21\u3002</li> <li>\u5f53 Flink \u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u4f1a\u5148\u53bb\u72b6\u6001\u540e\u7aef\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\u4e2d\u5bfb\u627e\u72b6\u6001\u53d8\u91cf\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5219\u521d\u59cb\u5316\u3002\u5982\u679c\u627e\u5230\u4e86\uff0c\u5219\u76f4\u63a5\u8bfb\u53d6\u3002\u7b26\u5408\u5355\u4f8b\u7279\u6027\u3002   !!! question \"\u4e3a\u4ec0\u4e48 Flink \u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5148\u53bb\u72b6\u6001\u540e\u7aef\u5bfb\u627e\u72b6\u6001\u53d8\u91cf\u5462\uff1f\"     \u56e0\u4e3a Flink \u4e0d\u77e5\u9053\u7a0b\u5e8f\u662f\u7b2c\u4e00\u6b21\u542f\u52a8\uff0c\u8fd8\u662f\u6545\u969c\u6062\u590d\u540e\u7684\u542f\u52a8\u3002\u5982\u679c\u662f\u6545\u969c\u6062\u590d\uff0c\u5219\u8981\u53bb\u4fdd\u5b58\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\u91cc\u5bfb\u627e\u72b6\u6001\u53d8\u91cf\uff0c\u6062\u590d\u5230\u6700\u8fd1\u4e00\u6b21\u68c0\u67e5\u70b9\u7684\u72b6\u6001\u3002\u4e3a\u4e86\u4fdd\u8bc1\u8ba1\u7b97\u7ed3\u679c\u7684\u6b63\u786e\u6027\uff0c\u72b6\u6001\u53d8\u91cf\u5fc5\u987b\u88ab\u5b9e\u73b0\u4e3a\u5355\u4f8b\u6a21\u5f0f\u3002</li> <li><code>getRuntimeContext().getState(\u72b6\u6001\u63cf\u8ff0\u7b26)</code> \u65b9\u6cd5\u901a\u8fc7\u72b6\u6001\u63cf\u8ff0\u7b26\u53bb\u72b6\u6001\u540e\u7aef\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\u4e2d\u5bfb\u627e\u72b6\u6001\u53d8\u91cf\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5219\u521d\u59cb\u5316\u4e00\u4e2a\u72b6\u6001\u53d8\u91cf\u3002</li> <li>\u8bfb\u53d6\u503c\u72b6\u6001\u53d8\u91cf\u4e2d\u7684\u503c\uff1a<code>.value()</code> \u65b9\u6cd5</li> <li>\u5c06\u503c\u5199\u5165\u72b6\u6001\u53d8\u91cf\uff1a<code>.update()</code> \u65b9\u6cd5</li> <li>\u5982\u4f55\u6e05\u7a7a\u72b6\u6001\u53d8\u91cf\uff1a<code>.clear()</code> \u65b9\u6cd5</li> </ul>"},{"location":"engine/flink/flink_04/#432-liststate-","title":"4.3.2 ListState-\u5217\u8868\u72b6\u6001\u53d8\u91cf","text":"<p>\u4e0d\u8981\u5728 ValueState \u4e2d\u4fdd\u5b58 ArrayList\uff0c\u5e94\u8be5\u4f7f\u7528 ListState</p> <ul> <li><code>.get()</code> \u65b9\u6cd5\uff1a\u8fd4\u56de\u5305\u542b\u5217\u8868\u72b6\u6001\u53d8\u91cf\u4e2d\u6240\u6709\u5143\u7d20\u7684\u8fed\u4ee3\u5668</li> <li><code>.clear()</code> \u65b9\u6cd5\uff1a\u6e05\u7a7a\u72b6\u6001\u53d8\u91cf</li> <li><code>.add()</code> \u65b9\u6cd5\uff1a\u6dfb\u52a0\u5143\u7d20</li> <li><code>getRuntimeContext().getListState(\u5217\u8868\u72b6\u6001\u63cf\u8ff0\u7b26)</code></li> </ul> <p></p>"},{"location":"engine/flink/flink_04/#433-mapstate-","title":"4.3.3 MapState-\u5b57\u5178\u72b6\u6001\u53d8\u91cf","text":"<p>\u4e0d\u8981\u5728 ValueState \u4e2d\u4fdd\u5b58 HashMap\uff0c\u5e94\u8be5\u4f7f\u7528 MapState</p> <ul> <li><code>.put(KEY, VALUE)</code> \u65b9\u6cd5\uff1a\u6dfb\u52a0 KEY\u3001VALUE \u952e\u503c\u5bf9</li> <li><code>.get(KEY)</code> \u65b9\u6cd5\uff1a\u83b7\u53d6 KEY \u7684 VALUE</li> <li><code>.contains(KEY)</code> \u65b9\u6cd5\uff1a\u68c0\u6d4b KEY \u662f\u5426\u5b58\u5728</li> <li><code>.keys()</code>\uff1a\u8fd4\u56de\u6240\u6709 KEY \u7ec4\u6210\u7684\u96c6\u5408</li> </ul> <p></p>"},{"location":"engine/flink/flink_04/#44-api","title":"4.4 \u7a97\u53e3API","text":""},{"location":"engine/flink/flink_04/#441-processwindowfunction","title":"4.4.1 ProcessWindowFunction","text":"<p>\u4f7f\u7528\u5728 <code>stream.keyBy().window()</code> \u4e4b\u540e\u7684\u6d41</p> <ul> <li> <p><code>ProcessWindowFunction&lt;IN, OUT, KEY, WINDOW&gt;</code></p> </li> <li> <p><code>process</code> \u65b9\u6cd5\uff1a\u7a97\u53e3\u95ed\u5408\u7684\u65f6\u5019\u89e6\u53d1\u8c03\u7528</p> </li> <li> <p>Flink \u4e2d\u7684\u7a97\u53e3\u662f\u5de6\u95ed\u53f3\u5f00\uff1a[0,10)\uff0c\u5f53\u65f6\u95f4\u5230\u8fbe 9999ms \u7684\u65f6\u5019\uff0c\u89e6\u53d1 process \u51fd\u6570\u7684\u8c03\u7528\u3002</p> </li> <li> <p>\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7684\u8ba1\u7b97\u516c\u5f0f\uff0c\u5f00\u4e86\u4e00\u4e2a 5 \u79d2\u949f\u7684\u6eda\u52a8\u7a97\u53e3\uff0c7 \u79d2\u949f\u5230\u8fbe\u7684\u4e8b\u4ef6\u5c5e\u4e8e\u54ea\u4e2a\u7a97\u53e3\uff1f</p> </li> <li> <p>\u6eda\u52a8\u7a97\u53e3\u5f00\u59cb\u65f6\u95f4 = \u65f6\u95f4\u6233 - \u65f6\u95f4\u6233 % \u7a97\u53e3\u5927\u5c0f</p> </li> <li> <p>windowStartTime = 1234ms - 1234 % 5000 = 0ms</p> </li> <li> <p>windowStartTime = 7000ms - 7000 % 5000 = 5000ms</p> </li> <li> <p>\u6ed1\u52a8\u7a97\u53e3\uff08\u7a97\u53e3\u957f\u5ea6 10s\uff0c\u6ed1\u52a8\u8ddd\u79bb 5s\uff09</p> </li> <li> <p>\u9996\u5148\u8ba1\u7b97\u7b2c\u4e00\u4e2a\u6ed1\u52a8\u7a97\u53e3\u7684\u5f00\u59cb\u65f6\u95f4\uff08 5s \uff09\uff1a</p> <ul> <li> <p>\u7a97\u53e3\u5f00\u59cb\u65f6\u95f4 = \u65f6\u95f4\u6233 - \u65f6\u95f4\u6233 % \u6ed1\u52a8\u8ddd\u79bb</p> </li> <li> <p>7s - 7s % 5s -&gt; 5s</p> </li> </ul> </li> <li> <p>\u7136\u540e\u8ba1\u7b97\u5176\u5b83\u6ed1\u52a8\u7a97\u53e3\u7684\u5f00\u59cb\u65f6\u95f4</p> <ul> <li> <p><code>for (start = 5s;        start &gt; 7s - windowSize(10s);        start -= windowSlide(5s)) {     ArrayList.add(start);   }</code></p> </li> <li> <p>ArrayList[0s, 5s] \u4e2d\u5305\u542b\u7684\u5c31\u662f\u4e8b\u4ef6\u6240\u5c5e\u7684\u6240\u6709\u6ed1\u52a8\u7a97\u53e3\u7684\u5f00\u59cb\u65f6\u95f4</p> </li> </ul> </li> <li> <p>\u5c5e\u4e8e\u67d0\u4e2a\u7a97\u53e3\u7684\u7b2c\u4e00\u6761\u6570\u636e\u5230\u8fbe\u4ee5\u540e\u624d\u4f1a\u5f00\u7a97\u53e3</p> </li> <li> <p>\u7a97\u53e3\u5185\u90e8\u72b6\u6001\uff1a</p> </li> <li> <p>\u5c5e\u4e8e\u7a97\u53e3\u7684\u6240\u6709\u4e8b\u4ef6</p> </li> <li>\u5b9a\u65f6\u5668\uff1a\u65f6\u95f4\u6233=\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4 - 1\u6beb\u79d2\uff08\u56e0\u4e3a\u662f\u5de6\u95ed\u53f3\u5f00\u533a\u95f4\uff09\uff0c\u65b9\u6cd5\u662f process \u51fd\u6570</li> </ul> <p>\u5728\u53ea\u4f7f\u7528 ProcessWindowFunction \u7684\u60c5\u51b5\u4e0b\uff0cprocess \u65b9\u6cd5\u7684\u8fed\u4ee3\u5668\u53c2\u6570\u5305\u542b\u4e86\u5c5e\u4e8e\u7a97\u53e3\u7684\u6240\u6709\u6570\u636e\uff0c\u4f1a\u5bf9\u5185\u5b58\u9020\u6210\u538b\u529b\uff0c\u90a3\u4e48\u5e94\u8be5\u600e\u4e48\u53bb\u4f18\u5316\u5462\uff1f\u4f7f\u7528\u7d2f\u52a0\u5668\u7684\u601d\u60f3\u3002</p>"},{"location":"engine/flink/flink_04/#442-aggregatefunction","title":"4.4.2 AggregateFunction","text":"<p>\u589e\u91cf\u805a\u5408\u51fd\u6570\uff0c\u5173\u952e\u601d\u60f3\u662f\u5728\u6bcf\u4e2a\u7a97\u53e3\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u7d2f\u52a0\u5668\u3002</p> <ul> <li><code>AggregateFunction&lt;IN, ACC, OUT&gt;</code></li> <li>createAccumulator\uff1a\u521b\u5efa\u7a7a\u7d2f\u52a0\u5668\uff0c\u8fd4\u56de\u503c\u7684\u6cdb\u578b\u662f\u7d2f\u52a0\u5668\u7684\u6cdb\u578b</li> <li>add\uff1a\u5b9a\u4e49\u8f93\u5165\u6570\u636e\u548c\u7d2f\u52a0\u5668\u7684\u805a\u5408\u89c4\u5219\uff0c\u8fd4\u56de\u503c\u662f\u805a\u5408\u540e\u7684\u7d2f\u52a0\u5668</li> <li>getResult\uff1a\u7a97\u53e3\u95ed\u5408\u65f6\u53d1\u51fa\u805a\u5408\u7ed3\u679c\uff0c\u8fd4\u56de\u503c\u662f\u5c06\u8981\u53d1\u9001\u7684\u805a\u5408\u7ed3\u679c</li> <li>merge\uff1a\u4e00\u822c\u4e0d\u9700\u8981\u5b9e\u73b0\u3002\u53ea\u7528\u5728\u4e8b\u4ef6\u65f6\u95f4\u4f1a\u8bdd\u7a97\u53e3\u7684\u60c5\u51b5\u3002</li> </ul>"},{"location":"engine/flink/flink_04/#443-aggregatefunctionprocesswindowfunction","title":"4.4.3 \u5c06AggregateFunction\u548cProcessWindowFunction\u7ed3\u5408\u4f7f\u7528","text":"<p>\u5f53\u7a97\u53e3\u95ed\u5408\u65f6\uff1aAggregateFunction \u5c06 getResult() \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff0c\u53d1\u9001\u7ed9\u4e86 ProcessWindowFunction\u3002</p> <p></p> <p>ProcessWindowFunction \u7684 process \u65b9\u6cd5\u7684\u8fed\u4ee3\u5668\u53c2\u6570\u4e2d\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\u3002</p>"},{"location":"engine/flink/flink_04/#444","title":"4.4.4 \u7a97\u53e3\u7684\u5e95\u5c42\u5b9e\u73b0","text":"<p>AggregateFunction \u548c ProcessWindowFunction \u7ed3\u5408\u4f7f\u7528\u7684\u5e95\u5c42\u5b9e\u73b0</p> <p></p> <p>\u7a97\u53e3\u4e2d\u7684\u6240\u6709\u5143\u7d20\u90fd\u4fdd\u5b58\u5728 List \u4e2d\u3002</p>"},{"location":"engine/flink/flink_04/#445-processallwindowfunction","title":"4.4.5 ProcessAllWindowFunction","text":"<pre><code>stream\n.windowAll(TumblingEventTimeWindow.of(...))\n.process(new ProcessAllWindowFunction(...))\n</code></pre> <p>\u76f4\u63a5\u5bf9\u6d41\u8fdb\u884c\u5f00\u7a97\u53e3\uff0c\u7b49\u4ef7\u4e8e\u5c06\u6240\u6709\u6570\u636ekeyBy\u5230\u540c\u4e00\u6761\u6d41\uff0c\u7136\u540e\u8fdb\u884c\u5f00\u7a97\u53e3\u3002</p> <pre><code>stream\n.keyBy(r -&gt; 1)\n.window()\n.process(new ProcessWindowFunction())\n</code></pre>"},{"location":"engine/flink/flink_04/#446","title":"4.4.6 \u89e6\u53d1\u5668","text":"<p>\u7a97\u53e3\u5927\u5c0f\u662f 1 \u5929\uff0c\u4f46\u60f3\u6bcf\u9694 10 \u79d2\u949f\u8ba1\u7b97\u4e00\u6b21\u7a97\u53e3\u4e2d\u7684\u7edf\u8ba1\u6307\u6807\uff0c\u600e\u4e48\u529e\uff1f</p> <p>\u89e6\u53d1\u5668\u53ef\u4ee5\u5728\u7a97\u53e3\u5173\u95ed\u4e4b\u524d\uff0c\u89e6\u53d1\u7a97\u53e3\u7684\u8ba1\u7b97\u64cd\u4f5c\u3002</p> <pre><code>stream\n.keyBy()\n.window()\n[.allowedLateness()] // \u53ef\u9009\n[.sideOutput()]      // \u53ef\u9009\n[.trigger()]         // \u53ef\u9009\n.process()/aggregate()\n</code></pre> <p>\u89e6\u53d1\u5668\u89e6\u53d1\u7684\u662f trigger \u540e\u9762\u7684 process / aggregate \u65b9\u6cd5\u3002</p> <p>Trigger\uff1aT \u662f\u7a97\u53e3\u4e2d\u7684\u5143\u7d20\u7c7b\u578b\uff0cW \u662f\u7a97\u53e3\u7c7b\u578b\u3002 <p>TriggerResult</p> <ul> <li>CONTINUE\uff1a\u4ec0\u4e48\u90fd\u4e0d\u505a</li> <li>FIRE\uff1a\u89e6\u53d1\u7a97\u53e3\u7684\u8ba1\u7b97</li> <li>PURGE\uff1a\u6e05\u7a7a\u7a97\u53e3\u4e2d\u7684\u5143\u7d20</li> <li>FIRE_AND_PURGE\uff1a\u89e6\u53d1\u7a97\u53e3\u8ba1\u7b97\u5e76\u6e05\u7a7a\u7a97\u53e3\u4e2d\u7684\u5143\u7d20</li> </ul> <p>Trigger \u4e2d\u7684\u6838\u5fc3\u65b9\u6cd5</p> <ul> <li>onElement\uff1a\u6bcf\u6765\u4e00\u6761\u6570\u636e\u8c03\u7528\u4e00\u6b21</li> <li>onProcessingTime\uff1a\u5904\u7406\u65f6\u95f4\u5b9a\u65f6\u5668</li> <li>onEventTime\uff1a\u4e8b\u4ef6\u65f6\u95f4\u5b9a\u65f6\u5668</li> <li>clear\uff1a\u7a97\u53e3\u95ed\u5408\u65f6\u89e6\u53d1\u8c03\u7528</li> </ul>"},{"location":"engine/flink/flink_05/","title":"\u7b2c\u4e94\u7ae0 \u7a97\u53e3","text":""},{"location":"engine/flink/flink_05/#_2","title":"\u7a97\u53e3\u6982\u5ff5","text":"<p>Question</p> <p>\u4e00\u822c\u771f\u5b9e\u7684\u6d41\u90fd\u662f\u65e0\u754c\u7684\uff0c\u600e\u6837\u5904\u7406\u65e0\u754c\u7684\u6570\u636e\uff1f</p> <ul> <li>\u53ef\u4ee5\u628a\u65e0\u9650\u7684\u6570\u636e\u6d41\u8fdb\u884c\u5207\u5206\uff0c\u5f97\u5230\u6709\u9650\u7684\u6570\u636e\u96c6\u8fdb\u884c\u5904\u7406\u2014\u4e5f\u5c31\u662f\u5f97\u5230\u6709\u754c\u6d41\u3002</li> <li>\u7a97\u53e3\uff08 Window \uff09\u5c31\u662f\u5c06\u65e0\u9650\u6d41\u5207\u5272\u4e3a\u6709\u9650\u6d41\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u5b83\u4f1a\u5c06\u6d41\u6570\u636e\u5206\u53d1\u5230\u6709\u9650\u5927\u5c0f\u7684\u6876\uff08 bucket \uff09\u4e2d\u8fdb\u884c\u5206\u6790\u3002</li> </ul>"},{"location":"engine/flink/flink_05/#_3","title":"\u7a97\u53e3\u7684\u672c\u8d28","text":"<p> Flink \u9075\u5faa\u4e86\u5148\u5206\u6d41\u518d\u5f00\u7a97\u7684\u539f\u5219\u3002</p> <p>\u6211\u4eec\u4e00\u822c\u5728 <code>.keyBy</code> \u4e4b\u540e\u4f7f\u7528 <code>.window</code> \u65b9\u6cd5\u6765\u8fdb\u884c\u5f00\u7a97\uff0c\u5b9e\u9645\u4e0a\u662f\u5728 keyBy \u4e4b\u540e\u7684\u903b\u8f91\u5206\u533a\u4e2d\uff0c\u518d\u6309\u7167\u7a97\u53e3\u8fdb\u884c\u4e00\u6b21\u903b\u8f91\u5206\u533a\u3002\u5148\u5206\u6d41\u518d\u5f00\u7a97\u3002</p> <pre><code>SELECT count(*) FROM table GROUP BY key, window;\n</code></pre> <p>Flink \u7a97\u53e3\u662f\u5de6\u95ed\u53f3\u5f00\u7684\u533a\u95f4\uff0c\u4f8b\u5982 <code>[0, 5)</code> \u7684\u7a97\u53e3\u6700\u540e\u4e00\u4e2a\u65f6\u95f4\u6233\u662f <code>4999</code> \u6beb\u79d2\u3002</p>"},{"location":"engine/flink/flink_05/#_4","title":"\u7a97\u53e3\u7c7b\u578b","text":"<ul> <li>\u65f6\u95f4\u7a97\u53e3\uff08Time Window\uff09</li> <li>\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3</li> <li>\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3</li> <li>\u4f1a\u8bdd\u65f6\u95f4\u7a97\u53e3</li> <li>\u8ba1\u6570\u7a97\u53e3\uff08Count Window\uff09</li> <li>\u6eda\u52a8\u8ba1\u6570\u7a97\u53e3</li> <li>\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3</li> </ul>"},{"location":"engine/flink/flink_05/#_5","title":"\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3","text":"<ul> <li>\u5c06\u6570\u636e\u4f9d\u636e\u56fa\u5b9a\u7684\u7a97\u53e3\u957f\u5ea6\u5bf9\u6570\u636e\u8fdb\u884c\u5207\u5206\u3002</li> <li>\u65f6\u95f4\u5bf9\u9f50\uff0c\u7a97\u53e3\u957f\u5ea6\u56fa\u5b9a\uff0c\u6ca1\u6709\u91cd\u53e0\u3002</li> <li>10 \u79d2\u949f\u7684\u6eda\u52a8\u5904\u7406\u65f6\u95f4\u7a97\u53e3\u3002<code>.window(TumblingProcessingTimeWindow.of(Time.seconds(10)))</code>\u3002</li> <li>\u516c\u5f0f\uff1a\u4e8b\u4ef6\u6240\u5c5e\u7a97\u53e3\u7684\u5f00\u59cb\u65f6\u95f4 = \u4e8b\u4ef6\u7684\u65f6\u95f4\u6233 - \u4e8b\u4ef6\u7684\u65f6\u95f4\u6233 % \u6eda\u52a8\u7a97\u53e3\u5927\u5c0f</li> <li>\u7a97\u53e3\u662f\u5de6\u95ed\u53f3\u5f00\u3002<code>[0, 10)</code>\u3002\u6700\u540e\u4e00\u4e2a\u65f6\u95f4\u6233\u662f <code>9999ms</code></li> </ul> <ul> <li> <p>\u6ed1\u52a8\u7a97\u53e3\u662f\u56fa\u5b9a\u7a97\u53e3\u7684\u66f4\u5e7f\u4e49\u7684\u4e00\u79cd\u5f62\u5f0f\uff0c\u6ed1\u52a8\u7a97\u53e3\u7531\u56fa\u5b9a\u7684\u7a97\u53e3\u957f\u5ea6\u548c\u6ed1\u52a8\u8ddd\u79bb\u7ec4\u6210\u3002</p> </li> <li> <p><code>.window(SlidingProcessingTimeWindow.of(Time.seconds(10), Time.seconds(5)))</code>\u3002</p> </li> <li> <p>\u7a97\u53e3\u957f\u5ea6\u56fa\u5b9a\uff0c\u53ef\u4ee5\u6709\u91cd\u53e0</p> </li> <li> <p>\u5982\u679c\u4e00\u4e2a\u5143\u7d20\u540c\u65f6\u5c5e\u4e8e\u4e24\u4e2a\u7a97\u53e3\uff0c\u90a3\u4e48\u4f1a\u5c06\u5143\u7d20\u590d\u5236\u4e24\u4efd\uff0c\u6bcf\u4e2a\u7a97\u53e3\u5206\u914d\u4e00\u4e2a\u5143\u7d20\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6240\u6709\u7684\u7a97\u53e3\u4ece\u903b\u8f91\u4e0a\u5206\u5f00\u5904\u7406\u3002</p> </li> </ul> <p>Question</p> <p>\u5982\u4f55\u8ba1\u7b97\u4e00\u6761\u6570\u636e\u5c5e\u4e8e\u54ea\u4e2a\u6ed1\u52a8\u7a97\u53e3\uff08\u7a97\u53e3\u957f\u5ea6\uff1a10 \u79d2\u949f\uff0c\u6ed1\u52a8\u8ddd\u79bb\uff1a5 \u79d2\u949f\uff09\u5462\uff1f\u4e8b\u4ef6\u7684\u65f6\u95f4\u6233\u662f 7s\uff0c\u90a3\u4e48\u5c5e\u4e8e\u54ea\u51e0\u4e2a\u6ed1\u52a8\u7a97\u53e3\u5462\uff1f</p> <pre><code>firstWindowStartTime = ts - ts % \u6ed1\u52a8\u8ddd\u79bb(5s)\nstarts = []\nfor (start = firstWindowStartTime; start &gt; ts - \u7a97\u53e3\u957f\u5ea6(10s); start = start - \u6ed1\u52a8\u8ddd\u79bb(5s)) {\n  starts.add(start)\n}\nstarts =&gt; [5,0]\n</code></pre> <p>\u6f5c\u5728\u95ee\u9898\uff1a\u5982\u679c\u7a97\u53e3\u957f\u5ea6\u5f88\u957f\uff0c\u6ed1\u52a8\u8ddd\u79bb\u5f88\u77ed\uff0c\u90a3\u4e48\u4e00\u4e2a\u5143\u7d20\u4f1a\u540c\u65f6\u5c5e\u4e8e\u5f88\u591a\u4e2a\u7a97\u53e3\uff0c\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u5143\u7d20\u88ab\u590d\u5236\u5f88\u591a\u6b21\uff0c\u4ece\u800c\u5bf9\u5185\u5b58\u9020\u6210\u5f88\u5927\u7684\u538b\u529b\u3002</p> <pre><code>{\n\"Mary\": MapState {\n(0,10): [...,Event(7s)],\n(5,15): [...,Event(7s)],\n(10,20): [...],\n...\n...\n},\n\"Bob\": MapState {\n(0,10): [...,Event(7s)],\n(5,15): [...,Event(7s)],\n(10,20): [...],\n...\n...\n},\n}\n</code></pre>"},{"location":"engine/flink/flink_05/#_6","title":"\u4f1a\u8bdd\u65f6\u95f4\u7a97\u53e3","text":"<p>\u4f1a\u8bdd\u7a97\u53e3\u4e3b\u8981\u7528\u6765\u5206\u6790\u7528\u6237\u7684\u4f1a\u8bdd\uff0c\u6bd4\u5982\u50cf\u5237\u6296\u97f3\u8fd9\u79cd\u65f6\u957f\u4e0d\u56fa\u5b9a\u7684\u7528\u6237\u884c\u4e3a\u3002</p> <ul> <li>\u4f1a\u8bdd\u7a97\u53e3\u7684\u957f\u5ea6\u662f\u4e0d\u56fa\u5b9a\u7684\u3002</li> <li>\u4f7f\u7528\u8d85\u65f6\u65f6\u95f4\uff08 <code>.withGap</code> \uff09\u6765\u5b9a\u4e49\u4f1a\u8bdd\u7a97\u53e3\u3002</li> <li>\u4f1a\u8bdd\u7a97\u53e3\u5f00\u59cb\u65f6\u95f4\uff1a\u7a97\u53e3\u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u65f6\u95f4\u6233</li> <li>\u4f1a\u8bdd\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\uff1a\u7a97\u53e3\u4e2d\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u65f6\u95f4\u6233 + \u8d85\u65f6\u65f6\u95f4</li> </ul> <p></p>"},{"location":"engine/flink/flink_06/","title":"\u7b2c\u516d\u7ae0 \u903b\u8f91\u65f6\u949f-\u6c34\u4f4d\u7ebf","text":"<p>\u4e24\u79cd\u65f6\u95f4\u8bed\u4e49</p> <p></p> <ul> <li>\u5904\u7406\u65f6\u95f4\uff1a\u4e8b\u4ef6\u8fdb\u5165 process \u7b97\u5b50\u7684\u673a\u5668\u65f6\u95f4\u3002\u8c03\u7528 <code>ctx.timerService().currentProcessingTime()</code> \u65f6\u7684\u673a\u5668\u65f6\u95f4\u3002</li> <li>\u4e8b\u4ef6\u65f6\u95f4\uff1a\u4e8b\u4ef6\u4e2d\u5305\u542b\u7684\u65f6\u95f4\u6233\uff0c\u4e8b\u4ef6\u771f\u5b9e\u53d1\u751f\u7684\u65f6\u95f4\u3002</li> </ul> <p>\u4e3e\u4e24\u4e2a\u4f8b\u5b50\uff1a</p> <p></p> <p></p> <p>\u7531\u4e8e\u4e8b\u4ef6\u65f6\u95f4\u7684\u4e16\u754c\u91cc\u9762\u6ca1\u6709\u65f6\u949f\u673a\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e3a\u4e8b\u4ef6\u65f6\u95f4\u7684\u4e16\u754c\u63d0\u4f9b\u65f6\u949f\u673a\u5236\uff0c\u53eb\u505a\u6c34\u4f4d\u7ebf\uff08\u903b\u8f91\u65f6\u949f\uff09\u3002</p> <p>\u65f6\u949f\u7684\u5b9a\u4e49\uff1a\u5355\u8c03\u9012\u589e\u7684\u5e8f\u5217\u3002</p> <p>\u5982\u679c\u5355\u8c03\u9012\u589e\u7684\u5e8f\u5217\u662f CPU \u4ea7\u751f\u7684\uff0c\u90a3\u4e48\u5c31\u662f\u7269\u7406\u65f6\u949f\u3002\u5982\u679c\u662f\u7f16\u7a0b\u4ea7\u751f\u7684\uff0c\u90a3\u4e48\u5c31\u662f\u903b\u8f91\u65f6\u949f\u3002</p> <p>\u6c34\u4f4d\u7ebf\u6d41\u52a8\u5230\u54ea\u4e00\u4e2a\u7b97\u5b50\uff0c\u54ea\u4e00\u4e2a\u7b97\u5b50\u5c31\u4f1a\u66f4\u65b0\u81ea\u5df1\u7684\u65f6\u949f\uff08\u4ea7\u7ebf\u5de5\u4eba\u7684\u624b\u8868\uff09\u3002\u6c34\u4f4d\u7ebf\u4e0d\u4f1a\u5f2f\u9053\u8d85\u8f66\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6c34\u4f4d\u7ebf\u4e0d\u4f1a\u7ed5\u8fc7\u6c34\u4f4d\u7ebf\u524d\u9762\u7684\u6570\u636e\u4f20\u64ad\u4e0b\u53bb\u3002\u5982\u679c\u67d0\u4e2a\u7b97\u5b50\u7684\u8ba1\u7b97\u8fc7\u7a0b\u5f88\u8017\u65f6\uff0c\u90a3\u4e48\u4f1a\u963b\u585e\u6c34\u4f4d\u7ebf\u7684\u5411\u4e0b\u4f20\u64ad\u3002\u5982\u679c\u4e0a\u6e38\u7684\u7b97\u5b50\u963b\u585e\u4e86\u6c34\u4f4d\u7ebf\u7684\u4f20\u64ad\uff0c\u90a3\u4e48\u4e0a\u6e38\u7b97\u5b50\u548c\u4e0b\u6e38\u7b97\u5b50\u7684\u6c34\u4f4d\u7ebf\uff08\u65f6\u949f\uff09\u53ef\u80fd\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <p>\u5728\u4f7f\u7528\u5904\u7406\u65f6\u95f4\uff08 ProcessingTime \uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u5b58\u5728\u4e71\u5e8f\u6570\u636e\u7684\u60c5\u51b5\u3002</p> <p>\u4e71\u5e8f\u6570\u636e\u53ea\u5b58\u5728\u4e8e\u4f7f\u7528\u4e8b\u4ef6\u65f6\u95f4\u7684\u60c5\u51b5\u4e0b\u3002</p> <p>\u65f6\u949f\uff1a</p> <ul> <li>\u7269\u7406\u65f6\u949f\uff1a\u673a\u5668\u65f6\u95f4\uff0c\u5899\u4e0a\u65f6\u949f</li> <li>\u903b\u8f91\u65f6\u949f\uff1a\u6c34\u4f4d\u7ebf   \u5728Flink\u91cc\u9762\uff0c\u65f6\u949f\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f</li> <li>\u89e6\u53d1\u5b9a\u65f6\u5668</li> <li>\u5173\u95ed\u7a97\u53e3</li> </ul>"},{"location":"engine/flink/flink_06/#_1","title":"\u6709\u5173\u6c34\u4f4d\u7ebf\u7684\u4e00\u4e9b\u7ea6\u5b9a","text":"<ol> <li>\u6c34\u4f4d\u7ebf\u662f\u4e8b\u4ef6\u65f6\u95f4\u7684\u4e16\u754c\u4e2d\u7684\u903b\u8f91\u65f6\u949f\u3002</li> <li>\u6c34\u4f4d\u7ebf\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u4e8b\u4ef6\uff0c\u6c34\u4f4d\u7ebf\u662f\u4e00\u6761\u7279\u6b8a\u7684\u6570\u636e\u3002\u7531\u7a0b\u5e8f\u5458\u7f16\u7a0b\uff08\u8c03\u7528 <code>assignTimestampsAndWatermarks</code> \u5411\u4e0b\u6e38\u53d1\u9001\u4e00\u6761\u6c34\u4f4d\u7ebf\u4e8b\u4ef6\uff09\u63d2\u5165\u5230\u6570\u636e\u6d41\u4e2d\u3002\u968f\u6570\u636e\u6d41\u6d41\u52a8\u3002\u6c34\u4f4d\u7ebf\u4e8b\u4ef6\u548c\u6570\u636e\u6d41\u4e2d\u7684\u6570\u636e\u662f\u5b8c\u5168\u6ca1\u5173\u7cfb\u7684\u3002\u6c34\u4f4d\u7ebf\u662f <code>Watermark</code> \u7c7b\u578b\u3002\u6570\u636e\u662f String\u3001POJO Class \u7b49\u7b49\u7c7b\u578b\u3002</li> <li>\u7b97\u5b50\u7684\u6bcf\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u6c34\u4f4d\u7ebf\uff08\u903b\u8f91\u65f6\u949f\uff09\uff0c\u5f53\u63a5\u6536\u5230\u4e0a\u6e38\u53d1\u9001\u8fc7\u6765\u7684\u6c34\u4f4d\u7ebf\u65f6\uff0c\u66f4\u65b0\u81ea\u5df1\u7684\u6c34\u4f4d\u7ebf\uff08\u903b\u8f91\u65f6\u949f\uff09\u3002</li> <li>\u6c34\u4f4d\u7ebf = \u89c2\u5bdf\u5230\u7684\u6700\u5927\u4e8b\u4ef6\u65f6\u95f4\u6233 - \u6700\u5927\u5ef6\u8fdf\u65f6\u95f4 - 1 \u6beb\u79d2</li> <li>\u6700\u5927\u5ef6\u8fdf\u65f6\u95f4\u9700\u8981\u7a0b\u5e8f\u5458\u6839\u636e\u7ecf\u9a8c\u81ea\u5df1\u8bbe\u7f6e<ul> <li>\u8bbe\u7f6e\u7684\u8d8a\u5927\uff0c\u8fdf\u5230\u6570\u636e\u8d8a\u5c11\uff0c\u8ba1\u7b97\u7684\u8d8a\u51c6\u786e\uff0c\u4f46\u662f\u5f97\u5230\u7ed3\u679c\u7684\u5ef6\u8fdf\u8d8a\u9ad8\u3002</li> <li>\u8bbe\u7f6e\u7684\u8d8a\u5c0f\uff0c\u8fdf\u5230\u6570\u636e\u8d8a\u591a\uff0c\u8ba1\u7b97\u7684\u8d8a\u4e0d\u51c6\u786e\uff0c\u4f46\u662f\u5f97\u5230\u7ed3\u679c\u7684\u5ef6\u8fdf\u8d8a\u4f4e\u3002</li> </ul> </li> <li>Flink \u4f1a\u5728\u6d41\u7684\u6700\u5f00\u59cb\u63d2\u5165\u4e00\u4e2a\u65f6\u95f4\u6233\u4e3a\u8d1f\u65e0\u7a77\u5927\uff08 <code>Long.MIN_VALUE</code> \uff09\u7684\u6c34\u4f4d\u7ebf\u3002</li> <li>Flink \u4f1a\u5728\u6d41\u7684\u6700\u672b\u5c3e\u63d2\u5165\u4e00\u4e2a\u65f6\u95f4\u6233\u4e3a\u6b63\u65e0\u7a77\u5927\uff08 <code>Long.MAX_VALUE</code> \uff09\u7684\u6c34\u4f4d\u7ebf\u3002\u4e3a\u4e86\u5c06\u6240\u6709\u6ce8\u518c\u7684\u5b9a\u65f6\u5668\u548c\u7a97\u53e3\u90fd\u89e6\u53d1\u6267\u884c\u3002</li> <li>ProcessWindowFunction \u7684\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u6c34\u4f4d\u7ebf &gt;= \u4e8b\u4ef6\u65f6\u95f4\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4 - 1\u6beb\u79d2\uff0c\u89e6\u53d1\u7a97\u53e3\u8ba1\u7b97\u3002</li> <li>KeyedProcessFunction \u7684\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u6c34\u4f4d\u7ebf &gt;= \u4e8b\u4ef6\u65f6\u95f4\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\u6233\uff0c\u89e6\u53d1\u5b9a\u65f6\u5668\u6267\u884c\u3002</li> </ol>"},{"location":"engine/flink/flink_06/#_2","title":"\u591a\u6d41\u8f6c\u6362\u65f6\u6c34\u4f4d\u7ebf\u7684\u4f20\u64ad\u673a\u5236","text":"<ul> <li>\u5206\u6d41\uff1a\u6c34\u4f4d\u7ebf\u590d\u5236\u7136\u540e\u5e7f\u64ad\u5230\u4e0b\u6e38\u7684\u6240\u6709\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u53bb\u3002</li> <li>\u5408\u6d41\uff1a</li> </ul> <p>\u7b2c\u4e00\u6b65\uff1a\u5230\u8fbe\u7684\u6c34\u4f4d\u7ebf\u8986\u76d6\u6570\u7ec4\u4e2d\u5bf9\u5e94\u7684\u6c34\u4f4d\u7ebf\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff1a\u9009\u62e9\u6c34\u4f4d\u7ebf\u6570\u7ec4\u4e2d\u7684\u6700\u5c0f\u7684\u6c34\u4f4d\u7ebf\u6765\u66f4\u65b0\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u6c34\u4f4d\u7ebf\u3002</p>"},{"location":"engine/flink/flink_06/#_3","title":"\u6c34\u4f4d\u7ebf\u8bbe\u7f6e\u7684\u6700\u4f73\u5b9e\u8df5","text":"<ul> <li>\u5728\u5c3d\u91cf\u9760\u8fd1\u6570\u636e\u6e90\u7684\u5730\u65b9\u63d2\u5165\u6c34\u4f4d\u7ebf\uff08 <code>assignTimestampsAndWatermarks</code> \uff09\u3002</li> <li><code>assignTimestampsAndWatermarks</code> \u524d\u9762\u7684\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u6700\u597d\u662f <code>1</code>\u3002</li> </ul>"},{"location":"engine/flink/flink_06/#kafka","title":"Kafka\u6c34\u4f4d\u7ebf\u8bbe\u7f6e","text":"<p>\u6570\u636e\u6e90\uff08 <code>FlinkKafkaConsumer</code> \uff09\u7684\u5e76\u884c\u5ea6\uff08\u5c0f\u4e8e\uff09\u7b49\u4e8e Kafka \u4e3b\u9898\u7684\u5206\u533a\u6570\u91cf\u3002</p> <p>\u63d2\u5165\u6c34\u4f4d\u7ebf\u4e4b\u524d\u7684\u6240\u6709\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u548c Kafka \u4e3b\u9898\u7684\u5206\u533a\u6570\u91cf\u4e00\u81f4\u3002</p>"},{"location":"engine/flink/flink_06/#_4","title":"\u5982\u4f55\u5904\u7406\u8fdf\u5230\u6570\u636e","text":"<p>\u5230\u8fbe\u7684\u6570\u636e\u7684\u4e8b\u4ef6\u65f6\u95f4\u5c0f\u4e8e\u5f53\u524d\u7b97\u5b50\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u6c34\u4f4d\u7ebf\uff0c\u5c31\u662f\u8fdf\u5230\u6570\u636e\u3002\u53ea\u6709\u5728\u4f7f\u7528\u4e8b\u4ef6\u65f6\u95f4\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u5b58\u5728\u8fdf\u5230\u5143\u7d20\u3002\u5bf9\u4e8e\u5904\u7406\u65f6\u95f4\u6765\u8bf4\uff0c\u4e0d\u5b58\u5728\u8fdf\u5230\u6570\u636e\u3002</p> <p>\u5904\u7406\u8fdf\u5230\u6570\u636e\u7684\u7b56\u7565\uff1a</p> <ul> <li>\u9ed8\u8ba4\u7b56\u7565\uff08 ProcessWindowFunction \uff09</li> <li>\u5982\u679c\u6765\u7684\u6570\u636e\u662f\u8fdf\u5230\u6570\u636e\uff0c\u4f46\u662f\u6240\u5c5e\u7a97\u53e3\u8fd8\u5728\uff0c\u90a3\u4e48\u6570\u636e\u53ef\u4ee5\u8fdb\u5165\u7a97\u53e3\u3002</li> <li>\u5982\u679c\u6765\u7684\u6570\u636e\u662f\u8fdf\u5230\u6570\u636e\uff0c\u4f46\u6240\u5c5e\u7a97\u53e3\u5df2\u7ecf\u9500\u6bc1\uff0c\u90a3\u4e48\u6570\u636e\u88ab\u4e22\u5f03\u3002</li> <li>\u5c06\u8fdf\u5230\u6570\u636e\u53d1\u9001\u5230\u4fa7\u8f93\u51fa\u6d41\u4e2d\u53bb\u3002\u4fa7\u8f93\u51fa\u6d41\u662f\u4e0d\u540c\u4e8e\u4e3b\u6d41\u8f93\u51fa\u7684\u65c1\u8def\u8f93\u51fa\u6d41\uff0c\u53ef\u4ee5\u5411\u4fa7\u8f93\u51fa\u6d41\u53d1\u9001\u4efb\u610f\u6570\u636e\u3002</li> <li> <p><code>new OutputTag&lt;T&gt;(\"output-tag\"){}</code>\uff1a\u5355\u4f8b</p> </li> <li> <p>\u4f7f\u7528\u8fdf\u5230\u5143\u7d20\u66f4\u65b0\u7a97\u53e3\u8ba1\u7b97\u7ed3\u679c\u3002\u4e5f\u5c31\u662f\u5f53 ProcessWindowFunction \u7684\u6c34\u4f4d\u7ebf\u5230\u8fbe\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\u7684\u65f6\u5019\uff0c\u89e6\u53d1\u7a97\u53e3\u8ba1\u7b97\uff0c\u4f46\u4e0d\u9500\u6bc1\u7a97\u53e3\uff0c\u800c\u662f\u9009\u62e9\u518d\u7b49\u5f85\u8fdf\u5230\u5143\u7d20\u4e00\u6bb5\u65f6\u95f4\u3002</p> </li> <li><code>.allowedLateness(Time.seconds(5))</code>\uff1a\u7a97\u53e3\u4f1a\u7b49\u5f85 5 \u79d2\u949f\u7684\u8fdf\u5230\u4e8b\u4ef6</li> <li>\u7a97\u53e3\u771f\u6b63\u9500\u6bc1\uff1aProcessWindowFunction \u7684\u6c34\u4f4d\u7ebf &gt;= \u7a97\u53e3\u7ed3\u675f\u65f6\u95f4 + allowedLateness</li> <li>\u7a97\u53e3\u7684\u7b2c\u4e00\u6b21\u89e6\u53d1\u8ba1\u7b97\uff1a\u6c34\u4f4d\u7ebf &gt;= \u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\uff0c\u89e6\u53d1\u8ba1\u7b97\u5b8c\u4ee5\u540e\u7a97\u53e3\u4e0d\u4f1a\u88ab\u9500\u6bc1</li> </ul> <p>\u5904\u7406\u8fdf\u5230\u6570\u636e\u7684\u4f5c\u7528\uff1a\u5c06\u8fdf\u5230\u6570\u636e\u4fdd\u5b58\u4e0b\u6765\uff0c\u7136\u540e\u7edf\u8ba1\u4e00\u4e0b\u6bcf\u5929\u6709\u591a\u5c11\u8fdf\u5230\u6570\u636e\uff0c\u7136\u540e\u65b9\u4fbf\u6211\u4eec\u8c03\u6574\u6700\u5927\u5ef6\u8fdf\u65f6\u95f4\u7684\u8bbe\u7f6e\uff0c\u6539\u8fdb\u8ba1\u7b97\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002</p>"},{"location":"engine/flink/flink_07/","title":"\u7b2c\u4e03\u7ae0 \u591a\u6d41\u5408\u5e76","text":"<p>Flink\u7684\u591a\u6d41\u5408\u5e76\u7684\u673a\u5236\u662f\u4ee5 FIFO \u7684\u65b9\u5f0f\u5408\u5e76\u591a\u6761\u6d41\u3002</p> <ul> <li>union</li> <li>\u591a\u6761\u6d41\u7684\u5143\u7d20\u7c7b\u578b\u5fc5\u987b\u4e00\u6837</li> <li>\u53ef\u4ee5\u5408\u5e76\u591a\u6761\u6d41\uff1a<code>stream1.union(stream2, stream3)</code></li> <li>connect</li> <li>\u53ea\u80fd\u5408\u5e76\u4e24\u6761\u6d41</li> <li>\u4e24\u6761\u6d41\u7684\u5143\u7d20\u7684\u7c7b\u578b\u53ef\u4ee5\u4e0d\u4e00\u6837</li> <li>DataStream API<ul> <li>CoMapFunction <li>map1</li> <li>map2</li> <li>CoFlatMapFunction <li>flatMap1\uff1a\u6765\u81ea\u7b2c\u4e00\u6761\u6d41\u7684\u4e8b\u4ef6\u8fdb\u5165 CoFlatMapFunction\uff0c\u89e6\u53d1\u8c03\u7528\u3002</li> <li>flatMap2\uff1a\u6765\u81ea\u7b2c\u4e8c\u6761\u6d41\u7684\u4e8b\u4ef6\u8fdb\u5165 CoFlatMapFunction\uff0c\u89e6\u53d1\u8c03\u7528\u3002</li> <li>\u5e95\u5c42API<ul> <li>CoProcessFunction <li>\u4e24\u6761\u6d41\u90fd\u5fc5\u987b\u8fdb\u884c keyBy\u3002</li> <li><code>processElement1</code></li> <li><code>processElement2</code></li> <li><code>onTimer</code></li> <li>\u952e\u63a7\u72b6\u6001\u53d8\u91cf</li> <li>\u57fa\u4e8e\u95f4\u9694\u7684 join\uff1a<code>intervalJoin</code></li> <li>\u57fa\u4e8e\u7a97\u53e3\u7684 join</li>"},{"location":"engine/flink/flink_08/","title":"\u7b2c\u516b\u7ae0 Flink\u4e2d\u7684\u72b6\u6001\u53d8\u91cf","text":"<ul> <li>\u7b97\u5b50\u72b6\u6001\uff08Operator State\uff09</li> <li>\u7b97\u5b50\u72b6\u6001\u7684\u4f5c\u7528\u8303\u56f4\u9650\u5b9a\u4e3a\u7b97\u5b50\u7684\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u7531\u540c\u4e00\u5e76\u884c\u5b50\u4efb\u52a1\u6240\u5904\u7406\u7684\u6240\u6709\u6570\u636e\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5230\u76f8\u540c\u7684\u72b6\u6001\u3002</li> <li>\u7b97\u5b50\u72b6\u6001\u5bf9\u4e8e\u540c\u4e00\u5e76\u884c\u5b50\u4efb\u52a1\u800c\u8a00\u662f\u5171\u4eab\u7684\u3002</li> <li>\u7b97\u5b50\u72b6\u6001\u4e0d\u80fd\u7531\u76f8\u540c\u6216\u4e0d\u540c\u7b97\u5b50\u7684\u53e6\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u8bbf\u95ee\u3002</li> <li>\u5728 source \u7b97\u5b50\u6216\u8005 sink \u7b97\u5b50\u4e2d\u4f7f\u7528\uff0c\u9700\u8981\u989d\u5916\u5b9e\u73b0 <code>CheckpointedFunction</code> \u63a5\u53e3\u3002</li> <li>\u952e\u63a7\u72b6\u6001\uff08Keyed State\uff09</li> <li>\u952e\u63a7\u72b6\u6001\u662f\u6839\u636e\u8f93\u5165\u6570\u636e\u6d41\u4e2d\u5b9a\u4e49\u7684 key \u6765\u7ef4\u62a4\u548c\u8bbf\u95ee\u7684\u3002</li> <li>Flink \u4e3a\u6bcf\u4e2a key \u7ef4\u62a4\u4e00\u4e2a\u72b6\u6001\u5b9e\u4f8b\uff0c\u5e76\u5c06\u5177\u6709\u76f8\u540c key \u7684\u6240\u6709\u6570\u636e\uff0c\u90fd\u8def\u7531\u5230\u7b97\u5b50\u7684\u540c\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\uff0c\u8fd9\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u4f1a\u7ef4\u62a4\u548c\u5904\u7406\u8fd9\u4e2a key \u5bf9\u5e94\u7684\u952e\u63a7\u72b6\u6001\u3002</li> <li>\u5f53\u5e76\u884c\u5b50\u4efb\u52a1\u5904\u7406\u4e00\u6761\u6570\u636e\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u5c06\u72b6\u6001\u7684\u8bbf\u95ee\u8303\u56f4\u9650\u5b9a\u4e3a\u5f53\u524d\u6570\u636e\u7684 key\u3002<ul> <li>KeyedProcessFunction: processElement(In in, ...), in \u53ea\u80fd\u8bfb\u5199 in \u7684 key \u5bf9\u5e94\u7684\u72b6\u6001\u53d8\u91cf\u548c\u5b9a\u65f6\u5668\u3002</li> </ul> </li> <li>\u952e\u63a7\u72b6\u6001\u7684\u5e95\u5c42\u7ef4\u62a4\u65b9\u5f0f\u662f\u5728\u5e76\u884c\u5b50\u4efb\u52a1\u4e2d\u7ef4\u62a4\u4e00\u5f20 HashMap\u3002</li> <li>\u5728 KeyedProcessFunction \u4e2d\u4f7f\u7528\u3002</li> <li>\u7a97\u53e3\u72b6\u6001\uff08Windowed State\uff09\uff1a\u4f5c\u7528\u57df\u662f\u6bcf\u4e2a\u7a97\u53e3\u3002</li> <li>\u5728 trigger \u4e2d\u4f7f\u7528\u3002</li> <li>\u53ef\u4ee5\u5728 ProcessWindowFunction \u4e2d\u4f7f\u7528\u3002</li> </ul>"},{"location":"engine/flink/flink_08/#flink_1","title":"Flink\u4e2d\u7684\u72b6\u6001\u7ba1\u7406","text":""},{"location":"engine/flink/flink_08/#_1","title":"\u72b6\u6001\u540e\u7aef","text":"<ul> <li>\u6bcf\u4f20\u5165\u4e00\u6761\u6570\u636e\uff0c\u6709\u72b6\u6001\u7684\u7b97\u5b50\u4efb\u52a1\u90fd\u4f1a\u8bfb\u53d6\u548c\u66f4\u65b0\u72b6\u6001\u3002</li> <li>\u7531\u4e8e\u6709\u6548\u7684\u72b6\u6001\u8bbf\u95ee\u5bf9\u4e8e\u5904\u7406\u6570\u636e\u7684\u4f4e\u5ef6\u8fdf\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u6b64\u6bcf\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u90fd\u4f1a\u5728\u672c\u5730\uff08\u4efb\u52a1\u7ba1\u7406\u5668\u7684JVM\u7684\u5806\u5185\u5b58\uff09\u7ef4\u62a4\u5176\u72b6\u6001\uff0c\u4ee5\u786e\u4fdd\u5feb\u901f\u7684\u72b6\u6001\u8bbf\u95ee\u3002</li> <li>\u72b6\u6001\u7684\u5b58\u50a8\u3001\u8bbf\u95ee\u4ee5\u53ca\u7ef4\u62a4\uff0c\u7531\u4e00\u4e2a\u53ef\u63d2\u5165\u7684\u7ec4\u4ef6\u51b3\u5b9a\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u5c31\u53eb\u505a\u72b6\u6001\u540e\u7aef\uff08state backend\uff09</li> <li>\u72b6\u6001\u540e\u7aef\u4e3b\u8981\u8d1f\u8d23\u4e24\u4ef6\u4e8b</li> <li>\u672c\u5730\uff08\u4efb\u52a1\u7ba1\u7406\u5668\u7684JVM\u7684\u5806\u5185\u5b58\uff09\u7684\u72b6\u6001\u7ba1\u7406\uff0c\u4fdd\u8bc1\u5feb\u901f\u8bfb\u5199\u3002</li> <li>\u5c06\u72b6\u6001\u5199\u5165\u8fdc\u7a0b\u5b58\u50a8\uff08HDFS\u3001RocksDB\u3001\u6587\u4ef6\u7cfb\u7edf\u4e4b\u7c7b\u7684\uff09\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\u4e2d\u3002\u4fdd\u8bc1\u7a0b\u5e8f\u5b95\u673a\u4e4b\u540e\u53ef\u4ee5\u4ece\u68c0\u67e5\u70b9\u6587\u4ef6\u8fdb\u884c\u6545\u969c\u6062\u590d\u3002</li> </ul>"},{"location":"engine/flink/flink_08/#_2","title":"\u9009\u62e9\u4e00\u4e2a\u72b6\u6001\u540e\u7aef","text":"<ul> <li>MemoryStateBackend\uff08\u9ed8\u8ba4\uff09</li> <li>\u5185\u5b58\u7ea7\u7684\u72b6\u6001\u540e\u7aef\uff0c\u4f1a\u5c06\u72b6\u6001\u4f5c\u4e3a\u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\u8fdb\u884c\u7ba1\u7406\uff0c\u5c06\u672c\u5730\u72b6\u6001\u5b58\u50a8\u5728\u4efb\u52a1\u7ba1\u7406\u5668\u7684 JVM \u5806\u4e0a\uff0c\u800c\u5c06\u68c0\u67e5\u70b9\u6587\u4ef6\u5b58\u50a8\u5728\u4f5c\u4e1a\u7ba1\u7406\u5668\u7684\u5185\u5b58\u4e2d\u3002</li> <li>\u7279\u70b9\uff1a\u5feb\u901f\u3001\u4f4e\u5ef6\u8fdf\uff0c\u4f46\u4e0d\u7a33\u5b9a</li> <li>FsStateBackend\uff08\u6700\u5e38\u7528\uff09</li> <li>\u5c06\u72b6\u6001\u5b58\u5230\u8fdc\u7a0b\u7684\u6301\u4e45\u5316\u6587\u4ef6\u7cfb\u7edf\uff08FileSystem\uff09\u4e0a\u9762\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\u91cc\u9762\uff0c\u800c\u5bf9\u4e8e\u672c\u5730\u72b6\u6001\uff0c\u8ddf MemoryStateBackend \u4e00\u6837\uff0c\u4e5f\u4f1a\u5b58\u5728\u4efb\u52a1\u7ba1\u7406\u5668\u7684 JVM \u5806\u4e0a\u3002</li> <li>\u540c\u65f6\u62e5\u6709\u5185\u5b58\u7ea7\u7684\u672c\u5730\u8bbf\u95ee\u901f\u5ea6\uff0c\u548c\u66f4\u597d\u7684\u5bb9\u9519\u4fdd\u8bc1</li> <li>RocksDBStateBackend</li> <li>\u5728\u4efb\u52a1\u7ba1\u7406\u5668\u7684 JVM \u5806\u4e2d\uff0c\u7ef4\u62a4\u672c\u5730\u72b6\u6001\u3002\u5c06\u6240\u6709\u72b6\u6001\u5e8f\u5217\u5316\u540e\uff0c\u5b58\u5165 RocksDB \u4e2d\u3002</li> <li>RocksDB \u662f\u4e00\u4e2a\u786c\u76d8 KV \u6570\u636e\u5e93\u3002</li> </ul>"},{"location":"engine/flink/flink_09/","title":"\u7b2c\u4e5d\u7ae0 Flink\u7684\u5bb9\u9519\u673a\u5236","text":"<ul> <li>Flink\u7a0b\u5e8f\u5982\u4f55\u4ece\u68c0\u67e5\u70b9\u6062\u590d\u7a0b\u5e8f\u3002\uff08\u8bfb\uff09</li> <li>Flink\u5982\u4f55\u4fdd\u5b58\u68c0\u67e5\u70b9\u3002\uff08\u5199\uff09</li> </ul>"},{"location":"engine/flink/flink_09/#flink_1","title":"Flink\u7a0b\u5e8f\u5982\u4f55\u4ece\u68c0\u67e5\u70b9\u6062\u590d\u7a0b\u5e8f","text":"<p>\u65e0\u8bba\u91cd\u542f\u591a\u5c11\u6b21\u7a0b\u5e8f\uff0c\u67d0\u4e2a\u6570\u503c\u53ea\u4f1a\u5728\u7d2f\u52a0\u5668\u4e2d\u88ab\u7d2f\u52a0\u4e00\u6b21\uff0c\u8fd9\u4e2a\u5c31\u53eb\u505a\u7cbe\u51c6\u4e00\u6b21\u6d88\u8d39\uff08Exactly-Once\uff09\u2014\u2014\u65e2\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u91cd\u590d\u7d2f\u52a0\u67d0\u4e2a\u6570\u636e\u3002</p>"},{"location":"engine/flink/flink_09/#flink_2","title":"Flink\u5982\u4f55\u4fdd\u5b58\u68c0\u67e5\u70b9","text":"<p>\u4fdd\u5b58\u68c0\u67e5\u70b9\u7684\u7b97\u6cd5</p> <ul> <li>\u540c\u6b65\u7684\u601d\u60f3\uff08 Spark \u91c7\u7528\uff09</li> <li>\u6682\u505c\u5e94\u7528</li> <li>\u4fdd\u5b58\u72b6\u6001\u5230\u68c0\u67e5\u70b9\u6587\u4ef6</li> <li>\u518d\u91cd\u65b0\u6062\u590d\u5e94\u7528</li> <li>\u5f02\u6b65\u7684\u601d\u60f3\uff08 Flink \u7684\u6539\u8fdb\u5b9e\u73b0\uff09</li> <li>\u57fa\u4e8e Chandy-Lamport1\u7b97\u6cd5\u7684\u5f02\u6b65\u5206\u5e03\u5f0f\u5feb\u7167\u7b97\u6cd5</li> <li>\u6838\u5fc3\u601d\u60f3\uff1a\u5c06\u68c0\u67e5\u70b9\u7684\u4fdd\u5b58\u548c\u6570\u636e\u5904\u7406\u5206\u79bb\u5f00\uff0c\u4e0d\u6682\u505c\u6574\u4e2a\u5e94\u7528</li> </ul> <p>\u7b97\u6cd5\u7684\u6838\u5fc3\u673a\u5236\uff1a\u68c0\u67e5\u70b9\u5206\u754c\u7ebf</p> <p>\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\uff1acheckpoint barrier</p> <ul> <li>\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u4e8b\u4ef6\u3002\u7528\u6765\u628a\u4e00\u6761\u6d41\u4e0a\u7684\u6570\u636e\u6309\u7167\u4e0d\u540c\u7684\u68c0\u67e5\u70b9\u5206\u5f00\u3002</li> <li>\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u4e4b\u524d\u5230\u6765\u7684\u6570\u636e\u5bfc\u81f4\u7684\u72b6\u6001\u66f4\u6539\uff0c\u90fd\u4f1a\u88ab\u5305\u542b\u5728\u5f53\u524d\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u6240\u5c5e\u7684\u68c0\u67e5\u70b9\u4e2d\uff1b\u800c\u57fa\u4e8e\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u4e4b\u540e\u7684\u6570\u636e\u5bfc\u81f4\u7684\u6240\u6709\u66f4\u6539\uff0c\u5c31\u4f1a\u88ab\u5305\u542b\u5728\u4e4b\u540e\u7684\u68c0\u67e5\u70b9\u4e2d\u3002</li> <li>\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5230\u8fbe\u54ea\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u5c31\u5bf9\u54ea\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u72b6\u6001\u505a\u5feb\u7167\u3002\u548c\u6c34\u4f4d\u7ebf\u7c7b\u6bd4\uff1a\u6c34\u4f4d\u7ebf\u5230\u8fbe\u54ea\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u5c31\u66f4\u6539\u54ea\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u6c34\u4f4d\u7ebf\u3002</li> </ul> <p>Flink\u4e2d\u6709\u4e24\u79cd\u7279\u6b8a\u7684\u4e8b\u4ef6\uff1a</p> <ul> <li>\u6c34\u4f4d\u7ebf\uff08\u903b\u8f91\u65f6\u949f\uff09</li> <li>\u68c0\u67e5\u70b9\u5206\u754c\u7ebf</li> </ul> <p></p> <p>\u5728\u5206\u6d41\u65f6\uff0c\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u662f\u5e7f\u64ad\u51fa\u53bb\u7684\u3002\u548c\u6c34\u4f4d\u7ebf\u5728\u5206\u6d41\u65f6\u7684\u4f20\u9012\u673a\u5236\u76f8\u540c\u3002</p> <p></p> <ul> <li>\u5206\u754c\u7ebf\u5bf9\u9f50\uff1a\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5411\u4e0b\u6e38\u4f20\u9012\uff0csum \u4efb\u52a1\u4f1a\u7b49\u5f85\u6240\u6709\u8f93\u5165\u5206\u533a\u7684\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5230\u8fbe</li> <li>\u5bf9\u4e8e\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5df2\u7ecf\u5230\u8fbe\u7684\u5206\u533a\uff0c\u7ee7\u7eed\u5230\u8fbe\u7684\u6570\u636e\u4f1a\u88ab\u7f13\u5b58\uff08\u6bd4\u5982\u84dd\u8272\u4e09\u89d2\u5f62 2 \u540e\u9762\u7684 4\uff09</li> <li>\u800c\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5c1a\u672a\u5230\u8fbe\u7684\u5206\u533a\uff0c\u6570\u636e\u4f1a\u88ab\u6b63\u5e38\u5904\u7406\uff08\u6bd4\u5982\u7ea2\u8272\u4e09\u89d2\u5f62 2 \u4e4b\u524d\u5230\u8fbe\u7684\u6570\u636e\uff09</li> </ul> <p>sum_even \u4ec0\u4e48\u65f6\u5019\u505a\u5feb\u7167\uff1f\u5fc5\u987b\u63a5\u6536\u5230\u6765\u81ea source1 \u548c source2 \u7684\u6240\u6709\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u65f6\uff0c\u624d\u4f1a\u505a\u5feb\u7167\u3002\u8fd9\u4e2a\u673a\u5236\u53eb\u505a\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5bf9\u9f50\u3002\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5728\u5408\u6d41\u65f6\u7684\u4f20\u9012\u673a\u5236\u548c\u6c34\u4f4d\u7ebf\u4e0d\u4e00\u6837\u3002</p> <p>\u6bcf\u4e00\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u5728\u505a\u5b8c\u5feb\u7167\u4ee5\u540e\uff0c\u90fd\u4f1a\u5411\u4f5c\u4e1a\u7ba1\u7406\u5668\u53d1\u9001\u4e00\u6761\u901a\u77e5\uff0c\u7136\u540e\u5c06\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u5411\u4e0b\u6e38\u4f20\u9012\u3002</p> <p></p> <p>Sum \u5e76\u884c\u5b50\u4efb\u52a1\u5c06\u5b83\u4eec\u7684\u72b6\u6001\u5199\u5165\u68c0\u67e5\u70b9\u6587\u4ef6\uff0cSum \u7684\u5e76\u884c\u5b50\u4efb\u52a1\u4f1a\u5411\u4f5c\u4e1a\u7ba1\u7406\u5668\u53d1\u9001\u901a\u77e5\u786e\u8ba4 Sum \u7684\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u68c0\u67e5\u70b9\u4fdd\u5b58\u5b8c\u6210\u3002\u7136\u540e\u7ee7\u7eed\u5411\u4e0b\u6e38\u53d1\u9001\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u3002</p> <p></p> <p></p> <p>\u6b64\u65f6\uff0c\u4f5c\u4e1a\u7ba1\u7406\u5668\u63a5\u6536\u5230\u4e86\u6240\u6709\u7684 6 \u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u53d1\u9001\u8fc7\u6765\u7684\u901a\u77e5\uff0c\u90a3\u4e48\u5c31\u4f1a\u786e\u8ba4\u672c\u6b21\u68c0\u67e5\u70b9\u4fdd\u5b58\u7684\u5b8c\u6210\u3002\u7136\u540e\u4f5c\u4e1a\u7ba1\u7406\u5668\u4f1a\u5411\u6240\u6709\u7684 6 \u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u53d1\u9001\u4e00\u6761\u68c0\u67e5\u70b9\u5b8c\u6210\u7684\u5e7f\u64ad\u901a\u77e5\u3002</p> <ol> <li> <p>Leslie Lamport\uff1a \u5206\u5e03\u5f0f\u7cfb\u7edf\u9886\u57df\u7684\u4e0a\u5e1d\u3002\u53d1\u660e\u4e86\u903b\u8f91\u65f6\u949f\u3002\u53d1\u660e\u4e86 Paxos \u7b97\u6cd5\u3002\u53d1\u660e\u4e86\\(\\LaTeX\\)\u200b\u6392\u7248\u8f6f\u4ef6\uff08\u79d1\u6280\u6587\u732e\u6392\u7248\u6807\u51c6\uff09\u3002\u56fe\u7075\u5956\u5f97\u4e3b\u3002\u5fae\u8f6f\u9996\u5e2d\u79d1\u5b66\u5bb6\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"engine/flink/flink_10/","title":"\u7b2c\u5341\u7ae0 \u7aef\u5230\u7aef\u4e00\u81f4\u6027","text":"<p>\u7aef\u5230\u7aef\uff1a\u4e0a\u6e38\u8bbe\u5907  Flink\u7a0b\u5e8f  \u4e0b\u6e38\u8bbe\u5907</p>"},{"location":"engine/flink/flink_10/#_2","title":"\u72b6\u6001\u4e00\u81f4\u6027\u5206\u7c7b","text":"<ul> <li>AT-MOST-ONCE\uff08\u6700\u591a\u4e00\u6b21\uff09</li> <li>\u5f53\u4efb\u52a1\u6545\u969c\u65f6\uff0c\u6700\u7b80\u5355\u7684\u505a\u6cd5\u662f\u4ec0\u4e48\u90fd\u4e0d\u5e72\uff0c\u65e2\u4e0d\u6062\u590d\u4e22\u5931\u7684\u72b6\u6001\uff0c\u4e5f\u4e0d\u91cd\u64ad\u4e22\u5931\u7684\u6570\u636e\u3002at-most-once\u8bed\u4e49\u7684\u542b\u4e49\u662f\u6700\u591a\u5904\u7406\u4e00\u6b21\u4e8b\u4ef6\u3002\u4f8b\u5982\uff1aSocket \u6570\u636e\u6e90\uff0c\u4e0d\u63d0\u4f9b\u4efb\u4f55\u4e00\u81f4\u6027\u4fdd\u969c</li> <li>AT-LEAST-ONCE\uff08\u81f3\u5c11\u4e00\u6b21\uff09</li> <li>\u5728\u5927\u591a\u6570\u7684\u771f\u5b9e\u5e94\u7528\u573a\u666f\uff0c\u6211\u4eec\u5e0c\u671b\u4e0d\u4e22\u5931\u4e8b\u4ef6\u3002\u8fd9\u79cd\u7c7b\u578b\u7684\u4fdd\u969c\u79f0\u4e3a at-least-once\uff0c\u610f\u601d\u662f\u6240\u6709\u7684\u4e8b\u4ef6\u90fd\u5f97\u5230\u4e86\u5904\u7406\uff0c\u800c\u4e00\u4e9b\u4e8b\u4ef6\u8fd8\u53ef\u80fd\u88ab\u5904\u7406\u591a\u6b21\u3002\u4f8b\u5982\uff1aprint \u7b97\u5b50\u3002</li> <li>EXACTLY-ONCE\uff08\u7cbe\u786e\u4e00\u6b21\uff09</li> <li>\u6070\u597d\u5904\u7406\u4e00\u6b21\u662f\u6700\u4e25\u683c\u7684\u4fdd\u8bc1\uff0c\u4e5f\u662f\u6700\u96be\u5b9e\u73b0\u7684\u3002\u6070\u597d\u5904\u7406\u4e00\u6b21\u8bed\u4e49\u4e0d\u4ec5\u4ec5\u610f\u5473\u7740\u6ca1\u6709\u4e8b\u4ef6\u4e22\u5931\uff0c\u8fd8\u610f\u5473\u7740\u9488\u5bf9\u6bcf\u4e00\u4e2a\u6570\u636e\uff0c\u5185\u90e8\u72b6\u6001\u4ec5\u4ec5\u66f4\u65b0\u4e00\u6b21\u3002</li> </ul>"},{"location":"engine/flink/flink_10/#_3","title":"\u7aef\u5230\u7aef\u72b6\u6001\u4e00\u81f4\u6027","text":"<ul> <li>\u76ee\u524d\u6211\u4eec\u770b\u5230\u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\u90fd\u662f\u7531\u6d41\u5904\u7406\u5668\u5b9e\u73b0\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u90fd\u662f\u5728Flink\u6d41\u5904\u7406\u5668\u5185\u90e8\u4fdd\u8bc1\u7684\uff1b\u800c\u5728\u771f\u5b9e\u5e94\u7528\u4e2d\uff0c\u6d41\u5904\u7406\u5e94\u7528\u9664\u4e86\u6d41\u5904\u7406\u5668\u4ee5\u5916\u8fd8\u5305\u542b\u4e86\u6570\u636e\u6e90\uff08\u4f8b\u5982 Kafka\uff09\u548c\u8f93\u51fa\u5230\u6301\u4e45\u5316\u7cfb\u7edf\u3002</li> <li>\u7aef\u5230\u7aef\u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\uff0c\u610f\u5473\u7740\u7ed3\u679c\u7684\u6b63\u786e\u6027\u8d2f\u7a7f\u4e86\u6574\u4e2a\u6d41\u5904\u7406\u5e94\u7528\u7684\u59cb\u7ec8\uff1b\u6bcf\u4e00\u4e2a\u7ec4\u4ef6\u90fd\u4fdd\u8bc1\u4e86\u5b83\u81ea\u5df1\u7684\u4e00\u81f4\u6027\u3002</li> <li>\u6574\u4e2a\u7aef\u5230\u7aef\u7684\u4e00\u81f4\u6027\u7ea7\u522b\u53d6\u51b3\u4e8e\u6240\u6709\u7ec4\u4ef6\u4e2d\u4e00\u81f4\u6027\u6700\u5f31\u7684\u7ec4\u4ef6\u3002</li> </ul>"},{"location":"engine/flink/flink_10/#exactly-once","title":"\u7aef\u5230\u7aefEXACTLY-ONCE\u4e00\u81f4\u6027\u4fdd\u969c","text":"<ul> <li>\u5185\u90e8\u4fdd\u8bc1\u2014 checkpoint\uff08\u5206\u5e03\u5f0f\u5f02\u6b65\u5feb\u7167\u7b97\u6cd5\uff09</li> <li>Source \u7aef\u2014\u53ef\u91cd\u8bbe\u6570\u636e\u7684\u8bfb\u53d6\u4f4d\u7f6e\uff08Kafka\uff0cFileSystem\uff09</li> <li>\u9700\u8981\u5b9e\u73b0 <code>CheckpointedFunction</code> \u63a5\u53e3\u3002</li> <li>Sink\u7aef\u2014\u4ece\u6545\u969c\u6062\u590d\u65f6\uff0c\u6570\u636e\u4e0d\u4f1a\u91cd\u590d\u5199\u5165\u5916\u90e8\u7cfb\u7edf\uff08\u7cbe\u51c6\u4e00\u6b21\u5199\u5165\uff09</li> <li>\u5e42\u7b49\u5199\u5165</li> <li>\u4e8b\u52a1\u5199\u5165\uff1a\u9700\u8981\u5b9e\u73b0 <code>TwoPhaseCommitSinkFunction</code> \u63a5\u53e3\u3002</li> </ul>"},{"location":"engine/flink/flink_10/#_4","title":"\u5e42\u7b49\u5199\u5165","text":"<p>\u6240\u8c13\u5e42\u7b49\u64cd\u4f5c\uff0c\u662f\u8bf4\u4e00\u4e2a\u64cd\u4f5c\uff0c\u53ef\u4ee5\u91cd\u590d\u6267\u884c\u5f88\u591a\u6b21\uff0c\u4f46\u53ea\u5bfc\u81f4\u4e00\u6b21\u7ed3\u679c\u66f4\u6539\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u540e\u9762\u518d\u91cd\u590d\u6267\u884c\u5c31\u4e0d\u8d77\u4f5c\u7528\u4e86\u3002</p>"},{"location":"engine/flink/flink_10/#_5","title":"\u4e8b\u52a1\u5199\u5165","text":"<ul> <li>\u4e8b\u52a1\uff08Transaction\uff09  </li> <li>\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4e00\u7cfb\u5217\u4e25\u5bc6\u7684\u64cd\u4f5c\uff0c\u6240\u6709\u64cd\u4f5c\u5fc5\u987b\u6210\u529f\u5b8c\u6210\uff0c\u5426\u5219\u5728\u6bcf\u4e2a\u64cd\u4f5c\u4e2d\u6240\u4f5c\u7684\u6240\u6709\u66f4\u6539\u90fd\u4f1a\u88ab\u64a4\u6d88\uff08ACID\uff09</li> <li>\u5177\u6709\u539f\u5b50\u6027\uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u4e00\u4e2a\u90fd\u4e0d\u505a</li> <li>\u5b9e\u73b0\u601d\u60f3\uff1a\u6bcf\u4e00\u4e2a\u68c0\u67e5\u70b9\u5bf9\u5e94\u4e00\u4e2a\u4e8b\u52a1\uff0c\u8f93\u51fa\u7684\u6570\u636e\u5148\u7f13\u5b58\u5728\u4e8b\u52a1\u4e2d\uff08\u4e0d\u843d\u76d8\uff09\uff0c\u7b49\u5230\u68c0\u67e5\u70b9\u4fdd\u5b58\u771f\u6b63\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u624d\u628a\u6240\u6709\u8981\u8f93\u51fa\u7684\u7ed3\u679c\u4ece\u7f13\u5b58\u4e2d\u5199\u5165 Sink \u7cfb\u7edf\u4e2d\uff08\u843d\u76d8\uff09\u3002</li> <li>\u5b9e\u73b0\u65b9\u5f0f</li> <li>\u4e24\u9636\u6bb5\u63d0\u4ea4\uff08Two Phase Commit\uff0c2PC\uff09</li> </ul>"},{"location":"engine/flink/flink_10/#_6","title":"\u4e24\u9636\u6bb5\u63d0\u4ea4","text":"<ul> <li> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u68c0\u67e5\u70b9\uff0cSink \u4efb\u52a1\u4f1a\u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\uff08\u4e0b\u6e38\u8bbe\u5907\u7684\u4e8b\u52a1\uff0c\u6bd4\u5982 MySQL\uff0cKakfa\uff0c\u5982\u679c\u4e0b\u6e38\u8bbe\u5907\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u90a3\u4e48\u5fc5\u987b\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u4e8b\u52a1\uff09</p> </li> <li> <p>\u9884\u63d0\u4ea4\u9636\u6bb5\uff1a\u5c06\u8981\u8f93\u51fa\u7684\u6570\u636e\u5199\u5165\uff08\u7f13\u5b58\uff09\u5230\u5916\u90e8 Sink \u7cfb\u7edf\u7684\u4e8b\u52a1\u4e2d\uff0c\u4f46\u4e0d\u6b63\u5f0f\u63d0\u4ea4\u5b83\u4eec\uff0c\u4e5f\u5c31\u662f\u5148\u5c06\u8981\u8f93\u51fa\u7684\u6570\u636e\u7f13\u5b58\u5728\u4e0b\u6e38\u8bbe\u5907\u7684\u4e8b\u52a1\u4e2d\u3002</p> <ul> <li><code>sql   begin transaction     insert into ... // \u9884\u63d0\u4ea4     insert into ... // \u9884\u63d0\u4ea4   \u51fa\u73b0\u6545\u969crollback()</code></li> </ul> </li> <li> <p>\u6b63\u5f0f\u63d0\u4ea4\uff1a\u5f53 Sink \u7b97\u5b50\u63a5\u6536\u5230\u68c0\u67e5\u70b9\u5b8c\u6210\uff08\u6240\u6709\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u90fd\u5b8c\u6210\u4e86\u5feb\u7167\u7684\u4fdd\u5b58\u64cd\u4f5c\uff0c\u4f5c\u4e1a\u7ba1\u7406\u5668\u4f1a\u5411\u6240\u6709\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u5e7f\u64ad\u4e00\u6761\u68c0\u67e5\u70b9\u5b8c\u6210\u7684\u901a\u77e5\uff09\u7684\u901a\u77e5\u65f6\uff0c\u5b83\u624d\u6b63\u5f0f\u63d0\u4ea4\u4e0b\u6e38\u8bbe\u5907\u7684\u4e8b\u52a1\uff0c\u5b9e\u73b0\u7ed3\u679c\u7684\u771f\u6b63\u5199\u5165\u3002</p> <ul> <li><code>sql   ...   ...   commit // \u6b63\u5f0f\u63d0\u4ea4</code></li> </ul> </li> </ul>"},{"location":"engine/flink/flink_10/#_7","title":"\u603b\u7ed3","text":"\u4e0d\u53ef\u91cd\u7f6e\u7684\u6e90\uff08Socket\uff09 \u53ef\u91cd\u7f6e\u7684\u6e90\uff08Kafka\uff09 any sink at-most-once at-least-once \u5e42\u7b49\u6027sink at-most-once exactly-once \u9884\u5199\u5f0f\u65e5\u5fd7sink at-most-once at-least-once \u4e24\u9636\u6bb5\u63d0\u4ea4 at-most-once exactly-once"},{"location":"engine/flink/flink_10/#kafka-flink-kafka","title":"Kafka  Flink  Kafka\u7aef\u5230\u7aef\u4e00\u81f4\u6027","text":"<ul> <li>\u5185\u90e8\u2014\u5229\u7528\u68c0\u67e5\u70b9\u673a\u5236\uff0c\u628a\u72b6\u6001\u5b58\u76d8\uff08HDFS\uff09\uff0c\u53d1\u751f\u6545\u969c\u7684\u65f6\u5019\u53ef\u4ee5\u6062\u590d\uff0c\u4fdd\u8bc1\u5185\u90e8\u7684\u72b6\u6001\u4e00\u81f4\u6027\u3002</li> <li>source\u2014FlinkKafkaConsumer \u4f5c\u4e3a source\uff0c\u53ef\u4ee5\u5c06\u521a\u6d88\u8d39\u5b8c\u7684\u504f\u79fb\u91cf\u4fdd\u5b58\u4e0b\u6765\uff0c\u5982\u679c\u540e\u7eed\u4efb\u52a1\u51fa\u73b0\u4e86\u6545\u969c\uff0c\u6062\u590d\u7684\u65f6\u5019\u53ef\u4ee5\u7531\u8fde\u63a5\u5668\u91cd\u7f6e\u504f\u79fb\u91cf\uff0c\u91cd\u65b0\u6d88\u8d39\u6570\u636e\uff0c\u4fdd\u8bc1\u4e00\u81f4\u6027\u3002</li> <li>sink\u2014FlinkKafkaProducer \u4f5c\u4e3a sink\u3002</li> </ul>"},{"location":"engine/flink/flink_10/#_8","title":"\u4e24\u9636\u6bb5\u63d0\u4ea4\u6b65\u9aa4","text":"<ol> <li>\u6570\u636e\u6d41\u7684\u7b2c\u4e00\u6761\u6570\u636e\u6765\u4e86\u4e4b\u540e\uff0c\u5f00\u542f\u4e00\u4e2a\u4e0b\u6e38 Kafka \u7684\u4e8b\u52a1\uff08\u5bf9\u5e94\u4e86\u7b2c\u4e00\u4e2a\u68c0\u67e5\u70b9\uff09\uff0c\u8f93\u51fa\u6570\u636e\u6b63\u5e38\u5199\u5165 Kafka \u5206\u533a\u65e5\u5fd7\u4f46\u6807\u8bb0\u4e3a\u672a\u63d0\u4ea4\uff0c\u8fd9\u5c31\u662f\u201c\u9884\u63d0\u4ea4\u201d\u3002</li> <li>\u4f5c\u4e1a\u7ba1\u7406\u5668\u89e6\u53d1\u4fdd\u5b58\u68c0\u67e5\u70b9\u7684\u64cd\u4f5c\uff0c\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u4ece Source \u5f00\u59cb\u5411\u4e0b\u4f20\u9012\uff0c\u9047\u5230\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\u7684\u7b97\u5b50\u5c06\u72b6\u6001\u5b58\u5165\u72b6\u6001\u540e\u7aef\uff0c\u5e76\u901a\u77e5\u4f5c\u4e1a\u7ba1\u7406\u5668\u3002</li> <li>Sink\u8fde\u63a5\u5668\u6536\u5230\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\uff0c\u4fdd\u5b58 Sink \u7684\u5f53\u524d\u72b6\u6001\uff0c\u5b58\u5165\u68c0\u67e5\u70b9\u6587\u4ef6\u4e2d\uff0c\u901a\u77e5\u4f5c\u4e1a\u7ba1\u7406\u5668\uff0c\u5e76\u5f00\u542f\u4e0b\u4e00\u9636\u6bb5\u7684\u4e8b\u52a1\uff0c\u7528\u4e8e\u63d0\u4ea4\u4e0b\u4e2a\u68c0\u67e5\u70b9\u7684\u6570\u636e\u3002</li> <li>\u4f5c\u4e1a\u7ba1\u7406\u5668\u6536\u5230\u6240\u6709\u4efb\u52a1\u7684\u901a\u77e5\uff0c\u5411\u6240\u6709\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u5e7f\u64ad\u786e\u8ba4\u4fe1\u606f\uff0c\u8868\u793a\u68c0\u67e5\u70b9\u5b8c\u6210\u3002</li> <li>Sink\u4efb\u52a1\u6536\u5230\u4f5c\u4e1a\u7ba1\u7406\u5668\u7684\u786e\u8ba4\u4fe1\u606f\uff0c\u6b63\u5f0f\u63d0\u4ea4\u8fd9\u6bb5\u65f6\u95f4\u7684\u6570\u636e\uff0c\u5c06\u6807\u8bb0\u4e3a\u672a\u63d0\u4ea4\u7684\u5206\u533a\u6807\u8bb0\u4e3a\u5df2\u63d0\u4ea4\uff0c\u8fd9\u5c31\u662f\u201c\u6b63\u5f0f\u63d0\u4ea4\u201d\u3002</li> <li>\u6b63\u5f0f\u63d0\u4ea4\u7684\u6570\u636e\u53ef\u4ee5\u6b63\u5e38\u6d88\u8d39\u4e86\u3002</li> </ol>"},{"location":"engine/flink/flink_11/","title":"\u7b2c\u5341\u4e00\u7ae0 \u80cc\u538b\u95ee\u9898","text":"<p>\u80cc\u538b\uff08back pressure\uff09\u95ee\u9898\u7684\u672c\u8d28\uff1a\u5355\u4f4d\u65f6\u95f4\u7f13\u51b2\u533a\u5165\u961f\u5217\u7684\u6570\u636e\u91cf\uff0c\u5927\u4e8e\u7f13\u51b2\u533a\u51fa\u961f\u5217\u7684\u6570\u636e\u91cf\u3002</p> <ul> <li>\u51cf\u6162\u5165\u961f\u5217\uff08\u751f\u4ea7\u8005\uff09\u7684\u901f\u5ea6</li> <li>\u52a0\u5feb\u51fa\u961f\u5217\uff08\u6d88\u8d39\u8005\uff09\u7684\u901f\u5ea6</li> <li>\u589e\u5927\u7f13\u51b2\u533a\u961f\u5217\u7684\u5927\u5c0f</li> <li>\u6d88\u8d39\u8005\u544a\u8bc9\u751f\u4ea7\u8005\u81ea\u5df1\u76ee\u524d\u80fd\u6d88\u8d39\u591a\u5c11\uff08\u4fe1\u7528\u5ea6\uff09</li> </ul> <p>\u4e0b\u6e38\u7b97\u5b50\u4f1a\u5411\u4e0a\u6e38\u7b97\u5b50\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\uff0c\u544a\u8bc9\u4e0a\u6e38\u7b97\u5b50\u81ea\u5df1\u7684\u63a5\u6536\u7f13\u51b2\u533a\u80fd\u63a5\u6536\u591a\u5c11\u6570\u636e\uff0c\u5f53\u4e0a\u6e38\u7b97\u5b50\u7684\u53d1\u9001\u7f13\u51b2\u533a\u6512\u591f \\(\\le\\) \u4e0b\u6e38\u7b97\u5b50\u7684\u63a5\u6536\u7f13\u51b2\u533a\u80fd\u63a5\u6536\u7684\u6570\u636e\u91cf\uff0c\u5c31\u53d1\u9001\u4e0b\u53bb\u3002</p> <p>\u4f8b\u5982\uff1a</p> <p>\u4e0b\u6e38\u7b97\u5b50\u7684\u63a5\u6536\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u662f 4\uff0c\u4f46\u76ee\u524d\u53ea\u6709 3 \u4e2a\u5143\u7d20\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd8\u80fd\u63a5\u6536 1 \u4e2a\u5143\u7d20\uff0c\u90a3\u4e48\u4f1a\u53d1\u9001\u4e00\u6761\u6d88\u606f\u7ed9\u4e0a\u6e38\u7b97\u5b50\uff0c\u544a\u8bc9\u4e0a\u6e38\u7b97\u5b50\u81ea\u5df1\u7684\u7f13\u51b2\u533a\u8fd8\u6709 1 \u4e2a\u7a7a\u4f4d\uff0c\u8fd9\u6837\u5f53\u4e0a\u6e38\u7b97\u5b50\u7684\u53d1\u9001\u7f13\u51b2\u533a\u91cc\u6709 1 \u6761\u6570\u636e\uff0c\u76f4\u63a5\u53d1\u9001\u7ed9\u4e0b\u6e38\u7b97\u5b50\u7684\u63a5\u6536\u7f13\u51b2\u533a\u3002</p> <p>\u4fe1\u7528\u5ea6\u7b97\u6cd5</p> <p>\u4fe1\u7528\u5ea6\uff1a\u4e0b\u6e38\u7b97\u5b50\u7684\u63a5\u6536\u7f13\u51b2\u533a\u8fd8\u80fd\u63a5\u6536\u591a\u5c11\u6761\u6570\u636e\u3002</p> <p>\u57fa\u4e8e\u4fe1\u7528\u5ea6\u7684\u6d41\u91cf\u63a7\u5236</p> <p>\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u6765\u53d1\u9001\u6bcf\u6761\u6570\u636e\u7684\u6548\u7387\u5f88\u4f4e\uff0c\u4f1a\u5bfc\u81f4\u5f88\u5927\u7684\u5f00\u9500\u3002\u4e3a\u4e86\u5145\u5206\u5229\u7528\u7f51\u7edc\u8fde\u63a5\u7684\u5e26\u5bbd\uff0c\u5c31\u9700\u8981\u8fdb\u884c\u7f13\u51b2\u4e86\u3002\u5728\u6d41\u5904\u7406\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c\u7f13\u51b2\u7684\u4e00\u4e2a\u7f3a\u70b9\u662f\u4f1a\u589e\u52a0\u5ef6\u8fdf\uff0c\u56e0\u4e3a\u6570\u636e\u9700\u8981\u5728\u7f13\u51b2\u533a\u4e2d\u8fdb\u884c\u6536\u96c6\uff0c\u800c\u4e0d\u662f\u7acb\u5373\u53d1\u9001\u3002</p> <p>Flink \u5b9e\u73b0\u4e86\u4e00\u4e2a\u57fa\u4e8e\u4fe1\u7528\u5ea6\u7684\u6d41\u91cf\u63a7\u5236\u673a\u5236\uff0c\u5176\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\u3002\u63a5\u6536\u4efb\u52a1\u6388\u4e88\u53d1\u9001\u4efb\u52a1\u4e00\u4e9b\u201c\u4fe1\u7528\u5ea6\u201d\uff08credit\uff09\uff0c\u4e5f\u5c31\u662f\u4e3a\u4e86\u63a5\u6536\u5176\u6570\u636e\u800c\u4fdd\u7559\u7684\u7f51\u7edc\u7f13\u51b2\u533a\u6570\u3002\u5f53\u53d1\u9001\u8005\u6536\u5230\u4e00\u4e2a\u4fe1\u7528\u5ea6\u901a\u77e5\uff0c\u5b83\u5c31\u4f1a\u6309\u7167\u88ab\u6388\u4e88\u7684\u4fe1\u7528\u5ea6\uff0c\u53d1\u9001\u5c3d\u53ef\u80fd\u591a\u7684\u7f13\u51b2\u6570\u636e\uff0c\u5e76\u4e14\u540c\u65f6\u53d1\u9001\u76ee\u524d\u79ef\u538b\u6570\u636e\u7684\u5927\u5c0f\u2014\u2014\u4e5f\u5c31\u662f\u5df2\u586b\u6ee1\u5e76\u51c6\u5907\u53d1\u9001\u7684\u7f51\u7edc\u7f13\u51b2\u7684\u6570\u91cf\u3002\u63a5\u6536\u8005\u7528\u4fdd\u7559\u7684\u7f13\u51b2\u533a\u5904\u7406\u53d1\u6765\u7684\u6570\u636e\uff0c\u5e76\u5bf9\u53d1\u9001\u8005\u4f20\u6765\u7684\u79ef\u538b\u91cf\u8fdb\u884c\u7efc\u5408\u8003\u91cf\uff0c\u4e3a\u5176\u6240\u6709\u8fde\u63a5\u7684\u53d1\u9001\u8005\u786e\u5b9a\u4e0b\u4e00\u4e2a\u4fe1\u7528\u5ea6\u6388\u6743\u7684\u4f18\u5148\u7ea7\u3002</p> <p>\u57fa\u4e8e\u4fe1\u7528\u5ea6\u7684\u6d41\u63a7\u5236\u53ef\u4ee5\u51cf\u5c11\u5ef6\u8fdf\uff0c\u56e0\u4e3a\u53d1\u9001\u8005\u53ef\u4ee5\u5728\u63a5\u6536\u8005\u6709\u8db3\u591f\u7684\u8d44\u6e90\u63a5\u53d7\u6570\u636e\u65f6\u7acb\u5373\u53d1\u9001\u6570\u636e\u3002\u6b64\u5916\uff0c\u5728\u6570\u636e\u503e\u659c\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u6837\u5206\u914d\u7f51\u7edc\u8d44\u6e90\u662f\u4e00\u79cd\u5f88\u6709\u6548\u7684\u673a\u5236\uff0c\u56e0\u4e3a\u4fe1\u7528\u5ea6\u662f\u6839\u636e\u53d1\u9001\u8005\u79ef\u538b\u6570\u636e\u91cf\u7684\u89c4\u6a21\u6388\u4e88\u7684\u3002\u56e0\u6b64\uff0c\u57fa\u4e8e\u4fe1\u7528\u7684\u6d41\u91cf\u63a7\u5236\u662f Flink \u5b9e\u73b0\u9ad8\u541e\u5410\u91cf\u548c\u4f4e\u5ef6\u8fdf\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002</p>"},{"location":"engine/flink/flink_12/","title":"\u7b2c\u5341\u4e8c\u7ae0 \u6709\u9650\u72b6\u6001\u673a","text":"<p>\u5206\u4e24\u7c7b\uff1a</p> <ul> <li>\u786e\u5b9a\u6027\u6709\u9650\u72b6\u6001\u81ea\u52a8\u673a\uff08DFA\uff09</li> <li>\u975e\u786e\u5b9a\u6027\u6709\u9650\u72b6\u6001\u81ea\u52a8\u673a\uff08NFA\uff09</li> </ul> <p>\u6709\u9650\u72b6\u6001\u673a\u7684\u6982\u5ff5\uff1a</p> <ul> <li>\u6709\u9650\u7684\u72b6\u6001\uff08\\(S_1\\)\uff0c\\(S_2\\)\uff09</li> <li>\\(S_1\\): 0\u4e3a\u5076\u6570\u4e2a\u7684\u72b6\u6001</li> <li> <p>\\(S_2\\): 0\u4e3a\u5947\u6570\u4e2a\u7684\u72b6\u6001</p> </li> <li> <p>\u4e8b\u4ef6\uff080\uff0c1\uff09</p> </li> <li>\u6709\u9650\u72b6\u6001\u673a\u5728\u63a5\u6536\u5230\u4e8b\u4ef6\u65f6\uff0c\u4f1a\u53d1\u751f\u72b6\u6001\u7684\u8df3\u8f6c\u3002</li> </ul> <p></p> <p>\u5b57\u7b26\u4e32\uff1a<code>1001</code>\u3002</p> <p>\u5982\u679c\u904d\u5386\u5b8c\u5b57\u7b26\u4e32\uff0c\u6700\u7ec8\u4f4d\u4e8e\u7684\u72b6\u6001\u662f\\(S_1\\)\uff0c\u90a3\u4e48\u5b57\u7b26\u4e32\u4e2d\u5c31\u6709\u5076\u6570\u4e2a<code>0</code>\u3002</p> <p>flink cep\u5b98\u7f51\u94fe\u63a5</p>"},{"location":"engine/flink/flink_watermark/","title":"\u6c34\u4f4d\u7ebf\uff08Watermark\uff09","text":""},{"location":"engine/flink/flink_watermark/#_1","title":"\u4e8b\u4ef6\u65f6\u95f4\u548c\u7a97\u53e3","text":"<p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u4e00\u822c\u4f1a\u91c7\u7528\u4e8b\u4ef6\u65f6\u95f4\u8bed\u4e49\u3002\u800c\u6c34\u4f4d\u7ebf\uff0c\u5c31\u662f\u57fa\u4e8e\u4e8b\u4ef6\u65f6\u95f4\u63d0\u51fa\u7684\u6982\u5ff5\u3002\u6240 \u4ee5\u5728\u4ecb\u7ecd\u6c34\u4f4d\u7ebf\u4e4b\u524d\uff0c\u6211\u4eec\u9996\u5148\u6765\u68b3\u7406\u4e00\u4e0b\u4e8b\u4ef6\u65f6\u95f4\u548c\u7a97\u53e3\u7684\u5173\u7cfb\u3002</p> <p>\u4e00\u4e2a\u6570\u636e\u4ea7\u751f\u7684\u65f6\u523b\uff0c\u5c31\u662f\u6d41\u5904\u7406\u4e2d\u4e8b\u4ef6\u89e6\u53d1\u7684\u65f6\u95f4\u70b9\uff0c\u8fd9\u5c31\u662f\u201c\u4e8b\u4ef6\u65f6\u95f4\u201d\uff0c\u4e00\u822c\u90fd\u4f1a\u4ee5\u65f6\u95f4\u6233\u7684\u5f62\u5f0f\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u6bb5\u8bb0\u5f55\u5728\u6570\u636e\u91cc\u3002\u8fd9\u4e2a\u65f6\u95f4\u5c31\u50cf\u5546\u54c1\u7684\u201c\u751f\u4ea7\u65e5\u671f\u201d\u4e00\u6837\uff0c\u4e00\u65e6\u4ea7\u751f\u5c31\u662f\u56fa\u5b9a\u7684\uff0c\u5370\u5728\u5305\u88c5\u888b\u4e0a\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u8fd0\u8f93\u8f97\u8f6c\u800c\u53d8\u5316\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u7edf\u8ba1\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u6570 \u636e\uff0c\u9700\u8981\u5212\u5206\u65f6\u95f4\u7a97\u53e3\uff0c\u8fd9\u65f6\u53ea\u8981\u5224\u65ad\u4e00\u4e0b\u65f6\u95f4\u6233\u5c31\u53ef\u4ee5\u77e5\u9053\u6570\u636e\u5c5e\u4e8e\u54ea\u4e2a\u7a97\u53e3\u4e86\u3002</p> <p>\u660e\u786e\u4e86\u4e00\u4e2a\u6570\u636e\u7684\u6240\u5c5e\u7a97\u53e3\uff0c\u8fd8\u4e0d\u80fd\u76f4\u63a5\u8fdb\u884c\u8ba1\u7b97\u3002\u56e0\u4e3a\u7a97\u53e3\u5904\u7406\u7684\u662f\u6709\u754c\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u7b49\u7a97\u53e3\u7684\u6570\u636e\u90fd\u5230\u9f50\u4e86\uff0c\u624d\u80fd\u8ba1\u7b97\u51fa\u6700\u7ec8\u7684\u7edf\u8ba1\u7ed3\u679c\u3002\u90a3\u4ec0\u4e48\u65f6\u5019\u6570\u636e\u5c31\u90fd\u5230\u9f50\u4e86\u5462\uff1f\u5bf9\u4e8e\u65f6\u95f4\u7a97\u53e3\u6765\u8bf4\u8fd9\u5f88\u660e\u663e\uff1a\u5230\u4e86\u7a97\u53e3\u7684\u7ed3\u675f\u65f6\u95f4\uff0c\u81ea\u7136\u5c31\u5e94\u8be5\u6536\u96c6\u5230\u4e86\u6240\u6709\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u89e6\u53d1\u8ba1\u7b97\u8f93\u51fa\u7ed3\u679c\u4e86\u3002\u6bd4\u5982\u6211\u4eec\u60f3\u7edf\u8ba1 8 \u70b9~9 \u70b9\u7684\u7528\u6237\u70b9\u51fb\u91cf\uff0c\u90a3\u5c31\u662f\u4ece 8 \u70b9\u5f00\u59cb\u6536\u96c6\u6570\u636e\uff0c\u5230 9 \u70b9\u622a\u6b62\uff0c\u5c06\u6536\u96c6\u7684\u6570\u636e\u505a\u5904\u7406\u8ba1\u7b97\u3002\u8fd9\u6709\u70b9\u7c7b\u4f3c\u4e8e\u73ed\u8f66\uff0c\u5982\u56fe\u6240\u793a\uff0c\u6bcf\u5c0f\u65f6\u53d1\u4e00\u73ed\uff0c\u90a3\u4e48 8 \u70b9\u4e4b\u540e\u6765\u7684\u4eba\u90fd\u4f1a\u4e0a\u540c\u4e00\u73ed\u8f66\uff0c\u5230 9 \u70b9\u949f\u51c6\u65f6\u53d1\u8f66\uff1b9 \u70b9\u4e4b\u540e\u6765\u7684\u4eba\uff0c\u5c31\u53ea\u597d\u7b49\u4e0b\u4e00\u73ed 10 \u70b9\u53d1\u7684\u8f66\u4e86\u3002</p> <p> </p> \u8f66\u7ad9\u5f85\u53d1\u7684\u73ed\u8f66 <p>\u5f53\u7136\uff0c\u6211\u4eec\u73b0\u5728\u5904\u7406\u7684\u6570\u636e\u672c\u8eab\u662f\u6709\u65f6\u95f4\u6233\u7684\u3002\u6240\u4ee5\u4e3a\u4e86\u66f4\u6e05\u695a\u5730\u89e3\u91ca\uff0c\u6211\u4eec\u5c06\u201c\u8d76\u73ed\u8f66\u201d\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684\u4eba\uff0c\u6362\u6210\u5e26\u7740\u751f\u4ea7\u65e5\u671f\u7684\u5546\u54c1\u3002\u6240\u4ee5\u73b0\u5728\u6211\u4eec\u73ed\u8f66\u7684\u4e3b\u8981\u4efb\u52a1\u662f\u8fd0\u9001\u8d27\u7269\uff0c\u4e00\u8f86\u8f66\u5c31\u53ea\u88c5\u8f7d 1 \u5c0f\u65f6\u5185\u751f\u4ea7\u51fa\u7684\u6240\u6709\u5546\u54c1\uff0c\u8d27\u5230\u9f50\u4e86\u5c31\u53d1\u8f66\u3002\u6bd4\u5982\u67d0\u8f86\u8f66\u8981\u88c5\u7684\u662f 8 \u70b9\u5230 9 \u70b9\u7684\u6240\u6709\u5546\u54c1\uff0c\u90a3\u8d27\u4ec0\u4e48\u65f6\u5019\u5230\u9f50\u5462\uff1f\u81ea\u7136\u53ef\u4ee5\u60f3\u5230\uff0c\u5230 9 \u70b9\u949f\u7684\u65f6\u5019\u5546\u54c1\u5c31\u5230\u9f50\u4e86\uff0c\u53ef\u4ee5\u53d1\u8f66\u4e86\u3002</p> <p>\u5173\u952e\u95ee\u9898</p> <p>\u201c9 \u70b9\u949f\u53d1\u8f66\u201d\uff0c\u5230\u5e95\u662f\u770b\u8c01\u7684\u8868\u6765\u5b9a\u65f6\u95f4\uff1f</p> <p>\u5728\u5904\u7406\u65f6\u95f4\u8bed\u4e49\u4e0b\uff0c\u90fd\u662f\u4ee5\u5f53\u524d\u4efb\u52a1\u6240\u5728\u8282\u70b9\u7684\u7cfb\u7edf\u65f6\u95f4\u4e3a\u51c6\u7684\u3002\u8fd9\u5c31\u76f8\u5f53\u4e8e\u6bcf\u8f86\u8f66\u91cc\u90fd \u6302\u4e86\u4e00\u4e2a\u949f\uff0c\u53f8\u673a\u770b\u5230\u5230\u4e86 9 \u70b9\u5c31\u76f4\u63a5\u53d1\u8f66\u3002\u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\u7c97\u66b4\u5bb9\u6613\u5b9e\u73b0\uff0c\u4f46\u56e0\u4e3a\u8f66\u4e0a\u7684\u949f\u662f \u72ec\u7acb\u8fd0\u884c\u7684\uff0c\u4ee5\u5b83\u4e3a\u6807\u51c6\u5c31\u4e0d\u80fd\u51c6\u786e\u5730\u5224\u65ad\u5546\u54c1\u7684\u751f\u4ea7\u65f6\u95f4\u3002\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\uff0c\u8fd9\u6837\u4f1a\u56e0\u4e3a\u7f51 \u7edc\u4f20\u8f93\u5ef6\u8fdf\u7684\u4e0d\u786e\u5b9a\u800c\u5bfc\u81f4\u8bef\u5dee\u3002\u6bd4\u5982\u6709\u4e9b\u5546\u54c1\u5728 8 \u70b9 59 \u5206 59 \u79d2\u751f\u4ea7\u51fa\u6765\uff0c\u53ef\u662f\u4ece\u4e0b\u751f\u4ea7\u7ebf \u5230\u8fd0\u81f3\u8f66\u4e0a\u53c8\u8981\u82b1\u8d39\u51e0\u79d2\uff0c\u90a3\u5c31\u8d76\u4e0d\u4e0a 9 \u70b9\u949f\u8fd9\u73ed\u8f66\u4e86\u3002\u800c\u4e14\u73b0\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u6709\u5f88\u591a\u8f86 9 \u70b9\u53d1\u7684\u73ed\u8f66\uff0c\u6240\u4ee5\u540c\u65f6\u751f\u4ea7\u51fa\u7684\u4e00\u6279\u5546\u54c1\uff0c\u9700\u8981\u5e73\u5747\u5206\u914d\u5230\u4e0d\u540c\u73ed\u8f66\u4e0a\uff0c\u53ef\u8fd9\u4e9b\u73ed\u8f66\u8ddd\u79bb\u6709\u8fd1 \u6709\u8fdc\u3001\u4e0a\u9762\u6302\u7684\u949f\u6709\u5feb\u6709\u6162\uff0c\u8fd9\u5c31\u53ef\u80fd\u5bfc\u81f4\u6709\u4e9b\u5546\u54c1\u4e0a\u8f66\u4e86\u3001\u6709\u4e9b\u5374\u88ab\u6f0f\u6389\uff1b\u5148\u540e\u751f\u4ea7\u51fa\u7684\u5546 \u54c1\uff0c\u5230\u8fbe\u8f66\u4e0a\u7684\u987a\u5e8f\u4e5f\u53ef\u80fd\u4e71\u6389\uff1a\u7edf\u8ba1\u7ed3\u679c\u7684\u6b63\u786e\u6027\u53d7\u5230\u4e86\u5f71\u54cd\u3002</p> <p>\u6240\u4ee5\u5728\u5b9e\u9645\u4e2d\u6211\u4eec\u5f80\u5f80\u9700\u8981\u4ee5\u4e8b\u4ef6\u65f6\u95f4\u4e3a\u51c6\u3002\u5982\u679c\u8003\u8651\u4e8b\u4ef6\u65f6\u95f4\uff0c\u60c5\u51b5\u5c31\u590d\u6742\u8d77\u6765\u4e86\u3002\u73b0 \u5728\u4e0d\u80fd\u76f4\u63a5\u7528\u6bcf\u8f86\u8f66\u4e0a\u6302\u7684\u949f\uff08\u7cfb\u7edf\u65f6\u95f4\uff09\uff0c\u53c8\u6ca1\u6709\u7edf\u4e00\u7684\u65f6\u949f\uff0c\u90a3\u8be5\u600e\u4e48\u786e\u5b9a\u53d1\u8f66\u65f6\u95f4\u5462\uff1f</p> <p>\u73b0\u5728\u80fd\u5229\u7528\u7684\uff0c\u5c31\u53ea\u6709\u5546\u54c1\u7684\u751f\u4ea7\u65f6\u95f4\uff08\u6570\u636e\u7684\u65f6\u95f4\u6233\uff09\u4e86\u3002\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u601d\u8003\uff1a\u4e00\u822c\u60c5 \u51b5\u4e0b\uff0c\u5546\u54c1\u751f\u4ea7\u51fa\u6765\u4e4b\u540e\uff0c\u5c31\u4f1a\u7acb\u5373\u4f20\u9001\u5230\u8f66\u4e0a\uff1b\u6240\u4ee5\u5546\u54c1\u5230\u8fbe\u8f66\u4e0a\u7684\u65f6\u95f4\uff08\u7cfb\u7edf\u65f6\u95f4\uff09\u5e94\u8be5\u7a0d\u7a0d\u6ede\u540e\u4e8e\u5546\u54c1\u7684\u751f\u4ea7\u65f6\u95f4\uff08\u6570\u636e\u65f6\u95f4\u6233\uff09\u3002\u5982\u679c\u4e0d\u8003\u8651\u4f20\u8f93\u8fc7\u7a0b\u7684\u4e00\u70b9\u70b9\u5ef6\u8fdf\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5 \u76f4\u63a5\u7528\u5546\u54c1\u751f\u4ea7\u65f6\u95f4\u6765\u8868\u793a\u5f53\u524d\u8f66\u4e0a\u7684\u65f6\u95f4\u4e86\u3002\u5982\u56fe\u6240\u793a\uff0c\u5230\u8fbe\u8f66\u4e0a\u7684\u5546\u54c1\uff0c\u751f\u4ea7\u65f6\u95f4\u662f 8 \u70b9 05 \u5206\uff0c\u90a3\u4e48\u5f53\u524d\u8f66\u4e0a\u7684\u65f6\u95f4\u5c31\u662f 8 \u70b9 05 \u5206\uff1b\u53c8\u6765\u4e86\u4e00\u4e2a 8 \u70b9 10 \u5206\u751f\u4ea7\u7684\u5546\u54c1\uff0c\u73b0\u5728\u8f66 \u4e0a\u7684\u65f6\u95f4\u5c31\u662f 8 \u70b9 10 \u5206\u3002\u6211\u4eec\u76f4\u63a5\u7528\u6570\u636e\u7684\u65f6\u95f4\u6233\u6765\u6307\u793a\u5f53\u524d\u7684\u65f6\u95f4\u8fdb\u5c55\uff0c\u7a97\u53e3\u7684\u5173\u95ed\u81ea\u7136 \u4e5f\u662f\u4ee5\u6570\u636e\u7684\u65f6\u95f4\u6233\u7b49\u4e8e\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\u4e3a\u51c6\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u53ef\u4ee5\u4e0d\u53d7\u7f51\u7edc\u4f20\u8f93\u5ef6\u8fdf\u7684\u5f71\u54cd\u4e86\u3002\u50cf \u4e4b\u524d\u6240\u8bf4 8 \u70b9 59 \u5206 59 \u79d2\u751f\u4ea7\u51fa\u6765\u7684\u5546\u54c1\uff0c\u5230\u8f66\u4e0a\u7684\u65f6\u5019\u4e0d\u7ba1\u5b9e\u9645\u65f6\u95f4\uff08\u7cfb\u7edf\u65f6\u95f4\uff09\u662f\u51e0\u70b9\uff0c \u6211\u4eec\u5c31\u8ba4\u4e3a\u5f53\u524d\u662f 8 \u70b9 59 \u5206 59 \u79d2\uff0c\u6240\u4ee5\u5b83\u603b\u662f\u80fd\u8d76\u4e0a\u8f66\u7684\uff1b\u800c 9 \u70b9\u8fd9\u73ed\u8f66\uff0c\u8981\u7b49\u5230 9 \u70b9\u6574\u751f \u4ea7\u7684\u5546\u54c1\u5230\u6765\uff0c\u624d\u8ba4\u4e3a\u65f6\u95f4\u5230\u4e86 9 \u70b9\uff0c\u8fd9\u65f6\u624d\u6b63\u5f0f\u53d1\u8f66\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u7edf\u8ba1\u7ed3\u679c\u4e86\u3002</p> <p> </p> \u4e8b\u4ef6\u65f6\u95f4\u8bed\u4e49\u4e0b\u7a97\u53e3\u7684\u5f00\u542f\u548c\u5173\u95ed\uff08\u7a97\u53e3\u65f6\u95f4\u533a\u95f4\u4e3a\u5de6\u95ed\u53f3\u5f00\uff0c\u5373\u5305\u542b 8 \u70b9\u4e0d\u5305\u542b 9 \u70b9\uff09 <p>\u5728\u8fd9\u4e2a\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u5176\u5b9e\u662f\u57fa\u4e8e\u6570\u636e\u7684\u65f6\u95f4\u6233\uff0c\u81ea\u5b9a\u4e49\u4e86\u4e00\u4e2a\u201c\u903b\u8f91\u65f6\u949f\u201d\u3002\u8fd9\u4e2a\u65f6 \u949f\u7684\u65f6\u95f4\u4e0d\u4f1a\u81ea\u52a8\u6d41\u901d\uff1b\u5b83\u7684\u65f6\u95f4\u8fdb\u5c55\uff0c\u5c31\u662f\u9760\u7740\u65b0\u5230\u6570\u636e\u7684\u65f6\u95f4\u6233\u6765\u63a8\u52a8\u7684\u3002\u8fd9\u6837\u7684\u597d\u5904\u5728 \u4e8e\uff0c\u8ba1\u7b97\u7684\u8fc7\u7a0b\u53ef\u4ee5\u5b8c\u5168\u4e0d\u4f9d\u8d56\u5904\u7406\u65f6\u95f4\uff08\u7cfb\u7edf\u65f6\u95f4\uff09\uff0c\u4e0d\u8bba\u4ec0\u4e48\u65f6\u5019\u8fdb\u884c\u7edf\u8ba1\u5904\u7406\uff0c\u5f97\u5230\u7684 \u7ed3\u679c\u90fd\u662f\u6b63\u786e\u7684\u3002\u6bd4\u5982\u53cc\u5341\u4e00\u7684\u65f6\u5019\u7cfb\u7edf\u5904\u7406\u538b\u529b\u5927\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u628a\u5927\u91cf\u6570\u636e\u7f13\u5b58\u5728 Kafka \u4e2d\uff1b\u8fc7\u4e86\u9ad8\u5cf0\u65f6\u6bb5\u4e4b\u540e\u518d\u8bfb\u53d6\u51fa\u6765\uff0c\u5728\u51e0\u79d2\u4e4b\u5185\u5c31\u53ef\u4ee5\u5904\u7406\u5b8c\u51e0\u4e2a\u5c0f\u65f6\u751a\u81f3\u51e0\u5929\u7684\u6570\u636e\uff0c\u800c\u4e14 \u4f9d\u7136\u53ef\u4ee5\u6309\u7167\u6570\u636e\u4ea7\u751f\u7684\u65f6\u95f4\u6bb5\u8fdb\u884c\u7edf\u8ba1\uff0c\u6240\u6709\u7a97\u53e3\u90fd\u80fd\u6536\u96c6\u5230\u6b63\u786e\u7684\u6570\u636e\u3002\u800c\u4e00\u822c\u5b9e\u65f6\u6d41\u5904 \u7406\u7684\u573a\u666f\u4e2d\uff0c\u4e8b\u4ef6\u65f6\u95f4\u53ef\u4ee5\u57fa\u672c\u4e0e\u5904\u7406\u65f6\u95f4\u4fdd\u6301\u540c\u6b65\uff0c\u53ea\u662f\u7565\u5fae\u6709\u4e00\u70b9\u5ef6\u8fdf\uff0c\u540c\u65f6\u4fdd\u8bc1\u4e86\u7a97\u53e3 \u8ba1\u7b97\u7684\u6b63\u786e\u6027\u3002</p>"},{"location":"engine/flink/flink_watermark/#_2","title":"\u4ec0\u4e48\u662f\u6c34\u4f4d\u7ebf","text":"<p>\u5728\u4e8b\u4ef6\u65f6\u95f4\u8bed\u4e49\u4e0b\uff0c\u6211\u4eec\u4e0d\u4f9d\u8d56\u7cfb\u7edf\u65f6\u95f4\uff0c\u800c\u662f\u57fa\u4e8e\u6570\u636e\u81ea\u5e26\u7684\u65f6\u95f4\u6233\u53bb\u5b9a\u4e49\u4e86\u4e00\u4e2a\u65f6\u949f\uff0c \u7528\u6765\u8868\u793a\u5f53\u524d\u65f6\u95f4\u7684\u8fdb\u5c55\u3002\u4e8e\u662f\u6bcf\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u90fd\u4f1a\u6709\u4e00\u4e2a\u81ea\u5df1\u7684\u903b\u8f91\u65f6\u949f\uff0c\u5b83\u7684\u524d\u8fdb\u662f\u9760\u6570 \u636e\u7684\u65f6\u95f4\u6233\u6765\u9a71\u52a8\u7684\u3002</p> <p>\u4f46\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u79cd\u9a71\u52a8\u65b9\u5f0f\u53c8\u4f1a\u6709\u4e00\u4e9b\u95ee\u9898\u3002\u56e0\u4e3a\u6570\u636e\u672c\u8eab\u5728\u5904\u7406\u8f6c\u6362\u7684\u8fc7\u7a0b\u4e2d\u4f1a \u53d8\u5316\uff0c\u5982\u679c\u9047\u5230\u7a97\u53e3\u805a\u5408\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u5176\u5b9e\u662f\u8981\u6512\u4e00\u6279\u6570\u636e\u624d\u4f1a\u8f93\u51fa\u4e00\u4e2a\u7ed3\u679c\uff0c\u90a3\u4e48\u4e0b\u6e38\u7684\u6570 \u636e\u5c31\u4f1a\u53d8\u5c11\uff0c\u65f6\u95f4\u8fdb\u5ea6\u7684\u63a7\u5236\u5c31\u4e0d\u591f\u7cbe\u7ec6\u4e86\u3002\u53e6\u5916\uff0c\u6570\u636e\u5411\u4e0b\u6e38\u4efb\u52a1\u4f20\u9012\u65f6\uff0c\u4e00\u822c\u53ea\u80fd\u4f20\u8f93\u7ed9 \u4e00\u4e2a\u5b50\u4efb\u52a1\uff08\u9664\u5e7f\u64ad\u5916\uff09\uff0c\u8fd9\u6837\u5176\u4ed6\u7684\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u65f6\u949f\u5c31\u65e0\u6cd5\u63a8\u8fdb\u4e86\u3002\u4f8b\u5982\u4e00\u4e2a\u65f6\u95f4\u6233\u4e3a 9 \u70b9\u6574\u7684\u6570\u636e\u5230\u6765\uff0c\u5f53\u524d\u4efb\u52a1\u7684\u65f6\u949f\u5c31\u5df2\u7ecf\u662f 9 \u70b9\u4e86\uff1b\u5904\u7406\u5b8c\u5f53\u524d\u6570\u636e\u8981\u53d1\u9001\u5230\u4e0b\u6e38\uff0c\u5982\u679c\u4e0b\u6e38 \u4efb\u52a1\u662f\u4e00\u4e2a\u7a97\u53e3\u8ba1\u7b97\uff0c\u5e76\u884c\u5ea6\u4e3a 3\uff0c\u90a3\u4e48\u63a5\u6536\u5230\u8fd9\u4e2a\u6570\u636e\u7684\u5b50\u4efb\u52a1\uff0c\u65f6\u949f\u4e5f\u4f1a\u8fdb\u5c55\u5230 9 \u70b9\uff0c9 \u70b9\u7ed3\u675f\u7684\u7a97\u53e3\u5c31\u53ef\u4ee5\u5173\u95ed\u8fdb\u884c\u8ba1\u7b97\u4e86\uff1b\u800c\u53e6\u5916\u4e24\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u5219\u65f6\u95f4\u6ca1\u6709\u53d8\u5316\uff0c\u4e0d\u80fd\u8fdb\u884c\u7a97\u53e3 \u8ba1\u7b97\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u628a\u65f6\u949f\u4e5f\u4ee5\u6570\u636e\u7684\u5f62\u5f0f\u4f20\u9012\u51fa\u53bb\uff0c\u544a\u8bc9\u4e0b\u6e38\u4efb\u52a1\u5f53\u524d\u65f6\u95f4\u7684\u8fdb\u5c55\uff1b\u800c\u4e14\u8fd9\u4e2a \u65f6\u949f\u7684\u4f20\u9012\u4e0d\u4f1a\u56e0\u4e3a\u7a97\u53e3\u805a\u5408\u4e4b\u7c7b\u7684\u8fd0\u7b97\u800c\u505c\u6ede\u3002\u4e00\u79cd\u7b80\u5355\u7684\u60f3\u6cd5\u662f\uff0c\u5728\u6570\u636e\u6d41\u4e2d\u52a0\u5165\u4e00\u4e2a\u65f6 \u949f\u6807\u8bb0\uff0c\u8bb0\u5f55\u5f53\u524d\u7684\u4e8b\u4ef6\u65f6\u95f4\uff1b\u8fd9\u4e2a\u6807\u8bb0\u53ef\u4ee5\u76f4\u63a5\u5e7f\u64ad\u5230\u4e0b\u6e38\uff0c\u5f53\u4e0b\u6e38\u4efb\u52a1\u6536\u5230\u8fd9\u4e2a\u6807\u8bb0\uff0c\u5c31 \u53ef\u4ee5\u66f4\u65b0\u81ea\u5df1\u7684\u65f6\u949f\u4e86\u3002\u7531\u4e8e\u7c7b\u4f3c\u4e8e\u6c34\u6d41\u4e2d\u7528\u6765\u505a\u6807\u5fd7\u7684\u8bb0\u53f7\uff0c\u5728 Flink \u4e2d\uff0c\u8fd9\u79cd\u7528\u6765\u8861\u91cf\u4e8b \u4ef6\u65f6\u95f4\uff08Event Time\uff09\u8fdb\u5c55\u7684\u6807\u8bb0\uff0c\u5c31\u88ab\u79f0\u4f5c\u201c\u6c34\u4f4d\u7ebf\u201d\uff08Watermark\uff09\u3002</p> <p>\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u6c34\u4f4d\u7ebf\u53ef\u4ee5\u770b\u4f5c\u4e00\u6761\u7279\u6b8a\u7684\u6570\u636e\u8bb0\u5f55\uff0c\u5b83\u662f\u63d2\u5165\u5230\u6570\u636e\u6d41\u4e2d\u7684\u4e00\u4e2a\u6807\u8bb0\u70b9\uff0c \u4e3b\u8981\u5185\u5bb9\u5c31\u662f\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u7528\u6765\u6307\u793a\u5f53\u524d\u7684\u4e8b\u4ef6\u65f6\u95f4\u3002\u800c\u5b83\u63d2\u5165\u6d41\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5c31\u5e94\u8be5\u662f\u5728\u67d0\u4e2a \u6570\u636e\u5230\u6765\u4e4b\u540e\uff1b\u8fd9\u6837\u5c31\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u6570\u636e\u4e2d\u63d0\u53d6\u65f6\u95f4\u6233\uff0c\u4f5c\u4e3a\u5f53\u524d\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\u4e86\u3002</p> <p> </p> \u6bcf\u6761\u6570\u636e\u540e\u63d2\u5165\u4e00\u4e2a\u6c34\u4f4d\u7ebf <p>\u5982\u56fe\u6240\u793a\uff0c\u6bcf\u4e2a\u4e8b\u4ef6\u4ea7\u751f\u7684\u6570\u636e\uff0c\u90fd\u5305\u542b\u4e86\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u6211\u4eec\u76f4\u63a5\u7528\u4e00\u4e2a\u6574\u6570\u8868\u793a\u3002 \u8fd9\u91cc\u6ca1\u6709\u6307\u5b9a\u5355\u4f4d\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u79d2\u6216\u8005\u6beb\u79d2\uff08\u65b9\u4fbf\u8d77\u89c1\uff0c\u4e0b\u9762\u8bb2\u8ff0\u7edf\u4e00\u8ba4\u4e3a\u662f\u79d2\uff09\u3002\u5f53\u4ea7\u751f\u4e8e 2 \u79d2\u7684\u6570\u636e\u5230\u6765\u4e4b\u540e\uff0c\u5f53\u524d\u7684\u4e8b\u4ef6\u65f6\u95f4\u5c31\u662f 2 \u79d2\uff1b\u5728\u540e\u9762\u63d2\u5165\u4e00\u4e2a\u65f6\u95f4\u6233\u4e5f\u4e3a 2 \u79d2\u7684\u6c34\u4f4d\u7ebf\uff0c \u968f\u7740\u6570\u636e\u4e00\u8d77\u5411\u4e0b\u6e38\u6d41\u52a8\u3002\u800c\u5f53 5 \u79d2\u4ea7\u751f\u7684\u6570\u636e\u5230\u6765\u4e4b\u540e\uff0c\u540c\u6837\u5728\u540e\u9762\u63d2\u5165\u4e00\u4e2a\u6c34\u4f4d\u7ebf\uff0c\u65f6\u95f4 \u6233\u4e5f\u4e3a 5\uff0c\u5f53\u524d\u7684\u65f6\u949f\u5c31\u63a8\u8fdb\u5230\u4e86 5 \u79d2\u3002\u8fd9\u6837\uff0c\u5982\u679c\u51fa\u73b0\u4e0b\u6e38\u6709\u591a\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\u7684\u60c5\u5f62\uff0c\u6211\u4eec \u53ea\u8981\u5c06\u6c34\u4f4d\u7ebf\u5e7f\u64ad\u51fa\u53bb\uff0c\u5c31\u53ef\u4ee5\u901a\u77e5\u5230\u6240\u6709\u4e0b\u6e38\u4efb\u52a1\u5f53\u524d\u7684\u65f6\u95f4\u8fdb\u5ea6\u4e86\u3002</p> <p>\u6c34\u4f4d\u7ebf\u5c31\u50cf\u5b83\u7684\u540d\u5b57\u6240\u8868\u8fbe\u7684\uff0c\u662f\u6570\u636e\u6d41\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u968f\u7740\u6570\u636e\u4e00\u8d77\u6d41\u52a8\uff0c\u5728\u4e0d\u540c\u4efb\u52a1\u4e4b \u95f4\u4f20\u8f93\u3002\u8fd9\u770b\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff1b\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8fdb\u4e00\u6b65\u63a2\u8ba8\u4e00\u4e9b\u590d\u6742\u7684\u72b6\u51b5\u3002</p>"},{"location":"engine/flink/flink_watermark/#1","title":"1. \u6709\u5e8f\u6d41\u4e2d\u7684\u6c34\u4f4d\u7ebf","text":"<p>\u5728\u7406\u60f3\u72b6\u6001\u4e0b\uff0c\u6570\u636e\u5e94\u8be5\u6309\u7167\u5b83\u4eec\u751f\u6210\u7684\u5148\u540e\u987a\u5e8f\u3001\u6392\u597d\u961f\u8fdb\u5165\u6d41\u4e2d\uff1b\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4eec\u5904 \u7406\u7684\u8fc7\u7a0b\u4f1a\u4fdd\u6301\u539f\u5148\u7684\u987a\u5e8f\u4e0d\u53d8\uff0c\u9075\u5b88\u5148\u6765\u540e\u5230\u7684\u539f\u5219\u3002\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u4ece\u6bcf\u4e2a\u6570\u636e\u4e2d\u63d0\u53d6\u65f6\u95f4 \u6233\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u603b\u662f\u4ece\u5c0f\u5230\u5927\u589e\u957f\u7684\uff0c\u4ece\u800c\u63d2\u5165\u7684\u6c34\u4f4d\u7ebf\u4e5f\u4f1a\u4e0d\u65ad\u589e\u957f\u3001\u4e8b\u4ef6\u65f6\u949f\u4e0d\u65ad\u5411\u524d\u63a8 \u8fdb\u3002</p> <p>\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u5f53\u524d\u6570\u636e\u91cf\u975e\u5e38\u5927\uff0c\u53ef\u80fd\u4f1a\u6709\u5f88\u591a\u6570\u636e\u7684\u65f6\u95f4\u6233\u662f\u76f8\u540c\u7684\uff0c\u8fd9\u65f6\u6bcf\u6765\u4e00 \u6761\u6570\u636e\u5c31\u63d0\u53d6\u65f6\u95f4\u6233\u3001\u63d2\u5165\u6c34\u4f4d\u7ebf\u5c31\u505a\u4e86\u5927\u91cf\u7684\u65e0\u7528\u529f\u3002\u800c\u4e14\u5373\u4f7f\u65f6\u95f4\u6233\u4e0d\u540c\uff0c\u540c\u65f6\u6d8c\u6765\u7684\u6570 \u636e\u65f6\u95f4\u5dee\u4f1a\u975e\u5e38\u5c0f\uff08\u6bd4\u5982\u51e0\u6beb\u79d2\uff09\uff0c\u5f80\u5f80\u5bf9\u5904\u7406\u8ba1\u7b97\u4e5f\u6ca1\u4ec0\u4e48\u5f71\u54cd\u3002\u6240\u4ee5\u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\uff0c\u4e00\u822c \u4f1a\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u751f\u6210\u4e00\u4e2a\u6c34\u4f4d\u7ebf\uff0c\u8fd9\u4e2a\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\uff0c\u5c31\u662f\u5f53\u524d\u6700\u65b0\u6570\u636e\u7684\u65f6\u95f4\u6233\uff0c\u5982\u56fe\u6240\u793a\u3002\u6240\u4ee5\u8fd9\u65f6\u7684\u6c34\u4f4d\u7ebf\uff0c\u5176\u5b9e\u5c31\u662f\u6709\u5e8f\u6d41\u4e2d\u7684\u4e00\u4e2a\u5468\u671f\u6027\u51fa\u73b0\u7684\u65f6\u95f4\u6807\u8bb0\u3002</p> <p> </p> \u6709\u5e8f\u6d41\u4e2d\u5468\u671f\u6027\u63d2\u5165\u6c34\u4f4d\u7ebf <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6c34\u4f4d\u7ebf\u63d2\u5165\u7684\u201c\u5468\u671f\u201d\uff0c\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u65f6\u95f4\u6982\u5ff5\u3002\u5728\u5f53\u524d\u4e8b\u4ef6\u65f6\u95f4\u8bed \u4e49\u4e0b\uff0c\u5047\u5982\u6211\u4eec\u8bbe\u5b9a\u4e86\u6bcf\u9694 100ms \u751f\u6210\u4e00\u6b21\u6c34\u4f4d\u7ebf\uff0c\u90a3\u5c31\u662f\u8981\u7b49\u4e8b\u4ef6\u65f6\u949f\u63a8\u8fdb 100ms \u624d\u80fd\u63d2 \u5165\uff1b\u4f46\u662f\u4e8b\u4ef6\u65f6\u949f\u672c\u8eab\u7684\u8fdb\u5c55\uff0c\u672c\u8eab\u5c31\u662f\u9760\u6c34\u4f4d\u7ebf\u6765\u8868\u793a\u7684\u2014\u2014\u73b0\u5728\u8981\u63d2\u5165\u4e00\u4e2a\u6c34\u4f4d\u7ebf\uff0c\u53ef\u524d \u63d0\u53c8\u662f\u6c34\u4f4d\u7ebf\u8981\u5411\u524d\u63a8\u8fdb 100ms\uff0c\u8fd9\u5c31\u9677\u5165\u4e86\u6b7b\u5faa\u73af\u3002\u6240\u4ee5\u5bf9\u4e8e\u6c34\u4f4d\u7ebf\u7684\u5468\u671f\u6027\u751f\u6210\uff0c\u5468\u671f\u65f6 \u95f4\u662f\u6307\u5904\u7406\u65f6\u95f4\uff08\u7cfb\u7edf\u65f6\u95f4\uff09\uff0c\u800c\u4e0d\u662f\u4e8b\u4ef6\u65f6\u95f4\u3002</p>"},{"location":"engine/flink/flink_watermark/#2","title":"2. \u4e71\u5e8f\u6d41\u4e2d\u7684\u6c34\u4f4d\u7ebf","text":"<p>\u6709\u5e8f\u6d41\u7684\u5904\u7406\u975e\u5e38\u7b80\u5355\uff0c\u770b\u8d77\u6765\u6c34\u4f4d\u7ebf\u4e5f\u5e76\u6ca1\u6709\u8d77\u5230\u592a\u5927\u7684\u4f5c\u7528\u3002\u4f46\u8fd9\u79cd\u60c5\u51b5\u53ea\u5b58\u5728\u4e8e\u7406 \u60f3\u72b6\u6001\u4e0b\u3002\u6211\u4eec\u77e5\u9053\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u5728\u8282\u70b9\u95f4\u4f20\u8f93\uff0c\u4f1a\u56e0\u4e3a\u7f51\u7edc\u4f20\u8f93\u5ef6\u8fdf\u7684\u4e0d\u786e\u5b9a\u6027\uff0c \u5bfc\u81f4\u987a\u5e8f\u53d1\u751f\u6539\u53d8\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u201c\u4e71\u5e8f\u6570\u636e\u201d\u3002</p> <p>\u8fd9\u91cc\u6240\u8bf4\u7684\u201c\u4e71\u5e8f\u201d\uff08out-of-order\uff09\uff0c\u662f\u6307\u6570\u636e\u7684\u5148\u540e\u987a\u5e8f\u4e0d\u4e00\u81f4\uff0c\u4e3b\u8981\u5c31\u662f\u57fa\u4e8e\u6570\u636e\u7684\u4ea7 \u751f\u65f6\u95f4\u800c\u8a00\u7684\u3002\u5982\u56fe\u6240\u793a\uff0c\u4e00\u4e2a 7 \u79d2\u65f6\u4ea7\u751f\u7684\u6570\u636e\uff0c\u751f\u6210\u65f6\u95f4\u81ea\u7136\u8981\u6bd4 9 \u79d2\u7684\u6570\u636e\u65e9\uff1b\u4f46 \u662f\u7ecf\u8fc7\u6570\u636e\u7f13\u5b58\u548c\u4f20\u8f93\u4e4b\u540e\uff0c\u5904\u7406\u4efb\u52a1\u53ef\u80fd\u5148\u6536\u5230\u4e86 9 \u79d2\u7684\u6570\u636e\uff0c\u4e4b\u540e 7 \u79d2\u7684\u6570\u636e\u624d\u59d7\u59d7\u6765\u8fdf\u3002</p> <p>Question</p> <p>\u8fd9\u65f6\u5982\u679c\u6211\u4eec\u5e0c\u671b\u63d2\u5165\u6c34\u4f4d\u7ebf\uff0c\u6765\u6307\u793a\u5f53\u524d\u7684\u4e8b\u4ef6\u65f6\u95f4\u8fdb\u5c55\uff0c\u53c8\u8be5\u600e\u4e48\u505a\u5462\uff1f</p> <p> </p> \u4e71\u5e8f\u6d41 <p>\u6700\u76f4\u89c2\u7684\u60f3\u6cd5\u81ea\u7136\u662f\u8ddf\u4e4b\u524d\u4e00\u6837\uff0c\u6211\u4eec\u8fd8\u662f\u9760\u6570\u636e\u6765\u9a71\u52a8\uff0c\u6bcf\u6765\u4e00\u4e2a\u6570\u636e\u5c31\u63d0\u53d6\u5b83\u7684\u65f6\u95f4 \u6233\u3001\u63d2\u5165\u4e00\u4e2a\u6c34\u4f4d\u7ebf\u3002\u4e0d\u8fc7\u73b0\u5728\u7684\u60c5\u51b5\u662f\u6570\u636e\u4e71\u5e8f\uff0c\u6240\u4ee5\u6709\u53ef\u80fd\u65b0\u7684\u65f6\u95f4\u6233\u6bd4\u4e4b\u524d\u7684\u8fd8\u5c0f\uff0c\u5982 \u679c\u76f4\u63a5\u5c06\u8fd9\u4e2a\u65f6\u95f4\u7684\u6c34\u4f4d\u7ebf\u518d\u63d2\u5165\uff0c\u6211\u4eec\u7684\u201c\u65f6\u949f\u201d\u5c31\u56de\u9000\u4e86\u2014\u2014\u6c34\u4f4d\u7ebf\u5c31\u4ee3\u8868\u4e86\u65f6\u949f\uff0c\u65f6\u5149 \u4e0d\u80fd\u5012\u6d41\uff0c\u6240\u4ee5\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\u4e5f\u4e0d\u80fd\u51cf\u5c0f\u3002</p> <p>\u89e3\u51b3\u601d\u8def\u4e5f\u5f88\u7b80\u5355\uff1a\u6211\u4eec\u63d2\u5165\u65b0\u7684\u6c34\u4f4d\u7ebf\u65f6\uff0c\u8981\u5148\u5224\u65ad\u4e00\u4e0b\u65f6\u95f4\u6233\u662f\u5426\u6bd4\u4e4b\u524d\u7684\u5927\uff0c\u5426\u5219 \u5c31\u4e0d\u518d\u751f\u6210\u65b0\u7684\u6c34\u4f4d\u7ebf\uff0c\u5982\u56fe\u6240\u793a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u6709\u6570\u636e\u7684\u65f6\u95f4\u6233\u6bd4\u5f53\u524d\u65f6\u949f\u5927\uff0c\u624d\u80fd\u63a8 \u52a8\u65f6\u949f\u524d\u8fdb\uff0c\u8fd9\u65f6\u624d\u63d2\u5165\u6c34\u4f4d\u7ebf\u3002</p> <p> </p> \u4e71\u5e8f\u6d41\u4e2d\u7684\u6c34\u4f4d\u7ebf <p>\u5982\u679c\u8003\u8651\u5230\u5927\u91cf\u6570\u636e\u540c\u65f6\u5230\u6765\u7684\u5904\u7406\u6548\u7387\uff0c\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u5468\u671f\u6027\u5730\u751f\u6210\u6c34\u4f4d\u7ebf\u3002\u8fd9\u65f6\u53ea\u9700 \u8981\u4fdd\u5b58\u4e00\u4e0b\u4e4b\u524d\u6240\u6709\u6570\u636e\u4e2d\u7684\u6700\u5927\u65f6\u95f4\u6233\uff0c\u9700\u8981\u63d2\u5165\u6c34\u4f4d\u7ebf\u65f6\uff0c\u5c31\u76f4\u63a5\u4ee5\u5b83\u4f5c\u4e3a\u65f6\u95f4\u6233\u751f\u6210\u65b0 \u7684\u6c34\u4f4d\u7ebf\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p> </p> \u4e71\u5e8f\u6d41\u4e2d\u5468\u671f\u6027\u751f\u6210\u6c34\u4f4d\u7ebf <p>\u8fd9\u6837\u505a\u5c3d\u7ba1\u53ef\u4ee5\u5b9a\u4e49\u51fa\u4e00\u4e2a\u4e8b\u4ef6\u65f6\u949f\uff0c\u5374\u4e5f\u4f1a\u5e26\u6765\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u95ee\u9898\uff1a\u6211\u4eec\u65e0\u6cd5\u6b63\u786e\u5904\u7406 \u201c\u8fdf\u5230\u201d\u7684\u6570\u636e\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u5f53 9 \u79d2\u4ea7\u751f\u7684\u6570\u636e\u5230\u6765\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u76f4\u63a5\u5c06\u65f6\u949f\u63a8\u8fdb\u5230\u4e86 9 \u79d2\uff1b\u5982\u679c\u6709\u4e00\u4e2a\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\u5c31\u662f 9 \u79d2\uff08\u6bd4\u5982\uff0c\u8981\u7edf\u8ba1 0~9 \u79d2\u7684\u6240\u6709\u6570\u636e\uff09\uff0c\u90a3\u4e48\u8fd9\u65f6\u7a97\u53e3 \u5c31\u5e94\u8be5\u5173\u95ed\u3001\u5c06\u6536\u96c6\u5230\u7684\u6240\u6709\u6570\u636e\u8ba1\u7b97\u8f93\u51fa\u7ed3\u679c\u4e86\u3002\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u7531\u4e8e\u6570\u636e\u662f\u4e71\u5e8f\u7684\uff0c\u8fd8\u53ef\u80fd\u6709 \u65f6\u95f4\u6233\u4e3a 7 \u79d2\u30018 \u79d2\u7684\u6570\u636e\u5728 9 \u79d2\u7684\u6570\u636e\u4e4b\u540e\u624d\u5230\u6765\uff0c\u8fd9\u5c31\u662f\u201c\u8fdf\u5230\u6570\u636e\u201d\uff08late data\uff09\u3002\u5b83\u4eec \u672c\u6765\u4e5f\u5e94\u8be5\u5c5e\u4e8e 0~9 \u79d2\u8fd9\u4e2a\u7a97\u53e3\uff0c\u4f46\u6b64\u65f6\u7a97\u53e3\u5df2\u7ecf\u5173\u95ed\uff0c\u4e8e\u662f\u8fd9\u4e9b\u6570\u636e\u5c31\u88ab\u9057\u6f0f\u4e86\uff0c\u8fd9\u4f1a\u5bfc \u81f4\u7edf\u8ba1\u7ed3\u679c\u4e0d\u6b63\u786e\u3002</p> <p>\u5982\u679c\u7528\u4e4b\u524d\u6211\u4eec\u7c7b\u6bd4\u73ed\u8f66\u7684\u4f8b\u5b50\uff0c\u73b0\u5728\u7684\u72b6\u51b5\u5c31\u662f\u5546\u54c1\u4e0d\u662f\u6309\u7167\u751f\u4ea7\u65f6\u95f4\u987a\u5e8f\u5230\u6765\u7684\uff0c\u6240 \u4ee5\u6709\u53ef\u80fd\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff1a9 \u70b9\u751f\u4ea7\u7684\u5546\u54c1\u5df2\u7ecf\u5230\u4e86\uff0c\u6211\u4eec\u8ba4\u4e3a\u5df2\u7ecf\u5230\u4e86 9 \u70b9\uff0c\u6240\u4ee5\u76f4\u63a5\u53d1\u8f66\uff1b \u4f46\u662f\u53ef\u80fd\u8fd8\u4f1a\u6709 8 \u70b9 59 \u5206 59 \u79d2\u751f\u4ea7\u7684\u5546\u54c1\u8fdf\u5230\u4e86\uff0c\u6ca1\u6709\u8d76\u4e0a\u8fd9\u73ed\u8f66\u3002\u90a3\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f</p> <p>\u5176\u5b9e\u6211\u4eec\u6709\u5f88\u591a\u751f\u6d3b\u4e2d\u7684\u7ecf\u9a8c\u3002\u5047\u5982\u662f\u4e00\u4e2a\u56e2\u961f\u51fa\u53bb\u56e2\u5efa\uff0c\u90a3\u80af\u5b9a\u5e0c\u671b\u6bcf\u4e2a\u4eba\u90fd\u4e0d\u80fd\u843d\u4e0b\uff1b \u5982\u679c\u6709\u4eba\u56e0\u4e3a\u5835\u8f66\u6ca1\u80fd\u51c6\u65f6\u5230\u8f66\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u7a0d\u5fae\u7b49\u4e00\u4f1a\u513f\u30029 \u70b9\u53d1\u8f66\uff0c\u6211\u4eec\u53ef\u4ee5\u7b49\u5230 9 \u70b9 10 \u5206\uff0c\u7b49\u4eba\u90fd\u5230\u9f50\u4e86\u518d\u51fa\u53d1\u3002\u5f53\u7136\uff0c\u5b9e\u9645\u5e94\u7528\u7684\u7f51\u7edc\u73af\u5883\u4e0d\u53ef\u80fd\u8ddf\u5317\u4eac\u7684\u4ea4\u901a\u4e00\u6837\u5835\uff0c\u6240\u4ee5\u4e0d\u9700 \u8981\u7b49\u90a3\u4e48\u4e45\uff0c\u6216\u8bb8\u53ea\u8981\u7b49\u4e00\u4e24\u79d2\u949f\u5c31\u53ef\u4ee5\u4e86\u3002\u5177\u4f53\u5728\u5546\u54c1\u73ed\u8f66\u7684\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u591a\u7b49 2 \u79d2\u949f\uff0c \u4e5f\u5c31\u662f\u5f53\u751f\u4ea7\u65f6\u95f4\u4e3a 9 \u70b9\u96f6 2 \u79d2\u7684\u5546\u54c1\u5230\u8fbe\uff0c\u65f6\u949f\u63a8\u8fdb\u5230 9 \u70b9\u96f6 2 \u79d2\uff0c\u8fd9\u65f6\u5c31\u8ba4\u4e3a\u6240\u6709 8 \u70b9\u5230 9 \u70b9\u751f\u4ea7\u7684\u5546\u54c1\u90fd\u5230\u9f50\u4e86\uff0c\u53ef\u4ee5\u6b63\u5f0f\u53d1\u8f66\u3002\u4e0d\u8fc7\u8fd9\u6837\u76f8\u5f53\u4e8e\u66f4\u6539\u4e86\u53d1\u8f66\u65f6\u95f4\uff0c\u5c5e\u4e8e\u201c\u8fdd\u89c4\u64cd\u4f5c\u201d\u3002 \u4e3a\u4e86\u505a\u5230\u5f62\u5f0f\u4e0a\u4ecd\u7136\u662f 9 \u70b9\u53d1\u8f66\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u6539\u4e00\u4e0b\u65f6\u949f\u63a8\u8fdb\u7684\u903b\u8f91\uff1a\u5f53\u4e00\u4e2a\u5546\u54c1\u5230\u8fbe\u65f6\uff0c\u4e0d \u8981\u76f4\u63a5\u7528\u5b83\u7684\u751f\u4ea7\u65f6\u95f4\u4f5c\u4e3a\u5f53\u524d\u65f6\u95f4\uff0c\u800c\u662f\u51cf\u4e0a\u4e24\u79d2\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u628a\u8f66\u4e0a\u7684\u903b\u8f91\u65f6\u949f\u8c03\u6162\u4e86\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5f53 9 \u70b9\u751f\u4ea7\u7684\u5546\u54c1\u5230\u8fbe\u65f6\uff0c\u6211\u4eec\u5f53\u524d\u8f66\u4e0a\u7684\u65f6\u95f4\u662f 8 \u70b9 59 \u5206 58 \u79d2\uff0c\u8fd8\u6ca1\u5230\u53d1\u8f66\u65f6 \u95f4\uff1b\u5f53 9 \u70b9\u96f6 2 \u79d2\u751f\u4ea7\u7684\u5546\u54c1\u5230\u8fbe\u65f6\uff0c\u8f66\u4e0a\u65f6\u95f4\u521a\u597d\u662f 9 \u70b9\uff0c\u8fd9\u65f6\u8be5\u5230\u7684\u5546\u54c1\u90fd\u5230\u9f50\u4e86\uff0c\u51c6\u65f6 \u53d1\u8f66\u5c31\u6ca1\u95ee\u9898\u4e86\u3002</p> <p>\u56de\u5230\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u4e3a\u4e86\u8ba9\u7a97\u53e3\u80fd\u591f\u6b63\u786e\u6536\u96c6\u5230\u8fdf\u5230\u7684\u6570\u636e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7b49\u4e0a 2 \u79d2\uff1b\u4e5f\u5c31\u662f \u7528\u5f53\u524d\u5df2\u6709\u6570\u636e\u7684\u6700\u5927\u65f6\u95f4\u6233\u51cf\u53bb 2 \u79d2\uff0c\u5c31\u662f\u8981\u63d2\u5165\u7684\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\uff0c\u5982\u56fe\u6240\u793a\u3002\u8fd9 \u6837\u7684\u8bdd\uff0c9 \u79d2\u7684\u6570\u636e\u5230\u6765\u4e4b\u540e\uff0c\u4e8b\u4ef6\u65f6\u949f\u4e0d\u4f1a\u76f4\u63a5\u63a8\u8fdb\u5230 9 \u79d2\uff0c\u800c\u662f\u8fdb\u5c55\u5230\u4e86 7 \u79d2\uff1b\u5fc5\u987b\u7b49\u5230 11 \u79d2\u7684\u6570\u636e\u5230\u6765\u4e4b\u540e\uff0c\u4e8b\u4ef6\u65f6\u949f\u624d\u4f1a\u8fdb\u5c55\u5230 9 \u79d2\uff0c\u8fd9\u65f6\u8fdf\u5230\u6570\u636e\u4e5f\u90fd\u5df2\u6536\u96c6\u9f50\uff0c0~9 \u79d2\u7684\u7a97 \u53e3\u5c31\u53ef\u4ee5\u6b63\u786e\u8ba1\u7b97\u7ed3\u679c\u4e86\u3002</p> <p> </p> \u4e71\u5e8f\u6d41\u4e2d\u201c\u7b49 2 \u79d2\u201d\u7b56\u7565 <p>\u5982\u679c\u4ed4\u7ec6\u89c2\u5bdf\u5c31\u4f1a\u770b\u5230\uff0c\u8fd9\u79cd\u201c\u7b49 2 \u79d2\u201d\u7684\u7b56\u7565\u5176\u5b9e\u5e76\u4e0d\u80fd\u5904\u7406\u6240\u6709\u7684\u4e71\u5e8f\u6570\u636e\u3002\u6bd4\u5982 22 \u79d2\u7684\u6570\u636e\u5230\u6765\u4e4b\u540e\uff0c\u63d2\u5165\u7684\u6c34\u4f4d\u7ebf\u65f6\u95f4\u6233\u4e3a 20\uff0c\u4e5f\u5c31\u662f\u5f53\u524d\u65f6\u949f\u5df2\u7ecf\u63a8\u8fdb\u5230\u4e86 20 \u79d2\uff1b\u5bf9\u4e8e 10~20 \u79d2\u7684\u7a97\u53e3\uff0c\u8fd9\u65f6\u5c31\u8be5\u5173\u95ed\u4e86\u3002\u4f46\u662f\u4e4b\u540e\u53c8\u4f1a\u6709 17 \u79d2\u7684\u8fdf\u5230\u6570\u636e\u5230\u6765\uff0c\u5b83\u672c\u6765\u5e94\u8be5\u5c5e\u4e8e 10~20 \u79d2\u7a97\u53e3\uff0c\u73b0\u5728\u5374\u88ab\u9057\u6f0f\u4e22\u5f03\u4e86\u3002\u90a3\u53c8\u8be5\u600e\u4e48\u529e\u5462\uff1f</p> <p>\u65e2\u7136\u73b0\u5728\u7b49 2 \u79d2\u8fd8\u662f\u7b49\u4e0d\u5230 17 \u79d2\u4ea7\u751f\u7684\u8fdf\u5230\u6570\u636e\uff0c\u90a3\u81ea\u7136\u6211\u4eec\u53ef\u4ee5\u8bd5\u7740\u591a\u7b49\u51e0\u79d2\uff0c\u4e5f\u5c31 \u662f\u628a\u65f6\u949f\u8c03\u5f97\u66f4\u6162\u4e00\u4e9b\u3002\u6700\u7ec8\u7684\u76ee\u7684\uff0c\u5c31\u662f\u8981\u8ba9\u7a97\u53e3\u80fd\u591f\u628a\u6240\u6709\u8fdf\u5230\u6570\u636e\u90fd\u6536\u8fdb\u6765\uff0c\u5f97\u5230\u6b63\u786e \u7684\u8ba1\u7b97\u7ed3\u679c\u3002\u5bf9\u5e94\u5230\u6c34\u4f4d\u7ebf\u4e0a\uff0c\u5176\u5b9e\u5c31\u662f\u8981\u4fdd\u8bc1\uff0c\u5f53\u524d\u65f6\u95f4\u5df2\u7ecf\u8fdb\u5c55\u5230\u4e86\u8fd9\u4e2a\u65f6\u95f4\u6233\uff0c\u5728\u8fd9\u4e4b \u540e\u4e0d\u53ef\u80fd\u518d\u6709\u8fdf\u5230\u6570\u636e\u6765\u4e86\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5468\u671f\u6027\u7684\u65b9\u5f0f\u751f\u6210\u6b63\u786e\u7684\u6c34\u4f4d\u7ebf\u3002</p> <p> </p> \u4e71\u5e8f\u6d41\u4e2d\u5468\u671f\u6027\u751f\u6210\u6b63\u786e\u7684\u6c34\u4f4d\u7ebf <p>\u5982\u56fe\u6240\u793a\uff0c\u7b2c\u4e00\u4e2a\u6c34\u4f4d\u7ebf\u65f6\u95f4\u6233\u4e3a 7\uff0c\u5b83\u8868\u793a\u5f53\u524d\u4e8b\u4ef6\u65f6\u95f4\u662f 7 \u79d2\uff0c7 \u79d2\u4e4b\u524d\u7684\u6570\u636e \u90fd\u5df2\u7ecf\u5230\u9f50\uff0c\u4e4b\u540e\u518d\u4e5f\u4e0d\u4f1a\u6709\u4e86\uff1b\u540c\u6837\uff0c\u7b2c\u4e8c\u4e2a\u3001\u7b2c\u4e09\u4e2a\u6c34\u4f4d\u7ebf\u65f6\u95f4\u6233\u5206\u522b\u4e3a 12 \u548c 20\uff0c\u8868\u793a 11 \u79d2\u300120 \u79d2\u4e4b\u524d\u7684\u6570\u636e\u90fd\u5df2\u7ecf\u5230\u9f50\uff0c\u5982\u679c\u6709\u5bf9\u5e94\u7684\u7a97\u53e3\u5c31\u53ef\u4ee5\u76f4\u63a5\u5173\u95ed\u4e86\uff0c\u7edf\u8ba1\u7684\u7ed3\u679c\u4e00\u5b9a \u662f\u6b63\u786e\u7684\u3002\u8fd9\u91cc\u7531\u4e8e\u6c34\u4f4d\u7ebf\u662f\u5468\u671f\u6027\u751f\u6210\u7684\uff0c\u6240\u4ee5\u63d2\u5165\u7684\u4f4d\u7f6e\u4e0d\u4e00\u5b9a\u662f\u5728\u65f6\u95f4\u6233\u6700\u5927\u7684\u6570\u636e\u540e \u9762\u3002</p> <p>\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u4e00\u4e2a\u7a97\u53e3\u6240\u6536\u96c6\u7684\u6570\u636e\uff0c\u5e76\u4e0d\u662f\u4e4b\u524d\u6240\u6709\u5df2\u7ecf\u5230\u8fbe\u7684\u6570\u636e\u3002\u56e0\u4e3a\u6570\u636e\u5c5e\u4e8e\u54ea\u4e2a\u7a97\u53e3\uff0c\u662f\u7531\u6570\u636e\u672c\u8eab\u7684\u65f6\u95f4\u6233\u51b3\u5b9a\u7684\uff0c\u4e00\u4e2a\u7a97\u53e3\u53ea\u4f1a\u6536\u96c6\u771f\u6b63\u5c5e\u4e8e\u5b83\u7684\u90a3\u4e9b\u6570\u636e\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0a\u56fe\u4e2d\u5c3d\u7ba1\u6c34\u4f4d\u7ebf W(20)\u4e4b\u524d\u6709\u65f6\u95f4\u6233\u4e3a 22 \u7684\u6570\u636e\u5230\u6765\uff0c10~20 \u79d2\u7684\u7a97\u53e3\u4e2d\u4e5f\u4e0d\u4f1a\u6536\u96c6\u8fd9\u4e2a\u6570\u636e\uff0c\u8fdb\u884c\u8ba1\u7b97\u4f9d\u7136\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002\u5173\u4e8e\u7a97\u53e3\u7684\u539f\u7406\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u9762\u7ee7\u7eed\u5c55\u5f00\u8bb2\u89e3\u3002</p>"},{"location":"engine/flink/flink_watermark/#3","title":"3. \u6c34\u4f4d\u7ebf\u7684\u7279\u6027","text":"<p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u6c34\u4f4d\u7ebf\u5c31\u4ee3\u8868\u4e86\u5f53\u524d\u7684\u4e8b\u4ef6\u65f6\u95f4\u65f6\u949f\uff0c\u800c\u4e14\u53ef\u4ee5\u5728\u6570\u636e\u7684\u65f6\u95f4\u6233\u57fa\u7840 \u4e0a\u52a0\u4e00\u4e9b\u5ef6\u8fdf\u6765\u4fdd\u8bc1\u4e0d\u4e22\u6570\u636e\uff0c\u8fd9\u4e00\u70b9\u5bf9\u4e8e\u4e71\u5e8f\u6d41\u7684\u6b63\u786e\u5904\u7406\u975e\u5e38\u91cd\u8981\u3002 \u6211\u4eec\u53ef\u4ee5\u603b\u7ed3\u4e00\u4e0b\u6c34\u4f4d\u7ebf\u7684\u7279\u6027\uff1a</p> <ul> <li>\u6c34\u4f4d\u7ebf\u662f\u63d2\u5165\u5230\u6570\u636e\u6d41\u4e2d\u7684\u4e00\u4e2a\u6807\u8bb0\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u636e</li> <li>\u6c34\u4f4d\u7ebf\u4e3b\u8981\u7684\u5185\u5bb9\u662f\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u7528\u6765\u8868\u793a\u5f53\u524d\u4e8b\u4ef6\u65f6\u95f4\u7684\u8fdb\u5c55</li> <li>\u6c34\u4f4d\u7ebf\u662f\u57fa\u4e8e\u6570\u636e\u7684\u65f6\u95f4\u6233\u751f\u6210\u7684</li> <li>\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\u5fc5\u987b\u5355\u8c03\u9012\u589e\uff0c\u4ee5\u786e\u4fdd\u4efb\u52a1\u7684\u4e8b\u4ef6\u65f6\u95f4\u65f6\u949f\u4e00\u76f4\u5411\u524d\u63a8\u8fdb</li> <li>\u6c34\u4f4d\u7ebf\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u5ef6\u8fdf\uff0c\u6765\u4fdd\u8bc1\u6b63\u786e\u5904\u7406\u4e71\u5e8f\u6570\u636e</li> <li>\u4e00\u4e2a\u6c34\u4f4d\u7ebf Watermark(t)\uff0c\u8868\u793a\u5728\u5f53\u524d\u6d41\u4e2d\u4e8b\u4ef6\u65f6\u95f4\u5df2\u7ecf\u8fbe\u5230\u4e86\u65f6\u95f4\u6233 t, \u8fd9\u4ee3\u8868 t \u4e4b \u524d\u7684\u6240\u6709\u6570\u636e\u90fd\u5230\u9f50\u4e86\uff0c\u4e4b\u540e\u6d41\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u65f6\u95f4\u6233 t\u2019 \u2264 t \u7684\u6570\u636e</li> </ul> <p>\u6c34\u4f4d\u7ebf\u662f Flink \u6d41\u5904\u7406\u4e2d\u4fdd\u8bc1\u7ed3\u679c\u6b63\u786e\u6027\u7684\u6838\u5fc3\u673a\u5236\uff0c\u5b83\u5f80\u5f80\u4f1a\u8ddf\u7a97\u53e3\u4e00\u8d77\u914d\u5408\uff0c\u5b8c\u6210\u5bf9 \u4e71\u5e8f\u6570\u636e\u7684\u6b63\u786e\u5904\u7406\u3002\u5173\u4e8e\u8fd9\u90e8\u5206\u5185\u5bb9\uff0c\u6211\u4eec\u4f1a\u7a0d\u540e\u8fdb\u4e00\u6b65\u5c55\u5f00\u8bb2\u89e3\u3002</p>"},{"location":"engine/flink/flink_watermark/#623","title":"6.2.3 \u5982\u4f55\u751f\u6210\u6c34\u4f4d\u7ebf","text":"<p>\u4e0a\u4e00\u8282\u4e2d\u6211\u4eec\u8bb2\u5230\uff0c\u6c34\u4f4d\u7ebf\u662f\u7528\u6765\u4fdd\u8bc1\u7a97\u53e3\u5904\u7406\u7ed3\u679c\u7684\u6b63\u786e\u6027\u7684\uff0c\u5982\u679c\u4e0d\u80fd\u6b63\u786e\u5904\u7406\u6240\u6709 \u4e71\u5e8f\u6570\u636e\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u8c03\u5927\u5ef6\u8fdf\u7684\u65f6\u95f4\u3002\u90a3\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5230\u5e95\u5e94\u8be5\u600e\u6837\u751f\u6210\u6c34\u4f4d\u7ebf\u5462\uff1f\u672c\u8282\u6211 \u4eec\u5c31\u6765\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"engine/flink/flink_watermark/#1_1","title":"1. \u751f\u6210\u6c34\u4f4d\u7ebf\u7684\u603b\u4f53\u539f\u5219","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c\u5b8c\u7f8e\u7684\u6c34\u4f4d\u7ebf\u662f\u201c\u7edd\u5bf9\u6b63\u786e\u201d\u7684\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u6c34\u4f4d\u7ebf\u4e00\u65e6\u51fa\u73b0\uff0c\u5c31\u8868\u793a\u8fd9\u4e2a\u65f6 \u95f4\u4e4b\u524d\u7684\u6570\u636e\u5df2\u7ecf\u5168\u90e8\u5230\u9f50\u3001\u4e4b\u540e\u518d\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u4e86\u3002\u800c\u5b8c\u7f8e\u7684\u4e1c\u897f\u603b\u662f\u53ef\u671b\u4e0d\u53ef\u5373\uff0c\u6211\u4eec\u53ea\u80fd \u5c3d\u91cf\u53bb\u4fdd\u8bc1\u6c34\u4f4d\u7ebf\u7684\u6b63\u786e\u3002\u5982\u679c\u5bf9\u7ed3\u679c\u6b63\u786e\u6027\u8981\u6c42\u5f88\u9ad8\u3001\u60f3\u8981\u8ba9\u7a97\u53e3\u6536\u96c6\u5230\u6240\u6709\u6570\u636e\uff0c\u6211\u4eec\u8be5 \u600e\u4e48\u505a\u5462\uff1f</p> <p>\u4e00\u4e2a\u5b57\uff0c\u7b49\u3002\u7531\u4e8e\u7f51\u7edc\u4f20\u8f93\u7684\u5ef6\u8fdf\u4e0d\u786e\u5b9a\uff0c\u4e3a\u4e86\u83b7\u53d6\u6240\u6709\u8fdf\u5230\u6570\u636e\uff0c\u6211\u4eec\u53ea\u80fd\u7b49\u5f85\u66f4\u957f\u7684 \u65f6\u95f4\u3002\u4f5c\u4e3a\u7b79\u5212\u5168\u5c40\u7684\u7a0b\u5e8f\u5458\uff0c\u6211\u4eec\u5f53\u7136\u4e0d\u4f1a\u50bb\u50bb\u5730\u4e00\u76f4\u7b49\u4e0b\u53bb\u3002\u90a3\u5230\u5e95\u7b49\u591a\u4e45\u5462\uff1f\u8fd9\u5c31\u9700\u8981 \u5bf9\u76f8\u5173\u9886\u57df\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\u4e86\u3002\u6bd4\u5982\uff0c\u5982\u679c\u6211\u4eec\u77e5\u9053\u5f53\u524d\u4e1a\u52a1\u4e2d\u4e8b\u4ef6\u7684\u8fdf\u5230\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7 5 \u79d2\uff0c \u90a3\u5c31\u53ef\u4ee5\u5c06\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\u8bbe\u4e3a\u5f53\u524d\u5df2\u6709\u6570\u636e\u7684\u6700\u5927\u65f6\u95f4\u6233\u51cf\u53bb 5 \u79d2\uff0c\u76f8\u5f53\u4e8e\u8bbe\u7f6e\u4e86 5 \u79d2\u7684\u5ef6 \u8fdf\u7b49\u5f85\u3002</p> <p>\u66f4\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u6216\u8bb8\u6ca1\u90a3\u4e48\u5927\u628a\u63e1\u3002\u6bd5\u7adf\u672a\u6765\u662f\u6ca1\u6709\u4eba\u80fd\u8bf4\u5f97\u51c6\u7684\uff0c\u6211\u4eec\u600e\u4e48\u80fd\u786e\u4fe1 \u672a\u6765\u4e0d\u4f1a\u51fa\u73b0\u4e00\u4e2a\u8d85\u7ea7\u8fdf\u5230\u6570\u636e\u5462\uff1f\u6240\u4ee5\u53e6\u4e00\u79cd\u505a\u6cd5\u662f\uff0c\u53ef\u4ee5\u5355\u72ec\u521b\u5efa\u4e00\u4e2a Flink \u4f5c\u4e1a\u6765\u76d1\u63a7 \u4e8b\u4ef6\u6d41\uff0c\u5efa\u7acb\u6982\u7387\u5206\u5e03\u6216\u8005\u673a\u5668\u5b66\u4e60\u6a21\u578b\uff0c\u5b66\u4e60\u4e8b\u4ef6\u7684\u8fdf\u5230\u89c4\u5f8b\u3002\u5f97\u5230\u5206\u5e03\u89c4\u5f8b\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5 \u9009\u62e9\u7f6e\u4fe1\u533a\u95f4\u6765\u786e\u5b9a\u5ef6\u8fdf\uff0c\u4f5c\u4e3a\u6c34\u4f4d\u7ebf\u7684\u751f\u6210\u7b56\u7565\u4e86\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5f97\u5230\u6570\u636e\u7684\u8fdf\u5230\u65f6\u95f4\u670d\u4ece \u03bc=1\uff0c\u03c3=1 \u7684\u6b63\u6001\u5206\u5e03\uff0c\u90a3\u4e48\u8bbe\u7f6e\u6c34\u4f4d\u7ebf\u5ef6\u8fdf\u4e3a 3 \u79d2\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u81f3\u5c11 97.7%\u7684\u6570\u636e\u53ef\u4ee5\u6b63\u786e \u5904\u7406\u3002</p> <p>\u5982\u679c\u6211\u4eec\u5e0c\u671b\u8ba1\u7b97\u7ed3\u679c\u80fd\u66f4\u52a0\u51c6\u786e\uff0c\u90a3\u53ef\u4ee5\u5c06\u6c34\u4f4d\u7ebf\u7684\u5ef6\u8fdf\u8bbe\u7f6e\u5f97\u66f4\u9ad8\u4e00\u4e9b\uff0c\u7b49\u5f85\u7684\u65f6\u95f4 \u8d8a\u957f\uff0c\u81ea\u7136\u4e5f\u5c31\u8d8a\u4e0d\u5bb9\u6613\u6f0f\u6389\u6570\u636e\u3002\u4e0d\u8fc7\u8fd9\u6837\u505a\u7684\u4ee3\u4ef7\u662f\u5904\u7406\u7684\u5b9e\u65f6\u6027\u964d\u4f4e\u4e86\uff0c\u6211\u4eec\u53ef\u80fd\u4e3a\u6781 \u5c11\u6570\u7684\u8fdf\u5230\u6570\u636e\u589e\u52a0\u4e86\u5f88\u591a\u4e0d\u5fc5\u8981\u7684\u5ef6\u8fdf\u3002</p> <p>\u5982\u679c\u6211\u4eec\u5e0c\u671b\u5904\u7406\u5f97\u66f4\u5feb\u3001\u5b9e\u65f6\u6027\u66f4\u5f3a\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u6c34\u4f4d\u7ebf\u5ef6\u8fdf\u8bbe\u5f97\u4f4e\u4e00\u4e9b\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c \u53ef\u80fd\u5f88\u591a\u8fdf\u5230\u6570\u636e\u4f1a\u5728\u6c34\u4f4d\u7ebf\u4e4b\u540e\u624d\u5230\u8fbe\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7a97\u53e3\u9057\u6f0f\u6570\u636e\uff0c\u8ba1\u7b97\u7ed3\u679c\u4e0d\u51c6\u786e\u3002\u5bf9\u4e8e\u8fd9 \u4e9b \u201c\u6f0f\u7f51\u4e4b\u9c7c\u201d\uff0cFlink \u53e6\u5916\u63d0\u4f9b\u4e86\u7a97\u53e3\u5904\u7406\u8fdf\u5230\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u9762\u4ecb\u7ecd\u3002\u5f53\u7136\uff0c\u5982 \u679c\u6211\u4eec\u5bf9\u51c6\u786e\u6027\u5b8c\u5168\u4e0d\u8003\u8651\u3001\u4e00\u5473\u5730\u8ffd\u6c42\u5904\u7406\u901f\u5ea6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5904\u7406\u65f6\u95f4\u8bed\u4e49\uff0c\u8fd9\u5728\u7406\u8bba\u4e0a \u53ef\u4ee5\u5f97\u5230\u6700\u4f4e\u7684\u5ef6\u8fdf\u3002</p> <p>\u6240\u4ee5 Flink \u4e2d\u7684\u6c34\u4f4d\u7ebf\uff0c\u5176\u5b9e\u662f\u6d41\u5904\u7406\u4e2d\u5bf9\u4f4e\u5ef6\u8fdf\u548c\u7ed3\u679c\u6b63\u786e\u6027\u7684\u4e00\u4e2a\u6743\u8861\u673a\u5236\uff0c\u800c\u4e14\u628a \u63a7\u5236\u7684\u6743\u529b\u4ea4\u7ed9\u4e86\u7a0b\u5e8f\u5458\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u5b9a\u4e49\u6c34\u4f4d\u7ebf\u7684\u751f\u6210\u7b56\u7565\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u5177\u4f53\u4e86\u89e3 \u4e00\u4e0b\u6c34\u4f4d\u7ebf\u5728\u4ee3\u7801\u4e2d\u7684\u4f7f\u7528\u3002</p>"},{"location":"engine/flink/flink_watermark/#2-watermark-strategies","title":"2. \u6c34\u4f4d\u7ebf\u751f\u6210\u7b56\u7565\uff08Watermark Strategies\uff09","text":"<p>\u5728 Flink \u7684 DataStream API \u4e2d \uff0c \u6709 \u4e00 \u4e2a \u5355 \u72ec \u7528 \u4e8e \u751f \u6210 \u6c34 \u4f4d \u7ebf \u7684 \u65b9 \u6cd5\uff1a.assignTimestampsAndWatermarks()\uff0c\u5b83\u4e3b\u8981\u7528\u6765\u4e3a\u6d41\u4e2d\u7684\u6570\u636e\u5206\u914d\u65f6\u95f4\u6233\uff0c\u5e76\u751f\u6210\u6c34\u4f4d\u7ebf \u6765\u6307\u793a\u4e8b\u4ef6\u65f6\u95f4\uff1a</p> <pre><code>public SingleOutputStreamOperator&lt;T&gt; assignTimestampsAndWatermarks(WatermarkStrategy&lt;T&gt; watermarkStrategy)\n</code></pre> <p>\u5177\u4f53\u4f7f\u7528\u65f6\uff0c\u76f4\u63a5\u7528 DataStream \u8c03\u7528\u8be5\u65b9\u6cd5\u5373\u53ef\uff0c\u4e0e\u666e\u901a\u7684 transform \u65b9\u6cd5\u5b8c\u5168\u4e00\u6837\u3002</p> <pre><code>DataStream&lt;Event&gt; stream = env.addSource(new ClickSource());\nDataStream&lt;Event&gt; withTimestampsAndWatermarks = stream.assignTimestampsAndWatermarks(&lt;watermark strategy&gt;);\n</code></pre> <p>\u8fd9\u91cc\u8bfb\u8005\u53ef\u80fd\u6709\u7591\u60d1\uff1a\u4e0d\u662f\u8bf4\u6570\u636e\u91cc\u5df2\u7ecf\u6709\u65f6\u95f4\u6233\u4e86\u5417\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u8fd8\u8981\u201c\u5206\u914d\u201d\u5462\uff1f\u8fd9\u662f \u56e0\u4e3a\u539f\u59cb\u7684\u65f6\u95f4\u6233\u53ea\u662f\u5199\u5165\u65e5\u5fd7\u6570\u636e\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u5982\u679c\u4e0d\u63d0\u53d6\u51fa\u6765\u5e76\u660e\u786e\u628a\u5b83\u5206\u914d\u7ed9\u6570\u636e\uff0c Flink \u662f\u65e0\u6cd5\u77e5\u9053\u6570\u636e\u771f\u6b63\u4ea7\u751f\u7684\u65f6\u95f4\u7684\u3002\u5f53\u7136\uff0c\u6709\u4e9b\u65f6\u5019\u6570\u636e\u6e90\u672c\u8eab\u5c31\u63d0\u4f9b\u4e86\u65f6\u95f4\u6233\u4fe1\u606f\uff0c \u6bd4\u5982\u8bfb\u53d6 Kafka \u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece Kafka \u6570\u636e\u4e2d\u76f4\u63a5\u83b7\u53d6\u65f6\u95f4\u6233\uff0c\u800c\u4e0d\u9700\u8981\u5355\u72ec\u63d0\u53d6\u5b57\u6bb5\u5206\u914d\u4e86\u3002</p> <p>.assignTimestampsAndWatermarks() \u65b9\u6cd5\u9700\u8981\u4f20\u5165\u4e00\u4e2a WatermarkStrategy \u4f5c\u4e3a\u53c2\u6570\uff0c\u8fd9\u5c31 \u662f \u6240 \u8c13 \u7684 \u201c \u6c34 \u4f4d \u7ebf \u751f \u6210 \u7b56 \u7565 \u201d \u3002 WatermarkStrategy \u4e2d \u5305 \u542b \u4e86 \u4e00 \u4e2a \u201c \u65f6 \u95f4 \u6233 \u5206 \u914d \u5668\u201dTimestampAssigner \u548c\u4e00\u4e2a\u201c\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\u201d WatermarkGenerator\u3002</p> <pre><code>public interface WatermarkStrategy&lt;T&gt; extends TimestampAssignerSupplier&lt;T&gt;,\nWatermarkGeneratorSupplier&lt;T&gt; {\n@Override\nTimestampAssigner&lt;T&gt; createTimestampAssigner(\nTimestampAssignerSupplier.Context context);\n\n@Override\nWatermarkGenerator&lt;T&gt; createWatermarkGenerator(\nWatermarkGeneratorSupplier.Context context);\n}\n</code></pre>"},{"location":"engine/flink/flink_watermark/#3-flink","title":"3. Flink \u5185\u7f6e\u6c34\u4f4d\u7ebf\u751f\u6210\u5668","text":"<p>WatermarkStrategy \u8fd9\u4e2a\u63a5\u53e3\u662f\u4e00\u4e2a\u751f\u6210\u6c34\u4f4d\u7ebf\u7b56\u7565\u7684\u62bd\u8c61\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u7075\u6d3b\u5730\u5b9e\u73b0\u81ea\u5df1\u7684 \u9700\u6c42\uff1b\u4f46\u770b\u8d77\u6765\u6709\u4e9b\u590d\u6742\uff0c\u5982\u679c\u60f3\u8981\u81ea\u5df1\u5b9e\u73b0\u5e94\u8be5\u8fd8\u662f\u6bd4\u8f83\u9ebb\u70e6\u7684\u3002\u597d\u5728 Flink \u5145\u5206\u8003\u8651\u5230\u4e86 \u6211\u4eec\u7684\u75db\u82e6\uff0c\u63d0\u4f9b\u4e86\u5185\u7f6e\u7684\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\uff08WatermarkGenerator\uff09\uff0c\u4e0d\u4ec5\u5f00\u7bb1\u5373\u7528\u7b80\u5316\u4e86\u7f16\u7a0b\uff0c \u800c\u4e14\u4e5f\u4e3a\u6211\u4eec\u81ea\u5b9a\u4e49\u6c34\u4f4d\u7ebf\u7b56\u7565\u63d0\u4f9b\u4e86\u6a21\u677f\u3002</p> <p>\u8fd9\u4e24\u4e2a\u751f\u6210\u5668\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 WatermarkStrategy \u7684\u9759\u6001\u8f85\u52a9\u65b9\u6cd5\u6765\u521b\u5efa\u3002\u5b83\u4eec\u90fd\u662f\u5468\u671f\u6027\u751f\u6210\u6c34\u4f4d\u7ebf\u7684\uff0c\u5206\u522b\u5bf9\u5e94\u7740\u5904\u7406\u6709\u5e8f\u6d41\u548c\u4e71\u5e8f\u6d41\u7684\u573a\u666f\u3002</p> <p>\uff081\uff09\u6709\u5e8f\u6d41</p> <p>\u5bf9\u4e8e\u6709\u5e8f\u6d41\uff0c\u4e3b\u8981\u7279\u70b9\u5c31\u662f\u65f6\u95f4\u6233\u5355\u8c03\u589e\u957f\uff08Monotonously Increasing Timestamps\uff09\uff0c\u6240\u4ee5\u6c38\u8fdc\u4e0d\u4f1a\u51fa\u73b0\u8fdf\u5230\u6570\u636e\u7684\u95ee\u9898\u3002 \u8fd9\u662f\u5468\u671f\u6027\u751f\u6210\u6c34\u4f4d\u7ebf\u7684\u6700\u7b80\u5355\u7684\u573a\u666f\uff0c \u76f4\u63a5\u8c03\u7528 WatermarkStrategy.forMonotonousTimestamps()\u65b9\u6cd5\u5c31\u53ef\u4ee5\u5b9e\u73b0\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u76f4\u63a5\u62ff\u5f53\u524d\u6700 \u5927\u7684\u65f6\u95f4\u6233\u4f5c\u4e3a\u6c34\u4f4d\u7ebf\u5c31\u53ef\u4ee5\u4e86\u3002</p> <pre><code>stream.assignTimestampsAndWatermarks( WatermarkStrategy&lt;Event&gt;forMonotonousTimestamps().withTimestampAssigner(new SerializableTimestampAssigner&lt;Event&gt;(){\n\n@Override\npublic long extractTimestamp(Event element, long recordTimestamp){\nreturn element.timestamp;\n}\n}));\n</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\u6211\u4eec\u8c03\u7528.withTimestampAssigner()\u65b9\u6cd5\uff0c\u5c06\u6570\u636e\u4e2d\u7684 timestamp \u5b57\u6bb5\u63d0\u53d6\u51fa\u6765\uff0c \u4f5c\u4e3a\u65f6\u95f4\u6233\u5206\u914d\u7ed9\u6570\u636e\u5143\u7d20\uff1b\u7136\u540e\u7528\u5185\u7f6e\u7684\u6709\u5e8f\u6d41\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\u6784\u9020\u51fa\u4e86\u751f\u6210\u7b56\u7565\u3002\u8fd9\u6837\uff0c\u63d0 \u53d6\u51fa\u7684\u6570\u636e\u65f6\u95f4\u6233\uff0c\u5c31\u662f\u6211\u4eec\u5904\u7406\u8ba1\u7b97\u7684\u4e8b\u4ef6\u65f6\u95f4\u3002</p> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u65f6\u95f4\u6233\u548c\u6c34\u4f4d\u7ebf\u7684\u5355\u4f4d\uff0c\u5fc5\u987b\u90fd\u662f\u6beb\u79d2\u3002</p> <p>\uff082\uff09\u4e71\u5e8f\u6d41</p> <p>\u7531\u4e8e\u4e71\u5e8f\u6d41\u4e2d\u9700\u8981\u7b49\u5f85\u8fdf\u5230\u6570\u636e\u5230\u9f50\uff0c \u6240\u4ee5\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2a\u56fa\u5b9a\u91cf\u7684\u5ef6\u8fdf\u65f6\u95f4\uff08 Fixed Amount of Lateness\uff09\u3002\u8fd9\u65f6\u751f\u6210\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\uff0c\u5c31\u662f\u5f53\u524d\u6570\u636e\u6d41\u4e2d\u6700\u5927\u7684\u65f6\u95f4\u6233\u51cf\u53bb\u5ef6\u8fdf\u7684 \u7ed3\u679c\uff0c \u76f8\u5f53\u4e8e\u628a\u8868\u8c03\u6162\uff0c \u5f53\u524d\u65f6\u949f\u4f1a\u6ede\u540e\u4e8e\u6570\u636e\u7684\u6700\u5927\u65f6\u95f4\u6233\u3002 \u8c03\u7528 WatermarkStrategy. forBoundedOutOfOrderness()\u65b9\u6cd5\u5c31\u53ef\u4ee5\u5b9e\u73b0\u3002\u8fd9\u4e2a\u65b9\u6cd5\u9700\u8981\u4f20\u5165\u4e00\u4e2a maxOutOfOrderness \u53c2 \u6570\uff0c\u8868\u793a\u201c\u6700\u5927\u4e71\u5e8f\u7a0b\u5ea6\u201d\uff0c\u5b83\u8868\u793a\u6570\u636e\u6d41\u4e2d\u4e71\u5e8f\u6570\u636e\u65f6\u95f4\u6233\u7684\u6700\u5927\u5dee\u503c\uff1b\u5982\u679c\u6211\u4eec\u80fd\u786e\u5b9a\u4e71\u5e8f \u7a0b\u5ea6\uff0c\u90a3\u4e48\u8bbe\u7f6e\u5bf9\u5e94\u65f6\u95f4\u957f\u5ea6\u7684\u5ef6\u8fdf\uff0c\u5c31\u53ef\u4ee5\u7b49\u5230\u6240\u6709\u7684\u4e71\u5e8f\u6570\u636e\u4e86\u3002</p> <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>import org.apache.flink.api.common.eventtime.SerializableTimestampAssigner;\nimport org.apache.flink.api.common.eventtime.WatermarkStrategy;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\n\nimport java.time.Duration;\n\n\npublic class WatermarkTest {\npublic static void main(String[] args) throws Exception {\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nenv.setParallelism(1);\n\nenv.addSource(new ClickSource()).assignTimestampsAndWatermarks(// \u9488\u5bf9\u4e71\u5e8f\u6d41\u63d2\u5165\u6c34\u4f4d\u7ebf\uff0c\u5ef6\u8fdf\u65f6\u95f4\u8bbe\u7f6e\u4e3a 5s\nWatermarkStrategy.&lt;Event&gt;forBoundedOutOfOrderness(Duration.ofSeconds(5))\n.withTimestampAssigner(new SerializableTimestampAssigner&lt;Event&gt;() {\n// \u62bd\u53d6\u65f6\u95f4\u6233\u7684\u903b\u8f91\n@Override\npublic long extractTimestamp(Event element, long recordTimestamp) {\nreturn element.timestamp;\n}\n})).print();\nenv.execute();\n}\n}\n</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u540c\u6837\u63d0\u53d6\u4e86 timestamp \u5b57\u6bb5\u4f5c\u4e3a\u65f6\u95f4\u6233\uff0c\u5e76\u4e14\u4ee5 5 \u79d2\u7684\u5ef6\u8fdf\u65f6\u95f4\u521b\u5efa\u4e86 \u5904\u7406\u4e71\u5e8f\u6d41\u7684\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6709\u5e8f\u6d41\u7684\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\u672c\u8d28\u4e0a\u548c\u4e71\u5e8f\u6d41\u662f\u4e00\u6837\u7684\uff0c\u76f8\u5f53\u4e8e\u5ef6\u8fdf\u8bbe\u4e3a 0 \u7684\u4e71\u5e8f\u6d41\u6c34 \u4f4d\u7ebf\u751f\u6210\u5668\uff0c\u4e24\u8005\u5b8c\u5168\u7b49\u540c\uff1a</p> <pre><code>WatermarkStrategy.forMonotonousTimestamps()\nWatermarkStrategy.forBoundedOutOfOrderness(Duration.ofSeconds(0))\n</code></pre> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e71\u5e8f\u6d41\u4e2d\u751f\u6210\u7684\u6c34\u4f4d\u7ebf\u771f\u6b63\u7684\u65f6\u95f4\u6233\uff0c\u5176\u5b9e\u662f \u5f53\u524d\u6700\u5927\u65f6\u95f4\u6233 \u2013 \u5ef6 \u8fdf\u65f6\u95f4 \u2013 1\uff0c\u8fd9\u91cc\u7684\u5355\u4f4d\u662f\u6beb\u79d2\u3002\u4e3a\u4ec0\u4e48\u8981\u51cf 1 \u6beb\u79d2\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u56de\u60f3\u4e00\u4e0b\u6c34\u4f4d\u7ebf\u7684\u7279\u70b9\uff1a\u65f6 \u95f4\u6233\u4e3a t \u7684\u6c34\u4f4d\u7ebf\uff0c\u8868\u793a\u65f6\u95f4\u6233\u2264t \u7684\u6570\u636e\u5168\u90e8\u5230\u9f50\uff0c\u4e0d\u4f1a\u518d\u6765\u4e86\u3002\u5982\u679c\u8003\u8651\u6709\u5e8f\u6d41\uff0c\u4e5f\u5c31\u662f \u5ef6\u8fdf\u65f6\u95f4\u4e3a 0 \u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u65f6\u95f4\u6233\u4e3a 7 \u79d2\u7684\u6570\u636e\u5230\u6765\u65f6\uff0c\u4e4b\u540e\u5176\u5b9e\u662f\u8fd8\u6709\u53ef\u80fd\u7ee7\u7eed\u6765 7 \u79d2\u7684\u6570 \u636e\u7684\uff1b\u6240\u4ee5\u751f\u6210\u7684\u6c34\u4f4d\u7ebf\u4e0d\u662f 7 \u79d2\uff0c\u800c\u662f 6 \u79d2 999 \u6beb\u79d2\uff0c7 \u79d2\u7684\u6570\u636e\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u6765\u3002\u8fd9\u4e00\u70b9\u53ef \u4ee5\u5728 BoundedOutOfOrdernessWatermarks \u7684\u6e90\u7801\u4e2d\u660e\u663e\u5730\u770b\u5230\uff1a</p> <pre><code>public void onPeriodicEmit(WatermarkOutput output) {\noutput.emitWatermark(new Watermark(maxTimestamp - outOfOrdernessMillis - 1));\n}\n</code></pre>"},{"location":"engine/flink/flink_watermark/#4","title":"4. \u81ea\u5b9a\u4e49\u6c34\u4f4d\u7ebf\u7b56\u7565","text":"<p>\u4e00\u822c\u6765\u8bf4\uff0cFlink \u5185\u7f6e\u7684\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\u5c31\u53ef\u4ee5\u6ee1\u8db3\u5e94\u7528\u9700\u6c42\u4e86\u3002\u4e0d\u8fc7\u6709\u65f6\u6211\u4eec\u7684\u4e1a\u52a1\u903b\u8f91 \u53ef\u80fd\u975e\u5e38\u590d\u6742\uff0c\u8fd9\u65f6\u5bf9\u6c34\u4f4d\u7ebf\u751f\u6210\u7684\u903b\u8f91\u4e5f\u6709\u66f4\u9ad8\u7684\u8981\u6c42\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u81ea\u5b9a\u4e49\u5b9e\u73b0\u6c34\u4f4d\u7ebf\u7b56\u7565 WatermarkStrategy \u4e86\u3002</p> <p>\u5728 WatermarkStrategy \u4e2d\uff0c\u65f6\u95f4\u6233\u5206\u914d\u5668 TimestampAssigner \u90fd\u662f\u5927\u540c\u5c0f\u5f02\u7684\uff0c\u6307\u5b9a\u5b57\u6bb5\u63d0 \u53d6\u65f6\u95f4\u6233\u5c31\u53ef\u4ee5\u4e86\uff1b\u800c\u4e0d\u540c\u7b56\u7565\u7684\u5173\u952e\u5c31\u5728\u4e8e WatermarkGenerator \u7684\u5b9e\u73b0\u3002\u6574\u4f53\u8bf4\u6765\uff0cFlink \u6709\u4e24\u79cd\u4e0d\u540c\u7684\u751f\u6210\u6c34\u4f4d\u7ebf\u7684\u65b9\u5f0f\uff1a\u4e00\u79cd\u662f\u5468\u671f\u6027\u7684\uff08Periodic\uff09\uff0c\u53e6\u4e00\u79cd\u662f\u65ad\u70b9\u5f0f\u7684\uff08Punctuated\uff09\u3002</p> <p>\u8fd8\u8bb0\u5f97 WatermarkGenerator \u63a5\u53e3\u4e2d\u7684\u4e24\u4e2a\u65b9\u6cd5\u5417\uff1f\u2014\u2014onEvent()\u548c onPeriodicEmit()\uff0c\u524d \u8005\u662f\u5728\u6bcf\u4e2a\u4e8b\u4ef6\u5230\u6765\u65f6\u8c03\u7528\uff0c\u800c\u540e\u8005\u7531\u6846\u67b6\u5468\u671f\u6027\u8c03\u7528\u3002\u5468\u671f\u6027\u8c03\u7528\u7684\u65b9\u6cd5\u4e2d\u53d1\u51fa\u6c34\u4f4d\u7ebf\uff0c\u81ea \u7136\u5c31\u662f\u5468\u671f\u6027\u751f\u6210\u6c34\u4f4d\u7ebf\uff1b\u800c\u5728\u4e8b\u4ef6\u89e6\u53d1\u7684\u65b9\u6cd5\u4e2d\u53d1\u51fa\u6c34\u4f4d\u7ebf\uff0c\u81ea\u7136\u5c31\u662f\u65ad\u70b9\u5f0f\u751f\u6210\u4e86\u3002\u4e24\u79cd \u65b9\u5f0f\u7684\u4e0d\u540c\u5c31\u96c6\u4e2d\u4f53\u73b0\u5728\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u7684\u5b9e\u73b0\u4e0a\u3002</p> <p>\uff081\uff09\u5468\u671f\u6027\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\uff08Periodic Generator\uff09</p> <p>\u5468\u671f\u6027\u751f\u6210\u5668\u4e00\u822c\u662f\u901a\u8fc7 onEvent()\u89c2\u5bdf\u5224\u65ad\u8f93\u5165\u7684\u4e8b\u4ef6\uff0c\u800c\u5728 onPeriodicEmit()\u91cc\u53d1\u51fa\u6c34 \u4f4d\u7ebf\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u6bb5\u81ea\u5b9a\u4e49\u5468\u671f\u6027\u751f\u6210\u6c34\u4f4d\u7ebf\u7684\u4ee3\u7801\uff1a</p> <pre><code>import org.apache.flink.api.common.eventtime.*;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\n\n\n// \u81ea\u5b9a\u4e49\u6c34\u4f4d\u7ebf\u7684\u4ea7\u751f\npublic class CustomWatermarkTest {\npublic static void main(String[] args) throws Exception {\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nenv.setParallelism(1);\n\nenv.addSource(new ClickSource())\n.assignTimestampsAndWatermarks(new CustomWatermarkStrategy()).print();\n\nenv.execute();\n}\n\npublic static class CustomWatermarkStrategy implements WatermarkStrategy&lt;Event&gt; {\n@Override\npublic TimestampAssigner&lt;Event&gt; createTimestampAssigner(\nTimestampAssignerSupplier.Context context) {\nreturn new SerializableTimestampAssigner&lt;Event&gt;() {\n@Override\npublic long extractTimestamp(Event element,\nlong recordTimestamp) {\nreturn element.timestamp; // \u544a\u8bc9\u7a0b\u5e8f\u6570\u636e\u6e90\u91cc\u7684\u65f6\u95f4\u6233\u662f\u54ea\u4e00\u4e2a\u5b57\u6bb5\n}\n};\n}\n\n@Override\npublic WatermarkGenerator&lt;Event&gt; createWatermarkGenerator(\nWatermarkGeneratorSupplier.Context context) {\nreturn new CustomPeriodicGenerator();\n}\n}\n\npublic static class CustomPeriodicGenerator implements WatermarkGenerator&lt;Event&gt; {\nprivate Long delayTime = 5000L; // \u5ef6\u8fdf\u65f6\u95f4\nprivate Long maxTs = Long.MIN_VALUE + delayTime + 1L; // \u89c2\u5bdf\u5230\u7684\u6700\u5927\u65f6\u95f4\u6233\n\n@Override\npublic void onEvent(Event event, long eventTimestamp,\nWatermarkOutput output) {\n// \u6bcf\u6765\u4e00\u6761\u6570\u636e\u5c31\u8c03\u7528\u4e00\u6b21\nmaxTs = Math.max(event.timestamp, maxTs); // \u66f4\u65b0\u6700\u5927\u65f6\u95f4\u6233\n}\n\n@Override\npublic void onPeriodicEmit(WatermarkOutput output) {\n// \u53d1\u5c04\u6c34\u4f4d\u7ebf\uff0c\u9ed8\u8ba4 200ms \u8c03\u7528\u4e00\u6b21\noutput.emitWatermark(new Watermark(maxTs - delayTime - 1L));\n}\n}\n}\n</code></pre> <p>\u6211\u4eec\u5728 onPeriodicEmit()\u91cc\u8c03\u7528 output.emitWatermark()\uff0c\u5c31\u53ef\u4ee5\u53d1\u51fa\u6c34\u4f4d\u7ebf\u4e86\uff1b\u8fd9\u4e2a\u65b9\u6cd5 \u7531\u7cfb\u7edf\u6846\u67b6\u5468\u671f\u6027\u5730\u8c03\u7528\uff0c\u9ed8\u8ba4 200ms \u4e00\u6b21\u3002\u6240\u4ee5\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\u662f\u4f9d\u8d56\u5f53\u524d\u5df2\u6709\u6570\u636e\u7684\u6700 \u5927\u65f6\u95f4\u6233\u7684\uff08\u8fd9\u91cc\u7684\u5b9e\u73b0\u4e0e\u5185\u7f6e\u751f\u6210\u5668\u7c7b\u4f3c\uff0c\u4e5f\u662f\u51cf\u53bb\u5ef6\u8fdf\u65f6\u95f4\u518d\u51cf 1\uff09\uff0c\u4f46\u5177\u4f53\u4ec0\u4e48\u65f6\u5019\u751f \u6210\u4e0e\u6570\u636e\u65e0\u5173\u3002</p> <p>\uff082\uff09\u65ad\u70b9\u5f0f\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\uff08Punctuated Generator\uff09</p> <p>\u65ad\u70b9\u5f0f\u751f\u6210\u5668\u4f1a\u4e0d\u505c\u5730\u68c0\u6d4b onEvent()\u4e2d\u7684\u4e8b\u4ef6\uff0c\u5f53\u53d1\u73b0\u5e26\u6709\u6c34\u4f4d\u7ebf\u4fe1\u606f\u7684\u7279\u6b8a\u4e8b\u4ef6\u65f6\uff0c \u5c31\u7acb\u5373\u53d1\u51fa\u6c34\u4f4d\u7ebf\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u65ad\u70b9\u5f0f\u751f\u6210\u5668\u4e0d\u4f1a\u901a\u8fc7 onPeriodicEmit()\u53d1\u51fa\u6c34\u4f4d\u7ebf\u3002</p> <p>\u81ea\u5b9a\u4e49\u7684\u65ad\u70b9\u5f0f\u6c34\u4f4d\u7ebf\u751f\u6210\u5668\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public class CustomPunctuatedGenerator implements WatermarkGenerator&lt;Event&gt; {\n@Override\npublic void onEvent(Event r, long eventTimestamp, WatermarkOutput output) {\n// \u53ea\u6709\u5728\u9047\u5230\u7279\u5b9a\u7684 itemId \u65f6\uff0c\u624d\u53d1\u51fa\u6c34\u4f4d\u7ebf\nif (r.user.equals(\"Mary\")) {\noutput.emitWatermark(new Watermark(r.timestamp - 1));\n}\n}\n\n@Override\npublic void onPeriodicEmit(WatermarkOutput output) {\n// \u4e0d\u9700\u8981\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u56e0\u4e3a\u6211\u4eec\u5728 onEvent \u65b9\u6cd5\u4e2d\u53d1\u5c04\u4e86\u6c34\u4f4d\u7ebf\n}\n}\n</code></pre> <p>\u6211\u4eec\u5728 onEvent()\u4e2d\u5224\u65ad\u5f53\u524d\u4e8b\u4ef6\u7684 user \u5b57\u6bb5\uff0c\u53ea\u6709\u9047\u5230\u201cMary\u201d\u8fd9\u4e2a\u7279\u6b8a\u7684\u503c\u65f6\uff0c\u624d\u8c03\u7528 output.emitWatermark()\u53d1\u51fa\u6c34\u4f4d\u7ebf\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5b8c\u5168\u4f9d\u9760\u4e8b\u4ef6\u6765\u89e6\u53d1\u7684\uff0c\u6240\u4ee5\u6c34\u4f4d\u7ebf\u7684\u751f\u6210\u4e00 \u5b9a\u5728\u67d0\u4e2a\u6570\u636e\u5230\u6765\u4e4b\u540e\u3002</p>"},{"location":"engine/flink/flink_watermark/#5","title":"5. \u5728\u81ea\u5b9a\u4e49\u6570\u636e\u6e90\u4e2d\u53d1\u9001\u6c34\u4f4d\u7ebf","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u6e90\u4e2d\u62bd\u53d6\u4e8b\u4ef6\u65f6\u95f4\uff0c\u7136\u540e\u53d1\u9001\u6c34\u4f4d\u7ebf\u3002\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u81ea \u5b9a\u4e49\u6570\u636e\u6e90\u4e2d\u53d1\u9001\u4e86\u6c34\u4f4d\u7ebf\u4ee5\u540e\uff0c\u5c31\u4e0d\u80fd\u518d\u5728\u7a0b\u5e8f\u4e2d\u4f7f\u7528 assignTimestampsAndWatermarks \u65b9 \u6cd5 \u6765\u751f \u6210\u6c34 \u4f4d\u7ebf \u4e86\u3002 \u5728\u81ea \u5b9a\u4e49 \u6570\u636e \u6e90\u4e2d \u751f\u6210 \u6c34\u4f4d \u7ebf\u548c \u5728\u7a0b \u5e8f\u4e2d \u4f7f\u7528 assignTimestampsAndWatermarks \u65b9\u6cd5\u751f\u6210\u6c34\u4f4d\u7ebf\u4e8c\u8005\u53ea\u80fd\u53d6\u5176\u4e00\u3002\u793a\u4f8b\u7a0b\u5e8f\u5982\u4e0b\uff1a</p> <pre><code>import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.streaming.api.functions.source.SourceFunction;\nimport org.apache.flink.streaming.api.watermark.Watermark;\n\nimport java.util.Calendar;\nimport java.util.Random;\n\n\npublic class EmitWatermarkInSourceFunction {\npublic static void main(String[] args) throws Exception {\nStreamExecutionEnvironment env\n= StreamExecutionEnvironment.getExecutionEnvironment();\n\nenv.setParallelism(1);\n\nenv.addSource(new ClickSourceWithWatermark()).print();\n\nenv.execute();\n}\n\n// \u6cdb\u578b\u662f\u6570\u636e\u6e90\u4e2d\u7684\u7c7b\u578b\npublic static class ClickSourceWithWatermark implements SourceFunction&lt;Event&gt; {\nprivate boolean running = true;\n\n@Override\npublic void run(SourceContext&lt;Event&gt; sourceContext)\nthrows Exception {\nRandom random = new Random();\n\nString[] userArr = { \"Mary\", \"Bob\", \"Alice\" };\n\nString[] urlArr = { \"./home\", \"./cart\", \"./prod?id=1\" };\n\nwhile (running) {\nlong currTs = Calendar.getInstance().getTimeInMillis(); // \u6beb\u79d2\u65f6\u95f4\u6233\n\nString username = userArr[random.nextInt(userArr.length)];\n\nString url\n= urlArr[random.nextInt(urlArr.length)];\n\nEvent event = new Event(username, url, currTs);\n\n// \u4f7f\u7528 collectWithTimestamp \u65b9\u6cd5\u5c06\u6570\u636e\u53d1\u9001\u51fa\u53bb\uff0c\u5e76\u6307\u660e\u6570\u636e\u4e2d\u7684\u65f6\u95f4\u6233\u7684\u5b57\u6bb5\nsourceContext.collectWithTimestamp(event, event.timestamp);\n\n// \u53d1\u9001\u6c34\u4f4d\u7ebf\nsourceContext.emitWatermark(new Watermark(event.timestamp - 1L));\n\nThread.sleep(1000L);\n}\n}\n\n@Override\npublic void cancel() {\nrunning = false;\n}\n}\n}\n</code></pre> <p>\u5728\u81ea\u5b9a\u4e49\u6c34\u4f4d\u7ebf\u4e2d\u751f\u6210\u6c34\u4f4d\u7ebf\u76f8\u6bd4 assignTimestampsAndWatermarks \u65b9\u6cd5\u66f4\u52a0\u7075\u6d3b\uff0c\u53ef\u4ee5 \u4efb\u610f\u7684\u4ea7\u751f\u5468\u671f\u6027\u7684\u3001\u975e\u5468\u671f\u6027\u7684\u6c34\u4f4d\u7ebf\uff0c\u4ee5\u53ca\u6c34\u4f4d\u7ebf\u7684\u5927\u5c0f\u4e5f\u5b8c\u5168\u7531\u6211\u4eec\u81ea\u5b9a\u4e49\u3002\u6240\u4ee5\u975e\u5e38 \u9002\u5408\u7528\u6765\u7f16\u5199 Flink \u7684\u6d4b\u8bd5\u7a0b\u5e8f\uff0c\u6d4b\u8bd5 Flink \u7684\u5404\u79cd\u5404\u6837\u7684\u7279\u6027\u3002</p>"},{"location":"engine/flink/flink_watermark/#_3","title":"\u6c34\u4f4d\u7ebf\u7684\u4f20\u9012","text":"<p>\u6211\u4eec\u77e5\u9053\u6c34\u4f4d\u7ebf\u662f\u6570\u636e\u6d41\u4e2d\u63d2\u5165\u7684\u4e00\u4e2a\u6807\u8bb0\uff0c\u7528\u6765\u8868\u793a\u4e8b\u4ef6\u65f6\u95f4\u7684\u8fdb\u5c55\uff0c\u5b83\u4f1a\u968f\u7740\u6570\u636e\u4e00 \u8d77\u5728\u4efb\u52a1\u95f4\u4f20\u9012\u3002\u5982\u679c\u53ea\u662f\u76f4\u901a\u5f0f\uff08forward\uff09\u7684\u4f20\u8f93\uff0c\u90a3\u5f88\u7b80\u5355\uff0c\u6570\u636e\u548c\u6c34\u4f4d\u7ebf\u90fd\u662f\u6309\u7167\u672c \u8eab\u7684\u987a\u5e8f\u4f9d\u6b21\u4f20\u9012\u3001\u4f9d\u6b21\u5904\u7406\u7684\uff1b\u4e00\u65e6\u6c34\u4f4d\u7ebf\u5230\u8fbe\u4e86\u7b97\u5b50\u4efb\u52a1, \u90a3\u4e48\u8fd9\u4e2a\u4efb\u52a1\u5c31\u4f1a\u5c06\u5b83\u5185\u90e8\u7684 \u65f6\u949f\u8bbe\u4e3a\u8fd9\u4e2a\u6c34\u4f4d\u7ebf\u7684\u65f6\u95f4\u6233\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u201c\u4efb\u52a1\u7684\u65f6\u949f\u201d\u5176\u5b9e\u4ecd\u7136\u662f\u5404\u81ea\u4e3a\u653f\u7684\uff0c\u5e76\u6ca1\u6709\u7edf\u4e00\u7684\u65f6\u949f\u3002\u5b9e\u9645\u5e94\u7528\u4e2d\u5f80\u5f80\u4e0a \u4e0b\u6e38\u90fd\u6709\u591a\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u4e3a\u4e86\u7edf\u4e00\u63a8\u8fdb\u4e8b\u4ef6\u65f6\u95f4\u7684\u8fdb\u5c55\uff0c\u6211\u4eec\u8981\u6c42\u4e0a\u6e38\u4efb\u52a1\u5904\u7406\u5b8c\u6c34\u4f4d\u7ebf\u3001 \u65f6\u949f\u6539\u53d8\u4e4b\u540e\uff0c\u8981\u628a\u5f53\u524d\u7684\u6c34\u4f4d\u7ebf\u518d\u6b21\u53d1\u51fa\uff0c\u5e7f\u64ad\u7ed9\u6240\u6709\u7684\u4e0b\u6e38\u5b50\u4efb\u52a1\u3002\u8fd9\u6837\uff0c\u540e\u7eed\u4efb\u52a1\u5c31\u4e0d \u9700\u8981\u4f9d\u8d56\u539f\u59cb\u6570\u636e\u4e2d\u7684\u65f6\u95f4\u6233\uff08\u7ecf\u8fc7\u8f6c\u5316\u5904\u7406\u540e\uff0c\u6570\u636e\u53ef\u80fd\u5df2\u7ecf\u6539\u53d8\u4e86\uff09\uff0c\u4e5f\u53ef\u4ee5\u77e5\u9053\u5f53\u524d\u4e8b\u4ef6\u65f6\u95f4\u4e86\u3002</p> <p>\u601d\u8003</p> <p>\u53ef\u662f\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u5728\u201c\u91cd\u5206\u533a\u201d\uff08redistributing\uff09\u7684\u4f20\u8f93\u6a21\u5f0f\u4e0b\uff0c\u4e00\u4e2a\u4efb\u52a1\u6709\u53ef\u80fd\u4f1a\u6536\u5230\u6765\u81ea\u4e0d\u540c\u5206\u533a\u4e0a\u6e38\u5b50\u4efb\u52a1\u7684\u6570\u636e\u3002\u800c\u4e0d\u540c\u5206\u533a\u7684\u5b50\u4efb\u52a1\u65f6\u949f\u5e76\u4e0d\u540c\u6b65\uff0c\u6240\u4ee5\u540c\u4e00\u65f6\u523b\u53d1\u7ed9\u4e0b\u6e38\u4efb\u52a1\u7684\u6c34\u4f4d\u7ebf\u53ef\u80fd\u5e76\u4e0d\u76f8\u540c\u3002\u8fd9\u65f6\u4e0b\u6e38\u4efb\u52a1\u53c8\u8be5\u542c\u8c01\u7684\u5462\uff1f</p> <p>\u8fd9\u5c31\u8981\u56de\u5230\u6c34\u4f4d\u7ebf\u5b9a\u4e49\u7684\u672c\u8d28\u4e86\uff1a\u5b83\u8868\u793a\u7684\u662f\u201c\u5f53\u524d\u65f6\u95f4\u4e4b\u524d\u7684\u6570\u636e\uff0c\u90fd\u5df2\u7ecf\u5230\u9f50\u4e86\u201d\u3002 \u8fd9\u662f\u4e00\u79cd\u4fdd\u8bc1\uff0c\u544a\u8bc9\u4e0b\u6e38\u4efb\u52a1\u201c\u53ea\u8981\u4f60\u63a5\u5230\u8fd9\u4e2a\u6c34\u4f4d\u7ebf\uff0c\u5c31\u4ee3\u8868\u4e4b\u540e\u6211\u4e0d\u4f1a\u518d\u7ed9\u4f60\u53d1\u66f4\u65e9\u7684\u6570 \u636e\u4e86\uff0c\u4f60\u53ef\u4ee5\u653e\u5fc3\u505a\u7edf\u8ba1\u8ba1\u7b97\u800c\u4e0d\u4f1a\u9057\u6f0f\u6570\u636e\u201d\u3002\u6240\u4ee5\u5982\u679c\u4e00\u4e2a\u4efb\u52a1\u6536\u5230\u4e86\u6765\u81ea\u4e0a\u6e38\u5e76\u884c\u4efb\u52a1 \u7684\u4e0d\u540c\u7684\u6c34\u4f4d\u7ebf\uff0c\u8bf4\u660e\u4e0a\u6e38\u5404\u4e2a\u5206\u533a\u5904\u7406\u5f97\u6709\u5feb\u6709\u6162\uff0c\u8fdb\u5ea6\u5404\u4e0d\u76f8\u540c\u6bd4\u5982\u4e0a\u6e38\u6709\u4e24\u4e2a\u5e76\u884c\u5b50\u4efb \u52a1\u90fd\u53d1\u6765\u4e86\u6c34\u4f4d\u7ebf\uff0c\u4e00\u4e2a\u662f 5 \u79d2\uff0c\u4e00\u4e2a\u662f 7 \u79d2\uff1b\u8fd9\u4ee3\u8868\u7b2c\u4e00\u4e2a\u5e76\u884c\u4efb\u52a1\u5df2\u7ecf\u5904\u7406\u5b8c 5 \u79d2\u4e4b\u524d\u7684 \u6240\u6709\u6570\u636e\uff0c\u800c\u7b2c\u4e8c\u4e2a\u5e76\u884c\u4efb\u52a1\u5904\u7406\u5230\u4e86 7 \u79d2\u3002\u90a3\u8fd9\u65f6\u81ea\u5df1\u7684\u65f6\u949f\u600e\u4e48\u786e\u5b9a\u5462\uff1f\u5f53\u7136\u4e5f\u8981\u4ee5\u201c\u8fd9 \u4e4b\u524d\u7684\u6570\u636e\u5168\u90e8\u5230\u9f50\u201d\u4e3a\u6807\u51c6\u3002\u5982\u679c\u6211\u4eec\u4ee5\u8f83\u5927\u7684\u6c34\u4f4d\u7ebf 7 \u79d2\u4f5c\u4e3a\u5f53\u524d\u65f6\u95f4\uff0c\u90a3\u5c31\u8868\u793a\u201c7 \u79d2 \u524d\u7684\u6570\u636e\u90fd\u5df2\u7ecf\u5904\u7406\u5b8c\u201d\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u4e8b\u5b9e\u2014\u2014\u7b2c\u4e00\u4e2a\u4e0a\u6e38\u5206\u533a\u624d\u5904\u7406\u5230 5 \u79d2\uff0c5~7 \u79d2\u7684\u6570\u636e \u8fd8\u4f1a\u4e0d\u505c\u5730\u53d1\u6765\uff1b\u800c\u5982\u679c\u4ee5\u6700\u5c0f\u7684\u6c34\u4f4d\u7ebf 5 \u79d2\u4f5c\u4e3a\u5f53\u524d\u65f6\u949f\u5c31\u4e0d\u4f1a\u6709\u8fd9\u4e2a\u95ee\u9898\u4e86\uff0c\u56e0\u4e3a\u786e\u5b9e\u6240 \u6709\u4e0a\u6e38\u5206\u533a\u90fd\u5df2\u7ecf\u5904\u7406\u5b8c\uff0c\u4e0d\u4f1a\u518d\u53d1 5 \u79d2\u524d\u7684\u6570\u636e\u4e86\u3002\u8fd9\u8ba9\u6211\u4eec\u60f3\u5230\u201c\u6728\u6876\u539f\u7406\u201d\uff1a\u6240\u6709\u7684\u4e0a \u6e38\u5e76\u884c\u4efb\u52a1\u5c31\u50cf\u56f4\u6210\u6728\u6876\u7684\u4e00\u5757\u5757\u6728\u677f\uff0c\u5b83\u4eec\u4e2d\u6700\u77ed\u7684\u90a3\u4e00\u5757\uff0c\u51b3\u5b9a\u4e86\u6211\u4eec\u6876\u4e2d\u7684\u6c34\u4f4d\u3002</p> <p> </p> \u4efb\u52a1\u95f4\u7684\u6c34\u4f4d\u7ebf\u4f20\u9012 <p>\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u5c06\u6c34\u4f4d\u7ebf\u5728\u4efb\u52a1\u95f4\u4f20\u9012\u7684\u8fc7\u7a0b\u5b8c\u6574\u68b3\u7406\u4e00\u904d\u3002\u5982\u56fe\u6240 \u793a\uff0c\u5f53\u524d\u4efb\u52a1\u7684\u4e0a\u6e38\uff0c\u6709\u56db\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u6240\u4ee5\u4f1a\u63a5\u6536\u5230\u6765\u81ea\u56db\u4e2a\u5206\u533a\u7684\u6c34\u4f4d\u7ebf\uff1b\u800c\u4e0b\u6e38\u6709\u4e09 \u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u6240\u4ee5\u4f1a\u5411\u4e09\u4e2a\u5206\u533a\u53d1\u51fa\u6c34\u4f4d\u7ebf\u3002\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p>\uff081\uff09\u4e0a\u6e38\u5e76\u884c\u5b50\u4efb\u52a1\u53d1\u6765\u4e0d\u540c\u7684\u6c34\u4f4d\u7ebf\uff0c\u5f53\u524d\u4efb\u52a1\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u5206\u533a\u8bbe\u7f6e\u4e00\u4e2a\u201c\u5206\u533a\u6c34\u4f4d\u7ebf\u201d \uff08Partition Watermark\uff09\uff0c\u8fd9\u662f\u4e00\u4e2a\u5206\u533a\u65f6\u949f\uff1b\u800c\u5f53\u524d\u4efb\u52a1\u81ea\u5df1\u7684\u65f6\u949f\uff0c\u5c31\u662f\u6240\u6709\u5206\u533a\u65f6\u949f\u91cc\u6700 \u5c0f\u7684\u90a3\u4e2a\u3002</p> <p>\uff082\uff09\u5f53\u6709\u4e00\u4e2a\u65b0\u7684\u6c34\u4f4d\u7ebf\uff08\u7b2c\u4e00\u5206\u533a\u7684 4\uff09\u4ece\u4e0a\u6e38\u4f20\u6765\u65f6\uff0c\u5f53\u524d\u4efb\u52a1\u4f1a\u9996\u5148\u66f4\u65b0\u5bf9\u5e94\u7684\u5206 \u533a\u65f6\u949f\uff1b\u7136\u540e\u518d\u6b21\u5224\u65ad\u6240\u6709\u5206\u533a\u65f6\u949f\u4e2d\u7684\u6700\u5c0f\u503c\uff0c\u5982\u679c\u6bd4\u4e4b\u524d\u5927\uff0c\u8bf4\u660e\u4e8b\u4ef6\u65f6\u95f4\u6709\u4e86\u8fdb\u5c55\uff0c\u5f53 \u524d\u4efb\u52a1\u7684\u65f6\u949f\u4e5f\u5c31\u53ef\u4ee5\u66f4\u65b0\u4e86\u3002\u8fd9\u91cc\u8981\u6ce8\u610f\uff0c\u66f4\u65b0\u540e\u7684\u4efb\u52a1\u65f6\u949f\uff0c\u5e76\u4e0d\u4e00\u5b9a\u662f\u65b0\u6765\u7684\u90a3\u4e2a\u5206\u533a \u6c34\u4f4d\u7ebf\uff0c\u6bd4\u5982\u8fd9\u91cc\u6539\u53d8\u7684\u662f\u7b2c\u4e00\u5206\u533a\u7684\u65f6\u949f\uff0c\u4f46\u6700\u5c0f\u7684\u5206\u533a\u65f6\u949f\u662f\u7b2c\u4e09\u5206\u533a\u7684 3\uff0c\u4e8e\u662f\u5f53\u524d\u4efb \u52a1\u65f6\u949f\u5c31\u63a8\u8fdb\u5230\u4e86 3\u3002\u5f53\u65f6\u949f\u6709\u8fdb\u5c55\u65f6\uff0c\u5f53\u524d\u4efb\u52a1\u5c31\u4f1a\u5c06\u81ea\u5df1\u7684\u65f6\u949f\u4ee5\u6c34\u4f4d\u7ebf\u7684\u5f62\u5f0f\uff0c\u5e7f\u64ad\u7ed9 \u4e0b\u6e38\u6240\u6709\u5b50\u4efb\u52a1\u3002</p> <p>\uff083\uff09\u518d\u6b21\u6536\u5230\u65b0\u7684\u6c34\u4f4d\u7ebf\uff08\u7b2c\u4e8c\u5206\u533a\u7684 7\uff09\u540e\uff0c\u6267\u884c\u540c\u6837\u7684\u5904\u7406\u6d41\u7a0b\u3002\u9996\u5148\u5c06\u7b2c\u4e8c\u4e2a\u5206\u533a \u65f6\u949f\u66f4\u65b0\u4e3a 7\uff0c\u7136\u540e\u6bd4\u8f83\u6240\u6709\u5206\u533a\u65f6\u949f\uff1b\u53d1\u73b0\u6700\u5c0f\u503c\u6ca1\u6709\u53d8\u5316\uff0c\u90a3\u4e48\u5f53\u524d\u4efb\u52a1\u7684\u65f6\u949f\u4e5f\u4e0d\u53d8\uff0c\u4e5f\u4e0d\u4f1a\u5411\u4e0b\u6e38\u4efb\u52a1\u53d1\u51fa\u6c34\u4f4d\u7ebf\u3002 \uff084\uff09\u540c\u6837\u9053\u7406\uff0c\u5f53\u53c8\u4e00\u6b21\u6536\u5230\u65b0\u7684\u6c34\u4f4d\u7ebf\uff08\u7b2c\u4e09\u5206\u533a\u7684 6\uff09\u4e4b\u540e\uff0c\u7b2c\u4e09\u4e2a\u5206\u533a\u65f6\u949f\u66f4\u65b0\u4e3a 6\uff0c\u540c\u65f6\u6240\u6709\u5206\u533a\u65f6\u949f\u6700\u5c0f\u503c\u53d8\u6210\u4e86\u7b2c\u4e00\u5206\u533a\u7684 4\uff0c\u6240\u4ee5\u5f53\u524d\u4efb\u52a1\u7684\u65f6\u949f\u63a8\u8fdb\u5230 4\uff0c\u5e76\u53d1\u51fa\u65f6\u95f4 \u6233\u4e3a 4 \u7684\u6c34\u4f4d\u7ebf\uff0c\u5e7f\u64ad\u5230\u4e0b\u6e38\u5404\u4e2a\u5206\u533a\u4efb\u52a1\u3002</p> <p>\u6c34\u4f4d\u7ebf\u5728\u4e0a\u4e0b\u6e38\u4efb\u52a1\u4e4b\u95f4\u7684\u4f20\u9012\uff0c\u975e\u5e38\u5de7\u5999\u5730\u907f\u514d\u4e86\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u6ca1\u6709\u7edf\u4e00\u65f6\u949f\u7684\u95ee\u9898\uff0c \u6bcf\u4e2a\u4efb\u52a1\u90fd\u4ee5\u201c\u5904\u7406\u5b8c\u4e4b\u524d\u6240\u6709\u6570\u636e\u201d\u4e3a\u6807\u51c6\u6765\u786e\u5b9a\u81ea\u5df1\u7684\u65f6\u949f\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u7a97\u53e3\u5904\u7406\u7684\u7ed3\u679c \u603b\u662f\u6b63\u786e\u7684\u3002\u5bf9\u4e8e\u6709\u591a\u6761\u6d41\u5408\u5e76\u4e4b\u540e\u8fdb\u884c\u5904\u7406\u7684\u573a\u666f\uff0c\u6c34\u4f4d\u7ebf\u4f20\u9012\u7684\u89c4\u5219\u662f\u7c7b\u4f3c\u7684\u3002</p>"},{"location":"engine/flink/flink_watermark/#_4","title":"\u6c34\u4f4d\u7ebf\u7684\u603b\u7ed3","text":"<p>\u6c34\u4f4d\u7ebf\u5728\u4e8b\u4ef6\u65f6\u95f4\u7684\u4e16\u754c\u91cc\u9762\uff0c\u627f\u62c5\u4e86\u65f6\u949f\u7684\u89d2\u8272\u3002\u4e5f\u5c31\u662f\u8bf4\u5728\u4e8b\u4ef6\u65f6\u95f4\u7684\u6d41\u4e2d\uff0c\u6c34\u4f4d\u7ebf \u662f\u552f\u4e00\u7684\u65f6\u95f4\u5c3a\u5ea6\u3002\u5982\u679c\u60f3\u8981\u77e5\u9053\u73b0\u5728\u51e0\u70b9\uff0c\u5c31\u8981\u770b\u6c34\u4f4d\u7ebf\u7684\u5927\u5c0f\u3002\u540e\u9762\u8bb2\u5230\u7684\u7a97\u53e3\u7684\u95ed\u5408\uff0c \u4ee5\u53ca\u5b9a\u65f6\u5668\u7684\u89e6\u53d1\u90fd\u8981\u901a\u8fc7\u5224\u65ad\u6c34\u4f4d\u7ebf\u7684\u5927\u5c0f\u6765\u51b3\u5b9a\u662f\u5426\u89e6\u53d1\u3002</p> <p>\u6c34\u4f4d\u7ebf\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u4e8b\u4ef6\uff0c\u7531\u7a0b\u5e8f\u5458\u901a\u8fc7\u7f16\u7a0b\u63d2\u5165\u7684\u6570\u636e\u6d41\u91cc\u9762\uff0c\u7136\u540e\u8ddf\u968f\u6570\u636e\u6d41\u5411\u4e0b\u6e38 \u6d41\u52a8\u3002</p> <p>\u6c34\u4f4d\u7ebf\u7684\u9ed8\u8ba4\u8ba1\u7b97\u516c\u5f0f\uff1a\u6c34\u4f4d\u7ebf = \u89c2\u5bdf\u5230\u7684\u6700\u5927\u4e8b\u4ef6\u65f6\u95f4 \u2013 \u6700\u5927\u5ef6\u8fdf\u65f6\u95f4 \u2013 1 \u6beb\u79d2\u3002</p> <p>\u6240\u4ee5\u8fd9\u91cc\u6d89\u53ca\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u4e0d\u540c\u7684\u7b97\u5b50\u770b\u5230\u7684\u6c34\u4f4d\u7ebf\u7684\u5927\u5c0f\u53ef\u80fd\u662f\u4e0d\u4e00\u6837\u7684\u3002\u56e0\u4e3a\u4e0b\u6e38\u7684\u7b97\u5b50\u53ef\u80fd\u5e76\u672a\u63a5\u6536\u5230\u6765\u81ea\u4e0a\u6e38\u7b97\u5b50\u7684\u6c34\u4f4d\u7ebf\uff0c\u5bfc\u81f4\u4e0b\u6e38\u7b97\u5b50\u7684\u65f6\u949f\u8981\u843d\u540e\u4e8e\u4e0a\u6e38\u7b97\u5b50\u7684\u65f6\u949f\u3002\u6bd4\u5982 map-&gt;reduce \u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u5728 map \u4e2d\u7f16\u5199\u4e86\u975e\u5e38\u8017\u65f6\u95f4\u7684\u4ee3\u7801\uff0c\u5c06\u4f1a\u963b\u585e\u6c34\u4f4d\u7ebf\u7684\u5411\u4e0b\u4f20\u64ad\uff0c\u56e0\u4e3a\u6c34\u4f4d\u7ebf\u4e5f\u662f\u6570\u636e\u6d41\u4e2d\u7684\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u4f4d\u4e8e\u6c34\u4f4d\u7ebf\u524d\u9762\u7684\u6570\u636e\u5982\u679c\u6ca1\u6709\u5904\u7406\u5b8c\u6bd5\uff0c\u90a3\u4e48\u6c34\u4f4d\u7ebf\u4e0d\u53ef\u80fd\u5f2f\u9053\u8d85\u8f66\u7ed5\u8fc7\u524d\u9762\u7684\u6570\u636e\u5411\u4e0b\u6e38\u4f20\u64ad\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f1a\u88ab\u524d\u9762\u7684\u6570\u636e\u963b\u585e\u3002 \u8fd9\u6837\u5c31\u4f1a\u5f71\u54cd\u5230\u4e0b\u6e38\u7b97\u5b50\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u56e0\u4e3a\u4e0b\u6e38\u7b97\u5b50\u4e2d\u65e0\u8bba\u7531\u7a97\u53e3\u805a\u5408\u8fd8\u662f\u5b9a\u65f6\u5668\u7684\u64cd\u4f5c\uff0c\u90fd\u9700\u8981\u6c34\u4f4d\u7ebf\u624d\u80fd\u89e6\u53d1\u6267\u884c\u3002\u8fd9\u4e5f\u5c31\u544a\u8bc9\u4e86\u6211\u4eec\uff0c\u5728\u7f16\u5199 Flink \u7a0b\u5e8f\u65f6\uff0c\u4e00\u5b9a\u8981\u8c28\u614e\u7684\u7f16\u5199\u6bcf\u4e00\u4e2a\u7b97\u5b50\u7684\u8ba1\u7b97\u903b\u8f91\uff0c\u5c3d\u91cf\u907f\u514d\u5927\u91cf\u8ba1\u7b97\u6216\u8005\u662f\u5927\u91cf\u7684 IO \u64cd\u4f5c\uff0c\u8fd9\u6837\u624d\u4e0d\u4f1a\u963b\u585e\u6c34\u4f4d\u7ebf\u7684\u5411\u4e0b \u4f20\u9012\u3002</p> <p>\u5728\u6570\u636e\u6d41\u5f00\u59cb\u4e4b\u524d\uff0cFlink \u4f1a\u63d2\u5165\u4e00\u4e2a\u5927\u5c0f\u662f\u8d1f\u65e0\u7a77\u5927\uff08\u5728 Java \u4e2d\u662f-Long.MAX_VALUE\uff09 \u7684\u6c34\u4f4d\u7ebf\uff0c\u800c\u5728\u6570\u636e\u6d41\u7ed3\u675f\u65f6\uff0cFlink \u4f1a\u63d2\u5165\u4e00\u4e2a\u6b63\u65e0\u7a77\u5927(Long.MAX_VALUE)\u7684\u6c34\u4f4d\u7ebf\uff0c\u4fdd \u8bc1\u6240\u6709\u7684\u7a97\u53e3\u95ed\u5408\u4ee5\u53ca\u6240\u6709\u7684\u5b9a\u65f6\u5668\u90fd\u88ab\u89e6\u53d1\u3002</p> <p>\u5bf9\u4e8e\u79bb\u7ebf\u6570\u636e\u96c6\uff0cFlink \u4e5f\u4f1a\u5c06\u5176\u4f5c\u4e3a\u6d41\u8bfb\u5165\uff0c\u4e5f\u5c31\u662f\u4e00\u6761\u6570\u636e\u4e00\u6761\u6570\u636e\u7684\u8bfb\u53d6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cFlink \u5bf9\u4e8e\u79bb\u7ebf\u6570\u636e\u96c6\uff0c\u53ea\u4f1a\u63d2\u5165\u4e24\u6b21\u6c34\u4f4d\u7ebf\uff0c\u4e5f\u5c31\u662f\u5728\u6700\u5f00\u59cb\u5904\u63d2\u5165\u8d1f\u65e0\u7a77\u5927\u7684\u6c34\u4f4d\u7ebf\uff0c\u5728\u7ed3\u675f\u4f4d\u7f6e\u63d2\u5165\u4e00\u4e2a\u6b63\u65e0\u7a77\u5927\u7684\u6c34\u4f4d\u7ebf\u3002\u56e0\u4e3a\u53ea\u9700\u8981\u63d2\u5165\u4e24\u6b21\u6c34\u4f4d\u7ebf\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u8ba1\u7b97 \u7684\u6b63\u786e\uff0c\u65e0\u9700\u5728\u6570\u636e\u6d41\u7684\u4e2d\u95f4\u63d2\u5165\u6c34\u4f4d\u7ebf\u4e86\u3002</p> <p>\u6c34\u4f4d\u7ebf\u7684\u91cd\u8981\u6027\u5728\u4e8e\u5b83\u7684\u903b\u8f91\u65f6\u949f\u7279\u6027\uff0c\u800c\u903b\u8f91\u65f6\u949f\u8fd9\u4e2a\u6982\u5ff5\u53ef\u4ee5\u8bf4\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u91cc\u9762\u6700\u4e3a\u91cd\u8981\u7684\u6982\u5ff5\u4e4b\u4e00\u4e86\uff0c\u7406\u89e3\u900f\u5f7b\u4e86\u5bf9\u7406\u89e3\u5404\u79cd\u5206\u5e03\u5f0f\u7cfb\u7edf\u975e\u5e38\u6709\u5e2e\u52a9\u3002\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 Leslie Lamport \u7684\u8bba\u6587\u3002</p>"},{"location":"engine/hive/hive_01/","title":"\u7b2c1\u7ae0 Hive\u5165\u95e8","text":""},{"location":"engine/hive/hive_01/#11-hive","title":"1.1 \u4ec0\u4e48\u662fHive","text":""},{"location":"engine/hive/hive_01/#1hive","title":"1\uff09Hive \u7b80\u4ecb","text":"<p>Hive \u662f\u7531 Facebook \u5f00\u6e90\uff0c\u57fa\u4e8e Hadoop \u7684\u4e00\u4e2a\u6570\u636e\u4ed3\u5e93\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06\u7ed3\u6784\u5316\u7684\u6570\u636e\u6587\u4ef6\u6620\u5c04\u4e3a\u4e00\u5f20\u8868\uff0c\u5e76\u63d0\u4f9b\u7c7b SQL  \u67e5\u8be2\u529f\u80fd\u3002</p> <p>Question</p> <p>\u90a3\u4e3a\u4ec0\u4e48\u4f1a\u6709 Hive \u5462\uff1f\u5b83\u662f\u4e3a\u4e86\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\u800c\u8bde\u751f\u7684\u5462\uff1f</p> <p>\u4e0b\u9762\u901a\u8fc7\u4e00\u4e2a\u6848\u4f8b\uff0c\u6765\u5feb\u901f\u4e86\u89e3\u4e00\u4e0b Hive\u3002</p> <p>\u4f8b\u5982\uff1a\u9700\u6c42\uff0c\u7edf\u8ba1\u5355\u8bcd\u51fa\u73b0\u4e2a\u6570\u3002</p> <p>\uff081\uff09\u5728 Hadoop \u8bfe\u7a0b\u4e2d\u6211\u4eec\u7528 MapReduce \u7a0b\u5e8f\u5b9e\u73b0\u7684\uff0c\u5f53\u65f6\u9700\u8981\u5199 Mapper\u3001Reducer \u548c Driver \u4e09\u4e2a\u7c7b\uff0c\u5e76\u5b9e\u73b0\u5bf9\u5e94\u903b\u8f91\uff0c\u76f8\u5bf9\u7e41\u7410\u3002</p> <pre><code>test\u8868\nid\u5217\n\natguigu\natguigu\nss\nss\njiao\nbanzhang\nxue\nhadoop\n</code></pre> <p>\uff082\uff09\u5982\u679c\u901a\u8fc7 Hive SQL \u5b9e\u73b0\uff0c\u4e00\u884c\u5c31\u641e\u5b9a\u4e86\uff0c\u7b80\u5355\u65b9\u4fbf\uff0c\u5bb9\u6613\u7406\u89e3\u3002</p> <pre><code>select count(*) from test group by id;\n</code></pre>"},{"location":"engine/hive/hive_01/#2hive","title":"2\uff09Hive \u672c\u8d28","text":"<p>Hive \u662f\u4e00\u4e2a Hadoop \u5ba2\u6237\u7aef\uff0c\u7528\u4e8e\u5c06 HQL\uff08Hive SQL\uff09\u8f6c\u5316\u6210 MapReduce \u7a0b\u5e8f\u3002</p> <p>\uff081\uff09Hive \u5904\u7406\u7684\u6570\u636e\u5b58\u50a8\u5728 HDFS</p> <p>\uff082\uff09Hive \u5206\u6790\u6570\u636e\u5e95\u5c42\u7684\u5b9e\u73b0\u662f MapReduce\uff08\u4e5f\u53ef\u914d\u7f6e\u4e3a Spark \u6216\u8005 Tez\uff09 </p> <p>\uff083\uff09\u6267\u884c\u7a0b\u5e8f\u8fd0\u884c\u5728 Yarn \u4e0a</p>"},{"location":"engine/hive/hive_01/#12-hive","title":"1.2 Hive\u67b6\u6784\u539f\u7406","text":"<p>1\uff09\u7528\u6237\u63a5\u53e3\uff1aClient</p> <p>CLI\uff08 command-line interface \uff09\u3001JDBC / ODBC\u3002</p> <p>\u8bf4\u660e</p> <p>JDBC \u548c ODBC \u7684\u533a\u522b</p> <pre><code>\uff081\uff09JDBC \u7684\u79fb\u690d\u6027\u6bd4 ODBC \u597d\uff1b\uff08\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b89\u88c5\u5b8c ODBC \u9a71\u52a8\u7a0b\u5e8f\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u7ecf\u8fc7\u786e\u5b9a\u7684\u914d\u7f6e\u624d\u80fd\u591f\u5e94\u7528\u3002\u800c\u4e0d\u76f8\u540c\u7684\u914d\u7f6e\u5728\u4e0d\u76f8\u540c\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e4b\u95f4\u4e0d\u80fd\u591f\u901a\u7528\u3002\u6240\u4ee5\uff0c\u5b89\u88c5\u4e00\u6b21\u5c31\u9700\u8981\u518d\u914d\u7f6e\u4e00\u6b21\u3002JDBC \u53ea\u9700\u8981\u9009\u53d6\u9002\u5f53\u7684 JDBC \u6570\u636e\u5e93\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5c31\u4e0d\u9700\u8981\u989d\u5916\u7684\u914d\u7f6e\u3002\u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\uff0cJDBC \u6570\u636e\u5e93\u9a71\u52a8\u7a0b\u5e8f\u4f1a\u81ea\u5df1\u5b8c\u6210\u6709\u5173\u7684\u914d\u7f6e\u3002\uff09\n\n\uff082\uff09\u4e24\u8005\u4f7f\u7528\u7684\u8bed\u8a00\u4e0d\u540c\uff0cJDBC \u5728 Java \u7f16\u7a0b\u65f6\u4f7f\u7528\uff0cODBC \u4e00\u822c\u5728 C / C++ \u7f16\u7a0b\u65f6\u4f7f\u7528\u3002\n</code></pre> <p>2\uff09\u5143\u6570\u636e\uff1aMetastore</p> <p>\u5143\u6570\u636e\u5305\u62ec\uff1a\u6570\u636e\u5e93\uff08\u9ed8\u8ba4\u662f default \uff09\u3001\u8868\u540d\u3001\u8868\u7684\u62e5\u6709\u8005\u3001\u5217/\u5206\u533a\u5b57\u6bb5\u3001\u8868\u7684\u7c7b\u578b\uff08\u662f\u5426\u662f\u5916\u90e8\u8868\uff09\u3001\u8868\u7684\u6570\u636e\u6240\u5728\u76ee\u5f55\u7b49\u3002</p> <p>\u9ed8\u8ba4\u5b58\u50a8\u5728\u81ea\u5e26\u7684 derby \u6570\u636e\u5e93\u4e2d\uff0c\u7531\u4e8e derby \u6570\u636e\u5e93\u53ea\u652f\u6301\u5355\u5ba2\u6237\u7aef\u8bbf\u95ee\uff0c\u751f\u4ea7\u73af\u5883\u4e2d\u4e3a\u4e86\u591a\u4eba\u5f00\u53d1\uff0c\u63a8\u8350\u4f7f\u7528 MySQL \u5b58\u50a8 Metastore\u3002</p> <p>3\uff09\u9a71\u52a8\u5668\uff1aDriver</p> <ul> <li> <p>\u89e3\u6790\u5668\uff08SQLParser\uff09\uff1a\u5c06 SQL \u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u62bd\u8c61\u8bed\u6cd5\u6811\uff08 AST \uff09</p> </li> <li> <p>\u903b\u8f91\u8ba1\u5212\u751f\u6210\u5668\uff08 Logical Plan Gen \uff09\uff1a\u5c06\u8bed\u6cd5\u6811\u751f\u6210\u903b\u8f91\u8ba1\u5212</p> </li> <li> <p>\u903b\u8f91\u4f18\u5316\u5668\uff08 Logical Optimizer \uff09\uff1a\u5bf9\u903b\u8f91\u8ba1\u5212\u8fdb\u884c\u4f18\u5316</p> </li> <li>\u7269\u7406\u8ba1\u5212\u751f\u6210\u5668\uff08 Physical Plan Gen \uff09\uff1a\u6839\u636e\u4f18\u5316\u540e\u7684\u903b\u8f91\u8ba1\u5212\u751f\u6210\u7269\u7406\u8ba1\u5212</li> <li>\u7269\u7406\u4f18\u5316\u5668\uff08 Physical Optimizer \uff09\uff1a\u5bf9\u7269\u7406\u8ba1\u5212\u8fdb\u884c\u4f18\u5316</li> <li>\u6267\u884c\u5668\uff08 Execution \uff09\uff1a\u6267\u884c\u8be5\u8ba1\u5212\uff0c\u5f97\u5230\u67e5\u8be2\u7ed3\u679c\u5e76\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef</li> </ul> <p> </p> \u62bd\u8c61\u8bed\u6cd5\u6811 <p> </p> \u903b\u8f91\u6267\u884c\u8ba1\u5212\u548c\u7269\u7406\u6267\u884c\u8ba1\u5212 <p>4\uff09Hadoop</p> <p>\u4f7f\u7528 HDFS \u8fdb\u884c\u5b58\u50a8\uff0c\u53ef\u4ee5\u9009\u62e9 MapReduce / Tez / Spark \u8fdb\u884c\u8ba1\u7b97\u3002</p>"},{"location":"engine/hive/hive_01/#13-hive","title":"1.3 Hive\u7684\u4f18\u7f3a\u70b9","text":"<p>1\uff09\u4f18\u70b9</p> <p>\uff081\uff09\u64cd\u4f5c\u63a5\u53e3\u91c7\u7528\u7c7b SQL \u8bed\u6cd5\uff0c\u63d0\u4f9b\u5feb\u901f\u5f00\u53d1\u7684\u80fd\u529b\uff08\u7b80\u5355\u3001\u5bb9\u6613\u4e0a\u624b\uff09\u3002</p> <p>\uff082\uff09\u907f\u514d\u4e86\u53bb\u5199 MapReduce\uff0c\u51cf\u5c11\u5f00\u53d1\u4eba\u5458\u7684\u5b66\u4e60\u6210\u672c\u3002</p> <p>2\uff09\u7f3a\u70b9</p> <p>\uff081\uff09Hive \u7684\u6267\u884c\u5ef6\u8fdf\u6bd4\u8f83\u9ad8\uff0c\u56e0\u6b64 Hive \u5e38\u7528\u4e8e\u6570\u636e\u5206\u6790\uff0c\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u5408\u3002</p> <p>\uff082\uff09Hive \u5206\u6790\u7684\u6570\u636e\u662f\u5b58\u50a8\u5728 HDFS \u4e0a\uff0cHDFS \u4e0d\u652f\u6301\u968f\u673a\u5199\uff0c\u53ea\u652f\u6301\u8ffd\u52a0\u5199\uff0c\u6240\u4ee5\u5728 Hive \u4e2d\u4e0d\u80fd\u9ad8\u6548 update \u548c delete\u3002</p>"},{"location":"engine/hive/hive_01/#14-hive","title":"1.4 Hive\u548c\u6570\u636e\u5e93\u6bd4\u8f83","text":"\u5bf9\u6bd4\u9879 Hive MySQL \u6570\u636e\u89c4\u6a21 \u5927\u6570\u636e pb \u53ca\u4ee5\u4e0a \u6570\u636e\u91cf\u5c0f\u4e00\u822c\u767e\u4e07\u5de6\u53f3\u5230\u8fbe\u5355\u8868\u6781\u9650 \u6570\u636e\u5b58\u50a8 HDFS \u62e5\u6709\u81ea\u5df1\u7684\u5b58\u50a8\u5f15\u64ce \u8ba1\u7b97\u5f15\u64ce MapReduce / Spark / Tez \u81ea\u5df1\u7684\u5f15\u64ce InnoDB \u6267\u884c\u5ef6\u8fdf \u9ad8 \u4f4e <p>\u7efc\u4e0a\u80fd\u53d1\u73b0\uff0cHive \u538b\u6839\u4e0d\u662f\u6570\u636e\u5e93\uff0cHive \u9664\u4e86\u8bed\u8a00\u7c7b\u4f3c\u4ee5\u5916\uff0c\u5b58\u50a8\u548c\u8ba1\u7b97\u90fd\u662f\u7528\u7684 Hadoop \u7684\uff0c\u4f46\u662f MySQL \u5374\u7528\u7684\u662f\u81ea\u5df1\u7684\uff0c\u62e5\u6709\u81ea\u5df1\u7684\u4f53\u7cfb\u3002</p>"},{"location":"engine/hive/hive_02/","title":"\u7b2c2\u7ae0 Hive\u5b89\u88c5","text":""},{"location":"engine/hive/hive_02/#21-hive","title":"2.1 Hive\u5b89\u88c5\u5730\u5740","text":"<p>1\uff09Hive \u5b98\u7f51</p> <p>2\uff09\u6587\u6863</p> <p>3\uff09\u4e0b\u8f7d</p> <p>4\uff09Github \u4ed3\u5e93</p>"},{"location":"engine/hive/hive_02/#22-hive","title":"2.2 Hive\u5b89\u88c5\u90e8\u7f72","text":""},{"location":"engine/hive/hive_02/#221-hive","title":"2.2.1 \u5b89\u88c5Hive","text":"<p>1\uff09\u628a apache-hive-3.1.3-bin.tar.gz \u4e0a\u4f20\u5230 Linux \u7684 /opt/software \u76ee\u5f55\u4e0b</p> <p>2\uff09\u89e3\u538b apache-hive-3.1.3-bin.tar.gz \u5230 /opt/module/ \u76ee\u5f55\u4e0b\u9762</p> <pre><code>tar -zxvf /opt/software/apache-hive-3.1.3-bin.tar.gz -C /opt/module/\n</code></pre> <p>3\uff09\u4fee\u6539 apache-hive-3.1.3-bin.tar.gz \u7684\u540d\u79f0\u4e3a hive</p> <pre><code>mv /opt/module/apache-hive-3.1.3-bin/ /opt/module/hive\n</code></pre> <p>4\uff09\u4fee\u6539 /etc/profile.d/my_env.sh\uff0c\u6dfb\u52a0\u73af\u5883\u53d8\u91cf</p> <pre><code>sudo vim /etc/profile.d/my_env.sh\n</code></pre> <p>\uff081\uff09\u6dfb\u52a0\u5185\u5bb9</p> env.sh<pre><code>#HIVE_HOME\nexport HIVE_HOME=/opt/module/hive\nexport PATH=$PATH:$HIVE_HOME/bin\n</code></pre> <p>\uff082\uff09source \u4e00\u4e0b</p> <pre><code>source /etc/profile.d/my_env.sh\n</code></pre> <p>5\uff09\u521d\u59cb\u5316\u5143\u6570\u636e\u5e93\uff08\u9ed8\u8ba4\u662f derby \u6570\u636e\u5e93\uff09</p> <pre><code>bin/schematool -dbType derby -initSchema\n</code></pre>"},{"location":"engine/hive/hive_02/#222-hive","title":"2.2.2 \u542f\u52a8\u5e76\u4f7f\u7528Hive","text":"<p>1\uff09\u542f\u52a8 Hive</p> <pre><code>bin/hive\n</code></pre> <p>2\uff09\u4f7f\u7528 Hive</p> <pre><code>show databases;\nshow tables;\ncreate table stu(id int, name string);\ninsert into stu values(1,\"ss\");\nselect * from stu;\n</code></pre> <p>\u89c2\u5bdf HDFS \u7684\u8def\u5f84 /user/hive/warehouse/stu\uff0c\u4f53\u4f1a Hive \u4e0e Hadoop \u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p> <p>Hive \u4e2d\u7684\u8868\u5728 Hadoop \u4e2d\u662f\u76ee\u5f55\uff1bHive \u4e2d\u7684\u6570\u636e\u5728 Hadoop \u4e2d\u662f\u6587\u4ef6\u3002</p> <p></p> <p>3\uff09\u5728 Xshell \u7a97\u53e3\u4e2d\u5f00\u542f\u53e6\u4e00\u4e2a\u7a97\u53e3\u5f00\u542f Hive\uff0c\u5728 /tmp/atguigu \u76ee\u5f55\u4e0b\u76d1\u63a7 hive.log \u6587\u4ef6</p> <pre><code>$ tail -f hive.log\n\n\nCaused by: ERROR XSDB6: Another instance of Derby may have already booted the database /opt/module/hive/metastore_db.\n        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.privGetJBMSLockOnDB(Unknown Source)\n        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.run(Unknown Source)\n...\n</code></pre> <p>Info</p> <p>\u539f\u56e0\u5728\u4e8e Hive \u9ed8\u8ba4\u4f7f\u7528\u7684\u5143\u6570\u636e\u5e93\u4e3a derby\u3002derby \u6570\u636e\u5e93\u7684\u7279\u70b9\u662f\u540c\u4e00\u65f6\u95f4\u53ea\u5141\u8bb8\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bbf\u95ee\u3002\u5982\u679c\u591a\u4e2a Hive \u5ba2\u6237\u7aef\u540c\u65f6\u8bbf\u95ee\uff0c\u5c31\u4f1a\u62a5\u9519\u3002\u7531\u4e8e\u5728\u4f01\u4e1a\u5f00\u53d1\u4e2d\uff0c\u90fd\u662f\u591a\u4eba\u534f\u4f5c\u5f00\u53d1\uff0c\u9700\u8981\u591a\u5ba2\u6237\u7aef\u540c\u65f6\u8bbf\u95ee Hive\uff0c\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u5c06 Hive \u7684\u5143\u6570\u636e\u6539\u4e3a\u7528 MySQL \u5b58\u50a8\uff0cMySQL \u652f\u6301\u591a\u5ba2\u6237\u7aef\u540c\u65f6\u8bbf\u95ee\u3002</p> <p></p> <p>4\uff09\u9996\u5148\u9000\u51fa Hive \u5ba2\u6237\u7aef\u3002\u7136\u540e\u5728 Hive \u7684\u5b89\u88c5\u76ee\u5f55\u4e0b\u5c06 derby.log \u548c metastore_db \u5220\u9664\uff0c\u987a\u4fbf\u5c06 HDFS \u4e0a\u76ee\u5f55\u5220\u9664</p> <pre><code>rm -rf derby.log metastore_db\nhadoop fs -rm -r /user\n</code></pre> <p>5\uff09\u5220\u9664 HDFS \u4e2d /user/hive/warehouse/stu \u4e2d\u6570\u636e</p> <p></p> <p></p>"},{"location":"engine/hive/hive_02/#23-mysql","title":"2.3 MySQL\u5b89\u88c5","text":""},{"location":"engine/hive/hive_02/#231","title":"2.3.1 \u5b89\u88c5\u51c6\u5907","text":"<p>1\uff09\u5982\u679c\u662f\u865a\u62df\u673a\u670d\u52a1\u5668\uff0c\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u51c6\u5907 MySQL \u5b89\u88c5\u524d\u73af\u5883</p> <p>\uff081\uff09\u5378\u8f7d\u81ea\u5e26\u7684 mariadb \u4ee5\u53ca\u5982\u679c\u4e4b\u524d\u5b89\u88c5\u8fc7 MySQL\uff0c\u9700\u8981\u5168\u90fd\u5378\u8f7d\u6389</p> <p>\u2460\u5148\u67e5\u770b\u662f\u5426\u5b89\u88c5\u8fc7 MySQL \u6216\u8005 mariadb</p> <pre><code>rpm -qa | grep -i -E mysql\\|mariadb\n</code></pre> <p>\u2461\u51fa\u73b0\u4ee5\u4e0a\u4efb\u4f55\u4e00\u4e2a\u90fd\u9700\u8981\u5378\u8f7d\uff08\u4e4b\u524d\u5b89\u88c5 MYSQL \u7248\u672c\u4e0d\u540c\u5185\u5bb9\u4e5f\u53ef\u80fd\u4e0d\u540c\uff09</p> <pre><code>rpm -qa | grep -i -E mysql\\|mariadb | xargs -n1 sudo rpm -e --nodeps\n</code></pre> <p>\uff082\uff09\u5982\u679c\u4e4b\u524d\u5b89\u88c5\u8fc7 MySQL \u9700\u8981\u6e05\u7a7a\u539f\u5148\u7684\u6240\u6709\u6570\u636e</p> <p>\u2460\u901a\u8fc7 /etc/my.cnf \u67e5\u770b MySQL \u6570\u636e\u7684\u5b58\u50a8\u4f4d\u7f6e</p> <pre><code>sudo cat /etc/my.cnf\n</code></pre> <p>\u2461\u53bb\u5f80 /var/lib/mysql \u4ee5\u4e0b\u5f97\u62ff root \u6743\u9650</p> <pre><code>su - root\ncd /var/lib/mysql\nrm -rf * </code></pre> <p>2\uff09\u5982\u679c\u662f\u963f\u91cc\u4e91\u670d\u52a1\u5668\uff0c\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u51c6\u5907 MySQL \u5b89\u88c5\u524d\u73af\u5883</p> <p>\u8bf4\u660e</p> <p>\u7531\u4e8e\u963f\u91cc\u4e91\u670d\u52a1\u5668\u5b89\u88c5\u7684\u662f Linux \u6700\u5c0f\u7cfb\u7edf\u7248\uff0c\u6ca1\u6709\u5982\u4e0b\u5de5\u5177\uff0c\u6240\u4ee5\u9700\u8981\u5b89\u88c5\u3002</p> <p>\uff081\uff09\u5378\u8f7d MySQL \u4f9d\u8d56\uff0c\u867d\u7136\u673a\u5668\u4e0a\u6ca1\u6709\u88c5 MySQL\uff0c\u4f46\u662f\u8fd9\u4e00\u6b65\u4e0d\u53ef\u5c11</p> <pre><code>sudo yum remove mysql-libs\n</code></pre> <p>\uff082\uff09\u4e0b\u8f7d\u4f9d\u8d56\u5e76\u5b89\u88c5</p> <pre><code>sudo yum install libaio\nsudo yum -y install autoconf\n</code></pre>"},{"location":"engine/hive/hive_02/#232-mysql","title":"2.3.2 \u5b89\u88c5MySQL","text":"<p>1\uff09\u4e0a\u4f20 MySQL \u5b89\u88c5\u5305\u4ee5\u53ca MySQL \u9a71\u52a8jar\u5305</p> <pre><code>mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar\nmysql-connector-java-5.1.37.jar\n</code></pre> <p>2\uff09\u89e3\u538b MySQL \u5b89\u88c5\u5305</p> <pre><code>mkdir mysql_lib\ntar -xf mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar -C mysql_lib/\n</code></pre> <p>3\uff09\u5b89\u88c5 MySQL \u4f9d\u8d56</p> <pre><code>cd mysql_lib\nsudo rpm -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpm\nsudo rpm -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpm\nsudo rpm -ivh mysql-community-libs-compat-5.7.28-1.el7.x86_64.rpm\n</code></pre> <p>4\uff09\u5b89\u88c5 mysql-client</p> <pre><code>sudo rpm -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpm\n</code></pre> <p>5\uff09\u5b89\u88c5 mysql-server</p> <pre><code>sudo rpm -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u62a5\u5982\u4e0b\u9519\u8bef\uff0c\u8fd9\u662f\u7531\u4e8e yum \u5b89\u88c5\u4e86\u65e7\u7248\u672c\u7684 GPG keys \u6240\u9020\u6210\uff0c\u4ece rpm \u7248\u672c 4.1 \u540e\uff0c\u5728\u5b89\u88c5\u6216\u5347\u7ea7\u8f6f\u4ef6\u5305\u65f6\u4f1a\u81ea\u52a8\u68c0\u67e5\u8f6f\u4ef6\u5305\u7684\u7b7e\u540d</p> <pre><code>warning: 05_mysql-community-server-5.7.16-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY\nerror: Failed dependencies:\nlibaio.so.1()(64bit) is needed by mysql-community-server-5.7.16-1.el7.x86_64\n</code></pre> <p>\u89e3\u51b3\u529e\u6cd5</p> <pre><code>sudo yum -y install libaio\n</code></pre> <p>6\uff09\u542f\u52a8 MySQL</p> <pre><code>sudo systemctl start mysqld\n</code></pre> <p>7\uff09\u67e5\u770b MySQL \u5bc6\u7801</p> <pre><code>sudo cat /var/log/mysqld.log | grep password\n</code></pre>"},{"location":"engine/hive/hive_02/#233-mysql","title":"2.3.3 \u914d\u7f6eMySQL","text":"<p>\u914d\u7f6e\u53ea\u8981\u662f root \u7528\u6237 + \u5bc6\u7801\uff0c\u5728\u4efb\u4f55\u4e3b\u673a\u4e0a\u90fd\u80fd\u767b\u5f55 MySQL \u6570\u636e\u5e93\u3002</p> <p>1\uff09\u7528\u521a\u521a\u67e5\u5230\u7684\u5bc6\u7801\u8fdb\u5165 MySQL\uff08\u5982\u679c\u62a5\u9519\uff0c\u7ed9\u5bc6\u7801\u52a0\u5355\u5f15\u53f7\uff09</p> <pre><code>mysql -uroot -p'password'\n</code></pre> <p>2\uff09\u8bbe\u7f6e\u590d\u6742\u5bc6\u7801\uff08\u7531\u4e8e MySQL \u5bc6\u7801\u7b56\u7565\uff0c\u6b64\u5bc6\u7801\u5fc5\u987b\u8db3\u591f\u590d\u6742\uff09</p> <pre><code>set password=password(\"Qs23=zs32\");\n</code></pre> <p>3\uff09\u66f4\u6539 MySQL \u5bc6\u7801\u7b56\u7565</p> <pre><code>set global validate_password_length=4;\nset global validate_password_policy=0;\n</code></pre> <p>4\uff09\u8bbe\u7f6e\u7b80\u5355\u597d\u8bb0\u7684\u5bc6\u7801</p> <pre><code>set password=password(\"123456\");\n</code></pre> <p>5\uff09\u8fdb\u5165 MySQL \u5e93</p> <pre><code>use mysql\n</code></pre> <p>6\uff09\u67e5\u8be2 user \u8868</p> <pre><code>select user, host from user;\n</code></pre> <p>7\uff09\u4fee\u6539 user \u8868\uff0c\u628a Host \u8868\u5185\u5bb9\u4fee\u6539\u4e3a %</p> <pre><code>update user set host=\"%\" where user=\"root\";\n</code></pre> <p>8\uff09\u5237\u65b0</p> <pre><code>flush privileges;\n</code></pre> <p>9\uff09\u9000\u51fa</p> <pre><code>quit;\n</code></pre>"},{"location":"engine/hive/hive_02/#24-hivemysql","title":"2.4 \u914d\u7f6eHive\u5143\u6570\u636e\u5b58\u50a8\u5230MySQL","text":""},{"location":"engine/hive/hive_02/#241-mysql","title":"2.4.1 \u914d\u7f6e\u5143\u6570\u636e\u5230MySQL","text":"<p>1\uff09\u5c06 MySQL \u7684 JDBC \u9a71\u52a8\u62f7\u8d1d\u5230 Hive \u7684 lib \u76ee\u5f55\u4e0b\u3002</p> <pre><code>cp /opt/software/mysql-connector-java-5.1.37.jar $HIVE_HOME/lib\n</code></pre> <p>2\uff09\u5728 $HIVE_HOME/conf \u76ee\u5f55\u4e0b\u65b0\u5efa hive-site.xml \u6587\u4ef6</p> <pre><code>vim $HIVE_HOME/conf/hive-site.xml\n</code></pre> hive-site.xml<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n&lt;!-- jdbc\u8fde\u63a5\u7684URL --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n&lt;value&gt;jdbc:mysql://hadoop102:3306/metastore?useSSL=false&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684Driver--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684username--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n&lt;value&gt;root&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684password --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n&lt;value&gt;123456&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- Hive\u9ed8\u8ba4\u5728HDFS\u7684\u5de5\u4f5c\u76ee\u5f55 --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;\n&lt;value&gt;/user/hive/warehouse&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>3\uff09\u767b\u5f55 MySQL</p> <pre><code>mysql -uroot -p123456\n</code></pre> <p>4\uff09\u65b0\u5efa Hive \u5143\u6570\u636e\u5e93</p> <pre><code>create database metastore;\nquit;\n</code></pre> <p>5\uff09\u521d\u59cb\u5316 Hive \u5143\u6570\u636e\u5e93\uff08\u4fee\u6539\u4e3a\u91c7\u7528 MySQL \u5b58\u50a8\u5143\u6570\u636e\uff09</p> <pre><code>bin/schematool -dbType mysql -initSchema -verbose\n</code></pre>"},{"location":"engine/hive/hive_02/#242","title":"2.4.2 \u9a8c\u8bc1\u5143\u6570\u636e\u662f\u5426\u914d\u7f6e\u6210\u529f","text":"<p>1\uff09\u518d\u6b21\u542f\u52a8 Hive</p> <pre><code>bin/hive\n</code></pre> <p>2\uff09\u4f7f\u7528 Hive</p> <pre><code>show databases;\nshow tables;\ncreate table stu(id int, name string);\ninsert into stu values(1,\"ss\");\nselect * from stu;\n</code></pre> <p>3\uff09\u5728 Xshell \u7a97\u53e3\u4e2d\u5f00\u542f\u53e6\u4e00\u4e2a\u7a97\u53e3\u5f00\u542f Hive\uff08\u4e24\u4e2a\u7a97\u53e3\u90fd\u53ef\u4ee5\u64cd\u4f5c Hive\uff0c\u6ca1\u6709\u51fa\u73b0\u5f02\u5e38\uff09</p> <pre><code>show databases;\nshow tables;\nselect * from stu;\n</code></pre>"},{"location":"engine/hive/hive_02/#243-mysql","title":"2.4.3 \u67e5\u770bMySQL\u4e2d\u7684\u5143\u6570\u636e","text":"<p>1\uff09\u767b\u5f55 MySQL</p> <pre><code>mysql -uroot -p123456\n</code></pre> <p>2\uff09\u67e5\u770b\u5143\u6570\u636e\u5e93 metastore</p> <pre><code>show databases;\nuse metastore;\nshow tables;\n</code></pre> <p>\uff081\uff09\u67e5\u770b\u5143\u6570\u636e\u5e93\u4e2d\u5b58\u50a8\u7684\u5e93\u4fe1\u606f</p> <pre><code>$ select * from DBS;\n\n+-------+-----------------------+-------------------------------------------+---------+------------+------------+-----------+\n| DB_ID | DESC                  | DB_LOCATION_URI                           | NAME    | OWNER_NAME | OWNER_TYPE | CTLG_NAME |\n+-------+-----------------------+-------------------------------------------+---------+------------+------------+-----------+\n|     1 | Default Hive database | hdfs://hadoop102:8020/user/hive/warehouse | default | public     | ROLE       | hive      |\n+-------+-----------------------+-------------------------------------------+---------+------------+------------+-----------+\n</code></pre> <p>\uff082\uff09\u67e5\u770b\u5143\u6570\u636e\u5e93\u4e2d\u5b58\u50a8\u7684\u8868\u4fe1\u606f</p> <pre><code>$ select * from TBLS;\n\n+--------+-------------+-------+------------------+---------+------------+-----------+-------+----------+---------------+\n| TBL_ID | CREATE_TIME | DB_ID | LAST_ACCESS_TIME | OWNER   | OWNER_TYPE | RETENTION | SD_ID | TBL_NAME | TBL_TYPE      | \n+--------+-------------+-------+------------------+---------+------------+-----------+-------+----------+---------------+\n|      1 |  1656318303 |     1 |                0 | atguigu | USER       |         0 |     1 | stu      | MANAGED_TABLE |\n+--------+-------------+-------+------------------+---------+------------+-----------+-------+----------+---------------+\n</code></pre> <p>\uff083\uff09\u67e5\u770b\u5143\u6570\u636e\u5e93\u4e2d\u5b58\u50a8\u7684\u8868\u4e2d\u5217\u76f8\u5173\u4fe1\u606f</p> <pre><code>$ select * from TAB_COL_STATS;\n\n+-------+----------+---------+------------+-------------+-------------+--------+\n| CS_ID | CAT_NAME | DB_NAME | TABLE_NAME | COLUMN_NAME | COLUMN_TYPE | TBL_ID |\n+-------+----------+---------+------------+-------------+-------------+--------+\n|     1 | hive     | default | stu        | id          | int         |      1 |\n|     2 | hive     | default | stu        | name        | string      |      1 |\n+-------+----------+---------+------------+-------------+-------------+--------+\n</code></pre> <p>\uff084\uff09\u67e5\u770b\u5143\u6570\u636e\u5e93\u4e2d\u6570\u636eP==\u5b58\u50a8\u4f4d\u7f6e==}\u548c\u8bfb\u5165\u5199\u51fa\u7684\u65b9\u5f0f</p> <pre><code>```sql\nselect * from SDS;\n</code></pre> <p></p>"},{"location":"engine/hive/hive_02/#25-hive","title":"2.5 Hive\u670d\u52a1\u90e8\u7f72","text":""},{"location":"engine/hive/hive_02/#251-hiveserver2","title":"2.5.1 hiveserver2\u670d\u52a1","text":"<p>Hive \u7684 hiveserver2 \u670d\u52a1\u7684\u4f5c\u7528\u662f\u63d0\u4f9b jdbc / odbc \u63a5\u53e3\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u8fdc\u7a0b\u8bbf\u95ee Hive \u6570\u636e\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u7528\u6237\u671f\u671b\u5728\u4e2a\u4eba\u7535\u8111\u4e2d\u8bbf\u95ee\u8fdc\u7a0b\u670d\u52a1\u4e2d\u7684 Hive \u6570\u636e\uff0c\u5c31\u9700\u8981\u7528\u5230 Hiveserver2\u3002</p> <p></p> <p>1\uff09\u7528\u6237\u8bf4\u660e</p> <p>Question</p> <p>\u5728\u8fdc\u7a0b\u8bbf\u95ee Hive \u6570\u636e\u65f6\uff0c\u5ba2\u6237\u7aef\u5e76\u672a\u76f4\u63a5\u8bbf\u95ee Hadoop \u96c6\u7fa4\uff0c\u800c\u662f\u7531 Hivesever2 \u4ee3\u7406\u8bbf\u95ee\u3002\u7531\u4e8e Hadoop \u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u5177\u5907\u8bbf\u95ee\u6743\u9650\u63a7\u5236\uff0c\u6240\u4ee5\u6b64\u65f6\u9700\u8003\u8651\u4e00\u4e2a\u95ee\u9898\uff1a\u90a3\u5c31\u662f\u8bbf\u95ee Hadoop \u96c6\u7fa4\u7684\u7528\u6237\u8eab\u4efd\u662f\u8c01\uff1f\u662f Hiveserver2 \u7684\u542f\u52a8\u7528\u6237\uff1f\u8fd8\u662f\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u7528\u6237\uff1f</p> <p>\u7b54\u6848\u662f\u90fd\u6709\u53ef\u80fd\uff0c\u5177\u4f53\u662f\u8c01\uff0c\u7531 Hiveserver2 \u7684 hive.server2.enable.doAs \u53c2\u6570\u51b3\u5b9a\uff0c\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\u662f\u5426\u542f\u7528 Hiveserver2 \u7528\u6237\u6a21\u62df\u7684\u529f\u80fd\u3002\u82e5\u542f\u7528\uff0c\u5219 Hiveserver2 \u4f1a\u6a21\u62df\u6210\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u7528\u6237\u53bb\u8bbf\u95ee Hadoop \u96c6\u7fa4\u7684\u6570\u636e\uff0c\u4e0d\u542f\u7528\uff0c\u5219 Hivesever2 \u4f1a\u76f4\u63a5\u4f7f\u7528\u542f\u52a8\u7528\u6237\u8bbf\u95ee Hadoop \u96c6\u7fa4\u6570\u636e\u3002\u6a21\u62df\u7528\u6237\u7684\u529f\u80fd\uff0c\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\u3002</p> <p>\u5177\u4f53\u903b\u8f91\u5982\u4e0b\uff1a</p> <p> </p> \u672a\u5f00\u542f\u7528\u6237\u6a21\u62df\u529f\u80fd <p> </p> \u5f00\u542f\u7528\u6237\u6a21\u62df\u529f\u80fd <p>\u751f\u4ea7\u73af\u5883\uff0c\u63a8\u8350\u5f00\u542f\u7528\u6237\u6a21\u62df\u529f\u80fd\uff0c\u56e0\u4e3a\u5f00\u542f\u540e\u624d\u80fd\u4fdd\u8bc1\u5404\u7528\u6237\u4e4b\u95f4\u7684\u6743\u9650\u9694\u79bb\u3002</p> <p>2\uff09Hiveserver2 \u90e8\u7f72</p> <p>\uff081\uff09Hadoop \u7aef\u914d\u7f6e</p> <p>Hivesever2 \u7684\u6a21\u62df\u7528\u6237\u529f\u80fd\uff0c\u4f9d\u8d56\u4e8e Hadoop \u63d0\u4f9b\u7684 proxy user\uff08\u4ee3\u7406\u7528\u6237\u529f\u80fd\uff09\uff0c\u53ea\u6709 Hadoop \u4e2d\u7684\u4ee3\u7406\u7528\u6237\u624d\u80fd\u6a21\u62df\u5176\u4ed6\u7528\u6237\u7684\u8eab\u4efd\u8bbf\u95ee Hadoop \u96c6\u7fa4\u3002\u56e0\u6b64\uff0c\u9700\u8981\u5c06 Hiveserver2 \u7684\u542f\u52a8\u7528\u6237\u8bbe\u7f6e\u4e3a Hadoop \u7684\u4ee3\u7406\u7528\u6237\uff0c\u914d\u7f6e\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 core-site.xml\uff0c\u7136\u540e\u8bb0\u5f97\u5206\u53d1\u4e09\u53f0\u673a\u5668</p> <pre><code>cd $HADOOP_HOME/etc/hadoop\nvim core-site.xml\n</code></pre> core-site.xml<pre><code>&lt;!--\u914d\u7f6e\u6240\u6709\u8282\u70b9\u7684atguigu\u7528\u6237\u90fd\u53ef\u4f5c\u4e3a\u4ee3\u7406\u7528\u6237--&gt;\n&lt;property&gt;\n&lt;name&gt;hadoop.proxyuser.atguigu.hosts&lt;/name&gt;\n&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!--\u914d\u7f6eatguigu\u7528\u6237\u80fd\u591f\u4ee3\u7406\u7684\u7528\u6237\u7ec4\u4e3a\u4efb\u610f\u7ec4--&gt;\n&lt;property&gt;\n&lt;name&gt;hadoop.proxyuser.atguigu.groups&lt;/name&gt;\n&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!--\u914d\u7f6eatguigu\u7528\u6237\u80fd\u591f\u4ee3\u7406\u7684\u7528\u6237\u4e3a\u4efb\u610f\u7528\u6237--&gt;\n&lt;property&gt;\n&lt;name&gt;hadoop.proxyuser.atguigu.users&lt;/name&gt;\n&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09Hive \u7aef\u914d\u7f6e</p> <p>\u5728 hive-site.xml \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u4fe1\u606f</p> hive-site.xml<pre><code>&lt;!-- \u6307\u5b9ahiveserver2\u8fde\u63a5\u7684host --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;\n&lt;value&gt;hadoop102&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9ahiveserver2\u8fde\u63a5\u7684\u7aef\u53e3\u53f7 --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.server2.thrift.port&lt;/name&gt;\n&lt;value&gt;10000&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>3\uff09\u6d4b\u8bd5</p> <p>\uff081\uff09\u542f\u52a8 Hiveserver2</p> <pre><code>bin/hive --service hiveserver2\n</code></pre> <p>\uff082\uff09\u4f7f\u7528\u547d\u4ee4\u884c\u5ba2\u6237\u7aef beeline \u8fdb\u884c\u8fdc\u7a0b\u8bbf\u95ee</p> <p>\u542f\u52a8 beeline \u5ba2\u6237\u7aef</p> <pre><code> bin/beeline -u jdbc:hive2://hadoop102:10000 -n atguigu\n</code></pre> <p>\u770b\u5230\u5982\u4e0b\u754c\u9762</p> <pre><code>Connecting to jdbc:hive2://hadoop102:10000\nConnected to: Apache Hive (version 3.1.3)\nDriver: Hive JDBC (version 3.1.3)\nTransaction isolation: TRANSACTION_REPEATABLE_READ\nBeeline version 3.1.3 by Apache Hive\n0: jdbc:hive2://hadoop102:10000&gt;\n</code></pre> <p>\uff083\uff09\u4f7f\u7528 Datagrip \u56fe\u5f62\u5316\u5ba2\u6237\u7aef\u8fdb\u884c\u8fdc\u7a0b\u8bbf\u95ee</p> <p>4\uff09\u914d\u7f6e DataGrip \u8fde\u63a5</p> <p>\uff081\uff09\u521b\u5efa\u8fde\u63a5</p> <p></p> <p>\uff082\uff09\u914d\u7f6e\u8fde\u63a5\u5c5e\u6027</p> <p>\u6240\u6709\u5c5e\u6027\u914d\u7f6e\uff0c\u548c Hive \u7684 beeline \u5ba2\u6237\u7aef\u914d\u7f6e\u4e00\u81f4\u5373\u53ef\u3002\u521d\u6b21\u4f7f\u7528\uff0c\u914d\u7f6e\u8fc7\u7a0b\u4f1a\u63d0\u793a\u7f3a\u5c11 JDBC \u9a71\u52a8\uff0c\u6309\u7167\u63d0\u793a\u4e0b\u8f7d\u5373\u53ef\u3002</p> <p></p> <p>\uff083)\u754c\u9762\u4ecb\u7ecd</p> <p></p> <p>\uff084\uff09\u6d4b\u8bd5 sql \u6267\u884c</p> <p></p> <p>\uff085\uff09\u4fee\u6539\u6570\u636e\u5e93</p> <p></p>"},{"location":"engine/hive/hive_02/#252-metastore","title":"2.5.2 metastore\u670d\u52a1","text":"<p>Hive \u7684 metastore \u670d\u52a1\u7684\u4f5c\u7528\u662f\u4e3a Hive CLI \u6216\u8005 Hiveserver2 \u63d0\u4f9b\u5143\u6570\u636e\u8bbf\u95ee\u63a5\u53e3\u3002</p> <p>1\uff09metastore \u8fd0\u884c\u6a21\u5f0f</p> <p>metastore \u6709\u4e24\u79cd\u8fd0\u884c\u6a21\u5f0f\uff0c\u5206\u522b\u4e3a\u5d4c\u5165\u5f0f\u6a21\u5f0f\u548c\u72ec\u7acb\u670d\u52a1\u6a21\u5f0f\u3002\u4e0b\u9762\u5206\u522b\u5bf9\u4e24\u79cd\u6a21\u5f0f\u8fdb\u884c\u8bf4\u660e\uff1a</p> <p>\uff081\uff09\u5d4c\u5165\u5f0f\u6a21\u5f0f</p> <p></p> <p>\uff082\uff09\u72ec\u7acb\u670d\u52a1\u6a21\u5f0f</p> <p></p> <p>\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u5d4c\u5165\u5f0f\u6a21\u5f0f\u3002\u56e0\u4e3a\u5176\u5b58\u5728\u4ee5\u4e0b\u4e24\u4e2a\u95ee\u9898\uff1a</p> <p>\uff081\uff09\u5d4c\u5165\u5f0f\u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e2a Hive CLI \u90fd\u9700\u8981\u76f4\u63a5\u8fde\u63a5\u5143\u6570\u636e\u5e93\uff0c\u5f53 Hive CLI \u8f83\u591a\u65f6\uff0c\u6570\u636e\u5e93\u538b\u529b\u4f1a\u6bd4\u8f83\u5927\u3002</p> <p>\uff082\uff09\u6bcf\u4e2a\u5ba2\u6237\u7aef\u90fd\u9700\u8981\u7528\u6237\u5143\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6743\u9650\uff0c\u5143\u6570\u636e\u5e93\u7684\u5b89\u5168\u5f97\u4e0d\u5230\u5f88\u597d\u7684\u4fdd\u8bc1\u3002</p> <p>2\uff09metastore \u90e8\u7f72</p> <p>1\uff09\u5d4c\u5165\u5f0f\u6a21\u5f0f</p> <p>\u5d4c\u5165\u5f0f\u6a21\u5f0f\u4e0b\uff0c\u53ea\u9700\u4fdd\u8bc1 Hiveserver2 \u548c\u6bcf\u4e2a Hive CLI \u7684\u914d\u7f6e\u6587\u4ef6 hive-site.xml \u4e2d\u5305\u542b\u8fde\u63a5\u5143\u6570\u636e\u5e93\u6240\u9700\u8981\u7684\u4ee5\u4e0b\u53c2\u6570\u5373\u53ef\uff1a</p> hive-site.xml<pre><code>    &lt;!-- jdbc\u8fde\u63a5\u7684URL --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n&lt;value&gt;jdbc:mysql://hadoop102:3306/metastore?useSSL=false&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684Driver--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684username--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n&lt;value&gt;root&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684password --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n&lt;value&gt;123456&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09\u72ec\u7acb\u670d\u52a1\u6a21\u5f0f</p> <p>\u72ec\u7acb\u670d\u52a1\u6a21\u5f0f\u9700\u505a\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <p>\u9996\u5148\uff0c\u4fdd\u8bc1 metastore \u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6 hive-site.xml \u4e2d\u5305\u542b\u8fde\u63a5\u5143\u6570\u636e\u5e93\u6240\u9700\u7684\u4ee5\u4e0b\u53c2\u6570\uff1a</p> hive-site.xml<pre><code>    &lt;!-- jdbc\u8fde\u63a5\u7684URL --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n&lt;value&gt;jdbc:mysql://hadoop102:3306/metastore?useSSL=false&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684Driver--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684username--&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n&lt;value&gt;root&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- jdbc\u8fde\u63a5\u7684password --&gt;\n&lt;property&gt;\n&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n&lt;value&gt;123456&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u5176\u6b21\uff0c\u4fdd\u8bc1 Hiveserver2 \u548c\u6bcf\u4e2a Hive CLI \u7684\u914d\u7f6e\u6587\u4ef6 hive-site.xml \u4e2d\u5305\u542b\u8bbf\u95ee metastore \u670d\u52a1\u6240\u9700\u7684\u4ee5\u4e0b\u53c2\u6570\uff1a</p> hive-site.xml<pre><code>&lt;!-- \u6307\u5b9ametastore\u670d\u52a1\u7684\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;hive.metastore.uris&lt;/name&gt;\n&lt;value&gt;thrift://hadoop102:9083&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u6ce8\u610f\uff1a\u4e3b\u673a\u540d\u9700\u8981\u6539\u4e3a metastore \u670d\u52a1\u6240\u5728\u8282\u70b9\uff0c\u7aef\u53e3\u53f7\u65e0\u9700\u4fee\u6539\uff0cmetastore \u670d\u52a1\u7684\u9ed8\u8ba4\u7aef\u53e3\u5c31\u662f 9083\u3002</p> <p>3\uff09\u6d4b\u8bd5</p> <p>\u6b64\u65f6\u542f\u52a8 Hive CLI\uff0c\u6267\u884c show databases \u8bed\u53e5\uff0c\u4f1a\u51fa\u73b0\u4e00\u4e0b\u9519\u8bef\u63d0\u793a\u4fe1\u606f\uff1a</p> <pre><code>FAILED: HiveException java.lang.RuntimeException: Unable to instantiate org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5728 Hive CLI \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u4e86 hive.metastore.uris \u53c2\u6570\uff0c\u6b64\u65f6 Hive CLI \u4f1a\u53bb\u8bf7\u6c42\u6211\u4eec\u6267\u884c\u7684 metastore \u670d\u52a1\u5730\u5740\uff0c\u6240\u4ee5\u5fc5\u987b\u542f\u52a8 metastore \u670d\u52a1\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\u3002</p> <p>metastore \u670d\u52a1\u7684\u542f\u52a8\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>hive --service metastore\n</code></pre> <p>\u6ce8\u610f</p> <p>\u542f\u52a8\u540e\u8be5\u7a97\u53e3\u4e0d\u80fd\u518d\u64cd\u4f5c\uff0c\u9700\u6253\u5f00\u4e00\u4e2a\u65b0\u7684 Xshell \u7a97\u53e3\u6765\u5bf9 Hive \u64cd\u4f5c\u3002</p> <p>\u91cd\u65b0\u542f\u52a8 Hive CLI\uff0c\u5e76\u6267\u884c show databases\u8bed\u53e5\uff0c\u5c31\u80fd\u6b63\u5e38\u8bbf\u95ee\u4e86</p> <pre><code>bin/hive\n</code></pre>"},{"location":"engine/hive/hive_02/#253-hive","title":"2.5.3 \u7f16\u5199Hive\u670d\u52a1\u542f\u52a8\u811a\u672c\uff08\u4e86\u89e3\uff09","text":"<p>1\uff09\u524d\u53f0\u542f\u52a8\u7684\u65b9\u5f0f\u5bfc\u81f4\u9700\u8981\u6253\u5f00\u591a\u4e2a Xshell \u7a97\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u540e\u53f0\u65b9\u5f0f\u542f\u52a8</p> <ul> <li>nohup\uff1a\u653e\u5728\u547d\u4ee4\u5f00\u5934\uff0c\u8868\u793a\u4e0d\u6302\u8d77\uff0c\u4e5f\u5c31\u662f\u5173\u95ed\u7ec8\u7aef\u8fdb\u7a0b\u4e5f\u7ee7\u7eed\u4fdd\u6301\u8fd0\u884c\u72b6\u6001</li> <li>/dev/null\uff1a\u662f Linux \u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u6587\u4ef6\uff0c\u88ab\u79f0\u4e3a\u9ed1\u6d1e\uff0c\u6240\u6709\u5199\u5165\u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u90fd\u4f1a\u88ab\u81ea\u52a8\u4e22\u5f03</li> <li>2&gt;&amp;1\uff1a\u8868\u793a\u5c06\u9519\u8bef\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u51fa\u4e0a</li> <li>&amp;\uff1a\u653e\u5728\u547d\u4ee4\u7ed3\u5c3e\uff0c\u8868\u793a\u540e\u53f0\u8fd0\u884c</li> </ul> <p>\u4e00\u822c\u4f1a\u7ec4\u5408\u4f7f\u7528\uff1a<code>nohup  [xxx\u547d\u4ee4\u64cd\u4f5c]&gt; file  2&gt;&amp;1 &amp;</code>\uff0c\u8868\u793a\u5c06 xxx \u547d\u4ee4\u8fd0\u884c\u7684\u7ed3\u679c\u8f93\u51fa\u5230 file \u4e2d\uff0c\u5e76\u4fdd\u6301\u547d\u4ee4\u542f\u52a8\u7684\u8fdb\u7a0b\u5728\u540e\u53f0\u8fd0\u884c\u3002</p> <pre><code>nohup hive --service metastore 2&gt;&amp;1 &amp;\nnohup hive --service hiveserver2 2&gt;&amp;1 &amp;\n</code></pre> <p>2\uff09\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528\uff0c\u53ef\u4ee5\u76f4\u63a5\u7f16\u5199\u811a\u672c\u6765\u7ba1\u7406\u670d\u52a1\u7684\u542f\u52a8\u548c\u5173\u95ed</p> <pre><code>vim $HIVE_HOME/bin/hiveservices.sh\n</code></pre> hive services.sh<pre><code>#!/bin/bash\n\nHIVE_LOG_DIR=$HIVE_HOME/logs\nif [ ! -d $HIVE_LOG_DIR ]\nthen\nmkdir -p $HIVE_LOG_DIR\nfi\n\n#\u68c0\u67e5\u8fdb\u7a0b\u662f\u5426\u8fd0\u884c\u6b63\u5e38\uff0c\u53c2\u65701\u4e3a\u8fdb\u7a0b\u540d\uff0c\u53c2\u65702\u4e3a\u8fdb\u7a0b\u7aef\u53e3\nfunction check_process()\n{\npid=$(ps -ef 2&gt;/dev/null | grep -v grep | grep -i $1 | awk '{print $2}')\nppid=$(netstat -nltp 2&gt;/dev/null | grep $2 | awk '{print $7}' | cut -d '/' -f 1)\necho $pid\n[[ \"$pid\" =~ \"$ppid\" ]] &amp;&amp; [ \"$ppid\" ] &amp;&amp; return 0 || return 1\n}\n\nfunction hive_start()\n{\nmetapid=$(check_process HiveMetastore 9083)\ncmd=\"nohup hive --service metastore &gt;$HIVE_LOG_DIR/metastore.log 2&gt;&amp;1 &amp;\"\n[ -z \"$metapid\" ] &amp;&amp; eval $cmd || echo \"Metastroe\u670d\u52a1\u5df2\u542f\u52a8\"\nserver2pid=$(check_process HiveServer2 10000)\ncmd=\"nohup hive --service hiveserver2 &gt;$HIVE_LOG_DIR/hiveServer2.log 2&gt;&amp;1 &amp;\"\n[ -z \"$server2pid\" ] &amp;&amp; eval $cmd || echo \"HiveServer2\u670d\u52a1\u5df2\u542f\u52a8\"\n}\n\nfunction hive_stop()\n{\nmetapid=$(check_process HiveMetastore 9083)\n[ \"$metapid\" ] &amp;&amp; kill $metapid || echo \"Metastore\u670d\u52a1\u672a\u542f\u52a8\"\nserver2pid=$(check_process HiveServer2 10000)\n[ \"$server2pid\" ] &amp;&amp; kill $server2pid || echo \"HiveServer2\u670d\u52a1\u672a\u542f\u52a8\"\n}\n\ncase $1 in\n\"start\")\nhive_start\n    ;;\n\"stop\")\nhive_stop\n    ;;\n\"restart\")\nhive_stop\n    sleep 2\nhive_start\n    ;;\n\"status\")\ncheck_process HiveMetastore 9083 &gt;/dev/null &amp;&amp; echo \"Metastore\u670d\u52a1\u8fd0\u884c\u6b63\u5e38\" || echo \"Metastore\u670d\u52a1\u8fd0\u884c\u5f02\u5e38\"\ncheck_process HiveServer2 10000 &gt;/dev/null &amp;&amp; echo \"HiveServer2\u670d\u52a1\u8fd0\u884c\u6b63\u5e38\" || echo \"HiveServer2\u670d\u52a1\u8fd0\u884c\u5f02\u5e38\"\n;;\n*)\necho Invalid Args!\n    echo 'Usage: '$(basename $0)' start|stop|restart|status'\n;;\nesac\n</code></pre> <p>3\uff09\u6dfb\u52a0\u6267\u884c\u6743\u9650</p> <pre><code>chmod +x $HIVE_HOME/bin/hiveservices.sh\n</code></pre> <p>4\uff09\u542f\u52a8 Hive \u540e\u53f0\u670d\u52a1</p> <pre><code>hiveservices.sh start\n</code></pre>"},{"location":"engine/hive/hive_02/#26-hive","title":"2.6 Hive\u4f7f\u7528\u6280\u5de7","text":""},{"location":"engine/hive/hive_02/#261-hive","title":"2.6.1 Hive\u5e38\u7528\u4ea4\u4e92\u547d\u4ee4","text":"<pre><code>bin/hive -help\n\nusage: hive\n -d,--define &lt;key=value&gt;          Variable subsitution to apply to hive\n                                  commands. e.g. -d A=B or --define A=B\n    --database &lt;databasename&gt;     Specify the database to use\n -e &lt;quoted-query-string&gt;         SQL from command line\n -f &lt;filename&gt;                      SQL from files\n -H,--help                        Print help information\n    --hiveconf &lt;property=value&gt;   Use value for given property\n    --hivevar &lt;key=value&gt;         Variable subsitution to apply to hive\n                                  commands. e.g. --hivevar A=B\n -i &lt;filename&gt;                    Initialization SQL file\n -S,--silent                      Silent mode in interactive shell\n -v,--verbose                     Verbose mode (echo executed SQL to the console)\n</code></pre> <p>1\uff09\u5728 Hive \u547d\u4ee4\u884c\u91cc\u521b\u5efa\u4e00\u4e2a\u8868 student\uff0c\u5e76\u63d2\u5165 1 \u6761\u6570\u636e</p> <pre><code>create table student(id int,name string);\ninsert into table student values(1,\"zhangsan\");\nselect * from student;\n</code></pre> <p>2\uff09<code>-e</code> \u4e0d\u8fdb\u5165 Hive \u7684\u4ea4\u4e92\u7a97\u53e3\u6267\u884c hql \u8bed\u53e5</p> <pre><code>bin/hive -e \"select id from student;\"\n</code></pre> <p>3\uff09<code>-f</code> \u6267\u884c\u811a\u672c\u4e2d\u7684 hql \u8bed\u53e5</p> <p>\uff081\uff09\u5728 /opt/module/hive/ \u4e0b\u521b\u5efa datas \u76ee\u5f55\u5e76\u5728 datas \u76ee\u5f55\u4e0b\u521b\u5efa hivef.sql \u6587\u4ef6</p> <pre><code>mkdir datas\nvim hivef.sql\n</code></pre> <p>\uff082\uff09\u6587\u4ef6\u4e2d\u5199\u5165\u6b63\u786e\u7684 hql \u8bed\u53e5</p> hive.sql<pre><code>select * from student;\n</code></pre> <p>\uff083\uff09\u6267\u884c\u6587\u4ef6\u4e2d\u7684 hql \u8bed\u53e5</p> <pre><code>bin/hive -f /opt/module/hive/datas/hivef.sql\n</code></pre> <p>\uff084\uff09\u6267\u884c\u6587\u4ef6\u4e2d\u7684 hql \u8bed\u53e5\u5e76\u5c06\u7ed3\u679c\u5199\u5165\u6587\u4ef6\u4e2d</p> <pre><code>bin/hive -f /opt/module/hive/datas/hivef.sql  &gt; /opt/module/hive/datas/hive_result.txt\n</code></pre>"},{"location":"engine/hive/hive_02/#262-hive","title":"2.6.2 Hive\u53c2\u6570\u914d\u7f6e\u65b9\u5f0f","text":"<p>1\uff09\u67e5\u770b\u5f53\u524d\u6240\u6709\u7684\u914d\u7f6e\u4fe1\u606f</p> <pre><code>set;\n</code></pre> <p>2\uff09\u53c2\u6570\u7684\u914d\u7f6e\u4e09\u79cd\u65b9\u5f0f</p> <p>\uff081\uff09\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f</p> <ul> <li>\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff1ahive-default.xml</li> <li>\u7528\u6237\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff1ahive-site.xml</li> </ul> <p>\u6ce8\u610f</p> <p>\u7528\u6237\u81ea\u5b9a\u4e49\u914d\u7f6e\u4f1a\u8986\u76d6\u9ed8\u8ba4\u914d\u7f6e\u3002\u53e6\u5916\uff0cHive \u4e5f\u4f1a\u8bfb\u5165 Hadoop \u7684\u914d\u7f6e\uff0c\u56e0\u4e3a Hive \u662f\u4f5c\u4e3a Hadoop \u7684\u5ba2\u6237\u7aef\u542f\u52a8\u7684\uff0cHive \u7684\u914d\u7f6e\u4f1a\u8986\u76d6 Hadoop \u7684\u914d\u7f6e\u3002\u914d\u7f6e\u6587\u4ef6\u7684\u8bbe\u5b9a\u5bf9\u672c\u673a\u542f\u52a8\u7684\u6240\u6709 Hive \u8fdb\u7a0b\u90fd\u6709\u6548\u3002</p> <p>\uff082\uff09\u547d\u4ee4\u884c\u53c2\u6570\u65b9\u5f0f</p> <p>\u2460\u542f\u52a8 Hive \u65f6\uff0c\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u6dfb\u52a0 <code>-hiveconf param=value</code> \u6765\u8bbe\u5b9a\u53c2\u6570\u3002\u4f8b\u5982\uff1a</p> <pre><code>bin/hive -hiveconf mapreduce.job.reduces=10;\n</code></pre> <p>\u6ce8\u610f</p> <p>\u4ec5\u5bf9\u672c\u6b21 Hive \u542f\u52a8\u6709\u6548\u3002</p> <p>\u2461\u67e5\u770b\u53c2\u6570\u8bbe\u7f6e</p> <pre><code>set mapreduce.job.reduces;\n</code></pre> <p>\uff083\uff09\u53c2\u6570\u58f0\u660e\u65b9\u5f0f</p> <p>\u53ef\u4ee5\u5728 HQL \u4e2d\u4f7f\u7528 SET \u5173\u952e\u5b57\u8bbe\u5b9a\u53c2\u6570\uff0c\u4f8b\u5982\uff1a</p> <pre><code>set mapreduce.job.reduces=10;\n</code></pre> <p>\u6ce8\u610f</p> <p>\u4ec5\u5bf9\u672c\u6b21 Hive \u542f\u52a8\u6709\u6548\u3002</p> <p>\u67e5\u770b\u53c2\u6570\u8bbe\u7f6e\uff1a</p> <pre><code>set mapreduce.job.reduces;\n</code></pre> <p>\u4e0a\u8ff0\u4e09\u79cd\u8bbe\u5b9a\u65b9\u5f0f\u7684\u4f18\u5148\u7ea7\u4f9d\u6b21\u9012\u589e\u3002\u5373 \u914d\u7f6e\u6587\u4ef6 &lt; \u547d\u4ee4\u884c\u53c2\u6570 &lt; \u53c2\u6570\u58f0\u660e\u3002\u6ce8\u610f\u67d0\u4e9b\u7cfb\u7edf\u7ea7\u7684\u53c2\u6570\uff0c\u4f8b\u5982 log4j \u76f8\u5173\u7684\u8bbe\u5b9a\uff0c\u5fc5\u987b\u7528\u524d\u4e24\u79cd\u65b9\u5f0f\u8bbe\u5b9a\uff0c\u56e0\u4e3a\u90a3\u4e9b\u53c2\u6570\u7684\u8bfb\u53d6\u5728\u4f1a\u8bdd\u5efa\u7acb\u4ee5\u524d\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002</p>"},{"location":"engine/hive/hive_02/#263-hive","title":"2.6.3 Hive\u5e38\u89c1\u5c5e\u6027\u914d\u7f6e","text":"<p>1\uff09Hive \u5ba2\u6237\u7aef\u663e\u793a\u5f53\u524d\u5e93\u548c\u8868\u5934</p> <p>\uff081\uff09\u5728 hive-site.xml \u4e2d\u52a0\u5165\u5982\u4e0b\u4e24\u4e2a\u914d\u7f6e:</p> hive-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;hive.cli.print.header&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;description&gt;Whether to print the names of the columns in query output.&lt;/description&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;hive.cli.print.current.db&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;description&gt;Whether to include the current database in the Hive prompt.&lt;/description&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09Hive \u5ba2\u6237\u7aef\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u663e\u793a\u5f53\u524d\u4f7f\u7528\u7684\u5e93\u548c\u8868\u5934\u4fe1\u606f</p> <pre><code>[atguigu@hadoop102 conf]$ hive\n\nhive (default)&gt; select * from stu;\nOK\nstu.id  stu.name\n1   ss\nTime taken: 1.874 seconds, Fetched: 1 row(s)\nhive (default)&gt;\n</code></pre> <p>2\uff09Hive \u8fd0\u884c\u65e5\u5fd7\u8def\u5f84\u914d\u7f6e</p> <p>\uff081\uff09Hive \u7684 log \u9ed8\u8ba4\u5b58\u653e\u5728 /tmp/atguigu/hive.log \u76ee\u5f55\u4e0b\uff08\u5f53\u524d\u7528\u6237\u540d\u4e0b\uff09</p> <p>\uff082\uff09\u4fee\u6539 Hive \u7684 log \u5b58\u653e\u65e5\u5fd7\u5230 /opt/module/hive/logs</p> <p>\u4fee\u6539 $HIVE_HOME/conf/hive-log4j2.properties.template \u6587\u4ef6\u540d\u79f0\u4e3a hive-log4j2.properties</p> <pre><code>mv hive-log4j2.properties.template hive-log4j2.properties\n</code></pre> <p>\u5728 hive-log4j2.properties \u6587\u4ef6\u4e2d\u4fee\u6539 log \u5b58\u653e\u4f4d\u7f6e</p> hive-log4j2.properties<pre><code>property.hive.log.dir=/opt/module/hive/logs\n</code></pre> <p>3\uff09Hive \u7684 JVM \u5806\u5185\u5b58\u8bbe\u7f6e</p> <p>\u65b0\u7248\u672c\u7684 Hive \u542f\u52a8\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u7533\u8bf7\u7684 JVM \u5806\u5185\u5b58\u5927\u5c0f\u4e3a 256M\uff0cJVM \u5806\u5185\u5b58\u7533\u8bf7\u7684\u592a\u5c0f\uff0c\u5bfc\u81f4\u540e\u671f\u5f00\u542f\u672c\u5730\u6a21\u5f0f\uff0c\u6267\u884c\u590d\u6742\u7684 SQL \u65f6\u7ecf\u5e38\u4f1a\u62a5\u9519\uff1ajava.lang.OutOfMemoryError: Java heap space\uff0c\u56e0\u6b64\u6700\u597d\u63d0\u524d\u8c03\u6574\u4e00\u4e0b HADOOP_HEAPSIZE \u8fd9\u4e2a\u53c2\u6570\u3002</p> <p>\uff081\uff09\u4fee\u6539 $HIVE_HOME/conf \u4e0b\u7684 hive-env.sh.template \u4e3a hive-env.sh</p> <pre><code>mv hive-env.sh.template hive-env.sh\n</code></pre> <p>\uff082\uff09\u5c06 hive-env.sh \u5176\u4e2d\u7684\u53c2\u6570 export HADOOP_HEAPSIZE \u4fee\u6539\u4e3a 2048\uff0c\u91cd\u542f Hive\u3002</p> hive-env.sh<pre><code># The heap size of the jvm stared by hive shell script can be controlled via:\nexport HADOOP_HEAPSIZE=2048\n</code></pre> <p>4\uff09\u5173\u95ed Hadoop \u865a\u62df\u5185\u5b58\u68c0\u67e5</p> <p>\u5728 yarn-site.xml \u4e2d\u5173\u95ed\u865a\u62df\u5185\u5b58\u68c0\u67e5\uff08\u865a\u62df\u5185\u5b58\u6821\u9a8c\uff0c\u5982\u679c\u5df2\u7ecf\u5173\u95ed\u4e86\uff0c\u5c31\u4e0d\u9700\u8981\u914d\u4e86\uff09\u3002</p> <p>\uff081\uff09\u4fee\u6539\u524d\u8bb0\u5f97\u5148\u505c Hadoop</p> <pre><code>vim yarn-site.xml\n</code></pre> <p>\uff082\uff09\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;\n&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff083\uff09\u4fee\u6539\u5b8c\u540e\u8bb0\u5f97\u5206\u53d1 yarn-site.xml\uff0c\u5e76\u91cd\u542f yarn\u3002</p>"},{"location":"engine/hive/hive_03/","title":"\u7b2c3\u7ae0 Hive\u6570\u636e\u7c7b\u578b","text":""},{"location":"engine/hive/hive_03/#31","title":"3.1 \u57fa\u672c\u6570\u636e\u7c7b\u578b","text":"Hive MySQL Java \u957f\u5ea6 \u4f8b\u5b50 tinyint tinyint byte 1byte\u6709\u7b26\u53f7\u6574\u6570 2 smallint smallint short 2byte\u6709\u7b26\u53f7\u6574\u6570 20 int int int 4byte\u6709\u7b26\u53f7\u6574\u6570 2000 bigint bigint long 8byte\u6709\u7b26\u53f7\u6574\u6570 20000000 boolean \u65e0 boolean \u5e03\u5c14\u7c7b\u578b\uff0ctrue\u6216\u8005false true  false float float float \u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570 3.14159 double double double \u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570 3.14159 string varchar string \u5b57\u7b26\u7cfb\u5217\u3002\u53ef\u4ee5\u6307\u5b9a\u5b57\u7b26\u96c6\u3002\u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u8005\u53cc\u5f15\u53f7\u3002 'now is the time'\"for all good men\" timestamp timestamp \u65f6\u95f4\u7c7b\u578b binary binary \u5b57\u8282\u6570\u7ec4 <p>\u5bf9\u4e8e Hive \u7684 string \u7c7b\u578b\u76f8\u5f53\u4e8e\u6570\u636e\u5e93\u7684 varchar \u7c7b\u578b\uff0c\u8be5\u7c7b\u578b\u662f\u4e00\u4e2a\u53ef\u53d8\u7684\u5b57\u7b26\u4e32\uff0c\u4e0d\u8fc7\u5b83\u4e0d\u80fd\u58f0\u660e\u5176\u4e2d\u6700\u591a\u80fd\u5b58\u50a8\u591a\u5c11\u4e2a\u5b57\u7b26\uff0c\u7406\u8bba\u4e0a\u5b83\u53ef\u4ee5\u5b58\u50a8 2GB \u7684\u5b57\u7b26\u6570\u3002</p> <p>1\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u521b\u5efa\u4e00\u5f20 stu \u8868\u5e76\u52a0\u5165\u6570\u636e</p> <pre><code>create table stu2(id int, name string, age int, weight double);\n</code></pre> <pre><code>insert into stu values\n(1,'xiaohaihai',18,75),(2,'xiaosongsong',16,80),\n(3,'xiaohuihui',17,60),(4,'xiaoyangyang',16,65);\n</code></pre>"},{"location":"engine/hive/hive_03/#32","title":"3.2 \u96c6\u5408\u6570\u636e\u7c7b\u578b","text":"\u6570\u636e\u7c7b\u578b \u63cf\u8ff0 \u8bed\u6cd5\u793a\u4f8b struct \u7ed3\u6784\u4f53\u7531\u4e00\u7ec4\u79f0\u4e3a\u6210\u5458\u7684\u4e0d\u540c\u6570\u636e\u7ec4\u6210\uff0c\u5176\u4e2d\u6bcf\u4e2a\u6210\u5458\u53ef\u4ee5\u5177\u6709\u4e0d\u540c\u7684\u7c7b\u578b\u3002\u901a\u5e38\u7528\u6765\u8868\u793a\u7c7b\u578b\u4e0d\u540c\u4f46\u662f\u53c8\u76f8\u5173\u7684\u82e5\u5e72\u6570\u636e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u67d0\u4e2a\u5217\u7684\u6570\u636e\u7c7b\u578b\u662fstruct{first string, last string}\uff0c\u90a3\u4e48\u7b2c 1 \u4e2a\u5143\u7d20\u53ef\u4ee5\u901a\u8fc7\u5b57\u6bb5 .first \u6765\u5f15\u7528\u3002 struct() \u4f8b\u5982struct map map \u662f\u4e00\u7ec4\u952e-\u503c\u5bf9\u5143\u7ec4\u96c6\u5408\uff0c\u4f7f\u7528\u6570\u7ec4\u8868\u793a\u6cd5\u53ef\u4ee5\u8bbf\u95ee\u6570\u636e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u67d0\u4e2a\u5217\u7684\u6570\u636e\u7c7b\u578b\u662f map\uff0c\u5176\u4e2d\u952e-&gt;\u503c\u5bf9\u662f 'first' -&gt; 'John' \u548c 'last' -&gt; 'Doe'\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u5b57\u6bb5\u540d['last']\u83b7\u53d6\u6700\u540e\u4e00\u4e2a\u5143\u7d20 map() \u4f8b\u5982 map array \u6570\u7ec4\u662f\u4e00\u7ec4\u5177\u6709\u76f8\u540c\u7c7b\u578b\u548c\u540d\u79f0\u7684\u53d8\u91cf\u7684\u96c6\u5408\u3002\u8fd9\u4e9b\u53d8\u91cf\u79f0\u4e3a\u6570\u7ec4\u7684\u5143\u7d20\uff0c\u6bcf\u4e2a\u6570\u7ec4\u5143\u7d20\u90fd\u6709\u4e00\u4e2a\u7f16\u53f7\uff0c\u7f16\u53f7\u4ece\u96f6\u5f00\u59cb\u3002\u4f8b\u5982\uff0c\u6570\u7ec4\u503c\u4e3a['John', 'Doe']\uff0c\u90a3\u4e48\u7b2c 2 \u4e2a\u5143\u7d20\u53ef\u4ee5\u901a\u8fc7\u6570\u7ec4\u540d [1] \u8fdb\u884c\u5f15\u7528\u3002 array() \u4f8b\u5982array\\ <p>Hive \u6709\u4e09\u79cd\u590d\u6742\u6570\u636e\u7c7b\u578b array\u3001map \u548c struct\u3002array \u548c map \u4e0e Java \u4e2d\u7684 array \u548c map \u7c7b\u4f3c\uff0c\u800c struct \u7531\u4e00\u7ec4\u79f0\u4e3a\u6210\u5458\u7684\u4e0d\u540c\u6570\u636e\u7ec4\u6210\uff0c\u5176\u4e2d\u6bcf\u4e2a\u6210\u5458\u53ef\u4ee5\u5177\u6709\u4e0d\u540c\u7684\u7c7b\u578b\u3002</p> <p>1\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u5047\u8bbe\u67d0\u8868\u6709\u5982\u4e0b\u4e00\u884c\uff0c\u6211\u4eec\u7528 Json \u683c\u5f0f\u6765\u8868\u793a\u5176\u6570\u636e\u7ed3\u6784\u3002\u5728 Hive \u4e0b\u8bbf\u95ee\u7684\u683c\u5f0f\u4e3a\u3002</p> <pre><code>{\n\"name\": \"dasongsong\",\n\"friends\": [\"bingbing\" , \"lili\"],      //\u5217\u8868array \n\"students\": {                              //\u952e\u503cmap\n\"xiaohaihai\": 18,\n\"xiaoyangyang\": 16\n}\n\"address\": {                               //\u7ed3\u6784struct\n\"street\": \"hui long guan\", \"city\": \"beijing\",\n\"email\":10010\n}\n}\n</code></pre> <p>\uff082\uff09\u57fa\u4e8e\u4e0a\u8ff0\u6570\u636e\u7ed3\u6784\uff0c\u6211\u4eec\u5728 Hive \u91cc\u521b\u5efa\u5bf9\u5e94\u7684\u8868\uff0c\u5e76\u5bfc\u5165\u6570\u636e\u3002</p> <p>\u5728 /opt/module/hive/datas \u8def\u5f84\u4e0b\uff0c\u521b\u5efa\u672c\u5730\u6d4b\u8bd5\u6587\u4ef6 tch.txt\u3002</p> tch.txt<pre><code>songsong,bingbing_lili,xiaohaihai:18_xiaoyangyang:16,hui long guan_beijing_10010\nyangyang,caicai_susu,xiaosongsong:17_xiaohuihui:16,chao yang_beijing_10011\n</code></pre> <p>\u6ce8\u610f\uff1amap\uff0cstruct \u548c array \u91cc\u7684\u5143\u7d20\u95f4\u5173\u7cfb\u90fd\u53ef\u4ee5\u7528\u540c\u4e00\u4e2a\u5b57\u7b26\u8868\u793a\uff0c\u8fd9\u91cc\u7528 \"_\"\u3002</p> <p>\uff083\uff09Hive \u4e0a\u521b\u5efa\u6d4b\u8bd5\u8868 tch</p> <pre><code>create table tch(\nname string,                    --\u59d3\u540d\nfriends array&lt;string&gt;,        --\u670b\u53cb\nstudents map&lt;string, int&gt;,   --\u5b66\u751f\naddress struct&lt;street:string,city:string,email:int&gt; --\u5730\u5740\n)\nrow format delimited fields terminated by ','\ncollection items terminated by '_'\nmap keys terminated by ':'\nlines terminated by '\\n';\n</code></pre> <p>\u5b57\u6bb5\u89e3\u91ca\uff1a</p> <ul> <li>row format delimited fields terminated by ','  -- \u5217\u5206\u9694\u7b26</li> <li>collection items terminated by '_'    -- map\u3001struct \u548c array \u7684\u6570\u636e\u5206\u9694\u7b26</li> <li>map keys terminated by ':'            -- map \u4e2d\u7684 key \u4e0e value \u7684\u5206\u9694\u7b26</li> <li>lines terminated by '\\n';             -- \u884c\u5206\u9694\u7b26</li> </ul> <p>\uff084\uff09\u5bfc\u5165\u6587\u672c\u6570\u636e\u5230\u6d4b\u8bd5\u8868</p> <pre><code>hadoop fs -put tch.txt /user/hive/warehouse/tch\n</code></pre> <p>\uff085\uff09\u8bbf\u95ee\u4e09\u79cd\u96c6\u5408\u5217\u91cc\u7684\u6570\u636e\uff0c\u4ee5\u4e0b\u5206\u522b\u662f array\uff0cmap\uff0cstruct \u7684\u8bbf\u95ee\u65b9\u5f0f</p> <pre><code>select friends[1],\nstudents['xiaohaihai'],\naddress.city from tch\nwhere name=\"songsong\";\n</code></pre>"},{"location":"engine/hive/hive_03/#33","title":"3.3 \u7c7b\u578b\u8f6c\u5316","text":"<p>Hive \u7684\u539f\u5b50\u6570\u636e\u7c7b\u578b\u662f\u53ef\u4ee5\u8fdb\u884c\u9690\u5f0f\u8f6c\u6362\u7684\uff0c\u7c7b\u4f3c\u4e8e Java \u7684\u7c7b\u578b\u8f6c\u6362\uff0c\u4f8b\u5982\u67d0\u8868\u8fbe\u5f0f\u4f7f\u7528 int \u7c7b\u578b\uff0ctinyint \u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a int \u7c7b\u578b\uff0c\u4f46\u662f Hive \u4e0d\u4f1a\u8fdb\u884c\u53cd\u5411\u8f6c\u5316\uff0c\u4f8b\u5982\uff0c\u67d0\u8868\u8fbe\u5f0f\u4f7f\u7528 tinyint \u7c7b\u578b\uff0cint \u4e0d\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a tinyint \u7c7b\u578b\uff0c\u5b83\u4f1a\u8fd4\u56de\u9519\u8bef\uff0c\u9664\u975e\u4f7f\u7528 cast \u64cd\u4f5c\u3002</p> <p>1\uff09\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\u5982\u4e0b</p> <p>\uff081\uff09\u4efb\u4f55\u6574\u6570\u7c7b\u578b\u90fd\u53ef\u4ee5\u9690\u5f0f\u5730\u8f6c\u6362\u4e3a\u4e00\u4e2a\u8303\u56f4\u66f4\u5e7f\u7684\u7c7b\u578b\uff0c\u5982 tinyint \u53ef\u4ee5\u8f6c\u6362\u6210 int\uff0cint \u53ef\u4ee5\u8f6c\u6362\u6210 bigint\u3002</p> <p>\uff082\uff09\u6240\u6709\u6574\u6570\u7c7b\u578b\u3001float \u548c string \u7c7b\u578b\u90fd\u53ef\u4ee5\u9690\u5f0f\u5730\u8f6c\u6362\u6210 double\u3002</p> <p>\uff083\uff09tinyint\u3001smallint\u3001int \u90fd\u53ef\u4ee5\u8f6c\u6362\u4e3a float\u3002</p> <p>\uff084\uff09boolean \u7c7b\u578b\u4e0d\u53ef\u4ee5\u8f6c\u6362\u4e3a\u4efb\u4f55\u5176\u5b83\u7684\u7c7b\u578b\u3002</p> <p>2\uff09\u53ef\u4ee5\u4f7f\u7528 cast \u64cd\u4f5c\u663e\u793a\u8fdb\u884c\u6570\u636e\u7c7b\u578b\u8f6c\u6362</p> <p>\u8bed\u6cd5\uff1a<code>cast(expr as &lt;type&gt;)</code> \u8fd4\u56de\u503c\uff1aExpected \"=\" to follow \"type\" \u8bf4\u660e\uff1a\u8fd4\u56de\u8f6c\u6362\u540e\u7684\u6570\u636e\u7c7b\u578b \u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>$ select '1' + 2, cast('1' as int) + 2;\n\n_c0    _c1\n3.0     3\n</code></pre>"},{"location":"engine/hive/hive_04/","title":"\u7b2c4\u7ae0 DDL\uff08Data Definition Language\uff09\u6570\u636e\u5b9a\u4e49","text":""},{"location":"engine/hive/hive_04/#41","title":"4.1 \u521b\u5efa\u6570\u636e\u5e93","text":"<p>1\uff09\u8bed\u6cd5</p> <pre><code>CREATE DATABASE [IF NOT EXISTS] database_name\n[COMMENT database_comment]\n[LOCATION hdfs_path]\n[WITH DBPROPERTIES (property_name=property_value, ...)];\n</code></pre> <p>2\uff09\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u5728 HDFS \u4e0a\u7684\u9ed8\u8ba4\u5b58\u50a8\u8def\u5f84\u662f /user/hive/warehouse/*.db\u3002</p> <pre><code>create database db_hive;\n</code></pre> <p>3\uff09\u907f\u514d\u8981\u521b\u5efa\u7684\u6570\u636e\u5e93\u5df2\u7ecf\u5b58\u5728\u9519\u8bef\uff0c\u589e\u52a0 if not exists \u5224\u65ad\u3002\uff08\u6807\u51c6\u5199\u6cd5\uff09</p> <pre><code>create database if not exists db_hive;\n</code></pre> <p>4\uff09\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u6307\u5b9a\u6570\u636e\u5e93\u5728 HDFS \u4e0a\u5b58\u653e\u7684\u4f4d\u7f6e</p> <pre><code>create database db_hive2 location '/db_hive2';\n</code></pre>"},{"location":"engine/hive/hive_04/#42","title":"4.2 \u67e5\u8be2\u6570\u636e\u5e93","text":""},{"location":"engine/hive/hive_04/#421","title":"4.2.1 \u663e\u793a\u6570\u636e\u5e93","text":"<p>1\uff09\u663e\u793a\u6570\u636e\u5e93</p> <pre><code>show databases;\n</code></pre> <p>2\uff09\u8fc7\u6ee4\u663e\u793a\u67e5\u8be2\u7684\u6570\u636e\u5e93</p> <pre><code>show databases like 'db_hive*';\n</code></pre>"},{"location":"engine/hive/hive_04/#422","title":"4.2.2 \u67e5\u770b\u6570\u636e\u5e93\u8be6\u60c5","text":"<p>1\uff09\u663e\u793a\u6570\u636e\u5e93\u4fe1\u606f</p> <pre><code>desc database db_hive;\n</code></pre> <p>2\uff09\u663e\u793a\u6570\u636e\u5e93\u8be6\u7ec6\u4fe1\u606f\uff0cextended</p> <pre><code>desc database extended db_hive;\n</code></pre>"},{"location":"engine/hive/hive_04/#423","title":"4.2.3 \u5207\u6362\u5f53\u524d\u6570\u636e\u5e93","text":"<pre><code>use db_hive;\n</code></pre>"},{"location":"engine/hive/hive_04/#43","title":"4.3 \u4fee\u6539\u6570\u636e\u5e93","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 alter database \u547d\u4ee4\u4e3a\u67d0\u4e2a\u6570\u636e\u5e93\u7684 dbproperties \u8bbe\u7f6e\u952e-\u503c\u5bf9\u5c5e\u6027\u503c\uff0c\u6765\u63cf\u8ff0\u8fd9\u4e2a\u6570\u636e\u5e93\u7684\u5c5e\u6027\u4fe1\u606f\u3002\u6570\u636e\u5e93\u7684\u5176\u4ed6\u5143\u6570\u636e\u4fe1\u606f\u90fd\u662f\u4e0d\u53ef\u66f4\u6539\u7684\uff0c\u5305\u62ec\u6570\u636e\u5e93\u540d\u548c\u6570\u636e\u5e93\u6240\u5728\u7684\u76ee\u5f55\u4f4d\u7f6e\u3002</p> <pre><code>alter database db_hive set dbproperties('createtime'='20220830');\n</code></pre> <p>1\uff09\u67e5\u770b Hive \u4e2d\u57fa\u672c\u4fe1\u606f\u3002</p> <pre><code>desc database db_hive;\n\ndb_name comment location    owner_name  owner_type  parameters\ndb_hive     hdfs://hadoop102:8020/user/hive/warehouse/db_hive.db    atguigu USER\n</code></pre> <p>2\uff09\u67e5\u770b Hive \u4e2d\u8be6\u7ec6\u4fe1\u606f\u3002</p> <pre><code>desc database extended db_hive;\ndb_name comment location        owner_name      owner_type      parameters\ndb_hive         hdfs://hadoop102:8020/user/hive/warehouse/db_hive.db    atguigu USER    {createtime=20170830}\n</code></pre>"},{"location":"engine/hive/hive_04/#44","title":"4.4 \u5220\u9664\u6570\u636e\u5e93","text":"<p>1\uff09\u5220\u9664\u7a7a\u6570\u636e\u5e93</p> <pre><code>drop database db_hive2;\n</code></pre> <p>2\uff09\u5982\u679c\u5220\u9664\u7684\u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u6700\u597d\u91c7\u7528 if exists \u5224\u65ad\u6570\u636e\u5e93\u662f\u5426\u5b58\u5728</p> <pre><code>drop database if exists db_hive2;\n</code></pre> <p>3\uff09\u5982\u679c\u6570\u636e\u5e93\u4e0d\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u91c7\u7528 cascade \u547d\u4ee4\uff0c\u5f3a\u5236\u5220\u9664</p> <pre><code>drop database db_hive cascade;\n</code></pre>"},{"location":"engine/hive/hive_04/#45","title":"4.5 \u521b\u5efa\u8868","text":"<p>1\uff09\u5efa\u8868\u8bed\u6cd5</p> <pre><code>CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name [(col_name data_type [COMMENT col_comment], ...)] [COMMENT table_comment] [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] [ROW FORMAT row_format] [STORED AS file_format] [LOCATION hdfs_path]\n[TBLPROPERTIES (property_name=property_value, ...)]\n[AS select_statement]\n[LIKE table_name]\n</code></pre> <p>2\uff09\u5b57\u6bb5\u89e3\u91ca\u8bf4\u660e </p> <p>1\uff09create table \u521b\u5efa\u4e00\u4e2a\u6307\u5b9a\u540d\u5b57\u7684\u8868\u3002\u5982\u679c\u76f8\u540c\u540d\u5b57\u7684\u8868\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u629b\u51fa\u5f02\u5e38\uff1b\u7528\u6237\u53ef\u4ee5\u7528 if not exists \u9009\u9879\u6765\u5ffd\u7565\u8fd9\u4e2a\u5f02\u5e38\u3002</p> <p>\uff082\uff09external \u5173\u952e\u5b57\u53ef\u4ee5\u8ba9\u7528\u6237\u521b\u5efa\u4e00\u4e2a\u5916\u90e8\u8868\uff0c\u5728\u5efa\u8868\u7684\u540c\u65f6\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6307\u5411\u5b9e\u9645\u6570\u636e\u7684\u8def\u5f84\uff08 location \uff09\uff0c\u5728\u5220\u9664\u8868\u7684\u65f6\u5019\uff0c\u5185\u90e8\u8868\u7684\u5143\u6570\u636e\u548c\u6570\u636e\u4f1a\u88ab\u4e00\u8d77\u5220\u9664\uff0c\u800c\u5916\u90e8\u8868\u53ea\u5220\u9664\u5143\u6570\u636e\uff0c\u4e0d\u5220\u9664\u6570\u636e\u3002</p> <p>\uff083\uff09comment\uff1a\u4e3a\u8868\u548c\u5217\u6dfb\u52a0\u6ce8\u91ca\u3002</p> <p>\uff084\uff09partitioned by \u521b\u5efa\u5206\u533a\u8868\u3002</p> <p>\uff085\uff09clustered by \u521b\u5efa\u5206\u6876\u8868\u3002</p> <p>\uff086\uff09sorted by \u4e0d\u5e38\u7528\uff0c\u5bf9\u6876\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5217\u53e6\u5916\u6392\u5e8f\u3002</p> <p>\uff087\uff09row format delimited</p> <pre><code>[FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char]\n[MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char] | SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, ...)]\n</code></pre> <p>\u7528\u6237\u5728\u5efa\u8868\u7684\u65f6\u5019\u53ef\u4ee5\u81ea\u5b9a\u4e49 SerDe \u6216\u8005\u4f7f\u7528\u81ea\u5e26\u7684 SerDe\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a row format \u6216\u8005 row format delimited\uff0c\u5c06\u4f1a\u4f7f\u7528\u81ea\u5e26\u7684 SerDe\u3002\u5728\u5efa\u8868\u7684\u65f6\u5019\uff0c\u7528\u6237\u8fd8\u9700\u8981\u4e3a\u8868\u6307\u5b9a\u5217\uff0c\u7528\u6237\u5728\u6307\u5b9a\u8868\u7684\u5217\u7684\u540c\u65f6\u4e5f\u4f1a\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684 SerDe\uff0cHive \u901a\u8fc7 SerDe \u786e\u5b9a\u8868\u7684\u5177\u4f53\u7684\u5217\u7684\u6570\u636e\u3002</p> <p>SerDe \u662f Serialize / Deserilize \u7684\u7b80\u79f0\uff0cHive \u4f7f\u7528 Serde \u8fdb\u884c\u884c\u5bf9\u8c61\u7684\u5e8f\u5217\u4e0e\u53cd\u5e8f\u5217\u5316\u3002</p> <p>\uff088\uff09stored as \u6307\u5b9a\u5b58\u50a8\u6587\u4ef6\u7c7b\u578b</p> <p>\u5e38\u7528\u7684\u5b58\u50a8\u6587\u4ef6\u7c7b\u578b\uff1asequencefile\uff08\u4e8c\u8fdb\u5236\u5e8f\u5217\u6587\u4ef6\uff09\u3001textfile\uff08\u6587\u672c\uff09\u3001rcfile\uff08\u5217\u5f0f\u5b58\u50a8\u683c\u5f0f\u6587\u4ef6\uff09\u3002</p> <p>\u5982\u679c\u6587\u4ef6\u6570\u636e\u662f\u7eaf\u6587\u672c\uff0c\u53ef\u4ee5\u4f7f\u7528 stored as textfile\u3002\u5982\u679c\u6570\u636e\u9700\u8981\u538b\u7f29\uff0c\u4f7f\u7528 stored as sequencefile\u3002</p> <p>\uff089\uff09location\uff1a\u6307\u5b9a\u8868\u5728 HDFS \u4e0a\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002</p> <p>\uff0810\uff09as\uff1a\u540e\u8ddf\u67e5\u8be2\u8bed\u53e5\uff0c\u6839\u636e\u67e5\u8be2\u7ed3\u679c\u521b\u5efa\u8868\u3002</p> <p>\uff0811\uff09like\uff1a\u5141\u8bb8\u7528\u6237\u590d\u5236\u73b0\u6709\u7684\u8868\u7ed3\u6784\uff0c\u4f46\u662f\u4e0d\u590d\u5236\u6570\u636e\u3002</p>"},{"location":"engine/hive/hive_04/#451","title":"4.5.1 \u7ba1\u7406\u8868","text":"<p>1\uff09\u7406\u8bba</p> <p>\u9ed8\u8ba4\u521b\u5efa\u7684\u8868\u90fd\u662f\u6240\u8c13\u7684\u7ba1\u7406\u8868\uff0c\u6709\u65f6\u4e5f\u88ab\u79f0\u4e3a\u5185\u90e8\u8868\u3002\u56e0\u4e3a\u8fd9\u79cd\u8868\uff0cHive \u4f1a\uff08\u6216\u591a\u6216\u5c11\u5730\uff09\u63a7\u5236\u7740\u6570\u636e\u7684\u751f\u547d\u5468\u671f\u3002Hive \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u5c06\u8fd9\u4e9b\u8868\u7684\u6570\u636e\u5b58\u50a8\u5728\u7531\u914d\u7f6e\u9879 <code>hive.metastore.warehouse.dir</code>\uff08\u9ed8\u8ba4\u8def\u5f84\uff0c/user/hive/warehouse\uff09\u6240\u5b9a\u4e49\u7684\u76ee\u5f55\u7684\u5b50\u76ee\u5f55\u4e0b\u3002\u5f53\u6211\u4eec\u5220\u9664\u4e00\u4e2a\u7ba1\u7406\u8868\u65f6\uff0cHive \u4e5f\u4f1a\u5220\u9664\u8fd9\u4e2a\u8868\u4e2d\u6570\u636e\u3002\u7ba1\u7406\u8868\u4e0d\u9002\u5408\u548c\u5176\u4ed6\u5de5\u5177\u5171\u4eab\u6570\u636e\u3002</p> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff080\uff09\u539f\u59cb\u6570\u636e</p> <p>\u5728 /opt/module/hive/datas \u8def\u5f84\u4e0a\uff0c\u521b\u5efa student.txt \u6587\u4ef6\uff0c\u5e76\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\u3002</p> student.txt<pre><code>1001    student1\n1002    student2\n1003    student3\n1004    student4\n1005    student5\n1006    student6\n1007    student7\n1008    student8\n1009    student9\n1010    student10\n1011    student11\n1012    student12\n1013    student13\n1014    student14\n1015    student15\n1016    student16\n</code></pre> <p>\uff081\uff09\u666e\u901a\u521b\u5efa\u8868</p> <pre><code>hive (default)&gt;\ncreate table if not exists student(\nid int, name string\n)\nrow format delimited fields terminated by '\\t'\nlocation '/user/hive/warehouse/student';\n</code></pre> <p>\u4e0a\u4f20\u6570\u636e</p> <pre><code>hadoop fs -put student.txt /user/hive/warehouse/student\n</code></pre> <p>\uff082\uff09\u6839\u636e\u67e5\u8be2\u7ed3\u679c\u521b\u5efa\u8868\uff08\u67e5\u8be2\u7684\u7ed3\u679c\u4f1a\u6dfb\u52a0\u5230\u65b0\u521b\u5efa\u7684\u8868\u4e2d\uff09</p> <pre><code>create table if not exists student2 as select id, name from student;\n</code></pre> <p>\uff083\uff09\u6839\u636e\u5df2\u7ecf\u5b58\u5728\u7684\u8868\u7ed3\u6784\u521b\u5efa\u8868</p> <pre><code>create table if not exists student3 like student;\n</code></pre> <p>\uff084\uff09\u67e5\u8be2\u8868\u7684\u7c7b\u578b</p> <pre><code>desc formatted student2;\n</code></pre> <p>\uff085\uff09\u5220\u9664\u7ba1\u7406\u8868\uff0c\u5e76\u67e5\u770b\u8868\u6570\u636e\u662f\u5426\u8fd8\u5b58\u5728</p> <pre><code>drop table student2;\n</code></pre>"},{"location":"engine/hive/hive_04/#452","title":"4.5.2 \u5916\u90e8\u8868","text":"<p>1\uff09\u7406\u8bba</p> <p>\u56e0\u4e3a\u8868\u662f\u5916\u90e8\u8868\uff0c\u6240\u4ee5 Hive \u5e76\u975e\u8ba4\u4e3a\u5176\u5b8c\u5168\u62e5\u6709\u8fd9\u4efd\u6570\u636e\u3002\u5220\u9664\u8be5\u8868\u5e76\u4e0d\u4f1a\u5220\u9664\u6389\u8fd9\u4efd\u6570\u636e\uff0c\u4e0d\u8fc7\u63cf\u8ff0\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\u4f1a\u88ab\u5220\u9664\u6389\u3002</p> <p>2\uff09\u7ba1\u7406\u8868\u548c\u5916\u90e8\u8868\u7684\u4f7f\u7528\u573a\u666f</p> <p>\u6bcf\u5929\u5c06\u6536\u96c6\u5230\u7684\u7f51\u7ad9\u65e5\u5fd7\u5b9a\u671f\u6d41\u5165 HDFS \u6587\u672c\u6587\u4ef6\u3002\u5728\u5916\u90e8\u8868\uff08\u539f\u59cb\u65e5\u5fd7\u8868\uff09\u7684\u57fa\u7840\u4e0a\u505a\u5927\u91cf\u7684\u7edf\u8ba1\u5206\u6790\uff0c\u7528\u5230\u7684\u4e2d\u95f4\u8868\u3001\u7ed3\u679c\u8868\u4f7f\u7528\u5185\u90e8\u8868\u5b58\u50a8\uff0c\u6570\u636e\u901a\u8fc7 select + insert \u8fdb\u5165\u5185\u90e8\u8868\u3002</p> <p>3\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u521b\u5efa\u8001\u5e08\u8868\uff0c\u5e76\u5411\u8868\u4e2d\u5bfc\u5165\u6570\u636e\u3002</p> <p>\uff080\uff09\u539f\u59cb\u6570\u636e</p> <p>\u5728 /opt/module/hive/datas \u8def\u5f84\u4e0a\uff0c\u521b\u5efa teacher.txt \u6587\u4ef6\uff0c\u5e76\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\u3002</p> teacher.txt<pre><code>1001    teacher1\n1002    teacher2\n1003    teacher3\n1004    teacher4\n1005    teacher5\n1006    teacher6\n1007    teacher7\n1008    teacher8\n1009    teacher9\n1010    teacher10\n1011    teacher11\n1012    teacher12\n1013    teacher13\n1014    teacher14\n1015    teacher15\n1016    teacher16\n</code></pre> <p>\uff081\uff09\u4e0a\u4f20\u6570\u636e\u5230 HDFS</p> <pre><code>hadoop fs -mkdir -p /school/teacher\n\nhadoop fs -put teacher.txt /school/teacher\n</code></pre> <p>\uff082\uff09\u5efa\u8868\u8bed\u53e5\uff0c\u521b\u5efa\u5916\u90e8\u8868</p> <pre><code>create external table if not exists teacher(\nid int, name string\n)\nrow format delimited fields terminated by '\\t'\nlocation '/school/teacher';\n</code></pre> <p>\uff083\uff09\u67e5\u770b\u521b\u5efa\u7684\u8868</p> <pre><code>show tables;\n</code></pre> <p>\uff084\uff09\u67e5\u770b\u8868\u683c\u5f0f\u5316\u6570\u636e</p> <pre><code>desc formatted teacher;\n</code></pre> <p>\uff085\uff09\u5220\u9664\u5916\u90e8\u8868</p> <pre><code>drop table teacher;\n</code></pre> <p>\u5916\u90e8\u8868\u5220\u9664\u540e\uff0cHDFS \u4e2d\u7684\u6570\u636e\u8fd8\u5728\uff0c\u4f46\u662f metadata \u4e2d teacher \u7684\u5143\u6570\u636e\u5df2\u88ab\u5220\u9664\u3002</p> <p></p>"},{"location":"engine/hive/hive_04/#453","title":"4.5.3 \u7ba1\u7406\u8868\u4e0e\u5916\u90e8\u8868\u7684\u4e92\u76f8\u8f6c\u6362","text":"<p>\uff081\uff09\u67e5\u8be2\u8868\u7684\u7c7b\u578b</p> <pre><code>desc formatted student3;\n</code></pre> <p>\uff082\uff09\u4fee\u6539\u5185\u90e8\u8868 student \u4e3a\u5916\u90e8\u8868</p> <pre><code>alter table student3 set tblproperties('EXTERNAL'='TRUE');\n</code></pre> <p>\uff083\uff09\u67e5\u8be2\u8868\u7684\u7c7b\u578b</p> <pre><code>desc formatted student3;\n</code></pre> <p>\uff084\uff09\u4fee\u6539\u5916\u90e8\u8868 student \u4e3a\u5185\u90e8\u8868</p> <pre><code>alter table student3 set tblproperties('EXTERNAL'='FALSE');\n</code></pre> <p>\uff085\uff09\u67e5\u8be2\u8868\u7684\u7c7b\u578b</p> <pre><code>desc formatted student3;\n</code></pre> <p>\u6ce8\u610f\uff1a<code>('EXTERNAL'='TRUE')</code>\u548c<code>('EXTERNAL'='FALSE')</code> \u4e3a\u56fa\u5b9a\u5199\u6cd5\uff0c\u533a\u5206\u5927\u5c0f\u5199\u3002</p>"},{"location":"engine/hive/hive_04/#46","title":"4.6 \u4fee\u6539\u8868","text":""},{"location":"engine/hive/hive_04/#461","title":"4.6.1 \u91cd\u547d\u540d\u8868","text":"<p>1\uff09\u8bed\u6cd5</p> <pre><code>ALTER TABLE table_name RENAME TO new_table_name\n</code></pre> <p>2\uff09\u5b9e\u64cd\u6848\u4f8b</p> <pre><code>alter table student3 rename to student2;\n</code></pre>"},{"location":"engine/hive/hive_04/#462","title":"4.6.2 \u589e\u52a0/\u4fee\u6539/\u66ff\u6362\u5217\u4fe1\u606f","text":"<p>1\uff09\u8bed\u6cd5</p> <p>\uff081\uff09\u66f4\u65b0\u5217</p> <p>\u66f4\u65b0\u5217\uff0c\u5217\u540d\u53ef\u4ee5\u968f\u610f\u4fee\u6539\uff0c\u5217\u7684\u7c7b\u578b\u53ea\u80fd\u5c0f\u6539\u5927\uff0c\u4e0d\u80fd\u5927\u6539\u5c0f\uff08\u9075\u5faa\u81ea\u52a8\u8f6c\u6362\u89c4\u5219\uff09\u3002</p> <pre><code>ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment]\n</code></pre> <p>\uff082\uff09\u589e\u52a0\u548c\u66ff\u6362\u5217</p> <pre><code>ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...) </code></pre> <p>\u6ce8</p> <p>ADD \u662f\u4ee3\u8868\u65b0\u589e\u4e00\u4e2a\u5b57\u6bb5\uff0c\u5b57\u6bb5\u4f4d\u7f6e\u5728\u6240\u6709\u5217\u540e\u9762\uff08 partition \u5217\u524d\uff09\uff0cREPLACE \u5219\u662f\u8868\u793a\u66ff\u6362\u8868\u4e2d\u6240\u6709\u5b57\u6bb5\uff0cREPLACE \u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5b57\u6bb5\u7684\u7c7b\u578b\u8981\u8ddf\u4e4b\u524d\u7684\u7c7b\u578b\u5bf9\u5e94\u4e0a\uff0c\u6570\u91cf\u53ef\u4ee5\u51cf\u5c11\u6216\u8005\u589e\u52a0\uff0c\u5176\u5b9e\u5c31\u662f\u5305\u542b\u4e86\u66f4\u65b0\u5217\uff0c\u589e\u52a0\u5217\uff0c\u5220\u9664\u5217\u7684\u529f\u80fd\u3002</p> <p>2\uff09\u5b9e\u64cd\u6848\u4f8b</p> <p>\uff081\uff09\u67e5\u8be2\u8868\u7ed3\u6784</p> <pre><code>desc student;\n</code></pre> <p>\uff082\uff09\u6dfb\u52a0\u5217</p> <pre><code>alter table student add columns(age int);\n</code></pre> <p>\uff083\uff09\u67e5\u8be2\u8868\u7ed3\u6784</p> <pre><code>desc student;\n</code></pre> <p>\uff084\uff09\u66f4\u65b0\u5217</p> <pre><code>alter table student change column age ages double;\n</code></pre> <p>\uff085\uff09\u67e5\u8be2\u8868\u7ed3\u6784</p> <pre><code>desc student;\n</code></pre> <p>\uff086\uff09\u66ff\u6362\u5217</p> <pre><code>alter table student replace columns(id int, name string);\n</code></pre> <p>\uff087\uff09\u67e5\u8be2\u8868\u7ed3\u6784</p> <pre><code>desc student;\n</code></pre>"},{"location":"engine/hive/hive_04/#47","title":"4.7 \u5220\u9664\u8868","text":"<pre><code>drop table student2;\n</code></pre>"},{"location":"engine/hive/hive_04/#48","title":"4.8 \u6e05\u9664\u8868","text":"<p>\u6ce8\u610f\uff1atruncate \u53ea\u80fd\u5220\u9664\u7ba1\u7406\u8868\uff0c\u4e0d\u80fd\u5220\u9664\u5916\u90e8\u8868\u4e2d\u6570\u636e\u3002</p> <pre><code>truncate table student;\n</code></pre>"},{"location":"engine/hive/hive_05/","title":"\u7b2c5\u7ae0 DML\uff08Data Manipulation Language\uff09\u6570\u636e\u64cd\u4f5c","text":""},{"location":"engine/hive/hive_05/#51","title":"5.1 \u6570\u636e\u5bfc\u5165","text":""},{"location":"engine/hive/hive_05/#511-load","title":"5.1.1 \u5411\u8868\u4e2d\u88c5\u8f7d\u6570\u636e\uff08Load\uff09","text":"<p>1\uff09\u8bed\u6cd5</p> <pre><code>load data [local] inpath '\u6570\u636e\u7684path' [overwrite] into table table_name [partition (partcol1=val1,\u2026)];\n</code></pre> <p>\uff081\uff09load data\uff1a\u8868\u793a\u52a0\u8f7d\u6570\u636e\u3002</p> <p>\uff082\uff09local\uff1a\u8868\u793a\u4ece\u672c\u5730\u52a0\u8f7d\u6570\u636e\u5230 Hive \u8868\uff1b\u5426\u5219\u4ece HDFS \u52a0\u8f7d\u6570\u636e\u5230 Hive \u8868\u3002</p> <p>\uff083\uff09inpath\uff1a\u8868\u793a\u52a0\u8f7d\u6570\u636e\u7684\u8def\u5f84\u3002</p> <p>\uff084\uff09overwrite\uff1a\u8868\u793a\u8986\u76d6\u8868\u4e2d\u5df2\u6709\u6570\u636e\uff0c\u5426\u5219\u8868\u793a\u8ffd\u52a0\u3002</p> <p>\uff085\uff09into table\uff1a\u8868\u793a\u52a0\u8f7d\u5230\u54ea\u5f20\u8868\u3002</p> <p>\uff086\uff09student\uff1a\u8868\u793a\u5177\u4f53\u7684\u8868\u3002</p> <p>\uff087\uff09partition\uff1a\u8868\u793a\u4e0a\u4f20\u5230\u6307\u5b9a\u5206\u533a\u3002</p> <p>2\uff09\u5b9e\u64cd\u6848\u4f8b</p> <p>\uff080\uff09\u521b\u5efa\u4e00\u5f20\u8868</p> <pre><code>create table student(\nid int, name string\n) row format delimited fields terminated by '\\t';\n</code></pre> <p>\uff081\uff09\u52a0\u8f7d\u672c\u5730\u6587\u4ef6\u5230 hive</p> <pre><code>load data local inpath '/opt/module/hive/datas/student.txt' into table student;\n</code></pre> <p>\uff082\uff09\u52a0\u8f7d HDFS \u6587\u4ef6\u5230 hive \u4e2d</p> <p>\u2460\u4e0a\u4f20\u6587\u4ef6\u5230 HDFS</p> <pre><code>dfs -put /opt/module/hive/datas/student.txt /user/atguigu;\n</code></pre> <p>\u2461\u52a0\u8f7d HDFS \u4e0a\u6570\u636e\uff0c\u5bfc\u5165\u5b8c\u6210\u540e\u53bb HDFS \u4e0a\u67e5\u770b\u6587\u4ef6\u662f\u5426\u8fd8\u5b58\u5728</p> <pre><code>load data inpath '/user/atguigu/student.txt' into table student;\n</code></pre> <p>\uff083\uff09\u52a0\u8f7d\u6570\u636e\u8986\u76d6\u8868\u4e2d\u5df2\u6709\u7684\u6570\u636e</p> <p>\u2460\u4e0a\u4f20\u6587\u4ef6\u5230 HDFS</p> <pre><code>dfs -put /opt/module/hive/datas/student.txt /user/atguigu;\n</code></pre> <p>\u2461\u52a0\u8f7d\u6570\u636e\u8986\u76d6\u8868\u4e2d\u5df2\u6709\u7684\u6570\u636e</p> <pre><code>load data inpath '/user/atguigu/student.txt' overwrite into table student;\n</code></pre>"},{"location":"engine/hive/hive_05/#512-insert","title":"5.1.2 \u901a\u8fc7\u67e5\u8be2\u8bed\u53e5\u5411\u8868\u4e2d\u63d2\u5165\u6570\u636e\uff08Insert\uff09","text":"<p>1\uff09\u521b\u5efa\u4e00\u5f20\u8868</p> <pre><code>create table student3(\nid int, name string\n) row format delimited fields terminated by '\\t';\n</code></pre> <p>2\uff09\u57fa\u672c\u6a21\u5f0f\u63d2\u5165\u6570\u636e</p> <pre><code>insert into table  student3 values(1,'wangwu'),(2,'zhaoliu');\n</code></pre> <p>3\uff09\u6839\u636e\u67e5\u8be2\u7ed3\u679c\u63d2\u5165\u6570\u636e</p> <pre><code>insert overwrite table student3 select id, name from student where id &lt; 1006;\n</code></pre> <p>insert into\uff1a\u4ee5\u8ffd\u52a0\u6570\u636e\u7684\u65b9\u5f0f\u63d2\u5165\u5230\u8868\u6216\u5206\u533a\uff0c\u539f\u6709\u6570\u636e\u4e0d\u4f1a\u5220\u9664\u3002</p> <p>insert overwrite\uff1a\u4f1a\u8986\u76d6\u8868\u4e2d\u5df2\u5b58\u5728\u7684\u6570\u636e\u3002</p> <p>\u6ce8\u610f</p> <p>insert \u4e0d\u652f\u6301\u63d2\u5165\u90e8\u5206\u5b57\u6bb5\uff0c\u5e76\u4e14\u540e\u8fb9\u8ddf select \u8bed\u53e5\u65f6\uff0cselect \u4e4b\u524d\u4e0d\u80fd\u52a0 as\uff0c\u52a0\u4e86 as \u4f1a\u62a5\u9519\uff0c\u4e00\u5b9a\u8981\u8ddf\u4e0b\u9762\u7684 as select \u533a\u5206\u5f00\u3002</p>"},{"location":"engine/hive/hive_05/#513-as-select","title":"5.1.3 \u67e5\u8be2\u8bed\u53e5\u4e2d\u521b\u5efa\u8868\u5e76\u52a0\u8f7d\u6570\u636e\uff08As Select\uff09","text":"<p>\u6839\u636e\u67e5\u8be2\u7ed3\u679c\u521b\u5efa\u8868\uff08\u67e5\u8be2\u7684\u7ed3\u679c\u4f1a\u6dfb\u52a0\u5230\u65b0\u521b\u5efa\u7684\u8868\u4e2d\uff09\u3002</p> <pre><code>create table if not exists student4 as select id, name from student;\n</code></pre>"},{"location":"engine/hive/hive_05/#514-location","title":"5.1.4 \u521b\u5efa\u8868\u65f6\u901a\u8fc7Location\u6307\u5b9a\u52a0\u8f7d\u6570\u636e\u8def\u5f84","text":"<p>1\uff09\u4e0a\u4f20\u6570\u636e\u5230 HDFS \u4e0a</p> <pre><code>hadoop fs -mkdir -p /student5;\nhadoop fs -put student.txt /student5\n</code></pre> <p>2\uff09\u521b\u5efa\u8868\uff0c\u5e76\u6307\u5b9a\u5728 HDFS \u4e0a\u7684\u4f4d\u7f6e</p> <pre><code>create external table if not exists student5(\nid int, name string\n)\nrow format delimited fields terminated by '\\t'\nlocation '/student5';\n</code></pre> <p>3\uff09\u67e5\u8be2\u6570\u636e</p> <pre><code>select * from student5;\n</code></pre>"},{"location":"engine/hive/hive_05/#515-importhive","title":"5.1.5 Import\u6570\u636e\u5230\u6307\u5b9aHive\u8868\u4e2d","text":"<p>\u6ce8\u610f</p> <p>\u5148\u7528 export \u5bfc\u51fa\u540e\uff0c\u518d\u5c06\u6570\u636e\u5bfc\u5165\u3002\u5e76\u4e14\u56e0\u4e3a export \u5bfc\u51fa\u7684\u6570\u636e\u91cc\u9762\u5305\u542b\u4e86\u5143\u6570\u636e\uff0c\u56e0\u6b64 import \u8981\u5bfc\u5165\u7684\u8868\u4e0d\u53ef\u4ee5\u5b58\u5728\uff0c\u5426\u5219\u62a5\u9519\u3002</p> <pre><code>import table student2 from '/user/hive/warehouse/export/student';\n</code></pre>"},{"location":"engine/hive/hive_05/#52","title":"5.2 \u6570\u636e\u5bfc\u51fa","text":""},{"location":"engine/hive/hive_05/#521-insert","title":"5.2.1 Insert\u5bfc\u51fa","text":"<p>1\uff09\u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u5bfc\u51fa\u5230\u672c\u5730</p> <pre><code>insert overwrite local directory '/opt/module/hive/datas/export/student' select * from student;\n</code></pre> <p>2\uff09\u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u683c\u5f0f\u5316\u5bfc\u51fa\u5230\u672c\u5730</p> <pre><code>insert overwrite local directory '/opt/module/hive/datas/export/student' row format delimited fields terminated by '\\t' select * from student;\n</code></pre> <p>3\uff09\u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u5bfc\u51fa\u5230 HDFS \u4e0a\uff08\u6ca1\u6709 local \uff09</p> <pre><code>insert overwrite directory '/user/atguigu/student2' row format delimited fields terminated by '\\t' select * from student;\n</code></pre> <p>\u6ce8\u610f</p> <p>insert \u5bfc\u51fa\uff0c\u5bfc\u51fa\u7684\u76ee\u5f55\u4e0d\u7528\u81ea\u5df1\u63d0\u524d\u521b\u5efa\uff0cHive \u4f1a\u5e2e\u6211\u4eec\u81ea\u52a8\u521b\u5efa\uff0c\u4f46\u662f\u7531\u4e8e\u662f overwrite\uff0c\u6240\u4ee5\u5bfc\u51fa\u8def\u5f84\u4e00\u5b9a\u8981\u5199\u5177\u4f53\uff0c\u5426\u5219\u5f88\u53ef\u80fd\u4f1a\u8bef\u5220\u6570\u636e\u3002\u8fd9\u4e2a\u6b65\u9aa4\u5f88\u91cd\u8981\uff0c\u5207\u52ff\u5927\u610f\u3002</p>"},{"location":"engine/hive/hive_05/#522-exporthdfs","title":"5.2.2 Export\u5bfc\u51fa\u5230HDFS","text":"<pre><code>export table default.student to '/user/hive/warehouse/export/student';\n</code></pre> <p>Export \u548c Import \u4e3b\u8981\u7528\u4e8e\u4e24\u4e2a Hadoop \u5e73\u53f0\u96c6\u7fa4\u4e4b\u95f4 Hive \u8868\u8fc1\u79fb\uff0c\u4e0d\u80fd\u76f4\u63a5\u5bfc\u51fa\u5230\u672c\u5730\u3002</p>"},{"location":"engine/hive/hive_06/","title":"\u7b2c6\u7ae0 \u67e5\u8be2","text":""},{"location":"engine/hive/hive_06/#61","title":"6.1 \u57fa\u7840\u8bed\u6cd5\u53ca\u6267\u884c\u987a\u5e8f","text":"<p>1\uff09\u5b98\u7f51\u5730\u5740</p> <p>2\uff09\u67e5\u8be2\u8bed\u53e5\u8bed\u6cd5\uff1a</p> <pre><code>SELECT [ALL | DISTINCT] select_expr, select_expr, ...\nFROM table_reference       -- \u4ece\u4ec0\u4e48\u8868\u67e5\n[WHERE where_condition]   -- \u8fc7\u6ee4\n[GROUP BY col_list]        -- \u5206\u7ec4\u67e5\u8be2\n[HAVING col_list]          -- \u5206\u7ec4\u540e\u8fc7\u6ee4\n[ORDER BY col_list]        -- \u6392\u5e8f    \u7edf\u79f0\u4e3ahive\u4e2d4\u4e2aby\n[CLUSTER BY col_list\n| [DISTRIBUTE BY col_list] [SORT BY col_list]\n]\n[LIMIT number]                -- \u9650\u5236\u8f93\u51fa\u7684\u884c\u6570\n</code></pre> <p></p>"},{"location":"engine/hive/hive_06/#62-selectfrom","title":"6.2 \u57fa\u672c\u67e5\u8be2\uff08Select\u2026From\uff09","text":""},{"location":"engine/hive/hive_06/#621","title":"6.2.1 \u6570\u636e\u51c6\u5907","text":"<p>\uff080\uff09\u539f\u59cb\u6570\u636e</p> <p>\u2460\u5728 /opt/module/hive/datas/ \u8def\u5f84\u4e0a\u521b\u5efa dept.txt \u6587\u4ef6\uff0c\u5e76\u8d4b\u503c\u5982\u4e0b\u5185\u5bb9\uff1a</p> <p>\u90e8\u95e8\u7f16\u53f7 \u90e8\u95e8\u540d\u79f0 \u90e8\u95e8\u4f4d\u7f6eid</p> dept.txt<pre><code>10  \u884c\u653f\u90e8 1700\n20  \u8d22\u52a1\u90e8 1800\n30  \u6559\u5b66\u90e8 1900\n40  \u9500\u552e\u90e8 1700\n</code></pre> <p>\u2461\u5728 /opt/module/hive/datas/ \u8def\u5f84\u4e0a\u521b\u5efa emp.txt \u6587\u4ef6\uff0c\u5e76\u8d4b\u503c\u5982\u4e0b\u5185\u5bb9\uff1a</p> <p>\u5458\u5de5\u7f16\u53f7 \u59d3\u540d \u5c97\u4f4d    \u85aa\u8d44  \u90e8\u95e8</p> emp.txt<pre><code>7369    \u5f20\u4e09  \u7814\u53d1  800.00  30\n7499    \u674e\u56db  \u8d22\u52a1  1600.00 20\n7521    \u738b\u4e94  \u884c\u653f  1250.00 10\n7566    \u8d75\u516d  \u9500\u552e  2975.00 40\n7654    \u4faf\u4e03  \u7814\u53d1  1250.00 30\n7698    \u9a6c\u516b  \u7814\u53d1  2850.00 30\n7782    \u91d1\u4e5d  \\N  2450.0  30\n7788    \u94f6\u5341  \u884c\u653f  3000.00 10\n7839    \u5c0f\u82b3  \u9500\u552e  5000.00 40\n7844    \u5c0f\u660e  \u9500\u552e  1500.00 40\n7876    \u5c0f\u674e  \u884c\u653f  1100.00 10\n7900    \u5c0f\u5143  \u8bb2\u5e08  950.00  30\n7902    \u5c0f\u6d77  \u884c\u653f  3000.00 10\n7934    \u5c0f\u7ea2\u660e \u8bb2\u5e08  1300.00 30\n</code></pre> <p>\uff081\uff09\u521b\u5efa\u90e8\u95e8\u8868</p> <pre><code>hive (default)&gt;\ncreate table if not exists dept(\ndeptno int,    -- \u90e8\u95e8\u7f16\u53f7\ndname string,  -- \u90e8\u95e8\u540d\u79f0\nloc int        -- \u90e8\u95e8\u4f4d\u7f6e\n)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>\uff082\uff09\u521b\u5efa\u5458\u5de5\u8868</p> <pre><code>create table if not exists emp(\nempno int,      -- \u5458\u5de5\u7f16\u53f7\nename string,   -- \u5458\u5de5\u59d3\u540d\njob string,     -- \u5458\u5de5\u5c97\u4f4d\uff08\u5927\u6570\u636e\u5de5\u7a0b\u5e08\u3001\u524d\u7aef\u5de5\u7a0b\u5e08\u3001java\u5de5\u7a0b\u5e08\uff09\nsal double,     -- \u5458\u5de5\u85aa\u8d44\ndeptno int      -- \u90e8\u95e8\u7f16\u53f7\n)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>\uff083\uff09\u5bfc\u5165\u6570\u636e</p> <pre><code>load data local inpath '/opt/module/hive/datas/dept.txt' into table dept;\nload data local inpath '/opt/module/hive/datas/emp.txt' into table emp;\n</code></pre>"},{"location":"engine/hive/hive_06/#622","title":"6.2.2 \u5168\u8868\u548c\u7279\u5b9a\u5217\u67e5\u8be2","text":"<p>1\uff09\u5168\u8868\u67e5\u8be2</p> <pre><code>select * from emp;\n</code></pre> <p>2\uff09\u9009\u62e9\u7279\u5b9a\u5217\u67e5\u8be2</p> <pre><code>select empno, ename from emp;\n</code></pre> <p>\u6ce8\u610f</p> <ul> <li>SQL \u8bed\u8a00\u5927\u5c0f\u5199\u4e0d\u654f\u611f</li> <li>SQL \u53ef\u4ee5\u5199\u5728\u4e00\u884c\u6216\u8005\u591a\u884c</li> <li>\u5173\u952e\u5b57\u4e0d\u80fd\u88ab\u7f29\u5199\u4e5f\u4e0d\u80fd\u5206\u884c</li> <li>\u5404\u5b50\u53e5\u4e00\u822c\u8981\u5206\u884c\u5199</li> <li>\u4f7f\u7528\u7f29\u8fdb\u63d0\u9ad8\u8bed\u53e5\u7684\u53ef\u8bfb\u6027</li> </ul>"},{"location":"engine/hive/hive_06/#623","title":"6.2.3 \u5217\u522b\u540d","text":"<p>1\uff09\u91cd\u547d\u540d\u4e00\u4e2a\u5217</p> <p>2\uff09\u4fbf\u4e8e\u8ba1\u7b97</p> <p>3\uff09\u7d27\u8ddf\u5217\u540d\uff0c\u4e5f\u53ef\u4ee5\u5728\u5217\u540d\u548c\u522b\u540d\u4e4b\u95f4\u52a0\u5165\u5173\u952e\u5b57\u2018AS\u2019 </p> <p>4\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u67e5\u8be2\u540d\u79f0\u548c\u90e8\u95e8\u3002</p> <pre><code>select ename AS name, deptno dn from emp;\n</code></pre>"},{"location":"engine/hive/hive_06/#624-limit","title":"6.2.4 Limit\u8bed\u53e5","text":"<p>\u5178\u578b\u7684\u67e5\u8be2\u4f1a\u8fd4\u56de\u591a\u884c\u6570\u636e\u3002limit \u5b50\u53e5\u7528\u4e8e\u9650\u5236\u8fd4\u56de\u7684\u884c\u6570\u3002</p> <pre><code>select * from emp limit 5; select * from emp limit 2,3; -- \u8868\u793a\u4ece\u7b2c2\u884c\u5f00\u59cb\uff0c\u5411\u4e0b\u6293\u53d63\u884c\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p>\u5e95\u5c42\u4e0d\u6267\u884c MapReduce \u7a0b\u5e8f\uff0c\u76f4\u63a5\u6293\u53d6\u6570\u636e\u3002</p>"},{"location":"engine/hive/hive_06/#625-where","title":"6.2.5 Where\u8bed\u53e5","text":"<p>1\uff09\u4f7f\u7528 where \u5b50\u53e5\uff0c\u5c06\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u884c\u8fc7\u6ee4\u6389</p> <p>2\uff09where \u5b50\u53e5\u7d27\u968f from \u5b50\u53e5</p> <p>3\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u67e5\u8be2\u51fa\u85aa\u6c34\u5927\u4e8e 1000 \u7684\u6240\u6709\u5458\u5de5\u3002</p> <pre><code>select * from emp where sal &gt; 1000;\n</code></pre> <p>\u6ce8\u610f</p> <p>where \u5b50\u53e5\u4e2d\u4e0d\u80fd\u4f7f\u7528\u5b57\u6bb5\u522b\u540d\u3002</p> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p>\u5e95\u5c42\u4e0d\u6267\u884c MapReduce \u7a0b\u5e8f\uff0c\u5148\u8fc7\u6ee4 sal &gt; 1000 \u7684\u6570\u636e\uff0c\u7136\u540e\u6293\u53d6\u5168\u90e8\u6570\u636e\u3002</p>"},{"location":"engine/hive/hive_06/#626","title":"6.2.6 \u5173\u7cfb\u8fd0\u7b97\u51fd\u6570","text":"<p>1\uff09\u57fa\u672c\u8bed\u6cd5</p> <p>\u5982\u4e0b\u64cd\u4f5c\u7b26\u4e3b\u8981\u7528\u4e8e where\u3001join\u2026on \u548c having \u8bed\u53e5\u4e2d\u3002</p> \u64cd\u4f5c\u7b26 \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b \u63cf\u8ff0 A=B \u57fa\u672c\u6570\u636e\u7c7b\u578b \u5982\u679cA\u7b49\u4e8eB\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse A&lt;=&gt;B \u57fa\u672c\u6570\u636e\u7c7b\u578b \u5982\u679cA\u548cB\u90fd\u4e3anull\uff0c\u5219\u8fd4\u56detrue\uff0c\u5982\u679c\u4e00\u8fb9\u4e3anull\uff0c\u8fd4\u56defalse A&lt;&gt;B, A!=B \u57fa\u672c\u6570\u636e\u7c7b\u578b A\u6216\u8005B\u4e3anull\u5219\u8fd4\u56denull\uff1b\u5982\u679cA\u4e0d\u7b49\u4e8eB\uff0c\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse A&lt;B \u57fa\u672c\u6570\u636e\u7c7b\u578b A\u6216\u8005B\u4e3anull\uff0c\u5219\u8fd4\u56denull\uff1b\u5982\u679cA\u5c0f\u4e8eB\uff0c\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse A&lt;=B \u57fa\u672c\u6570\u636e\u7c7b\u578b A\u6216\u8005B\u4e3anull\uff0c\u5219\u8fd4\u56denull\uff1b\u5982\u679cA\u5c0f\u4e8e\u7b49\u4e8eB\uff0c\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse A&gt;B \u57fa\u672c\u6570\u636e\u7c7b\u578b A\u6216\u8005B\u4e3anull\uff0c\u5219\u8fd4\u56denull\uff1b\u5982\u679cA\u5927\u4e8eB\uff0c\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse A&gt;=B \u57fa\u672c\u6570\u636e\u7c7b\u578b A\u6216\u8005B\u4e3anull\uff0c\u5219\u8fd4\u56denull\uff1b\u5982\u679cA\u5927\u4e8e\u7b49\u4e8eB\uff0c\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse A [not] between B and C \u57fa\u672c\u6570\u636e\u7c7b\u578b \u5982\u679cA\uff0cB\u6216\u8005C\u4efb\u4e00\u4e3anull\uff0c\u5219\u7ed3\u679c\u4e3anull\u3002\u5982\u679cA\u7684\u503c\u5927\u4e8e\u7b49\u4e8eB\u800c\u4e14\u5c0f\u4e8e\u6216\u7b49\u4e8eC\uff0c\u5219\u7ed3\u679c\u4e3atrue\uff0c\u53cd\u4e4b\u4e3afalse\u3002\u5982\u679c\u4f7f\u7528not\u5173\u952e\u5b57\u5219\u53ef\u8fbe\u5230\u76f8\u53cd\u7684\u6548\u679c\u3002 A is null \u6240\u6709\u6570\u636e\u7c7b\u578b \u5982\u679cA\u7b49\u4e8enull\uff0c\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse A is not null \u6240\u6709\u6570\u636e\u7c7b\u578b \u5982\u679cA\u4e0d\u7b49\u4e8enull\uff0c\u5219\u8fd4\u56detrue\uff0c\u53cd\u4e4b\u8fd4\u56defalse in\uff08\u6570\u503c1\uff0c\u6570\u503c2\uff09 \u6240\u6709\u6570\u636e\u7c7b\u578b \u4f7f\u7528 in\u8fd0\u7b97\u663e\u793a\u5217\u8868\u4e2d\u7684\u503c A [not] like B string \u7c7b\u578b B\u662f\u4e00\u4e2aSQL\u4e0b\u7684\u7b80\u5355\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4e5f\u53eb\u901a\u914d\u7b26\u6a21\u5f0f\uff0c\u5982\u679cA\u4e0e\u5176\u5339\u914d\u7684\u8bdd\uff0c\u5219\u8fd4\u56detrue\uff1b\u53cd\u4e4b\u8fd4\u56defalse\u3002B\u7684\u8868\u8fbe\u5f0f\u8bf4\u660e\u5982\u4e0b\uff1a\u2018x%\u2019\u8868\u793aA\u5fc5\u987b\u4ee5\u5b57\u6bcd\u2018x\u2019\u5f00\u5934\uff0c\u2018%x\u2019\u8868\u793aA\u5fc5\u987b\u4ee5\u5b57\u6bcd\u2018x\u2019\u7ed3\u5c3e\uff0c\u800c\u2018%x%\u2019\u8868\u793aA\u5305\u542b\u6709\u5b57\u6bcd\u2018x\u2019,\u53ef\u4ee5\u4f4d\u4e8e\u5f00\u5934\uff0c\u7ed3\u5c3e\u6216\u8005\u5b57\u7b26\u4e32\u4e2d\u95f4\u3002\u5982\u679c\u4f7f\u7528not\u5173\u952e\u5b57\u5219\u53ef\u8fbe\u5230\u76f8\u53cd\u7684\u6548\u679c\u3002 A rlike B, A regexp B string \u7c7b\u578b B\u662f\u57fa\u4e8ejava\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5982\u679cA\u4e0e\u5176\u5339\u914d\uff0c\u5219\u8fd4\u56detrue\uff1b\u53cd\u4e4b\u8fd4\u56defalse\u3002\u5339\u914d\u4f7f\u7528\u7684\u662fJDK\u4e2d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u63a5\u53e3\u5b9e\u73b0\u7684\uff0c\u56e0\u4e3a\u6b63\u5219\u4e5f\u4f9d\u636e\u5176\u4e2d\u7684\u89c4\u5219\u3002\u4f8b\u5982\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u5fc5\u987b\u548c\u6574\u4e2a\u5b57\u7b26\u4e32A\u76f8\u5339\u914d\uff0c\u800c\u4e0d\u662f\u53ea\u9700\u4e0e\u5176\u5b57\u7b26\u4e32\u5339\u914d\u3002 <p>2\uff09\u6848\u4f8b\u5b9e\u64cd\uff08between/In/ Is null\uff09</p> <p>\uff081\uff09\u67e5\u8be2\u51fa\u85aa\u6c34\u7b49\u4e8e 5000 \u7684\u6240\u6709\u5458\u5de5</p> <pre><code>select * from emp where sal = 5000;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p>\u5e95\u5c42\u4e0d\u6267\u884c MapReduce \u7a0b\u5e8f\uff0c\u5148\u8fc7\u6ee4 sal = 5000 \u7684\u6570\u636e\uff0c\u7136\u540e\u6293\u53d6\u5168\u90e8\u6570\u636e\u3002</p> <p>\uff082\uff09\u67e5\u8be2\u5de5\u8d44\u5728 500 \u5230 1000 \u7684\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp where sal between 500 and 1000;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p>\u5e95\u5c42\u4e0d\u6267\u884c MapReduce \u7a0b\u5e8f\uff0c\u5148\u8fc7\u6ee4 sal \u5728 500 \u5230 1000 \u7684\u6570\u636e\uff0c\u7136\u540e\u6293\u53d6\u5168\u90e8\u6570\u636e\u3002</p> <p>\uff083\uff09\u67e5\u8be2 job \u4e3a\u7a7a\u7684\u6240\u6709\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp where job is null;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p>\u5e95\u5c42\u4e0d\u6267\u884c MapReduce \u7a0b\u5e8f\uff0c\u5148\u8fc7\u6ee4 job \u662f null \u7684\u6570\u636e\uff0c\u7136\u540e\u6293\u53d6\u5168\u90e8\u6570\u636e\u3002</p> <p>\uff084\uff09\u67e5\u8be2\u5de5\u8d44\u662f 1500 \u6216 5000 \u7684\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp where sal IN (1500, 5000);\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p>\u5e95\u5c42\u4e0d\u6267\u884c MapReduce \u7a0b\u5e8f\uff0c\u5148\u8fc7\u6ee4 sal \u662f 1500 \u6216\u8005 5000 \u7684\u6570\u636e\uff0c\u7136\u540e\u6293\u53d6\u5168\u90e8\u6570\u636e\u3002</p> <p>3\uff09\u6848\u4f8b\u5b9e\u64cd\uff08 like \u548c rlike \uff09</p> <p>\uff081\uff09\u4f7f\u7528 like \u8fd0\u7b97\u9009\u62e9\u7c7b\u4f3c\u7684\u503c</p> <p>\uff082\uff09\u9009\u62e9\u6761\u4ef6\u53ef\u4ee5\u5305\u542b\u5b57\u7b26\u6216\u6570\u5b57</p> <ul> <li>% \u4ee3\u8868\u96f6\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\uff08\u4efb\u610f\u4e2a\u5b57\u7b26\uff09</li> <li>_ \u4ee3\u8868\u4e00\u4e2a\u5b57\u7b26</li> </ul> <p>\uff083\uff09rlike \u5b50\u53e5</p> <p>rlike \u5b50\u53e5\u662f Hive \u4e2d\u8fd9\u4e2a\u529f\u80fd\u7684\u4e00\u4e2a\u6269\u5c55\uff0c\u5176\u53ef\u4ee5\u901a\u8fc7 Java \u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd9\u4e2a\u66f4\u5f3a\u5927\u7684\u8bed\u8a00\u6765\u6307\u5b9a\u5339\u914d\u6761\u4ef6\u3002</p> <p>\uff084\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u2460\u67e5\u627e\u540d\u5b57\u4ee5\"\u5c0f\"\u5f00\u5934\u7684\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp where ename like '\u5c0f%';\n\n\nselect * from emp where ename rlike '^\u5c0f';\n</code></pre> <p>\u2461\u67e5\u627e\u540d\u5b57\u4ee5\"\u660e\"\u7ed3\u5c3e\u7684\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp where ename like '\u5c0f%';\n\n\nselect * from emp where ename rlike '^\u5c0f';\n</code></pre> <p>\u2462\u67e5\u627e\u540d\u5b57\u4e2d\u5e26\u6709\"\u660e\"\u7684\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp where ename like '%\u660e%';\n\n\nselect * from emp where ename rlike '[\u660e]';\n</code></pre>"},{"location":"engine/hive/hive_06/#627","title":"6.2.7 \u903b\u8f91\u8fd0\u7b97\u51fd\u6570","text":"<p>1\uff09\u57fa\u672c\u8bed\u6cd5\uff08 and / or / not \uff09</p> \u64cd\u4f5c\u7b26 \u542b\u4e49 and \u903b\u8f91\u5e76 or \u903b\u8f91\u6216 not \u903b\u8f91\u5426 <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u67e5\u8be2\u85aa\u6c34\u5927\u4e8e 1000\uff0c\u90e8\u95e8\u662f 30</p> <pre><code>select * from emp where sal &gt; 1000 and deptno = 30;\n</code></pre> <p>\uff082\uff09\u67e5\u8be2\u85aa\u6c34\u5927\u4e8e 1000\uff0c\u6216\u8005\u90e8\u95e8\u662f 30</p> <pre><code>select * from emp where sal&gt;1000 or deptno=30;\n</code></pre> <p>\uff083\uff09\u67e5\u8be2\u9664\u4e86 20 \u90e8\u95e8\u548c 30 \u90e8\u95e8\u4ee5\u5916\u7684\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp where deptno not in(30, 20);\n</code></pre>"},{"location":"engine/hive/hive_06/#628","title":"6.2.8 \u805a\u5408\u51fd\u6570","text":"<p>1\uff09\u8bed\u6cd5</p> <ul> <li>count(*) : \u8868\u793a\u7edf\u8ba1\u6240\u6709\u884c\u6570\uff0c\u5305\u542b null \u503c</li> <li>count(\u67d0\u5217) : \u8868\u793a\u8be5\u5217\u4e00\u5171\u6709\u591a\u5c11\u884c\uff0c\u4e0d\u5305\u542b null \u503c</li> <li>max() : \u6c42\u6700\u5927\u503c\uff0c\u4e0d\u5305\u542b null\uff0c\u9664\u975e\u6240\u6709\u503c\u90fd\u662f null</li> <li>min() : \u6c42\u6700\u5c0f\u503c\uff0c\u4e0d\u5305\u542b null\uff0c\u9664\u975e\u6240\u6709\u503c\u90fd\u662f null</li> <li>sum() : \u6c42\u548c\uff0c\u4e0d\u5305\u542b null</li> <li>avg() : \u6c42\u5e73\u5747\u503c\uff0c\u4e0d\u5305\u542b null</li> </ul> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u6c42\u603b\u884c\u6570\uff08 count \uff09</p> <pre><code>select count(*) cnt from emp;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\uff082\uff09\u6c42\u5de5\u8d44\u7684\u6700\u5927\u503c\uff08max\uff09</p> <pre><code>select max(sal) max_sal from emp;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\uff083\uff09\u6c42\u5de5\u8d44\u7684\u6700\u5c0f\u503c\uff08min\uff09</p> <pre><code>select min(sal) min_sal from emp;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\uff084\uff09\u6c42\u5de5\u8d44\u7684\u603b\u548c\uff08sum\uff09</p> <pre><code>select sum(sal) sum_sal from emp; </code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\uff085\uff09\u6c42\u5de5\u8d44\u7684\u5e73\u5747\u503c\uff08avg\uff09</p> <pre><code>select avg(sal) avg_sal from emp;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_06/#63","title":"6.3 \u5206\u7ec4","text":""},{"location":"engine/hive/hive_06/#631-group-by","title":"6.3.1 Group By\u8bed\u53e5","text":"<p>Group By \u8bed\u53e5\u901a\u5e38\u4f1a\u548c\u805a\u5408\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\uff0c\u6309\u7167\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5217\u961f\u7ed3\u679c\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u7ec4\u6267\u884c\u805a\u5408\u64cd\u4f5c\u3002</p> <p>1\uff09\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <p>\uff081\uff09\u8ba1\u7b97 emp \u8868\u6bcf\u4e2a\u90e8\u95e8\u7684\u5e73\u5747\u5de5\u8d44\u3002</p> <pre><code>select t.deptno, avg(t.sal) avg_sal from emp t group by t.deptno;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\uff082\uff09\u8ba1\u7b97 emp \u6bcf\u4e2a\u90e8\u95e8\u4e2d\u6bcf\u4e2a\u5c97\u4f4d\u7684\u6700\u9ad8\u85aa\u6c34\u3002</p> <pre><code>select t.deptno, t.job, max(t.sal) max_sal from emp t group by t.deptno, t.job;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_06/#632-having","title":"6.3.2 Having\u8bed\u53e5","text":"<p>1\uff09having \u4e0e where \u4e0d\u540c\u70b9</p> <p>\uff081\uff09where \u540e\u9762\u4e0d\u80fd\u5199\u5206\u7ec4\u805a\u5408\u51fd\u6570\uff0c\u800c having \u540e\u9762\u53ef\u4ee5\u4f7f\u7528\u5206\u7ec4\u805a\u5408\u51fd\u6570\u3002</p> <p>\uff082\uff09having \u53ea\u7528\u4e8e group by \u5206\u7ec4\u7edf\u8ba1\u8bed\u53e5\u3002</p> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u6c42\u6bcf\u4e2a\u90e8\u95e8\u7684\u5e73\u5747\u85aa\u6c34\u5927\u4e8e 2000 \u7684\u90e8\u95e8</p> <p>\u2460\u6c42\u6bcf\u4e2a\u90e8\u95e8\u7684\u5e73\u5747\u5de5\u8d44\u3002</p> <pre><code>select deptno, avg(sal) from emp group by deptno;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u2461\u6c42\u6bcf\u4e2a\u90e8\u95e8\u7684\u5e73\u5747\u85aa\u6c34\u5927\u4e8e 2000 \u7684\u90e8\u95e8\u3002</p> <pre><code>select deptno, avg(sal) avg_sal from emp group by deptno  having avg_sal &gt; 2000;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_06/#64-join","title":"6.4 Join\u8bed\u53e5","text":""},{"location":"engine/hive/hive_06/#641-join","title":"6.4.1 \u7b49\u503cJoin","text":"<p>Hive \u652f\u6301\u901a\u5e38\u7684 sql join \u8bed\u53e5\uff0c\u4f46\u662f\u53ea\u652f\u6301\u7b49\u503c\u8fde\u63a5\uff0c\u4e0d\u652f\u6301\u975e\u7b49\u503c\u8fde\u63a5\u3002</p> <p>1\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u6839\u636e\u5458\u5de5\u8868\u548c\u90e8\u95e8\u8868\u4e2d\u7684\u90e8\u95e8\u7f16\u53f7\u76f8\u7b49\uff0c\u67e5\u8be2\u5458\u5de5\u7f16\u53f7\u3001\u5458\u5de5\u540d\u79f0\u548c\u90e8\u95e8\u540d\u79f0\u3002</p> <pre><code>select e.empno, e.ename, d.dname from emp e join dept d on e.deptno = d.deptno;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_06/#642","title":"6.4.2 \u8868\u7684\u522b\u540d","text":"<p>1\uff09\u597d\u5904</p> <p>\uff081\uff09\u4f7f\u7528\u522b\u540d\u53ef\u4ee5\u7b80\u5316\u67e5\u8be2\u3002</p> <p>\uff082\uff09\u533a\u5206\u5b57\u6bb5\u7684\u6765\u6e90\u3002</p> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u5408\u5e76\u5458\u5de5\u8868\u548c\u90e8\u95e8\u8868\u3002</p> <pre><code>select e.*,\nd.* from emp e join dept d on e.deptno = d.deptno;\n</code></pre>"},{"location":"engine/hive/hive_06/#643","title":"6.4.3 \u5185\u8fde\u63a5","text":"<p>\u5185\u8fde\u63a5\uff1a\u53ea\u6709\u8fdb\u884c\u8fde\u63a5\u7684\u4e24\u4e2a\u8868\u4e2d\u90fd\u5b58\u5728\u4e0e\u8fde\u63a5\u6761\u4ef6\u76f8\u5339\u914d\u7684\u6570\u636e\u624d\u4f1a\u88ab\u4fdd\u7559\u4e0b\u6765\u3002</p> <pre><code>select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno;\n</code></pre>"},{"location":"engine/hive/hive_06/#644","title":"6.4.4 \u5de6\u5916\u8fde\u63a5","text":"<p>\u5de6\u5916\u8fde\u63a5\uff1ajoin \u64cd\u4f5c\u7b26\u5de6\u8fb9\u8868\u4e2d\u7b26\u5408 where \u5b50\u53e5\u7684\u6240\u6709\u8bb0\u5f55\u5c06\u4f1a\u88ab\u8fd4\u56de\u3002</p> <pre><code>select e.empno, e.ename, d.deptno from emp e left join dept d on e.deptno = d.deptno;\n</code></pre>"},{"location":"engine/hive/hive_06/#645","title":"6.4.5 \u53f3\u5916\u8fde\u63a5","text":"<p>\u53f3\u5916\u8fde\u63a5\uff1ajoin \u64cd\u4f5c\u7b26\u53f3\u8fb9\u8868\u4e2d\u7b26\u5408 where \u5b50\u53e5\u7684\u6240\u6709\u8bb0\u5f55\u5c06\u4f1a\u88ab\u8fd4\u56de\u3002</p> <pre><code>select e.empno, e.ename, d.deptno from emp e right join dept d on e.deptno = d.deptno;\n</code></pre>"},{"location":"engine/hive/hive_06/#646","title":"6.4.6 \u6ee1\u5916\u8fde\u63a5","text":"<p>\u6ee1\u5916\u8fde\u63a5\uff1a\u5c06\u4f1a\u8fd4\u56de\u6240\u6709\u8868\u4e2d\u7b26\u5408 where \u8bed\u53e5\u6761\u4ef6\u7684\u6240\u6709\u8bb0\u5f55\u3002\u5982\u679c\u4efb\u4e00\u8868\u7684\u6307\u5b9a\u5b57\u6bb5\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u503c\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528 null \u503c\u66ff\u4ee3\u3002</p> <pre><code>select e.empno, e.ename, d.deptno from emp e full join dept d on e.deptno = d.deptno;\n</code></pre>"},{"location":"engine/hive/hive_06/#647","title":"6.4.7 \u591a\u8868\u8fde\u63a5","text":"<p>\u6ce8\u610f</p> <p>\u8fde\u63a5 n \u4e2a\u8868\uff0c\u81f3\u5c11\u9700\u8981 n - 1 \u4e2a\u8fde\u63a5\u6761\u4ef6\u3002\u4f8b\u5982\uff1a\u8fde\u63a5\u4e09\u4e2a\u8868\uff0c\u81f3\u5c11\u9700\u8981\u4e24\u4e2a\u8fde\u63a5\u6761\u4ef6\u3002</p> <p>\u6570\u636e\u51c6\u5907\uff0c\u5728 /opt/module/hive/datas/ \u4e0b\u521b\u5efa location.txt</p> <p>\u90e8\u95e8\u4f4d\u7f6eid  \u90e8\u95e8\u4f4d\u7f6e</p> location.txt<pre><code>1700    \u5317\u4eac\n1800    \u4e0a\u6d77\n1900    \u6df1\u5733\n</code></pre> <p>1\uff09\u521b\u5efa\u4f4d\u7f6e\u8868</p> <pre><code>create table if not exists location(\nloc int,           -- \u90e8\u95e8\u4f4d\u7f6eid\nloc_name string   -- \u90e8\u95e8\u4f4d\u7f6e\n)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>2\uff09\u5bfc\u5165\u6570\u636e</p> <pre><code>load data local inpath '/opt/module/hive/datas/location.txt' into table location;\n</code></pre> <p>3\uff09\u591a\u8868\u8fde\u63a5\u67e5\u8be2</p> <pre><code>select e.ename, d.dname, l.loc_name\nfrom emp e join dept d\non d.deptno = e.deptno join location l\non d.loc = l.loc;\n</code></pre> <p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0cHive \u4f1a\u5bf9\u6bcf\u5bf9 join \u8fde\u63a5\u5bf9\u8c61\u542f\u52a8\u4e00\u4e2a MapReduce \u4efb\u52a1\u3002\u672c\u4f8b\u4e2d\u4f1a\u9996\u5148\u542f\u52a8\u4e00\u4e2a MapReduce job \u5bf9\u8868 e \u548c\u8868 d \u8fdb\u884c\u8fde\u63a5\u64cd\u4f5c\uff0c\u7136\u540e\u4f1a\u518d\u542f\u52a8\u4e00\u4e2a MapReduce job \u5c06\u7b2c\u4e00\u4e2a MapReduce job \u7684\u8f93\u51fa\u548c\u8868 l \u8fdb\u884c\u8fde\u63a5\u64cd\u4f5c\u3002</p> <p>\u6ce8\u610f</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u662f\u8868 d \u548c\u8868 l \u5148\u8fdb\u884c\u8fde\u63a5\u64cd\u4f5c\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a Hive \u603b\u662f\u6309\u7167\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\u6267\u884c\u7684\u3002</p>"},{"location":"engine/hive/hive_06/#648","title":"6.4.8 \u7b1b\u5361\u5c14\u96c6","text":"<p>1\uff09\u7b1b\u5361\u5c14\u96c6\u4f1a\u5728\u4e0b\u9762\u6761\u4ef6\u4e0b\u4ea7\u751f</p> <p>\uff081\uff09\u7701\u7565\u8fde\u63a5\u6761\u4ef6</p> <p>\uff082\uff09\u8fde\u63a5\u6761\u4ef6\u65e0\u6548</p> <p>\uff083\uff09\u6240\u6709\u8868\u4e2d\u7684\u6240\u6709\u884c\u4e92\u76f8\u8fde\u63a5</p> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <pre><code>select empno, dname from emp, dept;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_06/#649-union-union-all","title":"6.4.9 \u8054\u5408\uff08union &amp; union all\uff09","text":"<p>1\uff09union &amp; union all \u4e0a\u4e0b\u62fc\u63a5</p> <p>union \u548c union all \u90fd\u662f\u4e0a\u4e0b\u62fc\u63a5 sql \u7684\u7ed3\u679c\uff0c\u8fd9\u70b9\u662f\u548c join \u6709\u533a\u522b\u7684\uff0cjoin \u662f\u5de6\u53f3\u5173\u8054\uff0cunion \u548c union all \u662f\u4e0a\u4e0b\u62fc\u63a5\u3002union \u53bb\u91cd\uff0cunion all \u4e0d\u53bb\u91cd\u3002</p> <p>union \u548c union all \u5728\u4e0a\u4e0b\u62fc\u63a5 sql \u7ed3\u679c\u65f6\u6709\u4e24\u4e2a\u8981\u6c42\uff1a \uff081\uff09\u4e24\u4e2a sql \u7684\u7ed3\u679c\uff0c\u5217\u7684\u4e2a\u6570\u5fc5\u987b\u76f8\u540c</p> <p>\uff082\uff09\u4e24\u4e2a sql \u7684\u7ed3\u679c\uff0c\u4e0a\u4e0b\u6240\u5bf9\u5e94\u5217\u7684\u7c7b\u578b\u5fc5\u987b\u4e00\u81f4</p> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u5c06\u5458\u5de5\u8868 30 \u90e8\u95e8\u7684\u5458\u5de5\u4fe1\u606f\u548c 40 \u90e8\u95e8\u7684\u5458\u5de5\u4fe1\u606f\uff0c\u5229\u7528 union \u8fdb\u884c\u62fc\u63a5\u663e\u793a\u3002</p> <pre><code>select *\nfrom emp\nwhere deptno=30\nunion\nselect *\nfrom emp\nwhere deptno=40;\n</code></pre>"},{"location":"engine/hive/hive_06/#65","title":"6.5 \u6392\u5e8f","text":""},{"location":"engine/hive/hive_06/#651-order-by","title":"6.5.1 \u5168\u5c40\u6392\u5e8f\uff08Order By\uff09","text":"<p>Order By\uff1a\u5168\u5c40\u6392\u5e8f\uff0c\u53ea\u6709\u4e00\u4e2a Reduce\u3002</p> <p>1\uff09\u4f7f\u7528 Order By \u5b50\u53e5\u6392\u5e8f</p> <p>asc\uff08ascend\uff09\uff1a\u5347\u5e8f\uff08\u9ed8\u8ba4\uff09</p> <p>desc\uff08descend\uff09\uff1a\u964d\u5e8f</p> <p>2\uff09Order By \u5b50\u53e5\u5728 select \u8bed\u53e5\u7684\u7ed3\u5c3e</p> <p>3\uff09\u57fa\u7840\u6848\u4f8b\u5b9e\u64cd </p> <p>\uff081\uff09\u67e5\u8be2\u5458\u5de5\u4fe1\u606f\u6309\u5de5\u8d44\u5347\u5e8f\u6392\u5217</p> <pre><code>select * from emp order by sal;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\uff082\uff09\u67e5\u8be2\u5458\u5de5\u4fe1\u606f\u6309\u5de5\u8d44\u964d\u5e8f\u6392\u5217</p> <pre><code>select * from emp order by sal desc;\n</code></pre> <p>4\uff09\u6309\u7167\u522b\u540d\u6392\u5e8f\u6848\u4f8b\u5b9e\u64cd</p> <p>\u6309\u7167\u5458\u5de5\u85aa\u6c34\u7684 2 \u500d\u6392\u5e8f\u3002</p> <pre><code>select ename, sal * 2 twosal from emp order by twosal;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>5\uff09\u591a\u4e2a\u5217\u6392\u5e8f\u6848\u4f8b\u5b9e\u64cd</p> <p>\u6309\u7167\u90e8\u95e8\u548c\u5de5\u8d44\u5347\u5e8f\u6392\u5e8f\u3002</p> <pre><code>select ename, deptno, sal from emp order by deptno, sal;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_06/#652-reducesort-by","title":"6.5.2 \u6bcf\u4e2aReduce\u5185\u90e8\u6392\u5e8f\uff08Sort By\uff09","text":"<p>Sort By\uff1a\u5bf9\u4e8e\u5927\u89c4\u6a21\u7684\u6570\u636e\u96c6 order by \u7684\u6548\u7387\u975e\u5e38\u4f4e\u3002\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u5e76\u4e0d\u9700\u8981\u5168\u5c40\u6392\u5e8f\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528 Sort by\u3002</p> <p>Sort by \u4e3a\u6bcf\u4e2a reduce \u4ea7\u751f\u4e00\u4e2a\u6392\u5e8f\u6587\u4ef6\u3002\u6bcf\u4e2a Reduce \u5185\u90e8\u8fdb\u884c\u6392\u5e8f\uff0c\u5bf9\u5168\u5c40\u7ed3\u679c\u96c6\u6765\u8bf4\u4e0d\u662f\u6392\u5e8f\u3002</p> <p>1\uff09\u8bbe\u7f6e reduce \u4e2a\u6570</p> <pre><code>set mapreduce.job.reduces=3;\n</code></pre> <p>2\uff09\u67e5\u770b\u8bbe\u7f6e reduce \u4e2a\u6570</p> <pre><code>set mapreduce.job.reduces;\n</code></pre> <p>3\uff09\u6839\u636e\u90e8\u95e8\u7f16\u53f7\u964d\u5e8f\u67e5\u770b\u5458\u5de5\u4fe1\u606f</p> <pre><code>select * from emp sort by deptno desc;\n</code></pre> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>4\uff09\u5c06\u67e5\u8be2\u7ed3\u679c\u5bfc\u5165\u5230\u6587\u4ef6\u4e2d\uff08\u6309\u7167\u90e8\u95e8\u7f16\u53f7\u964d\u5e8f\u6392\u5e8f\uff09</p> <pre><code>insert overwrite local directory '/opt/module/hive/datas/sortby-result'\nselect * from emp sort by deptno desc;\n</code></pre>"},{"location":"engine/hive/hive_06/#653-distribute-by","title":"6.5.3 \u5206\u533a\uff08Distribute By\uff09","text":"<p>Distribute By\uff1a\u5728\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u63a7\u5236\u67d0\u4e2a\u7279\u5b9a\u884c\u5e94\u8be5\u5230\u54ea\u4e2a Reducer\uff0c\u901a\u5e38\u662f\u4e3a\u4e86\u8fdb\u884c\u540e\u7eed\u7684\u805a\u96c6\u64cd\u4f5c\u3002distribute by \u5b50\u53e5\u53ef\u4ee5\u505a\u8fd9\u4ef6\u4e8b\u3002distribute by \u7c7b\u4f3c MapReduce \u4e2d partition\uff08\u81ea\u5b9a\u4e49\u5206\u533a\uff09\uff0c\u8fdb\u884c\u5206\u533a\uff0c\u7ed3\u5408 sort by \u4f7f\u7528\u3002 </p> <p>\u5bf9\u4e8e distribute by \u8fdb\u884c\u6d4b\u8bd5\uff0c\u4e00\u5b9a\u8981\u5206\u914d\u591a reduce \u8fdb\u884c\u5904\u7406\uff0c\u5426\u5219\u65e0\u6cd5\u770b\u5230 distribute by \u7684\u6548\u679c\u3002</p> <p>1\uff09\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <p>\uff081\uff09\u5148\u6309\u7167\u90e8\u95e8\u7f16\u53f7\u5206\u533a\uff0c\u518d\u6309\u7167\u5458\u5de5\u7f16\u53f7\u85aa\u8d44\u6392\u5e8f</p> <pre><code>set mapreduce.job.reduces=3;\n\ninsert overwrite local directory '/opt/module/hive/datas/distribute-result' select * from emp distribute by deptno sort by sal desc;\n</code></pre> <p>\u6ce8\u610f</p> <ul> <li> <p>distribute by \u7684\u5206\u533a\u89c4\u5219\u662f\u6839\u636e\u5206\u533a\u5b57\u6bb5\u7684 hash \u7801\u4e0e reduce \u7684\u4e2a\u6570\u8fdb\u884c\u76f8\u9664\u540e\uff0c\u4f59\u6570\u76f8\u540c\u7684\u5206\u5230\u4e00\u4e2a\u533a</p> </li> <li> <p>Hive \u8981\u6c42 distribute by \u8bed\u53e5\u8981\u5199\u5728 sort by \u8bed\u53e5\u4e4b\u524d</p> </li> <li>\u6f14\u793a\u5b8c\u4ee5\u540e mapreduce.job.reduces \u7684\u503c\u8981\u8bbe\u7f6e\u56de -1\uff0c\u5426\u5219\u4e0b\u9762\u5206\u533a or \u5206\u6876\u8868 load \u8dd1 MapReduce \u7684\u65f6\u5019\u4f1a\u62a5\u9519</li> </ul> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_06/#654-cluster-by","title":"6.5.4 \u5206\u533a\u6392\u5e8f\uff08Cluster By\uff09","text":"<p>\u5f53 distribute by \u548c sort by \u5b57\u6bb5\u76f8\u540c\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 cluster by \u65b9\u5f0f\u3002</p> <p>cluster by \u9664\u4e86\u5177\u6709 distribute by \u7684\u529f\u80fd\u5916\u8fd8\u517c\u5177 sort by \u7684\u529f\u80fd\u3002\u4f46\u662f\u6392\u5e8f\u53ea\u80fd\u662f\u5347\u5e8f\u6392\u5e8f\uff0c\u4e0d\u80fd\u6307\u5b9a\u6392\u5e8f\u89c4\u5219\u4e3a asc \u6216\u8005 desc\u3002</p> <p>\uff081\uff09\u4ee5\u4e0b\u4e24\u79cd\u5199\u6cd5\u7b49\u4ef7</p> <pre><code>select * from emp cluster by deptno;\n\nselect * from emp distribute by deptno sort by deptno;\n</code></pre> <p>\u6ce8\u610f</p> <p>\u6309\u7167\u90e8\u95e8\u7f16\u53f7\u5206\u533a\uff0c\u4e0d\u4e00\u5b9a\u5c31\u662f\u56fa\u5b9a\u6b7b\u7684\u6570\u503c\uff0c\u53ef\u4ee5\u662f 20 \u53f7\u548c 30 \u53f7\u90e8\u95e8\u5206\u5230\u4e00\u4e2a\u5206\u533a\u91cc\u9762\u53bb\u3002</p> <p>hive sql \u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"engine/hive/hive_07/","title":"\u7b2c7\u7ae0 \u7efc\u5408\u6848\u4f8b\u7ec3\u4e60\uff08\u521d\u7ea7\uff09","text":"<p>\u70b9\u51fb\u524d\u5f80\u5c1a\u7845\u8c37HQL\u5237\u9898\u7f51\u7ad9</p>"},{"location":"engine/hive/hive_08/","title":"\u7b2c8\u7ae0 \u51fd\u6570","text":""},{"location":"engine/hive/hive_08/#81","title":"8.1 \u51fd\u6570\u7b80\u4ecb","text":"<p>Hive \u4f1a\u5c06\u5e38\u7528\u7684\u903b\u8f91\u5c01\u88c5\u6210\u51fd\u6570\u7ed9\u7528\u6237\u8fdb\u884c\u4f7f\u7528\uff0c\u7c7b\u4f3c\u4e8e Java \u4e2d\u7684\u51fd\u6570\u3002</p> <p>\u597d\u5904\uff1a\u907f\u514d\u7528\u6237\u53cd\u590d\u5199\u903b\u8f91\uff0c\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u4f7f\u7528\u3002</p> <p>\u91cd\u70b9\uff1a\u7528\u6237\u9700\u8981\u77e5\u9053\u51fd\u6570\u53eb\u4ec0\u4e48\uff0c\u80fd\u505a\u4ec0\u4e48\u3002</p> <p>Hive \u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u5185\u7f6e\u51fd\u6570\uff0c\u6309\u7167\u5176\u7279\u70b9\u53ef\u5927\u81f4\u5206\u4e3a\u5982\u4e0b\u51e0\u7c7b\uff1a\u5355\u884c\u51fd\u6570\u3001\u805a\u5408\u51fd\u6570\u3001\u70b8\u88c2\u51fd\u6570\u3001\u7a97\u53e3\u51fd\u6570\u3002</p> <p>\u4ee5\u4e0b\u547d\u4ee4\u53ef\u7528\u4e8e\u67e5\u8be2\u6240\u6709\u5185\u7f6e\u51fd\u6570\u7684\u76f8\u5173\u4fe1\u606f\u3002</p> <p>1\uff09\u67e5\u770b\u7cfb\u7edf\u5185\u7f6e\u51fd\u6570</p> <pre><code>show functions;\n</code></pre> <p>2\uff09\u67e5\u770b\u5185\u7f6e\u51fd\u6570\u7528\u6cd5</p> <pre><code>desc function upper;\n</code></pre> <p>3\uff09\u67e5\u770b\u5185\u7f6e\u51fd\u6570\u8be6\u7ec6\u4fe1\u606f</p> <pre><code>desc function extended upper;\n</code></pre>"},{"location":"engine/hive/hive_08/#82","title":"8.2 \u5355\u884c\u51fd\u6570","text":"<p>\u5355\u884c\u51fd\u6570\u7684\u7279\u70b9\u662f\u4e00\u8fdb\u4e00\u51fa\uff0c\u5373\u8f93\u5165\u4e00\u884c\uff0c\u8f93\u51fa\u4e00\u884c\u3002</p> <p>\u5355\u884c\u51fd\u6570\u6309\u7167\u529f\u80fd\u53ef\u5206\u4e3a\u5982\u4e0b\u51e0\u7c7b: \u65e5\u671f\u51fd\u6570\u3001\u5b57\u7b26\u4e32\u51fd\u6570\u3001\u96c6\u5408\u51fd\u6570\u3001\u6570\u5b66\u51fd\u6570\u3001\u6d41\u7a0b\u63a7\u5236\u51fd\u6570\u7b49\u3002</p>"},{"location":"engine/hive/hive_08/#821","title":"8.2.1 \u7b97\u672f\u8fd0\u7b97\u51fd\u6570","text":"\u8fd0\u7b97\u7b26 \u63cf\u8ff0 A+B A\u548cB \u76f8\u52a0 A-B A\u51cf\u53bbB A*B A\u548cB \u76f8\u4e58 A/B A\u9664\u4ee5B A%B A\u5bf9B\u53d6\u4f59 A&amp;B A\u548cB\u6309\u4f4d\u53d6\u4e0e A|B A\u548cB\u6309\u4f4d\u53d6\u6216 A^B A\u548cB\u6309\u4f4d\u53d6\u5f02\u6216 ~A A\u6309\u4f4d\u53d6\u53cd <p>\u6848\u4f8b\u5b9e\u64cd\uff1a\u67e5\u8be2\u51fa\u6240\u6709\u5458\u5de5\u7684\u85aa\u6c34\u540e\u52a0 1 \u663e\u793a\u3002</p> <pre><code>select sal + 1 from emp;\n</code></pre>"},{"location":"engine/hive/hive_08/#822","title":"8.2.2 \u6570\u503c\u51fd\u6570","text":"<p>1\uff09round\uff1a\u56db\u820d\u4e94\u5165</p> <pre><code>select round(3.3);\n</code></pre> <p>2\uff09ceil\uff1a\u5411\u4e0a\u53d6\u6574</p> <pre><code>select ceil(3.1) ;\n</code></pre> <p>3\uff09floor\uff1a\u5411\u4e0b\u53d6\u6574</p> <pre><code>select floor(4.8);\n</code></pre>"},{"location":"engine/hive/hive_08/#823","title":"8.2.3 \u5b57\u7b26\u4e32\u51fd\u6570","text":"<p>1\uff09substring\uff1a\u622a\u53d6\u5b57\u7b26\u4e32</p> <p>\u8bed\u6cd5\u4e00\uff1asubstring(string A, int start) </p> <p>\u8fd4\u56de\u503c\uff1astring </p> <p>\u8bf4\u660e\uff1a\u8fd4\u56de\u5b57\u7b26\u4e32 A \u4ece start \u4f4d\u7f6e\u5230\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32</p> <p>\u8bed\u6cd5\u4e8c\uff1asubstring(string A, int start, int len) </p> <p>\u8fd4\u56de\u503c\uff1astring</p> <p>\u8bf4\u660e\uff1a\u8fd4\u56de\u5b57\u7b26\u4e32 A \u4ece start \u4f4d\u7f6e\u5f00\u59cb\uff0c\u957f\u5ea6\u4e3a len \u7684\u5b57\u7b26\u4e32</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <p>\uff081\uff09\u83b7\u53d6\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u4ee5\u540e\u7684\u6240\u6709\u5b57\u7b26</p> <pre><code>select substring(\"atguigu\",2);\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>tguigu\n</code></pre> <p>\uff082\uff09\u83b7\u53d6\u5012\u6570\u7b2c\u4e09\u4e2a\u5b57\u7b26\u4ee5\u540e\u7684\u6240\u6709\u5b57\u7b26</p> <pre><code>select substring(\"atguigu\",-3);\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>igu\n</code></pre> <p>\uff083\uff09\u4ece\u7b2c 3 \u4e2a\u5b57\u7b26\u5f00\u59cb\uff0c\u5411\u540e\u83b7\u53d6 2 \u4e2a\u5b57\u7b26</p> <pre><code>select substring(\"atguigu\",3,2);\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>gu\n</code></pre> <p>2\uff09replace \uff1a\u66ff\u6362</p> <p>\u8bed\u6cd5\uff1areplace(string A, string B, string C) </p> <p>\u8fd4\u56de\u503c\uff1astring</p> <p>\u8bf4\u660e\uff1a\u5c06\u5b57\u7b26\u4e32 A \u4e2d\u7684\u5b50\u5b57\u7b26\u4e32 B \u66ff\u6362\u4e3a C\u3002</p> <pre><code>select replace('atguigu', 'a', 'A')\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>Atguigu\n</code></pre> <p>3\uff09regexp_replace\uff1a\u6b63\u5219\u66ff\u6362</p> <p>\u8bed\u6cd5\uff1aregexp_replace(string A, string B, string C) </p> <p>\u8fd4\u56de\u503c\uff1astring</p> <p>\u8bf4\u660e\uff1a\u5c06\u5b57\u7b26\u4e32 A \u4e2d\u7684\u7b26\u5408 java \u6b63\u5219\u8868\u8fbe\u5f0f B \u7684\u90e8\u5206\u66ff\u6362\u4e3a C\u3002\u6ce8\u610f\uff0c\u5728\u6709\u4e9b\u60c5\u51b5\u4e0b\u8981\u4f7f\u7528\u8f6c\u4e49\u5b57\u7b26\u3002</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select regexp_replace('100-200', '(\\\\d+)', 'num') </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>num-num\n</code></pre> <p>4\uff09regexp\uff1a\u6b63\u5219\u5339\u914d</p> <p>\u8bed\u6cd5\uff1a\u5b57\u7b26\u4e32 regexp \u6b63\u5219\u8868\u8fbe\u5f0f</p> <p>\u8fd4\u56de\u503c\uff1aboolean</p> <p>\u8bf4\u660e\uff1a\u82e5\u5b57\u7b26\u4e32\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5219\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002</p> <p>\uff081\uff09\u6b63\u5219\u5339\u914d\u6210\u529f\uff0c\u8f93\u51fa true</p> <pre><code>select 'dfsaaaa' regexp 'dfsa+'\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>true\n</code></pre> <p>\uff082\uff09\u6b63\u5219\u5339\u914d\u5931\u8d25\uff0c\u8f93\u51fa false</p> <pre><code>select 'dfsaaaa' regexp 'dfsb+';\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>false\n</code></pre> <p>5\uff09repeat\uff1a\u91cd\u590d\u5b57\u7b26\u4e32</p> <p>\u8bed\u6cd5\uff1arepeat(string A, int n)</p> <p>\u8fd4\u56de\u503c\uff1astring</p> <p>\u8bf4\u660e\uff1a\u5c06\u5b57\u7b26\u4e32 A \u91cd\u590d n \u904d\u3002</p> <pre><code>select repeat('123', 3);\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>123123123\n</code></pre> <p>6\uff09split \uff1a\u5b57\u7b26\u4e32\u5207\u5272</p> <p>\u8bed\u6cd5\uff1asplit(string str, string pat) </p> <p>\u8fd4\u56de\u503c\uff1aarray</p> <p>\u8bf4\u660e\uff1a\u6309\u7167\u6b63\u5219\u8868\u8fbe\u5f0f pat \u5339\u914d\u5230\u7684\u5185\u5bb9\u5206\u5272 str\uff0c\u5206\u5272\u540e\u7684\u5b57\u7b26\u4e32\uff0c\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u8fd4\u56de\u3002</p> <pre><code>select split('a-b-c-d','-');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>[\"a\",\"b\",\"c\",\"d\"]\n</code></pre> <p>7\uff09nvl \uff1a\u66ff\u6362 null \u503c</p> <p>\u8bed\u6cd5\uff1anvl(A,B) </p> <p>\u8bf4\u660e\uff1a\u82e5 A \u7684\u503c\u4e0d\u4e3a null\uff0c\u5219\u8fd4\u56de A\uff0c\u5426\u5219\u8fd4\u56de B\u3002 </p> <pre><code>select nvl(null,1);\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>1\n</code></pre> <p>8\uff09concat \uff1a\u62fc\u63a5\u5b57\u7b26\u4e32</p> <p>\u8bed\u6cd5\uff1aconcat(string A, string B, string C, \u2026\u2026) </p> <p>\u8fd4\u56de\uff1astring</p> <p>\u8bf4\u660e\uff1a\u5c06 A,B,C\u2026\u2026 \u7b49\u5b57\u7b26\u62fc\u63a5\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32</p> <pre><code>select concat('beijing','-','shanghai','-','shenzhen');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>beijing-shanghai-shenzhen\n</code></pre> <p>9\uff09concat_ws\uff1a\u4ee5\u6307\u5b9a\u5206\u9694\u7b26\u62fc\u63a5\u5b57\u7b26\u4e32\u6216\u8005\u5b57\u7b26\u4e32\u6570\u7ec4</p> <p>\u8bed\u6cd5\uff1aconcat_ws(string A, string\u2026| array(string)) </p> <p>\u8fd4\u56de\u503c\uff1astring</p> <p>\u8bf4\u660e\uff1a\u4f7f\u7528\u5206\u9694\u7b26 A \u62fc\u63a5\u591a\u4e2a\u5b57\u7b26\u4e32\uff0c\u6216\u8005\u4e00\u4e2a\u6570\u7ec4\u7684\u6240\u6709\u5143\u7d20\u3002</p> <pre><code>select concat_ws('-','beijing','shanghai','shenzhen');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>beijing-shanghai-shenzhen\n</code></pre> <p>10\uff09get_json_object\uff1a\u89e3\u6790 json \u5b57\u7b26\u4e32</p> <p>\u8bed\u6cd5\uff1aget_json_object(string json_string, string path) </p> <p>\u8fd4\u56de\u503c\uff1astring</p> <p>\u8bf4\u660e\uff1a\u89e3\u6790 json \u7684\u5b57\u7b26\u4e32 json_string\uff0c\u8fd4\u56de path \u6307\u5b9a\u7684\u5185\u5bb9\u3002\u5982\u679c\u8f93\u5165\u7684 json \u5b57\u7b26\u4e32\u65e0\u6548\uff0c\u90a3\u4e48\u8fd4\u56de NULL\u3002</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <p>1\uff09\u83b7\u53d6 json \u6570\u7ec4\u91cc\u9762\u7684 json \u5177\u4f53\u6570\u636e</p> <pre><code>select get_json_object('[{\"name\":\"\u5927\u6d77\u6d77\",\"sex\":\"\u7537\",\"age\":\"25\"},{\"name\":\"\u5c0f\u5b8b\u5b8b\",\"sex\":\"\u7537\",\"age\":\"47\"}]','$.[0].name');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>\u5927\u6d77\u6d77\n</code></pre> <p>\uff082\uff09\u83b7\u53d6 json \u6570\u7ec4\u91cc\u9762\u7684\u6570\u636e</p> <pre><code>select get_json_object('[{\"name\":\"\u5927\u6d77\u6d77\",\"sex\":\"\u7537\",\"age\":\"25\"},{\"name\":\"\u5c0f\u5b8b\u5b8b\",\"sex\":\"\u7537\",\"age\":\"47\"}]','$.[0]');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>{\"name\":\"\u5927\u6d77\u6d77\",\"sex\":\"\u7537\",\"age\":\"25\"}\n</code></pre>"},{"location":"engine/hive/hive_08/#824","title":"8.2.4 \u65e5\u671f\u51fd\u6570","text":"<p>1\uff09unix_timestamp\uff1a\u8fd4\u56de\u5f53\u524d\u6216\u6307\u5b9a\u65f6\u95f4\u7684\u65f6\u95f4\u6233</p> <p>\u8bed\u6cd5\uff1aunix_timestamp() </p> <p>\u8fd4\u56de\u503c\uff1abigint </p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select unix_timestamp('2022/08/08 08-08-08','yyyy/MM/dd HH-mm-ss');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>1659946088\n</code></pre> <p>2\uff09from_unixtime\uff1a\u8f6c\u5316 UNIX \u65f6\u95f4\u6233\uff08\u4ece 1970-01-01 00:00:00 UTC \u5230\u6307\u5b9a\u65f6\u95f4\u7684\u79d2\u6570\uff09\u5230\u5f53\u524d\u65f6\u533a\u7684\u65f6\u95f4\u683c\u5f0f</p> <p>\u8bed\u6cd5\uff1afrom_unixtime(bigint unixtime[, string format]) </p> <p>\u8fd4\u56de\u503c\uff1astring </p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select from_unixtime(1659946088);   </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>2022-08-08 08:08:08\n</code></pre> <p>3\uff09current_date\uff1a\u5f53\u524d\u65e5\u671f </p> <pre><code>select current_date;  </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>2022-07-11\n</code></pre> <p>4\uff09current_timestamp\uff1a\u5f53\u524d\u7684\u65e5\u671f\u52a0\u65f6\u95f4\uff0c\u5e76\u4e14\u7cbe\u786e\u7684\u6beb\u79d2 </p> <pre><code>select current_timestamp; </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>2022-07-11 15:32:22.402\n</code></pre> <p>5\uff09month\uff1a\u83b7\u53d6\u65e5\u671f\u4e2d\u7684\u6708</p> <p>\u8bed\u6cd5\uff1amonth (string date) </p> <p>\u8fd4\u56de\u503c\uff1aint </p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select month('2022-08-08 08:08:08');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>8\n</code></pre> <p>6\uff09day\uff1a\u83b7\u53d6\u65e5\u671f\u4e2d\u7684\u65e5</p> <p>\u8bed\u6cd5\uff1aday (string date) </p> <p>\u8fd4\u56de\u503c\uff1aint </p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select day('2022-08-08 08:08:08')\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>8\n</code></pre> <p>7\uff09hour\uff1a\u83b7\u53d6\u65e5\u671f\u4e2d\u7684\u5c0f\u65f6</p> <p>\u8bed\u6cd5\uff1ahour (string date) </p> <p>\u8fd4\u56de\u503c\uff1aint </p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select hour('2022-08-08 08:08:08')\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>8\n</code></pre> <p>8\uff09datediff\uff1a\u4e24\u4e2a\u65e5\u671f\u76f8\u5dee\u7684\u5929\u6570\uff08\u7ed3\u675f\u65e5\u671f\u51cf\u53bb\u5f00\u59cb\u65e5\u671f\u7684\u5929\u6570\uff09</p> <p>\u8bed\u6cd5\uff1adatediff(string enddate, string startdate) </p> <p>\u8fd4\u56de\u503c\uff1aint </p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select datediff('2021-08-08','2022-10-09');   </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>-427\n</code></pre> <p>9\uff09date_add\uff1a\u65e5\u671f\u52a0\u5929\u6570</p> <p>\u8bed\u6cd5\uff1adate_add(string startdate, int days) </p> <p>\u8fd4\u56de\u503c\uff1astring </p> <p>\u8bf4\u660e\uff1a\u8fd4\u56de\u5f00\u59cb\u65e5\u671f startdate \u589e\u52a0 days \u5929\u540e\u7684\u65e5\u671f</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select date_add('2022-08-08',2);   </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>2022-08-10\n</code></pre> <p>10\uff09date_sub\uff1a\u65e5\u671f\u51cf\u5929\u6570</p> <p>\u8bed\u6cd5\uff1adate_sub (string startdate, int days) </p> <p>\u8fd4\u56de\u503c\uff1astring </p> <p>\u8bf4\u660e\uff1a\u8fd4\u56de\u5f00\u59cb\u65e5\u671f startdate \u51cf\u5c11 days \u5929\u540e\u7684\u65e5\u671f\u3002</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select date_sub('2022-08-08',2);\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>2022-08-06\n</code></pre> <p>11\uff09date_format:\u5c06\u6807\u51c6\u65e5\u671f\u89e3\u6790\u6210\u6307\u5b9a\u683c\u5f0f\u5b57\u7b26\u4e32</p> <pre><code>select date_format('2022-08-08','yyyy\u5e74-MM\u6708-dd\u65e5') </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>2022\u5e74-08\u6708-08\u65e5\n</code></pre>"},{"location":"engine/hive/hive_08/#825","title":"8.2.5 \u6d41\u7a0b\u63a7\u5236\u51fd\u6570","text":"<p>1\uff09case when\uff1a\u6761\u4ef6\u5224\u65ad\u51fd\u6570</p> <p>\u8bed\u6cd5\u4e00\uff1a<code>case when a then b [when c then d]* [else e] end</code> </p> <p>\u8fd4\u56de\u503c\uff1aT </p> <p>\u8bf4\u660e\uff1a\u5982\u679c a \u4e3a true\uff0c\u5219\u8fd4\u56de b\uff1b\u5982\u679c c \u4e3a true\uff0c\u5219\u8fd4\u56de d\uff1b\u5426\u5219\u8fd4\u56de e </p> <pre><code>select case when 1=2 then 'tom' when 2=2 then 'mary' else 'tim' end from tabl eName; mary\n</code></pre> <p>\u8bed\u6cd5\u4e8c\uff1a<code>case a when b then c [when d then e]* [else f] end</code></p> <p>\u8fd4\u56de\u503c: T </p> <p>\u8bf4\u660e\uff1a\u5982\u679c a \u7b49\u4e8e b\uff0c\u90a3\u4e48\u8fd4\u56de c\uff1b\u5982\u679c a \u7b49\u4e8e d\uff0c\u90a3\u4e48\u8fd4\u56de e\uff1b\u5426\u5219\u8fd4\u56de f  </p> <pre><code>select case 100 when 50 then 'tom' when 100 then 'mary' else 'tim' end from t ableName; mary\n</code></pre> <p>2\uff09if: \u6761\u4ef6\u5224\u65ad\uff0c\u7c7b\u4f3c\u4e8e Java \u4e2d\u4e09\u5143\u8fd0\u7b97\u7b26</p> <p>\u8bed\u6cd5\uff1a<code>if\uff08boolean testCondition, T valueTrue, T valueFalseOrNull\uff09</code></p> <p>\u8fd4\u56de\u503c\uff1aT </p> <p>\u8bf4\u660e\uff1a\u5f53\u6761\u4ef6 testCondition \u4e3a true \u65f6\uff0c\u8fd4\u56de valueTrue\uff1b\u5426\u5219\u8fd4\u56de valueFalseOrNull</p> <p>\uff081\uff09\u6761\u4ef6\u6ee1\u8db3\uff0c\u8f93\u51fa\u6b63\u786e</p> <pre><code>select if(10 &gt; 5,'\u6b63\u786e','\u9519\u8bef');\n</code></pre> <p>\u8f93\u51fa\uff1a\u6b63\u786e</p> <p>\uff082\uff09\u6761\u4ef6\u6ee1\u8db3\uff0c\u8f93\u51fa\u9519\u8bef</p> <pre><code>select if(10 &lt; 5,'\u6b63\u786e','\u9519\u8bef');\n</code></pre> <p>\u8f93\u51fa\uff1a\u9519\u8bef</p>"},{"location":"engine/hive/hive_08/#826","title":"8.2.6 \u96c6\u5408\u51fd\u6570","text":"<p>1\uff09size\uff1a\u96c6\u5408\u4e2d\u5143\u7d20\u7684\u4e2a\u6570</p> <pre><code>select size(friends) from test;\n</code></pre> <p>2\uff09map\uff1a\u521b\u5efa map \u96c6\u5408</p> <p>\u8bed\u6cd5\uff1a<code>map (key1, value1, key2, value2, \u2026)</code></p> <p>\u8bf4\u660e\uff1a\u6839\u636e\u8f93\u5165\u7684 key \u548c value \u5bf9\u6784\u5efa map \u7c7b\u578b</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select map('xiaohai',1,'dahai',2); </code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>{\"xiaohai\":1,\"dahai\":2}\n</code></pre> <p>3\uff09map_keys\uff1a \u8fd4\u56de map \u4e2d\u7684 key</p> <pre><code>select map_keys(map('xiaohai',1,'dahai',2));\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>[\"xiaohai\",\"dahai\"]\n</code></pre> <p>4\uff09map_values: \u8fd4\u56de map \u4e2d\u7684 value</p> <pre><code>select map_values(map('xiaohai',1,'dahai',2));\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>[1,2]\n</code></pre> <p>5\uff09array \u58f0\u660e array \u96c6\u5408</p> <p>\u8bed\u6cd5\uff1a<code>array(val1, val2, \u2026)</code></p> <p>\u8bf4\u660e\uff1a\u6839\u636e\u8f93\u5165\u7684\u53c2\u6570\u6784\u5efa\u6570\u7ec4 array \u7c7b</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select array('1','2','3','4');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>[\"1\",\"2\",\"3\",\"4\"]\n</code></pre> <p>6\uff09array_contains: \u5224\u65ad array \u4e2d\u662f\u5426\u5305\u542b\u67d0\u4e2a\u5143\u7d20</p> <pre><code>select array_contains(array('a','b','c','d'),'a');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>true\n</code></pre> <p>7\uff09sort_array\uff1a\u5c06 array \u4e2d\u7684\u5143\u7d20\u6392\u5e8f</p> <pre><code>select sort_array(array('a','d','c'));\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>[\"a\",\"c\",\"d\"]\n</code></pre> <p>8\uff09struct \u58f0\u660e struct \u4e2d\u7684\u5404\u5c5e\u6027</p> <p>\u8bed\u6cd5\uff1a<code>struct(val1, val2, val3, \u2026)</code></p> <p>\u8bf4\u660e\uff1a\u6839\u636e\u8f93\u5165\u7684\u53c2\u6570\u6784\u5efa\u7ed3\u6784\u4f53 struct \u7c7b</p> <p>\u6848\u4f8b\u5b9e\u64cd\uff1a</p> <pre><code>select struct('name','age','weight');\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>{\"col1\":\"name\",\"col2\":\"age\",\"col3\":\"weight\"}\n</code></pre> <p>9\uff09named_struct \u58f0\u660e struct \u7684\u5c5e\u6027\u548c\u503c</p> <pre><code>select named_struct('name','xiaosong','age',18,'weight',80);\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>{\"name\":\"xiaosong\",\"age\":18,\"weight\":80}\n</code></pre>"},{"location":"engine/hive/hive_08/#827","title":"8.2.7 \u6848\u4f8b\u6f14\u793a","text":"<ol> <li>\u6570\u636e\u51c6\u5907</li> </ol> <p>1\uff09\u8868\u7ed3\u6784</p> name sex birthday hiredate job salary bonus friends children \u5f20\u65e0\u5fcc \u7537 1980/02/12 2022/08/09 \u9500\u552e 3000 12000 [\u963f\u6731\uff0c\u5c0f\u662d] {\u5f20\u5c0f\u65e0:8,\u5f20\u5c0f\u5fcc:9} \u8d75\u654f \u5973 1982/05/18 2022/09/10 \u884c\u653f 9000 2000 [\u963f\u4e09\uff0c\u963f\u56db] {\u8d75\u5c0f\u654f:8} \u9ec4\u84c9 \u5973 1982/04/13 2022/06/11 \u884c\u653f 12000 Null [\u4e1c\u90aa\uff0c\u897f\u6bd2] {\u90ed\u8299:5,\u90ed\u8944:4} <p>2\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>create  table  employee(\nname string,  --\u59d3\u540d\nsex  string,  --\u6027\u522b\nbirthday string, --\u51fa\u751f\u5e74\u6708\nhiredate string, --\u5165\u804c\u65e5\u671f\njob string,   --\u5c97\u4f4d\nsalary double, --\u85aa\u8d44\nbonus double,  --\u5956\u91d1\nfriends array&lt;string&gt;, --\u670b\u53cb\nchildren map&lt;string,int&gt; --\u5b69\u5b50\n)\n</code></pre> <p>3\uff09\u63d2\u5165\u6570\u636e</p> <pre><code>insert into employee  values('\u5f20\u65e0\u5fcc','\u7537','1980/02/12','2022/08/09','\u9500\u552e',3000,12000,array('\u963f\u6731','\u5c0f\u662d'),map('\u5f20\u5c0f\u65e0',8,'\u5f20\u5c0f\u5fcc',9)),\n('\u8d75\u654f','\u5973','1982/05/18','2022/09/10','\u884c\u653f',9000,2000,array('\u963f\u4e09','\u963f\u56db'),map('\u8d75\u5c0f\u654f',8)),\n('\u5b8b\u9752\u4e66','\u7537','1981/03/15','2022/04/09','\u7814\u53d1',18000,1000,array('\u738b\u4e94','\u8d75\u516d'),map('\u5b8b\u5c0f\u9752',7,'\u5b8b\u5c0f\u4e66',5)),\n('\u5468\u82b7\u82e5','\u5973','1981/03/17','2022/04/10','\u7814\u53d1',18000,1000,array('\u738b\u4e94','\u8d75\u516d'),map('\u5b8b\u5c0f\u9752',7,'\u5b8b\u5c0f\u4e66',5)),\n('\u90ed\u9756','\u7537','1985/03/11','2022/07/19','\u9500\u552e',2000,13000,array('\u5357\u5e1d','\u5317\u4e10'),map('\u90ed\u8299',5,'\u90ed\u8944',4)),\n('\u9ec4\u84c9','\u5973','1982/12/13','2022/06/11','\u884c\u653f',12000,null,array('\u4e1c\u90aa','\u897f\u6bd2'),map('\u90ed\u8299',5,'\u90ed\u8944',4)),\n('\u6768\u8fc7','\u7537','1988/01/30','2022/08/13','\u524d\u53f0',5000,null,array('\u90ed\u9756','\u9ec4\u84c9'),map('\u6768\u5c0f\u8fc7',2)),\n('\u5c0f\u9f99\u5973','\u5973','1985/02/12','2022/09/24','\u524d\u53f0',6000,null,array('\u5f20\u4e09','\u674e\u56db'),map('\u6768\u5c0f\u8fc7',2))\n</code></pre> <ol> <li>\u9700\u6c42</li> </ol> <p>1\uff09\u7edf\u8ba1\u6bcf\u4e2a\u6708\u7684\u5165\u804c\u4eba\u6570</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> month cnt 4 2 6 1 7 1 8 2 9 2 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\nmonth(replace(hiredate,'/','-')) as month,\ncount(*) as cn\nfrom\nemployee\ngroup by\nmonth(replace(hiredate,'/','-'))\n</code></pre> <p>2\uff09\u67e5\u8be2\u6bcf\u4e2a\u4eba\u7684\u5e74\u9f84\uff08\u5e74 + \u6708\uff09</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> name age \u5f20\u65e0\u5fcc 42\u5e748\u6708 \u8d75\u654f 40\u5e745\u6708 \u5b8b\u9752\u4e66 41\u5e747\u6708 \u5468\u82b7\u82e5 41\u5e747\u6708 \u90ed\u9756 37\u5e747\u6708 \u9ec4\u84c9 39\u5e7410\u6708 \u6768\u8fc7 34\u5e749\u6708 \u5c0f\u9f99\u5973 37\u5e748\u6708 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>-- \u8f6c\u6362\u65e5\u671f\nselect\nname,\nreplace(birthday,'/','-') birthday\nfrom\nemployee  t1\n\n-- \u6c42\u51fa\u5e74\u548c\u6708\nselect\nname,\nyear(current_date())-year(t1.birthday) year,\nmonth(current_date())-month(t1.birthday) month\nfrom\n(\nselect\nname,\nreplace(birthday,'/','-') birthday\nfrom\nemployee\n)t1 t2\n\n-- \u6839\u636e\u6708\u4efd\u6b63\u8d1f\u51b3\u5b9a\u5e74\u9f84\n\nselect\nname,\nconcat(if(month&gt;=0,year,year-1),'\u5e74',if(month&gt;=0,month,12+month),'\u6708') age\nfrom\n(\nselect\nname,\nyear(current_date())-year(t1.birthday) year,\nmonth(current_date())-month(t1.birthday) month\nfrom\n(\nselect\nname,\nreplace(birthday,'/','-') birthday\nfrom\nemployee\n)t1\n)t2 </code></pre> <p>3\uff09\u6309\u7167\u85aa\u8d44\uff0c\u5956\u91d1\u7684\u548c\u8fdb\u884c\u5012\u5e8f\u6392\u5e8f\uff0c\u5982\u679c\u5956\u91d1\u4e3a null\uff0c\u7f6e\u4f4d 0</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> name sal \u5468\u82b7\u82e5 19000 \u5b8b\u9752\u4e66 19000 \u90ed\u9756 15000 \u5f20\u65e0\u5fcc 15000 \u9ec4\u84c9 12000 \u8d75\u654f 11000 \u5c0f\u9f99\u5973 6000 \u6768\u8fc7 5000 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\nname,\nsalary + nvl(bonus,0) sal\nfrom\nemployee\norder by\nsal desc\n</code></pre> <p>4\uff09\u67e5\u8be2\u6bcf\u4e2a\u4eba\u6709\u591a\u5c11\u4e2a\u670b\u53cb</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> name cnt \u5f20\u65e0\u5fcc 2 \u8d75\u654f 2 \u5b8b\u9752\u4e66 2 \u5468\u82b7\u82e5 2 \u90ed\u9756 2 \u9ec4\u84c9 2 \u6768\u8fc7 2 \u5c0f\u9f99\u5973 2 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select name,\nsize(friends) cnt\nfrom employee; </code></pre> <p>5\uff09\u67e5\u8be2\u6bcf\u4e2a\u4eba\u7684\u5b69\u5b50\u7684\u59d3\u540d</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> name ch_name \u5f20\u65e0\u5fcc [\"\u5f20\u5c0f\u65e0\",\"\u5f20\u5c0f\u5fcc\"] \u8d75\u654f [\"\u8d75\u5c0f\u654f\"] \u5b8b\u9752\u4e66 [\"\u5b8b\u5c0f\u9752\",\"\u5b8b\u5c0f\u4e66\"] \u5468\u82b7\u82e5 [\"\u5b8b\u5c0f\u9752\",\"\u5b8b\u5c0f\u4e66\"] \u90ed\u9756 [\"\u90ed\u8299\",\"\u90ed\u8944\"] \u9ec4\u84c9 [\"\u90ed\u8299\",\"\u90ed\u8944\"] \u6768\u8fc7 [\"\u6768\u5c0f\u8fc7\"] \u5c0f\u9f99\u5973 [\"\u6768\u5c0f\u8fc7\"] <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select name,\nmap_keys(children) ch_name\nfrom employee; </code></pre> <p>6\uff09\u67e5\u8be2\u6bcf\u4e2a\u5c97\u4f4d\u7537\u5973\u5404\u591a\u5c11\u4eba</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> job male female \u524d\u53f0 1 1 \u7814\u53d1 1 1 \u884c\u653f 0 2 \u9500\u552e 2 0 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\njob,\nsum(if(sex='\u7537',1,0)) male,\nsum(if(sex='\u5973',1,0)) female\nfrom\nemployee\ngroup by job\n</code></pre>"},{"location":"engine/hive/hive_08/#83","title":"8.3 \u9ad8\u7ea7\u805a\u5408\u51fd\u6570","text":"<p>\u591a\u8fdb\u4e00\u51fa \uff08\u591a\u884c\u4f20\u5165\uff0c\u4e00\u4e2a\u884c\u8f93\u51fa\uff09\u3002</p> <p>1\uff09\u666e\u901a\u805a\u5408 count/sum.... \u89c1\u7b2c 6 \u7ae0 6.2.4</p> <p>2\uff09collect_list \u6536\u96c6\u5e76\u5f62\u6210 list \u96c6\u5408\uff0c\u7ed3\u679c\u4e0d\u53bb\u91cd</p> <pre><code>select sex,\ncollect_list(job)\nfrom\nemployee\ngroup by sex\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>\u5973   [\"\u884c\u653f\",\"\u7814\u53d1\",\"\u884c\u653f\",\"\u524d\u53f0\"]\n\u7537   [\"\u9500\u552e\",\"\u7814\u53d1\",\"\u9500\u552e\",\"\u524d\u53f0\"]\n</code></pre> <p>3\uff09collect_set \u6536\u96c6\u5e76\u5f62\u6210 set \u96c6\u5408\uff0c\u7ed3\u679c\u53bb\u91cd</p> <pre><code>select sex,\ncollect_set(job)\nfrom\nemployee\ngroup by sex\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>\u5973   [\"\u884c\u653f\",\"\u7814\u53d1\",\"\u524d\u53f0\"]\n\u7537   [\"\u9500\u552e\",\"\u7814\u53d1\",\"\u524d\u53f0\"]\n</code></pre>"},{"location":"engine/hive/hive_08/#831","title":"8.3.1 \u6848\u4f8b\u6f14\u793a","text":"<p>1\uff09\u6bcf\u4e2a\u6708\u7684\u5165\u804c\u4eba\u6570\u4ee5\u53ca\u59d3\u540d</p> <pre><code>select\nmonth(replace(hiredate,'/','-')) as month,\ncount(*) as cn,\nCollect_list(name) as name_list\nfrom\nemployee\ngroup by\nmonth(replace(hiredate,'/','-'))\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>month  cn  name_list\n4       2   [\"\u5b8b\u9752\u4e66\",\"\u5468\u82b7\u82e5\"]\n6       1   [\"\u9ec4\u84c9\"]\n7       1   [\"\u90ed\u9756\"]\n8       2   [\"\u5f20\u65e0\u5fcc\",\"\u6768\u8fc7\"]\n9       2   [\"\u8d75\u654f\",\"\u5c0f\u9f99\u5973\"]\n</code></pre>"},{"location":"engine/hive/hive_08/#84","title":"8.4 \u70b8\u88c2\u51fd\u6570","text":""},{"location":"engine/hive/hive_08/#841","title":"8.4.1 \u6982\u8ff0","text":"UDTF\u7684\u5b9a\u4e49 explodeposexplodeinline <p> explode(array) </p> <p> explode(map) </p> <p> posexplode </p> <p> Inline </p> <p> </p> Lateral View \u5b9a\u4e49 <p> </p> Lateral View \u7528\u6cd5"},{"location":"engine/hive/hive_08/#842","title":"8.4.2 \u6848\u4f8b\u6f14\u793a","text":"<p>1.\u6570\u636e\u51c6\u5907</p> <p>1\uff09\u8868\u7ed3\u6784</p> movie category \u300a\u7591\u72af\u8ffd\u8e2a\u300b \u60ac\u7591\uff0c\u52a8\u4f5c\uff0c\u79d1\u5e7b\uff0c\u5267\u60c5 \u300aLie to me\u300b \u60ac\u7591\uff0c\u8b66\u532a\uff0c\u52a8\u4f5c\uff0c\u5fc3\u7406\uff0c\u5267\u60c5 \u300a\u6218\u72fc2\u300b \u6218\u4e89\uff0c\u52a8\u4f5c\uff0c\u707e\u96be <p>2\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>create table movie_info(\nmovie string,     --\u7535\u5f71\u540d\u79f0\ncategory string   --\u7535\u5f71\u5206\u7c7b\n) row format delimited fields terminated by \"\\t\";\n</code></pre> <p>3\uff09\u88c5\u8f7d\u8bed\u53e5</p> <pre><code>insert overwrite table movie_info\nvalues (\"\u300a\u7591\u72af\u8ffd\u8e2a\u300b\", \"\u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\"),\n(\"\u300aLie to me\u300b\", \"\u60ac\u7591,\u8b66\u532a,\u52a8\u4f5c,\u5fc3\u7406,\u5267\u60c5\"),\n(\"\u300a\u6218\u72fc2\u300b\", \"\u6218\u4e89,\u52a8\u4f5c,\u707e\u96be\");\n</code></pre> <ol> <li>\u9700\u6c42</li> </ol> <p>1\uff09\u9700\u6c42\u8bf4\u660e</p> <p>\u6839\u636e\u4e0a\u8ff0\u7535\u5f71\u4fe1\u606f\u5305\uff0c\u7edf\u8ba1\u5404\u5206\u7c7b\u7684\u7535\u5f71\u6570\u91cf\uff0c\u671f\u671b\u7ed3\u679c\u5982\u4e0b\uff1a</p> \u5267\u60c5 2 \u52a8\u4f5c 3 \u5fc3\u7406 1 \u60ac\u7591 2 \u6218\u4e89 1 \u707e\u96be 1 \u79d1\u5e7b 1 \u8b66\u532a 1 <p>2\uff09\u7b54\u6848</p> <pre><code>select\ncate,\ncount(*)\nfrom\n(\nselect\nmovie,\ncate\nfrom\n(\nselect\nmovie,\nsplit(category,',') cates\nfrom movie_info\n)t1 lateral view explode(cates) tmp as cate\n)t2\ngroup by cate;\n</code></pre>"},{"location":"engine/hive/hive_08/#85","title":"8.5 \u7a97\u53e3\u51fd\u6570\uff08\u5f00\u7a97\u51fd\u6570\uff09","text":""},{"location":"engine/hive/hive_08/#851","title":"8.5.1 \u6982\u8ff0","text":""},{"location":"engine/hive/hive_08/#852","title":"8.5.2 \u5e38\u7528\u7a97\u53e3\u51fd\u6570","text":"<p>\u6309\u7167\u529f\u80fd\uff0c\u5e38\u7528\u7a97\u53e3\u53ef\u5212\u5206\u4e3a\u5982\u4e0b\u51e0\u7c7b\uff1a\u805a\u5408\u51fd\u6570\u3001\u8de8\u884c\u53d6\u503c\u51fd\u6570\u3001\u6392\u540d\u51fd\u6570\u3002</p> <p>1\uff09\u805a\u5408\u51fd\u6570</p> <ul> <li>max\uff1a\u6700\u5927\u503c</li> <li>min\uff1a\u6700\u5c0f\u503c</li> <li>sum\uff1a\u6c42\u548c</li> <li>avg\uff1a\u5e73\u5747\u503c</li> <li>count\uff1a\u8ba1\u6570</li> </ul> <p>2\uff09\u8de8\u884c\u53d6\u503c\u51fd\u6570</p> <p>\uff081\uff09lead \u548c lag</p> <p></p> <p>\u6ce8\u610f</p> <p>lag \u548c lead \u51fd\u6570\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u7a97\u53e3\u3002</p> <p>\uff082\uff09first_value \u548c last_value</p> <p></p> <p>3\uff09\u6392\u540d\u51fd\u6570</p> <p></p> <p>\u6ce8</p> <p>rank \u3001dense_rank\u3001row_number \u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u7a97\u53e3\u3002</p>"},{"location":"engine/hive/hive_08/#853","title":"8.5.3 \u6848\u4f8b\u6f14\u793a","text":"<p>1.\u6570\u636e\u51c6\u5907</p> <p>1\uff09\u8868\u7ed3\u6784</p> order_id user_id user_name order_date order_amount 1 1001 \u5c0f\u5143 2022-01-01 10 2 1002 \u5c0f\u6d77 2022-01-02 15 3 1001 \u5c0f\u5143 2022-02-03 23 4 1002 \u5c0f\u6d77 2022-01-04 29 5 1001 \u5c0f\u5143 2022-01-05 46 <p>2\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>create table order_info\n(\norder_id     string, --\u8ba2\u5355id\nuser_id      string, -- \u7528\u6237id\nuser_name    string, -- \u7528\u6237\u59d3\u540d\norder_date   string, -- \u4e0b\u5355\u65e5\u671f\norder_amount int     -- \u8ba2\u5355\u91d1\u989d\n);\n</code></pre> <p>3\uff09\u88c5\u8f7d\u8bed\u53e5</p> <pre><code>insert overwrite table order_info\nvalues ('1', '1001', '\u5c0f\u5143', '2022-01-01', '10'),\n('2', '1002', '\u5c0f\u6d77', '2022-01-02', '15'),\n('3', '1001', '\u5c0f\u5143', '2022-02-03', '23'),\n('4', '1002', '\u5c0f\u6d77', '2022-01-04', '29'),\n('5', '1001', '\u5c0f\u5143', '2022-01-05', '46'),\n('6', '1001', '\u5c0f\u5143', '2022-04-06', '42'),\n('7', '1002', '\u5c0f\u6d77', '2022-01-07', '50'),\n('8', '1001', '\u5c0f\u5143', '2022-01-08', '50'),\n('9', '1003', '\u5c0f\u8f89', '2022-04-08', '62'),\n('10', '1003', '\u5c0f\u8f89', '2022-04-09', '62'),\n('11', '1004', '\u5c0f\u731b', '2022-05-10', '12'),\n('12', '1003', '\u5c0f\u8f89', '2022-04-11', '75'),\n('13', '1004', '\u5c0f\u731b', '2022-06-12', '80'),\n('14', '1003', '\u5c0f\u8f89', '2022-04-13', '94');\n</code></pre> <ol> <li>\u9700\u6c42</li> </ol> <p>1\uff09\u7edf\u8ba1\u6bcf\u4e2a\u7528\u6237\u622a\u81f3\u6bcf\u6b21\u4e0b\u5355\u7684\u7d2f\u79ef\u4e0b\u5355\u603b\u989d</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> order_id user_id user_name order_date order_amount sum_so_far 1 1001 \u5c0f\u5143 2022-01-01 10 10 5 1001 \u5c0f\u5143 2022-01-05 46 56 8 1001 \u5c0f\u5143 2022-01-08 50 106 3 1001 \u5c0f\u5143 2022-02-03 23 129 6 1001 \u5c0f\u5143 2022-04-06 42 171 2 1002 \u5c0f\u6d77 2022-01-02 15 15 4 1002 \u5c0f\u6d77 2022-01-04 29 44 7 1002 \u5c0f\u6d77 2022-01-07 50 94 9 1003 \u5c0f\u8f89 2022-04-08 62 62 10 1003 \u5c0f\u8f89 2022-04-09 62 124 12 1003 \u5c0f\u8f89 2022-04-11 75 199 14 1003 \u5c0f\u8f89 2022-04-13 94 293 11 1004 \u5c0f\u731b 2022-05-10 12 12 13 1004 \u5c0f\u731b 2022-06-12 80 92 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\norder_id,\nuser_id,\nuser_name,\norder_date,\norder_amount,\nsum(order_amount) over(partition by user_id order by order_date rows between unbounded preceding and current row) sum_so_far\nfrom order_info;\n</code></pre> <p>2\uff09\u7edf\u8ba1\u6bcf\u4e2a\u7528\u6237\u622a\u81f3\u6bcf\u6b21\u4e0b\u5355\u7684\u5f53\u6708\u7d2f\u79ef\u4e0b\u5355\u603b\u989d</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> order_id user_id user_name order_date order_amount sum_so_far 1 1001 \u5c0f\u5143 2022-01-01 10 10 5 1001 \u5c0f\u5143 2022-01-05 46 56 8 1001 \u5c0f\u5143 2022-01-08 50 106 3 1001 \u5c0f\u5143 2022-02-03 23 23 6 1001 \u5c0f\u5143 2022-04-06 42 42 2 1002 \u5c0f\u6d77 2022-01-02 15 15 4 1002 \u5c0f\u6d77 2022-01-04 29 44 7 1002 \u5c0f\u6d77 2022-01-07 50 94 9 1003 \u5c0f\u8f89 2022-04-08 62 62 10 1003 \u5c0f\u8f89 2022-04-09 62 124 12 1003 \u5c0f\u8f89 2022-04-11 75 199 14 1003 \u5c0f\u8f89 2022-04-13 94 293 11 1004 \u5c0f\u731b 2022-05-10 12 12 13 1004 \u5c0f\u731b 2022-06-12 80 80 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\norder_id,\nuser_id,\nuser_name,\norder_date,\norder_amount,\nsum(order_amount) over(partition by user_id,substring(order_date,1,7) order by order_date rows between unbounded preceding and current row) sum_so_far\nfrom order_info;\n</code></pre> <p>3\uff09\u7edf\u8ba1\u6bcf\u4e2a\u7528\u6237\u6bcf\u6b21\u4e0b\u5355\u8ddd\u79bb\u4e0a\u6b21\u4e0b\u5355\u76f8\u9694\u7684\u5929\u6570\uff08\u9996\u6b21\u4e0b\u5355\u6309 0 \u5929\u7b97\uff09</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> order_id user_id user_name order_date order_amount diff 1 1001 \u5c0f\u5143 2022-01-01 10 0 5 1001 \u5c0f\u5143 2022-01-05 46 4 8 1001 \u5c0f\u5143 2022-01-08 50 3 3 1001 \u5c0f\u5143 2022-02-03 23 26 6 1001 \u5c0f\u5143 2022-04-06 42 62 2 1002 \u5c0f\u6d77 2022-01-02 15 0 4 1002 \u5c0f\u6d77 2022-01-04 29 2 7 1002 \u5c0f\u6d77 2022-01-07 50 3 9 1003 \u5c0f\u8f89 2022-04-08 62 0 10 1003 \u5c0f\u8f89 2022-04-09 62 1 12 1003 \u5c0f\u8f89 2022-04-11 75 2 14 1003 \u5c0f\u8f89 2022-04-13 94 2 11 1004 \u5c0f\u731b 2022-05-10 12 0 13 1004 \u5c0f\u731b 2022-06-12 80 33 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\norder_id,\nuser_id,\nuser_name,\norder_date,\norder_amount,\nnvl(datediff(order_date,last_order_date),0) diff\nfrom\n(\nselect\norder_id,\nuser_id,\nuser_name,\norder_date,\norder_amount,\nlag(order_date,1,null) over(partition by user_id order by order_date) last_order_date\nfrom order_info\n)t1\n</code></pre> <p>4\uff09\u67e5\u8be2\u6240\u6709\u4e0b\u5355\u8bb0\u5f55\u4ee5\u53ca\u6bcf\u4e2a\u4e0b\u5355\u8bb0\u5f55\u6240\u5728\u6708\u4efd\u7684\u9996/\u672b\u6b21\u4e0b\u5355\u65e5\u671f</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> order_id user_id user_name order_date order_amount first_date last_date 1 1001 \u5c0f\u5143 2022-01-01 10 2022-01-01 2022-01-08 5 1001 \u5c0f\u5143 2022-01-05 46 2022-01-01 2022-01-08 8 1001 \u5c0f\u5143 2022-01-08 50 2022-01-01 2022-01-08 3 1001 \u5c0f\u5143 2022-02-03 23 2022-02-03 2022-02-03 6 1001 \u5c0f\u5143 2022-04-06 42 2022-04-06 2022-04-06 2 1002 \u5c0f\u6d77 2022-01-02 15 2022-01-02 2022-01-07 4 1002 \u5c0f\u6d77 2022-01-04 29 2022-01-02 2022-01-07 7 1002 \u5c0f\u6d77 2022-01-07 50 2022-01-02 2022-01-07 9 1003 \u5c0f\u8f89 2022-04-08 62 2022-04-08 2022-04-13 10 1003 \u5c0f\u8f89 2022-04-09 62 2022-04-08 2022-04-13 12 1003 \u5c0f\u8f89 2022-04-11 75 2022-04-08 2022-04-13 14 1003 \u5c0f\u8f89 2022-04-13 94 2022-04-08 2022-04-13 11 1004 \u5c0f\u731b 2022-05-10 12 2022-05-10 2022-05-10 13 1004 \u5c0f\u731b 2022-06-12 80 2022-06-12 2022-06-12 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\norder_id,\nuser_id,\nuser_name,\norder_date,\norder_amount,\nfirst_value(order_date) over(partition by user_id,substring(order_date,1,7) order by order_date) first_date,\nlast_value(order_date) over(partition by user_id,substring(order_date,1,7) order by order_date rows between unbounded preceding and unbounded following) last_date\nfrom order_info;\n</code></pre> <p>5\uff09\u4e3a\u6bcf\u4e2a\u7528\u6237\u7684\u6240\u6709\u4e0b\u5355\u8bb0\u5f55\u6309\u7167\u8ba2\u5355\u91d1\u989d\u8fdb\u884c\u6392\u540d</p> <p>\uff081\uff09\u671f\u671b\u7ed3\u679c</p> order_id user_id user_name order_date order_amount rk drk rn 8 1001 \u5c0f\u5143 2022-01-08 50 1 1 1 5 1001 \u5c0f\u5143 2022-01-05 46 2 2 2 6 1001 \u5c0f\u5143 2022-04-06 42 3 3 3 3 1001 \u5c0f\u5143 2022-02-03 23 4 4 4 1 1001 \u5c0f\u5143 2022-01-01 10 5 5 5 7 1002 \u5c0f\u6d77 2022-01-07 50 1 1 1 4 1002 \u5c0f\u6d77 2022-01-04 29 2 2 2 2 1002 \u5c0f\u6d77 2022-01-02 15 3 3 3 14 1003 \u5c0f\u8f89 2022-04-13 94 1 1 1 12 1003 \u5c0f\u8f89 2022-04-11 75 2 2 2 9 1003 \u5c0f\u8f89 2022-04-08 62 3 3 3 10 1003 \u5c0f\u8f89 2022-04-09 62 3 3 4 13 1004 \u5c0f\u731b 2022-06-12 80 1 1 1 11 1004 \u5c0f\u731b 2022-05-10 12 2 2 2 <p>\uff082\uff09\u9700\u6c42\u5b9e\u73b0</p> <pre><code>select\norder_id,\nuser_id,\nuser_name,\norder_date,\norder_amount,\nrank() over(partition by user_id order by order_amount desc) rk,\ndense_rank() over(partition by user_id order by order_amount desc) drk,\nrow_number() over(partition by user_id order by order_amount desc) rn\nfrom order_info;\n</code></pre>"},{"location":"engine/hive/hive_08/#86","title":"8.6 \u81ea\u5b9a\u4e49\u51fd\u6570","text":"<p>1\uff09Hive \u81ea\u5e26\u4e86\u4e00\u4e9b\u51fd\u6570\uff0c\u6bd4\u5982\uff1amax / min \u7b49\uff0c\u4f46\u662f\u6570\u91cf\u6709\u9650\uff0c\u81ea\u5df1\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49 UDF \u6765\u65b9\u4fbf\u7684\u6269\u5c55</p> <p>2\uff09\u5f53 Hive \u63d0\u4f9b\u7684\u5185\u7f6e\u51fd\u6570\u65e0\u6cd5\u6ee1\u8db3\u4f60\u7684\u4e1a\u52a1\u5904\u7406\u9700\u8981\u65f6\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\uff08UDF\uff1auser-defined function\uff09</p> <p>3\uff09\u6839\u636e\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\u7c7b\u522b\u5206\u4e3a\u4ee5\u4e0b\u4e09\u79cd</p> <ul> <li>UDF\uff08User-Defined-Function\uff09     \u4e00\u8fdb\u4e00\u51fa</li> <li>UDAF\uff08User-Defined Aggregation Function\uff09     \u7528\u6237\u81ea\u5b9a\u4e49\u805a\u5408\u51fd\u6570\uff0c\u591a\u8fdb\u4e00\u51fa     \u7c7b\u4f3c\u4e8e\uff1acount / max / min</li> <li>UDTF\uff08User-Defined Table-Generating Functions\uff09     \u7528\u6237\u81ea\u5b9a\u4e49\u8868\u751f\u6210\u51fd\u6570\uff0c\u4e00\u8fdb\u591a\u51fa\u3002     \u5982lateral view explode()</li> </ul> <p>4\uff09\u5b98\u65b9\u6587\u6863</p> <p>5\uff09\u7f16\u7a0b\u6b65\u9aa4</p> <p>\uff081\uff09\u7ee7\u627f Hive \u63d0\u4f9b\u7684\u7c7b</p> <p>org.apache.hadoop.hive.ql.udf.generic.GenericUDF</p> <p>org.apache.hadoop.hive.ql.udf.generic.GenericUDTF</p> <p>\uff082\uff09\u5b9e\u73b0\u7c7b\u4e2d\u7684\u62bd\u8c61\u65b9\u6cd5</p> <p>\uff083\uff09\u5728 Hive \u7684\u547d\u4ee4\u884c\u7a97\u53e3\u521b\u5efa\u51fd\u6570</p> <p>\u6dfb\u52a0 jar</p> <pre><code>add jar linux_jar_path\n</code></pre> <p>\u521b\u5efa function</p> <pre><code>create [temporary] function [dbname.]function_name AS class_name;\n</code></pre> <p>\uff084\uff09\u5728 Hive \u7684\u547d\u4ee4\u884c\u7a97\u53e3\u5220\u9664\u51fd\u6570</p> <pre><code>drop [temporary] function [if exists] [dbname.]function_name;\n</code></pre>"},{"location":"engine/hive/hive_08/#87-udf","title":"8.7 \u81ea\u5b9a\u4e49UDF\u51fd\u6570","text":"<p>0\uff09\u9700\u6c42 \u81ea\u5b9a\u4e49\u4e00\u4e2a UDF \u5b9e\u73b0\u8ba1\u7b97\u7ed9\u5b9a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u957f\u5ea6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>select my_len(\"abcd\");\n\n4\n</code></pre> <p>1\uff09\u521b\u5efa\u4e00\u4e2a Maven \u5de5\u7a0b Hive</p> <p>2\uff09\u5bfc\u5165\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.hive&lt;/groupId&gt;\n&lt;artifactId&gt;hive-exec&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>3\uff09\u521b\u5efa\u4e00\u4e2a\u7c7b</p> <pre><code>package com.atguigu.hive.udf;\n\nimport org.apache.hadoop.hive.ql.exec.UDFArgumentException;\nimport org.apache.hadoop.hive.ql.exec.UDFArgumentLengthException;\nimport org.apache.hadoop.hive.ql.exec.UDFArgumentTypeException;\nimport org.apache.hadoop.hive.ql.metadata.HiveException;\nimport org.apache.hadoop.hive.ql.udf.generic.GenericUDF;\nimport org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;\nimport org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorFactory;\n\n/**\n * \u6211\u4eec\u9700\u8ba1\u7b97\u4e00\u4e2a\u8981\u7ed9\u5b9a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u957f\u5ea6\n */\npublic class MyUDF extends GenericUDF {\n/**\n     * \u5224\u65ad\u4f20\u8fdb\u6765\u7684\u53c2\u6570\u7684\u7c7b\u578b\u548c\u957f\u5ea6\n     * \u7ea6\u5b9a\u8fd4\u56de\u7684\u6570\u636e\u7c7b\u578b\n     */\n@Override\npublic ObjectInspector initialize(ObjectInspector[] arguments) throws UDFArgumentException {\n\nif (arguments.length !=1) {\nthrow  new UDFArgumentLengthException(\"please give me  only one arg\");\n}\n\nif (!arguments[0].getCategory().equals(ObjectInspector.Category.PRIMITIVE)){\nthrow  new UDFArgumentTypeException(1, \"i need primitive type arg\");\n}\n\nreturn PrimitiveObjectInspectorFactory.javaIntObjectInspector;\n}\n\n/**\n     * \u89e3\u51b3\u5177\u4f53\u903b\u8f91\u7684\n     */\n@Override\npublic Object evaluate(DeferredObject[] arguments) throws HiveException {\n\nObject o = arguments[0].get();\nif(o==null){\nreturn 0;\n}\n\nreturn o.toString().length();\n}\n\n@Override\n// \u7528\u4e8e\u83b7\u53d6\u89e3\u91ca\u7684\u5b57\u7b26\u4e32\npublic String getDisplayString(String[] children) {\nreturn \"\";\n}\n}\n</code></pre> <p>4\uff09\u521b\u5efa\u4e34\u65f6\u51fd\u6570</p> <p>\uff081\uff09\u6253\u6210 jar \u5305\u4e0a\u4f20\u5230\u670d\u52a1\u5668 /opt/module/hive/datas/myudf.jar</p> <p>\uff082\uff09\u5c06 jar \u5305\u6dfb\u52a0\u5230 Hive \u7684 classpath\uff0c\u4e34\u65f6\u751f\u6548</p> <pre><code>add jar /opt/module/hive/datas/myudf.jar;\n</code></pre> <p>\uff083\uff09\u521b\u5efa\u4e34\u65f6\u51fd\u6570\u4e0e\u5f00\u53d1\u597d\u7684 java class \u5173\u8054</p> <pre><code>create temporary function my_len as \"com.atguigu.hive.udf.MyUDF\";\n</code></pre> <p>\uff084\uff09\u5373\u53ef\u5728 hql \u4e2d\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u4e34\u65f6\u51fd\u6570</p> <pre><code>select ename,\nmy_len(ename) ename_len from emp;\n</code></pre> <p>\u200b   \uff085\uff09\u5220\u9664\u4e34\u65f6\u51fd\u6570</p> <pre><code>drop temporary function my_len;\n</code></pre> <p>\u6ce8\u610f</p> <p>\u4e34\u65f6\u51fd\u6570\u53ea\u8ddf\u4f1a\u8bdd\u6709\u5173\u7cfb\uff0c\u8ddf\u5e93\u6ca1\u6709\u5173\u7cfb\u3002\u53ea\u8981\u521b\u5efa\u4e34\u65f6\u51fd\u6570\u7684\u4f1a\u8bdd\u4e0d\u65ad\uff0c\u5728\u5f53\u524d\u4f1a\u8bdd\u4e0b\uff0c\u4efb\u610f\u4e00\u4e2a\u5e93\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u5176\u4ed6\u4f1a\u8bdd\u5168\u90fd\u4e0d\u80fd\u4f7f\u7528\u3002</p> <p>5\uff09\u521b\u5efa\u6c38\u4e45\u51fd\u6570</p> <p>\uff081\uff09\u521b\u5efa\u6c38\u4e45\u51fd\u6570</p> <p>\u6ce8\u610f</p> <p>\u56e0\u4e3a add jar \u672c\u8eab\u4e5f\u662f\u4e34\u65f6\u751f\u6548\uff0c\u6240\u4ee5\u5728\u521b\u5efa\u6c38\u4e45\u51fd\u6570\u7684\u65f6\u5019\uff0c\u9700\u8981\u5236\u5b9a\u8def\u5f84\uff08\u5e76\u4e14\u56e0\u4e3a\u5143\u6570\u636e\u7684\u539f\u56e0\uff0c\u8fd9\u4e2a\u8def\u5f84\u8fd8\u5f97\u662f HDFS \u4e0a\u7684\u8def\u5f84\uff09\u3002</p> <pre><code>create function my_len2 as \"com.atguigu.hive.udf.MyUDF\" using jar \"hdfs://hadoop102:8020/udf/myudf.jar\";\n</code></pre> <p>\uff082\uff09\u5373\u53ef\u5728 hql \u4e2d\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u6c38\u4e45\u51fd\u6570 </p> <pre><code>select ename,\nmy_len2(ename) ename_len from emp;\n</code></pre> <p>\uff083\uff09\u5220\u9664\u6c38\u4e45\u51fd\u6570 </p> <pre><code>drop function my_len2;\n</code></pre> <p>\u6ce8\u610f</p> <p>\u6c38\u4e45\u51fd\u6570\u8ddf\u4f1a\u8bdd\u6ca1\u6709\u5173\u7cfb\uff0c\u521b\u5efa\u51fd\u6570\u7684\u4f1a\u8bdd\u65ad\u4e86\u4ee5\u540e\uff0c\u5176\u4ed6\u4f1a\u8bdd\u4e5f\u53ef\u4ee5\u4f7f\u7528\u3002 \u6c38\u4e45\u51fd\u6570\u521b\u5efa\u7684\u65f6\u5019\uff0c\u5728\u51fd\u6570\u540d\u4e4b\u524d\u9700\u8981\u81ea\u5df1\u52a0\u4e0a\u5e93\u540d\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5e93\u540d\u7684\u8bdd\uff0c\u4f1a\u9ed8\u8ba4\u628a\u5f53\u524d\u5e93\u7684\u5e93\u540d\u7ed9\u52a0\u4e0a\u3002 \u6c38\u4e45\u51fd\u6570\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u9700\u8981\u5728\u6307\u5b9a\u7684\u5e93\u91cc\u9762\u64cd\u4f5c\uff0c\u6216\u8005\u5728\u5176\u4ed6\u5e93\u91cc\u9762\u4f7f\u7528\u7684\u8bdd\u52a0\u4e0a\uff0c\u5e93\u540d.\u51fd\u6570\u540d\u3002</p>"},{"location":"engine/hive/hive_08/#88","title":"8.8 \u5e38\u7528\u51fd\u6570\u5927\u5168\uff08\u9644\u5f55\uff09","text":"<p>\u70b9\u51fb\u524d\u5f80HIve\u51fd\u6570\u901f\u67e5\u624b\u518c</p>"},{"location":"engine/hive/hive_09/","title":"\u7efc\u5408\u6848\u4f8b\u7ec3\u4e60\uff08\u4e2d\u7ea7\uff09","text":"<p>\u70b9\u51fb\u524d\u5f80\u5c1a\u7845\u8c37HQL\u5237\u9898\u7f51\u7ad9</p>"},{"location":"engine/hive/hive_10/","title":"\u7b2c10\u7ae0 \u5206\u533a\u8868\u548c\u5206\u6876\u8868","text":""},{"location":"engine/hive/hive_10/#101","title":"10.1 \u5206\u533a\u8868","text":"<p>Hive \u4e2d\u7684\u5206\u533a\u5c31\u662f\u628a\u4e00\u5f20\u5927\u8868\u7684\u6570\u636e\u6309\u7167\u4e1a\u52a1\u9700\u8981\u5206\u6563\u7684\u5b58\u50a8\u5230\u591a\u4e2a\u76ee\u5f55\uff0c\u6bcf\u4e2a\u76ee\u5f55\u5c31\u79f0\u4e3a\u8be5\u8868\u7684\u4e00\u4e2a\u5206\u533a\u3002\u5728\u67e5\u8be2\u65f6\u901a\u8fc7 where \u5b50\u53e5\u4e2d\u7684\u8868\u8fbe\u5f0f\u9009\u62e9\u67e5\u8be2\u6240\u9700\u8981\u7684\u5206\u533a\uff0c\u8fd9\u6837\u7684\u67e5\u8be2\u6548\u7387\u4f1a\u63d0\u9ad8\u5f88\u591a\u3002</p>"},{"location":"engine/hive/hive_10/#1011","title":"10.1.1 \u5206\u533a\u8868\u57fa\u672c\u8bed\u6cd5","text":"<ol> <li>\u521b\u5efa\u5206\u533a\u8868</li> </ol> <pre><code>create table dept_partition\n(\ndeptno int,    --\u90e8\u95e8\u7f16\u53f7\ndname  string, --\u90e8\u95e8\u540d\u79f0\nloc    string  --\u90e8\u95e8\u4f4d\u7f6e\n)\npartitioned by (day string)\nrow format delimited fields terminated by '\\t';\n</code></pre> <ol> <li>\u5206\u533a\u8868\u8bfb\u5199\u6570\u636e</li> </ol> <p>1\uff09\u5199\u6570\u636e</p> <p>\uff081\uff09load</p> <p>1\u20e3\ufe0f\u6570\u636e\u51c6\u5907</p> <p>\u5728 /opt/module/hive/datas/ \u8def\u5f84\u4e0a\u521b\u5efa\u6587\u4ef6 dept_20220401.log\uff0c\u5e76\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\u3002</p> dept_20220401.log<pre><code>10  \u884c\u653f\u90e8 1700\n20  \u8d22\u52a1\u90e8 1800\n</code></pre> <p>2\u20e3\ufe0f\u88c5\u8f7d\u8bed\u53e5</p> <pre><code>load data local inpath '/opt/module/hive/datas/dept_20220401.log' into table dept_partition partition(day='20220401');\n</code></pre> <p>\uff082\uff09insert</p> <p>\u5c06 <code>day='20220401'</code> \u5206\u533a\u7684\u6570\u636e\u63d2\u5165\u5230 <code>day='20220402'</code> \u5206\u533a\uff0c\u53ef\u6267\u884c\u5982\u4e0b\u88c5\u8f7d\u8bed\u53e5</p> <pre><code>insert overwrite table dept_partition partition (day = '20220402')\nselect deptno, dname, loc\nfrom dept_partition\nwhere day = '2020-04-01';\n</code></pre> <p>2\uff09\u8bfb\u6570\u636e</p> <p>\u67e5\u8be2\u5206\u533a\u8868\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u5c06\u5206\u533a\u5b57\u6bb5\u770b\u4f5c\u8868\u7684\u4f2a\u5217\uff0c\u53ef\u50cf\u4f7f\u7528\u5176\u4ed6\u5b57\u6bb5\u4e00\u6837\u4f7f\u7528\u5206\u533a\u5b57\u6bb5\u3002</p> <pre><code>select deptno, dname, loc ,day\nfrom dept_partition\nwhere day = '2020-04-01';\n</code></pre> <p>3. \u5206\u533a\u8868\u57fa\u672c\u64cd\u4f5c</p> <p>1\uff09\u67e5\u770b\u6240\u6709\u5206\u533a\u4fe1\u606f</p> <pre><code>show partitions dept_partition;\n</code></pre> <p>2\uff09\u589e\u52a0\u5206\u533a</p> <p>\uff081\uff09\u521b\u5efa\u5355\u4e2a\u5206\u533a</p> <pre><code>alter table dept_partition add partition(day='20220403');\n</code></pre> <p>\uff082\uff09\u540c\u65f6\u521b\u5efa\u591a\u4e2a\u5206\u533a\uff08\u5206\u533a\u4e4b\u95f4\u4e0d\u80fd\u6709\u9017\u53f7\uff09</p> <pre><code>alter table dept_partition add partition(day='20220404') partition(day='20220405');\n</code></pre> <p>3\uff09\u5220\u9664\u5206\u533a</p> <p>\uff081\uff09\u5220\u9664\u5355\u4e2a\u5206\u533a</p> <pre><code>alter table dept_partition drop partition (day='20220403');\n</code></pre> <p>\uff082\uff09\u540c\u65f6\u5220\u9664\u591a\u4e2a\u5206\u533a\uff08\u5206\u533a\u4e4b\u95f4\u5fc5\u987b\u6709\u9017\u53f7\uff09</p> <pre><code>alter table dept_partition drop partition (day='20220404'), partition(day='20220405');\n</code></pre> <p>4\uff09\u4fee\u590d\u5206\u533a</p> <p>Hive \u5c06\u5206\u533a\u8868\u7684\u6240\u6709\u5206\u533a\u4fe1\u606f\u90fd\u4fdd\u5b58\u5728\u4e86\u5143\u6570\u636e\u4e2d\uff0c\u53ea\u6709\u5143\u6570\u636e\u4e0e HDFS \u4e0a\u7684\u5206\u533a\u8def\u5f84\u4e00\u81f4\u65f6\uff0c\u5206\u533a\u8868\u624d\u80fd\u6b63\u5e38\u8bfb\u5199\u6570\u636e\u3002\u82e5\u7528\u6237\u624b\u52a8\u521b\u5efa/\u5220\u9664\u5206\u533a\u8def\u5f84\uff0cHive \u90fd\u662f\u611f\u77e5\u4e0d\u5230\u7684\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4 Hive \u7684\u5143\u6570\u636e\u548c HDFS \u7684\u5206\u533a\u8def\u5f84\u4e0d\u4e00\u81f4\u3002\u518d\u6bd4\u5982\uff0c\u82e5\u5206\u533a\u8868\u4e3a\u5916\u90e8\u8868\uff0c\u7528\u6237\u6267\u884c drop partition \u547d\u4ee4\u540e\uff0c\u5206\u533a\u5143\u6570\u636e\u4f1a\u88ab\u5220\u9664\uff0c\u800c HDFS \u7684\u5206\u533a\u8def\u5f84\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u540c\u6837\u4f1a\u5bfc\u81f4 Hive \u7684\u5143\u6570\u636e\u548c HDFS \u7684\u5206\u533a\u8def\u5f84\u4e0d\u4e00\u81f4\u3002</p> <p>\u82e5\u51fa\u73b0\u5143\u6570\u636e\u548c HDFS \u8def\u5f84\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u53ef\u901a\u8fc7\u5982\u4e0b\u51e0\u79cd\u624b\u6bb5\u8fdb\u884c\u4fee\u590d\u3002</p> <p>\uff081\uff09add partition</p> <p>\u82e5\u624b\u52a8\u521b\u5efa HDFS \u7684\u5206\u533a\u8def\u5f84\uff0cHive \u65e0\u6cd5\u8bc6\u522b\uff0c\u53ef\u901a\u8fc7 add partition \u547d\u4ee4\u589e\u52a0\u5206\u533a\u5143\u6570\u636e\u4fe1\u606f\uff0c\u4ece\u800c\u4f7f\u5143\u6570\u636e\u548c\u5206\u533a\u8def\u5f84\u4fdd\u6301\u4e00\u81f4\u3002</p> <p>\uff082\uff09drop partition</p> <p>\u82e5\u624b\u52a8\u5220\u9664 HDFS \u7684\u5206\u533a\u8def\u5f84\uff0cHive \u65e0\u6cd5\u8bc6\u522b\uff0c\u53ef\u901a\u8fc7 drop partition \u547d\u4ee4\u5220\u9664\u5206\u533a\u5143\u6570\u636e\u4fe1\u606f\uff0c\u4ece\u800c\u4f7f\u5143\u6570\u636e\u548c\u5206\u533a\u8def\u5f84\u4fdd\u6301\u4e00\u81f4\u3002</p> <p>\uff083\uff09msck</p> <p>\u82e5\u5206\u533a\u5143\u6570\u636e\u548c HDFS \u7684\u5206\u533a\u8def\u5f84\u4e0d\u4e00\u81f4\uff0c\u8fd8\u53ef\u4f7f\u7528 msck \u547d\u4ee4\u8fdb\u884c\u4fee\u590d\uff0c\u4e00\u4e0b\u662f\u6539\u547d\u4ee4\u7684\u7528\u6cd5\u8bf4\u660e\u3002</p> <pre><code>msck repair table table_name [add/drop/sync partitions];\n</code></pre> <p>\u8bf4\u660e</p> <p>msck repair table table_name add partitions\uff1a\u8be5\u547d\u4ee4\u4f1a\u589e\u52a0 HDFS \u8def\u5f84\u5b58\u5728\u4f46\u5143\u6570\u636e\u7f3a\u5931\u7684\u5206\u533a\u4fe1\u606f\u3002 msck repair table table_name drop partitions\uff1a\u8be5\u547d\u4ee4\u4f1a\u5220\u9664 HDFS \u8def\u5f84\u5df2\u7ecf\u5220\u9664\u4f46\u5143\u6570\u636e\u4ecd\u7136\u5b58\u5728\u7684\u5206\u533a\u4fe1\u606f\u3002 msck repair table table_name sync partitions\uff1a\u8be5\u547d\u4ee4\u4f1a\u540c\u6b65 HDFS \u8def\u5f84\u548c\u5143\u6570\u636e\u5206\u533a\u4fe1\u606f\uff0c\u76f8\u5f53\u4e8e\u540c\u65f6\u6267\u884c\u4e0a\u8ff0\u7684\u4e24\u4e2a\u547d\u4ee4\u3002 msck repair table table_name\uff1a\u7b49\u4ef7\u4e8e msck repair table table_name add partitions \u547d\u4ee4\u3002</p>"},{"location":"engine/hive/hive_10/#1012","title":"10.1.2 \u4e8c\u7ea7\u5206\u533a\u8868","text":"<p>\u601d\u8003</p> <p>\u5982\u679c\u4e00\u5929\u5185\u7684\u65e5\u5fd7\u6570\u636e\u91cf\u4e5f\u5f88\u5927\uff0c\u5982\u4f55\u518d\u5c06\u6570\u636e\u62c6\u5206?\u7b54\u6848\u662f\u4e8c\u7ea7\u5206\u533a\u8868\uff0c\u4f8b\u5982\u53ef\u4ee5\u5728\u6309\u5929\u5206\u533a\u7684\u57fa\u7840\u4e0a\uff0c\u518d\u5bf9\u6bcf\u5929\u7684\u6570\u636e\u6309\u5c0f\u65f6\u8fdb\u884c\u5206\u533a\u3002</p> <p>1\uff09\u4e8c\u7ea7\u5206\u533a\u8868\u5efa\u8868\u8bed\u53e5</p> <pre><code>create table dept_partition2(\ndeptno int,    -- \u90e8\u95e8\u7f16\u53f7\ndname string, -- \u90e8\u95e8\u540d\u79f0\nloc string     -- \u90e8\u95e8\u4f4d\u7f6e\n)\npartitioned by (day string, hour string)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>2\uff09\u6570\u636e\u88c5\u8f7d\u8bed\u53e5</p> <pre><code>load data local inpath '/opt/module/hive/datas/dept_20220401.log' into table dept_partition2 partition(day='20220401', hour='12');\n</code></pre> <p>3\uff09\u67e5\u8be2\u5206\u533a\u6570\u636e</p> <pre><code>select * from dept_partition2 where day='20220401' and hour='12';\n</code></pre>"},{"location":"engine/hive/hive_10/#1013","title":"10.1.3 \u52a8\u6001\u5206\u533a","text":"<p>\u52a8\u6001\u5206\u533a\u662f\u6307\u5411\u5206\u533a\u8868 insert \u6570\u636e\u65f6\uff0c\u88ab\u5199\u5f80\u7684\u5206\u533a\u4e0d\u7531\u7528\u6237\u6307\u5b9a\uff0c\u800c\u662f\u7531\u6bcf\u884c\u6570\u636e\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u6bb5\u7684\u503c\u6765\u52a8\u6001\u7684\u51b3\u5b9a\u3002\u4f7f\u7528\u52a8\u6001\u5206\u533a\uff0c\u53ef\u53ea\u7528\u4e00\u4e2a insert \u8bed\u53e5\u5c06\u6570\u636e\u5199\u5165\u591a\u4e2a\u5206\u533a\u3002</p> <p>1\uff09\u52a8\u6001\u5206\u533a\u76f8\u5173\u53c2\u6570</p> <p>\uff081\uff09\u52a8\u6001\u5206\u533a\u529f\u80fd\u603b\u5f00\u5173\uff08\u9ed8\u8ba4 true\uff0c\u5f00\u542f\uff09</p> <pre><code>set hive.exec.dynamic.partition=true\n</code></pre> <p>\uff082\uff09\u4e25\u683c\u6a21\u5f0f\u548c\u975e\u4e25\u683c\u6a21\u5f0f</p> <p>\u52a8\u6001\u5206\u533a\u7684\u6a21\u5f0f\uff0c\u9ed8\u8ba4 strict\uff08\u4e25\u683c\u6a21\u5f0f\uff09\uff0c\u8981\u6c42\u5fc5\u987b\u6307\u5b9a\u81f3\u5c11\u4e00\u4e2a\u5206\u533a\u4e3a\u9759\u6001\u5206\u533a\uff0cnonstrict\uff08\u975e\u4e25\u683c\u6a21\u5f0f\uff09\u5141\u8bb8\u6240\u6709\u7684\u5206\u533a\u5b57\u6bb5\u90fd\u4f7f\u7528\u52a8\u6001\u5206\u533a\u3002</p> <pre><code>set hive.exec.dynamic.partition.mode=nonstrict\n</code></pre> <p>\uff083\uff09\u4e00\u6761 insert \u8bed\u53e5\u53ef\u540c\u65f6\u521b\u5efa\u7684\u6700\u5927\u7684\u5206\u533a\u4e2a\u6570\uff0c\u9ed8\u8ba4\u4e3a 1000\u3002</p> <pre><code>set hive.exec.max.dynamic.partitions=1000\n</code></pre> <p>\uff084\uff09\u5355\u4e2a Mapper \u6216\u8005 Reducer \u53ef\u540c\u65f6\u521b\u5efa\u7684\u6700\u5927\u7684\u5206\u533a\u4e2a\u6570\uff0c\u9ed8\u8ba4\u4e3a 100\u3002</p> <pre><code>set hive.exec.max.dynamic.partitions.pernode=100\n</code></pre> <p>\uff085\uff09\u4e00\u6761 insert \u8bed\u53e5\u53ef\u4ee5\u521b\u5efa\u7684\u6700\u5927\u7684\u6587\u4ef6\u4e2a\u6570\uff0c\u9ed8\u8ba4 100000\u3002</p> <pre><code>set hive.exec.max.created.files=100000\n</code></pre> <p>\uff086\uff09\u5f53\u67e5\u8be2\u7ed3\u679c\u4e3a\u7a7a\u65f6\u4e14\u8fdb\u884c\u52a8\u6001\u5206\u533a\u65f6\uff0c\u662f\u5426\u629b\u51fa\u5f02\u5e38\uff0c\u9ed8\u8ba4 false\u3002</p> <pre><code>hive.error.on.empty.partition=false\n</code></pre> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u9700\u6c42\uff1a\u5c06 dept \u8868\u4e2d\u7684\u6570\u636e\u6309\u7167\u5730\u533a\uff08 loc \u5b57\u6bb5\uff09\uff0c\u63d2\u5165\u5230\u76ee\u6807\u8868 dept_partition \u7684\u76f8\u5e94\u5206\u533a\u4e2d\u3002</p> <p>\uff081\uff09\u521b\u5efa\u76ee\u6807\u5206\u533a\u8868</p> <pre><code>create table dept_partition_dynamic(\nid int, name string\n) partitioned by (loc int) row format delimited fields terminated by '\\t';\n</code></pre> <p>\uff082\uff09\u8bbe\u7f6e\u52a8\u6001\u5206\u533a</p> <pre><code>set hive.exec.dynamic.partition.mode = nonstrict;\nhive (default)&gt; insert into table dept_partition_dynamic partition(loc) select deptno, dname, loc from dept;\n</code></pre> <p>\uff083\uff09\u67e5\u770b\u76ee\u6807\u5206\u533a\u8868\u7684\u5206\u533a\u60c5\u51b5</p> <pre><code>show partitions dept_partition_dynamic;\n</code></pre>"},{"location":"engine/hive/hive_10/#102","title":"10.2 \u5206\u6876\u8868","text":"<p>\u5206\u533a\u63d0\u4f9b\u4e00\u4e2a\u9694\u79bb\u6570\u636e\u548c\u4f18\u5316\u67e5\u8be2\u7684\u4fbf\u5229\u65b9\u5f0f\u3002\u4e0d\u8fc7\uff0c\u5e76\u975e\u6240\u6709\u7684\u6570\u636e\u96c6\u90fd\u53ef\u5f62\u6210\u5408\u7406\u7684\u5206\u533a\u3002\u5bf9\u4e8e\u4e00\u5f20\u8868\u6216\u8005\u5206\u533a\uff0cHive \u53ef\u4ee5\u8fdb\u4e00\u6b65\u7ec4\u7ec7\u6210\u6876\uff0c\u4e5f\u5c31\u662f\u66f4\u4e3a\u7ec6\u7c92\u5ea6\u7684\u6570\u636e\u8303\u56f4\u5212\u5206\uff0c\u5206\u533a\u9488\u5bf9\u7684\u662f\u6570\u636e\u7684\u5b58\u50a8\u8def\u5f84\uff0c\u5206\u6876\u9488\u5bf9\u7684\u662f\u6570\u636e\u6587\u4ef6\u3002</p> <p>\u5206\u6876\u8868\u7684\u57fa\u672c\u539f\u7406\u662f\uff0c\u9996\u5148\u4e3a\u6bcf\u884c\u6570\u636e\u8ba1\u7b97\u4e00\u4e2a\u6307\u5b9a\u5b57\u6bb5\u7684\u6570\u636e\u7684 hash \u503c\uff0c\u7136\u540e\u6a21\u4ee5\u4e00\u4e2a\u6307\u5b9a\u7684\u5206\u6876\u6570\uff0c\u6700\u540e\u5c06\u53d6\u6a21\u8fd0\u7b97\u7ed3\u679c\u76f8\u540c\u7684\u884c\uff0c\u5199\u5165\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5c31\u79f0\u4e3a\u4e00\u4e2a\u5206\u6876\uff08 bucket \uff09\u3002</p>"},{"location":"engine/hive/hive_10/#1021","title":"10.2.1 \u5206\u6876\u8868\u57fa\u672c\u8bed\u6cd5","text":"<p>1\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>create table stu_buck(\nid int, name string\n)\nclustered by(id) into 4 buckets\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>2\uff09\u6570\u636e\u88c5\u8f7d</p> <p>\uff081\uff09\u6570\u636e\u51c6\u5907</p> <p>\u5728 /opt/module/hive/datas/ \u8def\u5f84\u4e0a\u521b\u5efa student.txt \u6587\u4ef6\uff0c\u5e76\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\u3002</p> student.txt<pre><code>1001    student1\n1002    student2\n1003    student3\n1004    student4\n1005    student5\n1006    student6\n1007    student7\n1008    student8\n1009    student9\n1010    student10\n1011    student11\n1012    student12\n1013    student13\n1014    student14\n1015    student15\n1016    student16\n</code></pre> <p>\uff082\uff09\u5bfc\u5165\u6570\u636e\u5230\u5206\u6876\u8868\u4e2d</p> <p>\u8bf4\u660e</p> <p>Hive \u65b0\u7248\u672c load \u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u8dd1 MapReduce\uff0c\u8001\u7248\u7684 Hive \u9700\u8981\u5c06\u6570\u636e\u4f20\u5230\u4e00\u5f20\u8868\u91cc\uff0c\u518d\u901a\u8fc7\u67e5\u8be2\u7684\u65b9\u5f0f\u5bfc\u5165\u5230\u5206\u6876\u8868\u91cc\u9762\u3002</p> <pre><code>load data local inpath '/opt/module/hive/datas/student.txt' into table stu_buck;\n</code></pre> <p>\uff083\uff09\u67e5\u770b\u521b\u5efa\u7684\u5206\u6876\u8868\u4e2d\u662f\u5426\u5206\u6210 4 \u4e2a\u6876</p> <p></p> <p>\uff084\uff09\u89c2\u5bdf\u6bcf\u4e2a\u5206\u6876\u4e2d\u7684\u6570\u636e</p>"},{"location":"engine/hive/hive_10/#1022","title":"10.2.2 \u5206\u6876\u6392\u5e8f\u8868","text":"<p>1\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>create table stu_buck_sort(\nid int, name string\n)\nclustered by(id) sorted by(id)\ninto 4 buckets\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>2\uff09\u6570\u636e\u88c5\u8f7d</p> <p>\uff081\uff09\u5bfc\u5165\u6570\u636e\u5230\u5206\u6876\u8868\u4e2d</p> <pre><code>load data local inpath '/opt/module/hive/datas/student.txt' into table stu_buck_sort;\n</code></pre> <p>\uff082\uff09\u67e5\u770b\u521b\u5efa\u7684\u5206\u6876\u8868\u4e2d\u662f\u5426\u5206\u6210 4 \u4e2a\u6876</p> <p></p> <p>\uff083\uff09\u89c2\u5bdf\u6bcf\u4e2a\u5206\u6876\u4e2d\u7684\u6570\u636e</p>"},{"location":"engine/hive/hive_11/","title":"\u7b2c11\u7ae0 \u6587\u4ef6\u683c\u5f0f\u548c\u538b\u7f29","text":""},{"location":"engine/hive/hive_11/#111-hadoop","title":"11.1 Hadoop\u538b\u7f29\u6982\u8ff0","text":"\u538b\u7f29\u683c\u5f0f \u7b97\u6cd5 \u6587\u4ef6\u6269\u5c55\u540d \u662f\u5426\u53ef\u5207\u5206 DEFLATE DEFLATE .deflate \u5426 Gzip DEFLATE .gz \u5426 bzip2 bzip2 .bz2 \u662f LZO LZO .lzo \u662f Snappy Snappy .snappy \u5426 <p>\u4e3a\u4e86\u652f\u6301\u591a\u79cd\u538b\u7f29/\u89e3\u538b\u7f29\u7b97\u6cd5\uff0cHadoop \u5f15\u5165\u4e86\u7f16\u7801/\u89e3\u7801\u5668\uff0c\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> <p>Hadoop \u67e5\u770b\u652f\u6301\u538b\u7f29\u7684\u65b9\u5f0f hadoop checknative\u3002</p> <p>Hadoop \u5728 driver \u7aef\u8bbe\u7f6e\u538b\u7f29\u3002</p> \u538b\u7f29\u683c\u5f0f \u5bf9\u5e94\u7684\u7f16\u7801/\u89e3\u7801\u5668 DEFLATE org.apache.hadoop.io.compress.DefaultCodec gzip org.apache.hadoop.io.compress.GzipCodec bzip2 org.apache.hadoop.io.compress.BZip2Codec LZO com.hadoop.compression.lzo.LzopCodec Snappy org.apache.hadoop.io.compress.SnappyCodec <p>\u538b\u7f29\u6027\u80fd\u7684\u6bd4\u8f83\uff1a</p> \u538b\u7f29\u7b97\u6cd5 \u539f\u59cb\u6587\u4ef6\u5927\u5c0f \u538b\u7f29\u6587\u4ef6\u5927\u5c0f \u538b\u7f29\u901f\u5ea6 \u89e3\u538b\u901f\u5ea6 gzip 8.3GB 1.8GB 17.5MB/s 58MB/s bzip2 8.3GB 1.1GB 2.4MB/s 9.5MB/s LZO 8.3GB 2.9GB 49.3MB/s 74.6MB/s <p><code>On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250 MB/sec or more and decompresses at about 500 MB/sec or more.</code></p>"},{"location":"engine/hive/hive_11/#112-hive","title":"11.2 Hive\u6587\u4ef6\u683c\u5f0f","text":"<p>\u4e3a Hive \u8868\u4e2d\u7684\u6570\u636e\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u5bf9\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u7684\u63d0\u9ad8\u662f\u5341\u5206\u6709\u76ca\u7684\u3002Hive \u8868\u6570\u636e\u7684\u5b58\u50a8\u683c\u5f0f\uff0c\u53ef\u4ee5\u9009\u62e9 text file\u3001orc\u3001parquet\u3001sequence file \u7b49\u3002</p>"},{"location":"engine/hive/hive_11/#1121-text-file","title":"11.2.1 Text File","text":"<p>\u6587\u672c\u6587\u4ef6\u662f Hive \u9ed8\u8ba4\u4f7f\u7528\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u6587\u672c\u6587\u4ef6\u4e2d\u7684\u4e00\u884c\u5185\u5bb9\uff0c\u5c31\u5bf9\u5e94 Hive \u8868\u4e2d\u7684\u4e00\u884c\u8bb0\u5f55\u3002</p> <p>\u53ef\u901a\u8fc7\u4ee5\u4e0b\u5efa\u8868\u8bed\u53e5\u6307\u5b9a\u6587\u4ef6\u683c\u5f0f\u4e3a\u6587\u672c\u6587\u4ef6:</p> <pre><code>create table textfile_table\n(column_specs)\nstored as textfile;\n</code></pre>"},{"location":"engine/hive/hive_11/#1122-orc","title":"11.2.2 ORC","text":"<p>1\uff09\u6587\u4ef6\u683c\u5f0f</p> <p>ORC\uff08Optimized Row Columnar\uff09file format \u662f Hive 0.11 \u7248\u91cc\u5f15\u5165\u7684\u4e00\u79cd\u5217\u5f0f\u5b58\u50a8\u7684\u6587\u4ef6\u683c\u5f0f\u3002ORC \u6587\u4ef6\u80fd\u591f\u63d0\u9ad8 Hive \u8bfb\u5199\u6570\u636e\u548c\u5904\u7406\u6570\u636e\u7684\u6027\u80fd\u3002</p> <p>\u4e0e\u5217\u5f0f\u5b58\u50a8\u76f8\u5bf9\u7684\u662f\u884c\u5f0f\u5b58\u50a8\uff0c\u4e0b\u56fe\u662f\u4e24\u8005\u7684\u5bf9\u6bd4\uff1a</p> <p></p> <p>\u5982\u56fe\u6240\u793a\u5de6\u8fb9\u4e3a\u903b\u8f91\u8868\uff0c\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u4e3a\u884c\u5f0f\u5b58\u50a8\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u5217\u5f0f\u5b58\u50a8\u3002</p> <p>\uff081\uff09\u884c\u5b58\u50a8\u7684\u7279\u70b9</p> <p>\u67e5\u8be2\u6ee1\u8db3\u6761\u4ef6\u7684\u4e00\u6574\u884c\u6570\u636e\u7684\u65f6\u5019\uff0c\u5217\u5b58\u50a8\u5219\u9700\u8981\u53bb\u6bcf\u4e2a\u805a\u96c6\u7684\u5b57\u6bb5\u627e\u5230\u5bf9\u5e94\u7684\u6bcf\u4e2a\u5217\u7684\u503c\uff0c\u884c\u5b58\u50a8\u53ea\u9700\u8981\u627e\u5230\u5176\u4e2d\u4e00\u4e2a\u503c\uff0c\u5176\u4f59\u7684\u503c\u90fd\u5728\u76f8\u90bb\u5730\u65b9\uff0c\u6240\u4ee5\u6b64\u65f6\u884c\u5b58\u50a8\u67e5\u8be2\u7684\u901f\u5ea6\u66f4\u5feb\u3002</p> <p>\uff082\uff09\u5217\u5b58\u50a8\u7684\u7279\u70b9</p> <p>\u56e0\u4e3a\u6bcf\u4e2a\u5b57\u6bb5\u7684\u6570\u636e\u805a\u96c6\u5b58\u50a8\uff0c\u5728\u67e5\u8be2\u53ea\u9700\u8981\u5c11\u6570\u51e0\u4e2a\u5b57\u6bb5\u7684\u65f6\u5019\uff0c\u80fd\u5927\u5927\u51cf\u5c11\u8bfb\u53d6\u7684\u6570\u636e\u91cf\uff1b\u6bcf\u4e2a\u5b57\u6bb5\u7684\u6570\u636e\u7c7b\u578b\u4e00\u5b9a\u662f\u76f8\u540c\u7684\uff0c\u5217\u5f0f\u5b58\u50a8\u53ef\u4ee5\u9488\u5bf9\u6027\u7684\u8bbe\u8ba1\u66f4\u597d\u7684\u8bbe\u8ba1\u538b\u7f29\u7b97\u6cd5\u3002</p> <p>\u524d\u6587\u63d0\u5230\u7684 text file \u548c sequence file \u90fd\u662f\u57fa\u4e8e\u884c\u5b58\u50a8\u7684\uff0corc \u548c parquet \u662f\u57fa\u4e8e\u5217\u5f0f\u5b58\u50a8\u7684\u3002</p> <p>orc \u6587\u4ef6\u7684\u5177\u4f53\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6bcf\u4e2a ORC \u6587\u4ef6\u7531 Header\u3001Body \u548c Tail \u4e09\u90e8\u5206\u7ec4\u6210\u3002</p> <p>\u5176\u4e2d Header \u5185\u5bb9\u4e3a ORC\uff0c\u7528\u4e8e\u8868\u793a\u6587\u4ef6\u7c7b\u578b\u3002</p> <p>Body \u7531 1 \u4e2a\u6216\u591a\u4e2a stripe \u7ec4\u6210\uff0c\u6bcf\u4e2a stripe \u4e00\u822c\u4e3a HDFS \u7684\u5757\u5927\u5c0f\uff0c\u6bcf\u4e00\u4e2a stripe \u5305\u542b\u591a\u6761\u8bb0\u5f55\uff0c\u8fd9\u4e9b\u8bb0\u5f55\u6309\u7167\u5217\u8fdb\u884c\u72ec\u7acb\u5b58\u50a8\uff0c\u6bcf\u4e2a stripe \u91cc\u6709\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u5206\u522b\u662f Index Data\uff0cRow Data\uff0cStripe Footer\u3002</p> <p>Index Data\uff1a\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684 index\uff0c\u9ed8\u8ba4\u662f\u4e3a\u5404\u5217\u6bcf\u9694 1W \u884c\u505a\u4e00\u4e2a\u7d22\u5f15\u3002\u6bcf\u4e2a\u7d22\u5f15\u4f1a\u8bb0\u5f55\u7b2c n \u4e07\u884c\u7684\u4f4d\u7f6e\uff0c\u548c\u6700\u8fd1\u4e00\u4e07\u884c\u7684\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u7b49\u4fe1\u606f\u3002</p> <p>Row Data\uff1a\u5b58\u7684\u662f\u5177\u4f53\u7684\u6570\u636e\uff0c\u6309\u5217\u8fdb\u884c\u5b58\u50a8\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u5217\u8fdb\u884c\u7f16\u7801\uff0c\u5206\u6210\u591a\u4e2a Stream \u6765\u5b58\u50a8\u3002</p> <p>Stripe Footer\uff1a\u5b58\u653e\u7684\u662f\u5404\u4e2a Stream \u7684\u4f4d\u7f6e\u4ee5\u53ca\u5404 column \u7684\u7f16\u7801\u4fe1\u606f\u3002</p> <p>Tail \u7531 File Footer \u548c PostScript \u7ec4\u6210\u3002File Footer \u4e2d\u4fdd\u5b58\u4e86\u5404 Stripe \u7684\u771f\u5b9e\u4f4d\u7f6e\u3001\u7d22\u5f15\u957f\u5ea6\u3001\u6570\u636e\u957f\u5ea6\u7b49\u4fe1\u606f\uff0c\u5404 Column \u7684\u7edf\u8ba1\u4fe1\u606f\u7b49\uff1bPostScript \u8bb0\u5f55\u4e86\u6574\u4e2a\u6587\u4ef6\u7684\u538b\u7f29\u7c7b\u578b\u4ee5\u53ca File Footer \u7684\u957f\u5ea6\u4fe1\u606f\u7b49\u3002</p> <p>\u5728\u8bfb\u53d6 ORC \u6587\u4ef6\u65f6\uff0c\u4f1a\u5148\u4ece\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u8bfb\u53d6 PostScript \u957f\u5ea6\uff0c\u8fdb\u800c\u8bfb\u53d6\u5230 PostScript\uff0c\u4ece\u91cc\u9762\u89e3\u6790\u5230 File Footer \u957f\u5ea6\uff0c\u8fdb\u800c\u8bfb\u53d6 FileFooter\uff0c\u4ece\u4e2d\u89e3\u6790\u5230\u5404\u4e2a Stripe \u4fe1\u606f\uff0c\u518d\u8bfb\u5404\u4e2a Stripe\uff0c\u5373\u4ece\u540e\u5f80\u524d\u8bfb\u3002</p> <p>3\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>create table orc_table\n(column_specs)\nstored as orc\ntblproperties (property_name=property_value, ...);\n</code></pre> <p>ORC \u6587\u4ef6\u683c\u5f0f\u652f\u6301\u7684\u53c2\u6570\u5982\u4e0b\uff1a</p> \u53c2\u6570 \u9ed8\u8ba4\u503c \u8bf4\u660e orc.compress ZLIB \u538b\u7f29\u683c\u5f0f\uff0c\u53ef\u9009\u9879\uff1aNONE\u3001ZLIB,\u3001SNAPPY orc.compress.size 262,144 \u6bcf\u4e2a\u538b\u7f29\u5757\u7684\u5927\u5c0f\uff08ORC\u6587\u4ef6\u662f\u5206\u5757\u538b\u7f29\u7684\uff09 orc.stripe.size 67,108,864 \u6bcf\u4e2astripe\u7684\u5927\u5c0f orc.row.index.stride 10,000 \u7d22\u5f15\u6b65\u957f\uff08\u6bcf\u9694\u591a\u5c11\u884c\u6570\u636e\u5efa\u4e00\u6761\u7d22\u5f15\uff09"},{"location":"engine/hive/hive_11/#1113-parquet","title":"11.1.3 Parquet","text":"<p>Parquet \u6587\u4ef6\u662f Hadoop \u751f\u6001\u4e2d\u7684\u4e00\u4e2a\u901a\u7528\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u5217\u5f0f\u5b58\u50a8\u7684\u6587\u4ef6\u683c\u5f0f\u3002</p> <p>Parquet \u6587\u4ef6\u7684\u683c\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e0a\u56fe\u5c55\u793a\u4e86\u4e00\u4e2a Parquet \u6587\u4ef6\u7684\u57fa\u672c\u7ed3\u6784\uff0c\u6587\u4ef6\u7684\u9996\u5c3e\u90fd\u662f\u8be5\u6587\u4ef6\u7684 Magic Code\uff0c\u7528\u4e8e\u6821\u9a8c\u5b83\u662f\u5426\u662f\u4e00\u4e2a Parquet \u6587\u4ef6\u3002</p> <p>\u9996\u5c3e\u4e2d\u95f4\u7531\u82e5\u5e72\u4e2a Row Group \u548c\u4e00\u4e2a Footer\uff08File Meta Data\uff09\u7ec4\u6210\u3002</p> <p>\u6bcf\u4e2a Row Group \u5305\u542b\u591a\u4e2a Column Chunk\uff0c\u6bcf\u4e2a Column Chunk \u5305\u542b\u591a\u4e2a Page\u3002\u4ee5\u4e0b\u662f Row Group\u3001Column Chunk \u548c Page \u4e09\u4e2a\u6982\u5ff5\u7684\u8bf4\u660e\uff1a</p> <p>\u884c\u7ec4\uff08Row Group\uff09\uff1a\u4e00\u4e2a\u884c\u7ec4\u5bf9\u5e94\u903b\u8f91\u8868\u4e2d\u7684\u82e5\u5e72\u884c\u3002 </p> <p>\u5217\u5757\uff08Column Chunk\uff09\uff1a\u4e00\u4e2a\u884c\u7ec4\u4e2d\u7684\u4e00\u5217\u4fdd\u5b58\u5728\u4e00\u4e2a\u5217\u5757\u4e2d\u3002 </p> <p>\u9875\uff08Page\uff09\uff1a\u4e00\u4e2a\u5217\u5757\u7684\u6570\u636e\u4f1a\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u9875\u3002</p> <p>Footer\uff08File Meta Data\uff09\u4e2d\u5b58\u50a8\u4e86\u6bcf\u4e2a\u884c\u7ec4\uff08Row Group\uff09\u4e2d\u7684\u6bcf\u4e2a\u5217\u5feb\uff08Column Chunk\uff09\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5143\u6570\u636e\u4fe1\u606f\u5305\u542b\u4e86\u8be5\u5217\u7684\u6570\u636e\u7c7b\u578b\u3001\u8be5\u5217\u7684\u7f16\u7801\u65b9\u5f0f\u3001\u8be5\u7c7b\u7684 Data Page \u4f4d\u7f6e\u7b49\u4fe1\u606f\u3002</p> <p>3\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>Create table parquet_table\n(column_specs)\nstored as parquet\ntblproperties (property_name=property_value, ...);\n</code></pre> <p>\u652f\u6301\u7684\u53c2\u6570\u5982\u4e0b\uff1a</p> \u53c2\u6570 \u9ed8\u8ba4\u503c \u8bf4\u660e parquet.compression uncompressed \u538b\u7f29\u683c\u5f0f\uff0c\u53ef\u9009\u9879\uff1auncompressed\uff0csnappy\uff0cgzip\uff0clzo\uff0cbrotli\uff0clz4 parquet.block.size 134217728 \u884c\u7ec4\u5927\u5c0f\uff0c\u901a\u5e38\u4e0eHDFS\u5757\u5927\u5c0f\u4fdd\u6301\u4e00\u81f4 parquet.page.size 1048576 \u9875\u5927\u5c0f"},{"location":"engine/hive/hive_11/#113","title":"11.3 \u538b\u7f29","text":"<p>\u5728 Hive \u8868\u4e2d\u548c\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\uff0c\u4fdd\u6301\u6570\u636e\u7684\u538b\u7f29\uff0c\u5bf9\u78c1\u76d8\u7a7a\u95f4\u7684\u6709\u6548\u5229\u7528\u548c\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u90fd\u662f\u5341\u5206\u6709\u76ca\u7684\u3002</p>"},{"location":"engine/hive/hive_11/#1121-hive","title":"11.2.1 Hive\u8868\u6570\u636e\u8fdb\u884c\u538b\u7f29","text":"<p>\u5728 Hive \u4e2d\uff0c\u4e0d\u540c\u6587\u4ef6\u7c7b\u578b\u7684\u8868\uff0c\u58f0\u660e\u6570\u636e\u538b\u7f29\u7684\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\u3002</p> <p>1\uff09TextFile</p> <p>\u82e5\u4e00\u5f20\u8868\u7684\u6587\u4ef6\u7c7b\u578b\u4e3a TextFile\uff0c\u82e5\u9700\u8981\u5bf9\u8be5\u8868\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u538b\u7f29\uff0c\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u65e0\u9700\u5728\u5efa\u8868\u8bed\u53e5\u505a\u51fa\u58f0\u660e\u3002\u76f4\u63a5\u5c06\u538b\u7f29\u540e\u7684\u6587\u4ef6\u5bfc\u5165\u5230\u8be5\u8868\u5373\u53ef\uff0cHive \u5728\u67e5\u8be2\u8868\u4e2d\u6570\u636e\u65f6\uff0c\u53ef\u81ea\u52a8\u8bc6\u522b\u5176\u538b\u7f29\u683c\u5f0f\uff0c\u8fdb\u884c\u89e3\u538b\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u6267\u884c\u5f80\u8868\u4e2d\u5bfc\u5165\u6570\u636e\u7684 SQL \u8bed\u53e5\u65f6\uff0c\u7528\u6237\u9700\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\uff0c\u6765\u4fdd\u8bc1\u5199\u5165\u8868\u4e2d\u7684\u6570\u636e\u662f\u88ab\u538b\u7f29\u7684\u3002</p> <pre><code>--SQL\u8bed\u53e5\u7684\u6700\u7ec8\u8f93\u51fa\u7ed3\u679c\u662f\u5426\u538b\u7f29\nset hive.exec.compress.output=true;\n--\u8f93\u51fa\u7ed3\u679c\u7684\u538b\u7f29\u683c\u5f0f\uff08\u4ee5\u4e0b\u793a\u4f8b\u4e3asnappy\uff09\nset mapreduce.output.fileoutputformat.compress.codec =org.apache.hadoop.io.compress.SnappyCodec;\n</code></pre> <p>2\uff09ORC</p> <p>\u82e5\u4e00\u5f20\u8868\u7684\u6587\u4ef6\u7c7b\u578b\u4e3a ORC\uff0c\u82e5\u9700\u8981\u5bf9\u8be5\u8868\u6570\u636e\u8fdb\u884c\u538b\u7f29\uff0c\u9700\u5728\u5efa\u8868\u8bed\u53e5\u4e2d\u58f0\u660e\u538b\u7f29\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>create table orc_table\n(column_specs)\nstored as orc\ntblproperties (\"orc.compress\"=\"snappy\");\n</code></pre> <p>3\uff09Parquet</p> <p>\u82e5\u4e00\u5f20\u8868\u7684\u6587\u4ef6\u7c7b\u578b\u4e3a Parquet\uff0c\u82e5\u9700\u8981\u5bf9\u8be5\u8868\u6570\u636e\u8fdb\u884c\u538b\u7f29\uff0c\u9700\u5728\u5efa\u8868\u8bed\u53e5\u4e2d\u58f0\u660e\u538b\u7f29\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>create table orc_table\n(column_specs)\nstored as parquet\ntblproperties (\"parquet.compression\"=\"snappy\");\n</code></pre>"},{"location":"engine/hive/hive_11/#1122","title":"11.2.2 \u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u538b\u7f29","text":"<p>1\uff09\u5355\u4e2a MR \u7684\u4e2d\u95f4\u7ed3\u679c\u8fdb\u884c\u538b\u7f29</p> <p>\u5355\u4e2a MR \u7684\u4e2d\u95f4\u7ed3\u679c\u662f\u6307 Mapper \u8f93\u51fa\u7684\u6570\u636e\uff0c\u5bf9\u5176\u8fdb\u884c\u538b\u7f29\u53ef\u964d\u4f4e shuffle \u9636\u6bb5\u7684\u7f51\u7edc IO\uff0c\u53ef\u901a\u8fc7\u4ee5\u4e0b\u53c2\u6570\u8fdb\u884c\u914d\u7f6e\uff1a</p> <pre><code>--\u5f00\u542fMapReduce\u4e2d\u95f4\u6570\u636e\u538b\u7f29\u529f\u80fd\nset mapreduce.map.output.compress=true;\n--\u8bbe\u7f6eMapReduce\u4e2d\u95f4\u6570\u636e\u6570\u636e\u7684\u538b\u7f29\u65b9\u5f0f\uff08\u4ee5\u4e0b\u793a\u4f8b\u4e3asnappy\uff09\nset mapreduce.map.output.compress.codec=org.apache.hadoop.io.compress.SnappyCodec;\n</code></pre> <p>2\uff09\u5355\u6761 SQL \u8bed\u53e5\u7684\u4e2d\u95f4\u7ed3\u679c\u8fdb\u884c\u538b\u7f29</p> <p>\u5355\u6761 SQL \u8bed\u53e5\u7684\u4e2d\u95f4\u7ed3\u679c\u662f\u6307\uff0c\u4e24\u4e2a MR\uff08\u4e00\u6761 SQL \u8bed\u53e5\u53ef\u80fd\u9700\u8981\u901a\u8fc7MR\u8fdb\u884c\u8ba1\u7b97\uff09\u4e4b\u95f4\u7684\u4e34\u65f6\u6570\u636e\uff0c\u53ef\u901a\u8fc7\u4ee5\u4e0b\u53c2\u6570\u8fdb\u884c\u914d\u7f6e\uff1a</p> <pre><code>--\u662f\u5426\u5bf9\u4e24\u4e2aMR\u4e4b\u95f4\u7684\u4e34\u65f6\u6570\u636e\u8fdb\u884c\u538b\u7f29\nset hive.exec.compress.intermediate=true;\n--\u538b\u7f29\u683c\u5f0f\uff08\u4ee5\u4e0b\u793a\u4f8b\u4e3asnappy\uff09\nset hive.intermediate.compression.codec= org.apache.hadoop.io.compress.SnappyCodec;\n</code></pre>"},{"location":"engine/hive/hive_12/","title":"\u7b2c12\u7ae0 \u4f01\u4e1a\u7ea7\u8c03\u4f18","text":""},{"location":"engine/hive/hive_12/#121","title":"12.1 \u8ba1\u7b97\u8d44\u6e90\u914d\u7f6e","text":"<p>\u672c\u6559\u7a0b\u7684\u8ba1\u7b97\u73af\u5883\u4e3a Hive on MR\u3002\u8ba1\u7b97\u8d44\u6e90\u7684\u8c03\u6574\u4e3b\u8981\u5305\u62ec Yarn \u548c MR\u3002</p>"},{"location":"engine/hive/hive_12/#1211-yarn","title":"12.1.1 Yarn\u8d44\u6e90\u914d\u7f6e","text":"<p>1\uff09Yarn\u914d\u7f6e\u8bf4\u660e</p> <p>\u9700\u8981\u8c03\u6574\u7684 Yarn \u53c2\u6570\u5747\u4e0e CPU\u3001\u5185\u5b58\u7b49\u8d44\u6e90\u6709\u5173\uff0c\u6838\u5fc3\u914d\u7f6e\u53c2\u6570\u5982\u4e0b</p> <p>\uff081\uff09yarn.nodemanager.resource.memory-mb</p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u4e00\u4e2a NodeManager \u8282\u70b9\u5206\u914d\u7ed9 Container \u4f7f\u7528\u7684\u5185\u5b58\u3002\u8be5\u53c2\u6570\u7684\u914d\u7f6e\uff0c\u53d6\u51b3\u4e8e NodeManager \u6240\u5728\u8282\u70b9\u7684\u603b\u5185\u5b58\u5bb9\u91cf\u548c\u8be5\u8282\u70b9\u8fd0\u884c\u7684\u5176\u4ed6\u670d\u52a1\u7684\u6570\u91cf\u3002</p> <p>\u8003\u8651\u4e0a\u8ff0\u56e0\u7d20\uff0c\u6b64\u5904\u53ef\u5c06\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a 64G\uff0c\u5982\u4e0b\uff1a</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.resource.memory-mb&lt;/name&gt;\n&lt;value&gt;65536&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09yarn.nodemanager.resource.cpu-vcores</p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u4e00\u4e2a NodeManager \u8282\u70b9\u5206\u914d\u7ed9 Container \u4f7f\u7528\u7684 CPU \u6838\u6570\u3002\u8be5\u53c2\u6570\u7684\u914d\u7f6e\uff0c\u540c\u6837\u53d6\u51b3\u4e8e NodeManager \u6240\u5728\u8282\u70b9\u7684\u603b CPU \u6838\u6570\u548c\u8be5\u8282\u70b9\u8fd0\u884c\u7684\u5176\u4ed6\u670d\u52a1\u3002</p> <p>\u8003\u8651\u4e0a\u8ff0\u56e0\u7d20\uff0c\u6b64\u5904\u53ef\u5c06\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a 16\u3002</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.resource.cpu-vcores&lt;/name&gt;\n&lt;value&gt;16&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff083\uff09yarn.scheduler.maximum-allocation-mb</p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u5355\u4e2a Container \u80fd\u591f\u4f7f\u7528\u7684\u6700\u5927\u5185\u5b58\u3002\u63a8\u8350\u914d\u7f6e\u5982\u4e0b\uff1a</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.scheduler.maximum-allocation-mb&lt;/name&gt;\n&lt;value&gt;16384&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff084\uff09yarn.scheduler.minimum-allocation-mb</p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u5355\u4e2a Container \u80fd\u591f\u4f7f\u7528\u7684\u6700\u5c0f\u5185\u5b58\uff0c\u63a8\u8350\u914d\u7f6e\u5982\u4e0b\uff1a</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.scheduler.minimum-allocation-mb&lt;/name&gt;\n&lt;value&gt;512&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>2\uff09Yarn \u914d\u7f6e\u5b9e\u64cd</p> <p>\uff081\uff09\u4fee\u6539 $HADOOP_HOME/etc/hadoop/yarn-site.xml \u6587\u4ef6</p> <p>\uff082\uff09\u4fee\u6539\u5982\u4e0b\u53c2\u6570</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.resource.memory-mb&lt;/name&gt;\n&lt;value&gt;65536&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.resource.cpu-vcores&lt;/name&gt;\n&lt;value&gt;16&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.maximum-allocation-mb&lt;/name&gt;\n&lt;value&gt;16384&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.minimum-allocation-mb&lt;/name&gt;\n&lt;value&gt;512&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff083\uff09\u5206\u53d1\u8be5\u914d\u7f6e\u6587\u4ef6</p> <p>\uff084\uff09\u91cd\u542f Yarn</p>"},{"location":"engine/hive/hive_12/#1212-mapreduce","title":"12.1.2 MapReduce \u8d44\u6e90\u914d\u7f6e","text":"<p>MapReduce \u8d44\u6e90\u914d\u7f6e\u4e3b\u8981\u5305\u62ec Map Task \u7684\u5185\u5b58\u548c CPU \u6838\u6570\uff0c\u4ee5\u53ca Reduce Task \u7684\u5185\u5b58\u548c CPU \u6838\u6570\u3002\u6838\u5fc3\u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> <p>1\uff09mapreduce.map.memory.mb </p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u5355\u4e2a Map Task \u7533\u8bf7\u7684 container \u5bb9\u5668\u5185\u5b58\u5927\u5c0f\uff0c\u5176\u9ed8\u8ba4\u503c\u4e3a 1024\u3002\u8be5\u503c\u4e0d\u80fd\u8d85\u51fa <code>yarn.scheduler.maximum-allocation-mb</code> \u548c <code>yarn.scheduler.minimum-allocation-mb</code> \u89c4\u5b9a\u7684\u8303\u56f4\u3002</p> <p>\u8be5\u53c2\u6570\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u8ba1\u7b97\u4efb\u52a1\u5355\u72ec\u8fdb\u884c\u914d\u7f6e\uff0c\u5728 Hive \u4e2d\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u4e3a\u6bcf\u4e2a SQL \u8bed\u53e5\u5355\u72ec\u8fdb\u884c\u914d\u7f6e\uff1a</p> <pre><code>set  mapreduce.map.memory.mb=2048;\n</code></pre> <p>2\uff09mapreduce.map.cpu.vcores </p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u5355\u4e2a Map Task \u7533\u8bf7\u7684 container \u5bb9\u5668 cpu \u6838\u6570\uff0c\u5176\u9ed8\u8ba4\u503c\u4e3a 1\u3002\u8be5\u503c\u4e00\u822c\u65e0\u9700\u8c03\u6574\u3002</p> <p>3\uff09mapreduce.reduce.memory.mb </p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u5355\u4e2a Reduce Task \u7533\u8bf7\u7684 container \u5bb9\u5668\u5185\u5b58\u5927\u5c0f\uff0c\u5176\u9ed8\u8ba4\u503c\u4e3a 1024\u3002\u8be5\u503c\u540c\u6837\u4e0d\u80fd\u8d85\u51fa yarn.scheduler.maximum-allocation-mb \u548c yarn.scheduler.minimum-allocation-mb \u89c4\u5b9a\u7684\u8303\u56f4\u3002</p> <p>\u8be5\u53c2\u6570\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u8ba1\u7b97\u4efb\u52a1\u5355\u72ec\u8fdb\u884c\u914d\u7f6e\uff0c\u5728 Hive \u4e2d\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u4e3a\u6bcf\u4e2a SQL \u8bed\u53e5\u5355\u72ec\u8fdb\u884c\u914d\u7f6e\uff1a</p> <pre><code>set  mapreduce.reduce.memory.mb=2048;\n</code></pre> <p>4\uff09mapreduce.reduce.cpu.vcores </p> <p>\u8be5\u53c2\u6570\u7684\u542b\u4e49\u662f\uff0c\u5355\u4e2a Reduce Task \u7533\u8bf7\u7684 container \u5bb9\u5668 cpu \u6838\u6570\uff0c\u5176\u9ed8\u8ba4\u503c\u4e3a 1\u3002\u8be5\u503c\u4e00\u822c\u65e0\u9700\u8c03\u6574\u3002</p>"},{"location":"engine/hive/hive_12/#122","title":"12.2 \u6d4b\u8bd5\u7528\u8868","text":""},{"location":"engine/hive/hive_12/#1221-2000w","title":"12.2.1 \u8ba2\u5355\u8868(2000w\u6761\u6570\u636e)","text":"<p>1\uff09\u8868\u7ed3\u6784</p> id(\u8ba2\u5355id) user_id(\u7528\u6237id) product_id(\u5546\u54c1id) province_id(\u7701\u4efdid) create_time(\u4e0b\u5355\u65f6\u95f4) product_num(\u5546\u54c1id) total_amount(\u8ba2\u5355\u91d1\u989d) 10000001 125442354 15003199 1 2020-06-14 03:54:29 3 100.58 10000002 192758405 17210367 1 2020-06-14 01:19:47 8 677.18 <p>2\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>drop table if exists order_detail;\ncreate table order_detail(\nid           string comment '\u8ba2\u5355id',\nuser_id      string comment '\u7528\u6237id',\nproduct_id   string comment '\u5546\u54c1id',\nprovince_id  string comment '\u7701\u4efdid',\ncreate_time  string comment '\u4e0b\u5355\u65f6\u95f4',\nproduct_num  int comment '\u5546\u54c1\u4ef6\u6570',\ntotal_amount decimal(16, 2) comment '\u4e0b\u5355\u91d1\u989d'\n)\npartitioned by (dt string)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>3\uff09\u6570\u636e\u88c5\u8f7d</p> <p>\u5c06 order_detail.txt \u6587\u4ef6\u4e0a\u4f20\u5230 hadoop102 \u8282\u70b9\u7684 /opt/module/hive/datas/ \u76ee\u5f55\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u5bfc\u5165\u8bed\u53e5\u3002</p> <pre><code>load data local inpath '/opt/module/hive/datas/order_detail.txt' overwrite into table order_detail partition(dt='2020-06-14');\n</code></pre>"},{"location":"engine/hive/hive_12/#1222-600w","title":"12.2.2 \u652f\u4ed8\u8868(600w\u6761\u6570\u636e)","text":"<p>1\uff09\u8868\u7ed3\u6784</p> id(\u652f\u4ed8id) order_detail_id(\u8ba2\u5355id) user_id(\u7528\u6237id) payment_time(\u652f\u4ed8\u65f6\u95f4) total_amount(\u8ba2\u5355\u91d1\u989d) 10000001 17403042 131508758 2020-06-14 13:55:44 391.72 10000002 19198884 133018075 2020-06-14 08:46:23 657.10 <p>2\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>drop table if exists payment_detail;\ncreate table payment_detail(\nid              string comment '\u652f\u4ed8id',\norder_detail_id string comment '\u8ba2\u5355\u660e\u7ec6id',\nuser_id         string comment '\u7528\u6237id',\npayment_time    string comment '\u652f\u4ed8\u65f6\u95f4',\ntotal_amount    decimal(16, 2) comment '\u652f\u4ed8\u91d1\u989d'\n)\npartitioned by (dt string)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>3\uff09\u6570\u636e\u88c5\u8f7d</p> <p>\u5c06 payment_detail.txt \u6587\u4ef6\u4e0a\u4f20\u5230 hadoop102 \u8282\u70b9\u7684 /opt/module/hive/datas/ \u76ee\u5f55\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u5bfc\u5165\u8bed\u53e5\u3002</p> <pre><code>load data local inpath '/opt/module/hive/datas/payment_detail.txt' overwrite into table payment_detail partition(dt='2020-06-14');\n</code></pre>"},{"location":"engine/hive/hive_12/#1223-100w","title":"12.2.3 \u5546\u54c1\u4fe1\u606f\u8868(100w\u6761\u6570\u636e)","text":"<p>1\uff09\u8868\u7ed3\u6784</p> id(\u5546\u54c1id) product_name(\u5546\u54c1\u540d\u79f0) price(\u4ef7\u683c) category_id(\u5206\u7c7bid) 1000001 CuisW 4517.00 219 1000002 TBtbp 9357.00 208 <p>2\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>drop table if exists product_info;\ncreate table product_info(\nid           string comment '\u5546\u54c1id',\nproduct_name string comment '\u5546\u54c1\u540d\u79f0',\nprice        decimal(16, 2) comment '\u4ef7\u683c',\ncategory_id  string comment '\u5206\u7c7bid'\n)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>3\uff09\u6570\u636e\u88c5\u8f7d</p> <p>\u5c06 product_info.txt \u6587\u4ef6\u4e0a\u4f20\u5230 hadoop102 \u8282\u70b9\u7684 /opt/module/hive/datas/ \u76ee\u5f55\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u5bfc\u5165\u8bed\u53e5\u3002</p> <pre><code>load data local inpath '/opt/module/hive/datas/product_info.txt' overwrite into table product_info;\n</code></pre>"},{"location":"engine/hive/hive_12/#1224-34","title":"12.2.4 \u7701\u4efd\u4fe1\u606f\u8868(34\u6761\u6570\u636e)","text":"<p>1\uff09\u8868\u7ed3\u6784</p> id(\u7701\u4efdid) province_name(\u7701\u4efd\u540d\u79f0) 1 \u5317\u4eac 2 \u5929\u6d25 <p>2\uff09\u5efa\u8868\u8bed\u53e5</p> <pre><code>drop table if exists province_info;\ncreate table province_info(\nid            string comment '\u7701\u4efdid',\nprovince_name string comment '\u7701\u4efd\u540d\u79f0'\n)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>3\uff09\u6570\u636e\u88c5\u8f7d</p> <p>\u5c06 province_info.txt \u6587\u4ef6\u4e0a\u4f20\u5230 hadoop102 \u8282\u70b9\u7684 /opt/module/hive/datas/ \u76ee\u5f55\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u5bfc\u5165\u8bed\u53e5\u3002</p> <pre><code>load data local inpath '/opt/module/hive/datas/province_info.txt' overwrite into table province_info;\n</code></pre>"},{"location":"engine/hive/hive_12/#123-explain","title":"12.3 Explain\u67e5\u770b\u6267\u884c\u8ba1\u5212\uff08\u91cd\u70b9\uff09","text":"<p>\u5218\u6ce2\u8001\u5e08\u7684Hive\u6267\u884c\u8ba1\u5212\u89e3\u6790\u7f51\u7ad9</p>"},{"location":"engine/hive/hive_12/#1231-explain","title":"12.3.1 Explain\u6267\u884c\u8ba1\u5212\u6982\u8ff0","text":"<p>Explain \u5448\u73b0\u7684\u6267\u884c\u8ba1\u5212\uff0c\u7531\u4e00\u7cfb\u5217 Stage \u7ec4\u6210\uff0c\u8fd9\u4e00\u7cfb\u5217 Stage \u5177\u6709\u4f9d\u8d56\u5173\u7cfb\uff0c\u6bcf\u4e2a Stage \u5bf9\u5e94\u4e00\u4e2a MapReduce Job\uff0c\u6216\u8005\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\u7b49\u3002</p> <p>\u82e5\u67d0\u4e2a Stage \u5bf9\u5e94\u7684\u4e00\u4e2a MapReduce Job\uff0c\u5176 Map \u7aef\u548c Reduce \u7aef\u7684\u8ba1\u7b97\u903b\u8f91\u5206\u522b\u7531 Map Operator Tree \u548c Reduce Operator Tree \u8fdb\u884c\u63cf\u8ff0\uff0cOperator Tree \u7531\u4e00\u7cfb\u5217\u7684 Operator \u7ec4\u6210\uff0c\u4e00\u4e2a Operator \u4ee3\u8868\u5728 Map \u6216 Reduce \u9636\u6bb5\u7684\u4e00\u4e2a\u5355\u4e00\u7684\u903b\u8f91\u64cd\u4f5c\uff0c\u4f8b\u5982 TableScan Operator\uff0cSelect Operator\uff0cJoin Operator \u7b49\u3002</p> <p>\u4e0b\u56fe\u662f\u7531\u4e00\u4e2a\u6267\u884c\u8ba1\u5212\u7ed8\u5236\u800c\u6210\uff1a</p> <p></p> <p>\u5e38\u89c1\u7684 Operator\u53ca\u5176\u4f5c\u7528\u5982\u4e0b\uff1a</p> <ul> <li>TableScan\uff1a\u8868\u626b\u63cf\u64cd\u4f5c\uff0c\u901a\u5e38 map \u7aef\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u80af\u5b9a\u662f\u8868\u626b\u63cf\u64cd\u4f5c</li> <li>Select Operator\uff1a\u9009\u53d6\u64cd\u4f5c</li> <li>Group By Operator\uff1a\u5206\u7ec4\u805a\u5408\u64cd\u4f5c</li> <li>Reduce Output Operator\uff1a\u8f93\u51fa\u5230 reduce \u64cd\u4f5c</li> <li>Filter Operator\uff1a\u8fc7\u6ee4\u64cd\u4f5c</li> <li>Join Operator\uff1ajoin \u64cd\u4f5c</li> <li>File Output Operator\uff1a\u6587\u4ef6\u8f93\u51fa\u64cd\u4f5c</li> <li>Fetch Operator \u5ba2\u6237\u7aef\u83b7\u53d6\u6570\u636e\u64cd\u4f5c</li> </ul>"},{"location":"engine/hive/hive_12/#1232","title":"12.3.2 \u57fa\u672c\u8bed\u6cd5","text":"<pre><code>EXPLAIN [FORMATTED | EXTENDED | DEPENDENCY] query-sql\n</code></pre> <p>\u6ce8</p> <p>FORMATTED\u3001EXTENDED\u3001DEPENDENCY \u5173\u952e\u5b57\u4e3a\u53ef\u9009\u9879\uff0c\u5404\u81ea\u4f5c\u7528\u5982\u4e0b\u3002</p> <ul> <li>FORMATTED\uff1a\u5c06\u6267\u884c\u8ba1\u5212\u4ee5 JSON \u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u8f93\u51fa</li> <li>EXTENDED\uff1a\u8f93\u51fa\u6267\u884c\u8ba1\u5212\u4e2d\u7684\u989d\u5916\u4fe1\u606f\uff0c\u901a\u5e38\u662f\u8bfb\u5199\u7684\u6587\u4ef6\u540d\u7b49\u4fe1\u606f</li> <li>DEPENDENCY\uff1a\u8f93\u51fa\u6267\u884c\u8ba1\u5212\u8bfb\u53d6\u7684\u8868\u53ca\u5206\u533a</li> </ul>"},{"location":"engine/hive/hive_12/#1233","title":"12.3.3 \u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u67e5\u770b\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212</p> <pre><code>explain\nselect\nuser_id,\ncount(*)\nfrom order_detail\ngroup by user_id; </code></pre> <p>2\uff09\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe</p> <p></p>"},{"location":"engine/hive/hive_12/#124-hql","title":"12.4 HQL\u8bed\u6cd5\u4f18\u5316\u4e4b\u5206\u7ec4\u805a\u5408\u4f18\u5316","text":""},{"location":"engine/hive/hive_12/#1241","title":"12.4.1 \u4f18\u5316\u8bf4\u660e","text":"<p>Hive \u4e2d\u672a\u7ecf\u4f18\u5316\u7684\u5206\u7ec4\u805a\u5408\uff0c\u662f\u901a\u8fc7\u4e00\u4e2a MapReduce Job \u5b9e\u73b0\u7684\u3002Map \u7aef\u8d1f\u8d23\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u6309\u7167\u5206\u7ec4\u5b57\u6bb5\u5206\u533a\uff0c\u901a\u8fc7 Shuffle\uff0c\u5c06\u6570\u636e\u53d1\u5f80 Reduce \u7aef\uff0c\u5404\u7ec4\u6570\u636e\u5728 Reduce \u7aef\u5b8c\u6210\u6700\u7ec8\u7684\u805a\u5408\u8fd0\u7b97\u3002</p> <p>Hive \u5bf9\u5206\u7ec4\u805a\u5408\u7684\u4f18\u5316\u4e3b\u8981\u56f4\u7ed5\u7740\u51cf\u5c11 Shuffle \u6570\u636e\u91cf\u8fdb\u884c\uff0c\u5177\u4f53\u505a\u6cd5\u662f map-side \u805a\u5408\u3002\u6240\u8c13 map-side \u805a\u5408\uff0c\u5c31\u662f\u5728 map \u7aef\u7ef4\u62a4\u4e00\u4e2a hash table\uff0c\u5229\u7528\u5176\u5b8c\u6210\u90e8\u5206\u7684\u805a\u5408\uff0c\u7136\u540e\u5c06\u90e8\u5206\u805a\u5408\u7684\u7ed3\u679c\uff0c\u6309\u7167\u5206\u7ec4\u5b57\u6bb5\u5206\u533a\uff0c\u53d1\u9001\u81f3 reduce \u7aef\uff0c\u5b8c\u6210\u6700\u7ec8\u7684\u805a\u5408\u3002map-side \u805a\u5408\u80fd\u6709\u6548\u51cf\u5c11 shuffle \u7684\u6570\u636e\u91cf\uff0c\u63d0\u9ad8\u5206\u7ec4\u805a\u5408\u8fd0\u7b97\u7684\u6548\u7387\u3002</p> <p>map-side \u805a\u5408\u76f8\u5173\u7684\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u542f\u7528map-side\u805a\u5408\nset hive.map.aggr=true;\n\n--\u7528\u4e8e\u68c0\u6d4b\u6e90\u8868\u6570\u636e\u662f\u5426\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\u3002\u68c0\u6d4b\u7684\u65b9\u6cd5\u662f\uff1a\u5148\u5bf9\u82e5\u5e72\u6761\u6570\u636e\u8fdb\u884cmap-side\u805a\u5408\uff0c\u82e5\u805a\u5408\u540e\u7684\u6761\u6570\u548c\u805a\u5408\u524d\u7684\u6761\u6570\u6bd4\u503c\u5c0f\u4e8e\u8be5\u503c\uff0c\u5219\u8ba4\u4e3a\u8be5\u8868\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\uff1b\u5426\u5219\uff0c\u8ba4\u4e3a\u8be5\u8868\u6570\u636e\u4e0d\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\uff0c\u540e\u7eed\u6570\u636e\u4fbf\u4e0d\u518d\u8fdb\u884cmap-side\u805a\u5408\u3002\nset hive.map.aggr.hash.min.reduction=0.5;\n\n--\u7528\u4e8e\u68c0\u6d4b\u6e90\u8868\u662f\u5426\u9002\u5408map-side\u805a\u5408\u7684\u6761\u6570\u3002\nset hive.groupby.mapaggr.checkinterval=100000;\n\n--map-side\u805a\u5408\u6240\u7528\u7684hash table\uff0c\u5360\u7528map task\u5806\u5185\u5b58\u7684\u6700\u5927\u6bd4\u4f8b\uff0c\u82e5\u8d85\u51fa\u8be5\u503c\uff0c\u5219\u4f1a\u5bf9hash table\u8fdb\u884c\u4e00\u6b21flush\u3002\nset hive.map.aggr.hash.force.flush.memory.threshold=0.9;\n</code></pre>"},{"location":"engine/hive/hive_12/#1242","title":"12.4.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8bSQL</p> <pre><code>select\nproduct_id,\ncount(*)\nfrom order_detail\ngroup by product_id;\n</code></pre> <p>2\uff09\u4f18\u5316\u524d</p> <p>\u672a\u7ecf\u4f18\u5316\u7684\u5206\u7ec4\u805a\u5408\uff0c\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>3\uff09\u4f18\u5316\u601d\u8def</p> <p>\u53ef\u4ee5\u8003\u8651\u5f00\u542f map-side \u805a\u5408\uff0c\u914d\u7f6e\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <pre><code>--\u542f\u7528map-side\u805a\u5408\uff0c\u9ed8\u8ba4\u662ftrue\nset hive.map.aggr=true;\n\n--\u7528\u4e8e\u68c0\u6d4b\u6e90\u8868\u6570\u636e\u662f\u5426\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\u3002\u68c0\u6d4b\u7684\u65b9\u6cd5\u662f\uff1a\u5148\u5bf9\u82e5\u5e72\u6761\u6570\u636e\u8fdb\u884cmap-side\u805a\u5408\uff0c\u82e5\u805a\u5408\u540e\u7684\u6761\u6570\u548c\u805a\u5408\u524d\u7684\u6761\u6570\u6bd4\u503c\u5c0f\u4e8e\u8be5\u503c\uff0c\u5219\u8ba4\u4e3a\u8be5\u8868\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\uff1b\u5426\u5219\uff0c\u8ba4\u4e3a\u8be5\u8868\u6570\u636e\u4e0d\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\uff0c\u540e\u7eed\u6570\u636e\u4fbf\u4e0d\u518d\u8fdb\u884cmap-side\u805a\u5408\u3002\nset hive.map.aggr.hash.min.reduction=0.5;\n\n--\u7528\u4e8e\u68c0\u6d4b\u6e90\u8868\u662f\u5426\u9002\u5408map-side\u805a\u5408\u7684\u6761\u6570\u3002\nset hive.groupby.mapaggr.checkinterval=100000;\n\n--map-side\u805a\u5408\u6240\u7528\u7684hash table\uff0c\u5360\u7528map task\u5806\u5185\u5b58\u7684\u6700\u5927\u6bd4\u4f8b\uff0c\u82e5\u8d85\u51fa\u8be5\u503c\uff0c\u5219\u4f1a\u5bf9hash table\u8fdb\u884c\u4e00\u6b21flush\u3002\nset hive.map.aggr.hash.force.flush.memory.threshold=0.9;\n</code></pre> <p>\u4f18\u5316\u540e\u7684\u6267\u884c\u8ba1\u5212\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"engine/hive/hive_12/#125-hqljoin","title":"12.5 HQL\u8bed\u6cd5\u4f18\u5316\u4e4bJoin\u4f18\u5316","text":""},{"location":"engine/hive/hive_12/#1251-join","title":"12.5.1 Join\u7b97\u6cd5\u6982\u8ff0","text":"<p>Hive \u62e5\u6709\u591a\u79cd join \u7b97\u6cd5\uff0c\u5305\u62ec Common Join\uff0cMap Join\uff0cBucket Map Join\uff0cSort Merge Buckt Map Join \u7b49\uff0c\u4e0b\u9762\u5bf9\u6bcf\u79cd join \u7b97\u6cd5\u505a\u7b80\u8981\u8bf4\u660e\uff1a</p> <p>1\uff09Common Join</p> <p>Common Join \u662f Hive \u4e2d\u6700\u7a33\u5b9a\u7684 join \u7b97\u6cd5\uff0c\u5176\u901a\u8fc7\u4e00\u4e2a MapReduce Job \u5b8c\u6210\u4e00\u4e2a join \u64cd\u4f5c\u3002Map \u7aef\u8d1f\u8d23\u8bfb\u53d6 join \u64cd\u4f5c\u6240\u9700\u8868\u7684\u6570\u636e\uff0c\u5e76\u6309\u7167\u5173\u8054\u5b57\u6bb5\u8fdb\u884c\u5206\u533a\uff0c\u901a\u8fc7 Shuffle\uff0c\u5c06\u5176\u53d1\u9001\u5230 Reduce \u7aef\uff0c\u76f8\u540c key \u7684\u6570\u636e\u5728 Reduce \u7aef\u5b8c\u6210\u6700\u7ec8\u7684 Join \u64cd\u4f5c\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6ce8\u610f</p> <p>sql \u8bed\u53e5\u4e2d\u7684 join \u64cd\u4f5c\u548c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 Common Join \u4efb\u52a1\u5e76\u975e\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\uff0c\u4e00\u4e2a sql \u8bed\u53e5\u4e2d\u7684\u76f8\u90bb\u7684\u4e14\u5173\u8054\u5b57\u6bb5\u76f8\u540c\u7684\u591a\u4e2a join \u64cd\u4f5c\u53ef\u4ee5\u5408\u5e76\u4e3a\u4e00\u4e2a Common Join \u4efb\u52a1\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>select a.val, b.val, c.val from a join b on (a.key = b.key1) join c on (c.key = b.key1)\n</code></pre> <p>\u4e0a\u8ff0 sql \u8bed\u53e5\u4e2d\u4e24\u4e2a join \u64cd\u4f5c\u7684\u5173\u8054\u5b57\u6bb5\u5747\u4e3a b \u8868\u7684 key1 \u5b57\u6bb5\uff0c\u5219\u8be5\u8bed\u53e5\u4e2d\u7684\u4e24\u4e2a join \u64cd\u4f5c\u53ef\u7531\u4e00\u4e2a Common Join \u4efb\u52a1\u5b9e\u73b0\uff0c\u4e5f\u5c31\u662f\u53ef\u901a\u8fc7\u4e00\u4e2a Map Reduce \u4efb\u52a1\u5b9e\u73b0\u3002 </p> <pre><code>select a.val, b.val, c.val from a join b on (a.key = b.key1) join c on (c.key = b.key2)\n</code></pre> <p>\u4e0a\u8ff0 sql \u8bed\u53e5\u4e2d\u7684\u4e24\u4e2a join \u64cd\u4f5c\u5173\u8054\u5b57\u6bb5\u5404\u4e0d\u76f8\u540c\uff0c\u5219\u8be5\u8bed\u53e5\u7684\u4e24\u4e2a join \u64cd\u4f5c\u9700\u8981\u5404\u81ea\u901a\u8fc7\u4e00\u4e2a Common Join \u4efb\u52a1\u5b9e\u73b0\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4e24\u4e2a Map Reduce \u4efb\u52a1\u5b9e\u73b0\u3002</p> <p>2\uff09Map Join</p> <p>Map Join \u7b97\u6cd5\u53ef\u4ee5\u901a\u8fc7\u4e24\u4e2a\u53ea\u6709 map \u9636\u6bb5\u7684 Job \u5b8c\u6210\u4e00\u4e2a join \u64cd\u4f5c\u3002\u5176\u9002\u7528\u573a\u666f\u4e3a\u5927\u8868 join \u5c0f\u8868\u3002\u82e5\u67d0 join \u64cd\u4f5c\u6ee1\u8db3\u8981\u6c42\uff0c\u5219\u7b2c\u4e00\u4e2a Job \u4f1a\u8bfb\u53d6\u5c0f\u8868\u6570\u636e\uff0c\u5c06\u5176\u5236\u4f5c\u4e3a hash table\uff0c\u5e76\u4e0a\u4f20\u81f3 Hadoop \u5206\u5e03\u5f0f\u7f13\u5b58\uff08\u672c\u8d28\u4e0a\u662f\u4e0a\u4f20\u81f3\u6bcf\u4e2a\u6267\u884c\u4efb\u52a1\u7684 NodeManager \u8282\u70b9\u672c\u5730\u78c1\u76d8\uff09\u3002\u7b2c\u4e8c\u4e2a Job \u4f1a\u5148\u4ece\u5206\u5e03\u5f0f\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5c0f\u8868\u6570\u636e\uff0c\u5e76\u7f13\u5b58\u5728 Map Task \u7684\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u626b\u63cf\u5927\u8868\u6570\u636e\uff0c\u8fd9\u6837\u5728 map \u7aef\u5373\u53ef\u5b8c\u6210\u5173\u8054\u64cd\u4f5c\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>3\uff09Bucket Map Join</p> <p>Bucket Map Join \u662f\u5bf9 Map Join \u7b97\u6cd5\u7684\u6539\u8fdb\uff0c\u5176\u6253\u7834\u4e86 Map Join \u53ea\u9002\u7528\u4e8e\u5927\u8868 join \u5c0f\u8868\u7684\u9650\u5236\uff0c\u53ef\u7528\u4e8e\u5927\u8868 join \u5927\u8868\u7684\u573a\u666f\u3002</p> <p>Bucket Map Join \u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u82e5\u80fd\u4fdd\u8bc1\u53c2\u4e0e join \u7684\u8868\u5747\u4e3a\u5206\u6876\u8868\uff0c\u4e14\u5173\u8054\u5b57\u6bb5\u4e3a\u5206\u6876\u5b57\u6bb5\uff0c\u4e14\u5176\u4e2d\u4e00\u5f20\u8868\u7684\u5206\u6876\u6570\u91cf\u662f\u53e6\u5916\u4e00\u5f20\u8868\u5206\u6876\u6570\u91cf\u7684\u6574\u6570\u500d\uff0c\u5c31\u80fd\u4fdd\u8bc1\u53c2\u4e0e join \u7684\u4e24\u5f20\u8868\u7684\u5206\u6876\u4e4b\u95f4\u5177\u6709\u660e\u786e\u7684\u5173\u8054\u5173\u7cfb\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u5728\u4e24\u8868\u7684\u5206\u6876\u95f4\u8fdb\u884c Map Join \u64cd\u4f5c\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u7b2c\u4e8c\u4e2a Job \u7684 Map \u7aef\u5c31\u65e0\u9700\u518d\u7f13\u5b58\u5c0f\u8868\u7684\u5168\u8868\u6570\u636e\u4e86\uff0c\u800c\u53ea\u9700\u7f13\u5b58\u5176\u6240\u9700\u7684\u5206\u6876\u5373\u53ef\u3002\u5176\u539f\u7406\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>4\uff09Sort Merge Bucket Map Join</p> <p>Sort Merge Bucket Map Join\uff08\u7b80\u79f0 SMB Map Join\uff09\u57fa\u4e8e Bucket Map Join\u3002SMB Map Join \u8981\u6c42\uff0c\u53c2\u4e0e join \u7684\u8868\u5747\u4e3a\u5206\u6876\u8868\uff0c\u4e14\u9700\u4fdd\u8bc1\u5206\u6876\u5185\u7684\u6570\u636e\u662f\u6709\u5e8f\u7684\uff0c\u4e14\u5206\u6876\u5b57\u6bb5\u3001\u6392\u5e8f\u5b57\u6bb5\u548c\u5173\u8054\u5b57\u6bb5\u4e3a\u76f8\u540c\u5b57\u6bb5\uff0c\u4e14\u5176\u4e2d\u4e00\u5f20\u8868\u7684\u5206\u6876\u6570\u91cf\u662f\u53e6\u5916\u4e00\u5f20\u8868\u5206\u6876\u6570\u91cf\u7684\u6574\u6570\u500d\u3002</p> <p>SMB Map Join \u540c Bucket Join \u4e00\u6837\uff0c\u540c\u6837\u662f\u5229\u7528\u4e24\u8868\u5404\u5206\u6876\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\uff0c\u5728\u5206\u6876\u4e4b\u95f4\u8fdb\u884c join \u64cd\u4f5c\uff0c\u4e0d\u540c\u7684\u662f\uff0c\u5206\u6876\u4e4b\u95f4\u7684 join \u64cd\u4f5c\u7684\u5b9e\u73b0\u539f\u7406\u3002Bucket Map Join\uff0c\u4e24\u4e2a\u5206\u6876\u4e4b\u95f4\u7684 join \u5b9e\u73b0\u539f\u7406\u4e3a Hash Join \u7b97\u6cd5\uff1b\u800c SMB Map Join\uff0c\u4e24\u4e2a\u5206\u6876\u4e4b\u95f4\u7684 join \u5b9e\u73b0\u539f\u7406\u4e3a Sort Merge Join \u7b97\u6cd5\u3002</p> <p>Hash Join \u548c Sort Merge Join \u5747\u4e3a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u5e38\u89c1\u7684 Join \u5b9e\u73b0\u7b97\u6cd5\u3002Hash Join \u7684\u539f\u7406\u76f8\u5bf9\u7b80\u5355\uff0c\u5c31\u662f\u5bf9\u53c2\u4e0e join \u7684\u4e00\u5f20\u8868\u6784\u5efa hash table\uff0c\u7136\u540e\u626b\u63cf\u53e6\u5916\u4e00\u5f20\u8868\uff0c\u7136\u540e\u8fdb\u884c\u9010\u884c\u5339\u914d\u3002Sort Merge Join \u9700\u8981\u5728\u4e24\u5f20\u6309\u7167\u5173\u8054\u5b57\u6bb5\u6392\u597d\u5e8f\u7684\u8868\u4e2d\u8fdb\u884c\uff0c\u5176\u539f\u7406\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>Hive \u4e2d\u7684 SMB Map Join \u5c31\u662f\u5bf9\u4e24\u4e2a\u5206\u6876\u7684\u6570\u636e\u6309\u7167\u4e0a\u8ff0\u601d\u8def\u8fdb\u884c Join \u64cd\u4f5c\u3002\u53ef\u4ee5\u770b\u51fa\uff0cSMB Map Join \u4e0e Bucket Map Join \u76f8\u6bd4\uff0c\u5728\u8fdb\u884c Join \u64cd\u4f5c\u65f6\uff0cMap \u7aef\u662f\u65e0\u9700\u5bf9\u6574\u4e2a Bucket \u6784\u5efa hash table\uff0c\u4e5f\u65e0\u9700\u5728 Map \u7aef\u7f13\u5b58\u6574\u4e2a Bucket \u6570\u636e\u7684\uff0c\u6bcf\u4e2a Mapper \u53ea\u9700\u6309\u987a\u5e8f\u9010\u4e2a key \u8bfb\u53d6\u4e24\u4e2a\u5206\u6876\u7684\u6570\u636e\u8fdb\u884c join \u5373\u53ef\u3002</p>"},{"location":"engine/hive/hive_12/#1252-map-join","title":"12.5.2 Map Join","text":""},{"location":"engine/hive/hive_12/#12521","title":"12.5.2.1 \u4f18\u5316\u8bf4\u660e","text":"<p>Map Join \u6709\u4e24\u79cd\u89e6\u53d1\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u7528\u6237\u5728 SQL \u8bed\u53e5\u4e2d\u589e\u52a0 hint \u63d0\u793a\uff0c\u53e6\u5916\u4e00\u79cd\u662f Hive \u4f18\u5316\u5668\u6839\u636e\u53c2\u4e0e join \u8868\u7684\u6570\u636e\u91cf\u5927\u5c0f\uff0c\u81ea\u52a8\u89e6\u53d1\u3002</p> <p>1\uff09Hint\u63d0\u793a</p> <p>\u7528\u6237\u53ef\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\uff0c\u6307\u5b9a\u901a\u8fc7 map join \u7b97\u6cd5\uff0c\u5e76\u4e14 ta \u5c06\u4f5c\u4e3a map join \u4e2d\u7684\u5c0f\u8868\u3002\u8fd9\u79cd\u65b9\u5f0f\u5df2\u7ecf\u8fc7\u65f6\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002</p> <pre><code>select /*+ mapjoin(ta) */\nta.id,\ntb.id\nfrom table_a ta\njoin table_b tb\non ta.id=tb.id;\n</code></pre> <p>2\uff09\u81ea\u52a8\u89e6\u53d1</p> <p>Hive \u5728\u7f16\u8bd1 SQL \u8bed\u53e5\u9636\u6bb5\uff0c\u8d77\u521d\u6240\u6709\u7684 join \u64cd\u4f5c\u5747\u91c7\u7528 Common Join \u7b97\u6cd5\u5b9e\u73b0\u3002</p> <p>\u4e4b\u540e\u5728\u7269\u7406\u4f18\u5316\u9636\u6bb5\uff0cHive \u4f1a\u6839\u636e\u6bcf\u4e2a Common Join \u4efb\u52a1\u6240\u9700\u8868\u7684\u5927\u5c0f\u5224\u65ad\u8be5 Common Join \u4efb\u52a1\u662f\u5426\u80fd\u591f\u8f6c\u6362\u4e3a Map Join \u4efb\u52a1\uff0c\u82e5\u6ee1\u8db3\u8981\u6c42\uff0c\u4fbf\u5c06 Common Join \u4efb\u52a1\u81ea\u52a8\u8f6c\u6362\u4e3a Map Join \u4efb\u52a1\u3002</p> <p>\u4f46\u6709\u4e9b Common Join \u4efb\u52a1\u6240\u9700\u7684\u8868\u5927\u5c0f\uff0c\u5728 SQL \u7684\u7f16\u8bd1\u9636\u6bb5\u662f\u672a\u77e5\u7684\uff08\u4f8b\u5982\u5bf9\u5b50\u67e5\u8be2\u8fdb\u884c join \u64cd\u4f5c\uff09\uff0c\u6240\u4ee5\u8fd9\u79cd Common Join \u4efb\u52a1\u662f\u5426\u80fd\u8f6c\u6362\u6210 Map Join \u4efb\u52a1\u5728\u7f16\u8bd1\u9636\u662f\u65e0\u6cd5\u786e\u5b9a\u7684\u3002</p> <p>\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0cHive \u4f1a\u5728\u7f16\u8bd1\u9636\u6bb5\u751f\u6210\u4e00\u4e2a\u6761\u4ef6\u4efb\u52a1\uff08Conditional Task\uff09\uff0c\u5176\u4e0b\u4f1a\u5305\u542b\u4e00\u4e2a\u8ba1\u5212\u5217\u8868\uff0c\u8ba1\u5212\u5217\u8868\u4e2d\u5305\u542b\u8f6c\u6362\u540e\u7684 Map Join \u4efb\u52a1\u4ee5\u53ca\u539f\u6709\u7684 Common Join \u4efb\u52a1\u3002\u6700\u7ec8\u5177\u4f53\u91c7\u7528\u54ea\u4e2a\u8ba1\u5212\uff0c\u662f\u5728\u8fd0\u884c\u65f6\u51b3\u5b9a\u7684\u3002\u5927\u81f4\u601d\u8def\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>Map join \u81ea\u52a8\u8f6c\u6362\u7684\u5177\u4f53\u5224\u65ad\u903b\u8f91\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u56fe\u4e2d\u6d89\u53ca\u5230\u7684\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u542f\u52a8Map Join\u81ea\u52a8\u8f6c\u6362\nset hive.auto.convert.join=true;\n\n--\u4e00\u4e2aCommon Join operator\u8f6c\u4e3aMap Join operator\u7684\u5224\u65ad\u6761\u4ef6,\u82e5\u8be5Common Join\u76f8\u5173\u7684\u8868\u4e2d,\u5b58\u5728n-1\u5f20\u8868\u7684\u5927\u5c0f\u603b\u548c&lt;=\u8be5\u503c,\u5219\u751f\u6210\u4e00\u4e2aMap Join\u8ba1\u5212,\u6b64\u65f6\u53ef\u80fd\u5b58\u5728\u591a\u79cdn-1\u5f20\u8868\u7684\u7ec4\u5408\u5747\u6ee1\u8db3\u8be5\u6761\u4ef6,\u5219hive\u4f1a\u4e3a\u6bcf\u79cd\u6ee1\u8db3\u6761\u4ef6\u7684\u7ec4\u5408\u5747\u751f\u6210\u4e00\u4e2aMap Join\u8ba1\u5212,\u540c\u65f6\u8fd8\u4f1a\u4fdd\u7559\u539f\u6709\u7684Common Join\u8ba1\u5212\u4f5c\u4e3a\u540e\u5907(back up)\u8ba1\u5212,\u5b9e\u9645\u8fd0\u884c\u65f6,\u4f18\u5148\u6267\u884cMap Join\u8ba1\u5212\uff0c\u82e5\u4e0d\u80fd\u6267\u884c\u6210\u529f\uff0c\u5219\u542f\u52a8Common Join\u540e\u5907\u8ba1\u5212\u3002\nset hive.mapjoin.smalltable.filesize=250000;\n\n--\u5f00\u542f\u65e0\u6761\u4ef6\u8f6cMap Join\nset hive.auto.convert.join.noconditionaltask=true;\n\n--\u65e0\u6761\u4ef6\u8f6cMap Join\u65f6\u7684\u5c0f\u8868\u4e4b\u548c\u9608\u503c,\u82e5\u4e00\u4e2aCommon Join operator\u76f8\u5173\u7684\u8868\u4e2d\uff0c\u5b58\u5728n-1\u5f20\u8868\u7684\u5927\u5c0f\u603b\u548c&lt;=\u8be5\u503c,\u6b64\u65f6hive\u4fbf\u4e0d\u4f1a\u518d\u4e3a\u6bcf\u79cdn-1\u5f20\u8868\u7684\u7ec4\u5408\u5747\u751f\u6210Map Join\u8ba1\u5212,\u540c\u65f6\u4e5f\u4e0d\u4f1a\u4fdd\u7559Common Join\u4f5c\u4e3a\u540e\u5907\u8ba1\u5212\u3002\u800c\u662f\u53ea\u751f\u6210\u4e00\u4e2a\u6700\u4f18\u7684Map Join\u8ba1\u5212\u3002\nset hive.auto.convert.join.noconditionaltask.size=10000000;\n</code></pre>"},{"location":"engine/hive/hive_12/#12522","title":"12.5.2.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b SQL</p> <pre><code>select\n*\nfrom order_detail od\njoin product_info product on od.product_id = product.id\njoin province_info province on od.province_id = province.id;\n</code></pre> <p>2\uff09\u4f18\u5316\u524d</p> <p>\u4e0a\u8ff0 SQL \u8bed\u53e5\u5171\u6709\u4e09\u5f20\u8868\u8fdb\u884c\u4e24\u6b21 join \u64cd\u4f5c\uff0c\u4e14\u4e24\u6b21 join \u64cd\u4f5c\u7684\u5173\u8054\u5b57\u6bb5\u4e0d\u540c\u3002\u6545\u4f18\u5316\u524d\u7684\u6267\u884c\u8ba1\u5212\u5e94\u8be5\u5305\u542b\u4e24\u4e2a Common Join operator\uff0c\u4e5f\u5c31\u662f\u7531\u4e24\u4e2a MapReduce \u4efb\u52a1\u5b9e\u73b0\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>3\uff09\u4f18\u5316\u601d\u8def</p> <p>\u7ecf\u5206\u6790\uff0c\u53c2\u4e0e join \u7684\u4e09\u5f20\u8868\uff0c\u6570\u636e\u91cf\u5982\u4e0b</p> \u8868\u540d \u5927\u5c0f order_detail 1176009934\uff08\u7ea61122M\uff09 product_info 25285707\uff08\u7ea624M\uff09 province_info 369\uff08\u7ea60.36K\uff09 <p>\u6ce8</p> <p>\u53ef\u4f7f\u7528\u5982\u4e0b\u8bed\u53e5\u83b7\u53d6\u8868/\u5206\u533a\u7684\u5927\u5c0f\u4fe1\u606f</p> <pre><code>desc formatted table_name partition(partition_col='partition');\n</code></pre> <p>\u4e09\u5f20\u8868\u4e2d\uff0cproduct_info \u548c province_info \u6570\u636e\u91cf\u8f83\u5c0f\uff0c\u53ef\u8003\u8651\u5c06\u5176\u4f5c\u4e3a\u5c0f\u8868\uff0c\u8fdb\u884c Map Join \u4f18\u5316\u3002</p> <p>\u6839\u636e\u524d\u6587 Common Join \u4efb\u52a1\u8f6c Map Join \u4efb\u52a1\u7684\u5224\u65ad\u903b\u8f91\u56fe\uff0c\u53ef\u5f97\u51fa\u4ee5\u4e0b\u4f18\u5316\u65b9\u6848\uff1a</p> <p>\u65b9\u6848\u4e00\uff1a</p> <p>\u542f\u7528 Map Join \u81ea\u52a8\u8f6c\u6362\u3002</p> <pre><code>set hive.auto.convert.join=true;\n</code></pre> <p>\u4e0d\u4f7f\u7528\u65e0\u6761\u4ef6\u8f6c Map Join\u3002</p> <pre><code>set hive.auto.convert.join.noconditionaltask=false;\n</code></pre> <p>\u8c03\u6574 hive.mapjoin.smalltable.filesize \u53c2\u6570\uff0c\u4f7f\u5176\u5927\u4e8e\u7b49\u4e8e product_info\u3002</p> <pre><code>set hive.mapjoin.smalltable.filesize=25285707;\n</code></pre> <p>\u8fd9\u6837\u53ef\u4fdd\u8bc1\u5c06\u4e24\u4e2a Common Join operator \u5747\u53ef\u8f6c\u4e3a Map Join operator\uff0c\u5e76\u4fdd\u7559 Common Join \u4f5c\u4e3a\u540e\u5907\u8ba1\u5212\uff0c\u4fdd\u8bc1\u8ba1\u7b97\u4efb\u52a1\u7684\u7a33\u5b9a\u3002\u8c03\u6574\u5b8c\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u65b9\u6848\u4e8c\uff1a</p> <p>\u542f\u7528 Map Join \u81ea\u52a8\u8f6c\u6362\u3002</p> <pre><code>set hive.auto.convert.join=true;\n</code></pre> <p>\u4f7f\u7528\u65e0\u6761\u4ef6\u8f6c Map Join\u3002</p> <pre><code>set hive.auto.convert.join.noconditionaltask=true;\n</code></pre> <p>\u8c03\u6574 hive.auto.convert.join.noconditionaltask.size \u53c2\u6570\uff0c\u4f7f\u5176\u5927\u4e8e\u7b49\u4e8e product_info \u548c province_info \u4e4b\u548c\u3002</p> <pre><code>set hive.auto.convert.join.noconditionaltask.size=25286076;\n</code></pre> <p>\u8fd9\u6837\u53ef\u76f4\u63a5\u5c06\u4e24\u4e2a Common Join operator \u8f6c\u4e3a\u4e24\u4e2a Map Join operator\uff0c\u5e76\u4e14\u7531\u4e8e\u4e24\u4e2a Map Join operator \u7684\u5c0f\u8868\u5927\u5c0f\u4e4b\u548c\u5c0f\u4e8e\u7b49\u4e8e hive.auto.convert.join.noconditionaltask.size\uff0c\u6545\u4e24\u4e2a Map Join operator \u4efb\u52a1\u53ef\u5408\u5e76\u4e3a\u540c\u4e00\u4e2a\u3002\u8fd9\u4e2a\u65b9\u6848\u8ba1\u7b97\u6548\u7387\u6700\u9ad8\uff0c\u4f46\u9700\u8981\u7684\u5185\u5b58\u4e5f\u662f\u6700\u591a\u7684\u3002</p> <p>\u8c03\u6574\u5b8c\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u65b9\u6848\u4e09\uff1a</p> <p>\u542f\u7528 Map Join \u81ea\u52a8\u8f6c\u6362\u3002</p> <pre><code>set hive.auto.convert.join=true;\n</code></pre> <p>\u4f7f\u7528\u65e0\u6761\u4ef6\u8f6c Map Join\u3002</p> <pre><code>set hive.auto.convert.join.noconditionaltask=true;\n</code></pre> <p>\u8c03\u6574 hive.auto.convert.join.noconditionaltask.size \u53c2\u6570\uff0c\u4f7f\u5176\u7b49\u4e8e product_info\u3002</p> <pre><code>set hive.auto.convert.join.noconditionaltask.size=25285707;\n</code></pre> <p>\u8fd9\u6837\u53ef\u76f4\u63a5\u5c06\u4e24\u4e2a Common Join operator \u8f6c\u4e3a Map Join operator\uff0c\u4f46\u4e0d\u4f1a\u5c06\u4e24\u4e2a Map Join \u7684\u4efb\u52a1\u5408\u5e76\u3002\u8be5\u65b9\u6848\u8ba1\u7b97\u6548\u7387\u6bd4\u65b9\u6848\u4e8c\u4f4e\uff0c\u4f46\u9700\u8981\u7684\u5185\u5b58\u4e5f\u66f4\u5c11\u3002</p> <p>\u8c03\u6574\u5b8c\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"engine/hive/hive_12/#1253-bucket-map-join","title":"12.5.3 Bucket Map Join","text":""},{"location":"engine/hive/hive_12/#12531","title":"12.5.3.1 \u4f18\u5316\u8bf4\u660e","text":"<p>Bucket Map Join \u4e0d\u652f\u6301\u81ea\u52a8\u8f6c\u6362\uff0c\u53d1\u987b\u901a\u8fc7\u7528\u6237\u5728 SQL \u8bed\u53e5\u4e2d\u63d0\u4f9b\u5982\u4e0b Hint \u63d0\u793a\uff0c\u5e76\u914d\u7f6e\u5982\u4e0b\u76f8\u5173\u53c2\u6570\uff0c\u65b9\u53ef\u4f7f\u7528\u3002</p> <p>1\uff09Hint \u63d0\u793a</p> <pre><code>select /*+ mapjoin(ta) */\nta.id,\ntb.id\nfrom table_a ta\njoin table_b tb on ta.id=tb.id;\n</code></pre> <p>2\uff09\u76f8\u5173\u53c2\u6570</p> <pre><code>--\u5173\u95edcbo\u4f18\u5316\uff0ccbo\u4f1a\u5bfc\u81f4hint\u4fe1\u606f\u88ab\u5ffd\u7565\nset hive.cbo.enable=false;\n--map join hint\u9ed8\u8ba4\u4f1a\u88ab\u5ffd\u7565(\u56e0\u4e3a\u5df2\u7ecf\u8fc7\u65f6)\uff0c\u9700\u5c06\u5982\u4e0b\u53c2\u6570\u8bbe\u7f6e\u4e3afalse\nset hive.ignore.mapjoin.hint=false;\n--\u542f\u7528bucket map join\u4f18\u5316\u529f\u80fd\nset hive.optimize.bucketmapjoin = true;\n</code></pre>"},{"location":"engine/hive/hive_12/#12532","title":"12.5.3.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8bSQL</p> <pre><code>select\n*\nfrom(\nselect\n*\nfrom order_detail\nwhere dt='2020-06-14'\n)od\njoin(\nselect\n*\nfrom payment_detail\nwhere dt='2020-06-14'\n)pd\non od.id=pd.order_detail_id;\n</code></pre> <p>2\uff09\u4f18\u5316\u524d</p> <p>\u4e0a\u8ff0 SQL \u8bed\u53e5\u5171\u6709\u4e24\u5f20\u8868\u4e00\u6b21 join \u64cd\u4f5c\uff0c\u6545\u4f18\u5316\u524d\u7684\u6267\u884c\u8ba1\u5212\u5e94\u5305\u542b\u4e00\u4e2a Common Join \u4efb\u52a1\uff0c\u901a\u8fc7\u4e00\u4e2a MapReduce Job \u5b9e\u73b0\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>3\uff09\u4f18\u5316\u601d\u8def</p> <p>\u7ecf\u5206\u6790\uff0c\u53c2\u4e0e join \u7684\u4e24\u5f20\u8868\uff0c\u6570\u636e\u91cf\u5982\u4e0b\u3002</p> \u8868\u540d \u5927\u5c0f order_detail 1176009934\uff08\u7ea61122M\uff09 payment_detail 334198480\uff08\u7ea6319M\uff09 <p>\u4e24\u5f20\u8868\u90fd\u76f8\u5bf9\u8f83\u5927\uff0c\u82e5\u91c7\u7528\u666e\u901a\u7684 Map Join \u7b97\u6cd5\uff0c\u5219 Map \u7aef\u9700\u8981\u8f83\u591a\u7684\u5185\u5b58\u6765\u7f13\u5b58\u6570\u636e\uff0c\u5f53\u7136\u53ef\u4ee5\u9009\u62e9\u4e3a Map \u6bb5\u5206\u914d\u66f4\u591a\u7684\u5185\u5b58\uff0c\u6765\u4fdd\u8bc1\u4efb\u52a1\u8fd0\u884c\u6210\u529f\u3002\u4f46\u662f\uff0cMap \u7aef\u7684\u5185\u5b58\u4e0d\u53ef\u80fd\u65e0\u4e0a\u9650\u7684\u5206\u914d\uff0c\u6240\u4ee5\u5f53\u53c2\u4e0e Join \u7684\u8868\u6570\u636e\u91cf\u5747\u8fc7\u5927\u65f6\uff0c\u5c31\u53ef\u4ee5\u8003\u8651\u91c7\u7528 Bucket Map Join \u7b97\u6cd5\u3002\u4e0b\u9762\u6f14\u793a\u5982\u4f55\u4f7f\u7528 Bucket Map Join\u3002</p> <p>\u9996\u5148\u9700\u8981\u4f9d\u636e\u6e90\u8868\u521b\u5efa\u4e24\u4e2a\u5206\u6876\u8868\uff0corder_detail \u5efa\u8bae\u5206 16 \u4e2a bucket\uff0cpayment_detail \u5efa\u8bae\u5206 8 \u4e2a bucket,\u6ce8\u610f\u5206\u6876\u4e2a\u6570\u7684\u500d\u6570\u5173\u7cfb\u4ee5\u53ca\u5206\u6876\u5b57\u6bb5\u3002</p> <pre><code>--\u8ba2\u5355\u8868\nhive (default)&gt; drop table if exists order_detail_bucketed;\ncreate table order_detail_bucketed(\nid           string comment '\u8ba2\u5355id',\nuser_id      string comment '\u7528\u6237id',\nproduct_id   string comment '\u5546\u54c1id',\nprovince_id  string comment '\u7701\u4efdid',\ncreate_time  string comment '\u4e0b\u5355\u65f6\u95f4',\nproduct_num  int comment '\u5546\u54c1\u4ef6\u6570',\ntotal_amount decimal(16, 2) comment '\u4e0b\u5355\u91d1\u989d'\n)\nclustered by (id) into 16 buckets\nrow format delimited fields terminated by '\\t';\n\n--\u652f\u4ed8\u8868\nhive (default)&gt; drop table if exists payment_detail_bucketed;\ncreate table payment_detail_bucketed(\nid              string comment '\u652f\u4ed8id',\norder_detail_id string comment '\u8ba2\u5355\u660e\u7ec6id',\nuser_id         string comment '\u7528\u6237id',\npayment_time    string comment '\u652f\u4ed8\u65f6\u95f4',\ntotal_amount    decimal(16, 2) comment '\u652f\u4ed8\u91d1\u989d'\n)\nclustered by (order_detail_id) into 8 buckets\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>\u7136\u540e\u5411\u4e24\u4e2a\u5206\u6876\u8868\u5bfc\u5165\u6570\u636e\u3002</p> <pre><code>--\u8ba2\u5355\u8868\nhive (default)&gt; insert overwrite table order_detail_bucketed\nselect\nid,\nuser_id,\nproduct_id,\nprovince_id,\ncreate_time,\nproduct_num,\ntotal_amount   from order_detail\nwhere dt='2020-06-14';\n\n--\u5206\u6876\u8868\nhive (default)&gt; insert overwrite table payment_detail_bucketed\nselect\nid,\norder_detail_id,\nuser_id,\npayment_time,\ntotal_amount\nfrom payment_detail\nwhere dt='2020-06-14';\n</code></pre> <p>\u7136\u540e\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <pre><code>--\u5173\u95edcbo\u4f18\u5316\uff0ccbo\u4f1a\u5bfc\u81f4hint\u4fe1\u606f\u88ab\u5ffd\u7565\uff0c\u9700\u5c06\u5982\u4e0b\u53c2\u6570\u4fee\u6539\u4e3afalse\nset hive.cbo.enable=false;\n--map join hint\u9ed8\u8ba4\u4f1a\u88ab\u5ffd\u7565(\u56e0\u4e3a\u5df2\u7ecf\u8fc7\u65f6)\uff0c\u9700\u5c06\u5982\u4e0b\u53c2\u6570\u4fee\u6539\u4e3afalse\nset hive.ignore.mapjoin.hint=false;\n--\u542f\u7528bucket map join\u4f18\u5316\u529f\u80fd,\u9ed8\u8ba4\u4e0d\u542f\u7528\uff0c\u9700\u5c06\u5982\u4e0b\u53c2\u6570\u4fee\u6539\u4e3atrue\nset hive.optimize.bucketmapjoin = true;\n</code></pre> <p>\u6700\u540e\u5728\u91cd\u5199 SQL \u8bed\u53e5\uff0c\u5982\u4e0b\uff1a</p> <pre><code>select /*+ mapjoin(pd) */\n*\nfrom order_detail_bucketed od\njoin payment_detail_bucketed pd on od.id = pd.order_detail_id;\n</code></pre> <p>\u4f18\u5316\u540e\u7684\u6267\u884c\u8ba1\u5212\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cBucket Map Join \u7684\u6267\u884c\u8ba1\u5212\u7684\u57fa\u672c\u4fe1\u606f\u548c\u666e\u901a\u7684 Map Join \u65e0\u5f02\uff0c\u82e5\u60f3\u770b\u5230\u5dee\u5f02\uff0c\u53ef\u6267\u884c\u5982\u4e0b\u8bed\u53e5\uff0c\u67e5\u770b\u6267\u884c\u8ba1\u5212\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u8be6\u7ec6\u6267\u884c\u8ba1\u5212\u4e2d\uff0c\u5982\u5728 Map Join Operator \u4e2d\u770b\u5230 <code>BucketMapJoin: true</code>\uff0c\u5219\u8868\u660e\u4f7f\u7528\u7684 Join \u7b97\u6cd5\u4e3a Bucket Map Join\u3002</p> <pre><code>explain extended select /*+ mapjoin(pd) */\n*\nfrom order_detail_bucketed od\njoin payment_detail_bucketed pd on od.id = pd.order_detail_id;\n</code></pre>"},{"location":"engine/hive/hive_12/#1254-sort-merge-bucket-map-join","title":"12.5.4 Sort Merge Bucket Map Join","text":""},{"location":"engine/hive/hive_12/#12541","title":"12.5.4.1 \u4f18\u5316\u8bf4\u660e","text":"<p>Sort Merge Bucket Map Join \u6709\u4e24\u79cd\u89e6\u53d1\u65b9\u5f0f\uff0c\u5305\u62ec Hint \u63d0\u793a\u548c\u81ea\u52a8\u8f6c\u6362\u3002Hint \u63d0\u793a\u5df2\u8fc7\u65f6\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002\u4e0b\u9762\u662f\u81ea\u52a8\u8f6c\u6362\u7684\u76f8\u5173\u53c2\u6570\uff1a</p> <pre><code>--\u542f\u52a8Sort Merge Bucket Map Join\u4f18\u5316\nset hive.optimize.bucketmapjoin.sortedmerge=true;\n--\u4f7f\u7528\u81ea\u52a8\u8f6c\u6362SMB Join\nset hive.auto.convert.sortmerge.join=true;\n</code></pre>"},{"location":"engine/hive/hive_12/#12542","title":"12.5.4.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b SQL \u8bed\u53e5</p> <pre><code>select\n*\nfrom(\nselect\n*\nfrom order_detail\nwhere dt='2020-06-14'\n)od\njoin(\nselect\n*\nfrom payment_detail\nwhere dt='2020-06-14'\n)pd\non od.id=pd.order_detail_id;\n</code></pre> <p>2\uff09\u4f18\u5316\u524d</p> <p>\u4e0a\u8ff0 SQL \u8bed\u53e5\u5171\u6709\u4e24\u5f20\u8868\u4e00\u6b21 join \u64cd\u4f5c\uff0c\u6545\u4f18\u5316\u524d\u7684\u6267\u884c\u8ba1\u5212\u5e94\u5305\u542b\u4e00\u4e2a Common Join \u4efb\u52a1\uff0c\u901a\u8fc7\u4e00\u4e2a MapReduce Job \u5b9e\u73b0\u3002</p> <p>3\uff09\u4f18\u5316\u601d\u8def</p> <p>\u7ecf\u5206\u6790\uff0c\u53c2\u4e0e join \u7684\u4e24\u5f20\u8868\uff0c\u6570\u636e\u91cf\u5982\u4e0b</p> \u8868\u540d \u5927\u5c0f order_detail 1176009934\uff08\u7ea61122M\uff09 payment_detail 334198480\uff08\u7ea6319M\uff09 <p>\u4e24\u5f20\u8868\u90fd\u76f8\u5bf9\u8f83\u5927\uff0c\u9664\u4e86\u53ef\u4ee5\u8003\u8651\u91c7\u7528 Bucket Map Join \u7b97\u6cd5\uff0c\u8fd8\u53ef\u4ee5\u8003\u8651 SMB Join\u3002\u76f8\u8f83\u4e8e Bucket Map Join\uff0cSMB Map Join \u5bf9\u5206\u6876\u5927\u5c0f\u662f\u6ca1\u6709\u8981\u6c42\u7684\u3002\u4e0b\u9762\u6f14\u793a\u5982\u4f55\u4f7f\u7528 SMB Map Join\u3002</p> <p>\u9996\u5148\u9700\u8981\u4f9d\u636e\u6e90\u8868\u521b\u5efa\u4e24\u4e2a\u7684\u6709\u5e8f\u7684\u5206\u6876\u8868\uff0corder_detail \u5efa\u8bae\u5206 16 \u4e2a bucket\uff0cpayment_detail \u5efa\u8bae\u5206 8 \u4e2a bucket,\u6ce8\u610f\u5206\u6876\u4e2a\u6570\u7684\u500d\u6570\u5173\u7cfb\u4ee5\u53ca\u5206\u6876\u5b57\u6bb5\u548c\u6392\u5e8f\u5b57\u6bb5\u3002</p> <pre><code>--\u8ba2\u5355\u8868\nhive (default)&gt; drop table if exists order_detail_sorted_bucketed;\ncreate table order_detail_sorted_bucketed(\nid           string comment '\u8ba2\u5355id',\nuser_id      string comment '\u7528\u6237id',\nproduct_id   string comment '\u5546\u54c1id',\nprovince_id  string comment '\u7701\u4efdid',\ncreate_time  string comment '\u4e0b\u5355\u65f6\u95f4',\nproduct_num  int comment '\u5546\u54c1\u4ef6\u6570',\ntotal_amount decimal(16, 2) comment '\u4e0b\u5355\u91d1\u989d'\n)\nclustered by (id) sorted by(id) into 16 buckets\nrow format delimited fields terminated by '\\t';\n\n--\u652f\u4ed8\u8868\nhive (default)&gt; drop table if exists payment_detail_sorted_bucketed;\ncreate table payment_detail_sorted_bucketed(\nid              string comment '\u652f\u4ed8id',\norder_detail_id string comment '\u8ba2\u5355\u660e\u7ec6id',\nuser_id         string comment '\u7528\u6237id',\npayment_time    string comment '\u652f\u4ed8\u65f6\u95f4',\ntotal_amount    decimal(16, 2) comment '\u652f\u4ed8\u91d1\u989d'\n)\nclustered by (order_detail_id) sorted by(order_detail_id) into 8 buckets\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>\u7136\u540e\u5411\u4e24\u4e2a\u5206\u6876\u8868\u5bfc\u5165\u6570\u636e\u3002</p> <pre><code>--\u8ba2\u5355\u8868\nhive (default)&gt; insert overwrite table order_detail_sorted_bucketed\nselect\nid,\nuser_id,\nproduct_id,\nprovince_id,\ncreate_time,\nproduct_num,\ntotal_amount   from order_detail\nwhere dt='2020-06-14';\n\n--\u5206\u6876\u8868\nhive (default)&gt; insert overwrite table payment_detail_sorted_bucketed\nselect\nid,\norder_detail_id,\nuser_id,\npayment_time,\ntotal_amount\nfrom payment_detail\nwhere dt='2020-06-14';\n</code></pre> <p>\u7136\u540e\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <pre><code>--\u542f\u52a8Sort Merge Bucket Map Join\u4f18\u5316\nset hive.optimize.bucketmapjoin.sortedmerge=true;\n--\u4f7f\u7528\u81ea\u52a8\u8f6c\u6362SMB Join\nset hive.auto.convert.sortmerge.join=true;\n</code></pre> <p>\u6700\u540e\u5728\u91cd\u5199 SQL \u8bed\u53e5\uff0c\u5982\u4e0b\uff1a</p> <pre><code>select\n*\nfrom order_detail_sorted_bucketed od\njoin payment_detail_sorted_bucketed pd\non od.id = pd.order_detail_id;\n</code></pre> <p>\u4f18\u5316\u540e\u7684\u6267\u884c\u8ba1\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"engine/hive/hive_12/#126-hql","title":"12.6 HQL\u8bed\u6cd5\u4f18\u5316\u4e4b\u6570\u636e\u503e\u659c","text":""},{"location":"engine/hive/hive_12/#1261","title":"12.6.1 \u6570\u636e\u503e\u659c\u6982\u8ff0","text":"<p>\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u901a\u5e38\u662f\u6307\u53c2\u4e0e\u8ba1\u7b97\u7684\u6570\u636e\u5206\u5e03\u4e0d\u5747\uff0c\u5373\u67d0\u4e2a key \u6216\u8005\u67d0\u4e9b key \u7684\u6570\u636e\u91cf\u8fdc\u8d85\u5176\u4ed6 key\uff0c\u5bfc\u81f4\u5728 shuffle \u9636\u6bb5\uff0c\u5927\u91cf\u76f8\u540c key \u7684\u6570\u636e\u88ab\u53d1\u5f80\u540c\u4e00\u4e2a Reduce\uff0c\u8fdb\u800c\u5bfc\u81f4\u8be5 Reduce \u6240\u9700\u7684\u65f6\u95f4\u8fdc\u8d85\u5176\u4ed6 Reduce\uff0c\u6210\u4e3a\u6574\u4e2a\u4efb\u52a1\u7684\u74f6\u9888\u3002</p> <p>Hive \u4e2d\u7684\u6570\u636e\u503e\u659c\u5e38\u51fa\u73b0\u5728\u5206\u7ec4\u805a\u5408\u548c join \u64cd\u4f5c\u7684\u573a\u666f\u4e2d\uff0c\u4e0b\u9762\u5206\u522b\u4ecb\u7ecd\u5728\u4e0a\u8ff0\u4e24\u79cd\u573a\u666f\u4e0b\u7684\u4f18\u5316\u601d\u8def\u3002</p>"},{"location":"engine/hive/hive_12/#1262","title":"12.6.2 \u5206\u7ec4\u805a\u5408\u5bfc\u81f4\u7684\u6570\u636e\u503e\u659c","text":""},{"location":"engine/hive/hive_12/#12621","title":"12.6.2.1 \u4f18\u5316\u8bf4\u660e","text":"<p>\u524d\u6587\u63d0\u5230\u8fc7\uff0cHive \u4e2d\u672a\u7ecf\u4f18\u5316\u7684\u5206\u7ec4\u805a\u5408\uff0c\u662f\u901a\u8fc7\u4e00\u4e2a MapReduce Job \u5b9e\u73b0\u7684\u3002Map \u7aef\u8d1f\u8d23\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u6309\u7167\u5206\u7ec4\u5b57\u6bb5\u5206\u533a\uff0c\u901a\u8fc7 Shuffle\uff0c\u5c06\u6570\u636e\u53d1\u5f80 Reduce \u7aef\uff0c\u5404\u7ec4\u6570\u636e\u5728 Reduce \u7aef\u5b8c\u6210\u6700\u7ec8\u7684\u805a\u5408\u8fd0\u7b97\u3002</p> <p>\u5982\u679c group by \u5206\u7ec4\u5b57\u6bb5\u7684\u503c\u5206\u5e03\u4e0d\u5747\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u5927\u91cf\u76f8\u540c\u7684 key \u8fdb\u5165\u540c\u4e00 Reduce\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u503e\u659c\u95ee\u9898\u3002</p> <p>\u7531\u5206\u7ec4\u805a\u5408\u5bfc\u81f4\u7684\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u6709\u4ee5\u4e0b\u4e24\u79cd\u89e3\u51b3\u601d\u8def\uff1a</p> <p>1\uff09Map-Side \u805a\u5408</p> <p>\u5f00\u542f Map-Side \u805a\u5408\u540e\uff0c\u6570\u636e\u4f1a\u73b0\u5728 Map \u7aef\u5b8c\u6210\u90e8\u5206\u805a\u5408\u5de5\u4f5c\u3002\u8fd9\u6837\u4e00\u6765\u5373\u4fbf\u539f\u59cb\u6570\u636e\u662f\u503e\u659c\u7684\uff0c\u7ecf\u8fc7 Map \u7aef\u7684\u521d\u6b65\u805a\u5408\u540e\uff0c\u53d1\u5f80 Reduce \u7684\u6570\u636e\u4e5f\u5c31\u4e0d\u518d\u503e\u659c\u4e86\u3002\u6700\u4f73\u72b6\u6001\u4e0b\uff0cMap \u7aef\u805a\u5408\u80fd\u5b8c\u5168\u5c4f\u853d\u6570\u636e\u503e\u659c\u95ee\u9898\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u542f\u7528map-side\u805a\u5408\nset hive.map.aggr=true;\n\n--\u7528\u4e8e\u68c0\u6d4b\u6e90\u8868\u6570\u636e\u662f\u5426\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\u3002\u68c0\u6d4b\u7684\u65b9\u6cd5\u662f\uff1a\u5148\u5bf9\u82e5\u5e72\u6761\u6570\u636e\u8fdb\u884cmap-side\u805a\u5408\uff0c\u82e5\u805a\u5408\u540e\u7684\u6761\u6570\u548c\u805a\u5408\u524d\u7684\u6761\u6570\u6bd4\u503c\u5c0f\u4e8e\u8be5\u503c\uff0c\u5219\u8ba4\u4e3a\u8be5\u8868\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\uff1b\u5426\u5219\uff0c\u8ba4\u4e3a\u8be5\u8868\u6570\u636e\u4e0d\u9002\u5408\u8fdb\u884cmap-side\u805a\u5408\uff0c\u540e\u7eed\u6570\u636e\u4fbf\u4e0d\u518d\u8fdb\u884cmap-side\u805a\u5408\u3002\nset hive.map.aggr.hash.min.reduction=0.5;\n\n--\u7528\u4e8e\u68c0\u6d4b\u6e90\u8868\u662f\u5426\u9002\u5408map-side\u805a\u5408\u7684\u6761\u6570\u3002\nset hive.groupby.mapaggr.checkinterval=100000;\n\n--map-side\u805a\u5408\u6240\u7528\u7684hash table\uff0c\u5360\u7528map task\u5806\u5185\u5b58\u7684\u6700\u5927\u6bd4\u4f8b\uff0c\u82e5\u8d85\u51fa\u8be5\u503c\uff0c\u5219\u4f1a\u5bf9hash table\u8fdb\u884c\u4e00\u6b21flush\u3002\nset hive.map.aggr.hash.force.flush.memory.threshold=0.9;\n</code></pre> <p>2\uff09Skew-GroupBy \u4f18\u5316</p> <p>Skew-GroupBy \u7684\u539f\u7406\u662f\u542f\u52a8\u4e24\u4e2a MR \u4efb\u52a1\uff0c\u7b2c\u4e00\u4e2a MR \u6309\u7167\u968f\u673a\u6570\u5206\u533a\uff0c\u5c06\u6570\u636e\u5206\u6563\u53d1\u9001\u5230 Reduce\uff0c\u5b8c\u6210\u90e8\u5206\u805a\u5408\uff0c\u7b2c\u4e8c\u4e2a MR \u6309\u7167\u5206\u7ec4\u5b57\u6bb5\u5206\u533a\uff0c\u5b8c\u6210\u6700\u7ec8\u805a\u5408\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u542f\u7528\u5206\u7ec4\u805a\u5408\u6570\u636e\u503e\u659c\u4f18\u5316\nset hive.groupby.skewindata=true;\n</code></pre>"},{"location":"engine/hive/hive_12/#12622","title":"12.6.2.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b SQL \u8bed\u53e5</p> <pre><code>select\nprovince_id,\ncount(*)\nfrom order_detail\ngroup by province_id;\n</code></pre> <p>2\uff09\u4f18\u5316\u524d</p> <p>\u8be5\u8868\u6570\u636e\u4e2d\u7684 province_id \u5b57\u6bb5\u662f\u5b58\u5728\u503e\u659c\u7684\uff0c\u82e5\u4e0d\u7ecf\u8fc7\u4f18\u5316\uff0c\u901a\u8fc7\u89c2\u5bdf\u4efb\u52a1\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u662f\u80fd\u591f\u770b\u51fa\u6570\u636e\u503e\u659c\u73b0\u8c61\u7684\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>Hive \u4e2d\u7684 map-side \u805a\u5408\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u82e5\u60f3\u770b\u5230\u6570\u636e\u503e\u659c\u7684\u73b0\u8c61\uff0c\u9700\u8981\u5148\u5c06 hive.map.aggr \u53c2\u6570\u8bbe\u7f6e\u4e3a false\u3002</p> <p>3\uff09\u4f18\u5316\u601d\u8def</p> <p>\u901a\u8fc7\u4e0a\u8ff0\u4e24\u79cd\u601d\u8def\u5747\u53ef\u89e3\u51b3\u6570\u636e\u503e\u659c\u7684\u95ee\u9898\u3002\u4e0b\u9762\u5206\u522b\u8fdb\u884c\u8bf4\u660e\uff1a</p> <p>\uff081\uff09Map-Side \u805a\u5408</p> <p>\u8bbe\u7f6e\u5982\u4e0b\u53c2\u6570</p> <pre><code>--\u542f\u7528map-side\u805a\u5408\nset hive.map.aggr=true;\n--\u5173\u95edskew-groupby\nset hive.groupby.skewindata=false;\n</code></pre> <p>\u5f00\u542f map-side \u805a\u5408\u540e\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u200b   \u5f88\u660e\u663e\u53ef\u4ee5\u770b\u5230\u5f00\u542f map-side \u805a\u5408\u540e\uff0creduce \u6570\u636e\u4e0d\u518d\u503e\u659c\u3002</p> <p></p> <p>\uff082\uff09Skew-GroupBy \u4f18\u5316</p> <p>\u8bbe\u7f6e\u5982\u4e0b\u53c2\u6570</p> <pre><code>--\u542f\u7528skew-groupby\nset hive.groupby.skewindata=true;\n--\u5173\u95edmap-side\u805a\u5408\nset hive.map.aggr=false;\n</code></pre> <p>\u5f00\u542f Skew-GroupBy \u4f18\u5316\u540e\uff0c\u53ef\u4ee5\u5f88\u660e\u663e\u770b\u5230\u8be5 sql \u6267\u884c\u5728 yarn \u4e0a\u542f\u52a8\u4e86\u4e24\u4e2a mr \u4efb\u52a1\uff0c\u7b2c\u4e00\u4e2a mr \u6253\u6563\u6570\u636e\uff0c\u7b2c\u4e8c\u4e2a mr \u6309\u7167\u6253\u6563\u540e\u7684\u6570\u636e\u8fdb\u884c\u5206\u7ec4\u805a\u5408\u3002</p> <p></p>"},{"location":"engine/hive/hive_12/#1263-join","title":"12.6.3 Join\u5bfc\u81f4\u7684\u6570\u636e\u503e\u659c","text":""},{"location":"engine/hive/hive_12/#12631","title":"12.6.3.1 \u4f18\u5316\u8bf4\u660e","text":"<p>\u524d\u6587\u63d0\u5230\u8fc7\uff0c\u672a\u7ecf\u4f18\u5316\u7684 join \u64cd\u4f5c\uff0c\u9ed8\u8ba4\u662f\u4f7f\u7528 common join \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4e00\u4e2a MapReduce Job \u5b8c\u6210\u8ba1\u7b97\u3002Map \u7aef\u8d1f\u8d23\u8bfb\u53d6 join \u64cd\u4f5c\u6240\u9700\u8868\u7684\u6570\u636e\uff0c\u5e76\u6309\u7167\u5173\u8054\u5b57\u6bb5\u8fdb\u884c\u5206\u533a\uff0c\u901a\u8fc7 Shuffle\uff0c\u5c06\u5176\u53d1\u9001\u5230 Reduce \u7aef\uff0c\u76f8\u540c key \u7684\u6570\u636e\u5728 Reduce \u7aef\u5b8c\u6210\u6700\u7ec8\u7684 Join \u64cd\u4f5c\u3002</p> <p>\u5982\u679c\u5173\u8054\u5b57\u6bb5\u7684\u503c\u5206\u5e03\u4e0d\u5747\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u5927\u91cf\u76f8\u540c\u7684 key \u8fdb\u5165\u540c\u4e00 Reduce\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u503e\u659c\u95ee\u9898\u3002</p> <p>\u7531 join \u5bfc\u81f4\u7684\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u6709\u5982\u4e0b\u4e09\u79cd\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>1\uff09map join</p> <p>\u4f7f\u7528 map join \u7b97\u6cd5\uff0cjoin \u64cd\u4f5c\u4ec5\u5728 map \u7aef\u5c31\u80fd\u5b8c\u6210\uff0c\u6ca1\u6709 shuffle \u64cd\u4f5c\uff0c\u6ca1\u6709 reduce \u9636\u6bb5\uff0c\u81ea\u7136\u4e0d\u4f1a\u4ea7\u751f reduce \u7aef\u7684\u6570\u636e\u503e\u659c\u3002\u8be5\u65b9\u6848\u9002\u7528\u4e8e\u5927\u8868 join \u5c0f\u8868\u65f6\u53d1\u751f\u6570\u636e\u503e\u659c\u7684\u573a\u666f\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u542f\u52a8Map Join\u81ea\u52a8\u8f6c\u6362\nset hive.auto.convert.join=true;\n\n--\u4e00\u4e2aCommon Join operator\u8f6c\u4e3aMap Join operator\u7684\u5224\u65ad\u6761\u4ef6,\u82e5\u8be5Common Join\u76f8\u5173\u7684\u8868\u4e2d,\u5b58\u5728n-1\u5f20\u8868\u7684\u5927\u5c0f\u603b\u548c&lt;=\u8be5\u503c,\u5219\u751f\u6210\u4e00\u4e2aMap Join\u8ba1\u5212,\u6b64\u65f6\u53ef\u80fd\u5b58\u5728\u591a\u79cdn-1\u5f20\u8868\u7684\u7ec4\u5408\u5747\u6ee1\u8db3\u8be5\u6761\u4ef6,\u5219hive\u4f1a\u4e3a\u6bcf\u79cd\u6ee1\u8db3\u6761\u4ef6\u7684\u7ec4\u5408\u5747\u751f\u6210\u4e00\u4e2aMap Join\u8ba1\u5212,\u540c\u65f6\u8fd8\u4f1a\u4fdd\u7559\u539f\u6709\u7684Common Join\u8ba1\u5212\u4f5c\u4e3a\u540e\u5907(back up)\u8ba1\u5212,\u5b9e\u9645\u8fd0\u884c\u65f6,\u4f18\u5148\u6267\u884cMap Join\u8ba1\u5212\uff0c\u82e5\u4e0d\u80fd\u6267\u884c\u6210\u529f\uff0c\u5219\u542f\u52a8Common Join\u540e\u5907\u8ba1\u5212\u3002\nset hive.mapjoin.smalltable.filesize=250000;\n\n--\u5f00\u542f\u65e0\u6761\u4ef6\u8f6cMap Join\nset hive.auto.convert.join.noconditionaltask=true;\n\n--\u65e0\u6761\u4ef6\u8f6cMap Join\u65f6\u7684\u5c0f\u8868\u4e4b\u548c\u9608\u503c,\u82e5\u4e00\u4e2aCommon Join operator\u76f8\u5173\u7684\u8868\u4e2d\uff0c\u5b58\u5728n-1\u5f20\u8868\u7684\u5927\u5c0f\u603b\u548c&lt;=\u8be5\u503c,\u6b64\u65f6hive\u4fbf\u4e0d\u4f1a\u518d\u4e3a\u6bcf\u79cdn-1\u5f20\u8868\u7684\u7ec4\u5408\u5747\u751f\u6210Map Join\u8ba1\u5212,\u540c\u65f6\u4e5f\u4e0d\u4f1a\u4fdd\u7559Common Join\u4f5c\u4e3a\u540e\u5907\u8ba1\u5212\u3002\u800c\u662f\u53ea\u751f\u6210\u4e00\u4e2a\u6700\u4f18\u7684Map Join\u8ba1\u5212\u3002\nset hive.auto.convert.join.noconditionaltask.size=10000000;\n</code></pre> <p>2\uff09skew join</p> <p>skew join \u7684\u539f\u7406\u662f\uff0c\u4e3a\u503e\u659c\u7684\u5927 key \u5355\u72ec\u542f\u52a8\u4e00\u4e2a map join \u4efb\u52a1\u8fdb\u884c\u8ba1\u7b97\uff0c\u5176\u4f59 key \u8fdb\u884c\u6b63\u5e38\u7684 common join\u3002\u539f\u7406\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u542f\u7528skew join\u4f18\u5316\nset hive.optimize.skewjoin=true;\n--\u89e6\u53d1skew join\u7684\u9608\u503c\uff0c\u82e5\u67d0\u4e2akey\u7684\u884c\u6570\u8d85\u8fc7\u8be5\u53c2\u6570\u503c\uff0c\u5219\u89e6\u53d1\nset hive.skewjoin.key=100000;\n</code></pre> <p>\u8fd9\u79cd\u65b9\u6848\u5bf9\u53c2\u4e0e join \u7684\u6e90\u8868\u5927\u5c0f\u6ca1\u6709\u8981\u6c42\uff0c\u4f46\u662f\u5bf9\u4e24\u8868\u4e2d\u503e\u659c\u7684 key \u7684\u6570\u636e\u91cf\u6709\u8981\u6c42\uff0c\u8981\u6c42\u4e00\u5f20\u8868\u4e2d\u7684\u503e\u659c key \u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5c0f\uff08\u65b9\u4fbf\u8d70 mapjoin\uff09\u3002</p> <p>3\uff09\u8c03\u6574 SQL \u8bed\u53e5</p> <p>\u82e5\u53c2\u4e0e join \u7684\u4e24\u8868\u5747\u4e3a\u5927\u8868\uff0c\u5176\u4e2d\u4e00\u5f20\u8868\u7684\u6570\u636e\u662f\u503e\u659c\u7684\uff0c\u6b64\u65f6\u4e5f\u53ef\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5bf9 SQL \u8bed\u53e5\u8fdb\u884c\u76f8\u5e94\u7684\u8c03\u6574\u3002</p> <p>\u5047\u8bbe\u539f\u59cb SQL \u8bed\u53e5\u5982\u4e0b\uff1aA\uff0cB \u4e24\u8868\u5747\u4e3a\u5927\u8868\uff0c\u4e14\u5176\u4e2d\u4e00\u5f20\u8868\u7684\u6570\u636e\u662f\u503e\u659c\u7684\u3002</p> <pre><code>select\n*\nfrom A\njoin B\non A.id=B.id;\n</code></pre> <p>\u5176 join \u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u56fe\u4e2d 1001 \u4e3a\u503e\u659c\u7684\u5927 key\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5176\u88ab\u53d1\u5f80\u4e86\u540c\u4e00\u4e2a Reduce \u8fdb\u884c\u5904\u7406\u3002</p> <p>\u8c03\u6574 SQL \u8bed\u53e5\u5982\u4e0b\uff1a</p> <pre><code>select\n*\nfrom(\nselect --\u6253\u6563\u64cd\u4f5c\nconcat(id,'_',cast(rand()*2 as int)) id,\nvalue\nfrom A\n)ta\njoin(\nselect --\u6269\u5bb9\u64cd\u4f5c\nconcat(id,'_',0) id,\nvalue\nfrom B\nunion all\nselect\nconcat(id,'_',1) id,\nvalue\nfrom B\n)tb\non ta.id=tb.id;\n</code></pre> <p>\u8c03\u6574\u4e4b\u540e\u7684 SQL \u8bed\u53e5\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"engine/hive/hive_12/#12632","title":"12.6.3.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8bSQL\u8bed\u53e5</p> <pre><code>select\n*\nfrom order_detail od\njoin province_info pi\non od.province_id=pi.id;\n</code></pre> <p>2\uff09\u4f18\u5316\u524d</p> <p>order_detail \u8868\u4e2d\u7684 province_id \u5b57\u6bb5\u662f\u5b58\u5728\u503e\u659c\u7684\uff0c\u82e5\u4e0d\u7ecf\u8fc7\u4f18\u5316\uff0c\u901a\u8fc7\u89c2\u5bdf\u4efb\u52a1\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u662f\u80fd\u591f\u770b\u51fa\u6570\u636e\u503e\u659c\u73b0\u8c61\u7684\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>Hive\u4e2d \u7684 map join \u81ea\u52a8\u8f6c\u6362\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u82e5\u60f3\u770b\u5230\u6570\u636e\u503e\u659c\u7684\u73b0\u8c61\uff0c\u9700\u8981\u5148\u5c06 hive.auto.convert.join \u53c2\u6570\u8bbe\u7f6e\u4e3a false\u3002</p> <p>3\uff09\u4f18\u5316\u601d\u8def</p> <p>\u4e0a\u8ff0\u4e24\u79cd\u4f18\u5316\u601d\u8def\u5747\u53ef\u89e3\u51b3\u8be5\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u4e0b\u9762\u5206\u522b\u8fdb\u884c\u8bf4\u660e\uff1a</p> <p>\uff081\uff09map join</p> <p>\u8bbe\u7f6e\u5982\u4e0b\u53c2\u6570</p> <pre><code>--\u542f\u7528map join\nset hive.auto.convert.join=true;\n--\u5173\u95edskew join\nset hive.optimize.skewjoin=false;\n</code></pre> <p>\u53ef\u4ee5\u5f88\u660e\u663e\u770b\u5230\u5f00\u542f map join \u4ee5\u540e\uff0cmr \u4efb\u52a1\u53ea\u6709 map \u9636\u6bb5\uff0c\u6ca1\u6709 reduce \u9636\u6bb5\uff0c\u81ea\u7136\u4e5f\u5c31\u4e0d\u4f1a\u6709\u6570\u636e\u503e\u659c\u53d1\u751f\u3002</p> <p></p> <p></p> <p>\uff082\uff09skew join</p> <p>\u8bbe\u7f6e\u5982\u4e0b\u53c2\u6570</p> <pre><code>--\u542f\u52a8skew join\nset hive.optimize.skewjoin=true;\n--\u5173\u95edmap join\nset hive.auto.convert.join=false;\n</code></pre> <p>\u5f00\u542f skew join \u540e\uff0c\u4f7f\u7528 explain \u53ef\u4ee5\u5f88\u660e\u663e\u770b\u5230\u6267\u884c\u8ba1\u5212\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8bf4\u660e skew join \u751f\u6548\uff0c\u4efb\u52a1\u65e2\u6709 common join\uff0c\u53c8\u6709\u90e8\u5206 key \u8d70\u4e86 map join\u3002</p> <p></p> <p>\u5e76\u4e14\u8be5 sql \u5728 yarn \u4e0a\u6700\u7ec8\u542f\u52a8\u4e86\u4e24\u4e2a mr \u4efb\u52a1\uff0c\u800c\u4e14\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u53ea\u6709 map \u6ca1\u6709 reduce \u9636\u6bb5\uff0c\u8bf4\u660e\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u662f\u5bf9\u503e\u659c\u7684 key \u8fdb\u884c\u4e86 map join\u3002</p> <p></p> <p></p>"},{"location":"engine/hive/hive_12/#127-hql","title":"12.7 HQL\u8bed\u6cd5\u4f18\u5316\u4e4b\u4efb\u52a1\u5e76\u884c\u5ea6","text":""},{"location":"engine/hive/hive_12/#1271","title":"12.7.1 \u4f18\u5316\u8bf4\u660e","text":"<p>\u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u8ba1\u7b97\u4efb\u52a1\u800c\u8a00\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u5408\u9002\u7684\u5e76\u884c\u5ea6\u5341\u5206\u91cd\u8981\u3002Hive \u7684\u8ba1\u7b97\u4efb\u52a1\u7531 MapReduce \u5b8c\u6210\uff0c\u6545\u5e76\u884c\u5ea6\u7684\u8c03\u6574\u9700\u8981\u5206\u4e3a Map \u7aef\u548c Reduce \u7aef\u3002</p>"},{"location":"engine/hive/hive_12/#12711-map","title":"12.7.1.1 Map\u7aef\u5e76\u884c\u5ea6","text":"<p>Map \u7aef\u7684\u5e76\u884c\u5ea6\uff0c\u4e5f\u5c31\u662f Map \u7684\u4e2a\u6570\u3002\u662f\u7531\u8f93\u5165\u6587\u4ef6\u7684\u5207\u7247\u6570\u51b3\u5b9a\u7684\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cMap \u7aef\u7684\u5e76\u884c\u5ea6\u65e0\u9700\u624b\u52a8\u8c03\u6574\u3002</p> <p>\u4ee5\u4e0b\u7279\u6b8a\u60c5\u51b5\u53ef\u8003\u8651\u8c03\u6574 map \u7aef\u5e76\u884c\u5ea6\uff1a</p> <p>1\uff09\u67e5\u8be2\u7684\u8868\u4e2d\u5b58\u5728\u5927\u91cf\u5c0f\u6587\u4ef6</p> <p>\u6309\u7167 Hadoop \u9ed8\u8ba4\u7684\u5207\u7247\u7b56\u7565\uff0c\u4e00\u4e2a\u5c0f\u6587\u4ef6\u4f1a\u5355\u72ec\u542f\u52a8\u4e00\u4e2a map task \u8d1f\u8d23\u8ba1\u7b97\u3002\u82e5\u67e5\u8be2\u7684\u8868\u4e2d\u5b58\u5728\u5927\u91cf\u5c0f\u6587\u4ef6\uff0c\u5219\u4f1a\u542f\u52a8\u5927\u91cf map task\uff0c\u9020\u6210\u8ba1\u7b97\u8d44\u6e90\u7684\u6d6a\u8d39\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528 Hive \u63d0\u4f9b\u7684 CombineHiveInputFormat\uff0c\u591a\u4e2a\u5c0f\u6587\u4ef6\u5408\u5e76\u4e3a\u4e00\u4e2a\u5207\u7247\uff0c\u4ece\u800c\u63a7\u5236 map task \u4e2a\u6570\u3002\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\n</code></pre> <p>2\uff09map \u7aef\u6709\u590d\u6742\u7684\u67e5\u8be2\u903b\u8f91</p> <p>\u82e5 SQL \u8bed\u53e5\u4e2d\u6709\u6b63\u5219\u66ff\u6362\u3001json \u89e3\u6790\u7b49\u590d\u6742\u8017\u65f6\u7684\u67e5\u8be2\u903b\u8f91\u65f6\uff0cmap \u7aef\u7684\u8ba1\u7b97\u4f1a\u76f8\u5bf9\u6162\u4e00\u4e9b\u3002\u82e5\u60f3\u52a0\u5feb\u8ba1\u7b97\u901f\u5ea6\uff0c\u5728\u8ba1\u7b97\u8d44\u6e90\u5145\u8db3\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u8003\u8651\u589e\u5927 map \u7aef\u7684\u5e76\u884c\u5ea6\uff0c\u4ee4 map task \u591a\u4e00\u4e9b\uff0c\u6bcf\u4e2a map task \u8ba1\u7b97\u7684\u6570\u636e\u5c11\u4e00\u4e9b\u3002\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u4e00\u4e2a\u5207\u7247\u7684\u6700\u5927\u503c\nset mapreduce.input.fileinputformat.split.maxsize=256000000;\n</code></pre>"},{"location":"engine/hive/hive_12/#12712-reduce","title":"12.7.1.2 Reduce\u7aef\u5e76\u884c\u5ea6","text":"<p>Reduce \u7aef\u7684\u5e76\u884c\u5ea6\uff0c\u4e5f\u5c31\u662f Reduce \u4e2a\u6570\u3002\u76f8\u5bf9\u6765\u8bf4\uff0c\u66f4\u9700\u8981\u5173\u6ce8\u3002Reduce \u7aef\u7684\u5e76\u884c\u5ea6\uff0c\u53ef\u7531\u7528\u6237\u81ea\u5df1\u6307\u5b9a\uff0c\u4e5f\u53ef\u7531 Hive \u81ea\u884c\u6839\u636e\u8be5 MR Job \u8f93\u5165\u7684\u6587\u4ef6\u5927\u5c0f\u8fdb\u884c\u4f30\u7b97\u3002</p> <p>Reduce \u7aef\u7684\u5e76\u884c\u5ea6\u7684\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u6307\u5b9aReduce\u7aef\u5e76\u884c\u5ea6\uff0c\u9ed8\u8ba4\u503c\u4e3a-1\uff0c\u8868\u793a\u7528\u6237\u672a\u6307\u5b9a\nset mapreduce.job.reduces;\n--Reduce\u7aef\u5e76\u884c\u5ea6\u6700\u5927\u503c\nset hive.exec.reducers.max;\n--\u5355\u4e2aReduce Task\u8ba1\u7b97\u7684\u6570\u636e\u91cf\uff0c\u7528\u4e8e\u4f30\u7b97Reduce\u5e76\u884c\u5ea6\nset hive.exec.reducers.bytes.per.reducer;\n</code></pre> <p>Reduce \u7aef\u5e76\u884c\u5ea6\u7684\u786e\u5b9a\u903b\u8f91\u5982\u4e0b\uff1a</p> <p>\u82e5\u6307\u5b9a\u53c2\u6570 mapreduce.job.reduces \u7684\u503c\u4e3a\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\uff0c\u5219 Reduce \u5e76\u884c\u5ea6\u4e3a\u6307\u5b9a\u503c\u3002\u5426\u5219\uff0cHive \u81ea\u884c\u4f30\u7b97 Reduce \u5e76\u884c\u5ea6\uff0c\u4f30\u7b97\u903b\u8f91\u5982\u4e0b\uff1a</p> <p>\u5047\u8bbe Job \u8f93\u5165\u7684\u6587\u4ef6\u5927\u5c0f\u4e3a totalInputBytes</p> <p>\u53c2\u6570 hive.exec.reducers.bytes.per.reducer \u7684\u503c\u4e3a bytesPerReducer\u3002</p> <p>\u53c2\u6570 hive.exec.reducers.max \u7684\u503c\u4e3a maxReducers\u3002</p> <p>\u5219 Reduce \u7aef\u7684\u5e76\u884c\u5ea6\u4e3a\uff1a</p> <p> </p> <p>\u6839\u636e\u4e0a\u8ff0\u63cf\u8ff0\uff0c\u53ef\u4ee5\u770b\u51fa\uff0cHive \u81ea\u884c\u4f30\u7b97 Reduce \u5e76\u884c\u5ea6\u65f6\uff0c\u662f\u4ee5\u6574\u4e2a MR Job \u8f93\u5165\u7684\u6587\u4ef6\u5927\u5c0f\u4f5c\u4e3a\u4f9d\u636e\u7684\u3002\u56e0\u6b64\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5176\u4f30\u8ba1\u7684\u5e76\u884c\u5ea6\u5f88\u53ef\u80fd\u5e76\u4e0d\u51c6\u786e\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u7528\u6237\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u6307\u5b9a Reduce \u5e76\u884c\u5ea6\u4e86\u3002</p>"},{"location":"engine/hive/hive_12/#1272","title":"12.7.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b SQL \u8bed\u53e5</p> <pre><code>select\nprovince_id,\ncount(*)\nfrom order_detail\ngroup by province_id;\n</code></pre> <p>2\uff09\u4f18\u5316\u524d</p> <p>\u4e0a\u8ff0 sql \u8bed\u53e5\uff0c\u5728\u4e0d\u6307\u5b9a Reduce \u5e76\u884c\u5ea6\u65f6\uff0cHive \u81ea\u884c\u4f30\u7b97\u5e76\u884c\u5ea6\u7684\u903b\u8f91\u5982\u4e0b\uff1a</p> <pre><code>totalInputBytes= 1136009934\nbytesPerReducer=256000000\nmaxReducers=1009\n</code></pre> <p>\u7ecf\u8ba1\u7b97\uff0cReduce \u5e76\u884c\u5ea6\u4e3a</p> <p></p> <p>3\uff09\u4f18\u5316\u601d\u8def</p> <p>\u4e0a\u8ff0 sql \u8bed\u53e5\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u662f\u4f1a\u8fdb\u884c map-side \u805a\u5408\u7684\uff0c\u4e5f\u5c31\u662f Reduce \u7aef\u63a5\u6536\u7684\u6570\u636e\uff0c\u5b9e\u9645\u4e0a\u662f map \u7aef\u5b8c\u6210\u805a\u5408\u4e4b\u540e\u7684\u7ed3\u679c\u3002\u89c2\u5bdf\u4efb\u52a1\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u4f1a\u53d1\u73b0\uff0c\u6bcf\u4e2a map \u7aef\u8f93\u51fa\u7684\u6570\u636e\u53ea\u6709 34 \u6761\u8bb0\u5f55\uff0c\u5171\u6709 5 \u4e2a map task\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4 Reduce \u7aef\u5b9e\u9645\u53ea\u4f1a\u63a5\u6536 170\uff08 34 * 5 \uff09\u6761\u8bb0\u5f55\uff0c\u6545\u7406\u8bba\u4e0a Reduce \u7aef\u5e76\u884c\u5ea6\u8bbe\u7f6e\u4e3a 1 \u5c31\u8db3\u591f\u4e86\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u53ef\u901a\u8fc7\u4ee5\u4e0b\u53c2\u6570\uff0c\u81ea\u884c\u8bbe\u7f6e Reduce \u7aef\u5e76\u884c\u5ea6\u4e3a 1\u3002</p> <pre><code>--\u6307\u5b9aReduce\u7aef\u5e76\u884c\u5ea6\uff0c\u9ed8\u8ba4\u503c\u4e3a-1\uff0c\u8868\u793a\u7528\u6237\u672a\u6307\u5b9a\nset mapreduce.job.reduces=1;\n</code></pre>"},{"location":"engine/hive/hive_12/#128-hql","title":"12.8 HQL\u8bed\u6cd5\u4f18\u5316\u4e4b\u5c0f\u6587\u4ef6\u5408\u5e76","text":""},{"location":"engine/hive/hive_12/#1281","title":"12.8.1 \u4f18\u5316\u8bf4\u660e","text":"<p>\u5c0f\u6587\u4ef6\u5408\u5e76\u4f18\u5316\uff0c\u5206\u4e3a\u4e24\u4e2a\u65b9\u9762\uff0c\u5206\u522b\u662f Map \u7aef\u8f93\u5165\u7684\u5c0f\u6587\u4ef6\u5408\u5e76\uff0c\u548c Reduce \u7aef\u8f93\u51fa\u7684\u5c0f\u6587\u4ef6\u5408\u5e76\u3002</p>"},{"location":"engine/hive/hive_12/#12811-map","title":"12.8.1.1 Map\u7aef\u8f93\u5165\u6587\u4ef6\u5408\u5e76","text":"<p>\u5408\u5e76 Map \u7aef\u8f93\u5165\u7684\u5c0f\u6587\u4ef6\uff0c\u662f\u6307\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u5212\u5206\u5230\u4e00\u4e2a\u5207\u7247\u4e2d\uff0c\u8fdb\u800c\u7531\u4e00\u4e2a Map Task \u53bb\u5904\u7406\u3002\u76ee\u7684\u662f\u9632\u6b62\u4e3a\u5355\u4e2a\u5c0f\u6587\u4ef6\u542f\u52a8\u4e00\u4e2a Map Task\uff0c\u6d6a\u8d39\u8ba1\u7b97\u8d44\u6e90\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u4e3a\uff1a</p> <pre><code>--\u53ef\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u5207\u7247\uff0c\u5408\u5e76\u4e3a\u4e00\u4e2a\u5207\u7247\uff0c\u8fdb\u800c\u7531\u4e00\u4e2amap\u4efb\u52a1\u5904\u7406\nset hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\n</code></pre>"},{"location":"engine/hive/hive_12/#12812-reduce","title":"12.8.1.2 Reduce\u8f93\u51fa\u6587\u4ef6\u5408\u5e76","text":"<p>\u5408\u5e76 Reduce \u7aef\u8f93\u51fa\u7684\u5c0f\u6587\u4ef6\uff0c\u662f\u6307\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u5408\u5e76\u6210\u5927\u6587\u4ef6\u3002\u76ee\u7684\u662f\u51cf\u5c11 HDFS \u5c0f\u6587\u4ef6\u6570\u91cf\u3002\u5176\u539f\u7406\u662f\u6839\u636e\u8ba1\u7b97\u4efb\u52a1\u8f93\u51fa\u6587\u4ef6\u7684\u5e73\u5747\u5927\u5c0f\u8fdb\u884c\u5224\u65ad\uff0c\u82e5\u7b26\u5408\u6761\u4ef6\uff0c\u5219\u5355\u72ec\u542f\u52a8\u4e00\u4e2a\u989d\u5916\u7684\u4efb\u52a1\u8fdb\u884c\u5408\u5e76\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u4e3a\uff1a</p> <pre><code>--\u5f00\u542f\u5408\u5e76map only\u4efb\u52a1\u8f93\u51fa\u7684\u5c0f\u6587\u4ef6\nset hive.merge.mapfiles=true;\n\n--\u5f00\u542f\u5408\u5e76map reduce\u4efb\u52a1\u8f93\u51fa\u7684\u5c0f\u6587\u4ef6\nset hive.merge.mapredfiles=true;\n\n--\u5408\u5e76\u540e\u7684\u6587\u4ef6\u5927\u5c0f\nset hive.merge.size.per.task=256000000;\n\n--\u89e6\u53d1\u5c0f\u6587\u4ef6\u5408\u5e76\u4efb\u52a1\u7684\u9608\u503c\uff0c\u82e5\u67d0\u8ba1\u7b97\u4efb\u52a1\u8f93\u51fa\u7684\u6587\u4ef6\u5e73\u5747\u5927\u5c0f\u4f4e\u4e8e\u8be5\u503c\uff0c\u5219\u89e6\u53d1\u5408\u5e76\nset hive.merge.smallfiles.avgsize=16000000;\n</code></pre>"},{"location":"engine/hive/hive_12/#1282","title":"12.8.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b\u7528\u8868</p> <p>\u73b0\u6709\u4e00\u4e2a\u9700\u6c42\uff0c\u8ba1\u7b97\u5404\u7701\u4efd\u8ba2\u5355\u91d1\u989d\u603b\u548c\uff0c\u4e0b\u8868\u4e3a\u7ed3\u679c\u8868\u3002</p> <pre><code>drop table if exists order_amount_by_province;\ncreate table order_amount_by_province(\nprovince_id string comment '\u7701\u4efdid',\norder_amount decimal(16,2) comment '\u8ba2\u5355\u91d1\u989d'\n)\nlocation '/order_amount_by_province';\n</code></pre> <p>2\uff09\u793a\u4f8b SQL \u8bed\u53e5</p> <pre><code>insert overwrite table order_amount_by_province\nselect\nprovince_id,\nsum(total_amount)\nfrom order_detail\ngroup by province_id;\n</code></pre> <p>3\uff09\u4f18\u5316\u524d</p> <p>\u6839\u636e\u4efb\u52a1\u5e76\u884c\u5ea6\u4e00\u8282\u6240\u9700\u5185\u5bb9\uff0c\u53ef\u5206\u6790\u51fa\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5 sql \u8bed\u53e5\u7684 Reduce \u7aef\u5e76\u884c\u5ea6\u4e3a 5\uff0c\u6545\u6700\u7ec8\u8f93\u51fa\u6587\u4ef6\u4e2a\u6570\u4e5f\u4e3a 5\uff0c\u4e0b\u56fe\u4e3a\u8f93\u51fa\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c5 \u4e2a\u5747\u4e3a\u5c0f\u6587\u4ef6\u3002</p> <p></p> <p>4\uff09\u4f18\u5316\u601d\u8def</p> <p>\u82e5\u60f3\u907f\u514d\u5c0f\u6587\u4ef6\u7684\u4ea7\u751f\uff0c\u53ef\u91c7\u53d6\u65b9\u6848\u6709\u4e24\u4e2a\u3002</p> <p>\uff081\uff09\u5408\u7406\u8bbe\u7f6e\u4efb\u52a1\u7684 Reduce \u7aef\u5e76\u884c\u5ea6</p> <p>\u82e5\u5c06\u4e0a\u8ff0\u8ba1\u7b97\u4efb\u52a1\u7684\u5e76\u884c\u5ea6\u8bbe\u7f6e\u4e3a 1\uff0c\u5c31\u80fd\u4fdd\u8bc1\u5176\u8f93\u51fa\u7ed3\u679c\u53ea\u6709\u4e00\u4e2a\u6587\u4ef6\u3002</p> <p>\uff082\uff09\u542f\u7528 Hive \u5408\u5e76\u5c0f\u6587\u4ef6\u4f18\u5316</p> <p>\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <pre><code>--\u5f00\u542f\u5408\u5e76map reduce\u4efb\u52a1\u8f93\u51fa\u7684\u5c0f\u6587\u4ef6\nset hive.merge.mapredfiles=true;\n\n--\u5408\u5e76\u540e\u7684\u6587\u4ef6\u5927\u5c0f\nset hive.merge.size.per.task=256000000;\n\n--\u89e6\u53d1\u5c0f\u6587\u4ef6\u5408\u5e76\u4efb\u52a1\u7684\u9608\u503c\uff0c\u82e5\u67d0\u8ba1\u7b97\u4efb\u52a1\u8f93\u51fa\u7684\u6587\u4ef6\u5e73\u5747\u5927\u5c0f\u4f4e\u4e8e\u8be5\u503c\uff0c\u5219\u89e6\u53d1\u5408\u5e76\nset hive.merge.smallfiles.avgsize=16000000;\n</code></pre> <p>\u518d\u6b21\u6267\u884c\u4e0a\u8ff0\u7684 insert \u8bed\u53e5\uff0c\u89c2\u5bdf\u7ed3\u679c\u8868\u4e2d\u7684\u6587\u4ef6\uff0c\u53ea\u5269\u4e00\u4e2a\u4e86\u3002</p> <p></p>"},{"location":"engine/hive/hive_12/#129","title":"12.9 \u5176\u4ed6\u4f18\u5316","text":""},{"location":"engine/hive/hive_12/#1291-cbo","title":"12.9.1 CBO\u4f18\u5316","text":""},{"location":"engine/hive/hive_12/#12911","title":"12.9.1.1 \u4f18\u5316\u8bf4\u660e","text":"<p>CBO \u662f\u6307 Cost based Optimizer\uff0c\u5373\u57fa\u4e8e\u8ba1\u7b97\u6210\u672c\u7684\u4f18\u5316\u3002</p> <p>\u5728 Hive \u4e2d\uff0c\u8ba1\u7b97\u6210\u672c\u6a21\u578b\u8003\u8651\u5230\u4e86\uff1a\u6570\u636e\u7684\u884c\u6570\u3001CPU\u3001\u672c\u5730 IO\u3001HDFS IO\u3001\u7f51\u7edc IO \u7b49\u65b9\u9762\u3002Hive \u4f1a\u8ba1\u7b97\u540c\u4e00 SQL \u8bed\u53e5\u7684\u4e0d\u540c\u6267\u884c\u8ba1\u5212\u7684\u8ba1\u7b97\u6210\u672c\uff0c\u5e76\u9009\u51fa\u6210\u672c\u6700\u4f4e\u7684\u6267\u884c\u8ba1\u5212\u3002\u76ee\u524d CBO \u5728 Hive \u7684 MR \u5f15\u64ce\u4e0b\u4e3b\u8981\u7528\u4e8e join \u7684\u4f18\u5316\uff0c\u4f8b\u5982\u591a\u8868 join \u7684 join \u987a\u5e8f\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u4e3a\uff1a</p> <pre><code>--\u662f\u5426\u542f\u7528cbo\u4f18\u5316 \nset hive.cbo.enable=true;\n</code></pre>"},{"location":"engine/hive/hive_12/#12922","title":"12.9.2.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b SQL \u8bed\u53e5</p> <pre><code>select\n*\nfrom order_detail od\njoin product_info product on od.product_id=product.id\njoin province_info province on od.province_id=province.id;\n</code></pre> <p>2\uff09\u5173\u95ed CBO \u4f18\u5316</p> <pre><code>--\u5173\u95edcbo\u4f18\u5316 \nset hive.cbo.enable=false;\n\n--\u4e3a\u4e86\u6d4b\u8bd5\u6548\u679c\u66f4\u52a0\u76f4\u89c2\uff0c\u5173\u95edmap join\u81ea\u52a8\u8f6c\u6362\nset hive.auto.convert.join=false;\n</code></pre> <p>\u6839\u636e\u6267\u884c\u8ba1\u5212\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u4e09\u5f20\u8868\u7684 join \u987a\u5e8f\u5982\u4e0b\uff1a</p> <p></p> <p>3\uff09\u5f00\u542f CBO \u4f18\u5316</p> <pre><code>--\u5f00\u542fcbo\u4f18\u5316 \nset hive.cbo.enable=true;\n--\u4e3a\u4e86\u6d4b\u8bd5\u6548\u679c\u66f4\u52a0\u76f4\u89c2\uff0c\u5173\u95edmap join\u81ea\u52a8\u8f6c\u6362\nset hive.auto.convert.join=false;\n</code></pre> <p>\u6839\u636e\u6267\u884c\u8ba1\u5212\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u4e09\u5f20\u8868\u7684 join \u987a\u5e8f\u5982\u4e0b\uff1a</p> <p></p> <p>4\uff09\u603b\u7ed3</p> <p>\u6839\u636e\u4e0a\u8ff0\u6848\u4f8b\u53ef\u4ee5\u770b\u51fa\uff0cCBO \u4f18\u5316\u5bf9\u4e8e\u6267\u884c\u8ba1\u5212\u4e2d join \u987a\u5e8f\u662f\u6709\u5f71\u54cd\u7684\uff0c\u5176\u4e4b\u6240\u4ee5\u4f1a\u5c06 province_info \u7684 join \u987a\u5e8f\u63d0\u524d\uff0c\u662f\u56e0\u4e3a province info \u7684\u6570\u636e\u91cf\u8f83\u5c0f\uff0c\u5c06\u5176\u63d0\u524d\uff0c\u4f1a\u6709\u66f4\u5927\u7684\u6982\u7387\u4f7f\u5f97\u4e2d\u95f4\u7ed3\u679c\u7684\u6570\u636e\u91cf\u53d8\u5c0f\uff0c\u4ece\u800c\u4f7f\u6574\u4e2a\u8ba1\u7b97\u4efb\u52a1\u7684\u6570\u636e\u91cf\u51cf\u5c0f\uff0c\u4e5f\u5c31\u662f\u4f7f\u8ba1\u7b97\u6210\u672c\u53d8\u5c0f\u3002</p>"},{"location":"engine/hive/hive_12/#1292","title":"12.9.2 \u8c13\u8bcd\u4e0b\u63a8","text":""},{"location":"engine/hive/hive_12/#12921","title":"12.9.2.1 \u4f18\u5316\u8bf4\u660e","text":"<p>\u8c13\u8bcd\u4e0b\u63a8\uff08predicate pushdown\uff09\u662f\u6307\uff0c\u5c3d\u91cf\u5c06\u8fc7\u6ee4\u64cd\u4f5c\u524d\u79fb\uff0c\u4ee5\u51cf\u5c11\u540e\u7eed\u8ba1\u7b97\u6b65\u9aa4\u7684\u6570\u636e\u91cf\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u4e3a\uff1a</p> <pre><code>--\u662f\u5426\u542f\u52a8\u8c13\u8bcd\u4e0b\u63a8\uff08predicate pushdown\uff09\u4f18\u5316\nset hive.optimize.ppd = true;\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a</p> <p>CBO \u4f18\u5316\u4e5f\u4f1a\u5b8c\u6210\u4e00\u90e8\u5206\u7684\u8c13\u8bcd\u4e0b\u63a8\u4f18\u5316\u5de5\u4f5c\uff0c\u56e0\u4e3a\u5728\u6267\u884c\u8ba1\u5212\u4e2d\uff0c\u8c13\u8bcd\u8d8a\u9760\u524d\uff0c\u6574\u4e2a\u8ba1\u5212\u7684\u8ba1\u7b97\u6210\u672c\u5c31\u4f1a\u8d8a\u4f4e\u3002</p>"},{"location":"engine/hive/hive_12/#12922_1","title":"12.9.2.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b SQL \u8bed\u53e5</p> <pre><code>select\n*\nfrom order_detail\njoin province_info\nwhere order_detail.province_id='2';\n</code></pre> <p>2\uff09\u5173\u95ed\u8c13\u8bcd\u4e0b\u63a8\u4f18\u5316</p> <pre><code>--\u662f\u5426\u542f\u52a8\u8c13\u8bcd\u4e0b\u63a8\uff08predicate pushdown\uff09\u4f18\u5316\nset hive.optimize.ppd = false;\n\n--\u4e3a\u4e86\u6d4b\u8bd5\u6548\u679c\u66f4\u52a0\u76f4\u89c2\uff0c\u5173\u95edcbo\u4f18\u5316\nset hive.cbo.enable=false;\n</code></pre> <p>\u901a\u8fc7\u6267\u884c\u8ba1\u5212\u53ef\u4ee5\u770b\u5230\uff0c\u8fc7\u6ee4\u64cd\u4f5c\u4f4d\u4e8e\u6267\u884c\u8ba1\u5212\u4e2d\u7684 join \u64cd\u4f5c\u4e4b\u540e\u3002</p> <p>3\uff09\u5f00\u542f\u8c13\u8bcd\u4e0b\u63a8\u4f18\u5316</p> <pre><code>--\u662f\u5426\u542f\u52a8\u8c13\u8bcd\u4e0b\u63a8\uff08predicate pushdown\uff09\u4f18\u5316\nset hive.optimize.ppd = true;\n\n--\u4e3a\u4e86\u6d4b\u8bd5\u6548\u679c\u66f4\u52a0\u76f4\u89c2\uff0c\u5173\u95edcbo\u4f18\u5316\nset hive.cbo.enable=false;\n</code></pre> <p>\u901a\u8fc7\u6267\u884c\u8ba1\u5212\u53ef\u4ee5\u770b\u51fa\uff0c\u8fc7\u6ee4\u64cd\u4f5c\u4f4d\u4e8e\u6267\u884c\u8ba1\u5212\u4e2d\u7684 join \u64cd\u4f5c\u4e4b\u524d\u3002</p>"},{"location":"engine/hive/hive_12/#1293","title":"12.9.3 \u77e2\u91cf\u5316\u67e5\u8be2","text":"<p>Hive \u7684\u77e2\u91cf\u5316\u67e5\u8be2\u4f18\u5316\uff0c\u4f9d\u8d56\u4e8e CPU \u7684\u77e2\u91cf\u5316\u8ba1\u7b97\uff0cCPU \u7684\u77e2\u91cf\u5316\u8ba1\u7b97\u7684\u57fa\u672c\u539f\u7406\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>Hive \u7684\u77e2\u91cf\u5316\u67e5\u8be2\uff0c\u53ef\u4ee5\u6781\u5927\u7684\u63d0\u9ad8\u4e00\u4e9b\u5178\u578b\u67e5\u8be2\u573a\u666f\uff08\u4f8b\u5982 scans, filters, aggregates, and joins\uff09\u4e0b\u7684 CPU \u4f7f\u7528\u6548\u7387\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>set hive.vectorized.execution.enabled=true;\n</code></pre> <p>\u82e5\u6267\u884c\u8ba1\u5212\u4e2d\uff0c\u51fa\u73b0 <code>Execution mode: vectorized</code> \u5b57\u6837\uff0c\u5373\u8868\u660e\u4f7f\u7528\u4e86\u77e2\u91cf\u5316\u8ba1\u7b97\u3002</p> <p>\u5b98\u7f51\u53c2\u8003\u94fe\u63a5</p>"},{"location":"engine/hive/hive_12/#1294-fetch","title":"12.9.4 Fetch\u6293\u53d6","text":"<p>Fetch \u6293\u53d6\u662f\u6307\uff0cHive \u4e2d\u5bf9\u67d0\u4e9b\u60c5\u51b5\u7684\u67e5\u8be2\u53ef\u4ee5\u4e0d\u5fc5\u4f7f\u7528 MapReduce \u8ba1\u7b97\u3002\u4f8b\u5982\uff1a<code>select * from emp;</code> \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cHive \u53ef\u4ee5\u7b80\u5355\u5730\u8bfb\u53d6 emp \u5bf9\u5e94\u7684\u5b58\u50a8\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u7136\u540e\u8f93\u51fa\u67e5\u8be2\u7ed3\u679c\u5230\u63a7\u5236\u53f0\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u662f\u5426\u5728\u7279\u5b9a\u573a\u666f\u8f6c\u6362\u4e3afetch \u4efb\u52a1\n--\u8bbe\u7f6e\u4e3anone\u8868\u793a\u4e0d\u8f6c\u6362\n--\u8bbe\u7f6e\u4e3aminimal\u8868\u793a\u652f\u6301select *\uff0c\u5206\u533a\u5b57\u6bb5\u8fc7\u6ee4\uff0cLimit\u7b49\n--\u8bbe\u7f6e\u4e3amore\u8868\u793a\u652f\u6301select \u4efb\u610f\u5b57\u6bb5,\u5305\u62ec\u51fd\u6570\uff0c\u8fc7\u6ee4\uff0c\u548climit\u7b49\nset hive.fetch.task.conversion=more;\n</code></pre>"},{"location":"engine/hive/hive_12/#1295","title":"12.9.5 \u672c\u5730\u6a21\u5f0f","text":""},{"location":"engine/hive/hive_12/#12951","title":"12.9.5.1 \u4f18\u5316\u8bf4\u660e","text":"<p>\u5927\u591a\u6570\u7684 Hadoop Job \u662f\u9700\u8981 Hadoop \u63d0\u4f9b\u7684\u5b8c\u6574\u7684\u53ef\u6269\u5c55\u6027\u6765\u5904\u7406\u5927\u6570\u636e\u96c6\u7684\u3002\u4e0d\u8fc7\uff0c\u6709\u65f6 Hive \u7684\u8f93\u5165\u6570\u636e\u91cf\u662f\u975e\u5e38\u5c0f\u7684\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e3a\u67e5\u8be2\u89e6\u53d1\u6267\u884c\u4efb\u52a1\u6d88\u8017\u7684\u65f6\u95f4\u53ef\u80fd\u4f1a\u6bd4\u5b9e\u9645 job \u7684\u6267\u884c\u65f6\u95f4\u8981\u591a\u7684\u591a\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u8fd9\u79cd\u60c5\u51b5\uff0cHive \u53ef\u4ee5\u901a\u8fc7\u672c\u5730\u6a21\u5f0f\u5728\u5355\u53f0\u673a\u5668\u4e0a\u5904\u7406\u6240\u6709\u7684\u4efb\u52a1\u3002\u5bf9\u4e8e\u5c0f\u6570\u636e\u96c6\uff0c\u6267\u884c\u65f6\u95f4\u53ef\u4ee5\u660e\u663e\u88ab\u7f29\u77ed\u3002</p> <p>\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u5f00\u542f\u81ea\u52a8\u8f6c\u6362\u4e3a\u672c\u5730\u6a21\u5f0f\nset hive.exec.mode.local.auto=true;\u00a0 --\u8bbe\u7f6elocal MapReduce\u7684\u6700\u5927\u8f93\u5165\u6570\u636e\u91cf\uff0c\u5f53\u8f93\u5165\u6570\u636e\u91cf\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u65f6\u91c7\u7528local\u00a0 MapReduce\u7684\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u4e3a134217728\uff0c\u5373128M\nset hive.exec.mode.local.auto.inputbytes.max=50000000;\n\n--\u8bbe\u7f6elocal MapReduce\u7684\u6700\u5927\u8f93\u5165\u6587\u4ef6\u4e2a\u6570\uff0c\u5f53\u8f93\u5165\u6587\u4ef6\u4e2a\u6570\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u65f6\u91c7\u7528local MapReduce\u7684\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u4e3a4\nset hive.exec.mode.local.auto.input.files.max=10;\n</code></pre>"},{"location":"engine/hive/hive_12/#12952","title":"12.9.5.2 \u4f18\u5316\u6848\u4f8b","text":"<p>1\uff09\u793a\u4f8b SQL \u8bed\u53e5</p> <pre><code>select\ncount(*)\nfrom product_info\ngroup by category_id;\n</code></pre> <p>2\uff09\u5173\u95ed\u672c\u5730\u6a21\u5f0f</p> <pre><code>set hive.exec.mode.local.auto=false;\n</code></pre> <p>3\uff09\u5f00\u542f\u672c\u5730\u6a21\u5f0f</p> <pre><code>set hive.exec.mode.local.auto=true;\n</code></pre>"},{"location":"engine/hive/hive_12/#1296","title":"12.9.6 \u5e76\u884c\u6267\u884c","text":"<p>Hive \u4f1a\u5c06\u4e00\u4e2a SQL \u8bed\u53e5\u8f6c\u5316\u6210\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Stage\uff0c\u6bcf\u4e2a Stage \u5bf9\u5e94\u4e00\u4e2a MR Job\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cHive \u540c\u65f6\u53ea\u4f1a\u6267\u884c\u4e00\u4e2a Stage\u3002\u4f46\u662f\u67d0 SQL \u8bed\u53e5\u53ef\u80fd\u4f1a\u5305\u542b\u591a\u4e2a Stage\uff0c\u4f46\u8fd9\u591a\u4e2a Stage \u53ef\u80fd\u5e76\u975e\u5b8c\u5168\u4e92\u76f8\u4f9d\u8d56\uff0c\u4e5f\u5c31\u662f\u8bf4\u6709\u4e9b Stage \u662f\u53ef\u4ee5\u5e76\u884c\u6267\u884c\u7684\u3002\u6b64\u5904\u63d0\u5230\u7684\u5e76\u884c\u6267\u884c\u5c31\u662f\u6307\u8fd9\u4e9b Stage \u7684\u5e76\u884c\u6267\u884c\u3002\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>--\u542f\u7528\u5e76\u884c\u6267\u884c\u4f18\u5316\nset hive.exec.parallel=true;\u00a0\u00a0     --\u540c\u4e00\u4e2asql\u5141\u8bb8\u6700\u5927\u5e76\u884c\u5ea6\uff0c\u9ed8\u8ba4\u4e3a8\nset hive.exec.parallel.thread.number=8; </code></pre>"},{"location":"engine/hive/hive_12/#1297","title":"12.9.7 \u4e25\u683c\u6a21\u5f0f","text":"<p>Hive \u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u67d0\u4e9b\u53c2\u6570\u9632\u6b62\u5371\u9669\u64cd\u4f5c\uff1a</p> <p>1\uff09\u5206\u533a\u8868\u4e0d\u4f7f\u7528\u5206\u533a\u8fc7\u6ee4</p> <p>\u5c06 hive.strict.checks.no.partition.filter \u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u5bf9\u4e8e\u5206\u533a\u8868\uff0c\u9664\u975e where \u8bed\u53e5\u4e2d\u542b\u6709\u5206\u533a\u5b57\u6bb5\u8fc7\u6ee4\u6761\u4ef6\u6765\u9650\u5236\u8303\u56f4\uff0c\u5426\u5219\u4e0d\u5141\u8bb8\u6267\u884c\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u7528\u6237\u4e0d\u5141\u8bb8\u626b\u63cf\u6240\u6709\u5206\u533a\u3002\u8fdb\u884c\u8fd9\u4e2a\u9650\u5236\u7684\u539f\u56e0\u662f\uff0c\u901a\u5e38\u5206\u533a\u8868\u90fd\u62e5\u6709\u975e\u5e38\u5927\u7684\u6570\u636e\u96c6\uff0c\u800c\u4e14\u6570\u636e\u589e\u52a0\u8fc5\u901f\u3002\u6ca1\u6709\u8fdb\u884c\u5206\u533a\u9650\u5236\u7684\u67e5\u8be2\u53ef\u80fd\u4f1a\u6d88\u8017\u4ee4\u4eba\u4e0d\u53ef\u63a5\u53d7\u7684\u5de8\u5927\u8d44\u6e90\u6765\u5904\u7406\u8fd9\u4e2a\u8868\u3002</p> <p>2\uff09\u4f7f\u7528 order by \u6ca1\u6709 limit \u8fc7\u6ee4</p> <p>\u5c06 hive.strict.checks.orderby.no.limit \u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u5bf9\u4e8e\u4f7f\u7528\u4e86 order by \u8bed\u53e5\u7684\u67e5\u8be2\uff0c\u8981\u6c42\u5fc5\u987b\u4f7f\u7528 limit \u8bed\u53e5\u3002\u56e0\u4e3a order by \u4e3a\u4e86\u6267\u884c\u6392\u5e8f\u8fc7\u7a0b\u4f1a\u5c06\u6240\u6709\u7684\u7ed3\u679c\u6570\u636e\u5206\u53d1\u5230\u540c\u4e00\u4e2a Reduce \u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u5f3a\u5236\u8981\u6c42\u7528\u6237\u589e\u52a0\u8fd9\u4e2a limit \u8bed\u53e5\u53ef\u4ee5\u9632\u6b62 Reduce \u989d\u5916\u6267\u884c\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff08\u5f00\u542f\u4e86 limit \u53ef\u4ee5\u5728\u6570\u636e\u8fdb\u5165\u5230 Reduce \u4e4b\u524d\u5c31\u51cf\u5c11\u4e00\u90e8\u5206\u6570\u636e\uff09\u3002</p> <p>3\uff09\u7b1b\u5361\u5c14\u79ef</p> <p>\u5c06 hive.strict.checks.cartesian.product \u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u4f1a\u9650\u5236\u7b1b\u5361\u5c14\u79ef\u7684\u67e5\u8be2\u3002\u5bf9\u5173\u7cfb\u578b\u6570\u636e\u5e93\u975e\u5e38\u4e86\u89e3\u7684\u7528\u6237\u53ef\u80fd\u671f\u671b\u5728\u6267\u884c JOIN \u67e5\u8be2\u7684\u65f6\u5019\u4e0d\u4f7f\u7528 ON \u8bed\u53e5\u800c\u662f\u4f7f\u7528 where \u8bed\u53e5\uff0c\u8fd9\u6837\u5173\u7cfb\u6570\u636e\u5e93\u7684\u6267\u884c\u4f18\u5316\u5668\u5c31\u53ef\u4ee5\u9ad8\u6548\u5730\u5c06 WHERE \u8bed\u53e5\u8f6c\u5316\u6210\u90a3\u4e2a ON \u8bed\u53e5\u3002\u4e0d\u5e78\u7684\u662f\uff0cHive \u5e76\u4e0d\u4f1a\u6267\u884c\u8fd9\u79cd\u4f18\u5316\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u8868\u8db3\u591f\u5927\uff0c\u90a3\u4e48\u8fd9\u4e2a\u67e5\u8be2\u5c31\u4f1a\u51fa\u73b0\u4e0d\u53ef\u63a7\u7684\u60c5\u51b5\u3002</p>"},{"location":"engine/hive/hive_13/","title":"\u7efc\u5408\u6848\u4f8b\u7ec3\u4e60\uff08\u9ad8\u7ea7\uff09","text":"<p>\u70b9\u51fb\u524d\u5f80\u5c1a\u7845\u8c37HQL\u5237\u9898\u7f51\u7ad9</p>"},{"location":"engine/hive/hive_14/","title":"\u9644\u5f55\uff1a\u5e38\u89c1\u9519\u8bef\u53ca\u89e3\u51b3\u65b9\u6848","text":""},{"location":"engine/hive/hive_14/#1mysql","title":"1\uff09\u8fde\u63a5\u4e0d\u4e0aMySQL\u6570\u636e\u5e93","text":"<p>\uff081\uff09\u5bfc\u9519\u9a71\u52a8\u5305\uff0c\u5e94\u8be5\u628a mysql-connector-java-5.1.27-bin.jar \u5bfc\u5165 /opt/module/hive/lib \u7684\u4e0d\u662f\u8fd9\u4e2a\u5305\u3002\u9519\u628a mysql-connector-java-5.1.27.tar.gz \u5bfc\u5165 hive/lib \u5305\u4e0b\u3002</p> <p>\uff082\uff09\u4fee\u6539 user \u8868\u4e2d\u7684\u4e3b\u673a\u540d\u79f0\u6ca1\u6709\u90fd\u4fee\u6539\u4e3a %\uff0c\u800c\u662f\u4fee\u6539\u4e3a localhost</p>"},{"location":"engine/hive/hive_14/#2hivecombinehiveinputformat","title":"2\uff09Hive\u9ed8\u8ba4\u7684\u8f93\u5165\u683c\u5f0f\u5904\u7406\u662fCombineHiveInputFormat\uff0c\u4f1a\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u3002","text":"<pre><code>set hive.input.format;\n\nhive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat\n</code></pre> <p>\u53ef\u4ee5\u91c7\u7528 HiveInputFormat \u5c31\u4f1a\u6839\u636e\u5206\u533a\u6570\u8f93\u51fa\u76f8\u5e94\u7684\u6587\u4ef6\u3002</p> <pre><code>set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;\n</code></pre>"},{"location":"engine/hive/hive_14/#3mapreduce","title":"3\uff09\u4e0d\u80fd\u6267\u884cMapReduce\u7a0b\u5e8f","text":"<p>\u53ef\u80fd\u662f Hadoop \u7684 Yarn \u6ca1\u5f00\u542f\u3002</p>"},{"location":"engine/hive/hive_14/#4mysqlmysql-server-pid-file-could-not-be-found","title":"4\uff09\u542f\u52a8MySQL\u670d\u52a1\u65f6\uff0c\u62a5MySQL server PID file could not be found! \u5f02\u5e38\u3002","text":"<p>\u5728 /var/lock/subsys/mysql \u8def\u5f84\u4e0b\u521b\u5efa hadoop102.pid\uff0c\u5e76\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5185\u5bb9\uff1a4396</p>"},{"location":"engine/hive/hive_14/#5service-mysql-status-mysql-is-not-running-but-lock-file-varlocksubsysmysql","title":"5\uff09\u62a5service mysql status MySQL is not running, but lock file (/var/lock/subsys/mysql[\u5931\u8d25])\u5f02\u5e38\u3002","text":"<p>\u89e3\u51b3\u65b9\u6848\uff1a\u5728 /var/lib/mysql \u76ee\u5f55\u4e0b\u521b\u5efa\uff1a-rw-rw----. 1 mysql mysql     5 12\u6708 22 16:41 hadoop102.pid \u6587\u4ef6\uff0c\u5e76\u4fee\u6539\u6743\u9650\u4e3a 777\u3002</p>"},{"location":"engine/hive/hive_14/#6jvmhive","title":"6\uff09JVM\u5806\u5185\u5b58\u6ea2\u51fa\uff08Hive\u96c6\u7fa4\u8fd0\u884c\u6a21\u5f0f\uff09","text":"<p>\u63cf\u8ff0\uff1ajava.lang.OutOfMemoryError: Java heap space</p> <p>\u89e3\u51b3\uff1a\u5728 yarn-site.xml \u4e2d\u52a0\u5165\u5982\u4e0b\u4ee3\u7801\u3002</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.scheduler.maximum-allocation-mb&lt;/name&gt;\n&lt;value&gt;2048&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.minimum-allocation-mb&lt;/name&gt;\n&lt;value&gt;2048&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.vmem-pmem-ratio&lt;/name&gt;\n&lt;value&gt;2.1&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;mapred.child.java.opts&lt;/name&gt;\n&lt;value&gt;-Xmx1024m&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"engine/hive/hive_14/#7jvmhive","title":"7\uff09JVM\u5806\u5185\u5b58\u6ea2\u51fa\uff08Hive\u672c\u5730\u8fd0\u884c\u6a21\u5f0f\uff09","text":"<p>\u63cf\u8ff0\uff1a\u5728\u542f\u7528 Hive \u672c\u5730\u6a21\u5f0f\u540e\uff0chive.log \u62a5\u9519 java.lang.OutOfMemoryError: Java heap space</p> <p>\u89e3\u51b3\u65b9\u68481\uff08\u4e34\u65f6\uff09\uff1a</p> <p>\u5728 Hive \u5ba2\u6237\u7aef\u4e34\u65f6\u8bbe\u7f6e io.sort.mb \u548c mapreduce.task.io.sort.mb \u4e24\u4e2a\u53c2\u6570\u7684\u503c\u4e3a 10\u3002</p> <pre><code>set io.sort.mb = 10;\nset mapreduce.task.io.sort.mb = 10;\n</code></pre> <p>\u89e3\u51b3\u65b9\u68482\uff08\u6c38\u4e45\u751f\u6548\uff09\uff1a</p> <p>\u5728 $HIVE_HOME/conf \u4e0b\u6dfb\u52a0 hive-env.sh\u3002</p> hive-env.sh<pre><code>export HADOOP_HEAPSIZE=1024\n</code></pre> <p>Warning</p> <p>\u4fee\u6539\u4e4b\u540e\u8bf7\u91cd\u542f Hive</p>"},{"location":"engine/hive/hive_14/#8","title":"8\uff09\u865a\u62df\u5185\u5b58\u9650\u5236","text":"<p>\u200b   \u5728 yarn-site.xml \u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e:</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;\n&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"engine/spark/spark_01/","title":"\u7b2c1\u7ae0 Spark\u6982\u8ff0","text":""},{"location":"engine/spark/spark_01/#11-spark","title":"1.1 \u4ec0\u4e48\u662fSpark","text":"<p>\u56de\u987e\uff1aHadoop \u4e3b\u8981\u89e3\u51b3\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8\u548c\u6d77\u91cf\u6570\u636e\u7684\u5206\u6790\u8ba1\u7b97\u3002</p> <p>Spark \u662f\u4e00\u79cd\u57fa\u4e8e\u5185\u5b58\u7684\u5feb\u901f\u3001\u901a\u7528\u3001\u53ef\u6269\u5c55\u7684\u5927\u6570\u636e\u5206\u6790\u8ba1\u7b97\u5f15\u64ce\u3002</p>"},{"location":"engine/spark/spark_01/#12-hadoopspark","title":"1.2 Hadoop\u4e0eSpark\u5386\u53f2","text":"Hadoop\u5386\u53f2Spark\u5386\u53f2 <p>Hadoop \u7684 Yarn \u6846\u67b6\u6bd4 Spark \u6846\u67b6\u8bde\u751f\u7684\u665a\uff0c\u6240\u4ee5 Spark \u81ea\u5df1\u4e5f\u8bbe\u8ba1\u4e86\u4e00\u5957\u8d44\u6e90\u8c03\u5ea6\u6846\u67b6\u3002</p>"},{"location":"engine/spark/spark_01/#13-hadoopspark","title":"1.3 Hadoop\u4e0eSpark\u6846\u67b6\u5bf9\u6bd4","text":"Hadoop MR \u6846\u67b6Spark \u6846\u67b6"},{"location":"engine/spark/spark_01/#14-spark","title":"1.4 Spark\u5185\u7f6e\u6a21\u5757","text":"Spark CoreSpark SQLSpark StreamingSpark MLlibSpark GraphX\u96c6\u7fa4\u7ba1\u7406\u5668 <p>\u5b9e\u73b0\u4e86 Spark \u7684\u57fa\u672c\u529f\u80fd\uff0c\u5305\u542b\u4efb\u52a1\u8c03\u5ea6\u3001\u5185\u5b58\u7ba1\u7406\u3001\u9519\u8bef\u6062\u590d\u3001\u4e0e\u5b58\u50a8\u7cfb\u7edf\u4ea4\u4e92\u7b49\u6a21\u5757\u3002Spark Core \u4e2d\u8fd8\u5305\u542b\u4e86\u5bf9\u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6( Resilient Distributed DataSet\uff0c\u7b80\u79f0 RDD )\u7684 API \u5b9a\u4e49\u3002 </p> <p>\u662f Spark \u7528\u6765\u64cd\u4f5c\u7ed3\u6784\u5316\u6570\u636e\u7684\u7a0b\u5e8f\u5305\u3002\u901a\u8fc7 Spark SQL\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 SQL \u6216\u8005 Apache Hive \u7248\u672c\u7684 HQL \u6765\u67e5\u8be2\u6570\u636e\u3002Spark SQL \u652f\u6301\u591a\u79cd\u6570\u636e\u6e90\uff0c\u6bd4\u5982 Hive \u8868\u3001Parquet \u4ee5\u53ca JSON \u7b49\u3002</p> <p>\u662f Spark \u63d0\u4f9b\u7684\u5bf9\u5b9e\u65f6\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u8ba1\u7b97\u7684\u7ec4\u4ef6\u3002\u63d0\u4f9b\u4e86\u7528\u6765\u64cd\u4f5c\u6570\u636e\u6d41\u7684 API\uff0c\u5e76\u4e14\u4e0e Spark Core \u4e2d\u7684 RDD API \u9ad8\u5ea6\u5bf9\u5e94\u3002</p> <p>\u63d0\u4f9b\u5e38\u89c1\u7684\u673a\u5668\u5b66\u4e60\u529f\u80fd\u7684\u7a0b\u5e8f\u5e93\u3002\u5305\u62ec\u5206\u7c7b\u3001\u56de\u5f52\u3001\u805a\u7c7b\u3001\u534f\u540c\u8fc7\u6ee4\u7b49\uff0c\u8fd8\u63d0\u4f9b\u4e86\u6a21\u578b\u8bc4\u4f30\u3001\u6570\u636e \u5bfc\u5165\u7b49\u989d\u5916\u7684\u652f\u6301\u529f\u80fd\u3002</p> <p>\u4e3b\u8981\u7528\u4e8e\u56fe\u5f62\u5e76\u884c\u8ba1\u7b97\u548c\u56fe\u6316\u6398\u7cfb\u7edf\u7684\u7ec4\u4ef6\u3002</p> <p>Spark \u8bbe\u8ba1\u4e3a\u53ef\u4ee5\u9ad8\u6548\u5730\u5728\u4e00\u4e2a\u8ba1\u7b97\u8282\u70b9\u5230\u6570\u5343\u4e2a\u8ba1\u7b97\u8282\u70b9\u4e4b\u95f4\u4f38\u7f29\u8ba1\u7b97\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u6837\u7684\u8981\u6c42\uff0c\u540c\u65f6\u83b7\u5f97\u6700\u5927\u7075\u6d3b\u6027\uff0cSpark \u652f\u6301\u5728\u5404\u79cd\u96c6\u7fa4\u7ba1\u7406\u5668\uff08Cluster Manager\uff09\u4e0a\u8fd0\u884c\uff0c\u5305\u62ec Hadoop YARN\u3001Apache Mesos\uff0c\u4ee5\u53ca Spark \u81ea\u5e26\u7684\u4e00\u4e2a\u7b80\u6613\u8c03\u5ea6\u5668\uff0c\u53eb\u4f5c\u72ec\u7acb\u8c03\u5ea6\u5668\u3002</p> <p>Spark \u5f97\u5230\u4e86\u4f17\u591a\u5927\u6570\u636e\u516c\u53f8\u7684\u652f\u6301\uff0c\u8fd9\u4e9b\u516c\u53f8\u5305\u62ec Hortonworks\u3001IBM\u3001Intel\u3001Cloudera\u3001MapR\u3001Pivotal\u3001\u767e\u5ea6\u3001\u963f\u91cc\u3001\u817e\u8baf\u3001\u4eac\u4e1c\u3001\u643a\u7a0b\u3001\u4f18\u9177\u571f\u8c46\u3002\u5f53\u524d\u767e\u5ea6\u7684 Spark \u5df2\u5e94\u7528\u4e8e\u5927\u641c\u7d22\u3001\u76f4\u8fbe\u53f7\u3001\u767e\u5ea6\u5927\u6570\u636e\u7b49\u4e1a\u52a1\uff1b\u963f\u91cc\u5229\u7528 GraphX \u6784\u5efa\u4e86\u5927\u89c4\u6a21\u7684\u56fe\u8ba1\u7b97\u548c\u56fe\u6316\u6398\u7cfb\u7edf\uff0c\u5b9e\u73b0\u4e86\u5f88\u591a\u751f\u4ea7\u7cfb\u7edf\u7684\u63a8\u8350\u7b97\u6cd5\uff1b\u817e\u8baf Spark \u96c6\u7fa4\u8fbe\u5230 8000 \u53f0\u7684\u89c4\u6a21\uff0c\u662f\u5f53\u524d\u5df2\u77e5\u7684\u4e16\u754c\u4e0a\u6700\u5927\u7684 Spark \u96c6\u7fa4\u3002</p>"},{"location":"engine/spark/spark_01/#15-spark","title":"1.5 Spark\u7279\u70b9","text":"<ul> <li>\u5feb\uff1a\u4e0e Hadoop \u7684 MapReduce \u76f8\u6bd4\uff0cSpark \u57fa\u4e8e\u5185\u5b58\u7684\u8fd0\u7b97\u8981\u5feb 100 \u500d\u4ee5\u4e0a\uff0c\u57fa\u4e8e\u786c\u76d8\u7684\u8fd0\u7b97\u4e5f\u8981\u5feb 10 \u500d\u4ee5\u4e0a\u3002Spark \u5b9e\u73b0\u4e86\u9ad8\u6548\u7684 DAG \u6267\u884c\u5f15\u64ce\uff0c\u53ef\u4ee5\u901a\u8fc7\u57fa\u4e8e\u5185\u5b58\u6765\u9ad8\u6548\u5904\u7406\u6570\u636e\u6d41\u3002\u8ba1\u7b97\u7684\u4e2d\u95f4\u7ed3\u679c\u662f\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u7684\u3002</li> <li>\u6613\u7528\uff1aSpark \u652f\u6301  Java\u3001Python \u548c Scala \u7684 API\uff0c\u8fd8\u652f\u6301\u8d85\u8fc7 80 \u79cd\u9ad8\u7ea7\u7b97\u6cd5\uff0c\u4f7f\u7528\u6237\u53ef\u4ee5\u5feb\u901f\u6784\u5efa\u4e0d\u540c\u7684\u5e94\u7528\u3002\u800c\u4e14 Spark \u652f\u6301\u4ea4\u4e92\u5f0f\u7684 Python \u548c Scala \u7684 Shell\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u5728\u8fd9\u4e9b Shell \u4e2d\u4f7f\u7528 Spark \u96c6\u7fa4\u6765\u9a8c\u8bc1\u89e3\u51b3\u95ee\u9898\u7684\u65b9\u6cd5\u3002</li> <li>\u901a\u7528\uff1aSpark \u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u89e3\u51b3\u65b9\u6848\u3002Spark \u53ef\u4ee5\u7528\u4e8e\uff0c\u4ea4\u4e92\u5f0f\u67e5\u8be2\uff08Spark\u00a0SQL\uff09\u3001\u5b9e\u65f6\u6d41\u5904\u7406\uff08Spark\u00a0Streaming\uff09\u3001\u673a\u5668\u5b66\u4e60\uff08Spark\u00a0MLlib\uff09\u548c\u56fe\u8ba1\u7b97\uff08GraphX\uff09\u3002\u8fd9\u4e9b\u4e0d\u540c\u7c7b\u578b\u7684\u5904\u7406\u90fd\u53ef\u4ee5\u5728\u540c\u4e00\u4e2a\u5e94\u7528\u4e2d\u65e0\u7f1d\u4f7f\u7528\u3002\u51cf\u5c11\u4e86\u5f00\u53d1\u548c\u7ef4\u62a4\u7684\u4eba\u529b\u6210\u672c\u548c\u90e8\u7f72\u5e73\u53f0\u7684\u7269\u529b\u6210\u672c\u3002</li> <li>\u517c\u5bb9\u6027\uff1aSpark \u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u4e0e\u5176\u4ed6\u7684\u5f00\u6e90\u4ea7\u54c1\u8fdb\u884c\u878d\u5408\u3002\u6bd4\u5982\uff0cSpark \u53ef\u4ee5\u4f7f\u7528 Hadoop \u7684 YARN \u548c Apache\u00a0Mesos \u4f5c\u4e3a\u5b83\u7684\u8d44\u6e90\u7ba1\u7406\u548c\u8c03\u5ea6\u5668\uff0c\u5e76\u4e14\u53ef\u4ee5\u5904\u7406\u6240\u6709 Hadoop \u652f\u6301\u7684\u6570\u636e\uff0c\u5305\u62ec HDFS\u3001HBase \u7b49\u3002\u8fd9\u5bf9\u4e8e\u5df2\u7ecf\u90e8\u7f72 Hadoop \u96c6\u7fa4\u7684\u7528\u6237\u7279\u522b\u91cd\u8981\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u6570\u636e\u8fc1\u79fb\u5c31\u53ef\u4ee5\u4f7f\u7528 Spark \u7684\u5f3a\u5927\u5904\u7406\u80fd\u529b\u3002</li> </ul>"},{"location":"engine/spark/spark_02/","title":"\u7b2c2\u7ae0 Spark\u8fd0\u884c\u6a21\u5f0f","text":"<p>\u90e8\u7f72 Spark \u96c6\u7fa4\u5927\u4f53\u4e0a\u5206\u4e3a\u4e24\u79cd\u6a21\u5f0f\uff1a\u5355\u673a\u6a21\u5f0f\u4e0e\u96c6\u7fa4\u6a21\u5f0f</p> <p>\u5927\u591a\u6570\u5206\u5e03\u5f0f\u6846\u67b6\u90fd\u652f\u6301\u5355\u673a\u6a21\u5f0f\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u8c03\u8bd5\u6846\u67b6\u7684\u8fd0\u884c\u73af\u5883\u3002\u4f46\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5e76\u4e0d\u4f1a\u4f7f\u7528\u5355\u673a\u6a21\u5f0f\u3002\u56e0\u6b64\uff0c\u540e\u7eed\u76f4\u63a5\u6309\u7167\u96c6\u7fa4\u6a21\u5f0f\u90e8\u7f72 Spark \u96c6\u7fa4\u3002</p> <p>\u4e0b\u9762\u8be6\u7ec6\u5217\u4e3e\u4e86 Spark \u76ee\u524d\u652f\u6301\u7684\u90e8\u7f72\u6a21\u5f0f:</p> <ul> <li>Local \u6a21\u5f0f\uff1a\u5728\u672c\u5730\u90e8\u7f72\u5355\u4e2aSpark\u670d\u52a1</li> <li>Standalone \u6a21\u5f0f\uff1aSpark \u81ea\u5e26\u7684\u4efb\u52a1\u8c03\u5ea6\u6a21\u5f0f\u3002\uff08\u56fd\u5185\u5e38\u7528\uff09</li> <li>YARN \u6a21\u5f0f\uff1aSpark \u4f7f\u7528 Hadoop \u7684 YARN \u7ec4\u4ef6\u8fdb\u884c\u8d44\u6e90\u4e0e\u4efb\u52a1\u8c03\u5ea6\u3002\uff08\u56fd\u5185\u6700\u5e38\u7528\uff09</li> <li>Mesos \u6a21\u5f0f\uff1aSpark \u4f7f\u7528 Mesos \u5e73\u53f0\u8fdb\u884c\u8d44\u6e90\u4e0e\u4efb\u52a1\u7684\u8c03\u5ea6\u3002\uff08\u56fd\u5185\u5f88\u5c11\u7528\uff09</li> </ul>"},{"location":"engine/spark/spark_02/#21-spark","title":"2.1 Spark\u5b89\u88c5\u5730\u5740","text":"\u53c2\u8003\u8d44\u6599 \u94fe\u63a5 \u5b98\u7f51\u5730\u5740 \u6587\u6863\u5730\u5740 \u4e0b\u8f7d\u5730\u5740"},{"location":"engine/spark/spark_02/#22-local","title":"2.2 Local\u6a21\u5f0f","text":"<p>Local \u6a21\u5f0f\u5c31\u662f\u8fd0\u884c\u5728\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u7684\u6a21\u5f0f\uff0c\u901a\u5e38\u5c31\u662f\u7528\u4e8e\u5728\u672c\u673a\u4e0a\u7ec3\u624b\u548c\u6d4b\u8bd5\u3002</p>"},{"location":"engine/spark/spark_02/#221","title":"2.2.1 \u5b89\u88c5\u4f7f\u7528","text":"<p>1\uff09\u4e0a\u4f20\u5e76\u89e3\u538b Spark \u5b89\u88c5\u5305</p> <pre><code>tar -zxvf spark-3.1.3-bin-hadoop3.2.tgz -C /opt/module/\nmv spark-3.1.3-bin-hadoop3.2 spark-local\n</code></pre> <p>2\uff09\u5b98\u65b9\u6c42 PI \u6848\u4f8b</p> <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master local[2] \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre> <ul> <li> <p>--class\uff1a\u8868\u793a\u8981\u6267\u884c\u7a0b\u5e8f\u7684\u4e3b\u7c7b\uff1b</p> </li> <li> <p>--master local[2]</p> </li> <li> <ul> <li>local: \u6ca1\u6709\u6307\u5b9a\u7ebf\u7a0b\u6570\uff0c\u5219\u6240\u6709\u8ba1\u7b97\u90fd\u8fd0\u884c\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5f53\u4e2d\uff0c\u6ca1\u6709\u4efb\u4f55\u5e76\u884c\u8ba1\u7b97</li> </ul> </li> <li>local[K]:\u6307\u5b9a\u4f7f\u7528 K \u4e2a Core \u6765\u8fd0\u884c\u8ba1\u7b97\uff0c\u6bd4\u5982 local[2] \u5c31\u662f\u8fd0\u884c 2 \u4e2a Core \u6765\u6267\u884c</li> <li>local[*]\uff1a\u9ed8\u8ba4\u6a21\u5f0f\u3002\u81ea\u52a8\u5e2e\u4f60\u6309\u7167 CPU \u6700\u591a\u6838\u6765\u8bbe\u7f6e\u7ebf\u7a0b\u6570\u3002\u6bd4\u5982 CPU \u6709 8 \u6838\uff0cSpark \u5e2e\u4f60\u81ea\u52a8\u8bbe\u7f6e 8 \u4e2a\u7ebf\u7a0b\u8ba1\u7b97\u3002</li> <li>spark-examples_2.12-3.1.3.jar\uff1a\u8981\u8fd0\u884c\u7684\u7a0b\u5e8f\uff1b</li> <li>10\uff1a\u8981\u8fd0\u884c\u7a0b\u5e8f\u7684\u8f93\u5165\u53c2\u6570\uff08\u8ba1\u7b97\u5706\u5468\u7387 \u03c0 \u7684\u6b21\u6570\uff0c\u8ba1\u7b97\u6b21\u6570\u8d8a\u591a\uff0c\u51c6\u786e\u7387\u8d8a\u9ad8\uff09</li> </ul> <p>3\uff09\u7ed3\u679c\u5c55\u793a</p> <p></p>"},{"location":"engine/spark/spark_02/#222","title":"2.2.2 \u67e5\u770b\u4efb\u52a1\u8fd0\u884c\u8be6\u60c5","text":"<p>1\uff09\u518d\u6b21\u8fd0\u884c\u6c42 PI \u4efb\u52a1\uff0c\u589e\u52a0\u8fed\u4ee3\u6b21\u6570</p> <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master local[2] \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n1000\n</code></pre> <p>2\uff09\u5728\u4efb\u52a1\u8fd0\u884c\u8fd8\u6ca1\u6709\u5b8c\u6210\u65f6\uff0c\u53ef\u767b\u5f55 hadoop102:4040 \u67e5\u770b\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u679c</p> <p></p>"},{"location":"engine/spark/spark_02/#23-standalone","title":"2.3 Standalone\u6a21\u5f0f","text":"<p>Standalone \u6a21\u5f0f\u662f Spark \u81ea\u5e26\u7684\u8d44\u6e90\u8c03\u5ea6\u5f15\u64ce\uff0c\u6784\u5efa\u4e00\u4e2a\u7531 Master + Worker \u6784\u6210\u7684 Spark \u96c6\u7fa4\uff0cSpark \u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u3002 \u8fd9\u4e2a\u8981\u548c Hadoop \u4e2d\u7684 Standalone \u533a\u522b\u5f00\u6765\u3002\u8fd9\u91cc\u7684 Standalone \u662f\u6307\u53ea\u7528 Spark \u6765\u642d\u5efa\u4e00\u4e2a\u96c6\u7fa4\uff0c\u4e0d\u9700\u8981\u501f\u52a9 Hadoop \u7684 Yarn \u548c Mesos \u7b49\u5176\u4ed6\u6846\u67b6\u3002</p>"},{"location":"engine/spark/spark_02/#231","title":"2.3.1\u96c6\u7fa4\u89d2\u8272","text":""},{"location":"engine/spark/spark_02/#2311-masterworker","title":"2.3.1.1 Master\u548cWorker\u2014\u2014\u96c6\u7fa4\u8d44\u6e90\u7ba1\u7406","text":""},{"location":"engine/spark/spark_02/#_1","title":"Spark\u8fd0\u884c\u6a21\u5f0f","text":"<p>Master \u548c Worker \u662f Spark \u7684\u5b88\u62a4\u8fdb\u7a0b\u3001\u96c6\u7fa4\u8d44\u6e90\u7ba1\u7406\u8005\uff0c\u5373 Spark \u5728\u7279\u5b9a\u6a21\u5f0f\uff08Standalone\uff09\u4e0b\u6b63\u5e38\u8fd0\u884c\u5fc5\u987b\u8981\u6709\u7684\u540e\u53f0\u5e38\u9a7b\u8fdb\u7a0b\u3002</p>"},{"location":"engine/spark/spark_02/#2312-driverexecutor","title":"2.3.1.2 Driver\u548cExecutor\u2014\u2014\u4efb\u52a1\u7684\u7ba1\u7406\u8005","text":"<p>Driver \u548c Executor \u662f\u4e34\u65f6\u7a0b\u5e8f\uff0c\u5f53\u6709\u5177\u4f53\u4efb\u52a1\u63d0\u4ea4\u5230 Spark \u96c6\u7fa4\u624d\u4f1a\u5f00\u542f\u7684\u7a0b\u5e8f\u3002</p>"},{"location":"engine/spark/spark_02/#232","title":"2.3.2 \u5b89\u88c5\u4f7f\u7528","text":"<p>1\uff09\u96c6\u7fa4\u89c4\u5212</p> hadoop102 hadoop103 hadoop104 Spark Master\u3001Worker Worker Worker <p>2\uff09\u518d\u89e3\u538b\u4e00\u4efd Spark \u5b89\u88c5\u5305\uff0c\u5e76\u4fee\u6539\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\u540d\u79f0\u4e3a spark-standalone</p> <pre><code>tar -zxvf spark-3.1.3-bin-hadoop3.2.tgz -C /opt/module/\nmv spark-3.1.3-bin-hadoop3.2 spark-standalone\n</code></pre> <p>3\uff09\u8fdb\u5165 Spark \u7684\u914d\u7f6e\u76ee\u5f55 /opt/module/spark-standalone/conf</p> <pre><code>cd conf\n</code></pre> <p>4\uff09\u4fee\u6539 workers \u6587\u4ef6\uff0c\u6dfb\u52a0 work \u8282\u70b9\uff1a</p> <pre><code>mv workers.template workers\nvim workers\n</code></pre> workers<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre> <p>5\uff09\u4fee\u6539 spark-env.sh \u6587\u4ef6\uff0c\u6dfb\u52a0 master \u8282\u70b9</p> <pre><code>mv spark-env.sh.template spark-env.sh\nvim spark-env.sh\n</code></pre> spark-env.sh<pre><code>SPARK_MASTER_HOST=hadoop102\nSPARK_MASTER_PORT=7077\n</code></pre> <p>6\uff09\u5206\u53d1 spark-standalone \u5305</p> <pre><code>xsync spark-standalone/\n</code></pre> <p>7\uff09\u542f\u52a8 spark \u96c6\u7fa4</p> <pre><code>sbin/start-all.sh\n</code></pre> <p>\u67e5\u770b\u4e09\u53f0\u670d\u52a1\u5668\u8fd0\u884c\u8fdb\u7a0b\uff08 xcall.sh \u662f\u4ee5\u524d\u6570\u4ed3\u9879\u76ee\u91cc\u9762\u8bb2\u7684\u811a\u672c\uff09</p> <pre><code>$ xcall.sh jps\n================atguigu@hadoop102================\n3238 Worker\n3163 Master\n================atguigu@hadoop103================\n2908 Worker\n================atguigu@hadoop104================\n2978 Worker\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u9047\u5230 <code>JAVA_HOME not set</code> \u5f02\u5e38\uff0c\u53ef\u4ee5\u5728 sbin \u76ee\u5f55\u4e0b\u7684 spark-config.sh \u6587\u4ef6\u4e2d\u52a0\u5165\u5982\u4e0b\u914d\u7f6e\u3002 spark-config.sh<pre><code>export JAVA_HOME=XXXX\n</code></pre></p> <p>8\uff09\u7f51\u9875\u67e5\u770b\uff1ahadoop102:8080\uff08master web \u7684\u7aef\u53e3\uff0c\u76f8\u5f53\u4e8e Yarn \u76848088\u7aef\u53e3\uff09</p> <p>\u76ee\u524d\u8fd8\u770b\u4e0d\u5230\u4efb\u4f55\u4efb\u52a1\u7684\u6267\u884c\u4fe1\u606f\u3002</p> <p>9\uff09\u5b98\u65b9\u6c42 PI \u6848\u4f8b <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master spark://hadoop102:7077 \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre></p> <p>\u53c2\u6570\uff1a--master spark://hadoop102:7077 \u6307\u5b9a\u8981\u8fde\u63a5\u7684\u96c6\u7fa4\u7684 master\u3002</p> <p>10\uff09\u7ed3\u679c\u67e5\u770b</p> <p>\u9875\u9762\u67e5\u770b http://hadoop102:8080/ \uff0c\u53d1\u73b0\u6267\u884c\u672c\u6b21\u4efb\u52a1\uff0c\u9ed8\u8ba4\u91c7\u7528\u4e09\u53f0\u670d\u52a1\u5668\u8282\u70b9\u7684\u603b\u6838\u6570 24 \u6838\uff0c\u6bcf\u4e2a\u8282\u70b9\u5185\u5b58 1024 M\u3002 - 8080\uff1amaster \u7684 webUI\u3002 - 4040\uff1aapplication \u7684 webUI\u7684\u7aef\u53e3\u53f7\u3002</p> <p></p>"},{"location":"engine/spark/spark_02/#233","title":"2.3.3 \u53c2\u6570\u8bf4\u660e","text":"<p>1\uff09\u914d\u7f6e Executor \u53ef\u7528\u5185\u5b58\u4e3a 2G\uff0c\u4f7f\u7528 CPU \u6838\u6570\u4e3a 2 \u4e2a</p> <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master spark://hadoop102:7077 \\\n--executor-memory 2G \\\n--total-executor-cores 2 \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre> <p>2\uff09\u9875\u9762\u67e5\u770b http://hadoop102:8080/</p> <p></p> <p>3\uff09\u57fa\u672c\u8bed\u6cd5</p> <pre><code>bin/spark-submit \\\n--class &lt;main-class&gt;\n--master &lt;master-url&gt; \\\n... # other options\n&lt;application-jar&gt; \\\n[application-arguments]\n</code></pre> <p>4\uff09\u53c2\u6570\u8bf4\u660e</p> \u53c2\u6570 \u89e3\u91ca \u53ef\u9009\u503c\u4e3e\u4f8b --class Spark \u7a0b\u5e8f\u4e2d\u5305\u542b\u4e3b\u51fd\u6570\u7684\u7c7b --master Spark \u7a0b\u5e8f\u8fd0\u884c\u7684\u6a21\u5f0f \u672c\u5730\u6a21\u5f0f\uff1alocal[*]\u3001spark://hadoop102:7077\u3001Yarn --executor-memory 1G \u6307\u5b9a\u6bcf\u4e2a executor \u53ef\u7528\u5185\u5b58\u4e3a 1G \u7b26\u5408\u96c6\u7fa4\u5185\u5b58\u914d\u7f6e\u5373\u53ef\uff0c\u5177\u4f53\u60c5\u51b5\u5177\u4f53\u5206\u6790\u3002 --total-executor-cores 2 \u6307\u5b9a\u6240\u6709 executor \u4f7f\u7528\u7684 cpu \u6838\u6570\u4e3a 2 \u4e2a application-jar \u6253\u5305\u597d\u7684\u5e94\u7528 jar\uff0c\u5305\u542b\u4f9d\u8d56\u3002\u8fd9\u4e2a URL \u5728\u96c6\u7fa4\u4e2d\u5168\u5c40\u53ef\u89c1\u3002 \u6bd4\u5982 hdfs:// \u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u5982\u679c\u662f file:// path\uff0c\u90a3\u4e48\u6240\u6709\u7684\u8282\u70b9\u7684 path \u90fd\u5305\u542b\u540c\u6837\u7684 jar application-arguments \u4f20\u7ed9 main() \u65b9\u6cd5\u7684\u53c2\u6570"},{"location":"engine/spark/spark_02/#234","title":"2.3.4 \u914d\u7f6e\u5386\u53f2\u670d\u52a1","text":"<p>\u7531\u4e8e spark \u4efb\u52a1\u505c\u6b62\u6389\u540e\uff0chadoop102:4040 \u9875\u9762\u5c31\u770b\u4e0d\u5230\u5386\u53f2\u4efb\u52a1\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u6240\u4ee5\u5f00\u53d1\u65f6\u90fd\u914d\u7f6e\u5386\u53f2\u670d\u52a1\u5668\u8bb0\u5f55\u4efb\u52a1\u8fd0\u884c\u60c5\u51b5\u3002</p> <p>1\uff09\u4fee\u6539 spark-default.conf.template \u540d\u79f0</p> <pre><code> mv spark-defaults.conf.template spark-defaults.conf\n</code></pre> <p>2\uff09\u4fee\u6539 spark-default.conf \u6587\u4ef6\uff0c\u914d\u7f6e\u65e5\u5fd7\u5b58\u50a8\u8def\u5f84\uff08\u5199\uff09</p> <pre><code>vim spark-defaults.conf\n</code></pre> spark-defaults.conf<pre><code>spark.eventLog.enabled          true\nspark.eventLog.dir              hdfs://hadoop102:8020/directory\n</code></pre> <p>\u6ce8\u610f</p> <p>\u9700\u8981\u542f\u52a8 Hadoop \u96c6\u7fa4\uff0cHDFS \u4e0a\u7684\u76ee\u5f55\u9700\u8981\u63d0\u524d\u5b58\u5728\u3002</p> <pre><code>sbin/start-dfs.sh\nhadoop fs -mkdir /directory\n</code></pre> <p>3\uff09\u4fee\u6539spark-env.sh\u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a <pre><code>vim spark-env.sh\n</code></pre></p> spark-env.sh<pre><code>export SPARK_HISTORY_OPTS=\"\n-Dspark.history.ui.port=18080 \n-Dspark.history.fs.logDirectory=hdfs://hadoop102:8020/directory \n-Dspark.history.retainedApplications=30\"\n</code></pre> <ul> <li>\u53c2\u6570 1 \u542b\u4e49\uff1aWEBUI \u8bbf\u95ee\u7684\u7aef\u53e3\u53f7\u4e3a 18080</li> <li>\u53c2\u6570 2 \u542b\u4e49\uff1a\u6307\u5b9a\u5386\u53f2\u670d\u52a1\u5668\u65e5\u5fd7\u5b58\u50a8\u8def\u5f84\uff08\u8bfb\uff09</li> <li>\u53c2\u6570 3 \u542b\u4e49\uff1a\u6307\u5b9a\u4fdd\u5b58 Application \u5386\u53f2\u8bb0\u5f55\u7684\u4e2a\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u65e7\u7684\u5e94\u7528\u7a0b\u5e8f\u4fe1\u606f\u5c06\u88ab\u5220\u9664\uff0c\u8fd9\u4e2a\u662f\u5185\u5b58\u4e2d\u7684\u5e94\u7528\u6570\uff0c\u800c\u4e0d\u662f\u9875\u9762\u4e0a\u663e\u793a\u7684\u5e94\u7528\u6570\u3002</li> </ul> <p>4\uff09\u5206\u53d1\u914d\u7f6e\u6587\u4ef6 <pre><code>xsync spark-defaults.conf spark-env.sh\n</code></pre> 5\uff09\u542f\u52a8\u5386\u53f2\u670d\u52a1 <pre><code>sbin/start-history-server.sh\n</code></pre></p> <p>6\uff09\u518d\u6b21\u6267\u884c\u4efb\u52a1 <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master spark://hadoop102:7077 \\\n--executor-memory 1G \\\n--total-executor-cores 2 \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre></p> <p>7\uff09\u67e5\u770b Spark \u5386\u53f2\u670d\u52a1\u5730\u5740\uff1ahadoop102:18080</p> <p></p>"},{"location":"engine/spark/spark_02/#235-ha","title":"2.3.5 \u914d\u7f6e\u9ad8\u53ef\u7528\uff08HA\uff09","text":"<p>1\uff09\u9ad8\u53ef\u7528\u539f\u7406</p> <p></p> <p>2\uff09\u914d\u7f6e\u9ad8\u53ef\u7528</p> <p>\uff080\uff09\u505c\u6b62\u96c6\u7fa4</p> <pre><code>sbin/stop-all.sh\n</code></pre> <p>\uff081\uff09Zookeeper\u6b63\u5e38\u5b89\u88c5\u5e76\u542f\u52a8\uff08\u57fa\u4e8e\u4ee5\u524d\u8bb2\u7684\u6570\u4ed3\u9879\u76ee\u811a\u672c\uff09</p> <pre><code> zk.sh start\n</code></pre> <p>\uff082\uff09\u4fee\u6539spark-env.sh\u6587\u4ef6\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a</p> spark-env.sh<pre><code>#\u6ce8\u91ca\u6389\u5982\u4e0b\u5185\u5bb9\uff1a\n#SPARK_MASTER_HOST=hadoop102\n#SPARK_MASTER_PORT=7077\n\n#\u6dfb\u52a0\u4e0a\u5982\u4e0b\u5185\u5bb9\u3002\u914d\u7f6e\u7531Zookeeper\u7ba1\u7406Master\uff0c\u5728Zookeeper\u8282\u70b9\u4e2d\u81ea\u52a8\u521b\u5efa/spark\u76ee\u5f55\uff0c\u7528\u4e8e\u7ba1\u7406\uff1a\nexport SPARK_DAEMON_JAVA_OPTS=\"\n-Dspark.deploy.recoveryMode=ZOOKEEPER \n-Dspark.deploy.zookeeper.url=hadoop102,hadoop103,hadoop104 \n-Dspark.deploy.zookeeper.dir=/spark\"\n\n#\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\n#Zookeeper3.5\u7684AdminServer\u9ed8\u8ba4\u7aef\u53e3\u662f8080\uff0c\u548cSpark\u7684WebUI\u51b2\u7a81\nexport SPARK_MASTER_WEBUI_PORT=8989\n</code></pre> <p>\uff083\uff09\u5206\u53d1\u914d\u7f6e\u6587\u4ef6</p> <pre><code>xsync spark-env.sh\n</code></pre> <p>\uff084\uff09\u5728 hadoop102 \u4e0a\u542f\u52a8\u5168\u90e8\u8282\u70b9</p> <pre><code>sbin/start-all.sh\n</code></pre> <p>\uff085\uff09\u5728 hadoop103 \u4e0a\u5355\u72ec\u542f\u52a8 master \u8282\u70b9</p> <pre><code>sbin/start-master.sh\n</code></pre> <p>3\uff09\u9ad8\u53ef\u7528\u6d4b\u8bd5</p> <p></p> <p></p> <p>\u200b   \uff081\uff09\u67e5\u770b hadoop102 \u7684 master \u8fdb\u7a0b</p> <pre><code>$ jps\n5506 Worker\n5394 Master\n5731 SparkSubmit\n4869 QuorumPeerMain\n5991 Jps\n5831 CoarseGrainedExecutorBackend\n</code></pre> <p>\uff082\uff09Kill \u6389 hadoop102 \u7684 master \u8fdb\u7a0b\uff0c\u9875\u9762\u4e2d\u89c2\u5bdf http://hadoop103:8080/ \u7684\u72b6\u6001\u662f\u5426\u5207\u6362\u4e3a active\u3002</p> <p></p> <pre><code>kill -9 5394\n</code></pre> <p>\uff083\uff09\u518d\u542f\u52a8 hadoop102 \u7684 master \u8fdb\u7a0b</p> <pre><code>sbin/start-master.sh\n</code></pre>"},{"location":"engine/spark/spark_02/#236","title":"2.3.6 \u8fd0\u884c\u6d41\u7a0b","text":"<p>Spark \u6709 standalone-client \u548c standalone-cluster \u4e24\u79cd\u6a21\u5f0f\uff0c\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff1aDriver \u7a0b\u5e8f\u7684\u8fd0\u884c\u8282\u70b9\u3002</p> <p>1\uff09\u5ba2\u6237\u7aef\u6a21\u5f0f</p> <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master spark://hadoop102:7077,hadoop103:7077 \\\n--executor-memory 2G \\\n--total-executor-cores 2 \\\n--deploy-mode client \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre> <p>--deploy-mode client\uff0c\u8868\u793a Driver \u7a0b\u5e8f\u8fd0\u884c\u5728\u672c\u5730\u5ba2\u6237\u7aef\uff0c\u9ed8\u8ba4\u6a21\u5f0f\u3002</p> <p></p> <p>2\uff09\u96c6\u7fa4\u6a21\u5f0f</p> <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master spark://hadoop102:7077,hadoop103:7077 \\\n--executor-memory 2G \\\n--total-executor-cores 2 \\\n--deploy-mode cluster \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre> <p>--deploy-mode cluster\uff0c\u8868\u793a Driver \u7a0b\u5e8f\u8fd0\u884c\u5728\u96c6\u7fa4\u3002</p> <p></p> <p>\u200b   \uff081\uff09\u67e5\u770b http://hadoop102:8989/ \u9875\u9762\uff0c\u70b9\u51fb Completed Drivers \u91cc\u9762\u7684 Worker\u3002</p> <p></p> <p>\uff082\uff09\u8df3\u8f6c\u5230 Spark Worker \u9875\u9762\uff0c\u70b9\u51fb Finished Drivers \u4e2d Logs \u4e0b\u9762\u7684 stdout\u3002</p> <p></p> <p>\uff083\uff09\u6700\u7ec8\u6253\u5370\u7ed3\u679c\u5982\u4e0b\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>\u5728\u6d4b\u8bd5 Standalone \u6a21\u5f0f\uff0ccluster \u8fd0\u884c\u6d41\u7a0b\u7684\u65f6\u5019\uff0c\u963f\u91cc\u4e91\u7528\u6237\u8bbf\u95ee\u4e0d\u5230 Worker\uff0c\u56e0\u4e3a Worker \u662f\u4ece Master \u5185\u90e8\u8df3\u8f6c\u7684\uff0c\u8fd9\u662f\u6b63\u5e38\u7684\uff0c\u5b9e\u9645\u5de5\u4f5c\u4e2d\u6211\u4eec\u4e0d\u53ef\u80fd\u901a\u8fc7\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\uff0c\u8fd9\u4e9b\u7aef\u53e3\u5bf9\u5916\u90fd\u4f1a\u7981\u7528\uff0c\u9700\u8981\u7684\u65f6\u5019\u4f1a\u901a\u8fc7\u6388\u6743\u5230 Master \u8bbf\u95ee Worker</p>"},{"location":"engine/spark/spark_02/#24-yarn","title":"2.4 Yarn\u6a21\u5f0f\uff08\u91cd\u70b9\uff09","text":"<p>Spark \u5ba2\u6237\u7aef\u76f4\u63a5\u8fde\u63a5 Yarn\uff0c\u4e0d\u9700\u8981\u989d\u5916\u6784\u5efa Spark \u96c6\u7fa4\u3002</p>"},{"location":"engine/spark/spark_02/#241","title":"2.4.1 \u5b89\u88c5\u4f7f\u7528","text":"<p>0\uff09\u505c\u6b62 Standalone \u6a21\u5f0f\u4e0b\u7684 spark \u96c6\u7fa4 <pre><code>sbin/stop-all.sh\nzk.sh stop\nsbin/stop-master.sh\n</code></pre></p> <p>1\uff09\u4e3a\u4e86\u9632\u6b62\u548c Standalone \u6a21\u5f0f\u51b2\u7a81\uff0c\u518d\u5355\u72ec\u89e3\u538b\u4e00\u4efd spark <pre><code>tar -zxvf spark-3.1.3-bin-hadoop3.2.tgz -C /opt/module/\n</code></pre></p> <p>2\uff09\u8fdb\u5165\u5230 /opt/module \u76ee\u5f55\uff0c\u4fee\u6539 spark-3.1.3-bin-hadoop3.2 \u540d\u79f0\u4e3a spark-yarn <pre><code>mv spark-3.1.3-bin-hadoop3.2/ spark-yarn\n</code></pre></p> <p>3\uff09\u4fee\u6539 hadoop \u914d\u7f6e\u6587\u4ef6 /opt/module/hadoop/etc/hadoop/yarn-site.xml\uff0c\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> <p>\u56e0\u4e3a\u6d4b\u8bd5\u73af\u5883\u865a\u62df\u673a\u5185\u5b58\u8f83\u5c11\uff0c\u9632\u6b62\u6267\u884c\u8fc7\u7a0b\u8fdb\u884c\u88ab\u610f\u5916\u6740\u6b7b\uff0c\u505a\u5982\u4e0b\u914d\u7f6e</p> yarn-site.xml<pre><code>&lt;!--\u662f\u5426\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u68c0\u67e5\u6bcf\u4e2a\u4efb\u52a1\u6b63\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\u91cf\uff0c\u5982\u679c\u4efb\u52a1\u8d85\u51fa\u5206\u914d\u503c\uff0c\u5219\u76f4\u63a5\u5c06\u5176\u6740\u6389\uff0c\u9ed8\u8ba4\u662ftrue --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.pmem-check-enabled&lt;/name&gt;\n&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!--\u662f\u5426\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u68c0\u67e5\u6bcf\u4e2a\u4efb\u52a1\u6b63\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u91cf\uff0c\u5982\u679c\u4efb\u52a1\u8d85\u51fa\u5206\u914d\u503c\uff0c\u5219\u76f4\u63a5\u5c06\u5176\u6740\u6389\uff0c\u9ed8\u8ba4\u662ftrue --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;\n&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>4\uff09\u5206\u53d1\u914d\u7f6e\u6587\u4ef6 <pre><code>xsync /opt/module/hadoop/etc/hadoop/yarn-site.xml\n</code></pre></p> <p>5\uff09\u4fee\u6539 /opt/module/spark-yarn/conf/spark-env.sh\uff0c\u6dfb\u52a0 YARN_CONF_DIR \u914d\u7f6e\uff0c\u4fdd\u8bc1\u540e\u7eed\u8fd0\u884c\u4efb\u52a1\u7684\u8def\u5f84\u90fd\u53d8\u6210\u96c6\u7fa4\u8def\u5f84 <pre><code>mv spark-env.sh.template spark-env.sh\n</code></pre></p> spark-env.sh<pre><code>YARN_CONF_DIR=/opt/module/hadoop/etc/hadoop\n</code></pre> <p>6\uff09\u542f\u52a8 HDFS \u4ee5\u53ca YARN \u96c6\u7fa4 <pre><code>sbin/start-dfs.sh\nsbin/start-yarn.sh\n</code></pre></p> <p>7\uff09\u6267\u884c\u4e00\u4e2a\u7a0b\u5e8f <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master yarn \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre></p> <p>\u53c2\u6570\uff1a--master yarn\uff0c\u8868\u793a Yarn \u65b9\u5f0f\u8fd0\u884c\uff1b--deploy-mode \u8868\u793a\u5ba2\u6237\u7aef\u65b9\u5f0f\u8fd0\u884c\u7a0b\u5e8f</p> <p>8\uff09\u67e5\u770b hadoop103:8088 \u9875\u9762\uff0c\u70b9\u51fb History\uff0c\u67e5\u770b\u5386\u53f2\u9875\u9762</p> <p></p> <p>\u601d\u8003</p> <p>\u76ee\u524d\u662f Hadoop \u7684\u4f5c\u4e1a\u8fd0\u884c\u65e5\u5fd7\u5c55\u793a\uff0c\u5982\u679c\u60f3\u83b7\u53d6 Spark \u7684\u4f5c\u4e1a\u8fd0\u884c\u65e5\u5fd7\uff0c\u600e\u4e48\u529e\uff1f </p>"},{"location":"engine/spark/spark_02/#242","title":"2.4.2 \u914d\u7f6e\u5386\u53f2\u670d\u52a1","text":"<p>\u7531\u4e8e\u662f\u91cd\u65b0\u89e3\u538b\u7684 Spark \u538b\u7f29\u6587\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u9488\u5bf9 Yarn \u6a21\u5f0f\uff0c\u518d\u6b21\u914d\u7f6e\u4e00\u4e0b\u5386\u53f2\u670d\u52a1\u5668\u3002</p> <p>1\uff09\u4fee\u6539 spark-default.conf.template \u540d\u79f0 <pre><code>mv spark-defaults.conf.template spark-defaults.conf\n</code></pre></p> <p>2\uff09\u4fee\u6539 spark-defaults.conf \u6587\u4ef6\uff0c\u914d\u7f6e\u65e5\u5fd7\u5b58\u50a8\u8def\u5f84\uff08\u5199\uff09 spark-defaults.conf<pre><code>spark.eventLog.enabled          true\nspark.eventLog.dir               hdfs://hadoop102:8020/directory\n</code></pre></p> <p>3\uff09\u4fee\u6539 spark-env.sh \u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a spark-env.sh<pre><code>export SPARK_HISTORY_OPTS=\"\n-Dspark.history.ui.port=18080 \n-Dspark.history.fs.logDirectory=hdfs://hadoop102:8020/directory \n-Dspark.history.retainedApplications=30\"\n</code></pre></p> <ul> <li>\u53c2\u6570 1 \u542b\u4e49\uff1aWEBUI \u8bbf\u95ee\u7684\u7aef\u53e3\u53f7\u4e3a 18080</li> <li>\u53c2\u6570 2 \u542b\u4e49\uff1a\u6307\u5b9a\u5386\u53f2\u670d\u52a1\u5668\u65e5\u5fd7\u5b58\u50a8\u8def\u5f84\uff08\u8bfb\uff09</li> <li>\u53c2\u6570 3 \u542b\u4e49\uff1a\u6307\u5b9a\u4fdd\u5b58 Application \u5386\u53f2\u8bb0\u5f55\u7684\u4e2a\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u65e7\u7684\u5e94\u7528\u7a0b\u5e8f\u4fe1\u606f\u5c06\u88ab\u5220\u9664\uff0c\u8fd9\u4e2a\u662f\u5185\u5b58\u4e2d\u7684\u5e94\u7528\u6570\uff0c\u800c\u4e0d\u662f\u9875\u9762\u4e0a\u663e\u793a\u7684\u5e94\u7528\u6570\u3002</li> </ul>"},{"location":"engine/spark/spark_02/#243","title":"2.4.3 \u914d\u7f6e\u67e5\u770b\u5386\u53f2\u65e5\u5fd7","text":"<p>\u4e3a\u4e86\u80fd\u4ece Yarn \u4e0a\u5173\u8054\u5230 spark \u5386\u53f2\u670d\u52a1\u5668\uff0c\u9700\u8981\u914d\u7f6e spark \u5386\u53f2\u670d\u52a1\u5668\u5173\u8054\u8def\u5f84\u3002 \u76ee\u7684\uff1a\u70b9\u51fb yarn\uff088088\uff09\u4e0a spark \u4efb\u52a1\u7684 history \u6309\u94ae\uff0c\u8fdb\u5165\u7684\u662f spark \u5386\u53f2\u670d\u52a1\u5668\uff0818080\uff09\uff0c\u800c\u4e0d\u518d\u662f yarn \u5386\u53f2\u670d\u52a1\u5668\uff0819888\uff09\u3002</p> <p>1\uff09\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 /opt/module/spark-yarn/conf/spark-defaults.conf</p> <p>\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a spark-defaults.conf<pre><code>spark.yarn.historyServer.address=hadoop102:18080\nspark.history.ui.port=18080\n</code></pre></p> <p>2\uff09\u91cd\u542f Spark \u5386\u53f2\u670d\u52a1</p> <pre><code>sbin/stop-history-server.sh \nsbin/start-history-server.sh </code></pre> <p>3\uff09\u63d0\u4ea4\u4efb\u52a1\u5230 Yarn \u6267\u884c <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master yarn \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre></p> <p>4\uff09Web \u9875\u9762\u67e5\u770b\u65e5\u5fd7\uff1ahttp://hadoop103:8088/cluster</p> <p></p> <p>\u70b9\u51fb <code>history</code> \u8df3\u8f6c\u5230 http://hadoop102:18080/</p> <p></p>"},{"location":"engine/spark/spark_02/#244","title":"2.4.4 \u8fd0\u884c\u6d41\u7a0b","text":"<p>Spark \u6709 yarn-client \u548c yarn-cluster \u4e24\u79cd\u6a21\u5f0f\uff0c\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff1aDriver \u7a0b\u5e8f\u7684\u8fd0\u884c\u8282\u70b9\u3002</p> <ul> <li>yarn-client\uff1aDriver \u7a0b\u5e8f\u8fd0\u884c\u5728\u5ba2\u6237\u7aef\uff0c\u9002\u7528\u4e8e\u4ea4\u4e92\u3001\u8c03\u8bd5\uff0c\u5e0c\u671b\u7acb\u5373\u770b\u5230 app \u7684\u8f93\u51fa\u3002</li> <li>yarn-cluster\uff1aDriver \u7a0b\u5e8f\u8fd0\u884c\u5728\u7531 ResourceManager \u542f\u52a8\u7684 APPMaster\uff0c\u9002\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002</li> </ul> <p>1\uff09\u5ba2\u6237\u7aef\u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09</p> <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master yarn \\\n--deploy-mode client \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre> <p></p> <p>2\uff09\u96c6\u7fa4\u6a21\u5f0f</p> <pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master yarn \\\n--deploy-mode cluster \\\n./examples/jars/spark-examples_2.12-3.1.3.jar \\\n10\n</code></pre> <p>\uff081\uff09\u67e5\u770b http://hadoop103:8088/cluster \u9875\u9762\uff0c\u70b9\u51fb History \u6309\u94ae\uff0c\u8df3\u8f6c\u5230\u5386\u53f2\u8be6\u60c5\u9875\u9762</p> <p></p> <p>\uff082\uff09http://hadoop102:18080 \u70b9\u51fb Executors -&gt; \u70b9\u51fb driver \u4e2d\u7684 stdout</p> <p></p> <p></p> <p></p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u5728 Yarn \u65e5\u5fd7\u7aef\u65e0\u6cd5\u67e5\u770b\u5230\u5177\u4f53\u7684\u65e5\u5fd7\uff0c\u5219\u5728 yarn-site.xml \u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u5e76\u542f\u52a8 Yarn \u5386\u53f2\u670d\u52a1\u5668</p> <p></p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.log.server.url&lt;/name&gt;\n&lt;value&gt;http://hadoop102:19888/jobhistory/logs&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u6ce8\u610f</p> <p>hadoop \u5386\u53f2\u670d\u52a1\u5668\u4e5f\u8981\u542f\u52a8 mr-jobhistory-daemon.sh start historyserver</p> <p></p>"},{"location":"engine/spark/spark_02/#25-mesos","title":"2.5 Mesos\u6a21\u5f0f\uff08\u4e86\u89e3\uff09","text":"<p>Spark \u5ba2\u6237\u7aef\u76f4\u63a5\u8fde\u63a5 Mesos\uff1b\u4e0d\u9700\u8981\u989d\u5916\u6784\u5efa Spark \u96c6\u7fa4\u3002\u56fd\u5185\u5e94\u7528\u6bd4\u8f83\u5c11\uff0c\u66f4\u591a\u7684\u662f\u8fd0\u7528 Yarn \u8c03\u5ea6\u3002</p>"},{"location":"engine/spark/spark_02/#26","title":"2.6 \u51e0\u79cd\u6a21\u5f0f\u5bf9\u6bd4","text":"\u6a21\u5f0f Spark\u5b89\u88c5\u673a\u5668\u6570 \u9700\u542f\u52a8\u7684\u8fdb\u7a0b \u6240\u5c5e\u8005 Local 1 \u65e0 Spark Standalone 3 Master\u53caWorker Spark Yarn 1 Yarn\u53caHDFS Hadoop"},{"location":"engine/spark/spark_02/#27","title":"2.7 \u7aef\u53e3\u53f7\u603b\u7ed3","text":"<ol> <li>Spark \u67e5\u770b\u5f53\u524d Spark-shell \u8fd0\u884c\u4efb\u52a1\u60c5\u51b5\u7aef\u53e3\u53f7\uff1a4040</li> <li>Spark Master \u5185\u90e8\u901a\u4fe1\u670d\u52a1\u7aef\u53e3\u53f7\uff1a7077  \uff08\u7c7b\u6bd4\u4e8e Yarn \u7684 8032 \u7aef\u53e3\uff08 RM \u548c NM \u7684\u5185\u90e8\u901a\u4fe1\uff09\uff09</li> <li>Spark Standalone \u6a21\u5f0f Master Web \u7aef\u53e3\u53f7\uff1a8080\uff08\u7c7b\u6bd4\u4e8e Hadoop Yarn \u4efb\u52a1\u8fd0\u884c\u60c5\u51b5\u67e5\u770b\u7aef\u53e3\u53f7\uff1a8088\uff09</li> <li>Spark \u5386\u53f2\u670d\u52a1\u5668\u7aef\u53e3\u53f7\uff1a18080     \uff08\u7c7b\u6bd4\u4e8e Hadoop \u5386\u53f2\u670d\u52a1\u5668\u7aef\u53e3\u53f7\uff1a19888\uff09</li> </ol>"},{"location":"engine/spark/spark_03/","title":"\u7b2c3\u7ae0 RDD\u6982\u8ff0","text":""},{"location":"engine/spark/spark_03/#31-rdd","title":"3.1 \u4ec0\u4e48\u662fRDD","text":"<p>RDD\uff08 Resilient Distributed Dataset \uff09\u53eb\u505a\u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6\uff0c\u662f Spark \u4e2d\u6700\u57fa\u672c\u7684\u6570\u636e\u62bd\u8c61\u3002</p> <p>\u4ee3\u7801\u4e2d\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5b83\u4ee3\u8868\u4e00\u4e2a\u5f39\u6027\u7684\u3001\u4e0d\u53ef\u53d8\u3001\u53ef\u5206\u533a\u3001\u91cc\u9762\u7684\u5143\u7d20\u53ef\u5e76\u884c\u8ba1\u7b97\u7684\u96c6\u5408\u3002</p> <p> </p> RDD\u7c7b\u6bd4\u5de5\u5382\u751f\u4ea7"},{"location":"engine/spark/spark_03/#32-rdd","title":"3.2 RDD\u4e94\u5927\u7279\u6027","text":""},{"location":"engine/spark/spark_04/","title":"\u7b2c4\u7ae0 RDD\u7f16\u7a0b","text":""},{"location":"engine/spark/spark_04/#41-rdd","title":"4.1 RDD\u7684\u521b\u5efa","text":"<p>\u5728 Spark \u4e2d RDD \u7684\u521b\u5efa\u65b9\u5f0f\u53ef\u4ee5\u5206\u4e3a\u4e09\u79cd\uff1a</p> <ol> <li>\u4ece\u96c6\u5408\u4e2d\u521b\u5efa RDD</li> <li>\u4ece\u5916\u90e8\u5b58\u50a8\u521b\u5efa RDD</li> <li>\u4ece\u5176\u4ed6 RDD \u521b\u5efa</li> </ol>"},{"location":"engine/spark/spark_04/#411-idea","title":"4.1.1 IDEA\u73af\u5883\u51c6\u5907","text":"<p>1\uff09\u521b\u5efa\u4e00\u4e2a maven \u5de5\u7a0b\uff0c\u5de5\u7a0b\u540d\u79f0\u53eb SparkCore</p> <p></p> <p>2\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.createrdd</p> <p>3\uff09\u5728 pom \u6587\u4ef6\u4e2d\u6dfb\u52a0 spark-core \u7684\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-core_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>4\uff09\u5982\u679c\u4e0d\u5e0c\u671b\u8fd0\u884c\u65f6\u6253\u5370\u5927\u91cf\u65e5\u5fd7\uff0c\u53ef\u4ee5\u5728 resources \u6587\u4ef6\u5939\u4e2d\u6dfb\u52a0 log4j.properties \u6587\u4ef6\uff0c\u5e76\u6dfb\u52a0\u65e5\u5fd7\u914d\u7f6e\u4fe1\u606f</p> log4j.properties<pre><code>log4j.rootCategory=ERROR, console\nlog4j.appender.console=org.apache.log4j.ConsoleAppender\nlog4j.appender.console.target=System.err\nlog4j.appender.console.layout=org.apache.log4j.PatternLayout\nlog4j.appender.console.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss} %p %c{1}: %m%n\n\n# Set the default spark-shell log level to ERROR. When running the spark-shell, the\n# log level for this class is used to overwrite the root logger's log level, so that\n# the user can have different defaults for the shell and regular Spark apps.\nlog4j.logger.org.apache.spark.repl.Main=ERROR\n\n# Settings to quiet third party logs that are too verbose\nlog4j.logger.org.spark_project.jetty=ERROR\nlog4j.logger.org.spark_project.jetty.util.component.AbstractLifeCycle=ERROR\nlog4j.logger.org.apache.spark.repl.SparkIMain$exprTyper=ERROR\nlog4j.logger.org.apache.spark.repl.SparkILoop$SparkILoopInterpreter=ERROR\nlog4j.logger.org.apache.parquet=ERROR\nlog4j.logger.parquet=ERROR\n\n# SPARK-9183: Settings to avoid annoying messages when looking up nonexistent UDFs in SparkSQL with Hive support\nlog4j.logger.org.apache.hadoop.hive.metastore.RetryingHMSHandler=FATAL\nlog4j.logger.org.apache.hadoop.hive.ql.exec.FunctionRegistry=ERROR\n</code></pre>"},{"location":"engine/spark/spark_04/#412-idea","title":"4.1.2 \u521b\u5efaIDEA\u5feb\u6377\u952e","text":"<p>1\uff09\u70b9\u51fbFile -&gt; Settings\u2026 -&gt; Editor -&gt; Live Templates -&gt; output -&gt; Live Template</p> <p></p> <p></p> <p>2\uff09\u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 Define -&gt; \u9009\u62e9 JAVA</p> <p></p> <p>3\uff09\u5728 Abbreviation \u4e2d\u8f93\u5165\u5feb\u6377\u952e\u540d\u79f0 sc\uff0c\u5728 Template text \u4e2d\u586b\u5199\uff0c\u8f93\u5165\u5feb\u6377\u952e\u540e\u751f\u6210\u7684\u5185\u5bb9\u3002</p> <p></p> <pre><code>// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\n\n// 4. \u5173\u95edsc\nsc.stop();\n</code></pre>"},{"location":"engine/spark/spark_04/#413","title":"4.1.3 \u5f02\u5e38\u5904\u7406","text":"<p>\u5982\u679c\u672c\u673a\u64cd\u4f5c\u7cfb\u7edf\u662f Windows\uff0c\u5982\u679c\u5728\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u4e86 Hadoop \u76f8\u5173\u7684\u4e1c\u897f\uff0c\u6bd4\u5982\u5199\u5165\u6587\u4ef6\u5230 HDFS\uff0c\u5219\u4f1a\u9047\u5230\u5982\u4e0b\u5f02\u5e38\uff1a</p> <p></p> <p>\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\uff0c\u5e76\u4e0d\u662f\u7a0b\u5e8f\u7684\u9519\u8bef\uff0c\u800c\u662f\u7528\u5230\u4e86 Hadoop \u76f8\u5173\u7684\u670d\u52a1\uff0c\u89e3\u51b3\u529e\u6cd5</p> <p>1\uff09\u914d\u7f6e HADOOP_HOME \u73af\u5883\u53d8\u91cf 2\uff09\u5728 IDEA \u4e2d\u914d\u7f6e Run Configuration\uff0c\u6dfb\u52a0 HADOOP_HOME \u53d8\u91cf</p> <p></p> <p></p> <p>\u5982\u679c\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u662f\u56e0\u4e3a windows \u4e0a\u9762\u7684 hadoop \u6743\u9650\u4e0d\u591f\u3002</p> <pre><code>Exception in thread \"main\" java.lang.UnsatisfiedLinkError: org.apache.hadoop.io.nativeio.NativeIO$Windows.access0(Ljava/lang/String;I)Z\n    at org.apache.hadoop.io.nativeio.NativeIO$Windows.access0(Native Method)\nat org.apache.hadoop.io.nativeio.NativeIO$Windows.access(NativeIO.java:645)\nat org.apache.hadoop.fs.FileUtil.canRead(FileUtil.java:1230)\nat org.apache.hadoop.fs.FileUtil.list(FileUtil.java:1435)\nat org.apache.hadoop.fs.RawLocalFileSystem.listStatus(RawLocalFileSystem.java:493)\nat org.apache.hadoop.fs.FileSystem.listStatus(FileSystem.java:1868)\nat org.apache.hadoop.fs.FileSystem.listStatus(FileSystem.java:1910)\nat org.apache.hadoop.fs.FileSystem$4.&lt;init&gt;(FileSystem.java:2072)\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5\u662f\u628a\u5b89\u88c5\u5728 windows \u4e0a\u9762\u7684 hadoop \u7684 bin \u6587\u4ef6\u5939\u4e2d\u7684 hadoop.dll \u590d\u5236\u5230 C:\\Windows\\System32 \u6587\u4ef6\u5939\u4e2d\u3002</p> <p></p> <p></p>"},{"location":"engine/spark/spark_04/#414","title":"4.1.4 \u4ece\u96c6\u5408\u4e2d\u521b\u5efa","text":"<p>1\uff09\u4ece\u96c6\u5408\u4e2d\u521b\u5efa RDD\uff1aparallelize</p> <pre><code>package com.atguigu.createrdd;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.Arrays;\nimport java.util.List;\n\npublic class Test01_List {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; stringRDD = sc.parallelize(Arrays.asList(\"hello\", \"spark\"));\n\nList&lt;String&gt; result = stringRDD.collect();\n\nfor (String s : result) {\nSystem.out.println(s);\n}\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#415","title":"4.1.5 \u4ece\u5916\u90e8\u5b58\u50a8\u7cfb\u7edf\u7684\u6570\u636e\u96c6\u521b\u5efa","text":"<p>\u7531\u5916\u90e8\u5b58\u50a8\u7cfb\u7edf\u7684\u6570\u636e\u96c6\u521b\u5efa RDD \u5305\u62ec\uff1a\u672c\u5730\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u8fd8\u6709\u6240\u6709 Hadoop \u652f\u6301\u7684\u6570\u636e\u96c6\uff0c\u6bd4\u5982 HDFS\u3001HBase \u7b49\u3002</p> <p>1\uff09\u6570\u636e\u51c6\u5907</p> <p>\u5728\u65b0\u5efa\u7684 SparkCore \u9879\u76ee\u540d\u79f0\u4e0a\u53f3\u952e =\u300b \u65b0\u5efa input \u6587\u4ef6\u5939 =\u300b \u5728 input \u6587\u4ef6\u5939\u4e0a\u53f3\u952e =\u300b \u5206\u522b\u65b0\u5efa 1.txt \u548c 2.txt \u3002\u6bcf\u4e2a\u6587\u4ef6\u91cc\u9762\u51c6\u5907\u4e00\u4e9b word \u5355\u8bcd\u3002</p> <p>2\uff09\u521b\u5efaRDD</p> <pre><code>package com.atguigu.createrdd;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.List;\n\npublic class Test02_File {\npublic static void main(String[] args) {\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input\");\n\nList&lt;String&gt; result = lineRDD.collect();\n\nfor (String s : result) {\nSystem.out.println(s);\n}\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#416-rdd","title":"4.1.6 \u4ece\u5176\u4ed6RDD\u521b\u5efa","text":"<p>\u4e3b\u8981\u662f\u901a\u8fc7\u4e00\u4e2a RDD \u8fd0\u7b97\u5b8c\u540e\uff0c\u518d\u4ea7\u751f\u65b0\u7684 RDD\u3002</p> <p>\u8be6\u89c1\u7b2c\u4e09\u5c0f\u8282</p>"},{"location":"engine/spark/spark_04/#42","title":"4.2 \u5206\u533a\u89c4\u5219","text":""},{"location":"engine/spark/spark_04/#421-rdd","title":"4.2.1 \u4ece\u96c6\u5408\u521b\u5efaRDD","text":"<p>1\uff09\u521b\u5efa\u4e00\u4e2a\u5305\u540d\uff1a com.atguigu.partition 2\uff09\u4ee3\u7801\u9a8c\u8bc1</p> <pre><code>package com.atguigu.partition;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.Arrays;\n\npublic class Test01_ListPartition {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\n// \u9ed8\u8ba4\u73af\u5883\u7684\u6838\u6570\n// \u53ef\u4ee5\u624b\u52a8\u586b\u5199\u53c2\u6570\u63a7\u5236\u5206\u533a\u7684\u4e2a\u6570\nJavaRDD&lt;String&gt; stringRDD = sc.parallelize(Arrays.asList(\"hello\", \"spark\", \"hello\", \"spark\", \"hello\"),2);\n\n// \u6570\u636e\u5206\u533a\u7684\u60c5\u51b5\n// 0 =&gt; 1,2  1 =&gt; 3,4,5\n// \u5229\u7528\u6574\u6570\u9664\u673a\u5236  \u5de6\u95ed\u53f3\u5f00\n// 0 =&gt; start 0*5/2  end 1*5/2\n// 1 =&gt; start 1*5/2  end 2*5/2\nstringRDD.saveAsTextFile(\"output\");\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#422-rdd","title":"4.2.2 \u4ece\u6587\u4ef6\u521b\u5efaRDD","text":"<p>1\uff09\u5206\u533a\u6d4b\u8bd5</p> <pre><code>package com.atguigu.partition;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.List;\n\npublic class Test02_FilePartition {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\n// \u9ed8\u8ba4\u586b\u5199\u7684\u6700\u5c0f\u5206\u533a\u6570   2\u548c\u73af\u5883\u7684\u6838\u6570\u53d6\u5c0f\u7684\u503c  \u4e00\u822c\u4e3a2\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/1.txt\");\n\n// \u5177\u4f53\u7684\u5206\u533a\u4e2a\u6570\u9700\u8981\u7ecf\u8fc7\u516c\u5f0f\u8ba1\u7b97\n// \u9996\u5148\u83b7\u53d6\u6587\u4ef6\u7684\u603b\u957f\u5ea6  totalSize\n// \u8ba1\u7b97\u5e73\u5747\u957f\u5ea6  goalSize = totalSize / numSplits\n// \u83b7\u53d6\u5757\u5927\u5c0f 128M\n// \u8ba1\u7b97\u5207\u5206\u5927\u5c0f  splitSize = Math.max(minSize, Math.min(goalSize, blockSize));\n// \u6700\u540e\u4f7f\u7528splitSize  \u6309\u71671.1\u500d\u539f\u5219\u5207\u5206\u6574\u4e2a\u6587\u4ef6   \u5f97\u5230\u51e0\u4e2a\u5206\u533a\u5c31\u662f\u51e0\u4e2a\u5206\u533a\n\n// \u5b9e\u9645\u5f00\u53d1\u4e2d   \u53ea\u9700\u8981\u770b\u6587\u4ef6\u603b\u5927\u5c0f / \u586b\u5199\u7684\u5206\u533a\u6570  \u548c\u5757\u5927\u5c0f\u6bd4\u8f83  \u8c01\u5c0f\u62ff\u8c01\u8fdb\u884c\u5207\u5206\nlineRDD.saveAsTextFile(\"output\");\n\n// \u6570\u636e\u4f1a\u5206\u914d\u5230\u54ea\u4e2a\u5206\u533a\n// \u5982\u679c\u5207\u5206\u7684\u4f4d\u7f6e\u4f4d\u4e8e\u4e00\u884c\u7684\u4e2d\u95f4  \u4f1a\u5728\u5f53\u524d\u5206\u533a\u8bfb\u5b8c\u4e00\u6574\u884c\u6570\u636e\n\n// 0 -&gt; 1,2  1 -&gt; 3  2 -&gt; 4  3 -&gt; \u7a7a\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>2\uff09\u5206\u533a\u6e90\u7801</p> <p>\u6ce8\u610f</p> <p>getSplits \u6587\u4ef6\u8fd4\u56de\u7684\u662f\u5207\u7247\u89c4\u5212\uff0c\u771f\u6b63\u8bfb\u53d6\u662f\u5728 compute \u65b9\u6cd5\u4e2d\u521b\u5efa LineRecordReader \u8bfb\u53d6\u7684\uff0c\u6709\u4e24\u4e2a\u5173\u952e\u53d8\u91cf\uff1a <code>start = split.getStart()</code>,<code>end = start + split.getLength</code></p> <p>\u2460\u5206\u533a\u6570\u91cf\u7684\u8ba1\u7b97\u65b9\u5f0f: totalSize = 10 goalSize = 10 / 3 = 3(byte) \u8868\u793a\u6bcf\u4e2a\u5206\u533a\u5b58\u50a8 3 \u5b57\u8282\u7684\u6570\u636e \u5206\u533a\u6570 = totalSize / goalSize = 10 /3 =&gt; 3,3,4 4 \u5b57\u8282\u5927\u4e8e 3 \u5b50\u8282\u7684 1.1 \u500d,\u7b26\u5408 hadoop \u5207\u7247 1.1 \u500d\u7684\u7b56\u7565,\u56e0\u6b64\u4f1a\u591a\u521b\u5efa\u4e00\u4e2a\u5206\u533a,\u5373\u4e00\u5171\u6709 4 \u4e2a\u5206\u533a  3,3,3,1</p> <p>\u2461Spark\u8bfb\u53d6\u6587\u4ef6\uff0c\u91c7\u7528\u7684\u662fhadoop\u7684\u65b9\u5f0f\u8bfb\u53d6\uff0c\u6240\u4ee5\u4e00\u884c\u4e00\u884c\u8bfb\u53d6\uff0c\u8ddf\u5b57\u8282\u6570\u6ca1\u6709\u5173\u7cfb</p> <p>\u2462\u6570\u636e\u8bfb\u53d6\u4f4d\u7f6e\u8ba1\u7b97\u662f\u4ee5\u504f\u79fb\u91cf\u4e3a\u5355\u4f4d\u6765\u8fdb\u884c\u8ba1\u7b97\u7684\u3002</p>"},{"location":"engine/spark/spark_04/#43-transformation","title":"4.3 Transformation\u8f6c\u6362\u7b97\u5b50","text":""},{"location":"engine/spark/spark_04/#431-value","title":"4.3.1 Value\u7c7b\u578b","text":"<p>1\uff09\u521b\u5efa\u5305\u540d\uff1a com.atguigu.value</p>"},{"location":"engine/spark/spark_04/#4311-map","title":"4.3.1.1 map()\u6620\u5c04","text":"<p>\u53c2\u6570 f \u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u53ef\u4ee5\u5199\u4f5c\u533f\u540d\u5b50\u7c7b\uff0c\u5b83\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\u3002\u5f53\u67d0\u4e2a RDD \u6267\u884c map \u65b9\u6cd5\u65f6\uff0c\u4f1a\u904d\u5386\u8be5 RDD \u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\u636e\u9879\uff0c\u5e76\u4f9d\u6b21\u5e94\u7528 f \u51fd\u6570\uff0c\u4ece\u800c\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684 RDD\u3002\u5373\uff0c\u8fd9\u4e2a\u65b0 RDD \u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u662f\u539f\u6765 RDD     \u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u4f9d\u6b21\u5e94\u7528 f \u51fd\u6570\u800c\u5f97\u5230\u7684\u3002</p> <p>1\uff09\u5177\u4f53\u5b9e\u73b0</p> <pre><code>package com.atguigu.value;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\n\npublic class Test01_Map {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/1.txt\");\n\n// \u9700\u6c42:\u6bcf\u884c\u7ed3\u5c3e\u62fc\u63a5||\n// \u4e24\u79cd\u5199\u6cd5  lambda\u8868\u8fbe\u5f0f\u5199\u6cd5(\u533f\u540d\u51fd\u6570) \nJavaRDD&lt;String&gt; mapRDD = lineRDD.map(s -&gt; s + \"||\");\n\n// \u533f\u540d\u51fd\u6570\u5199\u6cd5 \nJavaRDD&lt;String&gt; mapRDD1 = lineRDD.map(new Function&lt;String, String&gt;() {\n@Override\npublic String call(String v1) throws Exception {\nreturn v1 + \"||\";\n}\n});\n\nfor (String s : mapRDD.collect()) {\nSystem.out.println(s);\n}\n\n// \u8f93\u51fa\u6570\u636e\u7684\u51fd\u6570\u5199\u6cd5\nmapRDD1.collect().forEach(a -&gt; System.out.println(a));\nmapRDD1.collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#4312-flatmap","title":"4.3.1.2 flatMap()\u6241\u5e73\u5316","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e</p> <p>\u4e0e map \u64cd\u4f5c\u7c7b\u4f3c\uff0c\u5c06 RDD \u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u901a\u8fc7\u5e94\u7528 f \u51fd\u6570\u4f9d\u6b21\u8f6c\u6362\u4e3a\u65b0\u7684\u5143\u7d20\uff0c\u5e76\u5c01\u88c5\u5230 RDD \u4e2d\u3002 \u533a\u522b\uff1a\u5728 flatMap \u64cd\u4f5c\u4e2d\uff0cf \u51fd\u6570\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u96c6\u5408\uff0c\u5e76\u4e14\u4f1a\u5c06\u6bcf\u4e00\u4e2a\u8be5\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u62c6\u5206\u51fa\u6765\u653e\u5230\u65b0\u7684 RDD \u4e2d\u3002</p> <p>2\uff09\u9700\u6c42\u8bf4\u660e</p> <p>\u521b\u5efa\u4e00\u4e2a\u96c6\u5408\uff0c\u96c6\u5408\u91cc\u9762\u5b58\u50a8\u7684\u8fd8\u662f\u5b50\u96c6\u5408\uff0c\u628a\u6240\u6709\u5b50\u96c6\u5408\u4e2d\u6570\u636e\u53d6\u51fa\u653e\u5165\u5230\u4e00\u4e2a\u5927\u7684\u96c6\u5408\u4e2d\u3002</p> <p></p> <p>4\uff09\u5177\u4f53\u5b9e\u73b0\uff1a</p> <pre><code>package com.atguigu.value;\n\nimport org.apache.commons.collections.ListUtils;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Iterator;\nimport java.util.List;\n\npublic class Test02_FlatMap {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nArrayList&lt;List&lt;String&gt;&gt; arrayLists = new ArrayList&lt;&gt;();\n\narrayLists.add(Arrays.asList(\"1\",\"2\",\"3\"));\narrayLists.add(Arrays.asList(\"4\",\"5\",\"6\"));\n\n\nJavaRDD&lt;List&lt;String&gt;&gt; listJavaRDD = sc.parallelize(arrayLists,2);\n// \u5bf9\u4e8e\u96c6\u5408\u5d4c\u5957\u7684RDD \u53ef\u4ee5\u5c06\u5143\u7d20\u6253\u6563\n// \u6cdb\u578b\u4e3a\u6253\u6563\u4e4b\u540e\u7684\u5143\u7d20\u7c7b\u578b\nJavaRDD&lt;String&gt; stringJavaRDD = listJavaRDD.flatMap(new FlatMapFunction&lt;List&lt;String&gt;, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(List&lt;String&gt; strings) throws Exception {\n\nreturn strings.iterator();\n}\n});\n\nstringJavaRDD. collect().forEach(System.out::println);\n\n// \u901a\u5e38\u60c5\u51b5\u4e0b\u9700\u8981\u81ea\u5df1\u5c06\u5143\u7d20\u8f6c\u6362\u4e3a\u96c6\u5408\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/2.txt\");\n\nJavaRDD&lt;String&gt; stringJavaRDD1 = lineRDD.flatMap(new FlatMapFunction&lt;String, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(String s) throws Exception {\nString[] s1 = s.split(\" \");\nreturn Arrays.asList(s1).iterator();\n}\n});\n\nstringJavaRDD1. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#4313-groupby","title":"4.3.1.3 groupBy()\u5206\u7ec4","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u5206\u7ec4\uff0c\u6309\u7167\u4f20\u5165\u51fd\u6570\u7684\u8fd4\u56de\u503c\u8fdb\u884c\u5206\u7ec4\u3002\u5c06\u76f8\u540c\u7684 key \u5bf9\u5e94\u7684\u503c\u653e\u5165\u4e00\u4e2a\u8fed\u4ee3\u5668\u3002 2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u6309\u7167\u5143\u7d20\u6a21\u4ee5 2 \u7684\u503c\u8fdb\u884c\u5206\u7ec4\u3002 3\uff09\u5177\u4f53\u5b9e\u73b0</p> <pre><code>package com.atguigu.value;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\n\nimport java.util.Arrays;\n\npublic class Test03_GroupBy {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\n// \u6cdb\u578b\u4e3a\u5206\u7ec4\u6807\u8bb0\u7684\u7c7b\u578b\nJavaPairRDD&lt;Integer, Iterable&lt;Integer&gt;&gt; groupByRDD = integerJavaRDD.groupBy(new Function&lt;Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1) throws Exception {\nreturn v1 % 2;\n}\n});\n\ngroupByRDD.collect().forEach(System.out::println);\n\n// \u7c7b\u578b\u53ef\u4ee5\u4efb\u610f\u4fee\u6539\nJavaPairRDD&lt;Boolean, Iterable&lt;Integer&gt;&gt; groupByRDD1 = integerJavaRDD.groupBy(new Function&lt;Integer, Boolean&gt;() {\n@Override\npublic Boolean call(Integer v1) throws Exception {\nreturn v1 % 2 == 0;\n}\n});\n\ngroupByRDD1. collect().forEach(System.out::println);\n\nThread.sleep(600000);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <ul> <li>groupBy \u4f1a\u5b58\u5728 shuffle \u8fc7\u7a0b</li> <li>shuffle\uff1a\u5c06\u4e0d\u540c\u7684\u5206\u533a\u6570\u636e\u8fdb\u884c\u6253\u4e71\u91cd\u7ec4\u7684\u8fc7\u7a0b</li> <li>shuffle \u4e00\u5b9a\u4f1a\u843d\u76d8\u3002\u53ef\u4ee5\u5728 local \u6a21\u5f0f\u4e0b\u6267\u884c\u7a0b\u5e8f\uff0c\u901a\u8fc7 4040 \u770b\u6548\u679c</li> </ul>"},{"location":"engine/spark/spark_04/#4314-filter","title":"4.3.1.4 filter()\u8fc7\u6ee4","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e \u63a5\u6536\u4e00\u4e2a\u8fd4\u56de\u503c\u4e3a\u5e03\u5c14\u7c7b\u578b\u7684\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u3002\u5f53\u67d0\u4e2a RDD \u8c03\u7528 filter \u65b9\u6cd5\u65f6\uff0c\u4f1a\u5bf9\u8be5 RDD \u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u5e94\u7528 f \u51fd\u6570\uff0c\u5982\u679c\u8fd4\u56de\u503c\u7c7b\u578b\u4e3a true\uff0c\u5219\u8be5\u5143\u7d20\u4f1a\u88ab\u6dfb\u52a0\u5230\u65b0\u7684 RDD \u4e2d\u3002</p> <p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u8fc7\u6ee4\u51fa\u5bf9 2 \u53d6\u4f59\u7b49\u4e8e 0 \u7684\u6570\u636e</p> <p></p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.value;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\n\nimport java.util.Arrays;\n\npublic class Test04_Filter {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\nJavaRDD&lt;Integer&gt; filterRDD = integerJavaRDD.filter(new Function&lt;Integer, Boolean&gt;() {\n@Override\npublic Boolean call(Integer v1) throws Exception {\nreturn v1 % 2 == 0;\n}\n});\n\nfilterRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#4315-distinct","title":"4.3.1.5 distinct()\u53bb\u91cd","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u5bf9\u5185\u90e8\u7684\u5143\u7d20\u53bb\u91cd\uff0c\u5e76\u5c06\u53bb\u91cd\u540e\u7684\u5143\u7d20\u653e\u5230\u65b0\u7684 RDD \u4e2d\u3002 2\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.value;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.Arrays;\n\n\npublic class Test05_Distinct {\npublic static void main(String[] args) {\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4, 5, 6), 2);\n\n// \u5e95\u5c42\u4f7f\u7528\u5206\u5e03\u5f0f\u5206\u7ec4\u53bb\u91cd  \u6240\u6709\u901f\u5ea6\u6bd4\u8f83\u6162,\u4f46\u662f\u4e0d\u4f1aOOM\nJavaRDD&lt;Integer&gt; distinct = integerJavaRDD.distinct();\n\ndistinct. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>\u6ce8\u610f</p> <p>distinct \u4f1a\u5b58\u5728 shuffle \u8fc7\u7a0b\u3002</p>"},{"location":"engine/spark/spark_04/#4316-sortby","title":"4.3.1.6 sortBy()\u6392\u5e8f","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e</p> <p>\u8be5\u64cd\u4f5c\u7528\u4e8e\u6392\u5e8f\u6570\u636e\u3002\u5728\u6392\u5e8f\u4e4b\u524d\uff0c\u53ef\u4ee5\u5c06\u6570\u636e\u901a\u8fc7 f \u51fd\u6570\u8fdb\u884c\u5904\u7406\uff0c\u4e4b\u540e\u6309\u7167 f \u51fd\u6570\u5904\u7406\u7684\u7ed3\u679c\u8fdb\u884c\u6392\u5e8f\uff0c\u9ed8\u8ba4\u4e3a\u6b63\u5e8f\u6392\u5217\u3002\u6392\u5e8f\u540e\u65b0\u4ea7\u751f\u7684 RDD \u7684\u5206\u533a\u6570\u4e0e\u539f RDD \u7684\u5206\u533a\u6570\u4e00\u81f4\u3002Spark \u7684\u6392\u5e8f\u7ed3\u679c\u662f\u5168\u5c40\u6709\u5e8f\u3002</p> <p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u6309\u7167\u6570\u5b57\u5927\u5c0f\u5206\u522b\u5b9e\u73b0\u6b63\u5e8f\u548c\u5012\u5e8f\u6392\u5e8f</p> <p></p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0\uff1a</p> <pre><code>package com.atguigu.value;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\n\nimport java.util.Arrays;\n\npublic class Test6_SortBy {\npublic static void main(String[] args) {\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(5, 8, 1, 11, 20), 2);\n\n// (1)\u6cdb\u578b\u4e3a\u4ee5\u8c01\u4f5c\u4e3a\u6807\u51c6\u6392\u5e8f  (2) true\u4e3a\u6b63\u5e8f  (3) \u6392\u5e8f\u4e4b\u540e\u7684\u5206\u533a\u4e2a\u6570\nJavaRDD&lt;Integer&gt; sortByRDD = integerJavaRDD.sortBy(new Function&lt;Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1) throws Exception {\nreturn v1;\n}\n}, true, 2);\n\nsortByRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#432-key-value","title":"4.3.2 Key-Value\u7c7b\u578b","text":"<p>1\uff09\u521b\u5efa\u5305\u540d\uff1a com.atguigu.keyvalue</p> <p>\u8981\u60f3\u4f7f\u7528 Key-Value \u7c7b\u578b\u7684\u7b97\u5b50\u9996\u5148\u9700\u8981\u4f7f\u7528\u7279\u5b9a\u7684\u65b9\u6cd5\u8f6c\u6362\u4e3a PairRDD</p> <pre><code>package com.atguigu.keyValue;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test01_pairRDD{\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\n\nJavaPairRDD&lt;Integer, Integer&gt; pairRDD = integerJavaRDD.mapToPair(new PairFunction&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Tuple2&lt;Integer, Integer&gt; call(Integer integer) throws Exception {\nreturn new Tuple2&lt;&gt;(integer, integer);\n}\n});\n\npairRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#4321-mapvaluesv","title":"4.3.2.1 mapValues()\u53ea\u5bf9V\u8fdb\u884c\u64cd\u4f5c","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u9488\u5bf9\u4e8e (K,V) \u5f62\u5f0f\u7684\u7c7b\u578b\u53ea\u5bf9 V \u8fdb\u884c\u64cd\u4f5c 2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a pairRDD\uff0c\u5e76\u5c06 value \u6dfb\u52a0\u5b57\u7b26\u4e32\"|||\"</p> <p></p> <p>4\uff09\u4ee3\u7801\u5b9e\u73b0\uff1a</p> <pre><code>package com.atguigu.keyValue;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test02_MapValues {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaPairRDD&lt;String, String&gt; javaPairRDD = sc.parallelizePairs(Arrays.asList(new Tuple2&lt;&gt;(\"k\", \"v\"), new Tuple2&lt;&gt;(\"k1\", \"v1\"), new Tuple2&lt;&gt;(\"k2\", \"v2\")));\n\n// \u53ea\u4fee\u6539value \u4e0d\u4fee\u6539key\nJavaPairRDD&lt;String, String&gt; mapValuesRDD = javaPairRDD.mapValues(new Function&lt;String, String&gt;() {\n@Override\npublic String call(String v1) throws Exception {\nreturn v1 + \"|||\";\n}\n});\n\nmapValuesRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#4322-groupbykeyk","title":"4.3.2.2 groupByKey()\u6309\u7167K\u91cd\u65b0\u5206\u7ec4","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e</p> <p>groupByKey \u5bf9\u6bcf\u4e2a key \u8fdb\u884c\u64cd\u4f5c\uff0c\u4f46\u53ea\u751f\u6210\u4e00\u4e2a seq\uff0c\u5e76\u4e0d\u8fdb\u884c\u805a\u5408\u3002</p> <p>\u8be5\u64cd\u4f5c\u53ef\u4ee5\u6307\u5b9a\u5206\u533a\u5668\u6216\u8005\u5206\u533a\u6570\uff08\u9ed8\u8ba4\u4f7f\u7528 HashPartitioner \uff09</p> <p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u7edf\u8ba1\u5355\u8bcd\u51fa\u73b0\u6b21\u6570</p> <p></p> <p>4\uff09\u4ee3\u7801\u5b9e\u73b0\uff1a</p> <pre><code>package com.atguigu.keyValue;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test03_GroupByKey {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; integerJavaRDD = sc.parallelize(Arrays.asList(\"hi\",\"hi\",\"hello\",\"spark\" ),2);\n\n// \u7edf\u8ba1\u5355\u8bcd\u51fa\u73b0\u6b21\u6570\nJavaPairRDD&lt;String, Integer&gt; pairRDD = integerJavaRDD.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\n// \u805a\u5408\u76f8\u540c\u7684key\nJavaPairRDD&lt;String, Iterable&lt;Integer&gt;&gt; groupByKeyRDD = pairRDD.groupByKey();\n\n// \u5408\u5e76\u503c\nJavaPairRDD&lt;String, Integer&gt; result = groupByKeyRDD.mapValues(new Function&lt;Iterable&lt;Integer&gt;, Integer&gt;() {\n@Override\npublic Integer call(Iterable&lt;Integer&gt; v1) throws Exception {\nInteger sum = 0;\nfor (Integer integer : v1) {\nsum += integer;\n}\nreturn sum;\n}\n});\n\nresult. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}}\n</code></pre>"},{"location":"engine/spark/spark_04/#4323-reducebykeykv","title":"4.3.2.3 reduceByKey()\u6309\u7167K\u805a\u5408V","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u8be5\u64cd\u4f5c\u53ef\u4ee5\u5c06 RDD[K,V] \u4e2d\u7684\u5143\u7d20\u6309\u7167\u76f8\u540c\u7684 K \u5bf9 V \u8fdb\u884c\u805a\u5408\u3002\u5176\u5b58\u5728\u591a\u79cd\u91cd\u8f7d\u5f62\u5f0f\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u65b0 RDD \u7684\u5206\u533a\u6570\u3002 2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u7edf\u8ba1\u5355\u8bcd\u51fa\u73b0\u6b21\u6570</p> <p></p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0\uff1a</p> <pre><code>package com.atguigu.keyValue;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test04_ReduceByKey {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; integerJavaRDD = sc.parallelize(Arrays.asList(\"hi\",\"hi\",\"hello\",\"spark\" ),2);\n\n// \u7edf\u8ba1\u5355\u8bcd\u51fa\u73b0\u6b21\u6570\nJavaPairRDD&lt;String, Integer&gt; pairRDD = integerJavaRDD.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\n// \u805a\u5408\u76f8\u540c\u7684key\nJavaPairRDD&lt;String, Integer&gt; result = pairRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n});\n\nresult. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#4324-reducebykeygroupbykey","title":"4.3.2.4 reduceByKey\u548cgroupByKey\u533a\u522b","text":"<p>1\uff09reduceByKey\uff1a\u6309\u7167 key \u8fdb\u884c\u805a\u5408\uff0c\u5728 shuffle \u4e4b\u524d\u6709 combine\uff08\u9884\u805a\u5408\uff09\u64cd\u4f5c\uff0c\u8fd4\u56de\u7ed3\u679c\u662f RDD[K,V]\u3002 2\uff09groupByKey\uff1a\u6309\u7167 key \u8fdb\u884c\u5206\u7ec4\uff0c\u76f4\u63a5\u8fdb\u884c shuffle\u3002 3\uff09\u5f00\u53d1\u6307\u5bfc\uff1a\u5728\u4e0d\u5f71\u54cd\u4e1a\u52a1\u903b\u8f91\u7684\u524d\u63d0\u4e0b\uff0c\u4f18\u5148\u9009\u7528 reduceByKey\u3002\u6c42\u548c\u64cd\u4f5c\u4e0d\u5f71\u54cd\u4e1a\u52a1\u903b\u8f91\uff0c\u6c42\u5e73\u5747\u503c\u5f71\u54cd\u4e1a\u52a1\u903b\u8f91\u3002\u5f71\u54cd\u4e1a\u52a1\u903b\u8f91\u65f6\u5efa\u8bae\u5148\u5bf9\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u8f6c\u6362\u518d\u5408\u5e76\u3002</p> <pre><code>package com.atguigu.keyValue;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test06_ReduceByKeyAvg {\npublic static void main(String[] args) throws InterruptedException {\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaPairRDD&lt;String, Integer&gt; javaPairRDD = sc.parallelizePairs(Arrays.asList(new Tuple2&lt;&gt;(\"hi\", 96), new Tuple2&lt;&gt;(\"hi\", 97), new Tuple2&lt;&gt;(\"hello\", 95), new Tuple2&lt;&gt;(\"hello\", 195)));\n\n// (\"hi\",(96,1))\nJavaPairRDD&lt;String, Tuple2&lt;Integer, Integer&gt;&gt; tuple2JavaPairRDD = javaPairRDD.mapValues(new Function&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;() {\n@Override\npublic Tuple2&lt;Integer, Integer&gt; call(Integer v1) throws Exception {\nreturn new Tuple2&lt;&gt;(v1, 1);\n}\n});\n\n// \u805a\u5408RDD\nJavaPairRDD&lt;String, Tuple2&lt;Integer, Integer&gt;&gt; reduceRDD = tuple2JavaPairRDD.reduceByKey(new Function2&lt;Tuple2&lt;Integer, Integer&gt;, Tuple2&lt;Integer, Integer&gt;, Tuple2&lt;Integer, Integer&gt;&gt;() {\n@Override\npublic Tuple2&lt;Integer, Integer&gt; call(Tuple2&lt;Integer, Integer&gt; v1, Tuple2&lt;Integer, Integer&gt; v2) throws Exception {\nreturn new Tuple2&lt;&gt;(v1._1 + v2._1, v1._2 + v2._2);\n}\n});\n\n// \u76f8\u9664\nJavaPairRDD&lt;String, Double&gt; result = reduceRDD.mapValues(new Function&lt;Tuple2&lt;Integer, Integer&gt;, Double&gt;() {\n@Override\npublic Double call(Tuple2&lt;Integer, Integer&gt; v1) throws Exception {\nreturn (new Double(v1._1) / v1._2);\n}\n});\n\nresult. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#4325-sortbykeyk","title":"4.3.2.5 sortByKey()\u6309\u7167K\u8fdb\u884c\u6392\u5e8f","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e \u5728\u4e00\u4e2a (K,V) \u7684 RDD \u4e0a\u8c03\u7528\uff0cK \u5fc5\u987b\u5b9e\u73b0 Ordered \u63a5\u53e3\uff0c\u8fd4\u56de\u4e00\u4e2a\u6309\u7167 key \u8fdb\u884c\u6392\u5e8f\u7684 (K,V) \u7684 RDD\u3002 2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a pairRDD\uff0c\u6309\u7167 key \u7684\u6b63\u5e8f\u548c\u5012\u5e8f\u8fdb\u884c\u6392\u5e8f</p> <p></p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0\uff1a</p> <pre><code>package com.atguigu.keyValue;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test05_SortByKey {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaPairRDD&lt;Integer, String&gt; javaPairRDD = sc.parallelizePairs(Arrays.asList(new Tuple2&lt;&gt;(4, \"a\"), new Tuple2&lt;&gt;(3, \"c\"), new Tuple2&lt;&gt;(2, \"d\")));\n\n// \u586b\u5199\u5e03\u5c14\u7c7b\u578b\u9009\u62e9\u6b63\u5e8f\u5012\u5e8f\nJavaPairRDD&lt;Integer, String&gt; pairRDD = javaPairRDD.sortByKey(false);\n\npairRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#44-action","title":"4.4 Action\u884c\u52a8\u7b97\u5b50","text":"<p>\u884c\u52a8\u7b97\u5b50\u662f\u89e6\u53d1\u4e86\u6574\u4e2a\u4f5c\u4e1a\u7684\u6267\u884c\u3002\u56e0\u4e3a\u8f6c\u6362\u7b97\u5b50\u90fd\u662f\u61d2\u52a0\u8f7d\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\u3002 1\uff09\u521b\u5efa\u5305\u540d\uff1a com.atguigu.action</p>"},{"location":"engine/spark/spark_04/#441-collect","title":"4.4.1 collect()\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u8fd4\u56de\u6570\u636e\u96c6","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u5728 Driver \u4e2d\uff0c\u4ee5\u6570\u7ec4 Array \u7684\u5f62\u5f0f\u8fd4\u56de\u6570\u636e\u96c6\u7684\u6240\u6709\u5143\u7d20\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>\u6240\u6709\u7684\u6570\u636e\u90fd\u4f1a\u88ab\u62c9\u53d6\u5230Driver\u7aef\uff0c\u614e\u7528\u3002</p> <p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u5e76\u5c06 RDD \u5185\u5bb9\u6536\u96c6\u5230 Driver \u7aef\u6253\u5370</p> <pre><code>package com.atguigu.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.Arrays;\nimport java.util.List;\n\npublic class Test01_Collect {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\nList&lt;Integer&gt; collect = integerJavaRDD.collect();\n\nfor (Integer integer : collect) {\nSystem.out.println(integer);\n}\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#442-countrdd","title":"4.4.2 count()\u8fd4\u56deRDD\u4e2d\u5143\u7d20\u4e2a\u6570","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u8fd4\u56de RDD \u4e2d\u5143\u7d20\u7684\u4e2a\u6570</p> <p></p> <p>3\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u7edf\u8ba1\u8be5 RDD \u7684\u6570\u636e\u6761\u6570</p> <pre><code>package com.atguigu.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.Arrays;\n\n\npublic class Test02_Count {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\nlong count = integerJavaRDD.count();\n\nSystem.out.println(count);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#443-firstrdd","title":"4.4.3 first()\u8fd4\u56deRDD\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u8fd4\u56de RDD \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20</p> <p></p> <p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u8fd4\u56de\u8be5 RDD \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20</p> <pre><code>package com.atguigu.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.Arrays;\n\npublic class Test03_First {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\nInteger first = integerJavaRDD.first();\n\nSystem.out.println(first);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#444-takerddn","title":"4.4.4 take()\u8fd4\u56de\u7531RDD\u524dn\u4e2a\u5143\u7d20\u7ec4\u6210\u7684\u6570\u7ec4","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u8fd4\u56de\u4e00\u4e2a\u7531 RDD \u7684\u524d n \u4e2a\u5143\u7d20\u7ec4\u6210\u7684\u6570\u7ec4</p> <p></p> <p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u53d6\u51fa\u524d\u4e24\u4e2a\u5143\u7d20</p> <pre><code>package com.atguigu.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\n\nimport java.util.Arrays;\nimport java.util.List;\n\npublic class Test04_Take {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\nList&lt;Integer&gt; list = integerJavaRDD.take(3);\n\nlist.forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#445-countbykeykey","title":"4.4.5 countByKey()\u7edf\u8ba1\u6bcf\u79cdkey\u7684\u4e2a\u6570","text":"<p>1\uff09\u529f\u80fd\u8bf4\u660e\uff1a\u7edf\u8ba1\u6bcf\u79cd key \u7684\u4e2a\u6570</p> <p></p> <p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a PairRDD\uff0c\u7edf\u8ba1\u6bcf\u79cd key \u7684\u4e2a\u6570</p> <pre><code>package com.atguigu.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\nimport java.util.Map;\n\npublic class Test05_CountByKey {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaPairRDD&lt;String, Integer&gt; pairRDD = sc.parallelizePairs(Arrays.asList(new Tuple2&lt;&gt;(\"a\", 8), new Tuple2&lt;&gt;(\"b\", 8), new Tuple2&lt;&gt;(\"a\", 8), new Tuple2&lt;&gt;(\"d\", 8)));\n\nMap&lt;String, Long&gt; map = pairRDD.countByKey();\n\nSystem.out.println(map);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#446-save","title":"4.4.6 save\u76f8\u5173\u7b97\u5b50","text":"<p>1\uff09<code>saveAsTextFile(path)</code> \u4fdd\u5b58\u6210 Text \u6587\u4ef6 \u529f\u80fd\u8bf4\u660e\uff1a\u5c06\u6570\u636e\u96c6\u7684\u5143\u7d20\u4ee5 textfile \u7684\u5f62\u5f0f\u4fdd\u5b58\u5230 HDFS \u6587\u4ef6\u7cfb\u7edf\u6216\u8005\u5176\u4ed6\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5143\u7d20\uff0c Spark \u5c06\u4f1a\u8c03\u7528 toString \u65b9\u6cd5\uff0c\u5c06\u5b83\u8f6c\u6362\u4e3a\u6587\u4ef6\u4e2d\u7684\u6587\u672c</p> <p>2\uff09<code>saveAsObjectFile(path)</code> \u5e8f\u5217\u5316\u6210\u5bf9\u8c61\u4fdd\u5b58\u5230\u6587\u4ef6 \u529f\u80fd\u8bf4\u660e\uff1a\u7528\u4e8e\u5c06 RDD \u4e2d\u7684\u5143\u7d20\u5e8f\u5217\u5316\u6210\u5bf9\u8c61\uff0c\u5b58\u50a8\u5230\u6587\u4ef6\u4e2d\u3002</p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test06_Save {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),2);\n\nintegerJavaRDD.saveAsTextFile(\"output\");\n\nintegerJavaRDD.saveAsObjectFile(\"output1\");\n\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#447-foreachrdd","title":"4.4.7 foreach()\u904d\u5386RDD\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20","text":"<p>2\uff09\u9700\u6c42\u8bf4\u660e\uff1a\u521b\u5efa\u4e00\u4e2a RDD\uff0c\u5bf9\u6bcf\u4e2a\u5143\u7d20\u8fdb\u884c\u6253\u5370</p> <pre><code>package com.atguigu.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.VoidFunction;\n\nimport java.util.Arrays;\n\npublic class Test07_Foreach {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; integerJavaRDD = sc.parallelize(Arrays.asList(1, 2, 3, 4),4);\n\nintegerJavaRDD.foreach(new VoidFunction&lt;Integer&gt;() {\n@Override\npublic void call(Integer integer) throws Exception {\nSystem.out.println(integer);\n}\n});\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#448-foreachpartition-rdd","title":"4.4.8 foreachPartition ()\u904d\u5386RDD\u4e2d\u6bcf\u4e00\u4e2a\u5206\u533a","text":"<pre><code>package com.atguigu.spark.action;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.VoidFunction;\n\nimport java.util.Arrays;\nimport java.util.Iterator;\n\npublic class Test08_ForeachPartition {\npublic static void main(String[] args) {\n\n// 1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"core\").setMaster(\"local[*]\");\n\n// 2. \u521b\u5efasc\u73af\u5883\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; parallelize = sc.parallelize(Arrays.asList(1, 2, 3, 4, 5, 6), 2);\n\n// \u591a\u7ebf\u7a0b\u4e00\u8d77\u8ba1\u7b97   \u5206\u533a\u95f4\u65e0\u5e8f  \u5355\u4e2a\u5206\u533a\u6709\u5e8f\nparallelize.foreachPartition(new VoidFunction&lt;Iterator&lt;Integer&gt;&gt;() {\n@Override\npublic void call(Iterator&lt;Integer&gt; integerIterator) throws Exception {\n// \u4e00\u6b21\u5904\u7406\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\nwhile (integerIterator.hasNext()) {\nInteger next = integerIterator.next();\nSystem.out.println(next);\n}\n}\n});\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#25-wordcount","title":"2.5 WordCount\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u5bfc\u5165\u9879\u76ee\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-core_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre>"},{"location":"engine/spark/spark_04/#251","title":"2.5.1 \u672c\u5730\u8c03\u8bd5","text":"<p>\u672c\u5730 Spark \u7a0b\u5e8f\u8c03\u8bd5\u9700\u8981\u4f7f\u7528 Local \u63d0\u4ea4\u6a21\u5f0f\uff0c\u5373\u5c06\u672c\u673a\u5f53\u505a\u8fd0\u884c\u73af\u5883\uff0cMaster \u548c Worker \u90fd\u4e3a\u672c\u673a\u3002\u8fd0\u884c\u65f6\u76f4\u63a5\u52a0\u65ad\u70b9\u8c03\u8bd5\u5373\u53ef\u3002\u5982\u4e0b\uff1a 1\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\nimport java.util.Iterator;\nimport java.util.List;\n\npublic class WordCount {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\n// \u8bfb\u53d6\u6570\u636e\nJavaRDD&lt;String&gt; javaRDD = sc.textFile(\"input/2.txt\");\n\n// \u957f\u5b57\u7b26\u4e32\u5207\u5206\u4e3a\u5355\u4e2a\u5355\u8bcd\nJavaRDD&lt;String&gt; flatMapRDD = javaRDD.flatMap(new FlatMapFunction&lt;String, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(String s) throws Exception {\nList&lt;String&gt; strings = Arrays.asList(s.split(\" \"));\nreturn strings.iterator();\n}\n});\n\n// \u8f6c\u6362\u683c\u5f0f\u4e3a  (\u5355\u8bcd,1)\nJavaPairRDD&lt;String, Integer&gt; pairRDD = flatMapRDD.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\n// \u5408\u5e76\u76f8\u540c\u5355\u8bcd\nJavaPairRDD&lt;String, Integer&gt; javaPairRDD = pairRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n});\n\njavaPairRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>2\uff09\u8c03\u8bd5\u6d41\u7a0b</p> <p></p>"},{"location":"engine/spark/spark_04/#452","title":"4.5.2 \u96c6\u7fa4\u8fd0\u884c","text":"<p>1\uff09\u4fee\u6539\u4ee3\u7801\uff0c\u4fee\u6539\u8fd0\u884c\u6a21\u5f0f\uff0c\u5c06\u8f93\u51fa\u7684\u65b9\u6cd5\u4fee\u6539\u4e3a\u843d\u76d8\uff0c\u540c\u65f6\u8bbe\u7f6e\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7684\u4f20\u5165\u4f20\u51fa\u8def\u5f84</p> <pre><code>package com.atguigu;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\nimport java.util.Iterator;\nimport java.util.List;\n\npublic class WordCount {\npublic static void main(String[] args) {\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"yarn\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\n// \u8bfb\u53d6\u6570\u636e\nJavaRDD&lt;String&gt; javaRDD = sc.textFile(args[0]);\n\n// \u957f\u5b57\u7b26\u4e32\u5207\u5206\u4e3a\u5355\u4e2a\u5355\u8bcd\nJavaRDD&lt;String&gt; flatMapRDD = javaRDD.flatMap(new FlatMapFunction&lt;String, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(String s) throws Exception {\nList&lt;String&gt; strings = Arrays.asList(s.split(\" \"));\nreturn strings.iterator();\n}\n});\n\n// \u8f6c\u6362\u683c\u5f0f\u4e3a  (\u5355\u8bcd,1)\nJavaPairRDD&lt;String, Integer&gt; pairRDD = flatMapRDD.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\n// \u5408\u5e76\u76f8\u540c\u5355\u8bcd\nJavaPairRDD&lt;String, Integer&gt; javaPairRDD = pairRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n});\n\njavaPairRDD.saveAsTextFile(args[1]);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p></p> <p>\uff082\uff09\u5c06 WordCount.jar \u4e0a\u4f20\u5230 /opt/module/spark-yarn \u76ee\u5f55</p> <p>\uff083\uff09\u5728 HDFS \u4e0a\u521b\u5efa\uff0c\u5b58\u50a8\u8f93\u5165\u6587\u4ef6\u7684\u8def\u5f84 /input</p> <pre><code> hadoop fs -mkdir /input\n</code></pre> <p>\uff084\uff09\u4e0a\u4f20\u8f93\u5165\u6587\u4ef6\u5230 /input \u8def\u5f84</p> <pre><code>hadoop fs -put /opt/software /input\n</code></pre> <p>\uff085\uff09\u6267\u884c\u4efb\u52a1</p> <pre><code>bin/spark-submit \\\n--class com.atguigu.spark.WordCount \\\n--master yarn \\\n./WordCount.jar \\\n/input \\\n/output\n</code></pre> <p>\u6ce8\u610f\uff1ainput \u548c ouput \u90fd\u662f HDFS \u4e0a\u7684\u96c6\u7fa4\u8def\u5f84\u3002</p> <p>\uff086\uff09\u67e5\u8be2\u8fd0\u884c\u7ed3\u679c</p> <pre><code>hadoop fs -cat /output/*\n</code></pre>"},{"location":"engine/spark/spark_04/#46-rdd","title":"4.6 RDD\u5e8f\u5217\u5316","text":"<p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u6211\u4eec\u5f80\u5f80\u9700\u8981\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e9b\u5bf9\u4e8e RDD \u7684\u64cd\u4f5c\uff0c\u90a3\u4e48\u6b64\u65f6\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u521d\u59cb\u5316\u5de5\u4f5c\u662f\u5728 Driver \u7aef\u8fdb\u884c\u7684\uff0c\u800c\u5b9e\u9645\u8fd0\u884c\u7a0b\u5e8f\u662f\u5728 Executor \u7aef\u8fdb\u884c\u7684\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230\u4e86\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff0c\u662f\u9700\u8981\u5e8f\u5217\u5316\u7684\u3002\u4e0b\u9762\u6211\u4eec\u770b\u51e0\u4e2a\u4f8b\u5b50\uff1a</p>"},{"location":"engine/spark/spark_04/#461","title":"4.6.1 \u5e8f\u5217\u5316\u5f02\u5e38","text":"<p>0\uff09\u521b\u5efa\u5305\u540d\uff1a com.atguigu.serializable 1\uff09\u521b\u5efa\u4f7f\u7528\u7684 javaBean\uff1aUser</p> <pre><code>package com.atguigu.bean;\n\nimport java.io.Serializable;\n\npublic class User implements Serializable {\nprivate String name;\nprivate Integer age;\n\npublic User(String name, Integer age) {\nthis.name = name;\nthis.age = age;\n}\n\npublic User() {\n}\n\n\npublic String getName() {\nreturn name;\n}\n\npublic void setName(String name) {\nthis.name = name;\n}\n\npublic Integer getAge() {\nreturn age;\n}\n\npublic void setAge(Integer age) {\nthis.age = age;\n}\n\n@Override\npublic String toString() {\nreturn \"User{\" +\n\"name='\" + name + '\\'' +\n\", age=\" + age +\n'}';\n}\n}\n</code></pre> <p>2\uff09\u521b\u5efa\u7c7b\uff1aTest01_Ser \u6d4b\u8bd5\u5e8f\u5217\u5316</p> <pre><code>package com.atguigu.serializable;\n\nimport com.atguigu.bean.User;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\n\nimport java.util.Arrays;\n\npublic class Test01_Ser {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nUser zhangsan = new User(\"zhangsan\", 13);\nUser lisi = new User(\"lisi\", 13);\n\nJavaRDD&lt;User&gt; userJavaRDD = sc.parallelize(Arrays.asList(zhangsan, lisi), 2);\n\nJavaRDD&lt;User&gt; mapRDD = userJavaRDD.map(new Function&lt;User, User&gt;() {\n@Override\npublic User call(User v1) throws Exception {\nreturn new User(v1.getName(), v1.getAge() + 1);\n}\n});\n\nmapRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#462-kryo","title":"4.6.2 Kryo\u5e8f\u5217\u5316\u6846\u67b6","text":"<p>\u53c2\u8003\u5730\u5740</p> <p>Java \u7684\u5e8f\u5217\u5316\u80fd\u591f\u5e8f\u5217\u5316\u4efb\u4f55\u7c7b\u3002\u4f46\u662f\u6bd4\u8f83\u91cd\uff0c\u5e8f\u5217\u5316\u540e\u5bf9\u8c61\u7684\u4f53\u79ef\u4e5f\u6bd4\u8f83\u5927\u3002</p> <p>Spark \u51fa\u4e8e\u6027\u80fd\u7684\u8003\u8651\uff0cSpark2.0 \u5f00\u59cb\u652f\u6301\u53e6\u5916\u4e00\u79cd Kryo \u5e8f\u5217\u5316\u673a\u5236\u3002Kryo \u901f\u5ea6\u662f Serializable \u7684 10 \u500d\u3002\u5f53 RDD \u5728 Shuffle \u6570\u636e\u7684\u65f6\u5019\uff0c\u7b80\u5355\u6570\u636e\u7c7b\u578b\u3001\u6570\u7ec4\u548c\u5b57\u7b26\u4e32\u7c7b\u578b\u5df2\u7ecf\u5728 Spark \u5185\u90e8\u4f7f\u7528 Kryo \u5e8f\u5217\u5316\u3002</p> <pre><code>package com.atguigu.serializable;\n\nimport com.atguigu.bean.User;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\n\nimport java.util.Arrays;\n\npublic class Test02_Kryo {\npublic static void main(String[] args) throws ClassNotFoundException {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\")\n// \u66ff\u6362\u9ed8\u8ba4\u7684\u5e8f\u5217\u5316\u673a\u5236\n.set(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\")\n// \u6ce8\u518c\u9700\u8981\u4f7f\u7528kryo\u5e8f\u5217\u5316\u7684\u81ea\u5b9a\u4e49\u7c7b\n.registerKryoClasses(new Class[]{Class.forName(\"com.atguigu.bean.User\")});\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nUser zhangsan = new User(\"zhangsan\", 13);\nUser lisi = new User(\"lisi\", 13);\n\nJavaRDD&lt;User&gt; userJavaRDD = sc.parallelize(Arrays.asList(zhangsan, lisi), 2);\n\nJavaRDD&lt;User&gt; mapRDD = userJavaRDD.map(new Function&lt;User, User&gt;() {\n@Override\npublic User call(User v1) throws Exception {\nreturn new User(v1.getName(), v1.getAge() + 1);\n}\n});\n\nmapRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#47-rdd","title":"4.7 RDD\u4f9d\u8d56\u5173\u7cfb","text":""},{"location":"engine/spark/spark_04/#471","title":"4.7.1 \u67e5\u770b\u8840\u7f18\u5173\u7cfb","text":"<p>RDD \u53ea\u652f\u6301\u7c97\u7c92\u5ea6\u8f6c\u6362\uff0c\u5373\u5728\u5927\u91cf\u8bb0\u5f55\u4e0a\u6267\u884c\u7684\u5355\u4e2a\u64cd\u4f5c\u3002\u5c06\u521b\u5efa RDD \u7684\u4e00\u7cfb\u5217 Lineage\uff08\u8840\u7edf\uff09\u8bb0\u5f55\u4e0b\u6765\uff0c\u4ee5\u4fbf\u6062\u590d\u4e22\u5931\u7684\u5206\u533a\u3002RDD \u7684 Lineage \u4f1a\u8bb0\u5f55 RDD \u7684\u5143\u6570\u636e\u4fe1\u606f\u548c\u8f6c\u6362\u884c\u4e3a\uff0c\u5f53\u8be5 RDD \u7684\u90e8\u5206\u5206\u533a\u6570\u636e\u4e22\u5931\u65f6\uff0c\u5b83\u53ef\u4ee5\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u6765\u91cd\u65b0\u8fd0\u7b97\u548c\u6062\u590d\u4e22\u5931\u7684\u6570\u636e\u5206\u533a\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>\u901a\u8fc7 <code>toDebugString</code> \u65b9\u6cd5\uff0c\u67e5\u770b RDD \u8840\u7f18\u5173\u7cfb</p> <p>0\uff09\u521b\u5efa\u5305\u540d\uff1a com.atguigu.dependency</p> <p>1\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.dependency;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\nimport java.util.Iterator;\nimport java.util.List;\n\npublic class Test01_Dep {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/2.txt\");\nSystem.out.println(lineRDD.toDebugString());\nSystem.out.println(\"-------------------\");\n\nJavaRDD&lt;String&gt; wordRDD = lineRDD.flatMap(new FlatMapFunction&lt;String, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(String s) throws Exception {\nList&lt;String&gt; stringList = Arrays.asList(s.split(\" \"));\nreturn stringList.iterator();\n}\n});\nSystem.out.println(wordRDD.toDebugString());\nSystem.out.println(\"-------------------\");\n\nJavaPairRDD&lt;String, Integer&gt; tupleRDD = wordRDD.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\nSystem.out.println(tupleRDD.toDebugString());\nSystem.out.println(\"-------------------\");\n\nJavaPairRDD&lt;String, Integer&gt; wordCountRDD = tupleRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n});\nSystem.out.println(wordCountRDD.toDebugString());\nSystem.out.println(\"-------------------\");\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>2\uff09\u6253\u5370\u7ed3\u679c</p> <pre><code>(2) input/2.txt MapPartitionsRDD[1] at textFile at Test01_Dep.java:29 []\n|  input/2.txt HadoopRDD[0] at textFile at Test01_Dep.java:29 []\n(2) MapPartitionsRDD[2] at flatMap at Test01_Dep.java:32 []\n|  input/2.txt MapPartitionsRDD[1] at textFile at Test01_Dep.java:29 []\n|  input/2.txt HadoopRDD[0] at textFile at Test01_Dep.java:29 []\n(2) MapPartitionsRDD[3] at mapToPair at Test01_Dep.java:42 []\n|  MapPartitionsRDD[2] at flatMap at Test01_Dep.java:32 []\n|  input/2.txt MapPartitionsRDD[1] at textFile at Test01_Dep.java:29 []\n|  input/2.txt HadoopRDD[0] at textFile at Test01_Dep.java:29 []\n(2) ShuffledRDD[4] at reduceByKey at Test01_Dep.java:50 []\n+-(2) MapPartitionsRDD[3] at mapToPair at Test01_Dep.java:42 []\n|  MapPartitionsRDD[2] at flatMap at Test01_Dep.java:32 []\n|  input/2.txt MapPartitionsRDD[1] at textFile at Test01_Dep.java:29 []\n|  input/2.txt HadoopRDD[0] at textFile at Test01_Dep.java:29 []\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5706\u62ec\u53f7\u4e2d\u7684\u6570\u5b57\u8868\u793a RDD \u7684\u5e76\u884c\u5ea6\uff0c\u4e5f\u5c31\u662f\u6709\u51e0\u4e2a\u5206\u533a</p>"},{"location":"engine/spark/spark_04/#472","title":"4.7.2 \u7a84\u4f9d\u8d56","text":"<p>\u7a84\u4f9d\u8d56\u8868\u793a\u6bcf\u4e00\u4e2a\u7236 RDD \u7684 Partition \u6700\u591a\u88ab\u5b50 RDD \u7684\u4e00\u4e2a Partition \u4f7f\u7528\uff08\u4e00\u5bf9\u4e00or\u591a\u5bf9\u4e00\uff09\uff0c\u7a84\u4f9d\u8d56\u6211\u4eec\u5f62\u8c61\u7684\u6bd4\u55bb\u4e3a\u72ec\u751f\u5b50\u5973\u3002</p> <p></p>"},{"location":"engine/spark/spark_04/#473","title":"4.7.3 \u5bbd\u4f9d\u8d56","text":"<p>\u5bbd\u4f9d\u8d56\u8868\u793a\u540c\u4e00\u4e2a\u7236 RDD \u7684 Partition \u88ab\u591a\u4e2a\u5b50 RDD \u7684 Partition \u4f9d\u8d56\uff08\u53ea\u80fd\u662f\u4e00\u5bf9\u591a\uff09\uff0c\u4f1a\u5f15\u8d77 Shuffle\uff0c\u603b\u7ed3\uff1a\u5bbd\u4f9d\u8d56\u6211\u4eec\u5f62\u8c61\u7684\u6bd4\u55bb\u4e3a\u8d85\u751f\u3002</p> <p></p> <p>\u5177\u6709\u5bbd\u4f9d\u8d56\u7684 transformations \u5305\u62ec\uff1asort\u3001reduceByKey\u3001groupByKey\u3001join \u548c\u8c03\u7528 rePartition \u51fd\u6570\u7684\u4efb\u4f55\u64cd\u4f5c\u3002 \u5bbd\u4f9d\u8d56\u5bf9 Spark \u53bb\u8bc4\u4f30\u4e00\u4e2a transformations \u6709\u66f4\u52a0\u91cd\u8981\u7684\u5f71\u54cd\uff0c\u6bd4\u5982\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u3002 \u5728\u4e0d\u5f71\u54cd\u4e1a\u52a1\u8981\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u4f7f\u7528\u6709\u5bbd\u4f9d\u8d56\u7684\u8f6c\u6362\u7b97\u5b50\uff0c\u56e0\u4e3a\u6709\u5bbd\u4f9d\u8d56\uff0c\u5c31\u4e00\u5b9a\u4f1a\u8d70 shuffle\uff0c\u5f71\u54cd\u6027\u80fd\u3002</p>"},{"location":"engine/spark/spark_04/#474-stage","title":"4.7.4 Stage\u4efb\u52a1\u5212\u5206","text":"<p>1\uff09DAG \u6709\u5411\u65e0\u73af\u56fe DAG\uff08Directed Acyclic Graph\uff09\u6709\u5411\u65e0\u73af\u56fe\u662f\u7531\u70b9\u548c\u7ebf\u7ec4\u6210\u7684\u62d3\u6251\u56fe\u5f62\uff0c\u8be5\u56fe\u5f62\u5177\u6709\u65b9\u5411\uff0c\u4e0d\u4f1a\u95ed\u73af\u3002\u4f8b\u5982\uff0c DAG \u8bb0\u5f55\u4e86 RDD \u7684\u8f6c\u6362\u8fc7\u7a0b\u548c\u4efb\u52a1\u7684\u9636\u6bb5\u3002</p> <p></p> <p>2\uff09\u4efb\u52a1\u8fd0\u884c\u7684\u6574\u4f53\u6d41\u7a0b</p> <p> </p> YarnClient\u8fd0\u884c\u6a21\u5f0f <p></p> <p>3\uff09RDD\u4efb\u52a1\u5207\u5206\u4e2d\u95f4\u5206\u4e3a\uff1aApplication\u3001Job\u3001Stage\u548cTask</p> <ul> <li>Application\uff1a\u521d\u59cb\u5316\u4e00\u4e2a SparkContext \u5373\u751f\u6210\u4e00\u4e2a Application\uff1b</li> <li>Job\uff1a\u4e00\u4e2a Action \u7b97\u5b50\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a Job\uff1b</li> <li>Stage\uff1aStage \u7b49\u4e8e\u5bbd\u4f9d\u8d56\u7684\u4e2a\u6570\u52a0 1\uff1b</li> <li>Task\uff1a\u4e00\u4e2a Stage \u9636\u6bb5\u4e2d\uff0c\u6700\u540e\u4e00\u4e2a RDD \u7684\u5206\u533a\u4e2a\u6570\u5c31\u662f Task \u7684\u4e2a\u6570\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>Application -&gt; Job -&gt; Stage -&gt; Task \u6bcf\u4e00\u5c42\u90fd\u662f 1 \u5bf9 n \u7684\u5173\u7cfb\u3002</p> <p></p> <p>4\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.dependency;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\nimport java.util.Iterator;\nimport java.util.List;\n\npublic class Test02_Dep {\npublic static void main(String[] args) throws InterruptedException {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/2.txt\");\nSystem.out.println(lineRDD.toDebugString());\nSystem.out.println(\"-------------------\");\n\nJavaRDD&lt;String&gt; wordRDD = lineRDD.flatMap(new FlatMapFunction&lt;String, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(String s) throws Exception {\nList&lt;String&gt; stringList = Arrays.asList(s.split(\" \"));\nreturn stringList.iterator();\n}\n});\nSystem.out.println(wordRDD);\nSystem.out.println(\"-------------------\");\n\nJavaPairRDD&lt;String, Integer&gt; tupleRDD = wordRDD.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\nSystem.out.println(tupleRDD.toDebugString());\nSystem.out.println(\"-------------------\");\n\n// \u7f29\u51cf\u5206\u533a\nJavaPairRDD&lt;String, Integer&gt; coalesceRDD = tupleRDD.coalesce(1);\n\nJavaPairRDD&lt;String, Integer&gt; wordCountRDD = coalesceRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n},4);\nSystem.out.println(wordCountRDD.toDebugString());\nSystem.out.println(\"-------------------\");\n\nwordCountRDD. collect().forEach(System.out::println);\nwordCountRDD. collect().forEach(System.out::println);\n\nThread.sleep(600000);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>5\uff09\u67e5\u770b Job \u4e2a\u6570</p> <p>\u67e5\u770b http://localhost:4040/jobs/\uff0c\u53d1\u73b0 Job \u6709\u4e24\u4e2a\u3002</p> <p></p> <p>6\uff09\u67e5\u770b Stage \u4e2a\u6570</p> <p>\u67e5\u770b Job0 \u7684 Stage\u3002\u7531\u4e8e\u53ea\u6709 1 \u4e2a Shuffle \u9636\u6bb5\uff0c\u6240\u4ee5 Stage \u4e2a\u6570\u4e3a 2\u3002</p> <p></p> <p></p> <p>\u67e5\u770b Job1 \u7684 Stage\u3002\u7531\u4e8e\u53ea\u6709 1 \u4e2a Shuffle \u9636\u6bb5\uff0c\u6240\u4ee5 Stage \u4e2a\u6570\u4e3a 2\u3002</p> <p></p> <p></p> <p>7\uff09Task \u4e2a\u6570</p> <p>\u67e5\u770b Job0 \u7684 Stage0 \u7684 Task \u4e2a\u6570\uff0c2 \u4e2a\u3002</p> <p></p> <p>\u67e5\u770b Job0 \u7684 Stage1 \u7684 Task \u4e2a\u6570\uff0c2 \u4e2a\u3002</p> <p></p> <p></p> <p>\u67e5\u770b Job1 \u7684 Stage2 \u7684 Task \u4e2a\u6570\uff0c0\u4e2a\uff082\u4e2a\u8df3\u8fc7skipped\uff09\u3002</p> <p></p> <p>\u67e5\u770b Job1 \u7684 Stage3 \u7684 Task \u4e2a\u6570\uff0c2 \u4e2a\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u5b58\u5728 shuffle \u8fc7\u7a0b\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u8fdb\u884c\u7f13\u5b58\uff0cUI \u754c\u9762\u663e\u793a skipped \u7684\u90e8\u5206\u3002</p>"},{"location":"engine/spark/spark_04/#48-rdd","title":"4.8 RDD\u6301\u4e45\u5316","text":""},{"location":"engine/spark/spark_04/#481-rdd-cache","title":"4.8.1 RDD Cache\u7f13\u5b58","text":"<p>RDD \u901a\u8fc7 Cache \u6216\u8005 Persist \u65b9\u6cd5\u5c06\u524d\u9762\u7684\u8ba1\u7b97\u7ed3\u679c\u7f13\u5b58\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u628a\u6570\u636e\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u7f13\u5b58\u5728 JVM \u7684\u5806\u5185\u5b58\u4e2d\u3002\u4f46\u662f\u5e76\u4e0d\u662f\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\u7acb\u5373\u7f13\u5b58\uff0c\u800c\u662f\u89e6\u53d1\u540e\u9762\u7684 action \u7b97\u5b50\u65f6\uff0c\u8be5 RDD \u5c06\u4f1a\u88ab\u7f13\u5b58\u5728\u8ba1\u7b97\u8282\u70b9\u7684\u5185\u5b58\u4e2d\uff0c\u5e76\u4f9b\u540e\u9762\u91cd\u7528\u3002</p> <p></p> <p>0\uff09\u521b\u5efa\u5305\u540d\uff1a com.atguigu.cache</p> <p>1\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.cache;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\nimport java.util.Iterator;\nimport java.util.List;\n\npublic class Test01_Cache {\npublic static void main(String[] args) throws InterruptedException {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/2.txt\");\n\n\n//3.1.\u4e1a\u52a1\u903b\u8f91\nJavaRDD&lt;String&gt; wordRDD = lineRDD.flatMap(new FlatMapFunction&lt;String, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(String s) throws Exception {\nList&lt;String&gt; stringList = Arrays.asList(s.split(\" \"));\nreturn stringList.iterator();\n}\n});\n\nJavaRDD&lt;Tuple2&lt;String, Integer&gt;&gt; tuple2JavaRDD = wordRDD.map(new Function&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String v1) throws Exception {\nSystem.out.println(\"*****************\");\nreturn new Tuple2&lt;&gt;(v1, 1);\n}\n});\n\n//3.5 cache\u7f13\u5b58\u524d\u6253\u5370\u8840\u7f18\u5173\u7cfb\nSystem.out.println(tuple2JavaRDD.toDebugString());\n\n//3.4 \u6570\u636e\u7f13\u5b58\u3002\n//cache\u5e95\u5c42\u8c03\u7528\u7684\u5c31\u662fpersist\u65b9\u6cd5,\u7f13\u5b58\u7ea7\u522b\u9ed8\u8ba4\u7528\u7684\u662fMEMORY_ONLY\ntuple2JavaRDD.cache();\n\n//3.6 persist\u65b9\u6cd5\u53ef\u4ee5\u66f4\u6539\u5b58\u50a8\u7ea7\u522b\n// wordToOneRdd.persist(StorageLevel.MEMORY_AND_DISK_2)\n\n//3.2 \u89e6\u53d1\u6267\u884c\u903b\u8f91\ntuple2JavaRDD. collect().forEach(System.out::println);\n\n//3.5 cache\u7f13\u5b58\u540e\u6253\u5370\u8840\u7f18\u5173\u7cfb\n//cache\u64cd\u4f5c\u4f1a\u589e\u52a0\u8840\u7f18\u5173\u7cfb\uff0c\u4e0d\u6539\u53d8\u539f\u6709\u7684\u8840\u7f18\u5173\u7cfb\nSystem.out.println(tuple2JavaRDD.toDebugString());\nSystem.out.println(\"=====================\");\n\n//3.3 \u518d\u6b21\u89e6\u53d1\u6267\u884c\u903b\u8f91\ntuple2JavaRDD. collect().forEach(System.out::println);\n\nThread.sleep(1000000);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>2\uff09\u6e90\u7801\u89e3\u6790</p> <pre><code>mapRdd.cache()\ndef cache(): this.type = persist()\ndef persist(): this.type = persist(StorageLevel.MEMORY_ONLY)\n\nobject StorageLevel {\nval NONE = new StorageLevel(false, false, false, false)\nval DISK_ONLY = new StorageLevel(true, false, false, false)\nval DISK_ONLY_2 = new StorageLevel(true, false, false, false, 2)\nval MEMORY_ONLY = new StorageLevel(false, true, false, true)\nval MEMORY_ONLY_2 = new StorageLevel(false, true, false, true, 2)\nval MEMORY_ONLY_SER = new StorageLevel(false, true, false, false)\nval MEMORY_ONLY_SER_2 = new StorageLevel(false, true, false, false, 2)\nval MEMORY_AND_DISK = new StorageLevel(true, true, false, true)\nval MEMORY_AND_DISK_2 = new StorageLevel(true, true, false, true, 2)\nval MEMORY_AND_DISK_SER = new StorageLevel(true, true, false, false)\nval MEMORY_AND_DISK_SER_2 = new StorageLevel(true, true, false, false, 2)\nval OFF_HEAP = new StorageLevel(true, true, true, false, 1)\n</code></pre> <p>\u6ce8\u610f\uff1a\u9ed8\u8ba4\u7684\u5b58\u50a8\u7ea7\u522b\u90fd\u662f\u4ec5\u5728\u5185\u5b58\u5b58\u50a8\u4e00\u4efd\u3002\u5728\u5b58\u50a8\u7ea7\u522b\u7684\u672b\u5c3e\u52a0\u4e0a \u201c_2\u201d \u8868\u793a\u6301\u4e45\u5316\u7684\u6570\u636e\u5b58\u4e3a\u4e24\u4efd\u3002</p> <p>SER\uff1a\u8868\u793a\u5e8f\u5217\u5316\u3002</p> <p></p> <p>\u7f13\u5b58\u6709\u53ef\u80fd\u4e22\u5931\uff0c\u6216\u8005\u5b58\u50a8\u4e8e\u5185\u5b58\u7684\u6570\u636e\u7531\u4e8e\u5185\u5b58\u4e0d\u8db3\u800c\u88ab\u5220\u9664\uff0cRDD \u7684\u7f13\u5b58\u5bb9\u9519\u673a\u5236\u4fdd\u8bc1\u4e86\u5373\u4f7f\u7f13\u5b58\u4e22\u5931\u4e5f\u80fd\u4fdd\u8bc1\u8ba1\u7b97\u7684\u6b63\u786e\u6267\u884c\u3002\u901a\u8fc7\u57fa\u4e8e RDD \u7684\u4e00\u7cfb\u5217\u8f6c\u6362\uff0c\u4e22\u5931\u7684\u6570\u636e\u4f1a\u88ab\u91cd\u7b97\uff0c\u7531\u4e8e RDD \u7684\u5404\u4e2a Partition \u662f\u76f8\u5bf9\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u8ba1\u7b97\u4e22\u5931\u7684\u90e8\u5206\u5373\u53ef\uff0c\u5e76\u4e0d\u9700\u8981\u91cd\u7b97\u5168\u90e8 Partition\u3002</p> <p>3\uff09\u81ea\u5e26\u7f13\u5b58\u7b97\u5b50</p> <p>Spark \u4f1a\u81ea\u52a8\u5bf9\u4e00\u4e9b Shuffle \u64cd\u4f5c\u7684\u4e2d\u95f4\u6570\u636e\u505a\u6301\u4e45\u5316\u64cd\u4f5c\uff08\u6bd4\u5982\uff1areduceByKey\uff09\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5f53\u4e00\u4e2a\u8282\u70b9 Shuffle \u5931\u8d25\u4e86\u907f\u514d\u91cd\u65b0\u8ba1\u7b97\u6574\u4e2a\u8f93\u5165\u3002\u4f46\u662f\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5982\u679c\u60f3\u91cd\u7528\u6570\u636e\uff0c\u4ecd\u7136\u5efa\u8bae\u8c03\u7528 persist \u6216 cache\u3002</p> <p>\u67e5\u770b\u524d\u9762 4.7.4 \u4f9d\u8d56\u5173\u7cfb\u4ee3\u7801\u7684 DAG \u56fe</p> <p>\u8bbf\u95ee http://localhost:4040/jobs/ \u9875\u9762\uff0c\u67e5\u770b\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e8c\u4e2a job \u7684 DAG \u56fe\u3002</p> <p>\u8bf4\u660e\uff1a\u589e\u52a0\u7f13\u5b58\u540e\u8840\u7f18\u4f9d\u8d56\u5173\u7cfb\u4ecd\u7136\u6709\uff0c\u4f46\u662f\uff0c\u7b2c\u4e8c\u4e2a job \u53d6\u7684\u6570\u636e\u662f\u4ece\u7f13\u5b58\u4e2d\u53d6\u7684\u3002</p> job0job1 <p></p> <p></p>"},{"location":"engine/spark/spark_04/#482-rdd-checkpoint","title":"4.8.2 RDD CheckPoint\u68c0\u67e5\u70b9","text":"<p>1\uff09\u68c0\u67e5\u70b9\uff1a\u662f\u901a\u8fc7\u5c06 RDD \u4e2d\u95f4\u7ed3\u679c\u5199\u5165\u78c1\u76d8</p> <p>2\uff09\u4e3a\u4ec0\u4e48\u8981\u505a\u68c0\u67e5\u70b9\uff1f \u7531\u4e8e\u8840\u7f18\u4f9d\u8d56\u8fc7\u957f\u4f1a\u9020\u6210\u5bb9\u9519\u6210\u672c\u8fc7\u9ad8\uff0c\u8fd9\u6837\u5c31\u4e0d\u5982\u5728\u4e2d\u95f4\u9636\u6bb5\u505a\u68c0\u67e5\u70b9\u5bb9\u9519\uff0c\u5982\u679c\u68c0\u67e5\u70b9\u4e4b\u540e\u6709\u8282\u70b9\u51fa\u73b0\u95ee\u9898\uff0c\u53ef\u4ee5\u4ece\u68c0\u67e5\u70b9\u5f00\u59cb\u91cd\u505a\u8840\u7f18\uff0c\u51cf\u5c11\u4e86\u5f00\u9500</p> <p>3\uff09\u68c0\u67e5\u70b9\u5b58\u50a8\u8def\u5f84\uff1aCheckpoint \u7684\u6570\u636e\u901a\u5e38\u662f\u5b58\u50a8\u5728 HDFS\u7b49\u5bb9\u9519\u3001\u9ad8\u53ef\u7528\u7684\u6587\u4ef6\u7cfb\u7edf</p> <p>4\uff09\u68c0\u67e5\u70b9\u6570\u636e\u5b58\u50a8\u683c\u5f0f\u4e3a\uff1a\u4e8c\u8fdb\u5236\u7684\u6587\u4ef6</p> <p>5\uff09\u68c0\u67e5\u70b9\u5207\u65ad\u8840\u7f18\uff1a\u5728 Checkpoint \u7684\u8fc7\u7a0b\u4e2d\uff0c\u8be5 RDD \u7684\u6240\u6709\u4f9d\u8d56\u4e8e\u7236 RDD \u4e2d\u7684\u4fe1\u606f\u5c06\u5168\u90e8\u88ab\u79fb\u9664</p> <p>6\uff09\u68c0\u67e5\u70b9\u89e6\u53d1\u65f6\u95f4\uff1a\u5bf9 RDD \u8fdb\u884c Checkpoint \u64cd\u4f5c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u88ab\u6267\u884c\uff0c\u5fc5\u987b\u6267\u884c Action \u64cd\u4f5c\u624d\u80fd\u89e6\u53d1\u3002\u4f46\u662f\u68c0\u67e5\u70b9\u4e3a\u4e86\u6570\u636e\u5b89\u5168\uff0c\u4f1a\u4ece\u8840\u7f18\u5173\u7cfb\u7684\u6700\u5f00\u59cb\u6267\u884c\u4e00\u904d\u3002</p> <p></p> <p>7\uff09\u8bbe\u7f6e\u68c0\u67e5\u70b9\u6b65\u9aa4</p> <p>\uff081\uff09\u8bbe\u7f6e\u68c0\u67e5\u70b9\u6570\u636e\u5b58\u50a8\u8def\u5f84\uff1asc.setCheckpointDir(\"./checkpoint1\")</p> <p>\uff082\uff09\u8c03\u7528\u68c0\u67e5\u70b9\u65b9\u6cd5\uff1awordToOneRdd.checkpoint()</p> <p>8\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.cache;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\npublic class Test02_CheckPoint {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\nsc.setCheckpointDir(\"ck\");\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/2.txt\");\n\nJavaPairRDD&lt;String, Long&gt; tupleRDD = lineRDD.mapToPair(new PairFunction&lt;String, String, Long&gt;() {\n@Override\npublic Tuple2&lt;String, Long&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;String, Long&gt;(s, System.currentTimeMillis());\n}\n});\n\n// \u67e5\u770b\u8840\u7f18\u5173\u7cfb\nSystem.out.println(tupleRDD.toDebugString());\n\n// \u589e\u52a0\u68c0\u67e5\u70b9\u907f\u514d\u8ba1\u7b97\u4e24\u6b21\ntupleRDD.cache();\n\n// \u8fdb\u884c\u68c0\u67e5\u70b9\ntupleRDD.checkpoint();\n\ntupleRDD. collect().forEach(System.out::println);\n\nSystem.out.println(tupleRDD.toDebugString());\n// \u7b2c\u4e8c\u6b21\u8ba1\u7b97\ntupleRDD. collect().forEach(System.out::println);\n// \u7b2c\u4e09\u6b21\u8ba1\u7b97\ntupleRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>9\uff09\u6267\u884c\u7ed3\u679c</p> <p>\u8bbf\u95ee http://localhost:4040/jobs/ \u9875\u9762\uff0c\u67e5\u770b 4 \u4e2a job \u7684 DAG \u56fe\u3002\u5176\u4e2d\u7b2c 2 \u4e2a\u56fe\u662f checkpoint \u7684 job \u8fd0\u884c DAG \u56fe\u3002\u7b2c 3\u30014 \u5f20\u56fe\u8bf4\u660e\uff0c\u68c0\u67e5\u70b9\u5207\u65ad\u4e86\u8840\u7f18\u4f9d\u8d56\u5173\u7cfb\u3002</p> stage0stage1stage2stage3 <p></p> <p></p> <p></p> <p></p> <p>\uff081\uff09\u53ea\u589e\u52a0 checkpoint\uff0c\u6ca1\u6709\u589e\u52a0 Cache \u7f13\u5b58\u6253\u5370</p> <p>\u200b   \u7b2c 1 \u4e2a job \u6267\u884c\u5b8c\uff0c\u89e6\u53d1\u4e86 checkpoint\uff0c\u7b2c 2 \u4e2a job \u8fd0\u884c checkpoint\uff0c\u5e76\u628a\u6570\u636e\u5b58\u50a8\u5728\u68c0\u67e5\u70b9\u4e0a\u3002\u7b2c 3\u30014 \u4e2a job\uff0c\u6570\u636e\u4ece\u68c0\u67e5\u70b9\u4e0a\u76f4\u63a5\u8bfb\u53d6\u3002</p> <pre><code>(hadoop,1577960215526)\n\u3002\u3002\u3002\u3002\u3002\u3002\n(hello,1577960215526)\n(hadoop,1577960215609)\n\u3002\u3002\u3002\u3002\u3002\u3002\n(hello,1577960215609)\n(hadoop,1577960215609)\n\u3002\u3002\u3002\u3002\u3002\u3002\n(hello,1577960215609)\n</code></pre> <p>\uff082\uff09\u589e\u52a0 checkpoint\uff0c\u4e5f\u589e\u52a0 Cache \u7f13\u5b58\u6253\u5370</p> <p>\u200b   \u7b2c 1 \u4e2a job \u6267\u884c\u5b8c\uff0c\u6570\u636e\u5c31\u4fdd\u5b58\u5230 Cache \u91cc\u9762\u4e86\uff0c\u7b2c 2 \u4e2a job \u8fd0\u884c checkpoint\uff0c\u76f4\u63a5\u8bfb\u53d6 Cache \u91cc\u9762\u7684\u6570\u636e\uff0c\u5e76\u628a\u6570\u636e\u5b58\u50a8\u5728\u68c0\u67e5\u70b9\u4e0a\u3002\u7b2c 3\u30014 \u4e2a job\uff0c\u6570\u636e\u4ece\u68c0\u67e5\u70b9\u4e0a\u76f4\u63a5\u8bfb\u53d6\u3002</p> <pre><code>(hadoop,1577960642223)\n\u3002\u3002\u3002\u3002\u3002\u3002\n(hello,1577960642225)\n(hadoop,1577960642223)\n\u3002\u3002\u3002\u3002\u3002\u3002\n(hello,1577960642225)\n(hadoop,1577960642223)\n\u3002\u3002\u3002\u3002\u3002\u3002\n(hello,1577960642225)\n</code></pre> <p> </p> CheckPoint\u68c0\u67e5\u70b9+\u7f13\u5b58"},{"location":"engine/spark/spark_04/#483","title":"4.8.3 \u7f13\u5b58\u548c\u68c0\u67e5\u70b9\u533a\u522b","text":"<p>\uff081\uff09Cache \u7f13\u5b58\u53ea\u662f\u5c06\u6570\u636e\u4fdd\u5b58\u8d77\u6765\uff0c\u4e0d\u5207\u65ad\u8840\u7f18\u4f9d\u8d56\u3002Checkpoint \u68c0\u67e5\u70b9\u5207\u65ad\u8840\u7f18\u4f9d\u8d56\u3002</p> <p>\uff082\uff09Cache \u7f13\u5b58\u7684\u6570\u636e\u901a\u5e38\u5b58\u50a8\u5728\u78c1\u76d8\u3001\u5185\u5b58\u7b49\u5730\u65b9\uff0c\u53ef\u9760\u6027\u4f4e\u3002Checkpoint \u7684\u6570\u636e\u901a\u5e38\u5b58\u50a8\u5728 HDFS \u7b49\u5bb9\u9519\u3001\u9ad8\u53ef\u7528\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u9760\u6027\u9ad8\u3002</p> <p>\uff083\uff09\u5efa\u8bae\u5bf9 checkpoint() \u7684 RDD \u4f7f\u7528 Cache \u7f13\u5b58\uff0c\u8fd9\u6837 checkpoint \u7684 job \u53ea\u9700\u4ece Cache \u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u5373\u53ef\uff0c\u5426\u5219\u9700\u8981\u518d\u4ece\u5934\u8ba1\u7b97\u4e00\u6b21 RDD\u3002</p> <p>\uff084\uff09\u5982\u679c\u4f7f\u7528\u5b8c\u4e86\u7f13\u5b58\uff0c\u53ef\u4ee5\u901a\u8fc7 unpersist() \u65b9\u6cd5\u91ca\u653e\u7f13\u5b58\u3002</p>"},{"location":"engine/spark/spark_04/#484-hdfs","title":"4.8.4 \u68c0\u67e5\u70b9\u5b58\u50a8\u5230HDFS\u96c6\u7fa4","text":"<p>\u5982\u679c\u68c0\u67e5\u70b9\u6570\u636e\u5b58\u50a8\u5230 HDFS \u96c6\u7fa4\uff0c\u8981\u6ce8\u610f\u914d\u7f6e\u8bbf\u95ee\u96c6\u7fa4\u7684\u7528\u6237\u540d\u3002\u5426\u5219\u4f1a\u62a5\u8bbf\u95ee\u6743\u9650\u5f02\u5e38\u3002</p> <pre><code>package com.atguigu.cache;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\npublic class Test02_CheckPoint2 {\npublic static void main(String[] args) {\n\n// \u4fee\u6539\u7528\u6237\u540d\u79f0\nSystem.setProperty(\"HADOOP_USER_NAME\",\"atguigu\");\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// \u9700\u8981\u8bbe\u7f6e\u8def\u5f84.\u9700\u8981\u63d0\u524d\u5728HDFS\u96c6\u7fa4\u4e0a\u521b\u5efa/checkpoint\u8def\u5f84\nsc.setCheckpointDir(\"hdfs://hadoop102:8020/checkpoint\");\n\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/2.txt\");\n\nJavaPairRDD&lt;String, Long&gt; tupleRDD = lineRDD.mapToPair(new PairFunction&lt;String, String, Long&gt;() {\n@Override\npublic Tuple2&lt;String, Long&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;String, Long&gt;(s, System.currentTimeMillis());\n}\n});\n\n// \u67e5\u770b\u8840\u7f18\u5173\u7cfb\nSystem.out.println(tupleRDD.toDebugString());\n\n// \u589e\u52a0\u68c0\u67e5\u70b9\u907f\u514d\u8ba1\u7b97\u4e24\u6b21\ntupleRDD.cache();\n\n// \u8fdb\u884c\u68c0\u67e5\u70b9\ntupleRDD.checkpoint();\n\ntupleRDD. collect().forEach(System.out::println);\n\nSystem.out.println(tupleRDD.toDebugString());\n// \u7b2c\u4e8c\u6b21\u8ba1\u7b97\ntupleRDD. collect().forEach(System.out::println);\n// \u7b2c\u4e09\u6b21\u8ba1\u7b97\ntupleRDD. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#49-rdd","title":"4.9 \u952e\u503c\u5bf9RDD\u6570\u636e\u5206\u533a","text":"<p>Spark \u76ee\u524d\u652f\u6301 Hash \u5206\u533a\u3001Range \u5206\u533a\u548c\u7528\u6237\u81ea\u5b9a\u4e49\u5206\u533a\u3002Hash \u5206\u533a\u4e3a\u5f53\u524d\u7684\u9ed8\u8ba4\u5206\u533a\u3002\u5206\u533a\u5668\u76f4\u63a5\u51b3\u5b9a\u4e86 RDD \u4e2d\u5206\u533a\u7684\u4e2a\u6570\u3001RDD \u4e2d\u6bcf\u6761\u6570\u636e\u7ecf\u8fc7 Shuffle \u540e\u8fdb\u5165\u54ea\u4e2a\u5206\u533a\u548c Reduce \u7684\u4e2a\u6570\u3002</p> <p>\u6ce8\u610f</p> <p>\uff081\uff09\u53ea\u6709 Key-Value \u7c7b\u578b\u7684 pairRDD \u624d\u6709\u5206\u533a\u5668\uff0c\u975e Key-Value \u7c7b\u578b\u7684 RDD \u5206\u533a\u7684\u503c\u662f None</p> <p>\uff082\uff09\u6bcf\u4e2a RDD \u7684\u5206\u533a ID \u8303\u56f4\uff1a0~numPartitions-1\uff0c\u51b3\u5b9a\u8fd9\u4e2a\u503c\u662f\u5c5e\u4e8e\u90a3\u4e2a\u5206\u533a\u7684\u3002</p> <p>2\uff09\u83b7\u53d6 RDD \u5206\u533a</p> <p>\uff081\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.partitioner</p> <p>\uff082\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.partitioner;\n\nimport org.apache.spark.Partitioner;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.Optional;\nimport org.apache.spark.api.java.function.Function2;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test01_Partitioner {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaPairRDD&lt;String, Integer&gt; tupleRDD = sc.parallelizePairs(Arrays.asList(new Tuple2&lt;&gt;(\"s\", 1), new Tuple2&lt;&gt;(\"a\", 3), new Tuple2&lt;&gt;(\"d\", 2)));\n\n// \u83b7\u53d6\u5206\u533a\u5668\nOptional&lt;Partitioner&gt; partitioner = tupleRDD.partitioner();\n\nSystem.out.println(partitioner);\n\nJavaPairRDD&lt;String, Integer&gt; reduceByKeyRDD = tupleRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n});\n\n// \u83b7\u53d6\u5206\u533a\u5668\nOptional&lt;Partitioner&gt; partitioner1 = reduceByKeyRDD.partitioner();\nSystem.out.println(partitioner1);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_04/#491-hash","title":"4.9.1 Hash\u5206\u533a","text":""},{"location":"engine/spark/spark_04/#492-ranger","title":"4.9.2 Ranger\u5206\u533a","text":""},{"location":"engine/spark/spark_05/","title":"\u7b2c5\u7ae0 \u7d2f\u52a0\u5668","text":"<p>\u7d2f\u52a0\u5668\uff1a\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf\u3002\uff08 Executor \u548c Executor \u4e4b\u95f4\u4e0d\u80fd\u8bfb\u6570\u636e\uff09\u3002 \u7d2f\u52a0\u5668\u7528\u6765\u628a Executor \u7aef\u53d8\u91cf\u4fe1\u606f\u805a\u5408\u5230 Driver \u7aef\u3002\u5728 Driver \u4e2d\u5b9a\u4e49\u7684\u4e00\u4e2a\u53d8\u91cf\uff0c\u5728 Executor \u7aef\u7684\u6bcf\u4e2a task \u90fd\u4f1a\u5f97\u5230\u8fd9\u4e2a\u53d8\u91cf\u7684\u4e00\u4efd\u65b0\u7684\u526f\u672c\uff0c\u6bcf\u4e2a task \u66f4\u65b0\u8fd9\u4e9b\u526f\u672c\u7684\u503c\u540e\uff0c\u4f20\u56de Driver \u7aef\u8fdb\u884c\u5408\u5e76\u8ba1\u7b97\u3002</p> <p></p> <p>1\uff09\u7d2f\u52a0\u5668\u4f7f\u7528</p> <p>\u7d2f\u52a0\u5668\u5b9a\u4e49\uff08SparkContext.accumulator(initialValue)\u65b9\u6cd5\uff09</p> <p>LongAccumulator longAccumulator = JavaSparkContext.toSparkContext(sc).longAccumulator();    </p> <p>\u7d2f\u52a0\u5668\u6dfb\u52a0\u6570\u636e\uff08\u7d2f\u52a0\u5668.add\u65b9\u6cd5\uff09</p> <p>longAccumulator.add(stringIntegerTuple2._2);</p> <p>\u7d2f\u52a0\u5668\u83b7\u53d6\u6570\u636e\uff08\u7d2f\u52a0\u5668.value\uff09</p> <p>longAccumulator.value() </p> <p>2\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.accumulator</p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.accumulator;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.VoidFunction;\nimport org.apache.spark.util.LongAccumulator;\nimport scala.Tuple2;\n\nimport java.util.Arrays;\n\npublic class Test01_Acc {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaPairRDD&lt;String, Integer&gt; tupleRDD = sc.parallelizePairs(Arrays.asList(new Tuple2&lt;&gt;(\"a\", 1), new Tuple2&lt;&gt;(\"a\", 2), new Tuple2&lt;&gt;(\"a\", 3), new Tuple2&lt;&gt;(\"a\", 1)));\n\n// \u7edf\u8ba1wordCount\n// \u8d70shuffle \u6548\u7387\u4f4e\nJavaPairRDD&lt;String, Integer&gt; reduceByKeyRDD = tupleRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n});\n\n// \u4f7f\u7528\u53d8\u91cf\u65e0\u6cd5\u5b9e\u73b0\n/*\n        final int[] i = {0};\n\n        tupleRDD.foreach(new VoidFunction&lt;Tuple2&lt;String, Integer&gt;&gt;() {\n            @Override\n            public void call(Tuple2&lt;String, Integer&gt; stringIntegerTuple2) throws Exception {\n                i[0] += stringIntegerTuple2._2;\n            }\n        });\n\n        System.out.println(i[0]);\n         */\n\n// \u8f6c\u6362\u4e3ascala\u7684\u7d2f\u52a0\u5668\nLongAccumulator longAccumulator = JavaSparkContext.toSparkContext(sc).longAccumulator();\n\n// \u5728foreach\u4e2d\u4f7f\u7528\u7d2f\u52a0\u5668\ntupleRDD.foreach(new VoidFunction&lt;Tuple2&lt;String, Integer&gt;&gt;() {\n@Override\npublic void call(Tuple2&lt;String, Integer&gt; stringIntegerTuple2) throws Exception {\nlongAccumulator.add(stringIntegerTuple2._2);\n//  \u4e0d\u8981\u5728executor\u7aef\u83b7\u53d6\u7d2f\u52a0\u5668\u7684\u503c,\u56e0\u4e3a\u4e0d\u51c6\u786e \u56e0\u6b64\u6211\u4eec\u8bf4\u7d2f\u52a0\u5668\u53eb\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf\nSystem.out.println(longAccumulator.value());\n}\n});\n\nSystem.out.println(longAccumulator.value());\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre> <p>\u6ce8\u610f</p> <p>Executor \u7aef\u7684\u4efb\u52a1\u4e0d\u80fd\u8bfb\u53d6\u7d2f\u52a0\u5668\u7684\u503c\uff08\u4f8b\u5982\uff1a\u5728 Executor \u7aef\u8c03\u7528 sum.value\uff0c\u83b7\u53d6\u7684\u503c\u4e0d\u662f\u7d2f\u52a0\u5668\u6700\u7ec8\u7684\u503c\uff09\u3002\u56e0\u6b64\u6211\u4eec\u8bf4\uff0c\u7d2f\u52a0\u5668\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf\u3002</p> <p>\u7d2f\u52a0\u5668\u8981\u653e\u5728\u884c\u52a8\u7b97\u5b50\u4e2d</p> <p>\u56e0\u4e3a\u8f6c\u6362\u7b97\u5b50\u6267\u884c\u7684\u6b21\u6570\u53d6\u51b3\u4e8e job \u7684\u6570\u91cf\uff0c\u5982\u679c\u4e00\u4e2a spark \u5e94\u7528\u6709\u591a\u4e2a\u884c\u52a8\u7b97\u5b50\uff0c\u90a3\u4e48\u8f6c\u6362\u7b97\u5b50\u4e2d\u7684\u7d2f\u52a0\u5668\u53ef\u80fd\u4f1a\u53d1\u751f\u4e0d\u6b62\u4e00\u6b21\u66f4\u65b0\uff0c\u5bfc\u81f4\u7ed3\u679c\u9519\u8bef\u3002\u6240\u4ee5\uff0c\u5982\u679c\u60f3\u8981\u4e00\u4e2a\u65e0\u8bba\u5728\u5931\u8d25\u8fd8\u662f\u91cd\u590d\u8ba1\u7b97\u65f6\u90fd\u7edd\u5bf9\u53ef\u9760\u7684\u7d2f\u52a0\u5668\uff0c\u6211\u4eec\u5fc5\u987b\u628a\u5b83\u653e\u5728 foreach() \u8fd9\u6837\u7684\u884c\u52a8\u7b97\u5b50\u4e2d\u3002</p>"},{"location":"engine/spark/spark_06/","title":"\u7b2c6\u7ae0 \u5e7f\u64ad\u53d8\u91cf","text":"<p>\u5e7f\u64ad\u53d8\u91cf\uff1a\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u8bfb\u53d8\u91cf\u3002 \u5e7f\u64ad\u53d8\u91cf\u7528\u6765\u9ad8\u6548\u5206\u53d1\u8f83\u5927\u7684\u5bf9\u8c61\u3002\u5411\u6240\u6709\u5de5\u4f5c\u8282\u70b9\u53d1\u9001\u4e00\u4e2a\u8f83\u5927\u7684\u53ea\u8bfb\u503c\uff0c\u4ee5\u4f9b\u4e00\u4e2a\u6216\u591a\u4e2a Spark Task \u64cd\u4f5c\u4f7f\u7528\u3002\u6bd4\u5982\uff0c\u5982\u679c\u4f60\u7684\u5e94\u7528\u9700\u8981\u5411\u6240\u6709\u8282\u70b9\u53d1\u9001\u4e00\u4e2a\u8f83\u5927\u7684\u53ea\u8bfb\u67e5\u8be2\u8868\uff0c\u5e7f\u64ad\u53d8\u91cf\u7528\u8d77\u6765\u4f1a\u5f88\u987a\u624b\u3002\u5728\u591a\u4e2a Task \u5e76\u884c\u64cd\u4f5c\u4e2d\u4f7f\u7528\u540c\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f46\u662f Spark \u4f1a\u4e3a\u6bcf\u4e2a Task \u4efb\u52a1\u5206\u522b\u53d1\u9001\u3002</p> <p>1\uff09\u4f7f\u7528\u5e7f\u64ad\u53d8\u91cf\u6b65\u9aa4\uff1a</p> <p>\uff081\uff09\u8c03\u7528 SparkContext.broadcast\uff08\u5e7f\u64ad\u53d8\u91cf\uff09\u521b\u5efa\u51fa\u4e00\u4e2a\u5e7f\u64ad\u5bf9\u8c61\uff0c\u4efb\u4f55\u53ef\u5e8f\u5217\u5316\u7684\u7c7b\u578b\u90fd\u53ef\u4ee5\u8fd9\u4e48\u5b9e\u73b0\u3002 \uff082\uff09\u901a\u8fc7 \u5e7f\u64ad\u53d8\u91cf.value\uff0c\u8bbf\u95ee\u8be5\u5bf9\u8c61\u7684\u503c\u3002 \uff083\uff09\u5e7f\u64ad\u53d8\u91cf\u53ea\u4f1a\u88ab\u53d1\u5230\u5404\u4e2a\u8282\u70b9\u4e00\u6b21\uff0c\u4f5c\u4e3a\u53ea\u8bfb\u503c\u5904\u7406\uff08\u4fee\u6539\u8fd9\u4e2a\u503c\u4e0d\u4f1a\u5f71\u54cd\u5230\u522b\u7684\u8282\u70b9\uff09\u3002</p> <p>2\uff09\u539f\u7406\u8bf4\u660e</p> <p></p> <p>3\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.broadcast 4\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.accumulator;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.Function;\nimport org.apache.spark.broadcast.Broadcast;\n\nimport java.util.Arrays;\nimport java.util.List;\n\npublic class Test02_Broadcast {\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\");\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\nJavaRDD&lt;Integer&gt; intRDD = sc.parallelize(Arrays.asList(4, 56, 7, 8, 1, 2));\n\n// \u5e78\u8fd0\u6570\u5b57\nList&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5);\n\n// \u627e\u51fa\u5e78\u8fd0\u6570\u5b57\n// \u6bcf\u4e00\u4e2atask\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2alist\u6d6a\u8d39\u5185\u5b58\n/*\n        JavaRDD&lt;Integer&gt; result = intRDD.filter(new Function&lt;Integer, Boolean&gt;() {\n            @Override\n            public Boolean call(Integer v1) throws Exception {\n                return list.contains(v1);\n            }\n        });\n         */\n\n// \u521b\u5efa\u5e7f\u64ad\u53d8\u91cf\n// \u53ea\u53d1\u9001\u4e00\u4efd\u6570\u636e\u5230\u6bcf\u4e00\u4e2aexecutor\nBroadcast&lt;List&lt;Integer&gt;&gt; broadcast = sc.broadcast(list);\n\nJavaRDD&lt;Integer&gt; result = intRDD.filter(new Function&lt;Integer, Boolean&gt;() {\n@Override\npublic Boolean call(Integer v1) throws Exception {\nreturn broadcast.value().contains(v1);\n}\n});\n\nresult. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_07/","title":"\u7b2c5\u7ae0 SparkCore\u5b9e\u6218","text":""},{"location":"engine/spark/spark_07/#71","title":"7.1 \u6570\u636e\u51c6\u5907","text":"<p>1\uff09\u6570\u636e\u683c\u5f0f</p> <p></p> <p>2\uff09\u6570\u636e\u8be6\u7ec6\u5b57\u6bb5\u8bf4\u660e</p> \u7f16\u53f7 \u5b57\u6bb5\u540d\u79f0 \u5b57\u6bb5\u7c7b\u578b \u5b57\u6bb5\u542b\u4e49 1 date String \u7528\u6237\u70b9\u51fb\u884c\u4e3a\u7684\u65e5\u671f 2 user_id Long \u7528\u6237\u7684ID 3 session_id String Session\u7684ID 4 page_id Long \u67d0\u4e2a\u9875\u9762\u7684ID 5 action_time String \u52a8\u4f5c\u7684\u65f6\u95f4\u70b9 6 search_keyword String \u7528\u6237\u641c\u7d22\u7684\u5173\u952e\u8bcd 7 click_category_id Long \u70b9\u51fb\u67d0\u4e00\u4e2a\u5546\u54c1\u54c1\u7c7b\u7684ID 8 click_product_id Long \u67d0\u4e00\u4e2a\u5546\u54c1\u7684ID 9 order_category_ids String \u4e00\u6b21\u8ba2\u5355\u4e2d\u6240\u6709\u54c1\u7c7b\u7684ID\u96c6\u5408 10 order_product_ids String \u4e00\u6b21\u8ba2\u5355\u4e2d\u6240\u6709\u5546\u54c1\u7684ID\u96c6\u5408 11 pay_category_ids String \u4e00\u6b21\u652f\u4ed8\u4e2d\u6240\u6709\u54c1\u7c7b\u7684ID\u96c6\u5408 12 pay_product_ids String \u4e00\u6b21\u652f\u4ed8\u4e2d\u6240\u6709\u5546\u54c1\u7684ID\u96c6\u5408 13 city_id Long \u57ce\u5e02 id"},{"location":"engine/spark/spark_07/#72-top10","title":"7.2 \u9700\u6c42\uff1aTop10\u70ed\u95e8\u54c1\u7c7b","text":"<p>\u9700\u6c42\u8bf4\u660e\uff1a\u54c1\u7c7b\u662f\u6307\u4ea7\u54c1\u7684\u5206\u7c7b\uff0c\u5927\u578b\u7535\u5546\u7f51\u7ad9\u54c1\u7c7b\u5206\u591a\u7ea7\uff0c\u54b1\u4eec\u7684\u9879\u76ee\u4e2d\u54c1\u7c7b\u53ea\u6709\u4e00\u7ea7\uff0c\u4e0d\u540c\u7684\u516c\u53f8\u53ef\u80fd\u5bf9\u70ed\u95e8\u7684\u5b9a\u4e49\u4e0d\u4e00\u6837\u3002\u6211\u4eec\u6309\u7167\u6bcf\u4e2a\u54c1\u7c7b\u7684\u70b9\u51fb\u3001\u4e0b\u5355\u3001\u652f\u4ed8\u7684\u91cf\uff08\u6b21\u6570\uff09\u6765\u7edf\u8ba1\u70ed\u95e8\u54c1\u7c7b\u3002</p> <p>\u978b           \u70b9\u51fb\u6570 \u4e0b\u5355\u6570  \u652f\u4ed8\u6570 \u8863\u670d      \u70b9\u51fb\u6570 \u4e0b\u5355\u6570  \u652f\u4ed8\u6570 \u7535\u8111      \u70b9\u51fb\u6570 \u4e0b\u5355\u6570  \u652f\u4ed8\u6570 \u4f8b\u5982\uff0c\u7efc\u5408\u6392\u540d = \u70b9\u51fb\u6570*20% + \u4e0b\u5355\u6570*30% + \u652f\u4ed8\u6570*50% \u4e3a\u4e86\u66f4\u597d\u7684\u6cdb\u7528\u6027\uff0c\u5f53\u524d\u6848\u4f8b\u6309\u7167\u70b9\u51fb\u6b21\u6570\u8fdb\u884c\u6392\u5e8f\uff0c\u5982\u679c\u70b9\u51fb\u76f8\u540c\uff0c\u6309\u7167\u4e0b\u5355\u6570\uff0c\u5982\u679c\u4e0b\u5355\u8fd8\u662f\u76f8\u540c\uff0c\u6309\u7167\u652f\u4ed8\u6570\u3002</p>"},{"location":"engine/spark/spark_07/#721","title":"7.2.1 \u9700\u6c42\u5206\u6790\uff08\u65b9\u6848\u4e00\uff09\u7c7b\u5bf9\u8c61","text":"<p>\u91c7\u7528\u6837\u4f8b\u7c7b\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002</p>"},{"location":"engine/spark/spark_07/#722","title":"7.2.2 \u9700\u6c42\u5b9e\u73b0\uff08\u65b9\u6848\u4e00\uff09","text":"<p>1\uff09\u6dfb\u52a0 lombok \u7684\u63d2\u4ef6</p> <p></p> <p>2\uff09\u6dfb\u52a0\u4f9d\u8d56 lombok \u53ef\u4ee5\u7701\u7565 getset \u4ee3\u7801</p> pom.xml<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n&lt;artifactId&gt;lombok&lt;/artifactId&gt;\n&lt;version&gt;1.18.22&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>3\uff09\u521b\u5efa\u4e24\u4e2a\u5b58\u653e\u6570\u636e\u7684\u7c7b</p> <pre><code>package com.atguigu.spark.bean;\n\nimport lombok.Data;\n\nimport java.io.Serializable;\n\n@Data\npublic class UserVisitAction implements Serializable {\nprivate String date;\nprivate String user_id;\nprivate String session_id;\nprivate String page_id;\nprivate String action_time;\nprivate String search_keyword;\nprivate String click_category_id;\nprivate String click_product_id;\nprivate String order_category_ids;\nprivate String order_product_ids;\nprivate String pay_category_ids;\nprivate String pay_product_ids;\nprivate String city_id;\n\npublic UserVisitAction() {\n}\n\npublic UserVisitAction(String date, String user_id, String session_id, String page_id, String action_time, String search_keyword, String click_category_id, String click_product_id, String order_category_ids, String order_product_ids, String pay_category_ids, String pay_product_ids, String city_id) {\nthis.date = date;\nthis.user_id = user_id;\nthis.session_id = session_id;\nthis.page_id = page_id;\nthis.action_time = action_time;\nthis.search_keyword = search_keyword;\nthis.click_category_id = click_category_id;\nthis.click_product_id = click_product_id;\nthis.order_category_ids = order_category_ids;\nthis.order_product_ids = order_product_ids;\nthis.pay_category_ids = pay_category_ids;\nthis.pay_product_ids = pay_product_ids;\nthis.city_id = city_id;\n}\n\n}\n</code></pre> <pre><code>package com.atguigu.spark.bean;\n\nimport lombok.Data;\n\nimport java.io.Serializable;\n\n@Data\npublic class CategoryCountInfo implements Serializable, Comparable&lt;CategoryCountInfo&gt; {\nprivate String categoryId;\nprivate Long clickCount;\nprivate Long orderCount;\nprivate Long payCount;\n\npublic CategoryCountInfo() {\n}\n\npublic CategoryCountInfo(String categoryId, Long clickCount, Long orderCount, Long payCount) {\nthis.categoryId = categoryId;\nthis.clickCount = clickCount;\nthis.orderCount = orderCount;\nthis.payCount = payCount;\n}\n\n\n@Override\npublic int compareTo(CategoryCountInfo o) {\n// \u5c0f\u4e8e\u8fd4\u56de-1,\u7b49\u4e8e\u8fd4\u56de0,\u5927\u4e8e\u8fd4\u56de1\nif (this.getClickCount().equals(o.getClickCount())) {\nif (this.getOrderCount().equals(o.getOrderCount())) {\nif (this.getPayCount().equals(o.getPayCount())) {\nreturn 0;\n} else {\nreturn this.getPayCount() &lt; o.getPayCount() ? -1 : 1;\n}\n} else {\nreturn this.getOrderCount() &lt; o.getOrderCount() ? -1 : 1;\n}\n} else {\nreturn this.getClickCount() &lt; o.getClickCount() ? -1 : 1;\n}\n\n}\n}\n</code></pre> <p>4\uff09\u6838\u5fc3\u4e1a\u52a1\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.spark.demo;\n\nimport com.atguigu.spark.bean.CategoryCountInfo;\nimport com.atguigu.spark.bean.UserVisitAction;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function;\nimport scala.Tuple2;\nimport scala.Tuple3;\n\nimport java.util.ArrayList;\nimport java.util.Iterator;\n\npublic class Test01_Top10 {\npublic static void main(String[] args) throws ClassNotFoundException {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\")\n// \u66ff\u6362\u9ed8\u8ba4\u7684\u5e8f\u5217\u5316\u673a\u5236\n.set(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\")\n// \u6ce8\u518c\u9700\u8981\u4f7f\u7528kryo\u5e8f\u5217\u5316\u7684\u81ea\u5b9a\u4e49\u7c7b\n.registerKryoClasses(new Class[]{Class.forName(\"com.atguigu.spark.bean.CategoryCountInfo\"),Class.forName(\"com.atguigu.spark.bean.UserVisitAction\")});\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\n// \u5206\u4e09\u6b21\u8fdb\u884cwordCount \u6700\u540e\u4f7f\u7528cogroup\u5408\u5e76\u4e09\u7ec4\u6570\u636e\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/user_visit_action.txt\");\n\n// \u8f6c\u6362\u4e3a\u5bf9\u8c61\nJavaRDD&lt;UserVisitAction&gt; actionRDD = lineRDD.map(new Function&lt;String, UserVisitAction&gt;() {\n@Override\npublic UserVisitAction call(String v1) throws Exception {\nString[] data = v1.split(\"_\");\nreturn new UserVisitAction(\ndata[0],\ndata[1],\ndata[2],\ndata[3],\ndata[4],\ndata[5],\ndata[6],\ndata[7],\ndata[8],\ndata[9],\ndata[10],\ndata[11],\ndata[12]\n);\n}\n});\n\nJavaRDD&lt;CategoryCountInfo&gt; categoryCountInfoJavaRDD = actionRDD.flatMap(new FlatMapFunction&lt;UserVisitAction, CategoryCountInfo&gt;() {\n@Override\npublic Iterator&lt;CategoryCountInfo&gt; call(UserVisitAction userVisitAction) throws Exception {\nArrayList&lt;CategoryCountInfo&gt; countInfos = new ArrayList&lt;&gt;();\nif (!userVisitAction.getClick_category_id().equals(\"-1\")) {\n// \u5f53\u524d\u4e3a\u70b9\u51fb\u6570\u636e\ncountInfos.add(new CategoryCountInfo(userVisitAction.getClick_category_id(), 1L, 0L, 0L));\n} else if (!userVisitAction.getOrder_category_ids().equals(\"null\")) {\n// \u5f53\u524d\u4e3a\u8ba2\u5355\u6570\u636e\nString[] orders = userVisitAction.getOrder_category_ids().split(\",\");\nfor (String order : orders) {\ncountInfos.add(new CategoryCountInfo(order, 0L, 1L, 0L));\n}\n} else if (!userVisitAction.getPay_category_ids().equals(\"null\")) {\n// \u5f53\u524d\u4e3a\u652f\u4ed8\u6570\u636e\nString[] pays = userVisitAction.getPay_category_ids().split(\",\");\nfor (String pay : pays) {\ncountInfos.add(new CategoryCountInfo(pay, 0L, 0L, 1L));\n}\n}\nreturn countInfos.iterator();\n}\n});\n\n// \u5408\u5e76\u76f8\u540c\u7684id\nJavaPairRDD&lt;String, Iterable&lt;CategoryCountInfo&gt;&gt; groupByRDD = categoryCountInfoJavaRDD.groupBy(new Function&lt;CategoryCountInfo, String&gt;() {\n@Override\npublic String call(CategoryCountInfo v1) throws Exception {\nreturn v1.getCategoryId();\n}\n});\n\nJavaRDD&lt;CategoryCountInfo&gt; countInfoJavaRDD = groupByRDD.map(new Function&lt;Tuple2&lt;String, Iterable&lt;CategoryCountInfo&gt;&gt;, CategoryCountInfo&gt;() {\n@Override\npublic CategoryCountInfo call(Tuple2&lt;String, Iterable&lt;CategoryCountInfo&gt;&gt; v1) throws Exception {\nCategoryCountInfo result = new CategoryCountInfo(v1._1, 0L, 0L, 0L);\n\nIterable&lt;CategoryCountInfo&gt; countInfos = v1._2;\n\nfor (CategoryCountInfo countInfo : countInfos) {\nresult.setClickCount(result.getClickCount() + countInfo.getClickCount());\nresult.setOrderCount(result.getOrderCount() + countInfo.getOrderCount());\nresult.setPayCount(result.getPayCount() + countInfo.getPayCount());\n}\n\nreturn result;\n}\n});\n\n// CategoryCountInfo\u9700\u8981\u80fd\u591f\u6bd4\u8f83\u5927\u5c0f\nJavaRDD&lt;CategoryCountInfo&gt; result = countInfoJavaRDD.sortBy(new Function&lt;CategoryCountInfo, CategoryCountInfo&gt;() {\n@Override\npublic CategoryCountInfo call(CategoryCountInfo v1) throws Exception {\nreturn v1;\n}\n}, false, 2);\n\nresult. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_07/#723","title":"7.2.3 \u9700\u6c42\u5206\u6790\uff08\u65b9\u6848\u4e8c\uff09\u7b97\u5b50\u4f18\u5316","text":"<p>\u9488\u5bf9\u65b9\u6848\u4e8c\u4e2d\u7684 groupBy \u7b97\u5b50\uff0c\u6ca1\u6709\u63d0\u524d\u805a\u5408\u7684\u529f\u80fd\uff0c\u66ff\u6362\u6210 reduceByKey\u3002</p>"},{"location":"engine/spark/spark_07/#724","title":"7.2.4 \u9700\u6c42\u5b9e\u73b0\uff08\u65b9\u6848\u4e8c\uff09","text":"<p>1\uff09\u6837\u4f8b\u7c7b\u4ee3\u7801\u548c\u65b9\u6848\u4e00\u7684\u4e00\u6837\u3002\uff08\u8be6\u89c1\u65b9\u6848\u4e00\uff09 2\uff09\u6838\u5fc3\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.spark.demo;\n\nimport com.atguigu.spark.bean.CategoryCountInfo;\nimport com.atguigu.spark.bean.UserVisitAction;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.JavaRDD;\nimport org.apache.spark.api.java.JavaSparkContext;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport scala.Tuple2;\n\nimport java.util.ArrayList;\nimport java.util.Iterator;\n\npublic class Test06_Top10 {\npublic static void main(String[] args) throws ClassNotFoundException {\n\n// 1.\u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkCore\")\n// \u66ff\u6362\u9ed8\u8ba4\u7684\u5e8f\u5217\u5316\u673a\u5236\n.set(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\")\n// \u6ce8\u518c\u9700\u8981\u4f7f\u7528kryo\u5e8f\u5217\u5316\u7684\u81ea\u5b9a\u4e49\u7c7b\n.registerKryoClasses(new Class[]{Class.forName(\"com.atguigu.spark.bean.CategoryCountInfo\"),Class.forName(\"com.atguigu.spark.bean.UserVisitAction\")});\n\n// 2. \u521b\u5efasparkContext\nJavaSparkContext sc = new JavaSparkContext(conf);\n\n// 3. \u7f16\u5199\u4ee3\u7801\n// \u5206\u4e09\u6b21\u8fdb\u884cwordCount \u6700\u540e\u4f7f\u7528cogroup\u5408\u5e76\u4e09\u7ec4\u6570\u636e\nJavaRDD&lt;String&gt; lineRDD = sc.textFile(\"input/user_visit_action.txt\");\n\n// \u8f6c\u6362\u4e3a\u5bf9\u8c61\nJavaRDD&lt;UserVisitAction&gt; actionRDD = lineRDD.map(new Function&lt;String, UserVisitAction&gt;() {\n@Override\npublic UserVisitAction call(String v1) throws Exception {\nString[] data = v1.split(\"_\");\nreturn new UserVisitAction(\ndata[0],\ndata[1],\ndata[2],\ndata[3],\ndata[4],\ndata[5],\ndata[6],\ndata[7],\ndata[8],\ndata[9],\ndata[10],\ndata[11],\ndata[12]\n);\n}\n});\n\nJavaRDD&lt;CategoryCountInfo&gt; categoryCountInfoJavaRDD = actionRDD.flatMap(new FlatMapFunction&lt;UserVisitAction, CategoryCountInfo&gt;() {\n@Override\npublic Iterator&lt;CategoryCountInfo&gt; call(UserVisitAction userVisitAction) throws Exception {\nArrayList&lt;CategoryCountInfo&gt; countInfos = new ArrayList&lt;&gt;();\nif (!userVisitAction.getClick_category_id().equals(\"-1\")) {\n// \u5f53\u524d\u4e3a\u70b9\u51fb\u6570\u636e\ncountInfos.add(new CategoryCountInfo(userVisitAction.getClick_category_id(), 1L, 0L, 0L));\n} else if (!userVisitAction.getOrder_category_ids().equals(\"null\")) {\n// \u5f53\u524d\u4e3a\u8ba2\u5355\u6570\u636e\nString[] orders = userVisitAction.getOrder_category_ids().split(\",\");\nfor (String order : orders) {\ncountInfos.add(new CategoryCountInfo(order, 0L, 1L, 0L));\n}\n} else if (!userVisitAction.getPay_category_ids().equals(\"null\")) {\n// \u5f53\u524d\u4e3a\u652f\u4ed8\u6570\u636e\nString[] pays = userVisitAction.getPay_category_ids().split(\",\");\nfor (String pay : pays) {\ncountInfos.add(new CategoryCountInfo(pay, 0L, 0L, 1L));\n}\n}\nreturn countInfos.iterator();\n}\n});\n\n// \u5408\u5e76\u76f8\u540c\u7684id\nJavaPairRDD&lt;String, CategoryCountInfo&gt; countInfoJavaPairRDD = categoryCountInfoJavaRDD.mapToPair(new PairFunction&lt;CategoryCountInfo, String, CategoryCountInfo&gt;() {\n@Override\npublic Tuple2&lt;String, CategoryCountInfo&gt; call(CategoryCountInfo categoryCountInfo) throws Exception {\nreturn new Tuple2&lt;&gt;(categoryCountInfo.getCategoryId(), categoryCountInfo);\n}\n});\n\nJavaPairRDD&lt;String, CategoryCountInfo&gt; countInfoPairRDD = countInfoJavaPairRDD.reduceByKey(new Function2&lt;CategoryCountInfo, CategoryCountInfo, CategoryCountInfo&gt;() {\n@Override\npublic CategoryCountInfo call(CategoryCountInfo v1, CategoryCountInfo v2) throws Exception {\nv1.setClickCount(v1.getClickCount() + v2.getClickCount());\nv1.setOrderCount(v1.getOrderCount() + v2.getOrderCount());\nv1.setPayCount(v1.getPayCount() + v2.getPayCount());\nreturn v1;\n}\n});\n\nJavaRDD&lt;CategoryCountInfo&gt; countInfoJavaRDD = countInfoPairRDD.map(new Function&lt;Tuple2&lt;String, CategoryCountInfo&gt;, CategoryCountInfo&gt;() {\n@Override\npublic CategoryCountInfo call(Tuple2&lt;String, CategoryCountInfo&gt; v1) throws Exception {\nreturn v1._2;\n}\n});\n\n// CategoryCountInfo\u9700\u8981\u80fd\u591f\u6bd4\u8f83\u5927\u5c0f\nJavaRDD&lt;CategoryCountInfo&gt; result = countInfoJavaRDD.sortBy(new Function&lt;CategoryCountInfo, CategoryCountInfo&gt;() {\n@Override\npublic CategoryCountInfo call(CategoryCountInfo v1) throws Exception {\nreturn v1;\n}\n}, false, 2);\n\nresult. collect().forEach(System.out::println);\n\n// 4. \u5173\u95edsc\nsc.stop();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_08/","title":"\u7b2c8\u7ae0 Spark SQL\u6982\u8ff0","text":""},{"location":"engine/spark/spark_08/#81-spark-sql","title":"8.1 \u4ec0\u4e48\u662fSpark SQL","text":"<p>Spark SQL \u662f\u7528\u4e8e\u7ed3\u6784\u5316\u6570\u636e\u5904\u7406\u7684 Spark \u6a21\u5757\u3002\u4e0e\u57fa\u672c\u7684 Spark RDD API \u4e0d\u540c\uff0cSpark SQL \u63d0\u4f9b\u7684\u63a5\u53e3\u4e3a Spark \u63d0\u4f9b\u4e86\u6709\u5173\u6570\u636e\u7ed3\u6784\u548c\u6b63\u5728\u6267\u884c\u7684\u8ba1\u7b97\u7684\u66f4\u591a\u4fe1\u606f\u3002\u5728\u5185\u90e8\uff0cSpark SQL \u4f7f\u7528\u8fd9\u4e9b\u989d\u5916\u7684\u4fe1\u606f\u6765\u6267\u884c\u989d\u5916\u7684\u4f18\u5316\u3002\u4e0e Spark SQL \u4ea4\u4e92\u7684\u65b9\u5f0f\u6709\u591a\u79cd\uff0c\u5305\u62ec SQL \u548c Dataset API\u3002\u8ba1\u7b97\u7ed3\u679c\u65f6\uff0c\u4f7f\u7528\u76f8\u540c\u7684\u6267\u884c\u5f15\u64ce\uff0c\u4e0e\u60a8\u7528\u4e8e\u8868\u8fbe\u8ba1\u7b97\u7684 API / \u8bed\u8a00\u65e0\u5173\u3002</p>"},{"location":"engine/spark/spark_08/#82-spark-sql","title":"8.2 \u4e3a\u4ec0\u4e48\u8981\u6709Spark SQL","text":""},{"location":"engine/spark/spark_08/#_1","title":"SparkSQL\u6982\u8ff0","text":""},{"location":"engine/spark/spark_08/#83-sparksql","title":"8.3 SparkSQL\u7684\u53d1\u5c55","text":"<p>1\uff09\u53d1\u5c55\u5386\u53f2</p> <p>RDD\uff08Spark1.0\uff09=\u300bDataframe\uff08Spark1.3\uff09=\u300bDataset\uff08Spark1.6\uff09</p> <p>\u5982\u679c\u540c\u6837\u7684\u6570\u636e\u90fd\u7ed9\u5230\u8fd9\u4e09\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u4eec\u5206\u522b\u8ba1\u7b97\u4e4b\u540e\uff0c\u90fd\u4f1a\u7ed9\u51fa\u76f8\u540c\u7684\u7ed3\u679c\u3002\u4e0d\u540c\u7684\u662f\u4ed6\u4eec\u7684\u6267\u884c\u6548\u7387\u548c\u6267\u884c\u65b9\u5f0f\u3002\u5728\u73b0\u5728\u7684\u7248\u672c\u4e2d\uff0cDataSet \u6027\u80fd\u6700\u597d\uff0c\u5df2\u7ecf\u6210\u4e3a\u4e86\u552f\u4e00\u4f7f\u7528\u7684\u63a5\u53e3\u3002\u5176\u4e2d Dataframe \u5df2\u7ecf\u5728\u5e95\u5c42\u88ab\u770b\u505a\u662f\u7279\u6b8a\u6cdb\u578b\u7684DataSet\\\u3002 <p>2\uff09\u4e09\u8005\u7684\u5171\u6027</p> <ul> <li>RDD\u3001DataFrame\u3001DataSet \u5168\u90fd\u662f Spark \u5e73\u53f0\u4e0b\u7684\u5206\u5e03\u5f0f\u5f39\u6027\u6570\u636e\u96c6\uff0c\u4e3a\u5904\u7406\u8d85\u5927\u578b\u6570\u636e\u63d0\u4f9b\u4fbf\u5229</li> <li>\u4e09\u8005\u90fd\u6709\u60f0\u6027\u673a\u5236\uff0c\u5728\u8fdb\u884c\u521b\u5efa\u3001\u8f6c\u6362\uff0c\u5982 map \u65b9\u6cd5\u65f6\uff0c\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u53ea\u6709\u5728\u9047\u5230 Action \u884c\u52a8\u7b97\u5b50\u5982 foreach \u65f6\uff0c\u4e09\u8005\u624d\u4f1a\u5f00\u59cb\u904d\u5386\u8fd0\u7b97</li> <li>\u4e09\u8005\u6709\u8bb8\u591a\u5171\u540c\u7684\u51fd\u6570\uff0c\u5982 filter\uff0c\u6392\u5e8f\u7b49</li> <li>\u4e09\u8005\u90fd\u4f1a\u6839\u636e Spark \u7684\u5185\u5b58\u60c5\u51b5\u81ea\u52a8\u7f13\u5b58\u8fd0\u7b97</li> <li>\u4e09\u8005\u90fd\u6709\u5206\u533a\u7684\u6982\u5ff5</li> </ul>"},{"location":"engine/spark/spark_08/#84-spark-sql","title":"8.4 Spark SQL\u7684\u7279\u70b9","text":"<ul> <li> \u6613\u6574\u5408</li> </ul> <p>\u65e0\u7f1d\u7684\u6574\u5408\u4e86 SQL \u67e5\u8be2\u548c Spark \u7f16\u7a0b\u3002</p> <p></p> <ul> <li> \u7edf\u4e00\u7684\u6570\u636e\u8bbf\u95ee\u65b9\u5f0f</li> </ul> <p>\u4f7f\u7528\u76f8\u540c\u7684\u65b9\u5f0f\u8fde\u63a5\u4e0d\u540c\u7684\u6570\u636e\u6e90\u3002</p> <p></p> <ul> <li> \u517c\u5bb9 Hive</li> </ul> <p>\u5728\u5df2\u6709\u7684\u4ed3\u5e93\u4e0a\u76f4\u63a5\u8fd0\u884c SQL \u6216\u8005 HQL\u3002</p> <p></p> <ul> <li> \u6807\u51c6\u7684\u6570\u636e\u8fde\u63a5</li> </ul> <p>\u901a\u8fc7 JDBC \u6216\u8005 ODBC \u6765\u8fde\u63a5\u3002</p> <p></p>"},{"location":"engine/spark/spark_09/","title":"\u7b2c9\u7ae0 Spark SQL\u7f16\u7a0b","text":""},{"location":"engine/spark/spark_09/#91-sparksession","title":"9.1 SparkSession\u65b0\u7684\u8d77\u59cb\u70b9","text":"<p>\u5728\u8001\u7684\u7248\u672c\u4e2d\uff0cSparkSQL \u63d0\u4f9b\u4e24\u79cd SQL \u67e5\u8be2\u8d77\u59cb\u70b9\uff1a</p> <ul> <li>SQLContext\uff0c\u7528\u4e8e Spark \u81ea\u5df1\u63d0\u4f9b\u7684 SQL \u67e5\u8be2</li> <li>HiveContext\uff0c\u7528\u4e8e\u8fde\u63a5 Hive \u7684\u67e5\u8be2</li> </ul> <p>SparkSession \u662f Spark \u6700\u65b0\u7684 SQL \u67e5\u8be2\u8d77\u59cb\u70b9\uff0c\u5b9e\u8d28\u4e0a\u662f SQLContext \u548c HiveContext \u7684\u7ec4\u5408\uff0c\u6240\u4ee5\u5728 SQLContext \u548c HiveContext \u4e0a\u53ef\u7528\u7684 API \u5728 SparkSession \u4e0a\u540c\u6837\u662f\u53ef\u4ee5\u4f7f\u7528\u7684\u3002</p> <p>SparkSession \u5185\u90e8\u5c01\u88c5\u4e86 SparkContext\uff0c\u6240\u4ee5\u8ba1\u7b97\u5b9e\u9645\u4e0a\u662f\u7531 SparkContext \u5b8c\u6210\u7684\u3002\u5f53\u6211\u4eec\u4f7f\u7528 spark-shell \u7684\u65f6\u5019\uff0cSpark \u6846\u67b6\u4f1a\u81ea\u52a8\u7684\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u53eb\u505a Spark \u7684 SparkSession\uff0c\u5c31\u50cf\u6211\u4eec\u4ee5\u524d\u53ef\u4ee5\u81ea\u52a8\u83b7\u53d6\u5230\u4e00\u4e2a sc \u6765\u8868\u793a SparkContext\u3002</p> <pre><code>$  bin/spark-shell\n\n20/09/12 11:16:35 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nUsing Spark's default log4j profile: org/apache/spark/log4j-defaults.properties\nSetting default log level to \"WARN\".\nTo adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).\nSpark context Web UI available at http://hadoop102:4040\nSpark context available as 'sc' (master = local[*], app id = local-1599880621394).\nSpark session available as 'spark'.\nWelcome to\n      ____              __\n     / __/__  ___ _____/ /__\n    _\\ \\/ _ \\/ _ `/ __/  '_/\n   /___/ .__/\\_,_/_/ /_/\\_\\   version 3.1.3\n      /_/\n\nUsing Scala version 2.12.10 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_212)\nType in expressions to have them evaluated.\nType :help for more information.\n</code></pre>"},{"location":"engine/spark/spark_09/#92","title":"9.2 \u5e38\u7528\u65b9\u5f0f","text":""},{"location":"engine/spark/spark_09/#921","title":"9.2.1 \u65b9\u6cd5\u8c03\u7528","text":"<p>1\uff09\u521b\u5efa\u4e00\u4e2a maven \u5de5\u7a0b SparkSQL</p> <p>2\uff09\u521b\u5efa\u5305\u540d\u4e3a com.atguigu.sparksql</p> <p>3\uff09\u8f93\u5165\u6587\u4ef6\u5939\u51c6\u5907\uff1a\u5728\u65b0\u5efa\u7684 SparkSQL \u9879\u76ee\u540d\u79f0\u4e0a \u53f3\u952e =\u300b\u65b0\u5efa input \u6587\u4ef6\u5939 =\u300b\u5728 input \u6587\u4ef6\u5939\u4e0a\u53f3\u952e =\u300b \u65b0\u5efa user.json\u3002\u5e76\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\uff1a user.json<pre><code>{\"age\":20,\"name\":\"qiaofeng\"}\n{\"age\":19,\"name\":\"xuzhu\"}\n{\"age\":18,\"name\":\"duanyu\"}\n{\"age\":22,\"name\":\"qiaofeng\"}\n{\"age\":11,\"name\":\"xuzhu\"}\n{\"age\":12,\"name\":\"duanyu\"}\n</code></pre></p> <p>5\uff09\u5728 pom.xml \u6587\u4ef6\u4e2d\u6dfb\u52a0 spark-sql \u7684\u4f9d\u8d56 pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-sql_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n&lt;artifactId&gt;lombok&lt;/artifactId&gt;\n&lt;version&gt;1.18.22&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> 6\uff09\u4ee3\u7801\u5b9e\u73b0</p> <p>\u6dfb\u52a0 javaBean \u7684 User <pre><code>package com.atguigu.sparksql.Bean;\n\nimport lombok.Data;\n\nimport java.io.Serializable;\n\n@Data\npublic class User implements Serializable {\npublic Long age;\npublic String name;\n\npublic User() {\n}\n\npublic User(Long age, String name) {\nthis.age = age;\nthis.name = name;\n}\n}\n</code></pre></p> <p>\u4ee3\u7801\u7f16\u5199 <pre><code>package com.atguigu.sparksql;\n\nimport com.atguigu.sparksql.Bean.User;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.function.MapFunction;\nimport org.apache.spark.api.java.function.ReduceFunction;\nimport org.apache.spark.sql.*;\nimport scala.Tuple2;\n\npublic class Test01_Method {\npublic static void main(String[] args) {\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\n// \u6309\u7167\u884c\u8bfb\u53d6\nDataset&lt;Row&gt; lineDS = spark.read().json(\"input/user.json\");\n\n// \u8f6c\u6362\u4e3a\u7c7b\u548c\u5bf9\u8c61\nDataset&lt;User&gt; userDS = lineDS.as(Encoders.bean(User.class));\n\n//        userDS.show();\n\n// \u4f7f\u7528\u65b9\u6cd5\u64cd\u4f5c\n// \u51fd\u6570\u5f0f\u7684\u65b9\u6cd5\nDataset&lt;User&gt; userDataset = lineDS.map(new MapFunction&lt;Row, User&gt;() {\n@Override\npublic User call(Row value) throws Exception {\nreturn new User(value.getLong(0), value.getString(1));\n}\n},\n// \u4f7f\u7528kryo\u5728\u5e95\u5c42\u4f1a\u6709\u90e8\u5206\u7b97\u5b50\u65e0\u6cd5\u4f7f\u7528\nEncoders.bean(User.class));\n\n// \u5e38\u89c4\u65b9\u6cd5\nDataset&lt;User&gt; sortDS = userDataset.sort(new Column(\"age\"));\nsortDS.show();\n\n// \u533a\u5206\nRelationalGroupedDataset groupByDS = userDataset.groupBy(\"name\");\n\n// \u540e\u7eed\u65b9\u6cd5\u4e0d\u540c\nDataset&lt;Row&gt; count = groupByDS.count();\n\n// \u63a8\u8350\u4f7f\u7528\u51fd\u6570\u5f0f\u7684\u65b9\u6cd5  \u4f7f\u7528\u66f4\u7075\u6d3b\nKeyValueGroupedDataset&lt;String, User&gt; groupedDataset = userDataset.groupByKey(new MapFunction&lt;User, String&gt;() {\n@Override\npublic String call(User value) throws Exception {\n\nreturn value.name;\n}\n}, Encoders.STRING());\n\n// \u805a\u5408\u7b97\u5b50\u90fd\u662f\u4ecegroupByKey\u5f00\u59cb\n// \u63a8\u8350\u4f7f\u7528reduceGroup\nDataset&lt;Tuple2&lt;String, User&gt;&gt; result = groupedDataset.reduceGroups(new ReduceFunction&lt;User&gt;() {\n@Override\npublic User call(User v1, User v2) throws Exception {\n// \u53d6\u7528\u6237\u7684\u5927\u5e74\u9f84\nreturn new User(Math.max(v1.age, v2.age), v1.name);\n}\n});\n\nresult.show();\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n</code></pre></p> <p>\u5728 sparkSql \u4e2d DS \u76f4\u63a5\u652f\u6301\u7684\u8f6c\u6362\u7b97\u5b50\u6709\uff1a - map\uff08\u5e95\u5c42\u5df2\u7ecf\u4f18\u5316\u4e3a mapPartition\uff09 - mapPartition - flatMap - groupByKey\uff08\u805a\u5408\u7b97\u5b50\u5168\u90e8\u7531 groupByKey \u5f00\u59cb\uff09 - filter - distinct - coalesce - repartition - sort \u548c  orderBy\uff08\u4e0d\u662f\u51fd\u6570\u5f0f\u7684\u7b97\u5b50\uff0c\u4e0d\u8fc7\u4e0d\u5f71\u54cd\u4f7f\u7528\uff09</p>"},{"location":"engine/spark/spark_09/#922-sql","title":"9.2.2 SQL\u4f7f\u7528\u65b9\u5f0f","text":"<pre><code>package com.atguigu.sparksql;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\nimport org.apache.spark.sql.SparkSession;\n\npublic class Test02_SQL {\npublic static void main(String[] args) {\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nDataset&lt;Row&gt; lineDS = spark.read().json(\"input/user.json\");\n\n// \u521b\u5efa\u89c6\u56fe =&gt; \u8f6c\u6362\u4e3a\u8868\u683c \u586b\u5199\u8868\u540d\n// \u4e34\u65f6\u89c6\u56fe\u7684\u751f\u547d\u5468\u671f\u548c\u5f53\u524d\u7684sparkSession\u7ed1\u5b9a\n// orReplace\u8868\u793a\u8986\u76d6\u4e4b\u524d\u76f8\u540c\u540d\u79f0\u7684\u89c6\u56fe\nlineDS.createOrReplaceTempView(\"t1\");\n\n// \u652f\u6301\u6240\u6709\u7684hive sql\u8bed\u6cd5,\u5e76\u4e14\u4f1a\u4f7f\u7528spark\u7684\u53c8\u82b1\u94b1\nDataset&lt;Row&gt; result = spark.sql(\"select * from t1 where age &gt; 18\");\n\nresult.show();\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}}\n</code></pre>"},{"location":"engine/spark/spark_09/#923-dsl","title":"9.2.3 DSL\u7279\u6b8a\u8bed\u6cd5\uff08\u6269\u5c55\uff09","text":"<pre><code>package com.atguigu.sparksql;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\nimport org.apache.spark.sql.SparkSession;\n\nimport static org.apache.spark.sql.functions.col;\n\npublic class Test03_DSL {\npublic static void main(String[] args) {\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\n// \u5bfc\u5165\u7279\u6b8a\u7684\u4f9d\u8d56 import static org.apache.spark.sql.functions.col;\nDataset&lt;Row&gt; lineRDD = spark.read().json(\"input/user.json\");\n\nDataset&lt;Row&gt; result = lineRDD.select(col(\"name\").as(\"newName\"),col(\"age\").plus(1).as(\"newAge\"))\n.filter(col(\"age\").gt(18));\n\nresult.show();\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_09/#93-sql","title":"9.3 SQL\u8bed\u6cd5\u7684\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570","text":""},{"location":"engine/spark/spark_09/#931-udf","title":"9.3.1 UDF","text":"<p>1\uff09UDF\uff1a\u4e00\u884c\u8fdb\u5165\uff0c\u4e00\u884c\u51fa</p> <p>2\uff09\u4ee3\u7801\u5b9e\u73b0 <pre><code>package com.atguigu.sparksql;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\nimport org.apache.spark.sql.SparkSession;\nimport org.apache.spark.sql.api.java.UDF1;\nimport org.apache.spark.sql.expressions.UserDefinedFunction;\nimport org.apache.spark.sql.types.DataTypes;\n\nimport static org.apache.spark.sql.functions.udf;\n\npublic class Test04_UDF {\npublic static void main(String[] args) {\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nDataset&lt;Row&gt; lineRDD = spark.read().json(\"input/user.json\");\n\nlineRDD.createOrReplaceTempView(\"user\");\n\n// \u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\n// \u9700\u8981\u9996\u5148\u5bfc\u5165\u4f9d\u8d56import static org.apache.spark.sql.functions.udf;\nUserDefinedFunction addName = udf(new UDF1&lt;String, String&gt;() {\n@Override\npublic String call(String s) throws Exception {\nreturn s + \" \u5927\u4fa0\";\n}\n}, DataTypes.StringType);\n\nspark.udf().register(\"addName\",addName);\n\nspark.sql(\"select addName(name) newName from user\")\n.show();\n\n// lambda\u8868\u8fbe\u5f0f\u5199\u6cd5\nspark.udf().register(\"addName1\",(UDF1&lt;String,String&gt;) name -&gt; name + \" \u5927\u4fa0\",DataTypes.StringType);\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n</code></pre></p>"},{"location":"engine/spark/spark_09/#932-udaf","title":"9.3.2 UDAF","text":"<p>1\uff09UDAF\uff1a\u8f93\u5165\u591a\u884c\uff0c\u8fd4\u56de\u4e00\u884c\u3002\u901a\u5e38\u548c groupBy \u4e00\u8d77\u4f7f\u7528\uff0c\u5982\u679c\u76f4\u63a5\u4f7f\u7528 UDAF \u51fd\u6570\uff0c\u9ed8\u8ba4\u5c06\u6240\u6709\u7684\u6570\u636e\u5408\u5e76\u5728\u4e00\u8d77\u3002</p> <p>2\uff09Spark3.x \u63a8\u8350\u4f7f\u7528 extends Aggregator \u81ea\u5b9a\u4e49 UDAF\uff0c\u5c5e\u4e8e\u5f3a\u7c7b\u578b\u7684 Dataset \u65b9\u5f0f\u3002</p> <p>3\uff09Spark2.x \u4f7f\u7528 extends UserDefinedAggregateFunction\uff0c\u5c5e\u4e8e\u5f31\u7c7b\u578b\u7684 DataFrame</p> <p>4\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u9700\u6c42\uff1a\u5b9e\u73b0\u6c42\u5e73\u5747\u5e74\u9f84\uff0c\u81ea\u5b9a\u4e49 UDAF\uff0cMyAvg(age)</p> <p>\u81ea\u5b9a\u4e49\u805a\u5408\u51fd\u6570\u5b9e\u73b0-\u5f3a\u7c7b\u578b <pre><code>package com.atguigu.sparksql;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.Encoder;\nimport org.apache.spark.sql.Encoders;\nimport org.apache.spark.sql.SparkSession;\nimport org.apache.spark.sql.expressions.Aggregator;\n\nimport java.io.Serializable;\n\nimport static org.apache.spark.sql.functions.udaf;\n\npublic class Test05_UDAF {\npublic static void main(String[] args) {\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nspark.read().json(\"input/user.json\").createOrReplaceTempView(\"user\");\n\n// \u6ce8\u518c\u9700\u8981\u5bfc\u5165\u4f9d\u8d56 import static org.apache.spark.sql.functions.udaf;\nspark.udf().register(\"avgAge\",udaf(new MyAvg(),Encoders.LONG()));\n\nspark.sql(\"select avgAge(age) newAge from user\").show();\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n\npublic static class Buffer implements Serializable {\nprivate Long sum;\nprivate Long count;\n\npublic Buffer() {\n}\n\npublic Buffer(Long sum, Long count) {\nthis.sum = sum;\nthis.count = count;\n}\n\npublic Long getSum() {\nreturn sum;\n}\n\npublic void setSum(Long sum) {\nthis.sum = sum;\n}\n\npublic Long getCount() {\nreturn count;\n}\n\npublic void setCount(Long count) {\nthis.count = count;\n}\n}\n\npublic static class MyAvg extends Aggregator&lt;Long,Buffer,Double&gt;{\n\n@Override\npublic Buffer zero() {\nreturn new Buffer(0L,0L);\n}\n\n@Override\npublic Buffer reduce(Buffer b, Long a) {\nb.setSum(b.getSum() + a);\nb.setCount(b.getCount() + 1);\nreturn b;\n}\n\n@Override\npublic Buffer merge(Buffer b1, Buffer b2) {\n\nb1.setSum(b1.getSum() + b2.getSum());\nb1.setCount(b1.getCount() + b2.getCount());\n\nreturn b1;\n}\n\n@Override\npublic Double finish(Buffer reduction) {\nreturn reduction.getSum().doubleValue() / reduction.getCount();\n}\n\n@Override\npublic Encoder&lt;Buffer&gt; bufferEncoder() {\n// \u53ef\u4ee5\u7528kryo\u8fdb\u884c\u4f18\u5316\nreturn Encoders.kryo(Buffer.class);\n}\n\n@Override\npublic Encoder&lt;Double&gt; outputEncoder() {\nreturn Encoders.DOUBLE();\n}\n}\n}\n</code></pre></p>"},{"location":"engine/spark/spark_09/#933-udtf","title":"9.3.3 UDTF\uff08\u6ca1\u6709\uff09","text":"<p>\u8f93\u5165\u4e00\u884c\uff0c\u8fd4\u56de\u591a\u884c\uff08 Hive \uff09\u3002</p> <p>SparkSQL \u4e2d\u6ca1\u6709 UDTF\uff0c\u9700\u8981\u4f7f\u7528\u7b97\u5b50\u7c7b\u578b\u7684 flatMap \u5148\u5b8c\u6210\u62c6\u5206\u3002</p>"},{"location":"engine/spark/spark_10/","title":"\u7b2c10\u7ae0 SparkSQL\u6570\u636e\u7684\u52a0\u8f7d\u4e0e\u4fdd\u5b58","text":""},{"location":"engine/spark/spark_10/#101","title":"10.1 \u8bfb\u53d6\u548c\u4fdd\u5b58\u6587\u4ef6","text":"<p>SparkSQL \u8bfb\u53d6\u548c\u4fdd\u5b58\u7684\u6587\u4ef6\u4e00\u822c\u4e3a\u4e09\u79cd\uff0cJSON \u6587\u4ef6\u3001CSV \u6587\u4ef6\u548c\u5217\u5f0f\u5b58\u50a8\u7684\u6587\u4ef6\uff0c\u540c\u65f6\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u53c2\u6570\uff0c\u6765\u8bc6\u522b\u4e0d\u540c\u7684\u5b58\u50a8\u548c\u538b\u7f29\u683c\u5f0f\u3002</p>"},{"location":"engine/spark/spark_10/#1011-csv","title":"10.1.1 CSV\u6587\u4ef6","text":"<p>1\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.sparksql;\n\nimport com.atguigu.sparksql.Bean.User;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.api.java.function.MapFunction;\nimport org.apache.spark.sql.*;\n\npublic class Test06_CSV {\npublic static void main(String[] args) throws ClassNotFoundException {\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nDataFrameReader reader = spark.read();\n\n// \u6dfb\u52a0\u53c2\u6570  \u8bfb\u53d6csv\nDataset&lt;Row&gt; userDS = reader\n.option(\"header\", \"true\")//\u9ed8\u8ba4\u4e3afalse \u4e0d\u8bfb\u53d6\u5217\u540d\n.option(\"sep\",\",\") // \u9ed8\u8ba4\u4e3a, \u5217\u7684\u5206\u5272\n// \u4e0d\u9700\u8981\u5199\u538b\u7f29\u683c\u5f0f  \u81ea\u9002\u5e94\n.csv(\"input/user.csv\");\n\nuserDS.show();\n\n// \u8f6c\u6362\u4e3auser\u7684ds\n// \u76f4\u63a5\u8f6c\u6362\u7c7b\u578b\u4f1a\u62a5\u9519  csv\u8bfb\u53d6\u7684\u6570\u636e\u90fd\u662fstring\n//        Dataset&lt;User&gt; userDS1 = userDS.as(Encoders.bean(User.class));\nuserDS.printSchema();\n\nDataset&lt;User&gt; userDS1 = userDS.map(new MapFunction&lt;Row, User&gt;() {\n@Override\npublic User call(Row value) throws Exception {\nreturn new User(Long.valueOf(value.getString(0)), value.getString(1));\n}\n}, Encoders.bean(User.class));\n\nuserDS1.show();\n\n// \u5199\u51fa\u4e3acsv\u6587\u4ef6\nDataFrameWriter&lt;User&gt; writer = userDS1.write();\n\nwriter.option(\"header\",\";\")\n.option(\"header\",\"true\")\n//                .option(\"compression\",\"gzip\")// \u538b\u7f29\u683c\u5f0f\n// \u5199\u51fa\u6a21\u5f0f\n// append \u8ffd\u52a0\n// Ignore \u5ffd\u7565\u672c\u6b21\u5199\u51fa\n// Overwrite \u8986\u76d6\u5199\n// ErrorIfExists \u5982\u679c\u5b58\u5728\u62a5\u9519\n.mode(SaveMode.Append)\n.csv(\"output\");\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_10/#1012-json","title":"10.1.2 JSON\u6587\u4ef6","text":"<pre><code>package com.atguigu.sparksql;\n\nimport com.atguigu.sparksql.Bean.User;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.*;\n\npublic class Test07_JSON {\npublic static void main(String[] args) {\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nDataset&lt;Row&gt; json = spark.read().json(\"input/user.json\");\n\n// json\u6570\u636e\u53ef\u4ee5\u8bfb\u53d6\u6570\u636e\u7684\u6570\u636e\u7c7b\u578b\nDataset&lt;User&gt; userDS = json.as(Encoders.bean(User.class));\n\nuserDS.show();\n\n// \u8bfb\u53d6\u522b\u7684\u7c7b\u578b\u7684\u6570\u636e\u4e5f\u80fd\u5199\u51fa\u4e3ajson\nDataFrameWriter&lt;User&gt; writer = userDS.write();\n\nwriter.json(\"output1\");\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n3.1.3 Parquet\u6587\u4ef6\n\u5217\u5f0f\u5b58\u50a8\u7684\u6570\u636e\u81ea\u5e26\u5217\u5206\u5272\u3002\npackage com.atguigu.sparksql;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\nimport org.apache.spark.sql.SparkSession;\n\npublic class Test08_Parquet {\npublic static void main(String[] args) {\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nDataset&lt;Row&gt; json = spark.read().json(\"input/user.json\");\n\n// \u5199\u51fa\u9ed8\u8ba4\u4f7f\u7528snappy\u538b\u7f29\n//        json.write().parquet(\"output\");\n\n// \u8bfb\u53d6parquet \u81ea\u5e26\u89e3\u6790  \u80fd\u591f\u8bc6\u522b\u5217\u540d\nDataset&lt;Row&gt; parquet = spark.read().parquet(\"output\");\n\nparquet.printSchema();\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_10/#102-mysql","title":"10.2 \u4e0eMySQL\u4ea4\u4e92","text":"<p>1\uff09\u5bfc\u5165\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;mysql&lt;/groupId&gt;\n&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n&lt;version&gt;5.1.27&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>2\uff09\u4ece MySQL \u8bfb\u6570\u636e</p> <pre><code>package com.atguigu.sparksql;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\nimport org.apache.spark.sql.SparkSession;\n\nimport java.util.Properties;\n\npublic class Test09_Table {\npublic static void main(String[] args) {\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder().config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nDataset&lt;Row&gt; json = spark.read().json(\"input/user.json\");\n\n// \u6dfb\u52a0\u53c2\u6570\nProperties properties = new Properties();\nproperties.setProperty(\"user\",\"root\");\nproperties.setProperty(\"password\",\"000000\");\n\n//        json.write()\n//                // \u5199\u51fa\u6a21\u5f0f\u9488\u5bf9\u4e8e\u8868\u683c\u8ffd\u52a0\u8986\u76d6\n//                .mode(SaveMode.Append)\n//                .jdbc(\"jdbc:mysql://hadoop102:3306\",\"gmall.testInfo\",properties);\n\nDataset&lt;Row&gt; jdbc = spark.read().jdbc(\"jdbc:mysql://hadoop102:3306\", \"gmall.testInfo\", properties);\n\njdbc.show();\n\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_10/#103-hive","title":"10.3 \u4e0eHive\u4ea4\u4e92","text":"<p>SparkSQL \u53ef\u4ee5\u91c7\u7528\u5185\u5d4c Hive\uff08 Spark \u5f00\u7bb1\u5373\u7528\u7684 Hive\uff09\uff0c\u4e5f\u53ef\u4ee5\u91c7\u7528\u5916\u90e8 Hive\u3002\u4f01\u4e1a\u5f00\u53d1\u4e2d\uff0c\u901a\u5e38\u91c7\u7528\u5916\u90e8 Hive\u3002</p>"},{"location":"engine/spark/spark_10/#1031-linux","title":"10.3.1 Linux\u4e2d\u7684\u4ea4\u4e92","text":"<p>1\uff09\u6dfb\u52a0 MySQL \u8fde\u63a5\u9a71\u52a8\u5230 spark-yarn \u7684 jars \u76ee\u5f55</p> <pre><code>cp /opt/software/mysql-connector-java-5.1.27-bin.jar /opt/module/spark-yarn/jars\n</code></pre> <p>2\uff09\u6dfb\u52a0 hive-site.xml \u6587\u4ef6\u5230 spark-yarn \u7684 conf \u76ee\u5f55</p> <pre><code>cp /opt/module/hive/conf/hive-site.xml /opt/module/spark-yarn/conf\n</code></pre> <p>3\uff09\u542f\u52a8 spark-sql \u7684\u5ba2\u6237\u7aef\u5373\u53ef</p> <pre><code>$ bin/spark-sql --master yarn\nspark-sql (default)&gt; show tables;\n</code></pre>"},{"location":"engine/spark/spark_10/#1032-idea","title":"10.3.2 IDEA\u4e2d\u7684\u4ea4\u4e92","text":"<p>1\uff09\u6dfb\u52a0\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n    &lt;dependency&gt;\n       &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n       &lt;artifactId&gt;spark-sql_2.12&lt;/artifactId&gt;\n       &lt;version&gt;3.1.3&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n       &lt;groupId&gt;mysql&lt;/groupId&gt;\n       &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n       &lt;version&gt;5.1.27&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n       &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n       &lt;artifactId&gt;spark-hive_2.12&lt;/artifactId&gt;\n       &lt;version&gt;3.1.3&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n       &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n       &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n       &lt;version&gt;1.18.22&lt;/version&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>2\uff09\u62f7\u8d1d hive-site.xml \u5230 resources \u76ee\u5f55\uff08\u5982\u679c\u9700\u8981\u64cd\u4f5c Hadoop\uff0c\u9700\u8981\u62f7\u8d1d hdfs-site.xml\u3001core-site.xml\u3001yarn-site.xml\uff09</p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>package com.atguigu.sparksql;\n\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.SparkSession;\n\npublic class Test10_Hive {\npublic static void main(String[] args) {\n\nSystem.setProperty(\"HADOOP_USER_NAME\",\"atguigu\");\n\n//1. \u521b\u5efa\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sparksql\").setMaster(\"local[*]\");\n\n//2. \u83b7\u53d6sparkSession\nSparkSession spark = SparkSession.builder()\n.enableHiveSupport()// \u6dfb\u52a0hive\u652f\u6301\n.config(conf).getOrCreate();\n\n//3. \u7f16\u5199\u4ee3\u7801\nspark.sql(\"show tables\").show();\n\nspark.sql(\"create table user_info(name String,age bigint)\");\nspark.sql(\"insert into table user_info values('zhangsan',10)\");\nspark.sql(\"select * from user_info\").show();\n\n//4. \u5173\u95edsparkSession\nspark.close();\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_11/","title":"\u7b2c11\u7ae0 SparkSQL\u9879\u76ee\u5b9e\u6218","text":""},{"location":"engine/spark/spark_11/#111","title":"11.1 \u51c6\u5907\u6570\u636e","text":"<p>\u6211\u4eec\u8fd9\u6b21 SparkSQL \u64cd\u4f5c\u6240\u6709\u7684\u6570\u636e\u5747\u6765\u81ea Hive\uff0c\u9996\u5148\u5728 Hive \u4e2d\u521b\u5efa\u8868\uff0c\u5e76\u5bfc\u5165\u6570\u636e\u3002\u4e00\u5171\u6709 3 \u5f20\u8868\uff1a1 \u5f20\u7528\u6237\u884c\u4e3a\u8868\uff0c1 \u5f20\u57ce\u5e02\u8868\uff0c1 \u5f20\u4ea7\u54c1\u8868\u3002</p> <p>1\uff09\u5c06 city_info.txt\u3001product_info.txt\u3001user_visit_action.txt \u4e0a\u4f20\u5230 /opt/module/data</p> <pre><code>mkdir data\n</code></pre> <p>2\uff09\u5c06\u521b\u5efa\u5bf9\u5e94\u7684\u4e09\u5f20\u8868</p> <pre><code>CREATE TABLE `user_visit_action`(\n`date` string,\n`user_id` bigint,\n`session_id` string,\n`page_id` bigint,\n`action_time` string,\n`search_keyword` string,\n`click_category_id` bigint,\n`click_product_id` bigint, --\u70b9\u51fb\u5546\u54c1id\uff0c\u6ca1\u6709\u5546\u54c1\u7528-1\u8868\u793a\u3002\n`order_category_ids` string,\n`order_product_ids` string,\n`pay_category_ids` string,\n`pay_product_ids` string,\n`city_id` bigint --\u57ce\u5e02id\n)\nrow format delimited fields terminated by '\\t';\n\n\nCREATE TABLE `city_info`(\n`city_id` bigint, --\u57ce\u5e02id\n`city_name` string, --\u57ce\u5e02\u540d\u79f0\n`area` string --\u533a\u57df\u540d\u79f0\n)\nrow format delimited fields terminated by '\\t';\n\n\nCREATE TABLE `product_info`(\n`product_id` bigint, -- \u5546\u54c1id\n`product_name` string, --\u5546\u54c1\u540d\u79f0\n`extend_info` string\n)\nrow format delimited fields terminated by '\\t';\n</code></pre> <p>3\uff09\u5e76\u52a0\u8f7d\u6570\u636e</p> <pre><code>load data local inpath '/opt/module/data/user_visit_action.txt' into table user_visit_action;\nload data local inpath '/opt/module/data/product_info.txt' into table product_info;\nload data local inpath '/opt/module/data/city_info.txt' into table city_info;\n</code></pre> <p>4\uff09\u6d4b\u8bd5\u4e00\u4e0b\u4e09\u5f20\u8868\u6570\u636e\u662f\u5426\u6b63\u5e38</p> <pre><code>select * from user_visit_action limit 5;\nselect * from product_info limit 5;\nselect * from city_info limit 5;\n</code></pre>"},{"location":"engine/spark/spark_11/#112-top3","title":"11.2 \u9700\u6c42\uff1a\u5404\u533a\u57df\u70ed\u95e8\u5546\u54c1Top3","text":""},{"location":"engine/spark/spark_11/#1121","title":"11.2.1 \u9700\u6c42\u7b80\u4ecb","text":"<p>\u8fd9\u91cc\u7684\u70ed\u95e8\u5546\u54c1\u662f\u4ece\u70b9\u51fb\u91cf\u7684\u7ef4\u5ea6\u6765\u770b\u7684\uff0c\u8ba1\u7b97\u5404\u4e2a\u533a\u57df\u524d\u4e09\u5927\u70ed\u95e8\u5546\u54c1\uff0c\u5e76\u5907\u6ce8\u4e0a\u6bcf\u4e2a\u5546\u54c1\u5728\u4e3b\u8981\u57ce\u5e02\u4e2d\u7684\u5206\u5e03\u6bd4\u4f8b\uff0c\u8d85\u8fc7\u4e24\u4e2a\u57ce\u5e02\u7528\u5176\u4ed6\u663e\u793a\u3002</p> <p>\u4f8b\u5982\uff1a</p> \u5730\u533a \u5546\u54c1\u540d\u79f0 \u70b9\u51fb\u6b21\u6570 \u57ce\u5e02\u5907\u6ce8 \u534e\u5317 \u5546\u54c1A 100000 \u5317\u4eac21.2%\uff0c\u5929\u6d2513.2%\uff0c\u5176\u4ed665.6% \u534e\u5317 \u5546\u54c1P 80200 \u5317\u4eac63.0%\uff0c\u592a\u539f10%\uff0c\u5176\u4ed627.0% \u534e\u5317 \u5546\u54c1M 40000 \u5317\u4eac63.0%\uff0c\u592a\u539f10%\uff0c\u5176\u4ed627.0% \u4e1c\u5317 \u5546\u54c1J 92000 \u5927\u8fde28%\uff0c\u8fbd\u5b8117.0%\uff0c\u5176\u4ed6 55.0%"},{"location":"engine/spark/spark_11/#1122","title":"11.2.2 \u601d\u8def\u5206\u6790","text":"<p>\u4f7f\u7528 SparkSQL \u6765\u5b8c\u6210\u590d\u6742\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528 UDF \u6216 UDAF\u3002</p> <p>\uff081\uff09\u67e5\u8be2\u51fa\u6765\u6240\u6709\u7684\u70b9\u51fb\u8bb0\u5f55\uff0c\u5e76\u4e0e city_info \u8868\u8fde\u63a5\uff0c\u5f97\u5230\u6bcf\u4e2a\u57ce\u5e02\u6240\u5728\u7684\u5730\u533a\uff0c\u4e0e Product_info \u8868\u8fde\u63a5\u5f97\u5230\u5546\u54c1\u540d\u79f0\u3002 \uff082\uff09\u6309\u7167\u5730\u533a\u548c\u5546\u54c1\u540d\u79f0\u5206\u7ec4\uff0c\u7edf\u8ba1\u51fa\u6bcf\u4e2a\u5546\u54c1\u5728\u6bcf\u4e2a\u5730\u533a\u7684\u603b\u70b9\u51fb\u6b21\u6570\u3002 \uff083\uff09\u6bcf\u4e2a\u5730\u533a\u5185\u6309\u7167\u70b9\u51fb\u6b21\u6570\u964d\u5e8f\u6392\u5217\u3002 \uff084\uff09\u53ea\u53d6\u524d\u4e09\u540d\uff0c\u5e76\u628a\u7ed3\u679c\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u4e2d\u3002 \uff085\uff09\u57ce\u5e02\u5907\u6ce8\u9700\u8981\u81ea\u5b9a\u4e49 UDAF \u51fd\u6570\u3002</p>"},{"location":"engine/spark/spark_11/#1123","title":"11.2.3 \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>package com.atguigu.sparksql.demo;\n\nimport lombok.Data;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.*;\nimport org.apache.spark.sql.expressions.Aggregator;\n\nimport java.io.Serializable;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.TreeMap;\nimport java.util.function.BiConsumer;\nimport static org.apache.spark.sql.functions.udaf;\n\npublic class Test01_Top3 {\npublic static void main(String[] args) {\n\n// 1. \u521b\u5efasparkConf\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sql\").setMaster(\"local[*]\");\n\n// 2. \u521b\u5efasparkSession\u8fde\u63a5\u5bf9\u8c61\nSparkSession spark = SparkSession.builder().enableHiveSupport().config(conf).getOrCreate();\n\n// 3. \u7f16\u5199\u4ee3\u7801\n// \u5c063\u4e2a\u8868\u683c\u6570\u636ejoin\u5728\u4e00\u8d77\nDataset&lt;Row&gt; t1DS = spark.sql(\"select \\n\" +\n\"\\tc.area,\\n\" +\n\"\\tc.city_name,\\n\" +\n\"\\tp.product_name\\n\" +\n\"from\\n\" +\n\"\\tuser_visit_action u\\n\" +\n\"join\\n\" +\n\"\\tcity_info c\\n\" +\n\"on\\n\" +\n\"\\tu.city_id=c.city_id\\n\" +\n\"join\\n\" +\n\"\\tproduct_info p\\n\" +\n\"on\\n\" +\n\"\\tu.click_product_id=p.product_id\");\n\nt1DS.createOrReplaceTempView(\"t1\");\n\nspark.udf().register(\"cityMark\",udaf(new CityMark(),Encoders.STRING()));\n\n// \u5c06\u533a\u57df\u5185\u7684\u4ea7\u54c1\u70b9\u51fb\u6b21\u6570\u7edf\u8ba1\u51fa\u6765\nDataset&lt;Row&gt; t2ds = spark.sql(\"select \\n\" +\n\"\\tarea,\\n\" +\n\"\\tproduct_name,\\n\" +\n\"\\tcityMark(city_name) mark,\\n\" +\n\"\\tcount(*) counts\\n\" +\n\"from\\t\\n\" +\n\"\\tt1\\n\" +\n\"group by\\n\" +\n\"\\tarea,product_name\");\n\n//        t2ds.show(false);\nt2ds.createOrReplaceTempView(\"t2\");\n\n// \u5bf9\u533a\u57df\u5185\u4ea7\u54c1\u70b9\u51fb\u7684\u6b21\u6570\u8fdb\u884c\u6392\u5e8f  \u627e\u51fa\u533a\u57df\u5185\u7684top3\nspark.sql(\"select\\n\" +\n\"\\tarea,\\n\" +\n\"\\tproduct_name,\\n\" +\n\"\\tmark,\\n\" +\n\"\\trank() over (partition by area order by counts desc) rk\\n\" +\n\"from \\n\" +\n\"\\tt2\").createOrReplaceTempView(\"t3\");\n\n// \u4f7f\u7528\u8fc7\u6ee4  \u53d6\u51fa\u533a\u57df\u5185\u7684top3\nspark.sql(\"select\\n\" +\n\"\\tarea,\\n\" +\n\"\\tproduct_name,\\n\" +\n\"\\tmark \\n\" +\n\"from\\n\" +\n\"\\tt3\\n\" +\n\"where \\n\" +\n\"\\trk &lt; 4\").show(50,false);\n\n// 4. \u5173\u95edsparkSession\nspark.close();\n}\n\n@Data\npublic static class Buffer implements Serializable {\nprivate Long totalCount;\nprivate HashMap&lt;String,Long&gt; map;\n\npublic Buffer() {\n}\n\npublic Buffer(Long totalCount, HashMap&lt;String, Long&gt; map) {\nthis.totalCount = totalCount;\nthis.map = map;\n}\n}\n\npublic static class CityMark extends Aggregator&lt;String,Buffer,String&gt;{\n\n@Override\npublic Buffer zero() {\nreturn new Buffer(0L,new HashMap&lt;String,Long&gt;());\n}\n\n/**\n         * \u5206\u533a\u5185\u7684\u9884\u805a\u5408\n         * @param b  map(\u57ce\u5e02,sum)\n         * @param a  \u5f53\u524d\u884c\u8868\u793a\u7684\u57ce\u5e02\n         * @return\n         */\n@Override\npublic Buffer reduce(Buffer b, String a) {\nHashMap&lt;String, Long&gt; hashMap = b.getMap();\n// \u5982\u679cmap\u4e2d\u5df2\u7ecf\u6709\u5f53\u524d\u57ce\u5e02  \u6b21\u6570+1\n// \u5982\u679cmap\u4e2d\u6ca1\u6709\u5f53\u524d\u57ce\u5e02    0+1\nhashMap.put(a, hashMap.getOrDefault(a,0L) + 1);\n\nb.setTotalCount(b.getTotalCount() + 1L);\nreturn b;\n}\n\n/**\n         * \u5408\u5e76\u591a\u4e2a\u5206\u533a\u95f4\u7684\u6570\u636e\n         * @param b1    (\u5317\u4eac,100),(\u4e0a\u6d77,200)\n         * @param b2    (\u5929\u6d25,100),(\u4e0a\u6d77,200)\n         * @return\n         */\n@Override\npublic Buffer merge(Buffer b1, Buffer b2) {\nb1.setTotalCount( b1.getTotalCount() + b2.getTotalCount());\n\nHashMap&lt;String, Long&gt; map1 = b1.getMap();\nHashMap&lt;String, Long&gt; map2 = b2.getMap();\n// \u5c06map2\u4e2d\u7684\u6570\u636e\u653e\u5165\u5408\u5e76\u5230map1\nmap2.forEach(new BiConsumer&lt;String, Long&gt;() {\n@Override\npublic void accept(String s, Long aLong) {\nmap1.put(s,aLong + map1.getOrDefault(s,0L));\n}\n});\n\nreturn b1;\n}\n\n/**\n         * map =&gt; {(\u4e0a\u6d77,200),(\u5317\u4eac,100),(\u5929\u6d25,300)}\n         * @param reduction\n         * @return\n         */\n@Override\npublic String finish(Buffer reduction) {\nLong totalCount = reduction.getTotalCount();\nHashMap&lt;String, Long&gt; map = reduction.getMap();\n// \u9700\u8981\u5bf9map\u4e2d\u7684value\u6b21\u6570\u8fdb\u884c\u6392\u5e8f\nTreeMap&lt;Long, String&gt; treeMap = new TreeMap&lt;&gt;();\n\n// \u5c06map\u4e2d\u7684\u6570\u636e\u653e\u5165\u5230treeMap\u4e2d \u8fdb\u884c\u6392\u5e8f\nmap.forEach(new BiConsumer&lt;String, Long&gt;() {\n@Override\npublic void accept(String s, Long aLong) {\nif (treeMap.containsKey(aLong)){\n// \u5982\u679c\u5df2\u7ecf\u6709\u5f53\u524d\u503c\ntreeMap.put(aLong,treeMap.get(aLong) + \"_\" + s );\n}else {\n// \u6ca1\u6709\u5f53\u524d\u503c\ntreeMap.put(aLong,s );\n}\n}\n});\n\nArrayList&lt;String&gt; resultMark = new ArrayList&lt;&gt;();\n\nDouble sum = 0.0;\n\n// \u5f53\u524d\u6ca1\u6709\u66f4\u591a\u7684\u57ce\u5e02\u6570\u636e  \u6216\u8005  \u5df2\u7ecf\u627e\u5230\u4e24\u4e2a\u57ce\u5e02\u6570\u636e\u4e86  \u505c\u6b62\u5faa\u73af\nwhile(!(treeMap.size() == 0) &amp;&amp; resultMark.size() &lt; 2){\nString cities = treeMap.lastEntry().getValue();\nLong counts = treeMap.lastEntry().getKey();\nString[] strings = cities.split(\"_\");\nfor (String city : strings) {\ndouble rate = counts.doubleValue() * 100 / totalCount;\nsum += rate;\nresultMark.add(city + String.format(\"%.2f\",rate) + \"%\");\n}\n// \u6dfb\u52a0\u5b8c\u6210\u4e4b\u540e\u5220\u9664\u5f53\u524dkey\ntreeMap.remove(counts);\n}\n\n// \u62fc\u63a5\u5176\u4ed6\u57ce\u5e02\nif (treeMap.size() &gt; 0 ){\nresultMark.add(\"\u5176\u4ed6\" + String.format(\"%.2f\",100 - sum) + \"%\");\n}\n\nStringBuilder cityMark = new StringBuilder();\nfor (String s : resultMark) {\ncityMark.append(s).append(\",\");\n}\n\nreturn cityMark.substring(0, cityMark.length() - 1);\n}\n\n@Override\npublic Encoder&lt;Buffer&gt; bufferEncoder() {\nreturn Encoders.javaSerialization(Buffer.class);\n}\n\n@Override\npublic Encoder&lt;String&gt; outputEncoder() {\nreturn Encoders.STRING();\n}\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_11/#1124","title":"11.2.4 \u96c6\u7fa4\u5b9e\u73b0","text":"<p>\u5b9e\u9645\u5f00\u53d1\u662f\u5728\u96c6\u7fa4\u4e0a\u8fdb\u884c\u7684\uff0c\u6a21\u62df\u771f\u5b9e\u7684\u5f00\u53d1\u73af\u5883\uff0c\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u4e3a json \u683c\u5f0f\uff0c\u5b58\u653e\u5728 HDFS \u4e0a\u9762\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u4f5c\u4e3a\u8868\u683c\u5b58\u653e\u5728 Hive \u4e2d\u3002</p> <p>1\uff09\u4ee3\u7801\u7f16\u5199</p> <pre><code>package com.atguigu.sparksql;\n\nimport lombok.Data;\nimport org.apache.spark.SparkConf;\nimport org.apache.spark.sql.*;\nimport org.apache.spark.sql.expressions.Aggregator;\n\nimport java.io.Serializable;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.TreeMap;\nimport java.util.function.BiConsumer;\nimport static org.apache.spark.sql.functions.udaf;\n\n\npublic class Test02_Top3 {\npublic static void main(String[] args) {\nSystem.setProperty(\"HADOOP_USER_NAME\", \"atguigu\");\n\n\n// 1. \u521b\u5efasparkConf\u914d\u7f6e\u5bf9\u8c61\nSparkConf conf = new SparkConf().setAppName(\"sql\");\n// \u4e0a\u4f20\u96c6\u7fa4\u4f7f\u7528\u6ce8\u91ca\u6389\n//                .setMaster(\"local[*]\");\n\n// 2. \u521b\u5efasparkSession\u8fde\u63a5\u5bf9\u8c61\nSparkSession spark = SparkSession.builder().enableHiveSupport().config(conf).getOrCreate();\n\n// 3. \u7f16\u5199\u4ee3\u7801\n\n// \u8bfb\u53d6hdfs\u4e0a\u9762\u7684json\u6570\u636e\n// \u6d4b\u8bd5\u5148\u4f7f\u7528\u672c\u5730\n// \u96c6\u7fa4\u4f7f\u7528main\u65b9\u6cd5\u53c2\u6570\u4f5c\u4e3a\u5199\u5165\u8def\u5f84\nspark.read().json(args[0]).createOrReplaceTempView(\"user_visit_action\");\n\n// \u5c063\u4e2a\u8868\u683c\u6570\u636ejoin\u5728\u4e00\u8d77\nDataset&lt;Row&gt; t1DS = spark.sql(\"select \\n\" +\n\"\\tc.area,\\n\" +\n\"\\tc.city_name,\\n\" +\n\"\\tp.product_name\\n\" +\n\"from\\n\" +\n\"\\tuser_visit_action u\\n\" +\n\"join\\n\" +\n\"\\tcity_info c\\n\" +\n\"on\\n\" +\n\"\\tu.city_id=c.city_id\\n\" +\n\"join\\n\" +\n\"\\tproduct_info p\\n\" +\n\"on\\n\" +\n\"\\tu.click_product_id=p.product_id\");\n\nt1DS.createOrReplaceTempView(\"t1\");\n\nspark.udf().register(\"cityMark\",udaf(new CityMark(),Encoders.STRING()));\n\n\n// \u5c06\u533a\u57df\u5185\u7684\u4ea7\u54c1\u70b9\u51fb\u6b21\u6570\u7edf\u8ba1\u51fa\u6765\nDataset&lt;Row&gt; t2ds = spark.sql(\"select \\n\" +\n\"\\tarea,\\n\" +\n\"\\tproduct_name,\\n\" +\n\"\\tcityMark(city_name) mark,\\n\" +\n\"\\tcount(*) counts\\n\" +\n\"from\\t\\n\" +\n\"\\tt1\\n\" +\n\"group by\\n\" +\n\"\\tarea,product_name\");\n\n//        t2ds.show(false);\nt2ds.createOrReplaceTempView(\"t2\");\n\n// \u5bf9\u533a\u57df\u5185\u4ea7\u54c1\u70b9\u51fb\u7684\u6b21\u6570\u8fdb\u884c\u6392\u5e8f  \u627e\u51fa\u533a\u57df\u5185\u7684top3\nspark.sql(\"select\\n\" +\n\"\\tarea,\\n\" +\n\"\\tproduct_name,\\n\" +\n\"\\tmark,\\n\" +\n\"\\trank() over (partition by area order by counts desc) rk\\n\" +\n\"from \\n\" +\n\"\\tt2\").createOrReplaceTempView(\"t3\");\n\n// \u4f7f\u7528\u8fc7\u6ee4  \u53d6\u51fa\u533a\u57df\u5185\u7684top3\n// \u540c\u65f6\u7ed3\u679c\u5199\u51fa\u5230\u8868\u683c\u4e2d\nspark.sql(\"drop table if exists result\");\nspark.sql(\"create table result as \\n\" +\n\"select \\n\" +\n\"\\tarea,\\n\" +\n\"\\tproduct_name,\\n\" +\n\"\\tmark\\n\" +\n\"from\\n\" +\n\"\\tt3\\n\" +\n\"where\\n\" +\n\"\\trk &lt; 4\");\n\n\n// 4. \u5173\u95edsparkSession\nspark.close();\n}\n\n@Data\npublic static class Buffer implements Serializable {\nprivate Long totalCount;\nprivate HashMap&lt;String,Long&gt; map;\n\npublic Buffer() {\n}\n\npublic Buffer(Long totalCount, HashMap&lt;String, Long&gt; map) {\nthis.totalCount = totalCount;\nthis.map = map;\n}\n}\n\npublic static class CityMark extends Aggregator&lt;String,Buffer,String&gt;{\n\n@Override\npublic Buffer zero() {\nreturn new Buffer(0L,new HashMap&lt;String,Long&gt;());\n}\n\n/**\n         * \u5206\u533a\u5185\u7684\u9884\u805a\u5408\n         * @param b  map(\u57ce\u5e02,sum)\n         * @param a  \u5f53\u524d\u884c\u8868\u793a\u7684\u57ce\u5e02\n         * @return\n         */\n@Override\npublic Buffer reduce(Buffer b, String a) {\nHashMap&lt;String, Long&gt; hashMap = b.getMap();\n// \u5982\u679cmap\u4e2d\u5df2\u7ecf\u6709\u5f53\u524d\u57ce\u5e02  \u6b21\u6570+1\n// \u5982\u679cmap\u4e2d\u6ca1\u6709\u5f53\u524d\u57ce\u5e02    0+1\nhashMap.put(a, hashMap.getOrDefault(a,0L) + 1);\n\nb.setTotalCount(b.getTotalCount() + 1L);\nreturn b;\n}\n\n/**\n         * \u5408\u5e76\u591a\u4e2a\u5206\u533a\u95f4\u7684\u6570\u636e\n         * @param b1    (\u5317\u4eac,100),(\u4e0a\u6d77,200)\n         * @param b2    (\u5929\u6d25,100),(\u4e0a\u6d77,200)\n         * @return\n         */\n@Override\npublic Buffer merge(Buffer b1, Buffer b2) {\nb1.setTotalCount( b1.getTotalCount() + b2.getTotalCount());\n\nHashMap&lt;String, Long&gt; map1 = b1.getMap();\nHashMap&lt;String, Long&gt; map2 = b2.getMap();\n// \u5c06map2\u4e2d\u7684\u6570\u636e\u653e\u5165\u5408\u5e76\u5230map1\nmap2.forEach(new BiConsumer&lt;String, Long&gt;() {\n@Override\npublic void accept(String s, Long aLong) {\nmap1.put(s,aLong + map1.getOrDefault(s,0L));\n}\n});\n\nreturn b1;\n}\n\n/**\n         * map =&gt; {(\u4e0a\u6d77,200),(\u5317\u4eac,100),(\u5929\u6d25,300)}\n         * @param reduction\n         * @return\n         */\n@Override\npublic String finish(Buffer reduction) {\nLong totalCount = reduction.getTotalCount();\nHashMap&lt;String, Long&gt; map = reduction.getMap();\n// \u9700\u8981\u5bf9map\u4e2d\u7684value\u6b21\u6570\u8fdb\u884c\u6392\u5e8f\nTreeMap&lt;Long, String&gt; treeMap = new TreeMap&lt;&gt;();\n\n// \u5c06map\u4e2d\u7684\u6570\u636e\u653e\u5165\u5230treeMap\u4e2d \u8fdb\u884c\u6392\u5e8f\nmap.forEach(new BiConsumer&lt;String, Long&gt;() {\n@Override\npublic void accept(String s, Long aLong) {\nif (treeMap.containsKey(aLong)){\n// \u5982\u679c\u5df2\u7ecf\u6709\u5f53\u524d\u503c\ntreeMap.put(aLong,treeMap.get(aLong) + \"_\" + s );\n}else {\n// \u6ca1\u6709\u5f53\u524d\u503c\ntreeMap.put(aLong,s );\n}\n}\n});\n\nArrayList&lt;String&gt; resultMark = new ArrayList&lt;&gt;();\n\nDouble sum = 0.0;\n\n// \u5f53\u524d\u6ca1\u6709\u66f4\u591a\u7684\u57ce\u5e02\u6570\u636e  \u6216\u8005  \u5df2\u7ecf\u627e\u5230\u4e24\u4e2a\u57ce\u5e02\u6570\u636e\u4e86  \u505c\u6b62\u5faa\u73af\nwhile(!(treeMap.size() == 0) &amp;&amp; resultMark.size() &lt; 2){\nString cities = treeMap.lastEntry().getValue();\nLong counts = treeMap.lastEntry().getKey();\nString[] strings = cities.split(\"_\");\nfor (String city : strings) {\ndouble rate = counts.doubleValue() * 100 / totalCount;\nsum += rate;\nresultMark.add(city + String.format(\"%.2f\",rate) + \"%\");\n}\n// \u6dfb\u52a0\u5b8c\u6210\u4e4b\u540e\u5220\u9664\u5f53\u524dkey\ntreeMap.remove(counts);\n}\n\n// \u62fc\u63a5\u5176\u4ed6\u57ce\u5e02\nif (treeMap.size() &gt; 0 ){\nresultMark.add(\"\u5176\u4ed6\" + String.format(\"%.2f\",100 - sum) + \"%\");\n}\n\nStringBuilder cityMark = new StringBuilder();\nfor (String s : resultMark) {\ncityMark.append(s).append(\",\");\n}\n\nreturn cityMark.substring(0, cityMark.length() - 1);\n}\n\n@Override\npublic Encoder&lt;Buffer&gt; bufferEncoder() {\nreturn Encoders.javaSerialization(Buffer.class);\n}\n\n@Override\npublic Encoder&lt;String&gt; outputEncoder() {\nreturn Encoders.STRING();\n}\n}\n}\n</code></pre> <p>2\uff09\u4fee\u6539\u4f9d\u8d56\u6253\u5305\u4e0a\u4f20</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-sql_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;scope&gt;provided&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;mysql&lt;/groupId&gt;\n&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n&lt;version&gt;5.1.27&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-hive_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;scope&gt;provided&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n&lt;artifactId&gt;lombok&lt;/artifactId&gt;\n&lt;version&gt;1.18.22&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;build&gt;\n&lt;plugins&gt;\n&lt;plugin&gt;\n&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n&lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;\n&lt;version&gt;3.1.1&lt;/version&gt;\n&lt;executions&gt;\n&lt;execution&gt;\n&lt;phase&gt;package&lt;/phase&gt;\n&lt;goals&gt;\n&lt;goal&gt;shade&lt;/goal&gt;\n&lt;/goals&gt;\n&lt;configuration&gt;\n&lt;artifactSet&gt;\n&lt;excludes&gt;\n&lt;exclude&gt;com.google.code.findbugs:jsr305&lt;/exclude&gt;\n&lt;exclude&gt;org.slf4j:*&lt;/exclude&gt;\n&lt;exclude&gt;log4j:*&lt;/exclude&gt;\n&lt;exclude&gt;org.apache.hadoop:*&lt;/exclude&gt;\n&lt;/excludes&gt;\n&lt;/artifactSet&gt;\n&lt;filters&gt;\n&lt;filter&gt;\n&lt;!-- Do not copy the signatures in the META-INF folder.Otherwise, this might cause SecurityExceptions when using the JAR. --&gt;\n&lt;!-- \u6253\u5305\u65f6\u4e0d\u590d\u5236META-INF\u4e0b\u7684\u7b7e\u540d\u6587\u4ef6\uff0c\u907f\u514d\u62a5\u975e\u6cd5\u7b7e\u540d\u6587\u4ef6\u7684SecurityExceptions\u5f02\u5e38--&gt;\n&lt;artifact&gt;*:*&lt;/artifact&gt;\n&lt;excludes&gt;\n&lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;\n&lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;\n&lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;\n&lt;/excludes&gt;\n&lt;/filter&gt;\n&lt;/filters&gt;\n\n&lt;transformers combine.children=\"append\"&gt;\n&lt;!-- The service transformer is needed to merge META-INF/services files --&gt;\n&lt;!-- connector\u548cformat\u4f9d\u8d56\u7684\u5de5\u5382\u7c7b\u6253\u5305\u65f6\u4f1a\u76f8\u4e92\u8986\u76d6\uff0c\u9700\u8981\u4f7f\u7528ServicesResourceTransformer\u89e3\u51b3--&gt;\n&lt;transformer\nimplementation=\"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer\"/&gt;\n&lt;/transformers&gt;\n&lt;/configuration&gt;\n&lt;/execution&gt;\n&lt;/executions&gt;\n&lt;/plugin&gt;\n&lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre> <p>3\uff09\u4e0a\u4f20\u6570\u636e\u5230 HDFS </p> <pre><code>hadoop fs -mkdir /input\nhadoop fs -put user_visti_action /input\n</code></pre> <p>4\uff09\u4e4b\u540e\u4f7f\u7528 Spark \u7684\u4efb\u52a1\u63d0\u4ea4\u547d\u4ee4</p> <pre><code>bin/spark-submit --master yarn --class com.atguigu.sparksql.Test02_Top3 ./sparkSQL-1.0-SNAPSHOT.jar /input/user_visit_action.json\n</code></pre> <p>5\uff09\u67e5\u770b\u7ed3\u679c</p> <pre><code>$ select * from result;\n\narea    product_name    mark\n\u534e\u4e1c  \u5546\u54c1_86   \u4e0a\u6d7716.44%,\u676d\u5dde15.90%,\u65e0\u952115.90%,\u5176\u4ed651.75%\n\u534e\u4e1c  \u5546\u54c1_47   \u676d\u5dde15.85%,\u9752\u5c9b15.57%,\u5176\u4ed668.58%\n\u534e\u4e1c  \u5546\u54c1_75   \u4e0a\u6d7717.49%,\u65e0\u952115.57%,\u5176\u4ed666.94%\n\u897f\u5317  \u5546\u54c1_15   \u897f\u5b8954.31%,\u94f6\u5ddd45.69%\n\u897f\u5317  \u5546\u54c1_2    \u94f6\u5ddd53.51%,\u897f\u5b8946.49%\n\u897f\u5317  \u5546\u54c1_22   \u897f\u5b8954.87%,\u94f6\u5ddd45.13%\n\u534e\u5357  \u5546\u54c1_23   \u53a6\u95e829.02%,\u798f\u5dde24.55%,\u6df1\u573324.55%,\u5176\u4ed621.88%\n\u534e\u5357  \u5546\u54c1_65   \u6df1\u573327.93%,\u53a6\u95e826.58%,\u5176\u4ed645.50%\n\u534e\u5357  \u5546\u54c1_50   \u798f\u5dde27.36%,\u6df1\u573325.94%,\u5176\u4ed646.70%\n\u534e\u5317  \u5546\u54c1_42   \u4fdd\u5b9a25.00%,\u90d1\u5dde25.00%,\u5176\u4ed650.00%\n\u534e\u5317  \u5546\u54c1_99   \u5317\u4eac24.24%,\u90d1\u5dde23.48%,\u5176\u4ed652.27%\n\u534e\u5317  \u5546\u54c1_19   \u90d1\u5dde23.46%,\u4fdd\u5b9a20.38%,\u5176\u4ed656.15%\n\u4e1c\u5317  \u5546\u54c1_41   \u54c8\u5c14\u6ee835.50%,\u5927\u8fde34.91%,\u5176\u4ed629.59%\n\u4e1c\u5317  \u5546\u54c1_91   \u54c8\u5c14\u6ee835.76%,\u5927\u8fde32.73%,\u5176\u4ed631.52%\n\u4e1c\u5317  \u5546\u54c1_58   \u6c88\u963337.74%,\u5927\u8fde32.08%,\u5176\u4ed630.19%\n\u4e1c\u5317  \u5546\u54c1_93   \u54c8\u5c14\u6ee838.36%,\u5927\u8fde37.11%,\u5176\u4ed624.53%\n\u534e\u4e2d  \u5546\u54c1_62   \u6b66\u6c4951.28%,\u957f\u6c9948.72%\n\u534e\u4e2d  \u5546\u54c1_4    \u957f\u6c9953.10%,\u6b66\u6c4946.90%\n\u534e\u4e2d  \u5546\u54c1_57   \u6b66\u6c4954.95%,\u957f\u6c9945.05%\n\u534e\u4e2d  \u5546\u54c1_29   \u6b66\u6c4950.45%,\u957f\u6c9949.55%\n\u897f\u5357  \u5546\u54c1_1    \u6210\u90fd35.80%,\u8d35\u963335.80%,\u5176\u4ed628.41%\n\u897f\u5357  \u5546\u54c1_44   \u8d35\u963337.28%,\u6210\u90fd34.32%,\u5176\u4ed628.40%\n\u897f\u5357  \u5546\u54c1_60   \u91cd\u5e8639.88%,\u6210\u90fd30.67%,\u5176\u4ed629.45%\n</code></pre>"},{"location":"engine/spark/spark_12/","title":"\u7b2c12\u7ae0 Spark\u63d0\u4ea4\u6d41\u7a0b","text":""},{"location":"engine/spark/spark_12/#12","title":"12. \u7a0b\u5e8f\u8d77\u70b9","text":"<p>1\uff09\u5728 spark-class2.cmd \u6587\u4ef6\u4e2d\u589e\u52a0\u6253\u5370 %SPARK_CMD% \u8bed\u53e5</p> spark-class2.cmd<pre><code>echo %SPARK_CMD%\n</code></pre> <p>2\uff09\u5728 spark-3.0.0-bin-hadoop3.2\\bin \u76ee\u5f55\u4e0a\u6267\u884c cmd \u547d\u4ee4</p> <p>3\uff09\u8fdb\u5165\u547d\u4ee4\u884c\u7a97\u53e3\uff0c\u8f93\u5165</p> <pre><code>bin/spark-submit --class org.apache.spark.examples.SparkPi --master local[2] ./examples/jars/spark-examples_2.12-3.1.3.jar 10\n</code></pre> <p></p> <p>4\uff09\u53d1\u73b0\u5e95\u5c42\u6267\u884c\u7684\u547d\u4ee4\u4e3a</p> <pre><code>java -cp  org.apache.spark.deploy.SparkSubmit\n</code></pre> <p>\u8bf4\u660e</p> <p>java -cp \u548c -classpath \u4e00\u6837\uff0c\u662f\u6307\u5b9a\u7c7b\u8fd0\u884c\u6240\u4f9d\u8d56\u5176\u4ed6\u7c7b\u7684\u8def\u5f84\u3002</p> <p>8\uff09\u6267\u884c java -cp \u5c31\u4f1a\u5f00\u542f JVM \u865a\u62df\u673a\uff0c\u5728\u865a\u62df\u673a\u4e0a\u5f00\u542f SparkSubmit \u8fdb\u7a0b\uff0c\u7136\u540e\u5f00\u59cb\u6267\u884c main \u65b9\u6cd5</p> <pre><code>graph LR\n  A[java -cp ] --&gt; B[\u5f00\u542fJVM\u865a\u62df\u673a];\n  B --&gt; C[\u5f00\u542f\u8fdb\u7a0b SparkSubmit];\n  C --&gt; D[\u7a0b\u5e8f\u5165\u53e3 SparkSubmit.main];</code></pre> <p>9\uff09\u5728 IDEA \u4e2d\u5168\u5c40\u67e5\u627e\uff08Ctrl+N\uff09\uff1aorg.apache.spark.deploy.SparkSubmit\uff0c\u627e\u5230 SparkSubmit \u7684\u4f34\u751f\u5bf9\u8c61\uff0c\u5e76\u627e\u5230 main \u65b9\u6cd5</p> <pre><code>override def main(args: Array[String]): Unit = {\nval submit = new SparkSubmit() {\n... ...\n}\n}\n</code></pre>"},{"location":"engine/spark/spark_12/#12-spark_1","title":"12. Spark\u7ec4\u4ef6\u901a\u4fe1","text":""},{"location":"engine/spark/spark_12/#1221-spark","title":"12.2.1 Spark\u4e2d\u901a\u4fe1\u6846\u67b6\u7684\u53d1\u5c55","text":"<p>Spark \u5e95\u5c42\u91c7\u7528 Netty \u901a\u4fe1\u3002</p>"},{"location":"engine/spark/spark_12/#1222-spark","title":"12.2.2 Spark\u5e95\u5c42\u901a\u4fe1\u539f\u7406","text":"<ul> <li>RpcEndpoint\uff1aRPC \u901a\u4fe1\u7ec8\u7aef\u3002Spark \u9488\u5bf9\u6bcf\u4e2a\u8282\u70b9\uff08 Client / Master / Worker\uff09\u90fd\u79f0\u4e4b\u4e3a\u4e00\u4e2a RPC \u7ec8\u7aef\uff0c\u4e14\u90fd\u5b9e\u73b0 RpcEndpoint \u63a5\u53e3\uff0c\u5185\u90e8\u6839\u636e\u4e0d\u540c\u7aef\u70b9\u7684\u9700\u6c42\uff0c\u8bbe\u8ba1\u4e0d\u540c\u7684\u6d88\u606f\u548c\u4e0d\u540c\u7684\u4e1a\u52a1\u5904\u7406\uff0c\u5982\u679c\u9700\u8981\u53d1\u9001\uff08\u8be2\u95ee\uff09\u5219\u8c03\u7528 Dispatcher\u3002\u5728 Spark \u4e2d\uff0c\u6240\u6709\u7684\u7ec8\u7aef\u90fd\u5b58\u5728\u751f\u547d\u5468\u671f\uff1a</li> </ul> <pre><code>graph LR\n  A[Constructor] --&gt; B[onStart];\n  B --&gt; C[receive];\n  C --&gt; D[onStop];</code></pre> <ul> <li>RpcEnv\uff1aRPC \u4e0a\u4e0b\u6587\u73af\u5883\u3002\u6bcf\u4e2a RPC \u7ec8\u7aef\u8fd0\u884c\u65f6\u4f9d\u8d56\u7684\u4e0a\u4e0b\u6587\u73af\u5883\u79f0\u4e3a RpcEnv\uff1b\u5728\u5f53\u524d Spark \u7248\u672c\u4e2d\u4f7f\u7528\u7684 NettyRpcEnv</li> <li>Dispatcher\uff1a\u6d88\u606f\u8c03\u5ea6\uff08\u5206\u53d1\uff09\u5668\uff0c\u9488\u5bf9\u4e8e RPC \u7ec8\u7aef\u9700\u8981\u53d1\u9001\u8fdc\u7a0b\u6d88\u606f\u6216\u8005\u4ece\u8fdc\u7a0b RPC \u63a5\u6536\u5230\u7684\u6d88\u606f\uff0c\u5206\u53d1\u81f3\u5bf9\u5e94\u7684\u6307\u4ee4\u6536\u4ef6\u7bb1\uff08\u53d1\u4ef6\u7bb1\uff09\u3002\u5982\u679c\u6307\u4ee4\u63a5\u6536\u65b9\u662f\u81ea\u5df1\u5219\u5b58\u5165\u6536\u4ef6\u7bb1\uff0c\u5982\u679c\u6307\u4ee4\u63a5\u6536\u65b9\u4e0d\u662f\u81ea\u5df1\uff0c\u5219\u653e\u5165\u53d1\u4ef6\u7bb1</li> <li>Inbox\uff1a\u6307\u4ee4\u6d88\u606f\u6536\u4ef6\u7bb1\u3002\u4e00\u4e2a\u672c\u5730 RpcEndpoint \u5bf9\u5e94\u4e00\u4e2a\u6536\u4ef6\u7bb1\uff0cDispatcher \u5728\u6bcf\u6b21\u5411 Inbox \u5b58\u5165\u6d88\u606f\u65f6\uff0c\u90fd\u5c06\u5bf9\u5e94 EndpointData \u52a0\u5165\u5185\u90e8 ReceiverQueue \u4e2d\uff0c\u53e6\u5916 Dispatcher \u521b\u5efa\u65f6\u4f1a\u542f\u52a8\u4e00\u4e2a\u5355\u72ec\u7ebf\u7a0b\u8fdb\u884c\u8f6e\u8be2 ReceiverQueue\uff0c\u8fdb\u884c\u6536\u4ef6\u7bb1\u6d88\u606f\u6d88\u8d39</li> <li>RpcEndpointRef\uff1aRpcEndpointRef \u662f\u5bf9\u8fdc\u7a0b RpcEndpoint \u7684\u4e00\u4e2a\u5f15\u7528\u3002\u5f53\u6211\u4eec\u9700\u8981\u5411\u4e00\u4e2a\u5177\u4f53\u7684 RpcEndpoint \u53d1\u9001\u6d88\u606f\u65f6\uff0c\u4e00\u822c\u6211\u4eec\u9700\u8981\u83b7\u53d6\u5230\u8be5 RpcEndpoint \u7684\u5f15\u7528\uff0c\u7136\u540e\u901a\u8fc7\u8be5\u5e94\u7528\u53d1\u9001\u6d88\u606f</li> <li>OutBox\uff1a\u6307\u4ee4\u6d88\u606f\u53d1\u4ef6\u7bb1\u3002\u5bf9\u4e8e\u5f53\u524d RpcEndpoint \u6765\u8bf4\uff0c\u4e00\u4e2a\u76ee\u6807 RpcEndpoint \u5bf9\u5e94\u4e00\u4e2a\u53d1\u4ef6\u7bb1\uff0c\u5982\u679c\u5411\u591a\u4e2a\u76ee\u6807 RpcEndpoint \u53d1\u9001\u4fe1\u606f\uff0c\u5219\u6709\u591a\u4e2a OutBox\u3002\u5f53\u6d88\u606f\u653e\u5165 Outbox \u540e\uff0c\u7d27\u63a5\u7740\u901a\u8fc7 TransportClient \u5c06\u6d88\u606f\u53d1\u9001\u51fa\u53bb\u3002\u6d88\u606f\u653e\u5165\u53d1\u4ef6\u7bb1\u4ee5\u53ca\u53d1\u9001\u8fc7\u7a0b\u662f\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u8fdb\u884c</li> <li>RpcAddress\uff1a\u8868\u793a\u8fdc\u7a0b\u7684 RpcEndpointRef \u7684\u5730\u5740\uff0cHost + Port</li> <li>TransportClient\uff1aNetty \u901a\u4fe1\u5ba2\u6237\u7aef\uff0c\u4e00\u4e2a OutBox \u5bf9\u5e94\u4e00\u4e2a TransportClient\uff0cTransportClient \u4e0d\u65ad\u8f6e\u8be2 OutBox\uff0c\u6839\u636e OutBox \u6d88\u606f\u7684 receiver \u4fe1\u606f\uff0c\u8bf7\u6c42\u5bf9\u5e94\u7684\u8fdc\u7a0b TransportServer</li> <li>TransportServer\uff1aNetty \u901a\u4fe1\u670d\u52a1\u7aef\uff0c\u4e00\u4e2a RpcEndpoint \u5bf9\u5e94\u4e00\u4e2a TransportServer\uff0c\u63a5\u53d7\u8fdc\u7a0b\u6d88\u606f\u540e\u8c03\u7528 Dispatcher \u5206\u53d1\u6d88\u606f\u81f3\u5bf9\u5e94\u6536\u53d1\u4ef6\u7bb1</li> </ul>"},{"location":"engine/spark/spark_12/#123-sparkyarncluster","title":"12.3 Spark\u63d0\u4ea4\u6d41\u7a0b\uff08YarnCluster\uff09","text":""},{"location":"engine/spark/spark_13/","title":"\u7b2c13\u7ae0 Spark\u4efb\u52a1\u7684\u6267\u884c","text":""},{"location":"engine/spark/spark_13/#131","title":"13.1 \u6982\u8ff0","text":""},{"location":"engine/spark/spark_13/#1311","title":"13.1.1 \u4efb\u52a1\u5207\u5206\u548c\u4efb\u52a1\u8c03\u5ea6\u539f\u7406","text":""},{"location":"engine/spark/spark_13/#1312","title":"13.1.2 \u672c\u5730\u5316\u8c03\u5ea6","text":"<p>\u4efb\u52a1\u5206\u914d\u539f\u5219\uff1a\u6839\u636e\u6bcf\u4e2a Task \u7684\u4f18\u5148\u4f4d\u7f6e\uff0c\u786e\u5b9a Task \u7684 Locality\uff08\u672c\u5730\u5316\uff09\u7ea7\u522b\uff0c\u672c\u5730\u5316\u4e00\u5171\u6709\u4e94\u79cd\uff0c\u4f18\u5148\u7ea7\u7531\u9ad8\u5230\u4f4e\u987a\u5e8f\uff1a</p> <p>\u79fb\u52a8\u6570\u636e\u4e0d\u5982\u79fb\u52a8\u8ba1\u7b97\u3002</p> \u540d\u79f0 \u89e3\u6790 PROCESS_LOCAL \u8fdb\u7a0b\u672c\u5730\u5316\uff0ctask \u548c\u6570\u636e\u5728\u540c\u4e00\u4e2a Executor \u4e2d\uff0c\u6027\u80fd\u6700\u597d\u3002 NODE_LOCAL \u8282\u70b9\u672c\u5730\u5316\uff0ctask \u548c\u6570\u636e\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e2d\uff0c\u4f46\u662f task \u548c\u6570\u636e\u4e0d\u5728\u540c\u4e00\u4e2a Executor \u4e2d\uff0c\u6570\u636e\u9700\u8981\u5728\u8fdb\u7a0b\u95f4\u8fdb\u884c\u4f20\u8f93\u3002 RACK_LOCAL \u673a\u67b6\u672c\u5730\u5316\uff0ctask \u548c\u6570\u636e\u5728\u540c\u4e00\u4e2a\u673a\u67b6\u7684\u4e24\u4e2a\u8282\u70b9\u4e0a\uff0c\u6570\u636e\u9700\u8981\u901a\u8fc7\u7f51\u7edc\u5728\u8282\u70b9\u4e4b\u95f4\u8fdb\u884c\u4f20\u8f93\u3002 NO_PREF \u5bf9\u4e8e task \u6765\u8bf4\uff0c\u4ece\u54ea\u91cc\u83b7\u53d6\u90fd\u4e00\u6837\uff0c\u6ca1\u6709\u597d\u574f\u4e4b\u5206\u3002 ANY task \u548c\u6570\u636e\u53ef\u4ee5\u5728\u96c6\u7fa4\u7684\u4efb\u4f55\u5730\u65b9\uff0c\u800c\u4e14\u4e0d\u5728\u4e00\u4e2a\u673a\u67b6\u4e2d\uff0c\u6027\u80fd\u6700\u5dee\u3002"},{"location":"engine/spark/spark_13/#1313","title":"13.1.3 \u5931\u8d25\u91cd\u8bd5\u4e0e\u9ed1\u540d\u5355\u673a\u5236","text":"<p>Task \u8fd0\u884c\u5931\u8d25\u4f1a\u88ab\u544a\u77e5\u7ed9 TaskSetManager\uff0c\u5bf9\u4e8e\u5931\u8d25\u7684 Task\uff0c\u4f1a\u8bb0\u5f55\u5b83\u5931\u8d25\u7684\u6b21\u6570\uff0c\u5982\u679c\u5931\u8d25\u6b21\u6570\u8fd8\u6ca1\u6709\u8d85\u8fc7\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u90a3\u4e48\u5c31\u628a\u5b83\u653e\u56de\u5f85\u8c03\u5ea6\u7684 Task \u6c60\u5b50\u4e2d\uff0c\u5426\u5219\u6574\u4e2a Application \u5931\u8d25\u3002</p> <p>\u5931\u8d25\u540c\u65f6\u4f1a\u8bb0\u5f55\u5b83\u4e0a\u4e00\u6b21\u5931\u8d25\u6240\u5728\u7684 Executor Id \u548c Host\uff0c\u4f7f\u7528\u9ed1\u540d\u5355\u673a\u5236\uff0c\u907f\u514d\u5b83\u88ab\u8c03\u5ea6\u5230\u4e0a\u4e00\u6b21\u5931\u8d25\u7684\u8282\u70b9\u4e0a\uff0c\u8d77\u5230\u4e00\u5b9a\u7684\u5bb9\u9519\u4f5c\u7528\u3002\u9ed1\u540d\u5355\u8bb0\u5f55 Task \u4e0a\u4e00\u6b21\u5931\u8d25\u6240\u5728\u7684 Executor Id \u548c Host\uff0c\u4ee5\u53ca\u5176\u5bf9\u5e94\u7684\u201c\u62c9\u9ed1\u201d\u65f6\u95f4\uff0c\u201c\u62c9\u9ed1\u201d\u65f6\u95f4\u662f\u6307\u8fd9\u6bb5\u65f6\u95f4\u5185\u4e0d\u8981\u518d\u5f80\u8fd9\u4e2a\u8282\u70b9\u4e0a\u8c03\u5ea6\u8fd9\u4e2a Task \u4e86\u3002</p>"},{"location":"engine/spark/spark_14/","title":"\u7b2c14\u7ae0 Shuffle","text":"<p>Spark \u6700\u521d\u7248\u672c HashShuffle\u3002 Spark 0.8.1 \u7248\u672c\u4ee5\u540e\u4f18\u5316\u540e\u7684 HashShuffle\u3002 Spark1.1 \u7248\u672c\u52a0\u5165 SortShuffle\uff0c\u9ed8\u8ba4\u662f HashShuffle\u3002 Spark1.2 \u7248\u672c\u9ed8\u8ba4\u662f SortShuffle\uff0c\u4f46\u662f\u53ef\u914d\u7f6e HashShuffle\u3002 Spark2.0 \u7248\u672c\u5220\u9664 HashShuffle \u53ea\u6709 SortShuffle\u3002</p>"},{"location":"engine/spark/spark_14/#141-shuffle","title":"14.1 Shuffle\u7684\u539f\u7406\u548c\u6267\u884c\u8fc7\u7a0b","text":"<p>Shuffle \u4e00\u5b9a\u4f1a\u6709\u843d\u76d8\u3002</p> <ul> <li> <p>\u5982\u679c Shuffle \u8fc7\u7a0b\u4e2d\u843d\u76d8\u6570\u636e\u91cf\u51cf\u5c11\uff0c\u90a3\u4e48\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd</p> </li> <li> <p>\u7b97\u5b50\u5982\u679c\u5b58\u5728\u9884\u805a\u5408\u529f\u80fd\uff0c\u53ef\u4ee5\u63d0\u9ad8 Shuffle \u7684\u6027\u80fd</p> </li> </ul> <p></p>"},{"location":"engine/spark/spark_14/#142-hashshuffle","title":"14.2 HashShuffle\u89e3\u6790","text":""},{"location":"engine/spark/spark_14/#1421-hashshuffle","title":"14.2.1 \u672a\u4f18\u5316\u7684HashShuffle","text":""},{"location":"engine/spark/spark_14/#1422-hashshuffle","title":"14.2.2 \u4f18\u5316\u540e\u7684HashShuffle","text":"<p>\u4f18\u5316\u7684 HashShuffle \u8fc7\u7a0b\u5c31\u662f\u542f\u7528\u5408\u5e76\u673a\u5236\uff0c\u5408\u5e76\u673a\u5236\u5c31\u662f\u590d\u7528 buffer\uff0c\u5f00\u542f\u5408\u5e76\u673a\u5236\u7684\u914d\u7f6e\u662f <code>spark.shuffle.consolidateFiles</code>\u3002\u8be5\u53c2\u6570\u9ed8\u8ba4\u503c\u4e3a false\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3a true \u5373\u53ef\u5f00\u542f\u4f18\u5316\u673a\u5236\u3002\u901a\u5e38\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528 HashShuffleManager\uff0c\u90a3\u4e48\u90fd\u5efa\u8bae\u5f00\u542f\u8fd9\u4e2a\u9009\u9879\u3002</p> <p>\u5b98\u7f51\u53c2\u6570\u8bf4\u660e\uff1ahttp://spark.apache.org/docs/0.8.1/configuration.html</p> <p></p>"},{"location":"engine/spark/spark_14/#143-sortshuffle","title":"14.3 SortShuffle\u89e3\u6790","text":""},{"location":"engine/spark/spark_14/#1431-sortshuffle","title":"14.3.1 SortShuffle","text":"<p>\u5728\u6ea2\u5199\u78c1\u76d8\u524d\uff0c\u5148\u6839\u636e key \u8fdb\u884c\u6392\u5e8f\uff0c\u6392\u5e8f\u8fc7\u540e\u7684\u6570\u636e\uff0c\u4f1a\u5206\u6279\u5199\u5165\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\u3002\u9ed8\u8ba4\u6279\u6b21\u4e3a 10000 \u6761\uff0c\u6570\u636e\u4f1a\u4ee5\u6bcf\u6279\u4e00\u4e07\u6761\u5199\u5165\u5230\u78c1\u76d8\u6587\u4ef6\u3002\u5199\u5165\u78c1\u76d8\u6587\u4ef6\u901a\u8fc7\u7f13\u51b2\u533a\u6ea2\u5199\u7684\u65b9\u5f0f\uff0c\u6bcf\u6b21\u6ea2\u5199\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u78c1\u76d8\u6587\u4ef6\uff0c{=\u4e5f=\u5c31\u662f\u8bf4\u4e00\u4e2a Task \u8fc7\u7a0b\u4f1a\u4ea7\u751f\u591a\u4e2a\u4e34\u65f6\u6587\u4ef6\u3002\u6700\u540e\u5728\u6bcf\u4e2a Task \u4e2d\uff0c\u5c06\u6240\u6709\u7684\u4e34\u65f6\u6587\u4ef6\u5408\u5e76\uff0c\u8fd9\u5c31\u662f merge \u8fc7\u7a0b\uff0c\u6b64\u8fc7\u7a0b\u5c06\u6240\u6709\u4e34\u65f6\u6587\u4ef6\u8bfb\u53d6\u51fa\u6765\uff0c\u4e00\u6b21\u5199\u5165\u5230\u6700\u7ec8\u6587\u4ef6==}\u3002</p>"},{"location":"engine/spark/spark_14/#1432-bypassshuffle","title":"14.3.2 bypassShuffle","text":"<p>bypassShuffle \u548c SortShuffle \u7684\u533a\u522b\u5c31\u662f\u4e0d\u5bf9\u6570\u636e\u6392\u5e8f\u3002</p> <p>bypass \u8fd0\u884c\u673a\u5236\u7684\u89e6\u53d1\u6761\u4ef6\u5982\u4e0b\uff1a</p> <p>1\uff09shuffle reduce task \u6570\u91cf\u5c0f\u4e8e\u7b49\u4e8e spark.shuffle.sort.bypassMergeThreshold \u53c2\u6570\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a 200\u3002</p> <p>2\uff09\u4e0d\u662f\u805a\u5408\u7c7b\u7684 shuffle \u7b97\u5b50\uff08\u6bd4\u5982 reduceByKey \u4e0d\u884c\uff09\u3002</p> <p></p>"},{"location":"engine/spark/spark_15/","title":"\u7b2c15\u7ae0 Spark\u5185\u5b58\u7ba1\u7406","text":""},{"location":"engine/spark/spark_15/#151","title":"15.1 \u5806\u5185\u548c\u5806\u5916\u5185\u5b58","text":""},{"location":"engine/spark/spark_15/#1511","title":"15.1.1 \u6982\u5ff5","text":"<p>Spark \u652f\u6301\u5806\u5185\u5185\u5b58\u4e5f\u652f\u6301\u5806\u5916\u5185\u5b58\u3002</p> <p>\uff081\uff09\u5806\u5185\u5185\u5b58\uff1a\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u5730\u7533\u8bf7\u67d0\u4e2a\u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4</p> <p>\uff082\uff09\u5806\u5916\u5185\u5b58\uff1a\u76f4\u63a5\u5411\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u7533\u8bf7\u7684\u5185\u5b58\uff0c\u4e0d\u53d7 JVM \u63a7\u5236</p> <p></p>"},{"location":"engine/spark/spark_15/#1512","title":"15.1.2 \u5806\u5185\u5185\u5b58\u548c\u5bf9\u5916\u5185\u5b58\u4f18\u7f3a\u70b9","text":"<p>1\uff09\u5806\u5916\u5185\u5b58\uff0c\u76f8\u6bd4\u4e8e\u5806\u5185\u5185\u5b58\u6709\u51e0\u4e2a\u4f18\u52bf</p> <p>\uff081\uff09\u51cf\u5c11\u4e86\u5783\u573e\u56de\u6536\u7684\u5de5\u4f5c\uff0c\u56e0\u4e3a\u5783\u573e\u56de\u6536\u4f1a\u6682\u505c\u5176\u4ed6\u7684\u5de5\u4f5c</p> <p>\uff082\uff09\u52a0\u5feb\u4e86\u590d\u5236\u7684\u901f\u5ea6\u3002\u56e0\u4e3a\u5806\u5185\u5728 Flush \u5230\u8fdc\u7a0b\u65f6\uff0c\u4f1a\u5148\u5e8f\u5217\u5316\uff0c\u7136\u540e\u518d\u53d1\u9001\uff1b\u800c\u5806\u5916\u5185\u5b58\u672c\u8eab\u662f\u5e8f\u5217\u5316\u7684\u76f8\u5f53\u4e8e\u7701\u7565\u6389\u4e86\u8fd9\u4e2a\u5de5\u4f5c\u3002</p> <p>\u8bf4\u660e\uff1a\u5806\u5916\u5185\u5b58\u662f\u5e8f\u5217\u5316\u7684\uff0c\u5176\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u53ef\u76f4\u63a5\u8ba1\u7b97\u3002\u5806\u5185\u5185\u5b58\u662f\u975e\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0c\u5176\u5360\u7528\u7684\u5185\u5b58\u662f\u901a\u8fc7\u5468\u671f\u6027\u5730\u91c7\u6837\u8fd1\u4f3c\u4f30\u7b97\u800c\u5f97\u3002\u6b64\u5916\uff0c\u5728\u88ab Spark \u6807\u8bb0\u4e3a\u91ca\u653e\u7684\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u5f88\u6709\u53ef\u80fd\u5728\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u88ab JVM \u56de\u6536\uff0c\u5bfc\u81f4\u5b9e\u9645\u53ef\u7528\u7684\u5185\u5b58\u5c0f\u4e8e Spark \u8bb0\u5f55\u7684\u53ef\u7528\u5185\u5b58\u3002\u6240\u4ee5 Spark \u5e76\u4e0d\u80fd\u51c6\u786e\u8bb0\u5f55\u5b9e\u9645\u53ef\u7528\u7684\u5806\u5185\u5185\u5b58\uff0c\u4ece\u800c\u4e5f\u5c31\u65e0\u6cd5\u5b8c\u5168\u907f\u514d\u5185\u5b58\u6ea2\u51fa OOM \u7684\u5f02\u5e38\u3002 </p> <p>2\uff09\u5806\u5916\u5185\u5b58\uff0c\u76f8\u6bd4\u4e8e\u5806\u5185\u5185\u5b58\u6709\u51e0\u4e2a\u7f3a\u70b9\uff1a </p> <p>\uff081\uff09\u5806\u5916\u5185\u5b58\u96be\u4ee5\u63a7\u5236\uff0c\u5982\u679c\u5185\u5b58\u6cc4\u6f0f\uff0c\u90a3\u4e48\u5f88\u96be\u6392\u67e5 </p> <p>\uff082\uff09\u5806\u5916\u5185\u5b58\u76f8\u5bf9\u6765\u8bf4\uff0c\u4e0d\u9002\u5408\u5b58\u50a8\u5f88\u590d\u6742\u7684\u5bf9\u8c61\u3002\u4e00\u822c\u7b80\u5355\u7684\u5bf9\u8c61\u6216\u8005\u6241\u5e73\u5316\u7684\u6bd4\u8f83\u9002\u5408\u3002</p>"},{"location":"engine/spark/spark_15/#1513","title":"15.1.3 \u5982\u4f55\u914d\u7f6e","text":"<p>1\uff09\u5806\u5185\u5185\u5b58\u5927\u5c0f\u8bbe\u7f6e\uff1a<code>-executor-memory</code> \u6216 <code>spark.executor.memory</code></p> <p>2\uff09\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5806\u5916\u5185\u5b58\u5e76\u4e0d\u542f\u7528\uff0c<code>spark.memory.offHeap.enabled</code> \u53c2\u6570\u542f\u7528\uff0c\u5e76\u7531 <code>spark.memory.offHeap.size</code> \u53c2\u6570\u8bbe\u5b9a\u5806\u5916\u7a7a\u95f4\u7684\u5927\u5c0f\u3002</p> <p>\u5b98\u7f51\u914d\u7f6e\u5730\u5740\uff1ahttp://spark.apache.org/docs/3.0.0/configuration.html</p>"},{"location":"engine/spark/spark_15/#152","title":"15.2 \u5806\u5185\u5185\u5b58\u7a7a\u95f4\u5206\u914d","text":"<p>\u5806\u5185\u5185\u5b58\u5305\u62ec\uff1a\u5b58\u50a8\uff08Storage\uff09\u5185\u5b58\u3001\u6267\u884c\uff08Execution\uff09\u5185\u5b58\u3001\u5176\u4ed6\u5185\u5b58</p>"},{"location":"engine/spark/spark_15/#1521","title":"15.2.1 \u9759\u6001\u5185\u5b58\u7ba1\u7406","text":"<p>\u5728 Spark \u6700\u521d\u91c7\u7528\u7684\u9759\u6001\u5185\u5b58\u7ba1\u7406\u673a\u5236\u4e0b\uff0c\u5b58\u50a8\u5185\u5b58\u3001\u6267\u884c\u5185\u5b58\u548c\u5176\u4ed6\u5185\u5b58\u7684\u5927\u5c0f\u5728 Spark \u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u5747\u4e3a\u56fa\u5b9a\u7684\uff0c\u4f46\u7528\u6237\u53ef\u4ee5\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u524d\u8fdb\u884c\u914d\u7f6e\uff0c\u5806\u5185\u5185\u5b58\u7684\u5206\u914d\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u53ef\u7528\u7684\u5806\u5185\u5185\u5b58\u7684\u5927\u5c0f\u9700\u8981\u6309\u7167\u4e0b\u5217\u65b9\u5f0f\u8ba1\u7b97\uff1a</p> <pre><code>\u53ef\u7528\u7684\u5b58\u50a8\u5185\u5b58 = systemMaxMemory * spark.storage.memoryFraction * spark.storage.safety Fraction\n\u53ef\u7528\u7684\u6267\u884c\u5185\u5b58 = systemMaxMemory * spark.shuffle.memoryFraction * spark.shuffle.safety Fraction\n</code></pre> <p></p> <p>\u7531\u4e8e\u65b0\u7684\u5185\u5b58\u7ba1\u7406\u673a\u5236\u7684\u51fa\u73b0\uff0c\u8fd9\u79cd\u65b9\u5f0f\u76ee\u524d\u5df2\u7ecf\u5f88\u5c11\u6709\u5f00\u53d1\u8005\u4f7f\u7528\uff0c\u51fa\u4e8e\u517c\u5bb9\u65e7\u7248\u672c\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u76ee\u7684\uff0cSpark \u4ecd\u7136\u4fdd\u7559\u4e86\u5b83\u7684\u5b9e\u73b0\u3002</p>"},{"location":"engine/spark/spark_15/#1522","title":"15.2.2 \u7edf\u4e00\u5185\u5b58\u7ba1\u7406","text":"<p>Spark1.6 \u4e4b\u540e\u5f15\u5165\u7684\u7edf\u4e00\u5185\u5b58\u7ba1\u7406\u673a\u5236\uff0c\u4e0e\u9759\u6001\u5185\u5b58\u7ba1\u7406\u7684\u533a\u522b\u5728\u4e8e\u5b58\u50a8\u5185\u5b58\u548c\u6267\u884c\u5185\u5b58\u5171\u4eab\u540c\u4e00\u5757\u7a7a\u95f4\uff0c\u53ef\u4ee5\u52a8\u6001\u5360\u7528\u5bf9\u65b9\u7684\u7a7a\u95f2\u533a\u57df\uff0c\u7edf\u4e00\u5185\u5b58\u7ba1\u7406\u7684\u5806\u5185\u5185\u5b58\u7ed3\u6784\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7edf\u4e00\u5185\u5b58\u7ba1\u7406\u7684\u5806\u5916\u5185\u5b58\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5176\u4e2d\u6700\u91cd\u8981\u7684\u4f18\u5316\u5728\u4e8e\u52a8\u6001\u5360\u7528\u673a\u5236\uff0c\u5176\u89c4\u5219\u5982\u4e0b\uff1a</p> <p>\uff081\uff09\u8bbe\u5b9a\u57fa\u672c\u7684\u5b58\u50a8\u5185\u5b58\u548c\u6267\u884c\u5185\u5b58\u533a\u57df\uff08spark.storage.storageFraction \u53c2\u6570\uff09\uff0c\u8be5\u8bbe\u5b9a\u786e\u5b9a\u4e86\u53cc\u65b9\u5404\u81ea\u62e5\u6709\u7684\u7a7a\u95f4\u7684\u8303\u56f4</p> <p>\uff082\uff09\u53cc\u65b9\u7684\u7a7a\u95f4\u90fd\u4e0d\u8db3\u65f6\uff0c\u5219\u5b58\u50a8\u5230\u786c\u76d8\uff1b\u82e5\u5df1\u65b9\u7a7a\u95f4\u4e0d\u8db3\u800c\u5bf9\u65b9\u7a7a\u4f59\u65f6\uff0c\u53ef\u501f\u7528\u5bf9\u65b9\u7684\u7a7a\u95f4;\uff08\u5b58\u50a8\u7a7a\u95f4\u4e0d\u8db3\u662f\u6307\u4e0d\u8db3\u4ee5\u653e\u4e0b\u4e00\u4e2a\u5b8c\u6574\u7684 Block\uff09</p> <p>\uff083\uff09\u6267\u884c\u5185\u5b58\u7684\u7a7a\u95f4\u88ab\u5bf9\u65b9\u5360\u7528\u540e\uff0c\u53ef\u8ba9\u5bf9\u65b9\u5c06\u5360\u7528\u7684\u90e8\u5206\u8f6c\u5b58\u5230\u786c\u76d8\uff0c\u7136\u540e\u201d\u5f52\u8fd8\u201d\u501f\u7528\u7684\u7a7a\u95f4</p> <p>\uff084\uff09\u5b58\u50a8\u5185\u5b58\u7684\u7a7a\u95f4\u88ab\u5bf9\u65b9\u5360\u7528\u540e\uff0c\u65e0\u6cd5\u8ba9\u5bf9\u65b9\u201d\u5f52\u8fd8\u201d\uff0c\u56e0\u4e3a\u9700\u8981\u8003\u8651 Shuffle \u8fc7\u7a0b\u4e2d\u7684\u5f88\u591a\u56e0\u7d20\uff0c\u5b9e\u73b0\u8d77\u6765\u8f83\u4e3a\u590d\u6742</p> <p>\u7edf\u4e00\u5185\u5b58\u7ba1\u7406\u7684\u52a8\u6001\u5360\u7528\u673a\u5236\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"engine/spark/spark_15/#153","title":"15.3 \u5b58\u50a8\u5185\u5b58\u7ba1\u7406","text":""},{"location":"engine/spark/spark_15/#1531-rdd","title":"15.3.1 RDD\u7684\u6301\u4e45\u5316\u673a\u5236","text":"<p>RDD \u7684\u6301\u4e45\u5316\u7531 Spark \u7684 Storage \u6a21\u5757\u8d1f\u8d23\uff0c\u5b9e\u73b0\u4e86 RDD \u4e0e\u7269\u7406\u5b58\u50a8\u7684\u89e3\u8026\u5408\u3002Storage \u6a21\u5757\u8d1f\u8d23\u7ba1\u7406 Spark \u5728\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u6570\u636e\uff0c\u5c06\u90a3\u4e9b\u5728\u5185\u5b58\u6216\u78c1\u76d8\u3001\u5728\u672c\u5730\u6216\u8fdc\u7a0b\u5b58\u53d6\u6570\u636e\u7684\u529f\u80fd\u5c01\u88c5\u4e86\u8d77\u6765\u3002\u5728\u5177\u4f53\u5b9e\u73b0\u65f6 Driver \u7aef\u548c Executor \u7aef\u7684 Storage \u6a21\u5757\u6784\u6210\u4e86\u4e3b\u4ece\u5f0f\u7684\u67b6\u6784\uff0c\u5373 Driver \u7aef\u7684 BlockManager \u4e3a Master\uff0cExecutor \u7aef\u7684 BlockManager \u4e3a Slave\u3002</p> <p>Storage \u6a21\u5757\u5728\u903b\u8f91\u4e0a\u4ee5 Block \u4e3a\u57fa\u672c\u5b58\u50a8\u5355\u4f4d\uff0cRDD \u7684\u6bcf\u4e2a Partition \u7ecf\u8fc7\u5904\u7406\u540e\u552f\u4e00\u5bf9\u5e94\u4e00\u4e2a Block\uff08BlockId \u7684\u683c\u5f0f\u4e3a rdd_RDD-ID_PARTITION-ID \uff09\u3002Driver \u7aef\u7684 Master \u8d1f\u8d23\u6574\u4e2a Spark \u5e94\u7528\u7a0b\u5e8f\u7684 Block \u7684\u5143\u6570\u636e\u4fe1\u606f\u7684\u7ba1\u7406\u548c\u7ef4\u62a4\uff0c\u800c Executor \u7aef\u7684 Slave \u9700\u8981\u5c06 Block \u7684\u66f4\u65b0\u7b49\u72b6\u6001\u4e0a\u62a5\u5230 Master\uff0c\u540c\u65f6\u63a5\u6536 Master \u7684\u547d\u4ee4\uff0c\u4f8b\u5982\u65b0\u589e\u6216\u5220\u9664\u4e00\u4e2a RDD\u3002</p> <p></p> <p>\u5728\u5bf9 RDD \u6301\u4e45\u5316\u65f6\uff0cSpark \u89c4\u5b9a\u4e86 MEMORY_ONLY\u3001MEMORY_AND_DISK \u7b49 7 \u79cd\u4e0d\u540c\u7684\u5b58\u50a8\u7ea7\u522b\uff0c\u800c\u5b58\u50a8\u7ea7\u522b\u662f\u4ee5\u4e0b 5 \u4e2a\u53d8\u91cf\u7684\u7ec4\u5408\uff1a</p> <pre><code>class StorageLevel private(\nprivate var _useDisk: Boolean, //\u78c1\u76d8\nprivate var _useMemory: Boolean, //\u8fd9\u91cc\u5176\u5b9e\u662f\u6307\u5806\u5185\u5185\u5b58\nprivate var _useOffHeap: Boolean, //\u5806\u5916\u5185\u5b58\nprivate var _deserialized: Boolean, //\u662f\u5426\u4e3a\u975e\u5e8f\u5217\u5316\nprivate var _replication: Int = 1 //\u526f\u672c\u4e2a\u6570\n)\n</code></pre> <p>Spark \u4e2d 7 \u79cd\u5b58\u50a8\u7ea7\u522b\u5982\u4e0b\uff1a</p> \u6301\u4e45\u5316\u7ea7\u522b \u542b\u4e49 MEMORY_ONLY \u4ee5\u975e\u5e8f\u5217\u5316\u7684 Java \u5bf9\u8c61\u7684\u65b9\u5f0f\u6301\u4e45\u5316\u5728 JVM \u5185\u5b58\u4e2d\u3002\u5982\u679c\u5185\u5b58\u65e0\u6cd5\u5b8c\u5168\u5b58\u50a8 RDD \u6240\u6709\u7684 partition\uff0c\u90a3\u4e48\u90a3\u4e9b\u6ca1\u6709\u6301\u4e45\u5316\u7684 partition \u5c31\u4f1a\u5728\u4e0b\u4e00\u6b21\u9700\u8981\u4f7f\u7528\u5b83\u4eec\u7684\u65f6\u5019\uff0c\u91cd\u65b0\u88ab\u8ba1\u7b97 MEMORY_AND_DISK \u540c\u4e0a\uff0c\u4f46\u662f\u5f53\u67d0\u4e9b partition \u65e0\u6cd5\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u65f6\uff0c\u4f1a\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e2d\u3002\u4e0b\u6b21\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b partition \u65f6\uff0c\u9700\u8981\u4ece\u78c1\u76d8\u4e0a\u8bfb\u53d6 MEMORY_ONLY_SER \u540c MEMORY_ONLY\uff0c\u4f46\u662f\u4f1a\u4f7f\u7528 Java \u5e8f\u5217\u5316\u65b9\u5f0f\uff0c\u5c06 Java \u5bf9\u8c61\u5e8f\u5217\u5316\u540e\u8fdb\u884c\u6301\u4e45\u5316\u3002\u53ef\u4ee5\u51cf\u5c11\u5185\u5b58\u5f00\u9500\uff0c\u4f46\u662f\u9700\u8981\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u56e0\u6b64\u4f1a\u52a0\u5927 CPU \u5f00\u9500 MEMORY_AND_DISK_SER \u540c MEMORY_AND_DISK \uff0c\u4f46\u662f\u4f7f\u7528\u5e8f\u5217\u5316\u65b9\u5f0f\u6301\u4e45\u5316 Java \u5bf9\u8c61 DISK_ONLY \u4f7f\u7528\u975e\u5e8f\u5217\u5316 Java \u5bf9\u8c61\u7684\u65b9\u5f0f\u6301\u4e45\u5316\uff0c\u5b8c\u5168\u5b58\u50a8\u5230\u78c1\u76d8\u4e0a MEMORY_ONLY_2MEMORY_AND_DISK_2\u7b49\u7b49 \u5982\u679c\u662f\u5c3e\u90e8\u52a0\u4e86 2 \u7684\u6301\u4e45\u5316\u7ea7\u522b\uff0c\u8868\u793a\u5c06\u6301\u4e45\u5316\u6570\u636e\u590d\u7528\u4e00\u4efd\uff0c\u4fdd\u5b58\u5230\u5176\u4ed6\u8282\u70b9\uff0c\u4ece\u800c\u5728\u6570\u636e\u4e22\u5931\u65f6\uff0c\u4e0d\u9700\u8981\u518d\u6b21\u8ba1\u7b97\uff0c\u53ea\u9700\u8981\u4f7f\u7528\u5907\u4efd\u6570\u636e\u5373\u53ef <p>\u901a\u8fc7\u5bf9\u6570\u636e\u7ed3\u6784\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u51fa\u5b58\u50a8\u7ea7\u522b\u4ece\u4e09\u4e2a\u7ef4\u5ea6\u5b9a\u4e49\u4e86 RDD \u7684 Partition\uff08\u540c\u65f6\u4e5f\u5c31\u662f Block \uff09\u7684\u5b58\u50a8\u65b9\u5f0f\uff1a</p> <ul> <li>\u5b58\u50a8\u4f4d\u7f6e\uff1a\u78c1\u76d8\uff0f\u5806\u5185\u5185\u5b58\uff0f\u5806\u5916\u5185\u5b58\u3002\u5982 MEMORY_AND_DISK \u662f\u540c\u65f6\u5728\u78c1\u76d8\u548c\u5806\u5185\u5185\u5b58\u4e0a\u5b58\u50a8\uff0c\u5b9e\u73b0\u4e86\u5197\u4f59\u5907\u4efd\u3002OFF_HEAP \u5219\u662f\u53ea\u5728\u5806\u5916\u5185\u5b58\u5b58\u50a8\uff0c\u76ee\u524d\u9009\u62e9\u5806\u5916\u5185\u5b58\u65f6\u4e0d\u80fd\u540c\u65f6\u5b58\u50a8\u5230\u5176\u4ed6\u4f4d\u7f6e</li> <li>\u5b58\u50a8\u5f62\u5f0f\uff1aBlock \u7f13\u5b58\u5230\u5b58\u50a8\u5185\u5b58\u540e\uff0c\u662f\u5426\u4e3a\u975e\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u3002\u5982 MEMORY_ONLY \u662f\u975e\u5e8f\u5217\u5316\u65b9\u5f0f\u5b58\u50a8\uff0cOFF_HEAP \u662f\u5e8f\u5217\u5316\u65b9\u5f0f\u5b58\u50a8</li> <li>\u526f\u672c\u6570\u91cf\uff1a\u5927\u4e8e 1 \u65f6\u9700\u8981\u8fdc\u7a0b\u5197\u4f59\u5907\u4efd\u5230\u5176\u4ed6\u8282\u70b9\u3002\u5982 DISK_ONLY_2 \u9700\u8981\u8fdc\u7a0b\u5907\u4efd 1 \u4e2a\u526f\u672c</li> </ul>"},{"location":"engine/spark/spark_15/#1532","title":"15.3.2 \u6dd8\u6c70\u4e0e\u843d\u76d8","text":"<p>\u7531\u4e8e\u540c\u4e00\u4e2a Executor \u7684\u6240\u6709\u7684\u8ba1\u7b97\u4efb\u52a1\u5171\u4eab\u6709\u9650\u7684\u5b58\u50a8\u5185\u5b58\u7a7a\u95f4\uff0c\u5f53\u6709\u65b0\u7684 Block \u9700\u8981\u7f13\u5b58\u4f46\u662f\u5269\u4f59\u7a7a\u95f4\u4e0d\u8db3\u4e14\u65e0\u6cd5\u52a8\u6001\u5360\u7528\u65f6\uff0c\u5c31\u8981\u5bf9 LinkedHashMap \u4e2d\u7684\u65e7 Block \u8fdb\u884c\u6dd8\u6c70\uff08Eviction\uff09\uff0c\u800c\u88ab\u6dd8\u6c70\u7684 Block \u5982\u679c\u5176\u5b58\u50a8\u7ea7\u522b\u4e2d\u540c\u65f6\u5305\u542b\u5b58\u50a8\u5230\u78c1\u76d8\u7684\u8981\u6c42\uff0c\u5219\u8981\u5bf9\u5176\u8fdb\u884c\u843d\u76d8\uff08Drop\uff09\uff0c\u5426\u5219\u76f4\u63a5\u5220\u9664\u8be5 Block\u3002</p> <p>\u5b58\u50a8\u5185\u5b58\u7684\u6dd8\u6c70\u89c4\u5219\u4e3a\uff1a</p> <ul> <li>\u88ab\u6dd8\u6c70\u7684\u65e7 Block \u8981\u4e0e\u65b0 Block \u7684 MemoryMode \u76f8\u540c\uff0c\u5373\u540c\u5c5e\u4e8e\u5806\u5916\u6216\u5806\u5185\u5185\u5b58</li> <li>\u65b0\u65e7 Block \u4e0d\u80fd\u5c5e\u4e8e\u540c\u4e00\u4e2a RDD\uff0c\u907f\u514d\u5faa\u73af\u6dd8\u6c70</li> <li>\u65e7 Block \u6240\u5c5e RDD \u4e0d\u80fd\u5904\u4e8e\u88ab\u8bfb\u72b6\u6001\uff0c\u907f\u514d\u5f15\u53d1\u4e00\u81f4\u6027\u95ee\u9898</li> <li>\u904d\u5386 LinkedHashMap \u4e2d Block\uff0c\u6309\u7167\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff08 LRU \uff09\u7684\u987a\u5e8f\u6dd8\u6c70\uff0c\u76f4\u5230\u6ee1\u8db3\u65b0 Block \u6240\u9700\u7684\u7a7a\u95f4\u3002\u5176\u4e2d LRU \u662f LinkedHashMap \u7684\u7279\u6027</li> </ul> <p>\u843d\u76d8\u7684\u6d41\u7a0b\u5219\u6bd4\u8f83\u7b80\u5355\uff0c\u5982\u679c\u5176\u5b58\u50a8\u7ea7\u522b\u7b26\u5408 _useDisk \u4e3a true \u7684\u6761\u4ef6\uff0c\u518d\u6839\u636e\u5176 _deserialized \u5224\u65ad\u662f\u5426\u662f\u975e\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\uff0c\u82e5\u662f\u5219\u5bf9\u5176\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u6700\u540e\u5c06\u6570\u636e\u5b58\u50a8\u5230\u78c1\u76d8\uff0c\u5728 Storage \u6a21\u5757\u4e2d\u66f4\u65b0\u5176\u4fe1\u606f\u3002</p>"},{"location":"engine/spark/spark_15/#154","title":"15.4 \u6267\u884c\u5185\u5b58\u7ba1\u7406","text":"<p>\u6267\u884c\u5185\u5b58\u4e3b\u8981\u7528\u6765\u5b58\u50a8\u4efb\u52a1\u5728\u6267\u884c Shuffle \u65f6\u5360\u7528\u7684\u5185\u5b58\uff0cShuffle \u662f\u6309\u7167\u4e00\u5b9a\u89c4\u5219\u5bf9 RDD \u6570\u636e\u91cd\u65b0\u5206\u533a\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u6765\u770b Shuffle \u7684 Write \u548c Read \u4e24\u9636\u6bb5\u5bf9\u6267\u884c\u5185\u5b58\u7684\u4f7f\u7528\uff1a</p> <p>1\uff09Shuffle Write</p> <p>\u82e5\u5728 map \u7aef\u9009\u62e9\u5feb\u901f\u6392\u5e8f\u65b9\u5f0f\uff0c\u5728\u5185\u5b58\u4e2d\u5b58\u50a8\u6570\u636e\u65f6\u4e3b\u8981\u5360\u7528\u5806\u5185\u6267\u884c\u7a7a\u95f4\u3002</p> <p>\u5728\u5185\u5b58\u4e2d\u5b58\u50a8\u6570\u636e\u65f6\u53ef\u4ee5\u5360\u7528\u5806\u5916\u6216\u5806\u5185\u6267\u884c\u7a7a\u95f4\uff0c\u53d6\u51b3\u4e8e\u7528\u6237\u662f\u5426\u5f00\u542f\u4e86\u5806\u5916\u5185\u5b58\u4ee5\u53ca\u5806\u5916\u6267\u884c\u5185\u5b58\u662f\u5426\u8db3\u591f\u3002</p> <p>2\uff09Shuffle Read</p> <p>\u5728\u5bf9 reduce \u7aef\u7684\u6570\u636e\u8fdb\u884c\u805a\u5408\u65f6\uff0c\u8981\u5c06\u6570\u636e\u4ea4\u7ed9 Aggregator \u5904\u7406\uff0c\u5728\u5185\u5b58\u4e2d\u5b58\u50a8\u6570\u636e\u65f6\u5360\u7528\u5806\u5185\u6267\u884c\u7a7a\u95f4\u3002</p>"},{"location":"engine/spark/spark_16/","title":"\u7b2c16\u7ae0 SparkSQL\u4f18\u5316","text":"<p>Spark 3.0 \u5927\u7248\u672c\u53d1\u5e03\uff0cSpark SQL \u7684\u4f18\u5316\u5360\u6bd4\u5c06\u8fd1 50%\u3002Spark SQL \u53d6\u4ee3 Spark Core\uff0c\u6210\u4e3a\u65b0\u4e00\u4ee3\u7684\u5f15\u64ce\u5185\u6838\uff0c\u6240\u6709\u5176\u4ed6\u5b50\u6846\u67b6\u5982Mllib\u3001Streaming \u548c Graph\uff0c\u90fd\u53ef\u4ee5\u5171\u4eab Spark SQL \u7684\u6027\u80fd\u4f18\u5316\uff0c\u90fd\u80fd\u4ece Spark \u793e\u533a\u5bf9\u4e8e Spark SQL \u7684\u6295\u5165\u4e2d\u53d7\u76ca\u3002</p>"},{"location":"engine/spark/spark_16/#160","title":"16.0 \u51c6\u5907\u6d4b\u8bd5\u7528\u8868\u548c\u6570\u636e","text":"<p>1\uff09\u4e0a\u4f20 3 \u4e2a log \u5230 hdfs \u65b0\u5efa\u7684 sparkdata \u8def\u5f84 2\uff09hive \u4e2d\u521b\u5efa sparktuning \u6570\u636e\u5e93 3\uff09\u6267\u884c</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 2 --executor-memory 4g  --class com.atguigu.sparktuning.utils.InitUtil spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar\n</code></pre>"},{"location":"engine/spark/spark_16/#161","title":"16.1 \u6267\u884c\u8ba1\u5212","text":"<p>SparkSQL \u5177\u6709\u548c Hive \u8bed\u6cd5\u7c7b\u578b\u7684\u6267\u884c\u8ba1\u5212\u67e5\u8be2\uff0c\u4f7f\u7528\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>.explain(mode=\"xxx\")\n</code></pre> <p>\u4ece 3.0 \u5f00\u59cb\uff0cexplain \u65b9\u6cd5\u6709\u4e00\u4e2a\u65b0\u7684\u53c2\u6570 mode\uff0c\u8be5\u53c2\u6570\u53ef\u4ee5\u6307\u5b9a\u6267\u884c\u8ba1\u5212\u5c55\u793a\u683c\u5f0f\uff1a</p> <ul> <li> <p>explain(mode=\"simple\")\uff1a\u53ea\u5c55\u793a\u7269\u7406\u6267\u884c\u8ba1\u5212\u3002</p> </li> <li> <p>explain(mode=\"extended\")\uff1a\u5c55\u793a\u7269\u7406\u6267\u884c\u8ba1\u5212\u548c\u903b\u8f91\u6267\u884c\u8ba1\u5212\u3002</p> </li> <li> <p>explain(mode=\"codegen\") \uff1a\u5c55\u793a\u8981Codegen\u751f\u6210\u7684\u53ef\u6267\u884cJava\u4ee3\u7801\u3002</p> </li> <li> <p>explain(mode=\"cost\")\uff1a\u5c55\u793a\u4f18\u5316\u540e\u7684\u903b\u8f91\u6267\u884c\u8ba1\u5212\u4ee5\u53ca\u76f8\u5173\u7684\u7edf\u8ba1\u3002</p> </li> <li> <p>explain(mode=\"formatted\")\uff1a\u4ee5\u5206\u9694\u7684\u65b9\u5f0f\u8f93\u51fa\uff0c\u5b83\u4f1a\u8f93\u51fa\u66f4\u6613\u8bfb\u7684\u7269\u7406\u6267\u884c\u8ba1\u5212\uff0c\u5e76\u5c55\u793a\u6bcf\u4e2a\u8282\u70b9\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p> </li> </ul>"},{"location":"engine/spark/spark_16/#162","title":"16.2 \u6267\u884c\u8ba1\u5212\u5904\u7406\u6d41\u7a0b","text":"<p>\u6838\u5fc3\u7684\u6267\u884c\u8fc7\u7a0b\u4e00\u5171\u67095\u4e2a\u6b65\u9aa4\uff1a</p> <p></p> <p>\u8fd9\u4e9b\u64cd\u4f5c\u548c\u8ba1\u5212\u90fd\u662f Spark SQL \u81ea\u52a8\u5904\u7406\u7684\uff0c\u4f1a\u751f\u6210\u4ee5\u4e0b\u8ba1\u5212\uff1a</p> <ul> <li>Unresolved \u903b\u8f91\u6267\u884c\u8ba1\u5212\uff1a<code>== Parsed Logical Plan ==</code>   Parser \u7ec4\u4ef6\u68c0\u67e5 SQL \u8bed\u6cd5\u4e0a\u662f\u5426\u6709\u95ee\u9898\uff0c\u7136\u540e\u751f\u6210 Unresolved\uff08\u672a\u51b3\u65ad\uff09\u7684\u903b\u8f91\u8ba1\u5212\uff0c\u4e0d\u68c0\u67e5\u8868\u540d\u3001\u4e0d\u68c0\u67e5\u5217\u540d</li> <li>Resolved \u903b\u8f91\u6267\u884c\u8ba1\u5212\uff1a<code>== Analyzed Logical Plan ==</code>   \u901a\u8fc7\u8bbf\u95ee Spark \u4e2d\u7684 Catalog \u5b58\u50a8\u5e93\u6765\u89e3\u6790\u9a8c\u8bc1\u8bed\u4e49\u3001\u5217\u540d\u3001\u7c7b\u578b\u3001\u8868\u540d\u7b49</li> <li>\u4f18\u5316\u540e\u7684\u903b\u8f91\u6267\u884c\u8ba1\u5212\uff1a<code>== Optimized Logical Plan ==</code>   Catalyst \u4f18\u5316\u5668\u6839\u636e\u5404\u79cd\u89c4\u5219\u8fdb\u884c\u4f18\u5316</li> <li>\u7269\u7406\u6267\u884c\u8ba1\u5212\uff1a<code>== Physical Plan ==</code></li> </ul> <p>\uff081\uff09HashAggregate \u8fd0\u7b97\u7b26\u8868\u793a\u6570\u636e\u805a\u5408\uff0c\u4e00\u822c HashAggregate \u662f\u6210\u5bf9\u51fa\u73b0\uff0c\u7b2c\u4e00\u4e2a HashAggregate \u662f\u5c06\u6267\u884c\u8282\u70b9\u672c\u5730\u7684\u6570\u636e\u8fdb\u884c\u5c40\u90e8\u805a\u5408\uff0c\u53e6\u4e00\u4e2a HashAggregate \u662f\u5c06\u5404\u4e2a\u5206\u533a\u7684\u6570\u636e\u8fdb\u4e00\u6b65\u8fdb\u884c\u805a\u5408\u8ba1\u7b97</p> <p>\uff082\uff09Exchange \u8fd0\u7b97\u7b26\u5176\u5b9e\u5c31\u662f shuffle\uff0c\u8868\u793a\u9700\u8981\u5728\u96c6\u7fa4\u4e0a\u79fb\u52a8\u6570\u636e\u3002\u5f88\u591a\u65f6\u5019 HashAggregate \u4f1a\u4ee5 Exchange \u5206\u9694\u5f00\u6765</p> <p>\uff083\uff09Project \u8fd0\u7b97\u7b26\u662f SQL \u4e2d\u7684\u6295\u5f71\u64cd\u4f5c\uff0c\u5c31\u662f\u9009\u62e9\u5217\uff08\u4f8b\u5982\uff1aselect name, age\u2026\uff09</p> <p>\uff084\uff09BroadcastHashJoin \u8fd0\u7b97\u7b26\u8868\u793a\u901a\u8fc7\u57fa\u4e8e\u5e7f\u64ad\u65b9\u5f0f\u8fdb\u884c HashJoin</p> <p>\uff085\uff09LocalTableScan \u8fd0\u7b97\u7b26\u5c31\u662f\u5168\u8868\u626b\u63cf\u672c\u5730\u7684\u8868</p>"},{"location":"engine/spark/spark_16/#163-rbo","title":"16.3 \u57fa\u4e8eRBO\u7684\u4f18\u5316","text":"<p>SparkSQL \u5728\u6574\u4e2a\u6267\u884c\u8ba1\u5212\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f7f\u7528\u4e86 Catalyst \u4f18\u5316\u5668\u3002</p> <p>\u5728 Spark 3.0 \u7248\u672c\u4e2d\uff0cCatalyst \u603b\u5171\u6709 81 \u6761\u4f18\u5316\u89c4\u5219\uff08Rules\uff09\uff0c\u5206\u6210 27 \u7ec4\uff08Batches\uff09\uff0c\u5176\u4e2d\u6709\u4e9b\u89c4\u5219\u4f1a\u88ab\u5f52\u7c7b\u5230\u591a\u4e2a\u5206\u7ec4\u91cc\u3002\u56e0\u6b64\uff0c\u5982\u679c\u4e0d\u8003\u8651\u89c4\u5219\u7684\u91cd\u590d\u6027\uff0c27 \u7ec4\u7b97\u4e0b\u6765\u603b\u5171\u4f1a\u6709 129 \u4e2a\u4f18\u5316\u89c4\u5219\u3002</p> <p>\u5982\u679c\u4ece\u4f18\u5316\u6548\u679c\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u8fd9\u4e9b\u89c4\u5219\u53ef\u4ee5\u5f52\u7eb3\u5230\u4ee5\u4e0b 3 \u4e2a\u8303\u7574\uff1a</p>"},{"location":"engine/spark/spark_16/#1631-predicate-pushdown","title":"16.3.1 \u8c13\u8bcd\u4e0b\u63a8\uff08Predicate Pushdown\uff09","text":"<p>\u5c06\u8fc7\u6ee4\u6761\u4ef6\u7684\u8c13\u8bcd\u903b\u8f91\u90fd\u5c3d\u53ef\u80fd\u63d0\u524d\u6267\u884c\uff0c\u51cf\u5c11\u4e0b\u6e38\u5904\u7406\u7684\u6570\u636e\u91cf\u3002\u5bf9\u5e94 PushDownPredicte \u4f18\u5316\u89c4\u5219\uff0c\u5bf9\u4e8e Parquet\u3001ORC \u8fd9\u7c7b\u5b58\u50a8\u683c\u5f0f\uff0c\u7ed3\u5408\u6587\u4ef6\u6ce8\u811a\uff08Footer\uff09\u4e2d\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4e0b\u63a8\u7684\u8c13\u8bcd\u80fd\u591f\u5927\u5e45\u51cf\u5c11\u6570\u636e\u626b\u63cf\u91cf\uff0c\u964d\u4f4e\u78c1\u76d8 I/O \u5f00\u9500\u3002</p> <p>\u5de6\u5916\u5173\u8054\u4e0b\u63a8\u89c4\u5219\uff1a\u5de6\u8868 left join \u53f3\u8868\u3002</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 4 --executor-memory 6g  --class com.atguigu.sparktuning.rbo.PredicateTuning spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar </code></pre> \u60c5\u51b5 \u5de6\u8868 \u53f3\u8868 Join\u4e2d\u6761\u4ef6\uff08on\uff09 \u53ea\u4e0b\u63a8\u53f3\u8868 \u53ea\u4e0b\u63a8\u53f3\u8868 Join\u540e\u6761\u4ef6\uff08where\uff09 \u4e24\u8868\u90fd\u4e0b\u63a8 \u4e24\u8868\u90fd\u4e0b\u63a8 <p>\u6ce8\u610f</p> <p>\u5916\u5173\u8054\u65f6\uff0c\u8fc7\u6ee4\u6761\u4ef6\u5199\u5728 on \u4e0e where\uff0c\u7ed3\u679c\u662f\u4e0d\u4e00\u6837\u7684\uff01</p>"},{"location":"engine/spark/spark_16/#1632-column-pruning","title":"16.3.2 \u5217\u526a\u88c1\uff08Column Pruning\uff09","text":"<p>\u5217\u526a\u88c1\u5c31\u662f\u626b\u63cf\u6570\u636e\u6e90\u7684\u65f6\u5019\uff0c\u53ea\u8bfb\u53d6\u90a3\u4e9b\u4e0e\u67e5\u8be2\u76f8\u5173\u7684\u5b57\u6bb5\u3002</p>"},{"location":"engine/spark/spark_16/#1633-constant-folding","title":"16.3.3 \u5e38\u91cf\u66ff\u6362\uff08Constant Folding\uff09","text":"<p>\u5047\u8bbe\u6211\u4eec\u5728\u5e74\u9f84\u4e0a\u52a0\u7684\u8fc7\u6ee4\u6761\u4ef6\u662f <code>age &lt; 12 + 18</code>\uff0cCatalyst \u4f1a\u4f7f\u7528 ConstantFolding \u89c4\u5219\uff0c\u81ea\u52a8\u5e2e\u6211\u4eec\u628a\u6761\u4ef6\u53d8\u6210 <code>age &lt; 30</code>\u3002\u518d\u6bd4\u5982\uff0c\u6211\u4eec\u5728 select \u8bed\u53e5\u4e2d\uff0c\u63ba\u6742\u4e86\u4e00\u4e9b\u5e38\u91cf\u8868\u8fbe\u5f0f\uff0cCatalyst \u4e5f\u4f1a\u81ea\u52a8\u5730\u7528\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u8fdb\u884c\u66ff\u6362\u3002</p>"},{"location":"engine/spark/spark_16/#164-cbo","title":"16.4 \u57fa\u4e8eCBO\u7684\u4f18\u5316","text":"<p>CBO \u4f18\u5316\u4e3b\u8981\u5728\u7269\u7406\u8ba1\u5212\u5c42\u9762\uff0c\u539f\u7406\u662f\u8ba1\u7b97\u6240\u6709\u53ef\u80fd\u7684\u7269\u7406\u8ba1\u5212\u7684\u4ee3\u4ef7\uff0c\u5e76\u6311\u9009\u51fa\u4ee3\u4ef7\u6700\u5c0f\u7684\u7269\u7406\u6267\u884c\u8ba1\u5212\u3002\u5145\u5206\u8003\u8651\u4e86\u6570\u636e\u672c\u8eab\u7684\u7279\u70b9\uff08\u5982\u5927\u5c0f\u3001\u5206\u5e03\uff09\u4ee5\u53ca\u64cd\u4f5c\u7b97\u5b50\u7684\u7279\u70b9\uff08\u4e2d\u95f4\u7ed3\u679c\u96c6\u7684\u5206\u5e03\u53ca\u5927\u5c0f\uff09\u53ca\u4ee3\u4ef7\uff0c\u4ece\u800c\u66f4\u597d\u7684\u9009\u62e9\u6267\u884c\u4ee3\u4ef7\u6700\u5c0f\u7684\u7269\u7406\u6267\u884c\u8ba1\u5212\u3002</p> <p>\u800c\u6bcf\u4e2a\u6267\u884c\u8282\u70b9\u7684\u4ee3\u4ef7\uff0c\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a</p> <p>\uff081\uff09\u8be5\u6267\u884c\u8282\u70b9\u5bf9\u6570\u636e\u96c6\u7684\u5f71\u54cd\uff0c\u5373\u8be5\u8282\u70b9\u8f93\u51fa\u6570\u636e\u96c6\u7684\u5927\u5c0f\u4e0e\u5206\u5e03</p> <p>\uff082\uff09\u8be5\u6267\u884c\u8282\u70b9\u64cd\u4f5c\u7b97\u5b50\u7684\u4ee3\u4ef7</p> <p>\u6bcf\u4e2a\u64cd\u4f5c\u7b97\u5b50\u7684\u4ee3\u4ef7\u76f8\u5bf9\u56fa\u5b9a\uff0c\u53ef\u7528\u89c4\u5219\u6765\u63cf\u8ff0\u3002\u800c\u6267\u884c\u8282\u70b9\u8f93\u51fa\u6570\u636e\u96c6\u7684\u5927\u5c0f\u4e0e\u5206\u5e03\uff0c\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a</p> <p>\uff081\uff09\u521d\u59cb\u6570\u636e\u96c6\uff0c\u4e5f\u5373\u539f\u59cb\u8868\uff0c\u5176\u6570\u636e\u96c6\u7684\u5927\u5c0f\u4e0e\u5206\u5e03\u53ef\u76f4\u63a5\u901a\u8fc7\u7edf\u8ba1\u5f97\u5230 \uff082\uff09\u4e2d\u95f4\u8282\u70b9\u8f93\u51fa\u6570\u636e\u96c6\u7684\u5927\u5c0f\u4e0e\u5206\u5e03\u53ef\u7531\u5176\u8f93\u5165\u6570\u636e\u96c6\u7684\u4fe1\u606f\u4e0e\u64cd\u4f5c\u672c\u8eab\u7684\u7279\u70b9\u63a8\u7b97</p>"},{"location":"engine/spark/spark_16/#165-join","title":"16.5 JOIN\u7b56\u7565","text":"<p>Spark \u63d0\u4f9b\u4e86 5 \u79cd JOIN \u673a\u5236\u6765\u6267\u884c\u5177\u4f53\u7684 JOIN \u64cd\u4f5c\u3002\u9009\u62e9\u7684\u65b9\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"engine/spark/spark_16/#1651-join","title":"16.5.1 \u5f71\u54cdJoin\u7684\u56e0\u7d20","text":""},{"location":"engine/spark/spark_16/#1","title":"1\uff09\u6570\u636e\u96c6\u7684\u5927\u5c0f","text":"<p>\u53c2\u4e0e JOIN \u7684\u6570\u636e\u96c6\u7684\u5927\u5c0f\u4f1a\u76f4\u63a5\u5f71\u54cd JOIN \u64cd\u4f5c\u7684\u6267\u884c\u6548\u7387\u3002\u540c\u6837\uff0c\u4e5f\u4f1a\u5f71\u54cd JOIN \u673a\u5236\u7684\u9009\u62e9\u548c JOIN \u7684\u6267\u884c\u6548\u7387\u3002</p>"},{"location":"engine/spark/spark_16/#2join","title":"2\uff09Join\u7684\u6761\u4ef6","text":"<p>JOIN \u7684\u6761\u4ef6\u4f1a\u6d89\u53ca\u5b57\u6bb5\u4e4b\u95f4\u7684\u903b\u8f91\u6bd4\u8f83\u3002\u6839\u636e JOIN \u7684\u6761\u4ef6\uff0cJOIN \u53ef\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a\u7b49\u503c\u8fde\u63a5\u548c\u975e\u7b49\u503c\u8fde\u63a5\u3002\u7b49\u503c\u8fde\u63a5\u4f1a\u6d89\u53ca\u4e00\u4e2a\u6216\u591a\u4e2a\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u7684\u76f8\u7b49\u6761\u4ef6\u3002\u5728\u4e24\u4e2a\u8f93\u5165\u6570\u636e\u96c6\u7684\u5c5e\u6027\u4e4b\u95f4\u5e94\u7528\u6bcf\u4e2a\u7b49\u503c\u6761\u4ef6\u3002\u5f53\u4f7f\u7528\u5176\u4ed6\u8fd0\u7b97\u7b26(\u8fd0\u7b97\u8fde\u63a5\u7b26\u4e0d\u4e3a <code>=</code> )\u65f6\uff0c\u79f0\u4e4b\u4e3a\u975e\u7b49\u503c\u8fde\u63a5\u3002</p>"},{"location":"engine/spark/spark_16/#3join","title":"3\uff09Join\u7684\u7c7b\u578b","text":"<p>\u5728\u8f93\u5165\u6570\u636e\u96c6\u7684\u8bb0\u5f55\u4e4b\u95f4\u5e94\u7528\u8fde\u63a5\u6761\u4ef6\u4e4b\u540e\uff0cJOIN \u7c7b\u578b\u4f1a\u5f71\u54cd JOIN \u64cd\u4f5c\u7684\u7ed3\u679c\u3002\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd JOIN \u7c7b\u578b\uff1a</p> <ul> <li>\u5185\u8fde\u63a5\uff08Inner Join\uff09\uff1a\u4ec5\u4ece\u8f93\u5165\u6570\u636e\u96c6\u4e2d\u8f93\u51fa\u5339\u914d\u8fde\u63a5\u6761\u4ef6\u7684\u8bb0\u5f55</li> <li>\u5916\u8fde\u63a5\uff08Outer Join\uff09\uff1a\u53c8\u5206\u4e3a\u5de6\u5916\u8fde\u63a5\u3001\u53f3\u5916\u94fe\u63a5\u548c\u5168\u5916\u8fde\u63a5</li> <li>\u534a\u8fde\u63a5\uff08Semi Join\uff09\uff1a\u53f3\u8868\u53ea\u7528\u4e8e\u8fc7\u6ee4\u5de6\u8868\u7684\u6570\u636e\u800c\u4e0d\u51fa\u73b0\u5728\u7ed3\u679c\u96c6\u4e2d</li> <li>\u4ea4\u53c9\u8fde\u63a5\uff08Cross Join\uff09\uff1a\u4ea4\u53c9\u8054\u63a5\u8fd4\u56de\u5de6\u8868\u4e2d\u7684\u6240\u6709\u884c\uff0c\u5de6\u8868\u4e2d\u7684\u6bcf\u4e00\u884c\u4e0e\u53f3\u8868\u4e2d\u7684\u6240\u6709\u884c\u7ec4\u5408\u3002\u4ea4\u53c9\u8054\u63a5\u4e5f\u79f0\u4f5c\u7b1b\u5361\u5c14\u79ef</li> </ul>"},{"location":"engine/spark/spark_16/#1652-shuffle-hash-join","title":"16.5.2 Shuffle Hash Join","text":"<p>\u5f53\u6267\u884c\u6570\u636e\u91cf\u8f83\u5927\u7684\u7b49\u503c\u8fde\u63a5\u65f6\uff0c\u4f7f\u7528 Shuffle Hash Join\uff0c\u64cd\u4f5c\u6d41\u7a0b\u4e3a\u5c06\u4e24\u4e2a\u8868\u9700\u8981 Join \u7684 Key\uff0c\u8fdb\u884c hash \u91cd\u5206\u533a\u8d70 shuffle\uff0c\u5199\u5165\u78c1\u76d8\u4e4b\u540e\uff0c\u5c06\u76f8\u540c\u5206\u533a\u7f16\u53f7\u7684\u6570\u636e\u8bfb\u53d6\u5408\u5e76\u3002</p> <p>\u6761\u4ef6\u4e0e\u7279\u70b9\uff1a</p> <p>\uff081\uff09\u4ec5\u652f\u6301\u7b49\u503c\u8fde\u63a5\uff0cjoin key \u4e0d\u9700\u8981\u6392\u5e8f \uff082\uff09\u652f\u6301\u9664\u4e86\u5168\u5916\u8fde\u63a5( full outer joins )\u4e4b\u5916\u7684\u6240\u6709 join \u7c7b\u578b \uff083\uff09\u9700\u8981\u5bf9\u5c0f\u8868\u6784\u5efa Hash map\uff0c\u5c5e\u4e8e\u5185\u5b58\u5bc6\u96c6\u578b\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u6784\u5efa Hash \u8868\u7684\u4e00\u4fa7\u6570\u636e\u6bd4\u8f83\u5927\uff0c\u53ef\u80fd\u4f1a\u9020\u6210 OOM \uff084\uff09\u5c06\u53c2\u6570 <code>spark.sql.join.prefersortmergeJoin</code>  \u7f6e\u4e3a false\u3002</p>"},{"location":"engine/spark/spark_16/#1653-broadcast-hash-join","title":"16.5.3 Broadcast Hash Join","text":"<p>\u5e7f\u64ad Join\uff0c\u4e5f\u79f0\u4e3a Map \u7aef Join\uff0c\u8be5\u64cd\u4f5c\u53ef\u4ee5\u907f\u514d\u8d70 shuffle\uff0c\u662f\u4e00\u79cd\u975e\u5e38\u9ad8\u6548\u7684 Join \u64cd\u4f5c\u3002\u5f53\u4e00\u5f20\u8868\u683c\u6bd4\u8f83\u5c0f\u7684\u65f6\u5019\uff0c\u901a\u5e38\u4f7f\u7528 Broadcast Hash Join\u3002\u5177\u4f53\u7684\u64cd\u4f5c\u4e3a\u5148\u5c06\u5c0f\u8868\u53d1\u9001\u5230 Driver \u7aef\uff0c\u4e4b\u540e\u4f7f\u7528\u5e7f\u64ad\u53d8\u91cf\u53d1\u9001\u5230\u6bcf\u4e2a Executor \u7aef\u3002</p> <p>1\uff09\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u81ea\u52a8\u5e7f\u64ad</p> <p>\u5e7f\u64ad join \u9ed8\u8ba4\u503c\u4e3a 10MB\uff0c\u7531 <code>spark.sql.autoBroadcastJoinThreshold</code> \u53c2\u6570\u63a7\u5236\u3002</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 2 --executor-memory 4g  --class com.atguigu.sparktuning.join.AutoBroadcastJoinTuning spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar\n</code></pre> <p>2\uff09\u5f3a\u884c\u5e7f\u64ad</p> <p>\u4fee\u6539\u4f7f\u7528\u7684 sqlStr1 \u8fdb\u884c join \u63d0\u793a\u3002</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 2 --executor-memory 4g  --class com.atguigu.sparktuning.join.AutoBroadcastJoinTuning spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar\n</code></pre> <p>\u6761\u4ef6\u4e0e\u7279\u70b9</p> <p>\uff081\uff09\u4ec5\u652f\u6301\u7b49\u503c\u8fde\u63a5\uff0cjoin key \u4e0d\u9700\u8981\u6392\u5e8f \uff082\uff09\u652f\u6301\u9664\u4e86\u5168\u5916\u8fde\u63a5\uff08 full outer joins \uff09\u4e4b\u5916\u7684\u6240\u6709 join \u7c7b\u578b \uff083\uff09Broadcast Hash Join \u76f8\u6bd4\u5176\u4ed6\u7684 join \u673a\u5236\u800c\u8a00\uff0c\u6548\u7387\u66f4\u9ad8\u3002\u4f46\u662f\uff0cBroadcast Hash Join \u5c5e\u4e8e\u7f51\u7edc\u5bc6\u96c6\u578b\u7684\u64cd\u4f5c\uff08\u6570\u636e\u5197\u4f59\u4f20\u8f93\uff09\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u9700\u8981\u5728 Driver \u7aef\u7f13\u5b58\u6570\u636e\uff0c\u6240\u4ee5\u5f53\u5c0f\u8868\u7684\u6570\u636e\u91cf\u8f83\u5927\u65f6\uff0c\u4f1a\u51fa\u73b0 OOM \u7684\u60c5\u51b5 \uff084\uff09\u88ab\u5e7f\u64ad\u7684\u5c0f\u8868\u7684\u6570\u636e\u91cf\u8981\u5c0f\u4e8e <code>spark.sql.autoBroadcastJoinThreshold</code> \u503c\uff0c\u9ed8\u8ba4\u662f 10MB (10485760) \uff085\uff09\u57fa\u8868\u4e0d\u80fd\u88ab broadcast\uff0c\u6bd4\u5982\u5de6\u8fde\u63a5\u65f6\uff0c\u53ea\u80fd\u5c06\u53f3\u8868\u8fdb\u884c\u5e7f\u64ad\u3002\u5f62\u5982\uff1afact_table.join(broadcast(dimension_table)\uff0c\u53ef\u4ee5\u4e0d\u4f7f\u7528 broadcast \u63d0\u793a\uff0c\u5f53\u6ee1\u8db3\u6761\u4ef6\u65f6\u4f1a\u81ea\u52a8\u8f6c\u4e3a\u8be5 join \u65b9\u5f0f\u3002</p>"},{"location":"engine/spark/spark_16/#1654-sort-merge-join","title":"16.5.4 Sort Merge Join","text":"<p>\u8be5 JOIN \u673a\u5236\u662f Spark \u9ed8\u8ba4\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570 <code>spark.sql.join.preferSortMergeJoin</code> \u8fdb\u884c\u914d\u7f6e\uff0c\u9ed8\u8ba4\u662f true\uff0c\u5373\u4f18\u5148\u4f7f\u7528 Sort Merge Join\u3002\u4e00\u822c\u5728\u4e24\u5f20\u5927\u8868\u8fdb\u884c JOIN \u65f6\uff0c\u4f7f\u7528\u8be5\u65b9\u5f0f\u3002</p> <p>\u6761\u4ef6\u4e0e\u7279\u70b9\uff1a</p> <p>\uff081\uff09\u4ec5\u652f\u6301\u7b49\u503c\u8fde\u63a5 \uff082\uff09\u652f\u6301\u6240\u6709 join \u7c7b\u578b \uff083\uff09Join Key \u662f\u6392\u5e8f\u7684 \uff084\uff09\u53c2\u6570 <code>spark.sql.join.prefersortmergeJoin</code>   (\u9ed8\u8ba4 true )\u8bbe\u5b9a\u4e3a true</p> <p>\u6876 join \u4f18\u5316\uff1a\u9700\u8981\u8fdb\u884c\u5206\u6876\uff0c\u9996\u5148\u4f1a\u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u6839\u636e key \u503c\u5408\u5e76\uff0c\u628a\u76f8\u540c key \u7684\u6570\u636e\u653e\u5230\u540c\u4e00\u4e2a bucket \u4e2d\uff08\u6309\u7167 key \u8fdb\u884c hash \uff09\u3002\u5206\u6876\u7684\u76ee\u7684\u5176\u5b9e\u5c31\u662f\u628a\u5927\u8868\u5316\u6210\u5c0f\u8868\u3002\u76f8\u540c key \u7684\u6570\u636e\u90fd\u5728\u540c\u4e00\u4e2a\u6876\u4e2d\u4e4b\u540e\uff0c\u518d\u8fdb\u884c join \u64cd\u4f5c\uff0c\u90a3\u4e48\u5728\u8054\u5408\u7684\u65f6\u5019\u5c31\u4f1a\u5927\u5e45\u5ea6\u7684\u51cf\u5c0f\u65e0\u5173\u9879\u7684\u626b\u63cf\u3002</p> <p>\u4f7f\u7528\u6761\u4ef6\uff1a \uff081\uff09\u4e24\u8868\u8fdb\u884c\u5206\u6876\uff0c\u6876\u7684\u4e2a\u6570\u5fc5\u987b\u76f8\u7b49 \uff082\uff09\u4e24\u8fb9\u8fdb\u884c join \u65f6\uff0cjoin \u5217 = \u6392\u5e8f\u5217 = \u5206\u6876\u5217</p> <p>\u4e0d\u4f7f\u7528SMB Join\uff1a</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 2 --executor-memory 6g  --class com.atguigu.sparktuning.join.BigJoinDemo spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar\n</code></pre> <p>\u4f7f\u7528SMB Join\uff1a</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 2 --executor-memory 6g  --class com.atguigu.sparktuning.join.SMBJoinTuning spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar\n</code></pre>"},{"location":"engine/spark/spark_16/#1655-cartesian-join","title":"16.5.5 Cartesian Join","text":"<p>\u975e\u7b49\u503c\u8fde\u63a5\u65f6\u4f1a\u4f7f\u7528 Cartesian Join\u3002\u987e\u540d\u601d\u4e49\uff0c\u8fd9\u79cd Join \u7684\u7ed3\u679c\u5c31\u662f\u5f97\u5230\u4e24\u5f20\u8868\u7684\u7b1b\u5361\u5c14\u79ef\u3002</p> <p>\u6761\u4ef6\u4e0e\u7279\u70b9\uff1a</p> <p>\uff081\uff09\u4ec5\u652f\u6301\u5185\u8fde\u63a5 \uff082\uff09\u652f\u6301\u7b49\u503c\u548c\u4e0d\u7b49\u503c\u8fde\u63a5 \uff083\uff09\u5f00\u542f\u53c2\u6570 <code>spark.sql.crossJoin.enabled=true</code></p>"},{"location":"engine/spark/spark_16/#1656-broadcast-nested-loop-join","title":"16.5.6 Broadcast Nested Loop Join","text":"<p>\u65e0\u6cd5\u4f7f\u7528\u522b\u7684 Join \u7b56\u7565\u65f6\u7684\u6700\u540e\u9009\u62e9\uff0c\u4e00\u822c\u5728\u975e\u7b49\u503c\u8fde\u63a5\uff0c\u540c\u65f6\u8fd8\u4e0d\u662f\u5185\u8fde\u63a5\u7684\u65f6\u5019\u4f7f\u7528\u3002\u5e94\u8be5\u907f\u514d\u4f7f\u7528\u8fd9\u79cd Join \u7b56\u7565\u3002</p> <p>\u6761\u4ef6\u4e0e\u7279\u70b9\uff1a</p> <p>\uff081\uff09\u6761\u4ef6\u4e0e\u7279\u70b9 \uff082\uff09\u652f\u6301\u7b49\u503c\u548c\u975e\u7b49\u503c\u8fde\u63a5 \uff083\uff09\u652f\u6301\u6240\u6709\u7684 JOIN \u7c7b\u578b\uff0c\u4e3b\u8981\u4f18\u5316\u70b9\u5982\u4e0b\uff1a</p> <ul> <li>\u5f53\u53f3\u5916\u8fde\u63a5\u65f6\u8981\u5e7f\u64ad\u5de6\u8868</li> <li>\u5f53\u5de6\u5916\u8fde\u63a5\u65f6\u8981\u5e7f\u64ad\u53f3\u8868</li> <li>\u5f53\u5185\u8fde\u63a5\u65f6\uff0c\u8981\u5e7f\u64ad\u5de6\u53f3\u4e24\u5f20\u8868</li> </ul>"},{"location":"engine/spark/spark_16/#166-aqe","title":"16.6 AQE\u81ea\u9002\u5e94\u4f18\u5316","text":"<p>Spark \u5728 3.0 \u7248\u672c\u63a8\u51fa\u4e86 AQE\uff08Adaptive Query Execution\uff09\uff0c\u5373\u81ea\u9002\u5e94\u67e5\u8be2\u6267\u884c\u3002AQE \u662f Spark SQL \u7684\u4e00\u79cd\u52a8\u6001\u4f18\u5316\u673a\u5236\uff0c\u5728\u8fd0\u884c\u65f6\uff0c\u6bcf\u5f53 Shuffle Map \u9636\u6bb5\u6267\u884c\u5b8c\u6bd5\uff0cAQE \u90fd\u4f1a\u7ed3\u5408\u8fd9\u4e2a\u9636\u6bb5\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u57fa\u4e8e\u65e2\u5b9a\u7684\u89c4\u5219\u52a8\u6001\u5730\u8c03\u6574\u3001\u4fee\u6b63\u5c1a\u672a\u6267\u884c\u7684\u903b\u8f91\u8ba1\u5212\u548c\u7269\u7406\u8ba1\u5212\uff0c\u6765\u5b8c\u6210\u5bf9\u539f\u59cb\u67e5\u8be2\u8bed\u53e5\u7684\u8fd0\u884c\u65f6\u4f18\u5316\u3002</p>"},{"location":"engine/spark/spark_16/#1661","title":"16.6.1 \u52a8\u6001\u5408\u5e76\u5206\u533a","text":"<p>\u5728 Spark \u4e2d\u8fd0\u884c\u67e5\u8be2\u5904\u7406\u975e\u5e38\u5927\u7684\u6570\u636e\u65f6\uff0cshuffle \u901a\u5e38\u4f1a\u5bf9\u67e5\u8be2\u6027\u80fd\u4ea7\u751f\u975e\u5e38\u91cd\u8981\u7684\u5f71\u54cd\u3002shuffle \u662f\u975e\u5e38\u6602\u8d35\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u8fdb\u884c\u7f51\u7edc\u4f20\u8f93\u79fb\u52a8\u6570\u636e\uff0c\u4ee5\u4fbf\u4e0b\u6e38\u8fdb\u884c\u8ba1\u7b97\u3002</p> <p>\u6700\u597d\u7684\u5206\u533a\u53d6\u51b3\u4e8e\u6570\u636e\uff0c\u4f46\u662f\u6bcf\u4e2a\u67e5\u8be2\u7684\u9636\u6bb5\u4e4b\u95f4\u7684\u6570\u636e\u5927\u5c0f\u53ef\u80fd\u76f8\u5dee\u5f88\u5927\uff0c\u8fd9\u4f7f\u5f97\u8be5\u6570\u5b57\u96be\u4ee5\u8c03\u6574\uff1a</p> <p>\uff081\uff09\u5982\u679c\u5206\u533a\u592a\u5c11\uff0c\u5219\u6bcf\u4e2a\u5206\u533a\u7684\u6570\u636e\u91cf\u53ef\u80fd\u4f1a\u5f88\u5927\uff0c\u5904\u7406\u8fd9\u4e9b\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u5206\u533a\uff0c\u53ef\u80fd\u9700\u8981\u5c06\u6570\u636e\u6ea2\u5199\u5230\u78c1\u76d8\uff08\u4f8b\u5982\uff0c\u6392\u5e8f\u548c\u805a\u5408\uff09\uff0c\u964d\u4f4e\u4e86\u67e5\u8be2\u3002</p> <p>\uff082\uff09\u5982\u679c\u5206\u533a\u592a\u591a\uff0c\u5219\u6bcf\u4e2a\u5206\u533a\u7684\u6570\u636e\u91cf\u5927\u5c0f\u53ef\u80fd\u5f88\u5c0f\uff0c\u8bfb\u53d6\u5927\u91cf\u5c0f\u7684\u7f51\u7edc\u6570\u636e\u5757\uff0c\u8fd9\u4e5f\u4f1a\u5bfc\u81f4 I/O \u6548\u7387\u4f4e\u800c\u964d\u4f4e\u4e86\u67e5\u8be2\u901f\u5ea6\u3002\u62e5\u6709\u5927\u91cf\u7684 task\uff08\u4e00\u4e2a\u5206\u533a\u4e00\u4e2a task \uff09\u4e5f\u4f1a\u7ed9 Spark \u4efb\u52a1\u8ba1\u5212\u7a0b\u5e8f\u5e26\u6765\u66f4\u591a\u8d1f\u62c5\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4efb\u52a1\u5f00\u59cb\u65f6\u5148\u8bbe\u7f6e\u8f83\u591a\u7684 shuffle \u5206\u533a\u4e2a\u6570\uff0c\u7136\u540e\u5728\u8fd0\u884c\u65f6\u901a\u8fc7\u67e5\u770b shuffle \u6587\u4ef6\u7edf\u8ba1\u4fe1\u606f\u5c06\u76f8\u90bb\u7684\u5c0f\u5206\u533a\u5408\u5e76\u6210\u66f4\u5927\u7684\u5206\u533a\u3002</p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u6b63\u5728\u8fd0\u884c <code>select max(i) from tbl group by j</code>\u3002\u8f93\u5165 tbl \u5f88\u5c0f\uff0c\u5728\u5206\u7ec4\u524d\u53ea\u6709 2 \u4e2a\u5206\u533a\u3002\u90a3\u4e48\u4efb\u52a1\u521a\u521d\u59cb\u5316\u65f6\uff0c\u6211\u4eec\u5c06\u5206\u533a\u6570\u8bbe\u7f6e\u4e3a 5\uff0c\u5982\u679c\u6ca1\u6709 AQE\uff0cSpark \u5c06\u542f\u52a8\u4e94\u4e2a\u4efb\u52a1\u6765\u8fdb\u884c\u6700\u7ec8\u805a\u5408\uff0c\u4f46\u662f\u5176\u4e2d\u4f1a\u6709\u4e09\u4e2a\u975e\u5e38\u5c0f\u7684\u5206\u533a\uff0c\u4e3a\u6bcf\u4e2a\u5206\u533a\u542f\u52a8\u5355\u72ec\u7684\u4efb\u52a1\u8fd9\u6837\u5c31\u5f88\u6d6a\u8d39\u3002</p> <p></p> <p>\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\uff0cAQE \u5c06\u8fd9\u4e09\u4e2a\u5c0f\u5206\u533a\u5408\u5e76\u4e3a\u4e00\u4e2a\uff0c\u56e0\u6b64\u6700\u7ec8\u805a\u53ea\u9700\u4e09\u4e2a task \u800c\u4e0d\u662f\u4e94\u4e2a</p> <p></p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 2 --executor-memory 2g  --class com.atguigu.sparktuning.aqe.AQEPartitionTunning spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar </code></pre> <p>\u7ed3\u5408\u52a8\u6001\u7533\u8bf7\u8d44\u6e90\uff1a</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 2 --executor-memory 2g  --class com.atguigu.sparktuning.aqe.DynamicAllocationTunning spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar </code></pre>"},{"location":"engine/spark/spark_16/#1662-join","title":"16.6.2 \u52a8\u6001\u5207\u6362Join\u7b56\u7565","text":"<p>Spark \u652f\u6301\u591a\u79cd join \u7b56\u7565\uff0c\u5176\u4e2d\u5982\u679c join \u7684\u4e00\u5f20\u8868\u53ef\u4ee5\u5f88\u597d\u7684\u63d2\u5165\u5185\u5b58\uff0c\u90a3\u4e48 broadcast hash join \u901a\u5e38\u6027\u80fd\u6700\u9ad8\u3002\u56e0\u6b64\uff0cspark join \u4e2d\uff0c\u5982\u679c\u5c0f\u8868\u5c0f\u4e8e\u5e7f\u64ad\u5927\u5c0f\u9600\u503c\uff08\u9ed8\u8ba4 10mb\uff09\uff0cSpark \u5c06\u8ba1\u5212\u8fdb\u884c broadcast hash join\u3002\u4f46\u662f\uff0c\u5f88\u591a\u4e8b\u60c5\u90fd\u4f1a\u4f7f\u8fd9\u79cd\u5927\u5c0f\u4f30\u8ba1\u51fa\u9519\uff08\u4f8b\u5982\uff0c\u5b58\u5728\u9009\u62e9\u6027\u5f88\u9ad8\u7684\u8fc7\u6ee4\u5668\uff09\uff0c\u6216\u8005 join \u5173\u7cfb\u662f\u4e00\u7cfb\u5217\u7684\u8fd0\u7b97\u7b26\u800c\u4e0d\u662f\u7b80\u5355\u7684\u626b\u63cf\u8868\u64cd\u4f5c\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u6b64\u95ee\u9898\uff0cAQE \u73b0\u5728\u6839\u636e\u6700\u51c6\u786e\u7684 join \u5927\u5c0f\u8fd0\u884c\u65f6\u91cd\u65b0\u8ba1\u5212 join \u7b56\u7565\u3002\u4ece\u4e0b\u56fe\u5b9e\u4f8b\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u53d1\u73b0\u8fde\u63a5\u7684\u53f3\u4fa7\u8868\u6bd4\u5de6\u4fa7\u8868\u5c0f\u7684\u591a\uff0c\u5e76\u4e14\u8db3\u591f\u5c0f\u53ef\u4ee5\u8fdb\u884c\u5e7f\u64ad\uff0c\u90a3\u4e48 AQE \u4f1a\u91cd\u65b0\u4f18\u5316\uff0c\u5c06 sort merge join \u8f6c\u6362\u6210\u4e3a broadcast hash join\u3002</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 4 --executor-memory 2g  --class com.atguigu.sparktuning.aqe.AqeDynamicSwitchJoin spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar </code></pre>"},{"location":"engine/spark/spark_16/#1663-join","title":"16.6.3 \u52a8\u6001\u4f18\u5316Join\u503e\u659c","text":"<p>\u5f53\u6570\u636e\u5728\u7fa4\u96c6\u4e2d\u7684\u5206\u533a\u4e4b\u95f4\u5206\u5e03\u4e0d\u5747\u5300\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u6570\u636e\u503e\u659c\u3002\u4e25\u91cd\u7684\u503e\u659c\u4f1a\u5927\u5927\u964d\u4f4e\u67e5\u8be2\u6027\u80fd\uff0c\u5c24\u5176\u5bf9\u4e8e join\u3002AQE skew join \u4f18\u5316\u4f1a\u4ece\u968f\u673a shuffle \u6587\u4ef6\u7edf\u8ba1\u4fe1\u606f\u81ea\u52a8\u68c0\u6d4b\u5230\u8fd9\u79cd\u503e\u659c\u3002\u7136\u540e\u5b83\u5c06\u503e\u659c\u5206\u533a\u62c6\u5206\u6210\u8f83\u5c0f\u7684\u5b50\u5206\u533a\u3002</p> <p>\u4f8b\u5982\uff0c\u4e0b\u56fe A join B,A \u8868\u4e2d\u5206\u533a A0 \u660e\u7ec6\u5927\u4e8e\u5176\u4ed6\u5206\u533a\u3002</p> <p></p> <p>\u56e0\u6b64\uff0cskew join \u4f1a\u5c06 A0 \u5206\u533a\u62c6\u5206\u6210\u4e24\u4e2a\u5b50\u5206\u533a\uff0c\u5e76\u4e14\u5bf9\u5e94\u8fde\u63a5 B0 \u5206\u533a\u3002</p> <p></p> <p>\u6ca1\u6709\u8fd9\u79cd\u4f18\u5316\uff0c\u4f1a\u5bfc\u81f4\u5176\u4e2d\u4e00\u4e2a\u5206\u533a\u7279\u522b\u8017\u65f6\u62d6\u6162\u6574\u4e2a stage,\u6709\u4e86\u8fd9\u4e2a\u4f18\u5316\u4e4b\u540e\u6bcf\u4e2a task \u8017\u65f6\u90fd\u4f1a\u5927\u81f4\u76f8\u540c\uff0c\u4ece\u800c\u603b\u4f53\u4e0a\u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd\u3002</p> <p>\uff081\uff09spark.sql.adaptive.skewJoin.enabled :\u662f\u5426\u5f00\u542f\u503e\u659c join \u68c0\u6d4b\uff0c\u5982\u679c\u5f00\u542f\u4e86\uff0c\u90a3\u4e48\u4f1a\u5c06\u503e\u659c\u7684\u5206\u533a\u6570\u636e\u62c6\u6210\u591a\u4e2a\u5206\u533a,\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u4f46\u662f\u5f97\u6253\u5f00 aqe</p> <p>\uff082\uff09spark.sql.adaptive.skewJoin.skewedPartitionFactor :\u9ed8\u8ba4\u503c 5\uff0c\u6b64\u53c2\u6570\u7528\u6765\u5224\u65ad\u5206\u533a\u6570\u636e\u91cf\u662f\u5426\u6570\u636e\u503e\u659c\uff0c\u5f53\u4efb\u52a1\u4e2d\u6700\u5927\u6570\u636e\u91cf\u5206\u533a\u5bf9\u5e94\u7684\u6570\u636e\u91cf\u5927\u4e8e\u7684\u5206\u533a\u4e2d\u4f4d\u6570\u4e58\u4ee5\u6b64\u53c2\u6570\uff0c\u5e76\u4e14\u4e5f\u5927\u4e8e <code>spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes</code> \u53c2\u6570\uff0c\u90a3\u4e48\u6b64\u4efb\u52a1\u662f\u6570\u636e\u503e\u659c</p> <p>\uff083\uff09spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes :\u9ed8\u8ba4\u503c 256mb\uff0c\u7528\u4e8e\u5224\u65ad\u662f\u5426\u6570\u636e\u503e\u659c</p> <p>\uff084\uff09spark.sql.adaptive.advisoryPartitionSizeInBytes :\u6b64\u53c2\u6570\u7528\u6765\u544a\u8bc9 spark \u8fdb\u884c\u62c6\u5206\u540e\u63a8\u8350\u5206\u533a\u5927\u5c0f\u662f\u591a\u5c11</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 4 --executor-memory 2g  --class com.atguigu.sparktuning.aqe.AqeOptimizingSkewJoin spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar </code></pre> <p>\u5982\u679c\u540c\u65f6\u5f00\u542f\u4e86 <code>spark.sql.adaptive.coalescePartitions.enabled</code> \u52a8\u6001\u5408\u5e76\u5206\u533a\u529f\u80fd\uff0c\u90a3\u4e48\u4f1a\u5148\u5408\u5e76\u5206\u533a\uff0c\u518d\u53bb\u5224\u65ad\u503e\u659c\uff0c\u5c06\u52a8\u6001\u5408\u5e76\u5206\u533a\u6253\u5f00\u540e\uff0c\u91cd\u65b0\u6267\u884c\uff1a</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 4 --executor-memory 2g  --class com.atguigu.sparktuning.aqe.AqeOptimizingSkewJoin spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar </code></pre> <p>\u4fee\u6539\u4e2d\u4f4d\u6570\u7684\u500d\u6570\u4e3a 2\uff0c\u91cd\u65b0\u6267\u884c\uff1a</p> <pre><code>spark-submit --master yarn --deploy-mode client --driver-memory 1g --num-executors 3 --executor-cores 4 --executor-memory 2g  --class com.atguigu.sparktuning.aqe.AqeOptimizingSkewJoin spark-tuning-1.0-SNAPSHOT-jar-with-dependencies.jar </code></pre>"},{"location":"engine/spark_streaming/ss_01/","title":"\u7b2c1\u7ae0 SparkStreaming\u6982\u8ff0","text":""},{"location":"engine/spark_streaming/ss_01/#11-spark-streaming","title":"1.1 Spark Streaming\u662f\u4ec0\u4e48","text":"<p>\u5b98\u65b9\u6587\u6863</p> <p></p>"},{"location":"engine/spark_streaming/ss_01/#12-spark-streaming","title":"1.2 Spark Streaming\u67b6\u6784\u539f\u7406","text":""},{"location":"engine/spark_streaming/ss_01/#121-dstream","title":"1.2.1 \u4ec0\u4e48\u662fDStream","text":""},{"location":"engine/spark_streaming/ss_01/#122","title":"1.2.2 \u67b6\u6784\u56fe","text":"\u6574\u4f53\u67b6\u6784\u56fe Spark Streaming\u67b6\u6784\u56fe"},{"location":"engine/spark_streaming/ss_01/#13-spark-streaming","title":"1.3 Spark Streaming\u7279\u70b9","text":"<ul> <li> \u6613\u7528</li> </ul> <ul> <li> \u5bb9\u9519</li> </ul> <ul> <li> \u6613\u6574\u5408\u5230Spark\u4f53\u7cfb</li> </ul>"},{"location":"engine/spark_streaming/ss_02/","title":"\u7b2c2\u7ae0 HelloWorld","text":""},{"location":"engine/spark_streaming/ss_02/#21","title":"2.1 \u7248\u672c\u9009\u578b","text":"<p>\u6ce8\u610f</p> <p>\u76ee\u524d spark 3.0.0 \u4ee5\u4e0a\u7248\u672c\u53ea\u6709 Direct \u6a21\u5f0f\u3002</p>"},{"location":"engine/spark_streaming/ss_02/#22-helloworld","title":"2.2 HelloWorld\u5b9e\u73b0","text":"<p>\u9700\u6c42\uff1a\u901a\u8fc7 SparkStreaming \u8bfb\u53d6 Kafka \u67d0\u4e2a\u4e3b\u9898\u7684\u6570\u636e\u5e76\u6253\u5370\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u3002    </p> <p>:link-material:\u5b98\u65b9\u6587\u6863</p> <p>1\uff09\u6dfb\u52a0\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-streaming_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.3.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-core_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.3.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n&lt;artifactId&gt;spark-streaming-kafka-0-10_2.12&lt;/artifactId&gt;\n&lt;version&gt;3.3.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>2\uff09\u7f16\u5199\u4ee3\u7801</p> <pre><code>package com.atguigu;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.spark.api.java.function.Function;\nimport org.apache.spark.streaming.Duration;\nimport org.apache.spark.streaming.api.java.JavaInputDStream;\nimport org.apache.spark.streaming.api.java.JavaStreamingContext;\nimport org.apache.spark.streaming.kafka010.ConsumerStrategies;\nimport org.apache.spark.streaming.kafka010.KafkaUtils;\nimport org.apache.spark.streaming.kafka010.LocationStrategies;\n\nimport java.util.ArrayList;\nimport java.util.HashMap;\n\n\npublic class Test01_HelloWorld {\npublic static void main(String[] args) throws InterruptedException {\n// \u521b\u5efa\u6d41\u73af\u5883\nJavaStreamingContext javaStreamingContext = new JavaStreamingContext(\"local[*]\", \"HelloWorld\", Duration.apply(3000));\n\n// \u521b\u5efa\u914d\u7f6e\u53c2\u6570\nHashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();\nmap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092,hadoop103:9092,hadoop104:9092\");\nmap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.GROUP_ID_CONFIG,\"atguigu\");\nmap.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG,\"latest\");\n\n// \u9700\u8981\u6d88\u8d39\u7684\u4e3b\u9898\nArrayList&lt;String&gt; strings = new ArrayList&lt;&gt;();\nstrings.add(\"topic_db\");\n\nJavaInputDStream&lt;ConsumerRecord&lt;String, String&gt;&gt; directStream = KafkaUtils.createDirectStream(javaStreamingContext, LocationStrategies.PreferBrokers(), ConsumerStrategies.&lt;String, String&gt;Subscribe(strings,map));\n\ndirectStream.map(new Function&lt;ConsumerRecord&lt;String, String&gt;, String&gt;() {\n@Override\npublic String call(ConsumerRecord&lt;String, String&gt; v1) throws Exception {\nreturn v1.value();\n}\n}).print(100);\n\n// \u6267\u884c\u6d41\u7684\u4efb\u52a1\njavaStreamingContext.start();\njavaStreamingContext.awaitTermination();\n}\n}\n</code></pre> <p>3\uff09\u66f4\u6539\u65e5\u5fd7\u6253\u5370\u7ea7\u522b</p> <p>\u200b   \u5982\u679c\u4e0d\u5e0c\u671b\u8fd0\u884c\u65f6\u6253\u5370\u5927\u91cf\u65e5\u5fd7\uff0c\u53ef\u4ee5\u5728 resources \u6587\u4ef6\u5939\u4e2d\u6dfb\u52a0 log4j2.properties \u6587\u4ef6\uff0c\u5e76\u6dfb\u52a0\u65e5\u5fd7\u914d\u7f6e\u4fe1\u606f</p> log4j.properties<pre><code># Set everything to be logged to the console\nrootLogger.level = ERROR\nrootLogger.appenderRef.stdout.ref = console\n\n# In the pattern layout configuration below, we specify an explicit `%ex` conversion \n# pattern for logging Throwables. If this was omitted, then (by default) Log4J would \n# implicitly add an `%xEx` conversion pattern which logs stacktraces with additional \n# class packaging information. That extra information can sometimes add a substantial \n# performance overhead, so we disable it in our default logging config. \n# For more information, see SPARK-39361. \nappender.console.type = Console\nappender.console.name = console\nappender.console.target = SYSTEM_ERR\nappender.console.layout.type = PatternLayout\nappender.console.layout.pattern = %d{yy/MM/dd HH:mm:ss} %p %c{1}: %m%n%ex\n\n# Set the default spark-shell/spark-sql log level to WARN. When running the \n# spark-shell/spark-sql, the log level for these classes is used to overwrite \n# the root logger's log level, so that the user can have different defaults \n# for the shell and regular Spark apps. \nlogger.repl.name = org.apache.spark.repl.Main\nlogger.repl.level = warn\nlogger.thriftserver.name = org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver\nlogger.thriftserver.level = warn\n\n# Settings to quiet third party logs that are too verbose \nlogger.jetty1.name = org.sparkproject.jetty\nlogger.jetty1.level = warn\nlogger.jetty2.name = org.sparkproject.jetty.util.component.AbstractLifeCycle\nlogger.jetty2.level = error\nlogger.replexprTyper.name = org.apache.spark.repl.SparkIMain$exprTyper\nlogger.replexprTyper.level = info\nlogger.replSparkILoopInterpreter.name = org.apache.spark.repl.SparkILoop$SparkILoopInterpreter\nlogger.replSparkILoopInterpreter.level = info\nlogger.parquet1.name = org.apache.parquet\nlogger.parquet1.level = error\nlogger.parquet2.name = parquet\nlogger.parquet2.level = error\n\n# SPARK-9183: Settings to avoid annoying messages when looking up nonexistent UDFs in SparkSQL with Hive support \nlogger.RetryingHMSHandler.name = org.apache.hadoop.hive.metastore.RetryingHMSHandler\nlogger.RetryingHMSHandler.level = fatal\nlogger.FunctionRegistry.name = org.apache.hadoop.hive.ql.exec.FunctionRegistry\nlogger.FunctionRegistry.level = error\n\n# For deploying Spark ThriftServer \n# SPARK-34128: Suppress undesirable TTransportException warnings involved in THRIFT-4805 \nappender.console.filter.1.type = RegexFilter\nappender.console.filter.1.regex = .*Thrift error occurred during processing of message.*\nappender.console.filter.1.onMatch = deny appender.console.filter.1.onMismatch = neutral\n</code></pre> <p>4\uff09\u542f\u52a8\u751f\u4ea7\u8005\u751f\u4ea7\u6570\u636e</p> <pre><code>kafka-console-producer.sh --broker-list hadoop102:9092 --topic topicA\n</code></pre> <p>5\uff09\u5728 IDEA \u63a7\u5236\u53f0\u8f93\u51fa\u5982\u4e0b\u5185\u5bb9</p> <pre><code>-------------------------------------------\nTime: 1602731772000 ms\n-------------------------------------------\nhello spark\n</code></pre>"},{"location":"engine/spark_streaming/ss_02/#23-helloworld","title":"2.3 HelloWorld\u89e3\u6790","text":"<p>DStream \u662f Spark Streaming \u7684\u57fa\u7840\u62bd\u8c61\uff0c\u4ee3\u8868\u6301\u7eed\u6027\u7684\u6570\u636e\u6d41\u548c\u7ecf\u8fc7\u5404\u79cd Spark \u7b97\u5b50\u64cd\u4f5c\u540e\u7684\u7ed3\u679c\u6570\u636e\u6d41\u3002</p> <p>\u5728\u5185\u90e8\u5b9e\u73b0\u4e0a\uff0c\u6bcf\u4e00\u6279\u6b21\u7684\u6570\u636e\u5c01\u88c5\u6210\u4e00\u4e2a RDD\uff0c\u4e00\u7cfb\u5217\u8fde\u7eed\u7684 RDD \u7ec4\u6210\u4e86 DStream\u3002\u5bf9\u8fd9\u4e9b RDD \u7684\u8f6c\u6362\u662f\u7531 Spark \u5f15\u64ce\u6765\u8ba1\u7b97\u3002</p> <p>\u8bf4\u660e</p> <p>DStream \u4e2d\u6279\u6b21\u4e0e\u6279\u6b21\u4e4b\u95f4\u8ba1\u7b97\u76f8\u4e92\u72ec\u7acb\u3002\u5982\u679c\u6279\u6b21\u8bbe\u7f6e\u65f6\u95f4\u5c0f\u4e8e\u8ba1\u7b97\u65f6\u95f4\u4f1a\u51fa\u73b0\u8ba1\u7b97\u4efb\u52a1\u53e0\u52a0\u60c5\u51b5\uff0c\u9700\u8981\u591a\u5206\u914d\u8d44\u6e90\u3002\u901a\u5e38\u60c5\u51b5\uff0c\u6279\u6b21\u8bbe\u7f6e\u65f6\u95f4\u8981\u5927\u4e8e\u8ba1\u7b97\u65f6\u95f4\u3002</p> <p></p>"},{"location":"engine/spark_streaming/ss_03/","title":"\u7b2c3\u7ae0 DStream\u8f6c\u6362","text":"<p>DStream \u4e0a\u7684\u64cd\u4f5c\u4e0e RDD \u7684\u7c7b\u4f3c\uff0c\u5206\u4e3a\u8f6c\u6362\u548c\u8f93\u51fa\u4e24\u79cd\uff0c\u6b64\u5916\u8f6c\u6362\u64cd\u4f5c\u4e2d\u8fd8\u6709\u4e00\u4e9b\u6bd4\u8f83\u7279\u6b8a\u7684\u539f\u8bed\uff0c\u5982\uff1atransform() \u4ee5\u53ca\u5404\u79cd Window \u76f8\u5173\u7684\u539f\u8bed\u3002</p>"},{"location":"engine/spark_streaming/ss_03/#31","title":"3.1 \u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c","text":"<p>\u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c\uff1a\u5c31\u662f\u628a RDD \u8f6c\u5316\u64cd\u4f5c\u5e94\u7528\u5230 DStream \u6bcf\u4e2a\u6279\u6b21\u4e0a\uff0c\u6bcf\u4e2a\u6279\u6b21\u76f8\u4e92\u72ec\u7acb\uff0c\u81ea\u5df1\u7b97\u81ea\u5df1\u7684\u3002</p>"},{"location":"engine/spark_streaming/ss_03/#311","title":"3.1.1 \u5e38\u89c4\u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c","text":"<p>DStream \u7684\u90e8\u5206\u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c\u5217\u5728\u4e86\u4e0b\u8868\u4e2d\uff0c\u90fd\u662f DStream \u81ea\u5df1\u7684 API\u3002</p> <p>\u6ce8\u610f</p> <p>\u53ea\u6709 <code>JavaPairDStream&lt;Key, Value&gt;</code> \u624d\u80fd\u4f7f\u7528 <code>xxxByKey()</code> \u7c7b\u578b\u7684\u8f6c\u6362\u7b97\u5b50\u3002</p> \u51fd\u6570\u540d\u79f0 \u76ee\u7684 \u51fd\u6570\u7c7b\u578b map() \u5bf9 DStream \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u5e94\u7528\u7ed9\u5b9a\u51fd\u6570\uff0c\u8fd4\u56de\u7531\u5404\u5143\u7d20\u8f93\u51fa\u7684\u5143\u7d20\u7ec4\u6210\u7684 DStream\u3002 Function flatMap() \u5bf9 DStream \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u5e94\u7528\u7ed9\u5b9a\u51fd\u6570\uff0c\u8fd4\u56de\u7531\u5404\u5143\u7d20\u8f93\u51fa\u7684\u8fed\u4ee3\u5668\u7ec4\u6210\u7684 DStream\u3002 FlatMapFunction filter() \u8fd4\u56de\u7531\u7ed9\u5b9a DStream \u4e2d\u901a\u8fc7\u7b5b\u9009\u7684\u5143\u7d20\u7ec4\u6210\u7684 DStream Function mapToPair() \u6539\u53d8 DStream \u7684\u5206\u533a\u6570 PairFunction reduceByKey() \u5c06\u6bcf\u4e2a\u6279\u6b21\u4e2d\u952e\u76f8\u540c\u7684\u8bb0\u5f55\u89c4\u7ea6\u3002 Function2 groupByKey() \u5c06\u6bcf\u4e2a\u6279\u6b21\u4e2d\u7684\u8bb0\u5f55\u6839\u636e\u952e\u5206\u7ec4\u3002 ds.groupByKey() <p>\u9700\u8981\u8bb0\u4f4f\u7684\u662f\uff0c\u5c3d\u7ba1\u8fd9\u4e9b\u51fd\u6570\u770b\u8d77\u6765\u50cf\u4f5c\u7528\u5728\u6574\u4e2a\u6d41\u4e0a\u4e00\u6837\uff0c\u4f46\u4e8b\u5b9e\u4e0a\u6bcf\u4e2a DStream \u5728\u5185\u90e8\u662f\u7531\u8bb8\u591a RDD \u6279\u6b21\u7ec4\u6210\uff0c\u4e14\u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c\u662f\u5206\u522b\u5e94\u7528\u5230\u6bcf\u4e2a RDD (\u4e00\u4e2a\u6279\u6b21\u7684\u6570\u636e)\u4e0a\u7684\u3002</p>"},{"location":"engine/spark_streaming/ss_03/#32","title":"3.2 \u7a97\u53e3\u64cd\u4f5c","text":""},{"location":"engine/spark_streaming/ss_03/#321-windowoperations","title":"3.2.1 WindowOperations","text":"<p>Window Operations \u53ef\u4ee5\u8bbe\u7f6e\u7a97\u53e3\u7684\u5927\u5c0f\u548c\u6ed1\u52a8\u7a97\u53e3\u7684\u95f4\u9694\u6765\u52a8\u6001\u7684\u83b7\u53d6\u5f53\u524d Streaming \u7684\u5141\u8bb8\u72b6\u6001\u3002\u6240\u6709\u57fa\u4e8e\u7a97\u53e3\u7684\u64cd\u4f5c\u90fd\u9700\u8981\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u4e3a\u7a97\u53e3\u65f6\u957f\u4ee5\u53ca\u6ed1\u52a8\u6b65\u957f\u3002</p> <ul> <li>\u7a97\u53e3\u65f6\u957f\uff1a\u8ba1\u7b97\u5185\u5bb9\u7684\u65f6\u95f4\u8303\u56f4</li> <li>\u6ed1\u52a8\u6b65\u957f\uff1a\u9694\u591a\u4e45\u89e6\u53d1\u4e00\u6b21\u8ba1\u7b97</li> </ul> <p>\u6ce8\u610f</p> <p>\u8fd9\u4e24\u8005\u90fd\u5fc5\u987b\u4e3a\u91c7\u96c6\u6279\u6b21\u5927\u5c0f\u7684\u6574\u6570\u500d\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a WordCount \u6848\u4f8b\uff1a\u7a97\u53e3\u5927\u5c0f\u4e3a\u6279\u6b21\u7684 2 \u500d\uff0c\u6ed1\u52a8\u6b65\u7b49\u4e8e\u6279\u6b21\u5927\u5c0f\u3002</p> <p></p>"},{"location":"engine/spark_streaming/ss_03/#322-window","title":"3.2.2 Window","text":"<p>1\uff09\u57fa\u672c\u8bed\u6cd5\uff1a</p> <p><code>window(windowLength, slideInterval)</code> \u57fa\u4e8e\u5bf9\u6e90 DStream \u7a97\u53e3\u7684\u6279\u6b21\u8fdb\u884c\u8ba1\u7b97\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 DStream\u3002</p> <p>2\uff09\u9700\u6c42\uff1a</p> <p>\u7edf\u8ba1 WordCount\uff1a3 \u79d2\u4e00\u4e2a\u6279\u6b21\uff0c\u7a97\u53e3 12 \u79d2\uff0c\u6ed1\u6b65 6 \u79d2\u3002</p> <p>3\uff09\u4ee3\u7801\u7f16\u5199\uff1a</p> <pre><code>package com.atguigu;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport org.apache.spark.streaming.Duration;\nimport org.apache.spark.streaming.api.java.JavaDStream;\nimport org.apache.spark.streaming.api.java.JavaInputDStream;\nimport org.apache.spark.streaming.api.java.JavaPairDStream;\nimport org.apache.spark.streaming.api.java.JavaStreamingContext;\nimport org.apache.spark.streaming.kafka010.ConsumerStrategies;\nimport org.apache.spark.streaming.kafka010.KafkaUtils;\nimport org.apache.spark.streaming.kafka010.LocationStrategies;\nimport scala.Tuple2;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.Iterator;\n\npublic class Test02_Window {\npublic static void main(String[] args) throws InterruptedException {\n// \u521b\u5efa\u6d41\u73af\u5883\nJavaStreamingContext javaStreamingContext = new JavaStreamingContext(\"local[*]\", \"window\", Duration.apply(3000));\n// \u521b\u5efa\u914d\u7f6e\u53c2\u6570\nHashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();\nmap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092,hadoop103:9092,hadoop104:9092\");\nmap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.GROUP_ID_CONFIG,\"atguigu\");\nmap.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG,\"latest\");\n\n// \u9700\u8981\u6d88\u8d39\u7684\u4e3b\u9898\nArrayList&lt;String&gt; strings = new ArrayList&lt;&gt;();\nstrings.add(\"topicA\");\n\nJavaInputDStream&lt;ConsumerRecord&lt;String, String&gt;&gt; directStream = KafkaUtils.createDirectStream(javaStreamingContext, LocationStrategies.PreferBrokers(), ConsumerStrategies.&lt;String, String&gt;Subscribe(strings,map));\n\nJavaDStream&lt;String&gt; stringJavaDStream = directStream.flatMap(new FlatMapFunction&lt;ConsumerRecord&lt;String, String&gt;, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(ConsumerRecord&lt;String, String&gt; stringStringConsumerRecord) throws Exception {\nString[] split = stringStringConsumerRecord.value().split(\" \");\nreturn Arrays.asList(split).iterator();\n}\n});\n\nJavaPairDStream&lt;String, Integer&gt; javaPairDStream = stringJavaDStream.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\nJavaPairDStream&lt;String, Integer&gt; window = javaPairDStream.window(Duration.apply(12000), Duration.apply(6000));\nwindow.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1+v2;\n}\n}).print();\n\n// \u6267\u884c\u6d41\u7684\u4efb\u52a1\njavaStreamingContext.start();\njavaStreamingContext.awaitTermination();\n\n}\n}\n</code></pre> <p>4\uff09\u6d4b\u8bd5</p> <pre><code>kafka-console-producer.sh --broker-list hadoop102:9092 --topic topicA\n</code></pre> <p>5\uff09\u5982\u679c\u6709\u591a\u6279\u6570\u636e\u8fdb\u5165\u7a97\u53e3\uff0c\u6700\u7ec8\u4e5f\u4f1a\u901a\u8fc7 window \u64cd\u4f5c\u53d8\u6210\u7edf\u4e00\u7684 RDD \u5904\u7406\u3002</p> <p></p>"},{"location":"engine/spark_streaming/ss_03/#323-reducebykeyandwindow","title":"3.2.3 reduceByKeyAndWindow","text":"<p>1\uff09\u57fa\u672c\u8bed\u6cd5\uff1a</p> <p><code>reduceByKeyAndWindow(func, windowLength, slideInterval, [numTasks])</code>\uff1a\u5f53\u5728\u4e00\u4e2a ( K , V ) \u5bf9\u7684 DStream \u4e0a\u8c03\u7528\u6b64\u51fd\u6570\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0 ( K , V ) \u5bf9\u7684 DStream\uff0c\u6b64\u5904\u901a\u8fc7\u5bf9\u6ed1\u52a8\u7a97\u53e3\u4e2d\u6279\u6b21\u6570\u636e\u4f7f\u7528 reduce \u51fd\u6570\u6765\u6574\u5408\u6bcf\u4e2a key \u7684 value \u503c\u3002</p> <p>2\uff09\u9700\u6c42\uff1a</p> <p>\u7edf\u8ba1 WordCount\uff1a3 \u79d2\u4e00\u4e2a\u6279\u6b21\uff0c\u7a97\u53e3 12 \u79d2\uff0c\u6ed1\u6b65 6 \u79d2\u3002</p> <p>3\uff09\u4ee3\u7801\u7f16\u5199\uff1a</p> <pre><code>package com.atguigu;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport org.apache.spark.streaming.Duration;\nimport org.apache.spark.streaming.api.java.JavaDStream;\nimport org.apache.spark.streaming.api.java.JavaInputDStream;\nimport org.apache.spark.streaming.api.java.JavaPairDStream;\nimport org.apache.spark.streaming.api.java.JavaStreamingContext;\nimport org.apache.spark.streaming.kafka010.ConsumerStrategies;\nimport org.apache.spark.streaming.kafka010.KafkaUtils;\nimport org.apache.spark.streaming.kafka010.LocationStrategies;\nimport scala.Tuple2;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.Iterator;\n\npublic class Test03_ReduceByKeyAndWindow {\npublic static void main(String[] args) throws InterruptedException {\n// \u521b\u5efa\u6d41\u73af\u5883\nJavaStreamingContext javaStreamingContext = new JavaStreamingContext(\"local[*]\", \"window\", Duration.apply(3000L));\n// \u521b\u5efa\u914d\u7f6e\u53c2\u6570\nHashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();\nmap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092,hadoop103:9092,hadoop104:9092\");\nmap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.GROUP_ID_CONFIG,\"atguigu\");\nmap.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG,\"latest\");\n\n// \u9700\u8981\u6d88\u8d39\u7684\u4e3b\u9898\nArrayList&lt;String&gt; strings = new ArrayList&lt;&gt;();\nstrings.add(\"topicA\");\n\nJavaInputDStream&lt;ConsumerRecord&lt;String, String&gt;&gt; directStream = KafkaUtils.createDirectStream(javaStreamingContext, LocationStrategies.PreferBrokers(), ConsumerStrategies.&lt;String, String&gt;Subscribe(strings,map));\n\nJavaDStream&lt;String&gt; stringJavaDStream = directStream.flatMap(new FlatMapFunction&lt;ConsumerRecord&lt;String, String&gt;, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(ConsumerRecord&lt;String, String&gt; stringStringConsumerRecord) throws Exception {\nString[] split = stringStringConsumerRecord.value().split(\" \");\nreturn Arrays.asList(split).iterator();\n}\n});\n\nJavaPairDStream&lt;String, Integer&gt; javaPairDStream = stringJavaDStream.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\njavaPairDStream.reduceByKeyAndWindow(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n},Duration.apply(12000L),Duration.apply(6000L)).print();\n\n// \u6267\u884c\u6d41\u7684\u4efb\u52a1\njavaStreamingContext.start();\njavaStreamingContext.awaitTermination();\n\n}\n}\n</code></pre> <p>2\uff09\u6d4b\u8bd5</p> <pre><code>kafka-console-producer.sh --broker-list hadoop102:9092 --topic topicA\n</code></pre>"},{"location":"engine/spark_streaming/ss_04/","title":"\u7b2c4\u7ae0 DStream\u8f93\u51fa","text":"<p>DStream \u901a\u5e38\u5c06\u6570\u636e\u8f93\u51fa\u5230\uff0c\u5916\u90e8\u6570\u636e\u5e93\u6216\u5c4f\u5e55\u4e0a\u3002</p> <p>DStream \u4e0e RDD \u4e2d\u7684\u60f0\u6027\u6c42\u503c\u7c7b\u4f3c\uff0c\u5982\u679c\u4e00\u4e2a DStream \u53ca\u5176\u6d3e\u751f\u51fa\u7684 DStream \u90fd\u6ca1\u6709\u88ab\u6267\u884c\u8f93\u51fa\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e9b DStream \u5c31\u90fd\u4e0d\u4f1a\u88ab\u6c42\u503c\u3002\u5982\u679c StreamingContext \u4e2d\u6ca1\u6709\u8bbe\u5b9a\u8f93\u51fa\u64cd\u4f5c\uff0c\u6574\u4e2a Context \u5c31\u90fd\u4e0d\u4f1a\u542f\u52a8\u3002</p> <p>1\uff09\u8f93\u51fa\u64cd\u4f5c API \u5982\u4e0b\uff1a</p> <ul> <li><code>saveAsTextFiles(prefix, [suffix])</code>\uff1a\u4ee5 text \u6587\u4ef6\u5f62\u5f0f\u5b58\u50a8\u8fd9\u4e2a DStream \u7684\u5185\u5bb9\u3002\u6bcf\u4e00\u6279\u6b21\u7684\u5b58\u50a8\u6587\u4ef6\u540d\u57fa\u4e8e\u53c2\u6570\u4e2d\u7684 prefix \u548c suffix\u3002<code>prefix-Time_IN_MS[.suffix]</code>\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>\u4ee5\u4e0a\u64cd\u4f5c\u90fd\u662f\u6bcf\u4e00\u6279\u6b21\u5199\u51fa\u4e00\u6b21\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u5c0f\u6587\u4ef6\uff0c\u5728\u751f\u4ea7\u73af\u5883\uff0c\u5f88\u5c11\u4f7f\u7528\u3002</p> <ul> <li>print()\uff1a\u5728\u8fd0\u884c\u6d41\u7a0b\u5e8f\u7684\u9a71\u52a8\u7ed3\u70b9\u4e0a\u6253\u5370 DStream \u4e2d\u6bcf\u4e00\u6279\u6b21\u6570\u636e\u7684\u6700\u5f00\u59cb 10 \u4e2a\u5143\u7d20\u3002\u8fd9\u7528\u4e8e\u5f00\u53d1\u548c\u8c03\u8bd5\u3002</li> <li>foreachRDD(func)\uff1a\u8fd9\u662f\u6700\u901a\u7528\u7684\u8f93\u51fa\u64cd\u4f5c\uff0c\u5373\u5c06\u51fd\u6570 func \u7528\u4e8e\u4ea7\u751f DStream \u7684\u6bcf\u4e00\u4e2a RDD\u3002\u5176\u4e2d\u53c2\u6570\u4f20\u5165\u7684\u51fd\u6570 func \u5e94\u8be5\u5b9e\u73b0\u5c06\u6bcf\u4e00\u4e2a RDD \u4e2d\u6570\u636e\u63a8\u9001\u5230\u5916\u90e8\u7cfb\u7edf\uff0c\u5982\u5c06 RDD \u5b58\u5165\u6587\u4ef6\u6216\u8005\u5199\u5165\u6570\u636e\u5e93\u3002</li> </ul> <p>\u5728\u4f01\u4e1a\u5f00\u53d1\u4e2d\u901a\u5e38\u91c7\u7528 foreachRDD()\uff0c\u5b83\u7528\u6765\u5bf9 DStream \u4e2d\u7684 RDD \u8fdb\u884c\u4efb\u610f\u8ba1\u7b97\u3002\u8fd9\u548c transform() \u6709\u4e9b\u7c7b\u4f3c\uff0c\u90fd\u53ef\u4ee5\u8ba9\u6211\u4eec\u8bbf\u95ee\u4efb\u610f RDD\u3002\u5728 foreachRDD() \u4e2d\uff0c\u53ef\u4ee5\u91cd\u7528\u6211\u4eec\u5728 Spark \u4e2d\u5b9e\u73b0\u7684\u6240\u6709\u884c\u52a8\u64cd\u4f5c( action \u7b97\u5b50)\u3002\u6bd4\u5982\uff0c\u5e38\u89c1\u7684\u7528\u4f8b\u4e4b\u4e00\u662f\u628a\u6570\u636e\u5199\u5230\u5982 MySQL \u7684\u5916\u90e8\u6570\u636e\u5e93\u4e2d\u3002</p> <pre><code>package com.atguigu;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.spark.api.java.JavaPairRDD;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport org.apache.spark.api.java.function.VoidFunction;\nimport org.apache.spark.streaming.Duration;\nimport org.apache.spark.streaming.api.java.JavaDStream;\nimport org.apache.spark.streaming.api.java.JavaInputDStream;\nimport org.apache.spark.streaming.api.java.JavaPairDStream;\nimport org.apache.spark.streaming.api.java.JavaStreamingContext;\nimport org.apache.spark.streaming.kafka010.ConsumerStrategies;\nimport org.apache.spark.streaming.kafka010.KafkaUtils;\nimport org.apache.spark.streaming.kafka010.LocationStrategies;\nimport scala.Tuple2;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.Iterator;\n\n/**\n * @author yhm\n * @create 2022-09-01 16:47\n */\npublic class Test04_Save {\npublic static void main(String[] args) throws InterruptedException {\n// \u521b\u5efa\u6d41\u73af\u5883\nJavaStreamingContext javaStreamingContext = new JavaStreamingContext(\"local[*]\", \"window\", Duration.apply(3000L));\n// \u521b\u5efa\u914d\u7f6e\u53c2\u6570\nHashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();\nmap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092,hadoop103:9092,hadoop104:9092\");\nmap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.GROUP_ID_CONFIG,\"atguigu\");\nmap.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG,\"latest\");\n\n// \u9700\u8981\u6d88\u8d39\u7684\u4e3b\u9898\nArrayList&lt;String&gt; strings = new ArrayList&lt;&gt;();\nstrings.add(\"topicA\");\n\nJavaInputDStream&lt;ConsumerRecord&lt;String, String&gt;&gt; directStream = KafkaUtils.createDirectStream(javaStreamingContext, LocationStrategies.PreferBrokers(), ConsumerStrategies.&lt;String, String&gt;Subscribe(strings,map));\n\nJavaDStream&lt;String&gt; stringJavaDStream = directStream.flatMap(new FlatMapFunction&lt;ConsumerRecord&lt;String, String&gt;, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(ConsumerRecord&lt;String, String&gt; stringStringConsumerRecord) throws Exception {\nString[] split = stringStringConsumerRecord.value().split(\" \");\nreturn Arrays.asList(split).iterator();\n}\n});\n\nJavaPairDStream&lt;String, Integer&gt; javaPairDStream = stringJavaDStream.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\nJavaPairDStream&lt;String, Integer&gt; resultDStream = javaPairDStream.reduceByKeyAndWindow(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n}, Duration.apply(12000L), Duration.apply(6000L));\n\nresultDStream.foreachRDD(new VoidFunction&lt;JavaPairRDD&lt;String, Integer&gt;&gt;() {\n@Override\npublic void call(JavaPairRDD&lt;String, Integer&gt; stringIntegerJavaPairRDD) throws Exception {\n// \u83b7\u53d6mysql\u8fde\u63a5\n// \u5199\u5165\u5230mysql\u4e2d\n// \u5173\u95ed\u8fde\u63a5\n}\n});\n\n// \u6267\u884c\u6d41\u7684\u4efb\u52a1\njavaStreamingContext.start();\njavaStreamingContext.awaitTermination();\n\n}\n}\n</code></pre>"},{"location":"engine/spark_streaming/ss_05/","title":"\u7b2c5\u7ae0 \u4f18\u96c5\u5173\u95ed","text":"<p>\u6d41\u5f0f\u4efb\u52a1\u9700\u8981 7 * 24 \u5c0f\u65f6\u6267\u884c\uff0c\u4f46\u662f\u6709\u65f6\u6d89\u53ca\u5230\u5347\u7ea7\u4ee3\u7801\u9700\u8981\u4e3b\u52a8\u505c\u6b62\u7a0b\u5e8f\uff0c\u4f46\u662f\u5206\u5e03\u5f0f\u7a0b\u5e8f\uff0c\u6ca1\u529e\u6cd5\u505a\u5230\u4e00\u4e2a\u4e2a\u8fdb\u7a0b\u53bb\u6740\u6b7b\uff0c\u6240\u4ee5\u914d\u7f6e\u4f18\u96c5\u7684\u5173\u95ed\u5c31\u663e\u5f97\u81f3\u5173\u91cd\u8981\u4e86\u3002</p> <p>\u5173\u95ed\u65b9\u5f0f\uff1a\u4f7f\u7528\u5916\u90e8\u6587\u4ef6\u7cfb\u7edf\u6765\u63a7\u5236\u5185\u90e8\u7a0b\u5e8f\u5173\u95ed\u3002</p> <p>1\uff09\u4e3b\u7a0b\u5e8f</p> <pre><code>package com.atguigu;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.FileSystem;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.spark.api.java.function.FlatMapFunction;\nimport org.apache.spark.api.java.function.Function2;\nimport org.apache.spark.api.java.function.PairFunction;\nimport org.apache.spark.streaming.Duration;\nimport org.apache.spark.streaming.StreamingContextState;\nimport org.apache.spark.streaming.api.java.JavaDStream;\nimport org.apache.spark.streaming.api.java.JavaInputDStream;\nimport org.apache.spark.streaming.api.java.JavaPairDStream;\nimport org.apache.spark.streaming.api.java.JavaStreamingContext;\nimport org.apache.spark.streaming.kafka010.ConsumerStrategies;\nimport org.apache.spark.streaming.kafka010.KafkaUtils;\nimport org.apache.spark.streaming.kafka010.LocationStrategies;\nimport scala.Tuple2;\n\nimport java.net.URI;\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.Iterator;\n\npublic class Test05_Close {\npublic static void main(String[] args) throws InterruptedException {\n// \u521b\u5efa\u6d41\u73af\u5883\nJavaStreamingContext javaStreamingContext = new JavaStreamingContext(\"local[*]\", \"window\", Duration.apply(3000L));\n// \u521b\u5efa\u914d\u7f6e\u53c2\u6570\nHashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();\nmap.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092,hadoop103:9092,hadoop104:9092\");\nmap.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nmap.put(ConsumerConfig.GROUP_ID_CONFIG,\"atguigu\");\nmap.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG,\"latest\");\n\n// \u9700\u8981\u6d88\u8d39\u7684\u4e3b\u9898\nArrayList&lt;String&gt; strings = new ArrayList&lt;&gt;();\nstrings.add(\"topicA\");\n\nJavaInputDStream&lt;ConsumerRecord&lt;String, String&gt;&gt; directStream = KafkaUtils.createDirectStream(javaStreamingContext, LocationStrategies.PreferBrokers(), ConsumerStrategies.&lt;String, String&gt;Subscribe(strings,map));\n\nJavaDStream&lt;String&gt; stringJavaDStream = directStream.flatMap(new FlatMapFunction&lt;ConsumerRecord&lt;String, String&gt;, String&gt;() {\n@Override\npublic Iterator&lt;String&gt; call(ConsumerRecord&lt;String, String&gt; stringStringConsumerRecord) throws Exception {\nString[] split = stringStringConsumerRecord.value().split(\" \");\nreturn Arrays.asList(split).iterator();\n}\n});\n\nJavaPairDStream&lt;String, Integer&gt; javaPairDStream = stringJavaDStream.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {\n@Override\npublic Tuple2&lt;String, Integer&gt; call(String s) throws Exception {\nreturn new Tuple2&lt;&gt;(s, 1);\n}\n});\n\njavaPairDStream.reduceByKeyAndWindow(new Function2&lt;Integer, Integer, Integer&gt;() {\n@Override\npublic Integer call(Integer v1, Integer v2) throws Exception {\nreturn v1 + v2;\n}\n},Duration.apply(12000L),Duration.apply(6000L)).print();\n\n// \u5f00\u542f\u76d1\u63a7\u7a0b\u5e8f\nnew Thread(new MonitorStop(javaStreamingContext)).start();\n\n// \u6267\u884c\u6d41\u7684\u4efb\u52a1\njavaStreamingContext.start();\njavaStreamingContext.awaitTermination();\n\n}\n\npublic static class MonitorStop implements Runnable {\n\nJavaStreamingContext javaStreamingContext = null;\n\npublic MonitorStop(JavaStreamingContext javaStreamingContext) {\nthis.javaStreamingContext = javaStreamingContext;\n}\n\n@Override\npublic void run() {\ntry {\nFileSystem fs = FileSystem.get(new URI(\"hdfs://hadoop102:8020\"), new Configuration(), \"atguigu\");\nwhile (true){\nThread.sleep(5000);\nboolean exists = fs.exists(new Path(\"hdfs://hadoop102:8020/stopSpark\"));\nif (exists){\nStreamingContextState state = javaStreamingContext.getState();\n// \u83b7\u53d6\u5f53\u524d\u4efb\u52a1\u662f\u5426\u6b63\u5728\u8fd0\u884c\nif (state == StreamingContextState.ACTIVE){\n// \u4f18\u96c5\u5173\u95ed\njavaStreamingContext.stop(true, true);\nSystem.exit(0);\n}\n}\n}\n}catch (Exception e){\ne.printStackTrace();\n}\n}\n}\n}\n</code></pre> <p>2\uff09\u6d4b\u8bd5</p> <p>\uff081\uff09\u53d1\u9001\u6570\u636e</p> <pre><code>kafka-console-producer.sh --broker-list hadoop102:9092 --topic topicA\n</code></pre> <p>\uff082\uff09\u542f\u52a8 Hadoop \u96c6\u7fa4</p> <pre><code>sbin/start-dfs.sh\nhadoop fs -mkdir /stopSpark\n</code></pre>"},{"location":"engine/tez/tez_01/","title":"\u7b2c1\u7ae0 Tez\u6982\u8ff0","text":""},{"location":"engine/tez/tez_01/#11-tez","title":"1.1 Tez\u7b80\u4ecb","text":"<p>Apache Tez \u662f Hadoop \u751f\u6001\u4e2d\u7684\u4e00\u4e2a\u9ad8\u6027\u80fd\u6279\u5904\u7406\u8ba1\u7b97\u6846\u67b6\u3002\u5176\u7a81\u51fa\u7279\u70b9\u662f\u4f7f\u7528 DAG\uff08\u6709\u5411\u65e0\u73af\u56fe\uff09\u6765\u63cf\u8ff0\u8ba1\u7b97\u4efb\u52a1\uff0c\u56e0\u6b64\u5728\u590d\u6742\u8ba1\u7b97\u7684\u573a\u666f\u4e0b\uff0cTez \u80fd\u63d0\u4f9b\u6bd4 Map Reduce \u66f4\u597d\u7684\u6027\u80fd\uff0c\u4e0b\u56fe\u662f Map Reduce \u548c Tez \u7f16\u7a0b\u6a21\u578b\u7684\u5bf9\u6bd4\u3002</p> <p></p>"},{"location":"engine/tez/tez_01/#12-tez","title":"1.2 Tez\u67b6\u6784","text":"<p>Tez \u57fa\u4e8e Hadoop Yarn \u8fdb\u884c\u6784\u5efa\uff0c\u5b83\u4f7f\u7528 Yarn \u7ba1\u7406\u96c6\u7fa4\u548c\u5206\u914d\u8d44\u6e90\u3002\u4e00\u4e2a Tez \u7684\u5206\u5e03\u5f0f\u8ba1\u7b97\u7a0b\u5e8f\u5305\u62ec\u4e00\u4e2a Tez Application Master \u548c\u82e5\u5e72\u4e2a Tez Task\u3002Tez Application Master \u8d1f\u8d23\u6574\u4e2a Tez \u8ba1\u7b97\u7a0b\u5e8f\u7684\u8c03\u5ea6\u6267\u884c\u4ee5\u53ca\u8ba1\u7b97\u8d44\u6e90\u7684\u7533\u8bf7\u4e0e\u5206\u914d\u3002Tez Task \u5219\u8d1f\u8d23\u6267\u884c\u5177\u4f53\u7684\u8ba1\u7b97\u903b\u8f91\u3002Tez Application Master \u548cTez Task \u5747\u8fd0\u884c\u5728 Yarn \u7684 Container \u4e2d\u3002</p> <p></p>"},{"location":"engine/tez/tez_01/#13-tez","title":"1.3 Tez\u672f\u8bed","text":"<p>1\uff09DAG\uff08Direct Acyclic Graph\uff09</p> <p>\u6709\u5411\u65e0\u73af\u56fe\uff0cTez \u4f7f\u7528\u6709\u5411\u65e0\u73af\u56fe\u63cf\u8ff0\u8ba1\u7b97\u4efb\u52a1\u3002</p> <p>2\uff09Vertex</p> <p>\u9876\u70b9\uff0c\u8868\u793a\u4e00\u4e2a\u6570\u636e\u7684\u8f6c\u6362\u903b\u8f91\u3002</p> <p>3\uff09Edge</p> <p>\u8fb9\uff0c\u8868\u793a\u4e24\u4e2a\u9876\u70b9\u4e4b\u95f4\u7684\u6570\u636e\u79fb\u52a8\u3002</p> <p></p>"},{"location":"engine/tez/tez_02/","title":"\u7b2c2\u7ae0 Hive on Tez\u90e8\u7f72","text":""},{"location":"engine/tez/tez_02/#21-hadoop","title":"2.1 Hadoop\u96c6\u7fa4\u914d\u7f6e","text":"<p>1\uff09\u4e0a\u4f20 tez \u4f9d\u8d56\u5230 HDFS</p> <pre><code>hadoop fs -mkdir /tez\nhadoop fs -put /opt/software/tez-0.10.1.tar.gz /tez\n</code></pre> <p>2\uff09\u65b0\u5efa tez-site.xml</p> <pre><code>vim $HADOOP_HOME/etc/hadoop/tez-site.xml\n</code></pre> tea-site.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n&lt;property&gt;\n&lt;name&gt;tez.lib.uris&lt;/name&gt;\n&lt;value&gt;${fs.defaultFS}/tez/tez-0.10.1.tar.gz&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.use.cluster.hadoop-libs&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.am.resource.memory.mb&lt;/name&gt;\n&lt;value&gt;1024&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.am.resource.cpu.vcores&lt;/name&gt;\n&lt;value&gt;1&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>3\uff09\u5206\u53d1 tez-site.xml \u6587\u4ef6</p> <pre><code>xsync tez-site.xml\n</code></pre>"},{"location":"engine/tez/tez_02/#22-hive","title":"2.2 \u5ba2\u6237\u7aef\u8282\u70b9\uff08Hive\u6240\u5728\u8282\u70b9\uff09\u914d\u7f6e","text":"<p>1\uff09\u5c06 tez \u6700\u5c0f\u7248\u5b89\u88c5\u5305\u62f7\u8d1d\u5230 hadoop102\uff0c\u5e76\u89e3\u538b tar \u5305</p> <pre><code>mkdir /opt/module/tez\ntar -zxvf /opt/software/tez-0.10.1-minimal.tar.gz -C /opt/module/tez\n</code></pre> <p>2\uff09\u5c06 tez \u589e\u52a0\u5230 Hadoop Classpath \u4e2d</p> <p>\u4fee\u6539 Hadoop \u73af\u5883\u53d8\u91cf\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim $HADOOP_HOME/etc/hadoop/shellprofile.d/tez.sh\n</code></pre> <p>\u6dfb\u52a0 Tez \u7684 Jar \u5305\u76f8\u5173\u4fe1\u606f</p> <pre><code>hadoop_add_profile tez\nfunction _tez_hadoop_classpath\n{\nhadoop_add_classpath \"$HADOOP_HOME/etc/hadoop\" after\nhadoop_add_classpath \"/opt/module/tez/*\" after\nhadoop_add_classpath \"/opt/module/tez/lib/*\" after\n}\n</code></pre> <p>3\uff09\u4fee\u6539 Hive \u7684\u8ba1\u7b97\u5f15\u64ce</p> <pre><code>vim $HIVE_HOME/conf/hive-site.xml\n</code></pre> hive-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;hive.execution.engine&lt;/name&gt;\n&lt;value&gt;tez&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;hive.tez.container.size&lt;/name&gt;\n&lt;value&gt;1024&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"engine/tez/tez_02/#23-hive-on-tez","title":"2.3 Hive on Tez\u6d4b\u8bd5","text":"<p>1\uff09\u542f\u52a8 hive \u5ba2\u6237\u7aef</p> <pre><code>bin/hive\n</code></pre> <p>2\uff09\u521b\u5efa\u4e00\u5f20\u6d4b\u8bd5\u8868</p> <pre><code>create table student(id int, name string);\n</code></pre> <p>3\uff09\u901a\u8fc7 insert \u6d4b\u8bd5\u6548\u679c</p> <pre><code>insert into table student values(1,'abc');\n</code></pre> <p>\u82e5\u7ed3\u679c\u5982\u4e0b\uff0c\u5219\u8bf4\u660e\u914d\u7f6e\u6210\u529f</p> <p></p>"},{"location":"engine/tez/tez_02/#24-tez-ui","title":"2.4 Tez UI\u90e8\u7f72","text":"<p>Tez UI \u63d0\u4f9b\u4e86\u4e00\u4e2a Web \u9875\u9762\u7528\u4e8e\u5c55\u793a Tez \u5e94\u7528\u7a0b\u5e8f\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f9b\u5f00\u53d1\u4eba\u5458\u8c03\u8bd5\u4f7f\u7528\u3002</p>"},{"location":"engine/tez/tez_02/#241-yarn-timeline-server","title":"2.4.1 \u90e8\u7f72Yarn Timeline Server","text":"<p>Yarn Timeline Server \u53ef\u7528\u4e8e\u6301\u4e45\u5316\u5b58\u50a8 Yarn \u4e2d\u8fd0\u884c\u7684\u7ed9\u79cd\u7c7b\u578b\u7684\u4efb\u52a1\uff08MR\u3001Spark\u3001Tez \u7b49\uff09\u4fe1\u606f\u3002\u5e76\u4e14\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684 REST API \u6765\u67e5\u8be2\u8fd9\u4e9b\u5e94\u7528\u7684\u4fe1\u606f\u3002</p> <p>Tez UI \u5c31\u662f\u57fa\u4e8e Yarn Timeline Server \u7684\u4e00\u4e2a\u7eaf\u524d\u7aef\u5e94\u7528\uff0c\u7528\u4e8e\u5c55\u793a Yarn Timeline Server \u4e2d\u4fdd\u5b58\u7684 Tez \u5e94\u7528\u4fe1\u606f\u3002</p> <p>1\uff09\u914d\u7f6e Yarn Timeline Server</p> <p>\uff081\uff09\u4fee\u6539 $HADOOP_HOME/etc/yarn-site.xml \u6587\u4ef6\uff0c\u5e76\u5206\u53d1</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;yarn.timeline-service.enabled&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.timeline-service.hostname&lt;/name&gt;\n&lt;value&gt;hadoop102&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.timeline-service.http-cross-origin.enabled&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.system-metrics-publisher.enabled&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09\u91cd\u542f Yarn \u96c6\u7fa4 \uff083\uff09\u542f\u52a8 Yarn Timeline Server</p> <pre><code>yarn --daemon start timelineserver\n</code></pre> <p>\uff084\uff09\u8bbf\u95ee Yarn Timeline Server \u7684 Web UI</p> <p>\u5730\u5740\u4e3a\uff1ahttp://hadoop102:8188 </p>"},{"location":"engine/tez/tez_02/#242-tez-ui","title":"2.4.2 \u90e8\u7f72Tez UI","text":"<p>1\uff09\u90e8\u7f72 Tomcat</p> <p>\u524d\u6587\u63d0\u5230\uff0cTez UI \u662f\u4e00\u4e2a\u7eaf\u524d\u7aef\u5e94\u7528\uff0c\u6545\u5c06\u5176\u90e8\u7f72\u5230\u4efb\u610f\u4e00\u4e2a Web \u5bb9\u5668\u5373\u53ef\u3002\u672c\u6587\u9009\u62e9\u4f7f\u7528 Tomcat\u3002</p> <p>\uff081\uff09\u89e3\u538b tomcat \u5b89\u88c5\u5305</p> <pre><code>tar -zxvf apache-tomcat-9.0.68.tar.gz -C /opt/module/\nmv /opt/module/apache-tomcat-9.0.68/ /opt/module/tomcat\n</code></pre> <p>\uff082\uff09\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> <p>\u4fee\u6539 /etc/profile.d/my_env.sh \u914d\u7f6e\u6587\u4ef6\uff0c\u589e\u52a0\u4ee5\u4e0b\u5185\u5bb9</p> my_env.sh<pre><code>#TOMCAT_HOME\nexport TOMCAT_HOME=/opt/module/tomcat\nexport PATH=$PATH:$TOMCAT_HOME/bin\n</code></pre> <p>\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6</p> <pre><code>source /etc/profile.d/my_env.sh\n</code></pre> <p>2\uff09\u90e8\u7f72 Tez UI</p> <p>\uff081\uff09\u6e05\u7a7a $TOMCAT_HOME/webapps \u76ee\u5f55</p> <pre><code>rm -rf /opt/module/tomcat/webapps/*\n</code></pre> <p>\uff082\uff09\u90e8\u7f72 tez-ui-0.10.1.war \u5230 tomcat</p> <pre><code>mkdir /opt/module/tomcat/webapps/tez-ui\n\nunzip tez-ui-0.10.1.war -d /opt/module/tomcat/webapps/tez-ui\n</code></pre> <p>\u6ce8\uff1awebapps \u4e0b\u7684\u76ee\u5f55\u4f1a\u81ea\u52a8\u6620\u5c04\u5230\u8bbf\u95ee\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u5c06\u6765 tez-ui \u7684\u8bbf\u95ee\u5730\u5740\u4e3a\uff08 8080 \u4e3a tomcat \u7684\u9ed8\u8ba4\u7aef\u53e3\u53f7\uff09http://hadoop102:8080/tez-ui</p> <p>\uff083\uff09\u4fee\u6539 tez ui \u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim /opt/module/tomcat/webapps/tez-ui/config/configs.js\n</code></pre> configs.js<pre><code>timeline: \"http://hadoop102:8188\",\nrm: \"http://hadoop103:8088\",\n</code></pre> <p>3\uff09\u914d\u7f6e tez-site.xml \u6587\u4ef6</p> <p>\uff081\uff09\u4fee\u6539 $HADOOP_HOME/etc/hadoop/tez-site.xml \u6587\u4ef6\uff0c\u589e\u52a0\u5982\u4e0b\u5185\u5bb9</p> tez-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;tez.history.logging.service.class&lt;/name&gt;\n&lt;value&gt;org.apache.tez.dag.history.logging.ats.ATSHistoryLoggingService&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;tez.tez-ui.history-url.base&lt;/name&gt;\n&lt;value&gt;http://hadoop102:8080/tez-ui&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09\u5206\u53d1 tez-site.xml \u6587\u4ef6 \uff083\uff09\u91cd\u542f Yarn</p> <p>4\uff09\u914d\u7f6e Hive Hook</p> <p>\u4fee\u6539 hive-site.xml \u914d\u7f6e\u6587\u4ef6\uff0c\u589e\u52a0\u5982\u4e0b\u5185\u5bb9</p> hive-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;hive.exec.pre.hooks&lt;/name&gt;\n&lt;value&gt;org.apache.hadoop.hive.ql.hooks.ATSHook&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;hive.exec.post.hooks&lt;/name&gt;\n&lt;value&gt;org.apache.hadoop.hive.ql.hooks.ATSHook&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;hive.exec.failure.hooks&lt;/name&gt;\n&lt;value&gt;org.apache.hadoop.hive.ql.hooks.ATSHook&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>5\uff09\u542f\u52a8 Tomcat</p> <pre><code>startup.sh\n</code></pre> <p>6\uff09\u8bbf\u95ee tez ui</p> <p>\u5730\u5740\u5982\u4e0b\uff1ahttp://hadoop102:8080/tez-ui</p> <p>ui \u754c\u9762\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"hadoop/hdp_01/","title":"\u7b2c1\u7ae0 Hadoop\u6982\u8ff0","text":""},{"location":"hadoop/hdp_01/#11-hadoop","title":"1.1 Hadoop\u662f\u4ec0\u4e48","text":""},{"location":"hadoop/hdp_01/#12-hadoop","title":"1.2 Hadoop\u53d1\u5c55\u5386\u53f2\uff08\u4e86\u89e3\uff09","text":""},{"location":"hadoop/hdp_01/#13-hadoop","title":"1.3 Hadoop\u4e09\u5927\u53d1\u884c\u7248\u672c\uff08\u4e86\u89e3\uff09","text":"<p>Hadoop \u4e09\u5927\u53d1\u884c\u7248\u672c\uff1aApache\u3001Cloudera\u3001Hortonworks\u3002</p> <p>Apache \u7248\u672c\u6700\u539f\u59cb\uff08\u6700\u57fa\u7840\uff09\u7684\u7248\u672c\uff0c\u5bf9\u4e8e\u5165\u95e8\u5b66\u4e60\u6700\u597d\u30022006</p> <p>Cloudera \u5185\u90e8\u96c6\u6210\u4e86\u5f88\u591a\u5927\u6570\u636e\u6846\u67b6\uff0c\u5bf9\u5e94\u4ea7\u54c1 CDH\u30022008</p> <p>Hortonworks \u6587\u6863\u8f83\u597d\uff0c\u5bf9\u5e94\u4ea7\u54c1 HDP\u30022011</p> <p>Hortonworks \u73b0\u5728\u5df2\u7ecf\u88ab Cloudera \u516c\u53f8\u6536\u8d2d\uff0c\u63a8\u51fa\u65b0\u7684\u54c1\u724c CDP\u3002</p> <p></p> <p></p> <p>1\uff09Apache Hadoop</p> <p>\u5b98\u7f51\u5730\u5740 \u4e0b\u8f7d\u5730\u5740</p> <p>2\uff09Cloudera Hadoop</p> <p>\u5b98\u7f51\u5730\u5740</p> <p>\u4e0b\u8f7d\u5730\u5740</p> <p>\uff081\uff092008 \u5e74\u6210\u7acb\u7684 Cloudera \u662f\u6700\u65e9\u5c06 Hadoop \u5546\u7528\u7684\u516c\u53f8\uff0c\u4e3a\u5408\u4f5c\u4f19\u4f34\u63d0\u4f9b Hadoop \u7684\u5546\u7528\u89e3\u51b3\u65b9\u6848\uff0c\u4e3b\u8981\u662f\u5305\u62ec\u652f\u6301\u3001\u54a8\u8be2\u670d\u52a1\u3001\u57f9\u8bad\u3002</p> <p>\uff082\uff092009 \u5e74 Hadoop \u7684\u521b\u59cb\u4eba Doug Cutting \u4e5f\u52a0\u76df Cloudera \u516c\u53f8\u3002Cloudera \u4ea7\u54c1\u4e3b\u8981\u4e3a CDH\uff0cCloudera Manager\uff0cCloudera Support</p> <p>\uff083\uff09CDH \u662f Cloudera \u7684 Hadoop \u53d1\u884c\u7248\uff0c\u5b8c\u5168\u95ed\u6e90\uff0c\u6bd4 Apache Hadoop \u5728\u517c\u5bb9\u6027\uff0c\u5b89\u5168\u6027\uff0c\u7a33\u5b9a\u6027\u4e0a\u6709\u6240\u589e\u5f3a\u3002Cloudera \u7684\u6807\u4ef7\u4e3a\u6bcf\u5e74\u6bcf\u4e2a\u8282\u70b9 10000 \u7f8e\u5143\u3002</p> <p>\uff084\uff09Cloudera Manager \u662f\u96c6\u7fa4\u7684\u8f6f\u4ef6\u5206\u53d1\u53ca\u7ba1\u7406\u76d1\u63a7\u5e73\u53f0\uff0c\u53ef\u4ee5\u5728\u51e0\u4e2a\u5c0f\u65f6\u5185\u90e8\u7f72\u597d\u4e00\u4e2a Hadoop \u96c6\u7fa4\uff0c\u5e76\u5bf9\u96c6\u7fa4\u7684\u8282\u70b9\u53ca\u670d\u52a1\u8fdb\u884c\u5b9e\u65f6\u76d1\u63a7\u3002</p> <p>3\uff09Hortonworks Hadoop</p> <p>\u5b98\u7f51\u5730\u5740</p> <p>\u4e0b\u8f7d\u5730\u5740</p> <p>\uff081\uff092011 \u5e74\u6210\u7acb\u7684 Hortonworks \u662f\u96c5\u864e\u4e0e\u7845\u8c37\u98ce\u6295\u516c\u53f8 Benchmark Capital \u5408\u8d44\u7ec4\u5efa\u3002</p> <p>\uff082\uff09\u516c\u53f8\u6210\u7acb\u4e4b\u521d\u5c31\u5438\u7eb3\u4e86\u5927\u7ea6 25 \u540d\u81f3 30 \u540d\u4e13\u95e8\u7814\u7a76 Hadoop \u7684\u96c5\u864e\u5de5\u7a0b\u5e08\uff0c\u4e0a\u8ff0\u5de5\u7a0b\u5e08\u5747\u5728 2005 \u5e74\u5f00\u59cb\u534f\u52a9\u96c5\u864e\u5f00\u53d1 Hadoop\uff0c\u8d21\u732e\u4e86 Hadoop 80% \u7684\u4ee3\u7801\u3002</p> <p>\uff083\uff09Hortonworks \u7684\u4e3b\u6253\u4ea7\u54c1\u662f Hortonworks Data Platform\uff08HDP\uff09\uff0c\u4e5f\u540c\u6837\u662f 100% \u5f00\u6e90\u7684\u4ea7\u54c1\uff0cHDP \u9664\u5e38\u89c1\u7684\u9879\u76ee\u5916\u8fd8\u5305\u62ec\u4e86 Ambari\uff0c\u4e00\u6b3e\u5f00\u6e90\u7684\u5b89\u88c5\u548c\u7ba1\u7406\u7cfb\u7edf\u3002</p> <p>\uff084\uff092018 \u5e74 Hortonworks \u76ee\u524d\u5df2\u7ecf\u88ab Cloudera \u516c\u53f8\u6536\u8d2d\u3002</p>"},{"location":"hadoop/hdp_01/#14-hadoop4","title":"1.4 Hadoop\u4f18\u52bf\uff084\u9ad8\uff09","text":""},{"location":"hadoop/hdp_01/#15-hadoop","title":"1.5 Hadoop\u7ec4\u6210\uff08\u9762\u8bd5\u91cd\u70b9\uff09","text":""},{"location":"hadoop/hdp_01/#151-hdfs","title":"1.5.1 HDFS\u67b6\u6784\u6982\u8ff0","text":"<p>Hadoop Distributed File System\uff0c\u7b80\u79f0 HDFS\uff0c\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p></p>"},{"location":"hadoop/hdp_01/#152-yarn","title":"1.5.2 YARN\u67b6\u6784\u6982\u8ff0","text":"<p>Yet Another Resource Negotiator \u7b80\u79f0 YARN \uff0c\u53e6\u4e00\u79cd\u8d44\u6e90\u534f\u8c03\u8005\uff0c\u662f Hadoop \u7684\u8d44\u6e90\u7ba1\u7406\u5668\u3002</p> <p></p>"},{"location":"hadoop/hdp_01/#153-mapreduce","title":"1.5.3 MapReduce\u67b6\u6784\u6982\u8ff0","text":"<p>MapReduce \u5c06\u8ba1\u7b97\u8fc7\u7a0b\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1aMap \u548c Reduce\u3002</p> <p>\uff081\uff09Map \u9636\u6bb5\u5e76\u884c\u5904\u7406\u8f93\u5165\u6570\u636e</p> <p>\uff082\uff09Reduce \u9636\u6bb5\u5bf9 Map \u7ed3\u679c\u8fdb\u884c\u6c47\u603b</p> <p></p>"},{"location":"hadoop/hdp_01/#154-hdfsyarnmapreduce","title":"1.5.4 HDFS\u3001YARN\u3001MapReduce\u4e09\u8005\u5173\u7cfb","text":""},{"location":"hadoop/hdp_01/#16","title":"1.6 \u5927\u6570\u636e\u6280\u672f\u751f\u6001\u4f53\u7cfb","text":"<p>\u56fe\u4e2d\u6d89\u53ca\u7684\u6280\u672f\u540d\u8bcd\u89e3\u91ca\u5982\u4e0b\uff1a</p> <p>\uff081\uff09Sqoop\uff1aSqoop \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u5de5\u5177\uff0c\u4e3b\u8981\u7528\u4e8e\u5728 Hadoop\u3001Hive \u4e0e\u4f20\u7edf\u7684\u6570\u636e\u5e93\uff08 MySQL \uff09\u95f4\u8fdb\u884c\u6570\u636e\u7684\u4f20\u9012\uff0c\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff08\u4f8b\u5982 \uff1aMySQL\uff0cOracle \u7b49\uff09\u4e2d\u7684\u6570\u636e\u5bfc\u8fdb\u5230 Hadoop \u7684 HDFS \u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5c06 HDFS \u7684\u6570\u636e\u5bfc\u8fdb\u5230\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u3002</p> <p>\uff082\uff09Flume\uff1aFlume \u662f\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\uff0c\u9ad8\u53ef\u9760\u7684\uff0c\u5206\u5e03\u5f0f\u7684\u6d77\u91cf\u65e5\u5fd7\u91c7\u96c6\u3001\u805a\u5408\u548c\u4f20\u8f93\u7684\u7cfb\u7edf\uff0cFlume \u652f\u6301\u5728\u65e5\u5fd7\u7cfb\u7edf\u4e2d\u5b9a\u5236\u5404\u7c7b\u6570\u636e\u53d1\u9001\u65b9\uff0c\u7528\u4e8e\u6536\u96c6\u6570\u636e\uff1b </p> <p>\uff083\uff09Kafka\uff1aKafka \u662f\u4e00\u79cd\u9ad8\u541e\u5410\u91cf\u7684\u5206\u5e03\u5f0f\u53d1\u5e03\u8ba2\u9605\u6d88\u606f\u7cfb\u7edf\uff1b </p> <p>\uff084\uff09Spark\uff1aSpark \u662f\u5f53\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5927\u6570\u636e\u5185\u5b58\u8ba1\u7b97\u6846\u67b6\u3002\u53ef\u4ee5\u57fa\u4e8e Hadoop \u4e0a\u5b58\u50a8\u7684\u5927\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\u3002</p> <p>\uff085\uff09Flink\uff1aFlink \u662f\u5f53\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5927\u6570\u636e\u5185\u5b58\u8ba1\u7b97\u6846\u67b6\u3002\u7528\u4e8e\u5b9e\u65f6\u8ba1\u7b97\u7684\u573a\u666f\u8f83\u591a\u3002</p> <p>\uff086\uff09Oozie\uff1aOozie \u662f\u4e00\u4e2a\u7ba1\u7406 Hadoop \u4f5c\u4e1a\uff08 job \uff09\u7684\u5de5\u4f5c\u6d41\u7a0b\u8c03\u5ea6\u7ba1\u7406\u7cfb\u7edf\u3002</p> <p>\uff087\uff09HBase\uff1aHBase \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u3001\u9762\u5411\u5217\u7684\u5f00\u6e90\u6570\u636e\u5e93\u3002HBase \u4e0d\u540c\u4e8e\u4e00\u822c\u7684\u5173\u7cfb\u6570\u636e\u5e93\uff0c\u5b83\u662f\u4e00\u4e2a\u9002\u5408\u4e8e\u975e\u7ed3\u6784\u5316\u6570\u636e\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002</p> <p>\uff088\uff09Hive\uff1aHive \u662f\u57fa\u4e8e Hadoop \u7684\u4e00\u4e2a\u6570\u636e\u4ed3\u5e93\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06\u7ed3\u6784\u5316\u7684\u6570\u636e\u6587\u4ef6\u6620\u5c04\u4e3a\u4e00\u5f20\u6570\u636e\u5e93\u8868\uff0c\u5e76\u63d0\u4f9b\u7b80\u5355\u7684 SQL \u67e5\u8be2\u529f\u80fd\uff0c\u53ef\u4ee5\u5c06 SQL \u8bed\u53e5\u8f6c\u6362\u4e3a MapReduce \u4efb\u52a1\u8fdb\u884c\u8fd0\u884c\u3002\u5176\u4f18\u70b9\u662f\u5b66\u4e60\u6210\u672c\u4f4e\uff0c\u53ef\u4ee5\u901a\u8fc7\u7c7b SQL \u8bed\u53e5\u5feb\u901f\u5b9e\u73b0\u7b80\u5355\u7684 MapReduce \u7edf\u8ba1\uff0c\u4e0d\u5fc5\u5f00\u53d1\u4e13\u95e8\u7684 MapReduce \u5e94\u7528\uff0c\u5341\u5206\u9002\u5408\u6570\u636e\u4ed3\u5e93\u7684\u7edf\u8ba1\u5206\u6790\u3002</p> <p>\uff089\uff09ZooKeeper\uff1a\u5b83\u662f\u4e00\u4e2a\u9488\u5bf9\u5927\u578b\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u53ef\u9760\u534f\u8c03\u7cfb\u7edf\uff0c\u63d0\u4f9b\u7684\u529f\u80fd\u5305\u62ec\uff1a\u914d\u7f6e\u7ef4\u62a4\u3001\u540d\u5b57\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u540c\u6b65\u3001\u7ec4\u670d\u52a1\u7b49\u3002</p>"},{"location":"hadoop/hdp_01/#17","title":"1.7 \u63a8\u8350\u7cfb\u7edf\u6846\u67b6\u56fe","text":""},{"location":"hadoop/hdp_02/","title":"\u7b2c2\u7ae0 Hadoop\u8fd0\u884c\u73af\u5883\u642d\u5efa\uff08\u5f00\u53d1\u91cd\u70b9\uff09","text":""},{"location":"hadoop/hdp_02/#21","title":"2.1 \u6a21\u677f\u865a\u62df\u673a\u73af\u5883\u51c6\u5907","text":"<p>0\uff09\u5b89\u88c5\u6a21\u677f\u865a\u62df\u673a\uff0cIP \u5730\u5740 192.168.10.100\u3001\u4e3b\u673a\u540d\u79f0 hadoop100\u3001\u5185\u5b58 4G\u3001\u786c\u76d8 50G</p> <p>1\uff09hadoop100 \u865a\u62df\u673a\u914d\u7f6e\u8981\u6c42\u5982\u4e0b\uff08\u672c\u6587 Linux \u7cfb\u7edf\u5168\u90e8\u4ee5 CentOS-7.5-x86-1804 \u4e3a\u4f8b\uff09</p> <p>\uff081\uff09\u4f7f\u7528 yum \u5b89\u88c5\u9700\u8981\u865a\u62df\u673a\u53ef\u4ee5\u6b63\u5e38\u4e0a\u7f51\uff0cyum \u5b89\u88c5\u524d\u53ef\u4ee5\u5148\u6d4b\u8bd5\u4e0b\u865a\u62df\u673a\u8054\u7f51\u60c5\u51b5</p> <p>\uff082\uff09\u5b89\u88c5 epel-release</p> <p>\u6ce8</p> <p>Extra Packages for Enterprise Linux \u662f\u4e3a\u201c\u7ea2\u5e3d\u7cfb\u201d\u7684\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u989d\u5916\u7684\u8f6f\u4ef6\u5305\uff0c\u9002\u7528\u4e8e RHEL\u3001CentOS \u548c Scientific Linux\u3002\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u8f6f\u4ef6\u4ed3\u5e93\uff0c\u5927\u591a\u6570 rpm \u5305\u5728\u5b98\u65b9 repository \u4e2d\u662f\u627e\u4e0d\u5230\u7684\uff09</p> <pre><code>yum install -y epel-release\n</code></pre> <p>\uff083\uff09\u6ce8\u610f\uff1a\u5982\u679c Linux \u5b89\u88c5\u7684\u662f\u6700\u5c0f\u7cfb\u7edf\u7248\uff0c\u8fd8\u9700\u8981\u5b89\u88c5\u5982\u4e0b\u5de5\u5177\uff1b\u5982\u679c\u5b89\u88c5\u7684\u662f Linux \u684c\u9762\u6807\u51c6\u7248\uff0c\u4e0d\u9700\u8981\u6267\u884c\u5982\u4e0b\u64cd\u4f5c</p> <p>net-tool\uff1a\u5de5\u5177\u5305\u96c6\u5408\uff0c\u5305\u542b ifconfig \u7b49\u547d\u4ee4</p> <pre><code>yum install -y net-tools </code></pre> <p>vim\uff1a\u7f16\u8f91\u5668</p> <pre><code>yum install -y vim\n</code></pre> <p>\u4e00\u4e9b\u5176\u4ed6\u5de5\u5177</p> <pre><code>yum install -y  net-tools vim psmisc  nc  rsync  lrzsz  ntp libzstd openssl-static tree iotop git </code></pre> <p>2\uff09\u5173\u95ed\u9632\u706b\u5899\uff0c\u5173\u95ed\u9632\u706b\u5899\u5f00\u673a\u81ea\u542f</p> <pre><code>systemctl stop firewalld\nsystemctl disable firewalld.service\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5728\u4f01\u4e1a\u5f00\u53d1\u65f6\uff0c\u901a\u5e38\u5355\u4e2a\u670d\u52a1\u5668\u7684\u9632\u706b\u5899\u65f6\u5173\u95ed\u7684\u3002\u516c\u53f8\u6574\u4f53\u5bf9\u5916\u4f1a\u8bbe\u7f6e\u975e\u5e38\u5b89\u5168\u7684\u9632\u706b\u5899</p> <p>3\uff09\u521b\u5efa atguigu \u7528\u6237\uff0c\u5e76\u4fee\u6539 atguigu \u7528\u6237\u7684\u5bc6\u7801</p> <pre><code>useradd atguigu\npasswd atguigu\n</code></pre> <p>4\uff09\u914d\u7f6e atguigu \u7528\u6237\u5177\u6709 root \u6743\u9650\uff0c\u65b9\u4fbf\u540e\u671f\u52a0 sudo \u6267\u884c root \u6743\u9650\u7684\u547d\u4ee4</p> sudoers<pre><code>## Allow root to run any commands anywhere\nroot    ALL=(ALL)     ALL\natguigu   ALL=(ALL)     NOPASSWD:ALL\n</code></pre> <p>5\uff09\u5728 /opt \u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\u5939\uff0c\u5e76\u4fee\u6539\u6240\u5c5e\u4e3b\u548c\u6240\u5c5e\u7ec4</p> <p>\uff081\uff09\u5728 /opt \u76ee\u5f55\u4e0b\u521b\u5efa module\u3001software \u6587\u4ef6\u5939</p> <pre><code>mkdir /opt/module\nmkdir /opt/software\n</code></pre> <p>\u200b   \uff082\uff09\u4fee\u6539 module\u3001software \u6587\u4ef6\u5939\u7684\u6240\u6709\u8005\u548c\u6240\u5c5e\u7ec4\u5747\u4e3a atguigu \u7528\u6237 </p> <pre><code>chown atguigu:atguigu /opt/module \nchown atguigu:atguigu /opt/software\n</code></pre> <p>\uff083\uff09\u67e5\u770b module\u3001software \u6587\u4ef6\u5939\u7684\u6240\u6709\u8005\u548c\u6240\u5c5e\u7ec4</p> <pre><code>ll\n\n\u603b\u7528\u91cf 12\ndrwxr-xr-x. 2 atguigu atguigu 4096 5\u6708  28 17:18 module\ndrwxr-xr-x. 2 root    root    4096 9\u6708   7 2017 rh\ndrwxr-xr-x. 2 atguigu atguigu 4096 5\u6708  28 17:18 software\n</code></pre> <p>6\uff09\u5378\u8f7d\u865a\u62df\u673a\u81ea\u5e26\u7684 JDK</p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u4f60\u7684\u865a\u62df\u673a\u662f\u6700\u5c0f\u5316\u5b89\u88c5\u4e0d\u9700\u8981\u6267\u884c\u8fd9\u4e00\u6b65\u3002</p> <pre><code>rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps </code></pre> <ul> <li>rpm -qa\uff1a\u67e5\u8be2\u6240\u5b89\u88c5\u7684\u6240\u6709rpm\u8f6f\u4ef6\u5305</li> <li>grep -i\uff1a\u5ffd\u7565\u5927\u5c0f\u5199</li> <li>xargs -n1\uff1a\u8868\u793a\u6bcf\u6b21\u53ea\u4f20\u9012\u4e00\u4e2a\u53c2\u6570</li> <li>rpm -e \u2013nodeps\uff1a\u5f3a\u5236\u5378\u8f7d\u8f6f\u4ef6</li> </ul> <p>7\uff09\u91cd\u542f\u865a\u62df\u673a</p> <pre><code>reboot\n</code></pre>"},{"location":"hadoop/hdp_02/#22","title":"2.2 \u514b\u9686\u865a\u62df\u673a","text":"<p>1\uff09\u5229\u7528\u6a21\u677f\u673a hadoop100\uff0c\u514b\u9686\u4e09\u53f0\u865a\u62df\u673a\uff1ahadoop102 hadoop103 hadoop104</p> <p>\u6ce8\u610f</p> <p>\u514b\u9686\u65f6\uff0c\u8981\u5148\u5173\u95ed hadoop100</p> <p>2\uff09\u4fee\u6539\u514b\u9686\u673a IP\uff0c\u4ee5\u4e0b\u4ee5 hadoop102 \u4e3e\u4f8b\u8bf4\u660e</p> <p>\uff081\uff09\u4fee\u6539\u514b\u9686\u865a\u62df\u673a\u7684\u9759\u6001 IP</p> <pre><code>vim /etc/sysconfig/network-scripts/ifcfg-ens33\n</code></pre> <p>\u6539\u6210</p> ifcfg-ens33<pre><code>DEVICE=ens33\nTYPE=Ethernet\nONBOOT=yes\nBOOTPROTO=static\nNAME=\"ens33\"\nIPADDR=192.168.10.102\nPREFIX=24\nGATEWAY=192.168.10.2\nDNS1=192.168.10.2\n</code></pre> <p>\uff082\uff09\u67e5\u770b Linux \u865a\u62df\u673a\u7684\u865a\u62df\u7f51\u7edc\u7f16\u8f91\u5668\uff0c\u7f16\u8f91 -&gt; \u865a\u62df\u7f51\u7edc\u7f16\u8f91\u5668- &gt; VMnet8</p> <p></p> <p></p> <p>\uff083\uff09\u67e5\u770b Windows \u7cfb\u7edf\u9002\u914d\u5668 VMware Network Adapter VMnet8 \u7684 IP \u5730\u5740</p> <p></p> <p>\uff084\uff09\u4fdd\u8bc1 Linux \u7cfb\u7edf ifcfg-ens33 \u6587\u4ef6\u4e2d IP \u5730\u5740\u3001\u865a\u62df\u7f51\u7edc\u7f16\u8f91\u5668\u5730\u5740\u548c Windows \u7cfb\u7edf VM8 \u7f51\u7edc IP \u5730\u5740\u76f8\u540c\u3002</p> <p>3\uff09\u4fee\u6539\u514b\u9686\u673a\u4e3b\u673a\u540d\uff0c\u4ee5\u4e0b\u4ee5 hadoop102 \u4e3e\u4f8b\u8bf4\u660e</p> <p>\u200b   \uff081\uff09\u4fee\u6539\u4e3b\u673a\u540d\u79f0</p> <pre><code>vim /etc/hostname\n</code></pre> hostname<pre><code>hadoop102\n</code></pre> <p>\uff082\uff09\u914d\u7f6e Linux \u514b\u9686\u673a\u4e3b\u673a\u540d\u79f0\u6620\u5c04 hosts \u6587\u4ef6\uff0c\u6253\u5f00 /etc/hosts</p> <pre><code>vim /etc/hosts\n</code></pre> hosts<pre><code>192.168.10.100 hadoop100\n192.168.10.101 hadoop101\n192.168.10.102 hadoop102\n192.168.10.103 hadoop103\n192.168.10.104 hadoop104\n192.168.10.105 hadoop105\n192.168.10.106 hadoop106\n192.168.10.107 hadoop107\n</code></pre> <p>4\uff09\u91cd\u542f\u514b\u9686\u673a hadoop102 </p> <pre><code>reboot\n</code></pre> <p>5\uff09\u4fee\u6539 windows \u7684\u4e3b\u673a\u6620\u5c04\u6587\u4ef6\uff08 hosts \u6587\u4ef6\uff09</p> <p>\uff081\uff09\u5982\u679c\u64cd\u4f5c\u7cfb\u7edf\u662f window7\uff0c\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539 </p> <p>\u2460\u8fdb\u5165 C:\\Windows\\System32\\drivers\\etc \u8def\u5f84</p> <p>\u2461\u6253\u5f00 hosts \u6587\u4ef6\u5e76\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff0c\u7136\u540e\u4fdd\u5b58</p> hosts<pre><code>192.168.10.100 hadoop100\n192.168.10.101 hadoop101\n192.168.10.102 hadoop102\n192.168.10.103 hadoop103\n192.168.10.104 hadoop104\n192.168.10.105 hadoop105\n192.168.10.106 hadoop106\n192.168.10.107 hadoop107\n192.168.10.108 hadoop108\n</code></pre> <p>\uff082\uff09\u5982\u679c\u64cd\u4f5c\u7cfb\u7edf\u662f window10\uff0c\u5148\u62f7\u8d1d\u51fa\u6765\uff0c\u4fee\u6539\u4fdd\u5b58\u4ee5\u540e\uff0c\u518d\u8986\u76d6\u5373\u53ef</p> <p>\u2460\u8fdb\u5165 C:\\Windows\\System32\\drivers\\etc \u8def\u5f84</p> <p>\u2461\u62f7\u8d1d hosts \u6587\u4ef6\u5230\u684c\u9762</p> <p>\u2462\u6253\u5f00\u684c\u9762 hosts \u6587\u4ef6\u5e76\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> <p>\u2463\u5c06\u684c\u9762 hosts \u6587\u4ef6\u8986\u76d6 C:\\Windows\\System32\\drivers\\etc \u8def\u5f84 hosts \u6587\u4ef6</p>"},{"location":"hadoop/hdp_02/#23-hadoop102jdk","title":"2.3 \u5728hadoop102\u5b89\u88c5JDK","text":"<p>1\uff09\u5378\u8f7d\u73b0\u6709 JDK</p> <p>2\uff09\u7528 XShell \u4f20\u8f93\u5de5\u5177\u5c06 JDK \u5bfc\u5165\u5230 opt \u76ee\u5f55\u4e0b\u9762\u7684 software \u6587\u4ef6\u5939\u4e0b\u9762</p> <p></p> <p>3\uff09\u5728 Linux \u7cfb\u7edf\u4e0b\u7684 opt \u76ee\u5f55\u4e2d\u67e5\u770b\u8f6f\u4ef6\u5305\u662f\u5426\u5bfc\u5165\u6210\u529f</p> <pre><code>ls /opt/software/\n</code></pre> <p>4\uff09\u89e3\u538b JDK \u5230 /opt/module \u76ee\u5f55\u4e0b</p> <pre><code>tar -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/\n</code></pre> <p>5\uff09\u914d\u7f6e JDK \u73af\u5883\u53d8\u91cf</p> <p>\uff081\uff09\u65b0\u5efa /etc/profile.d/my_env.sh \u6587\u4ef6</p> <pre><code>sudo vim /etc/profile.d/my_env.sh\n</code></pre> my_env.sh<pre><code>#JAVA_HOME\nexport JAVA_HOME=/opt/module/jdk1.8.0_212\nexport PATH=$PATH:$JAVA_HOME/bin\n</code></pre> <p>\u200b   \uff082\uff09\u4fdd\u5b58\u540e\u9000\u51fa</p> <p>\u200b   \uff083\uff09source \u4e00\u4e0b /etc/profile \u6587\u4ef6\uff0c\u8ba9\u65b0\u7684\u73af\u5883\u53d8\u91cf PATH \u751f\u6548</p> <pre><code>source /etc/profile\n</code></pre> <p>6\uff09\u6d4b\u8bd5 JDK \u662f\u5426\u5b89\u88c5\u6210\u529f</p> <pre><code>java -version\n</code></pre> <p>\u5982\u679c\u80fd\u770b\u5230\u4ee5\u4e0b\u7ed3\u679c\uff0c\u5219\u4ee3\u8868 Java \u5b89\u88c5\u6210\u529f\u3002</p> <pre><code>java version \"1.8.0_212\"\n</code></pre>"},{"location":"hadoop/hdp_02/#24-hadoop102hadoop","title":"2.4 \u5728hadoop102\u5b89\u88c5Hadoop","text":"<p>Hadoop\u4e0b\u8f7d\u5730\u5740</p> <p>1\uff09\u7528 XShell \u6587\u4ef6\u4f20\u8f93\u5de5\u5177\u5c06 hadoop-3.1.3.tar.gz \u5bfc\u5165\u5230 opt \u76ee\u5f55\u4e0b\u9762\u7684 software \u6587\u4ef6\u5939\u4e0b\u9762</p> <p></p> <p>2\uff09\u8fdb\u5165\u5230 Hadoop \u5b89\u88c5\u5305\u8def\u5f84\u4e0b</p> <pre><code>cd /opt/software/\n</code></pre> <p>3\uff09\u89e3\u538b\u5b89\u88c5\u6587\u4ef6\u5230 /opt/module \u4e0b\u9762</p> <pre><code>tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/\n</code></pre> <p>4\uff09\u67e5\u770b\u662f\u5426\u89e3\u538b\u6210\u529f</p> <pre><code>ls /opt/module/\n\nhadoop-3.1.3\n</code></pre> <p>5\uff09\u5c06 Hadoop \u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf</p> <p>\u200b   \uff081\uff09\u83b7\u53d6 Hadoop \u5b89\u88c5\u8def\u5f84</p> <pre><code>pwd\n\n/opt/module/hadoop-3.1.3\n</code></pre> <p>\u200b   \uff082\uff09\u6253\u5f00 /etc/profile.d/my_env.sh \u6587\u4ef6</p> my_env.sh<pre><code>#HADOOP_HOME\nexport HADOOP_HOME=/opt/module/hadoop-3.1.3\nexport PATH=$PATH:$HADOOP_HOME/bin\nexport PATH=$PATH:$HADOOP_HOME/sbin\n</code></pre> <p>\u200b   \uff083\uff09\u8ba9\u4fee\u6539\u540e\u7684\u6587\u4ef6\u751f\u6548</p> <pre><code>source /etc/profile\n</code></pre> <p>6\uff09\u6d4b\u8bd5\u662f\u5426\u5b89\u88c5\u6210\u529f</p> <pre><code>hadoop version\n\nHadoop 3.1.3\n</code></pre> <p>7\uff09\u91cd\u542f\uff08\u5982\u679c Hadoop \u547d\u4ee4\u4e0d\u80fd\u7528\u518d\u91cd\u542f\u865a\u62df\u673a\uff09</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"hadoop/hdp_02/#25-hadoop","title":"2.5 Hadoop\u76ee\u5f55\u7ed3\u6784","text":"<p>1\uff09\u67e5\u770b Hadoop \u76ee\u5f55\u7ed3\u6784</p> <pre><code>ll\n\n\u603b\u7528\u91cf 52\ndrwxr-xr-x. 2 atguigu atguigu  4096 5\u6708  22 2017 bin\ndrwxr-xr-x. 3 atguigu atguigu  4096 5\u6708  22 2017 etc\ndrwxr-xr-x. 2 atguigu atguigu  4096 5\u6708  22 2017 include\ndrwxr-xr-x. 3 atguigu atguigu  4096 5\u6708  22 2017 lib\ndrwxr-xr-x. 2 atguigu atguigu  4096 5\u6708  22 2017 libexec\n-rw-r--r--. 1 atguigu atguigu 15429 5\u6708  22 2017 LICENSE.txt\n-rw-r--r--. 1 atguigu atguigu   101 5\u6708  22 2017 NOTICE.txt\n-rw-r--r--. 1 atguigu atguigu  1366 5\u6708  22 2017 README.txt\ndrwxr-xr-x. 2 atguigu atguigu  4096 5\u6708  22 2017 sbin\ndrwxr-xr-x. 4 atguigu atguigu  4096 5\u6708  22 2017 share\n</code></pre> <p>2\uff09\u91cd\u8981\u76ee\u5f55</p> <p>\uff081\uff09bin \u76ee\u5f55\uff1a\u5b58\u653e\u5bf9 Hadoop \u76f8\u5173\u670d\u52a1\uff08hdfs\uff0cyarn\uff0cmapred\uff09\u8fdb\u884c\u64cd\u4f5c\u7684\u811a\u672c</p> <p>\uff082\uff09etc \u76ee\u5f55\uff1aHadoop \u7684\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\uff0c\u5b58\u653e Hadoop \u7684\u914d\u7f6e\u6587\u4ef6</p> <p>\uff083\uff09lib \u76ee\u5f55\uff1a\u5b58\u653e Hadoop \u7684\u672c\u5730\u5e93\uff08\u5bf9\u6570\u636e\u8fdb\u884c\u538b\u7f29\u89e3\u538b\u7f29\u529f\u80fd\uff09</p> <p>\uff084\uff09sbin \u76ee\u5f55\uff1a\u5b58\u653e\u542f\u52a8\u6216\u505c\u6b62 Hadoop \u76f8\u5173\u670d\u52a1\u7684\u811a\u672c</p> <p>\uff085\uff09share \u76ee\u5f55\uff1a\u5b58\u653e Hadoop \u7684\u4f9d\u8d56 jar \u5305\u3001\u6587\u6863\u3001\u548c\u5b98\u65b9\u6848\u4f8b</p>"},{"location":"hadoop/hdp_03/","title":"\u7b2c3\u7ae0 Hadoop\u8fd0\u884c\u6a21\u5f0f","text":"<p>1\uff09Hadoop\u5b98\u65b9\u7f51\u7ad9</p> <p>2\uff09Hadoop \u8fd0\u884c\u6a21\u5f0f\u5305\u62ec\uff1a\u672c\u5730\u6a21\u5f0f\u3001\u4f2a\u5206\u5e03\u5f0f\u6a21\u5f0f\u4ee5\u53ca\u5b8c\u5168\u5206\u5e03\u5f0f\u6a21\u5f0f\u3002</p> <ul> <li>\u672c\u5730\u6a21\u5f0f\uff1a\u5355\u673a\u8fd0\u884c\uff0c\u53ea\u662f\u7528\u6765\u6f14\u793a\u4e00\u4e0b\u5b98\u65b9\u6848\u4f8b\u3002\u751f\u4ea7\u73af\u5883\u4e0d\u7528\u3002</li> <li>\u4f2a\u5206\u5e03\u5f0f\u6a21\u5f0f\uff1a\u4e5f\u662f\u5355\u673a\u8fd0\u884c\uff0c\u4f46\u662f\u5177\u5907 Hadoop \u96c6\u7fa4\u7684\u6240\u6709\u529f\u80fd\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u6a21\u62df\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u73af\u5883\u3002\u4e2a\u522b\u7f3a\u94b1\u7684\u516c\u53f8\u7528\u6765\u6d4b\u8bd5\uff0c\u751f\u4ea7\u73af\u5883\u4e0d\u7528\u3002</li> <li>\u5b8c\u5168\u5206\u5e03\u5f0f\u6a21\u5f0f\uff1a\u591a\u53f0\u670d\u52a1\u5668\u7ec4\u6210\u5206\u5e03\u5f0f\u73af\u5883\u3002\u751f\u4ea7\u73af\u5883\u4f7f\u7528\u3002</li> </ul>"},{"location":"hadoop/hdp_03/#31-wordcount","title":"3.1 \u672c\u5730\u8fd0\u884c\u6a21\u5f0f\uff08\u5b98\u65b9WordCount\uff09","text":"<p>1\uff09\u521b\u5efa\u5728 hadoop-3.1.3 \u6587\u4ef6\u4e0b\u9762\u521b\u5efa\u4e00\u4e2a wcinput \u6587\u4ef6\u5939</p> <pre><code>mkdir wcinput\n</code></pre> <p>2\uff09\u5728 wcinput \u6587\u4ef6\u4e0b\u521b\u5efa\u4e00\u4e2a word.txt \u6587\u4ef6</p> <pre><code>cd wcinput\n</code></pre> <p>3\uff09\u7f16\u8f91 word.txt \u6587\u4ef6</p> <pre><code>vim word.txt\n</code></pre> <p>\u5728\u6587\u4ef6\u4e2d\u8f93\u5165\u5982\u4e0b\u5185\u5bb9</p> word.txt<pre><code>hadoop yarn\nhadoop mapreduce\natguigu\natguigu\n</code></pre> <p>\u4fdd\u5b58\u9000\u51fa\uff1a:wq</p> <p>4\uff09\u56de\u5230 Hadoop \u76ee\u5f55 /opt/module/hadoop-3.1.3</p> <p>5\uff09\u6267\u884c\u7a0b\u5e8f</p> <pre><code>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount wcinput wcoutput\n</code></pre> <p>6\uff09\u67e5\u770b\u7ed3\u679c</p> <pre><code>cat wcoutput/part-r-00000\n</code></pre> <p>\u770b\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> part-r-00000<pre><code>atguigu 2\nhadoop  2\nmapreduce       1\nyarn    1\n</code></pre>"},{"location":"hadoop/hdp_03/#32","title":"3.2 \u5b8c\u5168\u5206\u5e03\u5f0f\u8fd0\u884c\u6a21\u5f0f\uff08\u5f00\u53d1\u91cd\u70b9\uff09","text":"<p>\u5206\u6790\uff1a \uff081\uff09\u51c6\u5907 3 \u53f0\u5ba2\u6237\u673a\uff08\u5173\u95ed\u9632\u706b\u5899\u3001\u9759\u6001 IP\u3001\u4e3b\u673a\u540d\u79f0\uff09</p> <p>\uff082\uff09\u5b89\u88c5 JDK</p> <p>\uff083\uff09\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> <p>\uff084\uff09\u5b89\u88c5 Hadoop</p> <p>\uff085\uff09\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> <p>\uff086\uff09\u914d\u7f6e\u96c6\u7fa4</p> <p>\uff087\uff09\u5355\u70b9\u542f\u52a8</p> <p>\uff088\uff09\u914d\u7f6e ssh</p> <p>\uff089\uff09\u7fa4\u8d77\u5e76\u6d4b\u8bd5\u96c6\u7fa4</p>"},{"location":"hadoop/hdp_03/#321","title":"3.2.1 \u865a\u62df\u673a\u51c6\u5907","text":"<p>\u8be6\u89c1 2.1\u30012.2 \u4e24\u8282\u3002</p>"},{"location":"hadoop/hdp_03/#322-xsync","title":"3.2.2 \u7f16\u5199\u96c6\u7fa4\u5206\u53d1\u811a\u672cxsync","text":"<p>1\uff09scp\uff08secure copy\uff09\u5b89\u5168\u62f7\u8d1d</p> <p>\uff081\uff09scp \u5b9a\u4e49 scp \u53ef\u4ee5\u5b9e\u73b0\u670d\u52a1\u5668\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\u3002\uff08from server1 to server2\uff09 \uff082\uff09\u57fa\u672c\u8bed\u6cd5 <code>scp -r pdir/fname user@host:pdir/$fname</code> \u547d\u4ee4   \u9012\u5f52     \u8981\u62f7\u8d1d\u7684\u6587\u4ef6\u8def\u5f84/\u540d\u79f0   \u76ee\u7684\u5730\u7528\u6237@\u4e3b\u673a:\u76ee\u7684\u5730\u8def\u5f84/\u540d\u79f0</p> <p>\uff083\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u524d\u63d0\uff1a\u5728 hadoop102\u3001hadoop103\u3001hadoop104 \u90fd\u5df2\u7ecf\u521b\u5efa\u597d\u7684 /opt/module\u3001 /opt/software \u4e24\u4e2a\u76ee\u5f55\uff0c\u5e76\u4e14\u5df2\u7ecf\u628a\u8fd9\u4e24\u4e2a\u76ee\u5f55\u4fee\u6539\u4e3a atguigu:atguigu</p> <pre><code>sudo chown atguigu:atguigu -R /opt/module\n</code></pre> <p>\u2460\u5728 hadoop102 \u4e0a\uff0c\u5c06 hadoop102 \u4e2d /opt/module/jdk1.8.0_212 \u76ee\u5f55\u62f7\u8d1d\u5230 hadoop103 \u4e0a\u3002</p> <pre><code>scp -r /opt/module/jdk1.8.0_212  atguigu@hadoop103:/opt/module\n</code></pre> <p>\u2461\u5728 hadoop103 \u4e0a\uff0c\u5c06 hadoop102 \u4e2d /opt/module/hadoop-3.1.3 \u76ee\u5f55\u62f7\u8d1d\u5230 hadoop103 \u4e0a\u3002</p> <pre><code>scp -r atguigu@hadoop102:/opt/module/hadoop-3.1.3 /opt/module/\n</code></pre> <p>\u2462\u5728 hadoop103 \u4e0a\u64cd\u4f5c\uff0c\u5c06 hadoop102 \u4e2d /opt/module \u76ee\u5f55\u4e0b\u6240\u6709\u76ee\u5f55\u62f7\u8d1d\u5230 hadoop104 \u4e0a\u3002</p> <pre><code>scp -r atguigu@hadoop102:/opt/module/* atguigu@hadoop104:/opt/module\n</code></pre> <p>2\uff09rsync \u8fdc\u7a0b\u540c\u6b65\u5de5\u5177</p> <p>rsync \u4e3b\u8981\u7528\u4e8e\u5907\u4efd\u548c\u955c\u50cf\u3002\u5177\u6709\u901f\u5ea6\u5feb\u3001\u907f\u514d\u590d\u5236\u76f8\u540c\u5185\u5bb9\u548c\u652f\u6301\u7b26\u53f7\u94fe\u63a5\u7684\u4f18\u70b9\u3002</p> <p>rsync\u548c scp \u533a\u522b\uff1a\u7528 rsync \u505a\u6587\u4ef6\u7684\u590d\u5236\u8981\u6bd4 scp \u7684\u901f\u5ea6\u5feb\uff0crsync \u53ea\u5bf9\u5dee\u5f02\u6587\u4ef6\u505a\u66f4\u65b0\u3002scp \u662f\u628a\u6240\u6709\u6587\u4ef6\u90fd\u590d\u5236\u8fc7\u53bb\u3002</p> <p>\uff081\uff09\u57fa\u672c\u8bed\u6cd5</p> <p><code>rsync -av $pdir/$fname $user@$host:$pdir/$fname</code></p> <p>\u547d\u4ee4   \u9009\u9879\u53c2\u6570   \u8981\u62f7\u8d1d\u7684\u6587\u4ef6\u8def\u5f84/\u540d\u79f0   \u76ee\u7684\u5730\u7528\u6237@\u4e3b\u673a:\u76ee\u7684\u5730\u8def\u5f84/\u540d\u79f0</p> <p>\u9009\u9879\u53c2\u6570\u8bf4\u660e</p> \u9009\u9879 \u529f\u80fd -a \u5f52\u6863\u62f7\u8d1d -v \u663e\u793a\u590d\u5236\u8fc7\u7a0b <p>\uff082\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u2460\u5220\u9664 hadoop103 \u4e2d /opt/module/hadoop-3.1.3/wcinput</p> <pre><code>rm -rf wcinput/\n</code></pre> <p>\u2461\u540c\u6b65 hadoop102 \u4e2d\u7684 /opt/module/hadoop-3.1.3 \u5230 hadoop103</p> <pre><code>rsync -av hadoop-3.1.3/ atguigu@hadoop103:/opt/module/hadoop-3.1.3/\n</code></pre> <p>3\uff09xsync \u96c6\u7fa4\u5206\u53d1\u811a\u672c</p> <p>\uff081\uff09\u9700\u6c42\uff1a\u5faa\u73af\u590d\u5236\u6587\u4ef6\u5230\u6240\u6709\u8282\u70b9\u7684\u76f8\u540c\u76ee\u5f55\u4e0b</p> <p>\uff082\uff09\u9700\u6c42\u5206\u6790\uff1a</p> <p>\u2460rsync \u547d\u4ee4\u539f\u59cb\u62f7\u8d1d\uff1a</p> <pre><code>rsync -av /opt/module atguigu@hadoop103:/opt/\n</code></pre> <p>\u2461\u671f\u671b\u811a\u672c\uff1a</p> <p>xsync \u8981\u540c\u6b65\u7684\u6587\u4ef6\u540d\u79f0</p> <p>\u2462\u671f\u671b\u811a\u672c\u5728\u4efb\u4f55\u8def\u5f84\u90fd\u80fd\u4f7f\u7528\uff08\u811a\u672c\u653e\u5728\u58f0\u660e\u4e86\u5168\u5c40\u73af\u5883\u53d8\u91cf\u7684\u8def\u5f84\uff09</p> <pre><code>echo $PATH\n/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/atguigu/.local/bin:/home/atguigu/bin:/opt/module/jdk1.8.0_212/bin\n</code></pre> <p>\uff083\uff09\u811a\u672c\u5b9e\u73b0</p> <p>\u2460\u5728 /home/atguigu/bin \u76ee\u5f55\u4e0b\u521b\u5efa xsync \u6587\u4ef6</p> <pre><code>cd /home/atguigu\nmkdir bin\ncd bin\nvim xsync\n</code></pre> <p>\u5728\u8be5\u6587\u4ef6\u4e2d\u7f16\u5199\u5982\u4e0b\u4ee3\u7801</p> xsync<pre><code>#!/bin/bash\n\n#1. \u5224\u65ad\u53c2\u6570\u4e2a\u6570\nif [ $# -lt 1 ]\nthen\necho Not Enough Arguement!\n    exit;\nfi\n\n#2. \u904d\u5386\u96c6\u7fa4\u6240\u6709\u673a\u5668\nfor host in hadoop102 hadoop103 hadoop104\ndo\necho ====================  $host  ====================\n#3. \u904d\u5386\u6240\u6709\u76ee\u5f55\uff0c\u6328\u4e2a\u53d1\u9001\n\nfor file in $@\ndo\n#4. \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\nif [ -e $file ]\nthen\n#5. \u83b7\u53d6\u7236\u76ee\u5f55\npdir=$(cd -P $(dirname $file); pwd)\n\n#6. \u83b7\u53d6\u5f53\u524d\u6587\u4ef6\u7684\u540d\u79f0\nfname=$(basename $file)\nssh $host \"mkdir -p $pdir\"\nrsync -av $pdir/$fname $host:$pdir\nelse\necho $file does not exists!\n        fi\ndone\ndone\n</code></pre> <p>\u2461\u4fee\u6539\u811a\u672c xsync \u5177\u6709\u6267\u884c\u6743\u9650</p> <pre><code>chmod +x xsync\n</code></pre> <p>\u2462\u6d4b\u8bd5\u811a\u672c</p> <pre><code>xsync /home/atguigu/bin\n</code></pre> <p>\u2463\u5c06\u811a\u672c\u590d\u5236\u5230 /bin \u4e2d\uff0c\u4ee5\u4fbf\u5168\u5c40\u8c03\u7528</p> <pre><code>sudo cp xsync /bin/\n</code></pre> <p>\u2464\u540c\u6b65\u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff08 root \u6240\u6709\u8005\uff09</p> <pre><code>sudo xsync /etc/profile.d/my_env.sh\n</code></pre> <p>\u8ba9\u73af\u5883\u53d8\u91cf\u751f\u6548</p> <pre><code>source /etc/profile\nsource /etc/profile\n</code></pre>"},{"location":"hadoop/hdp_03/#323-ssh","title":"3.2.3 SSH\u65e0\u5bc6\u767b\u5f55\u914d\u7f6e","text":"<p>1\uff09\u914d\u7f6e ssh</p> <p>\uff081\uff09\u57fa\u672c\u8bed\u6cd5</p> <p>ssh \u53e6\u4e00\u53f0\u7535\u8111\u7684 IP \u5730\u5740</p> <p>\uff082\uff09ssh \u8fde\u63a5\u65f6\u51fa\u73b0 Host key verification failed \u7684\u89e3\u51b3\u65b9\u6cd5</p> <pre><code>ssh hadoop103\n</code></pre> <p>\u5982\u679c\u51fa\u73b0\u5982\u4e0b\u5185\u5bb9</p> <pre><code>Are you sure you want to continue connecting (yes/no)? </code></pre> <p>\u8f93\u5165 yes\uff0c\u5e76\u56de\u8f66</p> <p>\uff083\uff09\u9000\u56de\u5230 hadoop102</p> <pre><code>exit\n</code></pre> <p>2\uff09\u65e0\u5bc6\u94a5\u914d\u7f6e</p> <p>\uff081\uff09\u514d\u5bc6\u767b\u5f55\u539f\u7406 </p> <p></p> <p>\uff082\uff09\u751f\u6210\u516c\u94a5\u548c\u79c1\u94a5</p> <pre><code>ssh-keygen -t rsa\n</code></pre> <p>\u7136\u540e\u6572\uff08\u4e09\u4e2a\u56de\u8f66\uff09\uff0c\u5c31\u4f1a\u751f\u6210\u4e24\u4e2a\u6587\u4ef6 id_rsa\uff08\u79c1\u94a5\uff09\u3001id_rsa.pub\uff08\u516c\u94a5\uff09</p> <p>\uff083\uff09\u5c06\u516c\u94a5\u62f7\u8d1d\u5230\u8981\u514d\u5bc6\u767b\u5f55\u7684\u76ee\u6807\u673a\u5668\u4e0a</p> <pre><code>ssh-copy-id hadoop102\nssh-copy-id hadoop103\nssh-copy-id hadoop104\n</code></pre> <p>\u6ce8\u610f</p> <p>\u8fd8\u9700\u8981\u5728 hadoop103 \u4e0a\u91c7\u7528 atguigu \u8d26\u53f7\u914d\u7f6e\u4e00\u4e0b\u65e0\u5bc6\u767b\u5f55\u5230 hadoop102\u3001hadoop103\u3001hadoop104 \u670d\u52a1\u5668\u4e0a\u3002 \u8fd8\u9700\u8981\u5728 hadoop104 \u4e0a\u91c7\u7528 atguigu \u8d26\u53f7\u914d\u7f6e\u4e00\u4e0b\u65e0\u5bc6\u767b\u5f55\u5230 hadoop102\u3001hadoop103\u3001hadoop104 \u670d\u52a1\u5668\u4e0a\u3002 \u8fd8\u9700\u8981\u5728 hadoop102 \u4e0a\u91c7\u7528 root \u8d26\u53f7\uff0c\u914d\u7f6e\u4e00\u4e0b\u65e0\u5bc6\u767b\u5f55\u5230 hadoop102\u3001hadoop103\u3001hadoop104\uff1b</p> <p>3\uff09.ssh \u6587\u4ef6\u5939\u4e0b\uff08~/.ssh\uff09\u7684\u6587\u4ef6\u529f\u80fd\u89e3\u91ca</p> known_hosts \u8bb0\u5f55ssh\u8bbf\u95ee\u8fc7\u8ba1\u7b97\u673a\u7684\u516c\u94a5\uff08public key\uff09 id_rsa \u751f\u6210\u7684\u79c1\u94a5 id_rsa.pub \u751f\u6210\u7684\u516c\u94a5 authorized_keys \u5b58\u653e\u6388\u6743\u8fc7\u7684\u65e0\u5bc6\u767b\u5f55\u670d\u52a1\u5668\u516c\u94a5"},{"location":"hadoop/hdp_03/#324","title":"3.2.4 \u96c6\u7fa4\u914d\u7f6e","text":"<p>1\uff09\u96c6\u7fa4\u90e8\u7f72\u89c4\u5212</p> <p>\u6ce8\u610f</p> <p>NameNode \u548c SecondaryNameNode \u4e0d\u8981\u5b89\u88c5\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668 ResourceManager \u4e5f\u5f88\u6d88\u8017\u5185\u5b58\uff0c\u4e0d\u8981\u548c NameNode\u3001SecondaryNameNode \u914d\u7f6e\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u3002</p> hadoop102 hadoop103 hadoop104 HDFS NameNodeDataNode DataNode SecondaryNameNodeDataNode YARN NodeManager ResourceManagerNodeManager NodeManager <p>2\uff09\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e</p> <p>Hadoop \u914d\u7f6e\u6587\u4ef6\u5206\u4e24\u7c7b\uff1a\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u548c\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u6709\u7528\u6237\u60f3\u4fee\u6539\u67d0\u4e00\u9ed8\u8ba4\u914d\u7f6e\u503c\u65f6\uff0c\u624d\u9700\u8981\u4fee\u6539\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u66f4\u6539\u76f8\u5e94\u5c5e\u6027\u503c\u3002</p> <p>\uff081\uff09\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff1a</p> \u8981\u83b7\u53d6\u7684\u9ed8\u8ba4\u6587\u4ef6 \u6587\u4ef6\u5b58\u653e\u5728 Hadoop \u7684 jar \u5305\u4e2d\u7684\u4f4d\u7f6e [core-default.xml] hadoop-common-3.1.3.jar/core-default.xml [hdfs-default.xml] hadoop-hdfs-3.1.3.jar/hdfs-default.xml [yarn-default.xml] hadoop-yarn-common-3.1.3.jar/yarn-default.xml [mapred-default.xml] hadoop-mapreduce-client-core-3.1.3.jar/mapred-default.xml <p>\uff082\uff09\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff1a</p> <p>\u200b   core-site.xml\u3001hdfs-site.xml\u3001yarn-site.xml\u3001mapred-site.xml \u56db\u4e2a\u914d\u7f6e\u6587\u4ef6\u5b58\u653e\u5728 $HADOOP_HOME/etc/hadoop \u8fd9\u4e2a\u8def\u5f84\u4e0a\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u9879\u76ee\u9700\u6c42\u91cd\u65b0\u8fdb\u884c\u4fee\u6539\u914d\u7f6e\u3002</p> <p>3\uff09\u914d\u7f6e\u96c6\u7fa4</p> <p>\uff081\uff09\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6</p> <p>\u914d\u7f6e core-site.xml</p> core-site.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n&lt;!-- \u6307\u5b9aNameNode\u7684\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;fs.defaultFS&lt;/name&gt;\n&lt;value&gt;hdfs://hadoop102:8020&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9ahadoop\u6570\u636e\u7684\u5b58\u50a8\u76ee\u5f55 --&gt;\n&lt;property&gt;\n&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;\n&lt;value&gt;/opt/module/hadoop-3.1.3/data&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u914d\u7f6eHDFS\u7f51\u9875\u767b\u5f55\u4f7f\u7528\u7684\u9759\u6001\u7528\u6237\u4e3aatguigu --&gt;\n&lt;property&gt;\n&lt;name&gt;hadoop.http.staticuser.user&lt;/name&gt;\n&lt;value&gt;atguigu&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>\uff082\uff09HDFS \u914d\u7f6e\u6587\u4ef6</p> hdfs-site.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n&lt;!-- nn web\u7aef\u8bbf\u95ee\u5730\u5740--&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.http-address&lt;/name&gt;\n&lt;value&gt;hadoop102:9870&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- 2nn web\u7aef\u8bbf\u95ee\u5730\u5740--&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;\n&lt;value&gt;hadoop104:9868&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>\uff083\uff09YARN \u914d\u7f6e\u6587\u4ef6</p> yarn-site.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n&lt;!-- \u6307\u5b9aMR\u8d70shuffle --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;\n&lt;value&gt;mapreduce_shuffle&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9aResourceManager\u7684\u5730\u5740--&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;\n&lt;value&gt;hadoop103&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u73af\u5883\u53d8\u91cf\u7684\u7ee7\u627f --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;\n&lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>\uff084\uff09MapReduce \u914d\u7f6e\u6587\u4ef6</p> mapred-site.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n&lt;!-- \u6307\u5b9aMapReduce\u7a0b\u5e8f\u8fd0\u884c\u5728Yarn\u4e0a --&gt;\n&lt;property&gt;\n&lt;name&gt;mapreduce.framework.name&lt;/name&gt;\n&lt;value&gt;yarn&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>4\uff09\u5728\u96c6\u7fa4\u4e0a\u5206\u53d1\u914d\u7f6e\u597d\u7684 Hadoop \u914d\u7f6e\u6587\u4ef6</p> <pre><code>xsync /opt/module/hadoop-3.1.3/etc/hadoop/\n</code></pre> <p>5\uff09\u53bb 103 \u548c 104 \u4e0a\u67e5\u770b\u6587\u4ef6\u5206\u53d1\u60c5\u51b5</p> <pre><code>cat /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml\ncat /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml\n</code></pre>"},{"location":"hadoop/hdp_03/#325","title":"3.2.5 \u7fa4\u8d77\u96c6\u7fa4","text":"<p>1\uff09\u914d\u7f6e workers</p> workers<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre> <p>\u6ce8\u610f</p> <p>\u8be5\u6587\u4ef6\u4e2d\u6dfb\u52a0\u7684\u5185\u5bb9\u7ed3\u5c3e\u4e0d\u5141\u8bb8\u6709\u7a7a\u683c\uff0c\u6587\u4ef6\u4e2d\u4e0d\u5141\u8bb8\u6709\u7a7a\u884c\u3002</p> <p>\u540c\u6b65\u6240\u6709\u8282\u70b9\u914d\u7f6e\u6587\u4ef6</p> <pre><code>xsync /opt/module/hadoop-3.1.3/etc\n</code></pre> <p>2\uff09\u542f\u52a8\u96c6\u7fa4</p> <p>\uff081\uff09\u5982\u679c\u96c6\u7fa4\u662f\u7b2c\u4e00\u6b21\u542f\u52a8\uff0c\u9700\u8981\u5728 hadoop102 \u8282\u70b9\u683c\u5f0f\u5316 NameNode\uff08\u6ce8\u610f\uff1a\u683c\u5f0f\u5316 NameNode\uff0c\u4f1a\u4ea7\u751f\u65b0\u7684\u96c6\u7fa4 id\uff0c\u5bfc\u81f4 NameNode \u548c DataNode \u7684\u96c6\u7fa4 id \u4e0d\u4e00\u81f4\uff0c\u96c6\u7fa4\u627e\u4e0d\u5230\u5df2\u5f80\u6570\u636e\u3002\u5982\u679c\u96c6\u7fa4\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u62a5\u9519\uff0c\u9700\u8981\u91cd\u65b0\u683c\u5f0f\u5316 NameNode \u7684\u8bdd\uff0c\u4e00\u5b9a\u8981\u5148\u505c\u6b62 namenode \u548c datanode \u8fdb\u7a0b\uff0c\u5e76\u4e14\u8981\u5220\u9664\u6240\u6709\u673a\u5668\u7684 data \u548c logs \u76ee\u5f55\uff0c\u7136\u540e\u518d\u8fdb\u884c\u683c\u5f0f\u5316\u3002\uff09</p> <pre><code>hdfs namenode -format\n</code></pre> <p>\uff082\uff09\u542f\u52a8 HDFS</p> <pre><code> sbin/start-dfs.sh\n</code></pre> <p>\uff083\uff09\u5728\u914d\u7f6e\u4e86 ResourceManager \u7684\u8282\u70b9\uff08hadoop103\uff09\u542f\u52a8 YARN</p> <p>```shell\u00a0 sbin/start-yarn.sh <pre><code>\uff084\uff09Web \u7aef\u67e5\u770b HDFS \u7684 NameNode\n\n\u2460\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165\uff1ahttp://hadoop102:9870\n\n\u2461\u67e5\u770b HDFS \u4e0a\u5b58\u50a8\u7684\u6570\u636e\u4fe1\u606f\n\n\uff085\uff09Web \u7aef\u67e5\u770b YARN \u7684 ResourceManager\n\n\u2460\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165\uff1ahttp://hadoop103:8088\n\n\u2461\u67e5\u770b YARN \u4e0a\u8fd0\u884c\u7684 Job \u4fe1\u606f\n\n**3\uff09\u96c6\u7fa4\u57fa\u672c\u6d4b\u8bd5**\n\n\uff081\uff09\u4e0a\u4f20\u6587\u4ef6\u5230\u96c6\u7fa4\n\n\u4e0a\u4f20\u5c0f\u6587\u4ef6\n\n```shell\nhadoop fs -mkdir /input\nhadoop fs -put $HADOOP_HOME/wcinput/word.txt /input\n</code></pre></p> <p>\u4e0a\u4f20\u5927\u6587\u4ef6</p> <pre><code>hadoop fs -put  /opt/software/jdk-8u212-linux-x64.tar.gz  /\n</code></pre> <p>\uff082\uff09\u4e0a\u4f20\u6587\u4ef6\u540e\u67e5\u770b\u6587\u4ef6\u5b58\u653e\u5728\u4ec0\u4e48\u4f4d\u7f6e</p> <p>\u67e5\u770b HDFS \u6587\u4ef6\u5b58\u50a8\u8def\u5f84</p> <pre><code>pwd\n\n/opt/module/hadoop-3.1.3/data/dfs/data/current/BP-1436128598-192.168.10.102-1610603650062/current/finalized/subdir0/subdir0\n</code></pre> <p>\u67e5\u770b HDFS \u5728\u78c1\u76d8\u5b58\u50a8\u6587\u4ef6\u5185\u5bb9</p> <pre><code>cat blk_1073741825\n\nhadoop yarn\nhadoop mapreduce \natguigu\natguigu\n</code></pre> <p>\uff083\uff09\u62fc\u63a5</p> <pre><code>-rw-rw-r--. 1 atguigu atguigu 134217728 5\u6708  23 16:01 blk_1073741836\n-rw-rw-r--. 1 atguigu atguigu   1048583 5\u6708  23 16:01 blk_1073741836_1012.meta\n-rw-rw-r--. 1 atguigu atguigu  63439959 5\u6708  23 16:01 blk_1073741837\n-rw-rw-r--. 1 atguigu atguigu    495635 5\u6708  23 16:01 blk_1073741837_1013.meta\n</code></pre> <pre><code>cat blk_1073741836&gt;&gt;tmp.tar.gz\ncat blk_1073741837&gt;&gt;tmp.tar.gz\ntar -zxvf tmp.tar.gz\n</code></pre> <p>\uff084\uff09\u4e0b\u8f7d</p> <pre><code>hadoop fs -get /jdk-8u212-linux-x64.tar.gz ./\n</code></pre> <p>\uff085\uff09\u6267\u884c wordcount \u7a0b\u5e8f</p> <pre><code>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output\n</code></pre>"},{"location":"hadoop/hdp_03/#326","title":"3.2.6 \u914d\u7f6e\u5386\u53f2\u670d\u52a1\u5668","text":"<p>\u4e3a\u4e86\u67e5\u770b\u7a0b\u5e8f\u7684\u5386\u53f2\u8fd0\u884c\u60c5\u51b5\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e0b\u5386\u53f2\u670d\u52a1\u5668\u3002\u5177\u4f53\u914d\u7f6e\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>1\uff09\u914d\u7f6e mapred-site.xml</p> mapped-site.xml<pre><code>&lt;!-- \u5386\u53f2\u670d\u52a1\u5668\u7aef\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;\n&lt;value&gt;hadoop102:10020&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u5386\u53f2\u670d\u52a1\u5668web\u7aef\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;\n&lt;value&gt;hadoop102:19888&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>2\uff09\u5206\u53d1\u914d\u7f6e</p> <pre><code>xsync $HADOOP_HOME/etc/hadoop/mapred-site.xml\n</code></pre> <p>3\uff09\u5728 hadoop102 \u542f\u52a8\u5386\u53f2\u670d\u52a1\u5668</p> <pre><code>mapred --daemon start historyserver\n</code></pre> <p>4\uff09\u67e5\u770b\u5386\u53f2\u670d\u52a1\u5668\u662f\u5426\u542f\u52a8</p> <pre><code>jps\n</code></pre> <p>5\uff09\u67e5\u770b JobHistory</p> <p>http://hadoop102:19888/jobhistory</p>"},{"location":"hadoop/hdp_03/#327","title":"3.2.7 \u914d\u7f6e\u65e5\u5fd7\u7684\u805a\u96c6","text":"<p>\u65e5\u5fd7\u805a\u96c6\u6982\u5ff5\uff1a\u5e94\u7528\u8fd0\u884c\u5b8c\u6210\u4ee5\u540e\uff0c\u5c06\u7a0b\u5e8f\u8fd0\u884c\u65e5\u5fd7\u4fe1\u606f\u4e0a\u4f20\u5230 HDFS \u7cfb\u7edf\u4e0a\u3002</p> <p></p> <p>\u65e5\u5fd7\u805a\u96c6\u529f\u80fd\u597d\u5904\uff1a\u53ef\u4ee5\u65b9\u4fbf\u7684\u67e5\u770b\u5230\u7a0b\u5e8f\u8fd0\u884c\u8be6\u60c5\uff0c\u65b9\u4fbf\u5f00\u53d1\u8c03\u8bd5\u3002</p> <p>\u6ce8\u610f</p> <p>\u5f00\u542f\u65e5\u5fd7\u805a\u96c6\u529f\u80fd\uff0c\u9700\u8981\u91cd\u65b0\u542f\u52a8 NodeManager \u3001ResourceManager \u548c HistoryServer\u3002</p> <p>\u5f00\u542f\u65e5\u5fd7\u805a\u96c6\u529f\u80fd\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>1\uff09\u914d\u7f6e yarn-site.xml</p> yarn-site.xml<pre><code>&lt;!-- \u5f00\u542f\u65e5\u5fd7\u805a\u96c6\u529f\u80fd --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u8bbe\u7f6e\u65e5\u5fd7\u805a\u96c6\u670d\u52a1\u5668\u5730\u5740 --&gt;\n&lt;property&gt;  &lt;name&gt;yarn.log.server.url&lt;/name&gt;  &lt;value&gt;http://hadoop102:19888/jobhistory/logs&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u8bbe\u7f6e\u65e5\u5fd7\u4fdd\u7559\u65f6\u95f4\u4e3a7\u5929 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;\n&lt;value&gt;604800&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>2\uff09\u5206\u53d1\u914d\u7f6e</p> <pre><code>xsync $HADOOP_HOME/etc/hadoop/yarn-site.xml\n</code></pre> <p>3\uff09\u5173\u95ed NodeManager \u3001ResourceManager \u548c HistoryServer</p> <pre><code>sbin/stop-yarn.sh\nmapred --daemon stop historyserver\n</code></pre> <p>4\uff09\u542f\u52a8 NodeManager \u3001ResourceManage \u548c HistoryServer</p> <pre><code>start-yarn.sh\nmapred --daemon start historyserver\n</code></pre> <p>5\uff09\u5220\u9664 HDFS \u4e0a\u5df2\u7ecf\u5b58\u5728\u7684\u8f93\u51fa\u6587\u4ef6</p> <pre><code>hadoop fs -rm -r /output\n</code></pre> <p>6\uff09\u6267\u884c WordCount \u7a0b\u5e8f</p> <pre><code>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output\n</code></pre> <p>7\uff09\u67e5\u770b\u65e5\u5fd7</p> <p>\uff081\uff09\u5386\u53f2\u670d\u52a1\u5668\u5730\u5740</p> <p>http://hadoop102:19888/jobhistory</p> <p>\uff082\uff09\u5386\u53f2\u4efb\u52a1\u5217\u8868</p> <p></p> <p>\uff083\uff09\u67e5\u770b\u4efb\u52a1\u8fd0\u884c\u65e5\u5fd7</p> <p></p> <p>\uff084\uff09\u8fd0\u884c\u65e5\u5fd7\u8be6\u60c5</p> <p></p>"},{"location":"hadoop/hdp_03/#328","title":"3.2.8 \u96c6\u7fa4\u542f\u52a8/\u505c\u6b62\u65b9\u5f0f\u603b\u7ed3","text":"<p>1\uff09\u5404\u4e2a\u6a21\u5757\u5206\u5f00\u542f\u52a8/\u505c\u6b62\uff08\u914d\u7f6e ssh \u662f\u524d\u63d0\uff09</p> <p>\uff081\uff09\u6574\u4f53\u542f\u52a8/\u505c\u6b62 HDFS</p> <pre><code>start-dfs.sh/stop-dfs.sh\n</code></pre> <p>\uff082\uff09\u6574\u4f53\u542f\u52a8/\u505c\u6b62 YARN</p> <pre><code>start-yarn.sh/stop-yarn.sh\n</code></pre> <p>2\uff09\u5404\u4e2a\u670d\u52a1\u7ec4\u4ef6\u9010\u4e00\u542f\u52a8/\u505c\u6b62</p> <p>\uff081\uff09\u5206\u522b\u542f\u52a8/\u505c\u6b62 HDFS \u7ec4\u4ef6</p> <pre><code>hdfs --daemon start/stop namenode/datanode/secondarynamenode\n</code></pre> <p>\uff082\uff09\u542f\u52a8/\u505c\u6b62 YARN</p> <pre><code>yarn --daemon start/stop resourcemanager/nodemanager\n</code></pre>"},{"location":"hadoop/hdp_03/#329-hadoop","title":"3.2.9 \u7f16\u5199Hadoop\u96c6\u7fa4\u5e38\u7528\u811a\u672c","text":"<p>1\uff09Hadoop \u96c6\u7fa4\u542f\u505c\u811a\u672c\uff08\u5305\u542b HDFS\uff0cYarn\uff0cHistoryserver\uff09\uff1amyhadoop.sh</p> <pre><code>cd /home/atguigu/bin\nvim myhadoop.sh\n</code></pre> <p>\u8f93\u5165\u5982\u4e0b\u5185\u5bb9</p> myhadoop.sh<pre><code>#!/bin/bash\n\nif [ $# -lt 1 ]\nthen\necho \"No Args Input...\"\nexit ;\nfi\n\ncase $1 in\n\"start\")\necho \" =================== \u542f\u52a8 hadoop\u96c6\u7fa4 ===================\"\n\necho \" --------------- \u542f\u52a8 hdfs ---------------\"\nssh hadoop102 \"/opt/module/hadoop-3.1.3/sbin/start-dfs.sh\"\necho \" --------------- \u542f\u52a8 yarn ---------------\"\nssh hadoop103 \"/opt/module/hadoop-3.1.3/sbin/start-yarn.sh\"\necho \" --------------- \u542f\u52a8 historyserver ---------------\"\nssh hadoop102 \"/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver\"\n;;\n\"stop\")\necho \" =================== \u5173\u95ed hadoop\u96c6\u7fa4 ===================\"\n\necho \" --------------- \u5173\u95ed historyserver ---------------\"\nssh hadoop102 \"/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver\"\necho \" --------------- \u5173\u95ed yarn ---------------\"\nssh hadoop103 \"/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh\"\necho \" --------------- \u5173\u95ed hdfs ---------------\"\nssh hadoop102 \"/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh\"\n;;\n*)\necho \"Input Args Error...\"\n;;\nesac\n</code></pre> <p>\u4fdd\u5b58\u540e\u9000\u51fa\uff0c\u7136\u540e\u8d4b\u4e88\u811a\u672c\u6267\u884c\u6743\u9650</p> <pre><code>chmod +x myhadoop.sh\n</code></pre> <p>2\uff09\u67e5\u770b\u4e09\u53f0\u670d\u52a1\u5668 Java \u8fdb\u7a0b\u811a\u672c\uff1ajpsall</p> <pre><code>cd /home/atguigu/bin\nvim jpsall\n</code></pre> <p>\u8f93\u5165\u5982\u4e0b\u5185\u5bb9</p> jps<pre><code>#!/bin/bash\n\nfor host in hadoop102 hadoop103 hadoop104\ndo\necho =============== $host ===============\nssh $host jps done\n</code></pre> <p>\u4fdd\u5b58\u540e\u9000\u51fa\uff0c\u7136\u540e\u8d4b\u4e88\u811a\u672c\u6267\u884c\u6743\u9650</p> <pre><code>chmod +x jpsall\n</code></pre> <p>3\uff09\u5206\u53d1 /home/atguigu/bin \u76ee\u5f55\uff0c\u4fdd\u8bc1\u81ea\u5b9a\u4e49\u811a\u672c\u5728\u4e09\u53f0\u673a\u5668\u4e0a\u90fd\u53ef\u4ee5\u4f7f\u7528</p> <pre><code>xsync /home/atguigu/bin/\n</code></pre>"},{"location":"hadoop/hdp_03/#3210","title":"3.2.10 \u5e38\u7528\u7aef\u53e3\u53f7\u8bf4\u660e","text":"\u7aef\u53e3\u540d\u79f0 Hadoop2.x Hadoop3.x NameNode\u5185\u90e8\u901a\u4fe1\u7aef\u53e3 8020 / 9000 8020 / 9000/9820 NameNode HTTP UI 50070 9870 MapReduce\u67e5\u770b\u6267\u884c\u4efb\u52a1\u7aef\u53e3 8088 8088 \u5386\u53f2\u670d\u52a1\u5668\u901a\u4fe1\u7aef\u53e3 19888 19888"},{"location":"hadoop/hdp_03/#3211","title":"3.2.11 \u96c6\u7fa4\u65f6\u95f4\u540c\u6b65\uff08\u4e86\u89e3...\uff09","text":"<p>\u5982\u679c\u670d\u52a1\u5668\u5728\u516c\u7f51\u73af\u5883\uff08\u80fd\u8fde\u63a5\u5916\u7f51\uff09\uff0c\u53ef\u4ee5\u4e0d\u91c7\u7528\u96c6\u7fa4\u65f6\u95f4\u540c\u6b65\uff0c\u56e0\u4e3a\u670d\u52a1\u5668\u4f1a\u5b9a\u671f\u548c\u516c\u7f51\u65f6\u95f4\u8fdb\u884c\u6821\u51c6\uff1b</p> <p>\u5982\u679c\u670d\u52a1\u5668\u5728\u5185\u7f51\u73af\u5883\uff0c\u5fc5\u987b\u8981\u914d\u7f6e\u96c6\u7fa4\u65f6\u95f4\u540c\u6b65\uff0c\u5426\u5219\u65f6\u95f4\u4e45\u4e86\uff0c\u4f1a\u4ea7\u751f\u65f6\u95f4\u504f\u5dee\uff0c\u5bfc\u81f4\u96c6\u7fa4\u6267\u884c\u4efb\u52a1\u65f6\u95f4\u4e0d\u540c\u6b65\u3002</p> <p>1\uff09\u9700\u6c42</p> <p>\u627e\u4e00\u4e2a\u673a\u5668\uff0c\u4f5c\u4e3a\u65f6\u95f4\u670d\u52a1\u5668\uff0c\u6240\u6709\u7684\u673a\u5668\u4e0e\u8fd9\u53f0\u96c6\u7fa4\u65f6\u95f4\u8fdb\u884c\u5b9a\u65f6\u7684\u540c\u6b65\uff0c\u751f\u4ea7\u73af\u5883\u6839\u636e\u4efb\u52a1\u5bf9\u65f6\u95f4\u7684\u51c6\u786e\u7a0b\u5ea6\u8981\u6c42\u5468\u671f\u540c\u6b65\u3002\u6d4b\u8bd5\u73af\u5883\u4e3a\u4e86\u5c3d\u5feb\u770b\u5230\u6548\u679c\uff0c\u91c7\u7528 1 \u5206\u949f\u540c\u6b65\u4e00\u6b21\u3002</p> <p></p> <p>2\uff09\u65f6\u95f4\u670d\u52a1\u5668\u914d\u7f6e\uff08\u5fc5\u987b root \u7528\u6237\uff09</p> <p>\uff081\uff09\u67e5\u770b\u6240\u6709\u8282\u70b9 ntpd \u670d\u52a1\u72b6\u6001\u548c\u5f00\u673a\u81ea\u542f\u52a8\u72b6\u6001</p> <pre><code>sudo systemctl status ntpd\nsudo systemctl start ntpd\nsudo systemctl is-enabled ntpd\n</code></pre> <p>\uff082\uff09\u4fee\u6539 hadoop102 \u7684 ntp.conf \u914d\u7f6e\u6587\u4ef6</p> <pre><code>sudo vim /etc/ntp.conf\n</code></pre> <p>\u4fee\u6539\u5185\u5bb9\u5982\u4e0b</p> <p>\u2460\u4fee\u6539 1\uff08\u6388\u6743 192.168.10.0 - 192.168.10.255 \u7f51\u6bb5\u4e0a\u7684\u6240\u6709\u673a\u5668\u53ef\u4ee5\u4ece\u8fd9\u53f0\u673a\u5668\u4e0a\u67e5\u8be2\u548c\u540c\u6b65\u65f6\u95f4\uff09</p> ntp.conf<pre><code>#restrict 192.168.10.0 mask 255.255.255.0 nomodify notrap\nrestrict 192.168.10.0 mask 255.255.255.0 nomodify notrap\n</code></pre> <p>\u2461\u4fee\u6539 2\uff08\u96c6\u7fa4\u5728\u5c40\u57df\u7f51\u4e2d\uff0c\u4e0d\u4f7f\u7528\u5176\u4ed6\u4e92\u8054\u7f51\u4e0a\u7684\u65f6\u95f4\uff09</p> ntp.conf<pre><code>server 0.centos.pool.ntp.org iburst\nserver 1.centos.pool.ntp.org iburst\nserver 2.centos.pool.ntp.org iburst\nserver 3.centos.pool.ntp.org iburst\n\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\n</code></pre> <p>\u2462\u6dfb\u52a0 3\uff08\u5f53\u8be5\u8282\u70b9\u4e22\u5931\u7f51\u7edc\u8fde\u63a5\uff0c\u4f9d\u7136\u53ef\u4ee5\u91c7\u7528\u672c\u5730\u65f6\u95f4\u4f5c\u4e3a\u65f6\u95f4\u670d\u52a1\u5668\u4e3a\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u8282\u70b9\u63d0\u4f9b\u65f6\u95f4\u540c\u6b65\uff09</p> ntp.conf<pre><code>server 127.127.1.0\nfudge 127.127.1.0 stratum 10\n</code></pre> <p>\uff083\uff09\u4fee\u6539 hadoop102 \u7684 /etc/sysconfig/ntpd \u6587\u4ef6</p> <p>\u589e\u52a0\u5185\u5bb9\u5982\u4e0b\uff08\u8ba9\u786c\u4ef6\u65f6\u95f4\u4e0e\u7cfb\u7edf\u65f6\u95f4\u4e00\u8d77\u540c\u6b65\uff09</p> ntp.conf<pre><code>SYNC_HWCLOCK=yes\n</code></pre> <p>\uff084\uff09\u91cd\u65b0\u542f\u52a8 ntpd \u670d\u52a1</p> <pre><code>sudo systemctl start ntpd\n</code></pre> <p>\uff085\uff09\u8bbe\u7f6e ntpd \u670d\u52a1\u5f00\u673a\u542f\u52a8</p> <pre><code>sudo systemctl enable ntpd\n</code></pre> <p>3\uff09\u5176\u4ed6\u673a\u5668\u914d\u7f6e\uff08\u5fc5\u987b root \u7528\u6237\uff09</p> <p>\uff081\uff09\u5173\u95ed\u6240\u6709\u8282\u70b9\u4e0a ntp \u670d\u52a1\u548c\u81ea\u542f\u52a8</p> <pre><code>sudo systemctl stop ntpd\nsudo systemctl disable ntpd\n</code></pre> <p>\uff082\uff09\u5728\u5176\u4ed6\u673a\u5668\u914d\u7f6e 1 \u5206\u949f\u4e0e\u65f6\u95f4\u670d\u52a1\u5668\u540c\u6b65\u4e00\u6b21</p> <pre><code>sudo crontab -e\n</code></pre> <p>\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1\u5982\u4e0b\uff1a</p> <pre><code>*/1 * * * * /usr/sbin/ntpdate hadoop102\n</code></pre> <p>\uff083\uff09\u4fee\u6539\u4efb\u610f\u673a\u5668\u65f6\u95f4</p> <pre><code>sudo date -s \"2021-9-11 11:11:11\"\n</code></pre> <p>\uff084\uff091 \u5206\u949f\u540e\u67e5\u770b\u673a\u5668\u662f\u5426\u4e0e\u65f6\u95f4\u670d\u52a1\u5668\u540c\u6b65</p> <pre><code>sudo date\n</code></pre>"},{"location":"hadoop/hdp_04/","title":"\u7b2c4\u7ae0 \u5e38\u89c1\u9519\u8bef\u53ca\u89e3\u51b3\u65b9\u6848","text":"<p>1\uff09\u9632\u706b\u5899\u6ca1\u5173\u95ed\u3001\u6216\u8005\u6ca1\u6709\u542f\u52a8 YARN</p> <p><code>INFO client.RMProxy: Connecting to ResourceManager at hadoop108/192.168.10.108:8032</code></p> <p>2\uff09\u4e3b\u673a\u540d\u79f0\u914d\u7f6e\u9519\u8bef</p> <p>3\uff09IP \u5730\u5740\u914d\u7f6e\u9519\u8bef</p> <p>4\uff09ssh \u6ca1\u6709\u914d\u7f6e\u597d</p> <p>5\uff09root \u7528\u6237\u548c atguigu \u4e24\u4e2a\u7528\u6237\u542f\u52a8\u96c6\u7fa4\u4e0d\u7edf\u4e00</p> <p>6\uff09\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u4e0d\u7ec6\u5fc3</p> <p>7\uff09\u4e0d\u8bc6\u522b\u4e3b\u673a\u540d\u79f0</p> <pre><code>java.net.UnknownHostException: hadoop102: hadoop102\n        at java.net.InetAddress.getLocalHost(InetAddress.java:1475)\nat org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:146)\nat org.apache.hadoop.mapreduce.Job$10.run(Job.java:1290)\nat org.apache.hadoop.mapreduce.Job$10.run(Job.java:1287)\nat java.security.AccessController.doPrivileged(Native Method)\nat javax.security.auth.Subject.doAs(Subject.java:415)\n</code></pre> <p>\u89e3\u51b3\u529e\u6cd5\uff1a \uff081\uff09\u5728 /etc/hosts \u6587\u4ef6\u4e2d\u6dfb\u52a0 192.168.10.102 hadoop102</p> <p>\uff082\uff09\u4e3b\u673a\u540d\u79f0\u4e0d\u8981\u8d77 hadoop  hadoop000 \u7b49\u7279\u6b8a\u540d\u79f0</p> <p>8\uff09DataNode \u548c NameNode \u8fdb\u7a0b\u540c\u65f6\u53ea\u80fd\u5de5\u4f5c\u4e00\u4e2a\u3002</p> <p></p> <p>9\uff09\u6267\u884c\u547d\u4ee4\u4e0d\u751f\u6548\uff0c\u7c98\u8d34 Word \u4e2d\u547d\u4ee4\u65f6\uff0c\u9047\u5230 - \u548c\u957f \u2013 \u6ca1\u533a\u5206\u5f00\u3002\u5bfc\u81f4\u547d\u4ee4\u5931\u6548</p> <p>\u89e3\u51b3\u529e\u6cd5\uff1a\u5c3d\u91cf\u4e0d\u8981\u7c98\u8d34 Word \u4e2d\u4ee3\u7801\u3002</p> <p>10\uff09jps \u53d1\u73b0\u8fdb\u7a0b\u5df2\u7ecf\u6ca1\u6709\uff0c\u4f46\u662f\u91cd\u65b0\u542f\u52a8\u96c6\u7fa4\uff0c\u63d0\u793a\u8fdb\u7a0b\u5df2\u7ecf\u5f00\u542f\u3002</p> <p>\u539f\u56e0\u662f\u5728 Linux \u7684\u6839\u76ee\u5f55\u4e0b /tmp \u76ee\u5f55\u4e2d\u5b58\u5728\u542f\u52a8\u7684\u8fdb\u7a0b\u4e34\u65f6\u6587\u4ef6\uff0c\u5c06\u96c6\u7fa4\u76f8\u5173\u8fdb\u7a0b\u5220\u9664\u6389\uff0c\u518d\u91cd\u65b0\u542f\u52a8\u96c6\u7fa4\u3002</p> <p>11\uff09jps \u4e0d\u751f\u6548</p> <p>\u539f\u56e0\uff1a\u5168\u5c40\u53d8\u91cf hadoop java \u6ca1\u6709\u751f\u6548\u3002\u89e3\u51b3\u529e\u6cd5\uff1a\u9700\u8981 source /etc/profile \u6587\u4ef6\u3002</p> <p>12\uff098088 \u7aef\u53e3\u8fde\u63a5\u4e0d\u4e0a</p> <pre><code>cat /etc/hosts\n\n\u6ce8\u91ca\u6389\u5982\u4e0b\u4ee3\u7801\n#127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n#::1         hadoop102\n</code></pre>"},{"location":"hadoop/hdp_05/","title":"\u7b2c1\u7ae0 HDFS\u6982\u8ff0","text":""},{"location":"hadoop/hdp_05/#11-hdfs","title":"1.1 HDFS\u4ea7\u51fa\u80cc\u666f\u53ca\u5b9a\u4e49","text":"<p>1\uff09HDFS \u4ea7\u751f\u80cc\u666f</p> <p>\u968f\u7740\u6570\u636e\u91cf\u8d8a\u6765\u8d8a\u5927\uff0c\u5728\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5b58\u4e0d\u4e0b\u6240\u6709\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u5206\u914d\u5230\u66f4\u591a\u7684\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684\u78c1\u76d8\u4e2d\uff0c\u4f46\u662f\u4e0d\u65b9\u4fbf\u7ba1\u7406\u548c\u7ef4\u62a4\uff0c\u8feb\u5207\u9700\u8981\u4e00\u79cd\u7cfb\u7edf\u6765\u7ba1\u7406\u591a\u53f0\u673a\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u8fd9\u5c31\u662f\u5206\u5e03\u5f0f\u6587\u4ef6\u7ba1\u7406\u7cfb\u7edf\u3002HDFS \u53ea\u662f\u5206\u5e03\u5f0f\u6587\u4ef6\u7ba1\u7406\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\u3002</p> <p>2\uff09HDFS \u5b9a\u4e49</p> <p>HDFS\uff08Hadoop Distributed File System\uff09\uff0c\u5b83\u662f\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u4e8e\u5b58\u50a8\u6587\u4ef6\uff0c\u901a\u8fc7\u76ee\u5f55\u6811\u6765\u5b9a\u4f4d\u6587\u4ef6\uff1b\u5176\u6b21\uff0c\u5b83\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u7531\u5f88\u591a\u670d\u52a1\u5668\u8054\u5408\u8d77\u6765\u5b9e\u73b0\u5176\u529f\u80fd\uff0c\u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u5668\u6709\u5404\u81ea\u7684\u89d2\u8272\u3002</p> <p>HDFS \u7684\u4f7f\u7528\u573a\u666f\uff1a\u9002\u5408\u4e00\u6b21\u5199\u5165\uff0c\u591a\u6b21\u8bfb\u51fa\u7684\u573a\u666f\u3002\u4e00\u4e2a\u6587\u4ef6\u7ecf\u8fc7\u521b\u5efa\u3001\u5199\u5165\u548c\u5173\u95ed\u4e4b\u540e\u5c31\u4e0d\u9700\u8981\u6539\u53d8\u3002</p>"},{"location":"hadoop/hdp_05/#12-hdfs","title":"1.2 HDFS \u4f18\u7f3a\u70b9","text":"HDFS\u4f18\u70b9 HDFS\u7f3a\u70b9"},{"location":"hadoop/hdp_05/#13-hdfs","title":"1.3 HDFS\u7ec4\u6210\u67b6\u6784","text":""},{"location":"hadoop/hdp_05/#14-hdfs","title":"1.4 HDFS\u6587\u4ef6\u5757\u5927\u5c0f\uff08\u9762\u8bd5\u91cd\u70b9\uff09","text":""},{"location":"hadoop/hdp_06/","title":"\u7b2c2\u7ae0 HDFS\u7684Shell\u64cd\u4f5c\uff08\u5f00\u53d1\u91cd\u70b9\uff09","text":""},{"location":"hadoop/hdp_06/#21","title":"2.1 \u57fa\u672c\u8bed\u6cd5","text":"<p><code>hadoop fs \u5177\u4f53\u547d\u4ee4</code>  \u6216  <code>hdfs dfs \u5177\u4f53\u547d\u4ee4</code></p> <p>\u4e24\u4e2a\u662f\u5b8c\u5168\u76f8\u540c\u7684\u3002</p>"},{"location":"hadoop/hdp_06/#22","title":"2.2 \u547d\u4ee4\u5927\u5168","text":"<pre><code>$ bin/hadoop fs\n\n[-appendToFile &lt;localsrc&gt; ... &lt;dst&gt;]\n        [-cat [-ignoreCrc] &lt;src&gt; ...]\n        [-chgrp [-R] GROUP PATH...]\n        [-chmod [-R] &lt;MODE[,MODE]... | OCTALMODE&gt; PATH...]\n        [-chown [-R] [OWNER][:[GROUP]] PATH...]\n        [-copyFromLocal [-f] [-p] &lt;localsrc&gt; ... &lt;dst&gt;]\n        [-copyToLocal [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]\n        [-count [-q] &lt;path&gt; ...]\n        [-cp [-f] [-p] &lt;src&gt; ... &lt;dst&gt;]\n        [-df [-h] [&lt;path&gt; ...]]\n        [-du [-s] [-h] &lt;path&gt; ...]\n        [-get [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]\n        [-getmerge [-nl] &lt;src&gt; &lt;localdst&gt;]\n        [-help [cmd ...]]\n        [-ls [-d] [-h] [-R] [&lt;path&gt; ...]]\n        [-mkdir [-p] &lt;path&gt; ...]\n        [-moveFromLocal &lt;localsrc&gt; ... &lt;dst&gt;]\n        [-moveToLocal &lt;src&gt; &lt;localdst&gt;]\n        [-mv &lt;src&gt; ... &lt;dst&gt;]\n        [-put [-f] [-p] &lt;localsrc&gt; ... &lt;dst&gt;]\n        [-rm [-f] [-r|-R] [-skipTrash] &lt;src&gt; ...]\n        [-rmdir [--ignore-fail-on-non-empty] &lt;dir&gt; ...]\n&lt;acl_spec&gt; &lt;path&gt;]]\n        [-setrep [-R] [-w] &lt;rep&gt; &lt;path&gt; ...]\n        [-stat [format] &lt;path&gt; ...]\n        [-tail [-f] &lt;file&gt;]\n        [-test -[defsz] &lt;path&gt;]\n        [-text [-ignoreCrc] &lt;src&gt; ...]\n</code></pre>"},{"location":"hadoop/hdp_06/#23","title":"2.3 \u5e38\u7528\u547d\u4ee4\u5b9e\u64cd","text":""},{"location":"hadoop/hdp_06/#231","title":"2.3.1 \u51c6\u5907\u5de5\u4f5c","text":"<p>1\uff09\u542f\u52a8 Hadoop \u96c6\u7fa4\uff08\u65b9\u4fbf\u540e\u7eed\u7684\u6d4b\u8bd5\uff09</p> <pre><code>sbin/start-dfs.sh\nsbin/start-yarn.sh\n</code></pre> <p>2\uff09-help\uff1a\u8f93\u51fa\u8fd9\u4e2a\u547d\u4ee4\u53c2\u6570</p> <pre><code>hadoop fs -help rm\n</code></pre> <p>3\uff09\u521b\u5efa /sanguo \u6587\u4ef6\u5939</p> <pre><code>hadoop fs -mkdir /sanguo\n</code></pre>"},{"location":"hadoop/hdp_06/#232","title":"2.3.2 \u4e0a\u4f20","text":"<p>1\uff09-moveFromLocal\uff1a\u4ece\u672c\u5730\u526a\u5207\u7c98\u8d34\u5230 HDFS</p> <pre><code>hadoop fs  -moveFromLocal  ./shuguo.txt  /sanguo\n</code></pre> <p>2\uff09-copyFromLocal\uff1a\u4ece\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e2d\u62f7\u8d1d\u6587\u4ef6\u5230 HDFS \u8def\u5f84\u53bb</p> <pre><code>hadoop fs -copyFromLocal weiguo.txt /sanguo\n</code></pre> <p>3\uff09-put\uff1a\u7b49\u540c\u4e8e copyFromLocal\uff0c\u751f\u4ea7\u73af\u5883\u66f4\u4e60\u60ef\u7528 put</p> <pre><code>hadoop fs -put ./wuguo.txt /sanguo\n</code></pre> <p>4\uff09-appendToFile\uff1a\u8ffd\u52a0\u4e00\u4e2a\u6587\u4ef6\u5230\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u672b\u5c3e</p> <pre><code>hadoop fs -appendToFile liubei.txt /sanguo/shuguo.txt\n</code></pre>"},{"location":"hadoop/hdp_06/#233","title":"2.3.3 \u4e0b\u8f7d","text":"<p>1\uff09-copyToLocal\uff1a\u4ece HDFS \u62f7\u8d1d\u5230\u672c\u5730</p> <pre><code>hadoop fs -copyToLocal /sanguo/shuguo.txt ./\n</code></pre> <p>2\uff09-get\uff1a\u7b49\u540c\u4e8e copyToLocal\uff0c\u751f\u4ea7\u73af\u5883\u66f4\u4e60\u60ef\u7528 get</p> <pre><code>hadoop fs -get /sanguo/shuguo.txt ./shuguo2.txt\n</code></pre>"},{"location":"hadoop/hdp_06/#234-hdfs","title":"2.3.4 HDFS\u76f4\u63a5\u64cd\u4f5c","text":"<p>1\uff09-ls: \u663e\u793a\u76ee\u5f55\u4fe1\u606f</p> <pre><code>hadoop fs -ls /sanguo\n</code></pre> <p>2\uff09-cat\uff1a\u663e\u793a\u6587\u4ef6\u5185\u5bb9</p> <pre><code>hadoop fs -cat /sanguo/shuguo.txt\n</code></pre> <p>3\uff09-chgrp\u3001-chmod\u3001-chown\uff1aLinux \u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u7528\u6cd5\u4e00\u6837\uff0c\u4fee\u6539\u6587\u4ef6\u6240\u5c5e\u6743\u9650</p> <pre><code>hadoop fs  -chmod 666  /sanguo/shuguo.txt\nhadoop fs  -chown  atguigu:atguigu   /sanguo/shuguo.txt\n</code></pre> <p>4\uff09-mkdir\uff1a\u521b\u5efa\u8def\u5f84</p> <pre><code>hadoop fs -mkdir /jinguo\n</code></pre> <p>5\uff09-cp\uff1a\u4ece HDFS \u7684\u4e00\u4e2a\u8def\u5f84\u62f7\u8d1d\u5230 HDFS \u7684\u53e6\u4e00\u4e2a\u8def\u5f84</p> <pre><code>hadoop fs -cp /sanguo/shuguo.txt /jinguo\n</code></pre> <p>6\uff09-mv\uff1a\u5728 HDFS \u76ee\u5f55\u4e2d\u79fb\u52a8\u6587\u4ef6</p> <pre><code>hadoop fs -mv /sanguo/wuguo.txt /jinguo\nhadoop fs -mv /sanguo/weiguo.txt /jinguo\n</code></pre> <p>7\uff09-tail\uff1a\u663e\u793a\u4e00\u4e2a\u6587\u4ef6\u7684\u672b\u5c3e 1kb \u7684\u6570\u636e</p> <pre><code>hadoop fs -tail /jinguo/shuguo.txt\n</code></pre> <p>8\uff09-rm\uff1a\u5220\u9664\u6587\u4ef6\u6216\u6587\u4ef6\u5939</p> <pre><code>hadoop fs -rm /sanguo/shuguo.txt\n</code></pre> <p>9\uff09-rm -r\uff1a\u9012\u5f52\u5220\u9664\u76ee\u5f55\u53ca\u76ee\u5f55\u91cc\u9762\u5185\u5bb9</p> <pre><code>hadoop fs -rm -r /sanguo\n</code></pre> <p>10\uff09-du\uff1a\u7edf\u8ba1\u6587\u4ef6\u5939\u7684\u5927\u5c0f\u4fe1\u606f</p> <pre><code>hadoop fs -du -s -h /jinguo\n\n14  42  /jinguo/shuguo.txt\n7   21   /jinguo/weiguo.txt\n6   18   /jinguo/wuguo.tx\n</code></pre> <p>\u8bf4\u660e</p> <p>27 \u8868\u793a\u6587\u4ef6\u5927\u5c0f\uff1b81 \u8868\u793a 27 * 3 \u4e2a\u526f\u672c\uff1b/jinguo \u8868\u793a\u67e5\u770b\u7684\u76ee\u5f55</p> <p>11\uff09-setrep\uff1a\u8bbe\u7f6e HDFS \u4e2d\u6587\u4ef6\u7684\u526f\u672c\u6570\u91cf</p> <pre><code>hadoop fs -setrep 10 </code></pre> <p></p> <p>\u8fd9\u91cc\u8bbe\u7f6e\u7684\u526f\u672c\u6570\u53ea\u662f\u8bb0\u5f55\u5728 NameNode \u7684\u5143\u6570\u636e\u4e2d\uff0c\u662f\u5426\u771f\u7684\u4f1a\u6709\u8fd9\u4e48\u591a\u526f\u672c\uff0c\u8fd8\u5f97\u770b DataNode \u7684\u6570\u91cf\u3002\u56e0\u4e3a\u76ee\u524d\u53ea\u6709 3 \u53f0\u8bbe\u5907\uff0c\u6700\u591a\u4e5f\u5c31 3 \u4e2a\u526f\u672c\uff0c\u53ea\u6709\u8282\u70b9\u6570\u7684\u589e\u52a0\u5230 10 \u53f0\u65f6\uff0c\u526f\u672c\u6570\u624d\u80fd\u8fbe\u5230 10\u3002</p>"},{"location":"hadoop/hdp_07/","title":"\u7b2c3\u7ae0 HDFS\u7684API\u64cd\u4f5c","text":""},{"location":"hadoop/hdp_07/#31","title":"3.1 \u5ba2\u6237\u7aef\u73af\u5883\u51c6\u5907","text":"<p>1\uff09\u627e\u5230\u8d44\u6599\u5305\u8def\u5f84\u4e0b\u7684 Windows \u4f9d\u8d56\u6587\u4ef6\u5939\uff0c\u62f7\u8d1d hadoop-3.1.0 \u5230\u975e\u4e2d\u6587\u8def\u5f84\uff08\u6bd4\u5982 d:\\\uff09\u3002</p> <p>2\uff09\u914d\u7f6e HADOOP_HOME \u73af\u5883\u53d8\u91cf</p> <p></p> <p>3\uff09\u914d\u7f6e Path \u73af\u5883\u53d8\u91cf\u3002</p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u73af\u5883\u53d8\u91cf\u4e0d\u8d77\u4f5c\u7528\uff0c\u53ef\u4ee5\u91cd\u542f\u7535\u8111\u8bd5\u8bd5\u3002</p> <p></p> <p>\u9a8c\u8bc1 Hadoop \u73af\u5883\u53d8\u91cf\u662f\u5426\u6b63\u5e38\u3002\u53cc\u51fb winutils.exe\uff0c\u5982\u679c\u62a5\u5982\u4e0b\u9519\u8bef\u3002\u8bf4\u660e\u7f3a\u5c11\u5fae\u8f6f\u8fd0\u884c\u5e93\uff08\u6b63\u7248\u7cfb\u7edf\u5f80\u5f80\u6709\u8fd9\u4e2a\u95ee\u9898\uff09\u3002\u518d\u8d44\u6599\u5305\u91cc\u9762\u6709\u5bf9\u5e94\u7684\u5fae\u8f6f\u8fd0\u884c\u5e93\u5b89\u88c5\u5305\u53cc\u51fb\u5b89\u88c5\u5373\u53ef\u3002</p> <p></p> <p>4\uff09\u5728 IDEA \u4e2d\u521b\u5efa\u4e00\u4e2a Maven \u5de5\u7a0b HdfsClientDemo\uff0c\u5e76\u5bfc\u5165\u76f8\u5e94\u7684\u4f9d\u8d56\u5750\u6807+\u65e5\u5fd7\u6dfb\u52a0</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n&lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;version&gt;4.12&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;\n&lt;version&gt;1.7.30&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>\u5728\u9879\u76ee\u7684 src/main/resources \u76ee\u5f55\u4e0b\uff0c\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u547d\u540d\u4e3a <code>log4j.properties</code>\uff0c\u5728\u6587\u4ef6\u4e2d\u586b\u5165</p> log4j.properties<pre><code>log4j.rootLogger=INFO, stdout  \nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender  \nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout  \nlog4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n  \nlog4j.appender.logfile=org.apache.log4j.FileAppender  \nlog4j.appender.logfile.File=target/spring.log  \nlog4j.appender.logfile.layout=org.apache.log4j.PatternLayout  \nlog4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n\n</code></pre> <p>5\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.hdfs</p> <p>6\uff09\u521b\u5efa HdfsClient \u7c7b</p> <pre><code>public class HdfsClient {\n\n@Test\npublic void testMkdirs() throws IOException, URISyntaxException, InterruptedException {\n\n// 1 \u83b7\u53d6\u6587\u4ef6\u7cfb\u7edf\nConfiguration configuration = new Configuration();\n\n// FileSystem fs = FileSystem.get(new URI(\"hdfs://hadoop102:8020\"), configuration);\nFileSystem fs = FileSystem.get(new URI(\"hdfs://hadoop102:8020\"), configuration,\"atguigu\");\n\n// 2 \u521b\u5efa\u76ee\u5f55\nfs.mkdirs(new Path(\"/xiyou/huaguoshan/\"));\n\n// 3 \u5173\u95ed\u8d44\u6e90\nfs.close();\n}\n}\n</code></pre> <p>7\uff09\u6267\u884c\u7a0b\u5e8f</p> <p>\u5ba2\u6237\u7aef\u53bb\u64cd\u4f5c HDFS \u65f6\uff0c\u662f\u6709\u4e00\u4e2a\u7528\u6237\u8eab\u4efd\u7684\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cHDFS \u5ba2\u6237\u7aef API \u4f1a\u4ece\u91c7\u7528 Windows \u9ed8\u8ba4\u7528\u6237\u8bbf\u95ee HDFS\uff0c\u4f1a\u62a5\u6743\u9650\u5f02\u5e38\u9519\u8bef\u3002\u6240\u4ee5\u5728\u8bbf\u95ee HDFS \u65f6\uff0c\u4e00\u5b9a\u8981\u914d\u7f6e\u7528\u6237\u3002</p> <pre><code>org.apache.hadoop.security.AccessControlException: Permission denied: user=56576, access=WRITE, inode=\"/xiyou/huaguoshan\":atguigu:supergroup:drwxr-xr-x\n</code></pre>"},{"location":"hadoop/hdp_07/#32-hdfsapi","title":"3.2 HDFS\u7684API\u6848\u4f8b\u5b9e\u64cd","text":""},{"location":"hadoop/hdp_07/#321-hdfs","title":"3.2.1 HDFS\u6587\u4ef6\u4e0a\u4f20\uff08\u6d4b\u8bd5\u53c2\u6570\u4f18\u5148\u7ea7\uff09","text":"<p>1\uff09\u7f16\u5199\u6e90\u4ee3\u7801</p> <pre><code>@Test\npublic void testCopyFromLocalFile() throws IOException, InterruptedException, URISyntaxException {\n\n// 1 \u83b7\u53d6\u6587\u4ef6\u7cfb\u7edf\nConfiguration configuration = new Configuration();\nconfiguration.set(\"dfs.replication\", \"2\");\nFileSystem fs = FileSystem.get(new URI(\"hdfs://hadoop102:8020\"), configuration, \"atguigu\");\n\n// 2 \u4e0a\u4f20\u6587\u4ef6\nfs.copyFromLocalFile(new Path(\"d:/sunwukong.txt\"), new Path(\"/xiyou/huaguoshan\"));\n\n// 3 \u5173\u95ed\u8d44\u6e90\nfs.close();\n\uff5d\n</code></pre> <p>2\uff09\u5c06 hdfs-site.xml \u62f7\u8d1d\u5230\u9879\u76ee\u7684 resources \u8d44\u6e90\u76ee\u5f55\u4e0b</p> hdfs-site.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n\n&lt;configuration&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.replication&lt;/name&gt;\n&lt;value&gt;1&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>3\uff09\u53c2\u6570\u4f18\u5148\u7ea7</p> <p>\u53c2\u6570\u4f18\u5148\u7ea7\u6392\u5e8f\uff1a\u5ba2\u6237\u7aef\u4ee3\u7801\u4e2d\u8bbe\u7f6e\u7684\u503c &gt; ClassPath \u4e0b\u7684\u7528\u6237\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6 &gt; \u7136\u540e\u662f\u670d\u52a1\u5668\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e\uff08xxx-site.xml\uff09 &gt; \u670d\u52a1\u5668\u7684\u9ed8\u8ba4\u914d\u7f6e\uff08xxx-default.xml\uff09</p>"},{"location":"hadoop/hdp_07/#322-hdfs","title":"3.2.2 HDFS\u6587\u4ef6\u4e0b\u8f7d","text":"<pre><code>@Test\npublic void testCopyToLocalFile() throws IOException, InterruptedException, URISyntaxException{\n\n// 1 \u83b7\u53d6\u6587\u4ef6\u7cfb\u7edf\nConfiguration configuration = new Configuration();\nFileSystem fs = FileSystem.get(new URI(\"hdfs://hadoop102:8020\"), configuration, \"atguigu\");\n\n// 2 \u6267\u884c\u4e0b\u8f7d\u64cd\u4f5c\n// boolean delSrc \u6307\u662f\u5426\u5c06\u539f\u6587\u4ef6\u5220\u9664\n// Path src \u6307\u8981\u4e0b\u8f7d\u7684\u6587\u4ef6\u8def\u5f84\n// Path dst \u6307\u5c06\u6587\u4ef6\u4e0b\u8f7d\u5230\u7684\u8def\u5f84\n// boolean useRawLocalFileSystem \u662f\u5426\u5f00\u542f\u6587\u4ef6\u6821\u9a8c\nfs.copyToLocalFile(false, new Path(\"/xiyou/huaguoshan/sunwukong.txt\"), new Path(\"d:/sunwukong2.txt\"), true);\n\n// 3 \u5173\u95ed\u8d44\u6e90\nfs.close();\n}\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u6267\u884c\u4e0a\u9762\u4ee3\u7801\uff0c\u4e0b\u8f7d\u4e0d\u4e86\u6587\u4ef6\uff0c\u6709\u53ef\u80fd\u662f\u4f60\u7535\u8111\u7684\u5fae\u8f6f\u652f\u6301\u7684\u8fd0\u884c\u5e93\u5c11\uff0c\u9700\u8981\u5b89\u88c5\u4e00\u4e0b\u5fae\u8f6f\u8fd0\u884c\u5e93\u3002</p>"},{"location":"hadoop/hdp_08/","title":"\u7b2c4\u7ae0 HDFS\u7684\u8bfb\u5199\u6d41\u7a0b\uff08\u9762\u8bd5\u91cd\u70b9\uff09","text":""},{"location":"hadoop/hdp_08/#41-hdfs","title":"4.1 HDFS\u5199\u6570\u636e\u6d41\u7a0b","text":""},{"location":"hadoop/hdp_08/#411","title":"4.1.1 \u5256\u6790\u6587\u4ef6\u5199\u5165","text":"<p>\uff081\uff09\u5ba2\u6237\u7aef\u901a\u8fc7 Distributed FileSystem \u6a21\u5757\u5411 NameNode \u8bf7\u6c42\u4e0a\u4f20\u6587\u4ef6\uff0cNameNode \u68c0\u67e5\u76ee\u6807\u6587\u4ef6\u662f\u5426\u5df2\u5b58\u5728\uff0c\u7236\u76ee\u5f55\u662f\u5426\u5b58\u5728\u3002</p> <p>\uff082\uff09NameNode \u8fd4\u56de\u662f\u5426\u53ef\u4ee5\u4e0a\u4f20\u3002</p> <p>\uff083\uff09\u5ba2\u6237\u7aef\u8bf7\u6c42\u7b2c\u4e00\u4e2a  Block \u4e0a\u4f20\u5230\u54ea\u51e0\u4e2a DataNode \u670d\u52a1\u5668\u4e0a\u3002</p> <p>\uff084\uff09NameNode \u8fd4\u56de 3 \u4e2a DataNode \u8282\u70b9\uff0c\u5206\u522b\u4e3a dn1\u3001dn2\u3001dn3\u3002</p> <p>\uff085\uff09\u5ba2\u6237\u7aef\u901a\u8fc7 FSDataOutputStream \u6a21\u5757\u8bf7\u6c42 dn1 \u4e0a\u4f20\u6570\u636e\uff0cdn1 \u6536\u5230\u8bf7\u6c42\u4f1a\u7ee7\u7eed\u8c03\u7528 dn2\uff0c\u7136\u540e dn2 \u8c03\u7528 dn3\uff0c\u5c06\u8fd9\u4e2a\u901a\u4fe1\u7ba1\u9053\u5efa\u7acb\u5b8c\u6210\u3002</p> <p>\uff086\uff09dn1\u3001dn2\u3001dn3 \u9010\u7ea7\u5e94\u7b54\u5ba2\u6237\u7aef\u3002</p> <p>\uff087\uff09\u5ba2\u6237\u7aef\u5f00\u59cb\u5f80 dn1 \u4e0a\u4f20\u7b2c\u4e00\u4e2a Block\uff08\u5148\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\u653e\u5230\u4e00\u4e2a\u672c\u5730\u5185\u5b58\u7f13\u5b58\uff09\uff0c\u4ee5 Packet \u4e3a\u5355\u4f4d\uff0cdn1 \u6536\u5230\u4e00\u4e2a Packet \u5c31\u4f1a\u4f20\u7ed9 dn2\uff0cdn2 \u4f20\u7ed9 dn3\uff1bdn1 \u6bcf\u4f20\u4e00\u4e2a packet \u4f1a\u653e\u5165\u4e00\u4e2a\u5e94\u7b54\u961f\u5217\u7b49\u5f85\u5e94\u7b54\u3002</p> <p>\uff088\uff09\u5f53\u4e00\u4e2a Block \u4f20\u8f93\u5b8c\u6210\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6b21\u8bf7\u6c42 NameNode \u4e0a\u4f20\u7b2c\u4e8c\u4e2a Block \u7684\u670d\u52a1\u5668\u3002\uff08\u91cd\u590d\u6267\u884c3-7\u6b65\uff09\u3002</p>"},{"location":"hadoop/hdp_08/#412-","title":"4.1.2 \u7f51\u7edc\u62d3\u6251-\u8282\u70b9\u8ddd\u79bb\u8ba1\u7b97","text":"<p>\u5728 HDFS \u5199\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\uff0cNameNode \u4f1a\u9009\u62e9\u8ddd\u79bb\u5f85\u4e0a\u4f20\u6570\u636e\u6700\u8fd1\u8ddd\u79bb\u7684 DataNode \u63a5\u6536\u6570\u636e\u3002\u90a3\u4e48\u8fd9\u4e2a\u6700\u8fd1\u8ddd\u79bb\u600e\u4e48\u8ba1\u7b97\u5462\uff1f</p> <p>\u8282\u70b9\u8ddd\u79bb\uff1a\u4e24\u4e2a\u8282\u70b9\u5230\u8fbe\u6700\u8fd1\u7684\u5171\u540c\u7956\u5148\u7684\u8ddd\u79bb\u603b\u548c\u3002</p> <p></p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u6709\u6570\u636e\u4e2d\u5fc3 d1 \u673a\u67b6 r1 \u4e2d\u7684\u8282\u70b9 n1\u3002\u8be5\u8282\u70b9\u53ef\u4ee5\u8868\u793a\u4e3a /d1/r1/n1\u3002\u5229\u7528\u8fd9\u79cd\u6807\u8bb0\uff0c\u8fd9\u91cc\u7ed9\u51fa\u56db\u79cd\u8ddd\u79bb\u63cf\u8ff0\u3002</p> <p>\u5927\u5bb6\u7b97\u4e00\u7b97\u6bcf\u4e24\u4e2a\u8282\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002</p> <p></p>"},{"location":"hadoop/hdp_08/#413","title":"4.1.3 \u673a\u67b6\u611f\u77e5\uff08\u526f\u672c\u5b58\u50a8\u8282\u70b9\u9009\u62e9\uff09","text":"<p>1\uff09\u673a\u67b6\u611f\u77e5\u8bf4\u660e</p> <p>\uff081\uff09\u5b98\u65b9\u8bf4\u660e</p> <p>For the common case, when the replication factor is three, HDFS\u2019s placement policy is to put one replica on the local machine if the writer is on a datanode, otherwise on a random datanode, another replica on a node in a different (remote) rack, and the last on a different node in the same remote rack. This policy cuts the inter-rack write traffic which generally improves write performance. The chance of rack failure is far less than that of node failure; this policy does not impact data reliability and availability guarantees. However, it does reduce the aggregate network bandwidth used when reading data since a block is placed in only two unique racks rather than three. With this policy, the replicas of a file do not evenly distribute across the racks. One third of replicas are on one node, two thirds of replicas are on one rack, and the other third are evenly distributed across the remaining racks. This policy improves write performance without compromising data reliability or read performance.</p> <p>\uff082\uff09\u6e90\u7801\u8bf4\u660e</p> <p>++Crtl + N++ \u67e5\u627e BlockPlacementPolicyDefault\uff0c\u5728\u8be5\u7c7b\u4e2d\u67e5\u627e chooseTargetInOrder \u65b9\u6cd5\u3002</p> <p>2\uff09Hadoop3.1.3 \u526f\u672c\u8282\u70b9\u9009\u62e9</p> <p></p>"},{"location":"hadoop/hdp_08/#42-hdfs","title":"4.2 HDFS\u8bfb\u6570\u636e\u6d41\u7a0b","text":"<p>\uff081\uff09\u5ba2\u6237\u7aef\u901a\u8fc7 DistributedFileSystem \u5411 NameNode \u8bf7\u6c42\u4e0b\u8f7d\u6587\u4ef6\uff0cNameNode \u901a\u8fc7\u67e5\u8be2\u5143\u6570\u636e\uff0c\u627e\u5230\u6587\u4ef6\u5757\u6240\u5728\u7684 DataNode \u5730\u5740\u3002</p> <p>\uff082\uff09\u6311\u9009\u4e00\u53f0 DataNode\uff08\u5c31\u8fd1\u539f\u5219\uff0c\u7136\u540e\u968f\u673a\uff09\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u8bfb\u53d6\u6570\u636e\u3002</p> <p>\uff083\uff09DataNode \u5f00\u59cb\u4f20\u8f93\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\uff08\u4ece\u78c1\u76d8\u91cc\u9762\u8bfb\u53d6\u6570\u636e\u8f93\u5165\u6d41\uff0c\u4ee5 Packet \u4e3a\u5355\u4f4d\u6765\u505a\u6821\u9a8c\uff09\u3002</p> <p>\uff084\uff09\u5ba2\u6237\u7aef\u4ee5 Packet \u4e3a\u5355\u4f4d\u63a5\u6536\uff0c\u5148\u5728\u672c\u5730\u7f13\u5b58\uff0c\u7136\u540e\u5199\u5165\u76ee\u6807\u6587\u4ef6\u3002</p>"},{"location":"hadoop/hdp_09/","title":"\u7b2c5\u7ae0 NameNode\u548cSecondaryNameNode","text":""},{"location":"hadoop/hdp_09/#51-nn2nn","title":"5.1 NN\u548c2NN\u5de5\u4f5c\u673a\u5236","text":"<p>\u601d\u8003</p> <p>NameNode \u4e2d\u7684\u5143\u6570\u636e\u662f\u5b58\u50a8\u5728\u54ea\u91cc\u7684\uff1f</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u505a\u4e2a\u5047\u8bbe\uff0c\u5982\u679c\u5b58\u50a8\u5728 NameNode \u8282\u70b9\u7684\u78c1\u76d8\u4e2d\uff0c\u56e0\u4e3a\u7ecf\u5e38\u9700\u8981\u8fdb\u884c\u968f\u673a\u8bbf\u95ee\uff0c\u8fd8\u6709\u54cd\u5e94\u5ba2\u6237\u8bf7\u6c42\uff0c\u5fc5\u7136\u662f\u6548\u7387\u8fc7\u4f4e\u3002\u56e0\u6b64\uff0c\u5143\u6570\u636e\u9700\u8981\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u3002\u4f46\u5982\u679c\u53ea\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4e00\u65e6\u65ad\u7535\uff0c\u5143\u6570\u636e\u4e22\u5931\uff0c\u6574\u4e2a\u96c6\u7fa4\u5c31\u65e0\u6cd5\u5de5\u4f5c\u4e86\u3002\u56e0\u6b64\u4ea7\u751f\u5728\u78c1\u76d8\u4e2d\u5907\u4efd\u5143\u6570\u636e\u7684 FsImage\u3002</p> <p>\u8fd9\u6837\u53c8\u4f1a\u5e26\u6765\u65b0\u7684\u95ee\u9898\uff0c\u5f53\u5728\u5185\u5b58\u4e2d\u7684\u5143\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u5982\u679c\u540c\u65f6\u66f4\u65b0 FsImage\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6548\u7387\u8fc7\u4f4e\uff0c\u4f46\u5982\u679c\u4e0d\u66f4\u65b0\uff0c\u5c31\u4f1a\u53d1\u751f\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u4e00\u65e6 NameNode \u8282\u70b9\u65ad\u7535\uff0c\u5c31\u4f1a\u4ea7\u751f\u6570\u636e\u4e22\u5931\u3002\u56e0\u6b64\uff0c\u5f15\u5165 Edits \u6587\u4ef6\uff08\u53ea\u8fdb\u884c\u8ffd\u52a0\u64cd\u4f5c\uff0c\u6548\u7387\u5f88\u9ad8\uff09\u3002\u6bcf\u5f53\u5143\u6570\u636e\u6709\u66f4\u65b0\u6216\u8005\u6dfb\u52a0\u5143\u6570\u636e\u65f6\uff0c\u4fee\u6539\u5185\u5b58\u4e2d\u7684\u5143\u6570\u636e\u5e76\u8ffd\u52a0\u5230 Edits \u4e2d\u3002\u8fd9\u6837\uff0c\u4e00\u65e6 NameNode \u8282\u70b9\u65ad\u7535\uff0c\u53ef\u4ee5\u901a\u8fc7 FsImage \u548c Edits \u7684\u5408\u5e76\uff0c\u5408\u6210\u5143\u6570\u636e\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u957f\u65f6\u95f4\u6dfb\u52a0\u6570\u636e\u5230Edits\u4e2d\uff0c\u4f1a\u5bfc\u81f4\u8be5\u6587\u4ef6\u6570\u636e\u8fc7\u5927\uff0c\u6548\u7387\u964d\u4f4e\uff0c\u800c\u4e14\u4e00\u65e6\u65ad\u7535\uff0c\u6062\u590d\u5143\u6570\u636e\u9700\u8981\u7684\u65f6\u95f4\u8fc7\u957f\u3002\u56e0\u6b64\uff0c\u9700\u8981\u5b9a\u671f\u8fdb\u884c FsImage \u548c Edits \u7684\u5408\u5e76\uff0c\u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u7531 NameNode \u8282\u70b9\u5b8c\u6210\uff0c\u53c8\u4f1a\u6548\u7387\u8fc7\u4f4e\u3002\u56e0\u6b64\uff0c\u5f15\u5165\u4e00\u4e2a\u65b0\u7684\u8282\u70b9 SecondaryNamenode\uff0c\u4e13\u95e8\u7528\u4e8e FsImage \u548c Edits \u7684\u5408\u5e76\u3002</p> <p></p> <p>1\uff09\u7b2c\u4e00\u9636\u6bb5\uff1aNameNode \u542f\u52a8</p> <p>\uff081\uff09\u7b2c\u4e00\u6b21\u542f\u52a8 NameNode \u683c\u5f0f\u5316\u540e\uff0c\u521b\u5efa Fsimage \u548c Edits \u6587\u4ef6\u3002\u5982\u679c\u4e0d\u662f\u7b2c\u4e00\u6b21\u542f\u52a8\uff0c\u76f4\u63a5\u52a0\u8f7d\u7f16\u8f91\u65e5\u5fd7\u548c\u955c\u50cf\u6587\u4ef6\u5230\u5185\u5b58\u3002</p> <p>\uff082\uff09\u5ba2\u6237\u7aef\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u7684\u8bf7\u6c42\u3002</p> <p>\uff083\uff09NameNode \u8bb0\u5f55\u64cd\u4f5c\u65e5\u5fd7\uff0c\u66f4\u65b0\u6eda\u52a8\u65e5\u5fd7\u3002</p> <p>\uff084\uff09NameNode \u5728\u5185\u5b58\u4e2d\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u3002</p> <p>2\uff09\u7b2c\u4e8c\u9636\u6bb5\uff1aSecondary NameNode \u5de5\u4f5c</p> <p>\uff081\uff09Secondary NameNode \u8be2\u95ee NameNode \u662f\u5426\u9700\u8981 CheckPoint\u3002\u76f4\u63a5\u5e26\u56de NameNode \u662f\u5426\u68c0\u67e5\u7ed3\u679c\u3002</p> <p>\uff082\uff09Secondary NameNode \u8bf7\u6c42\u6267\u884c CheckPoint\u3002</p> <p>\uff083\uff09NameNode \u6eda\u52a8\u6b63\u5728\u5199\u7684 Edits \u65e5\u5fd7\u3002</p> <p>\uff084\uff09\u5c06\u6eda\u52a8\u524d\u7684\u7f16\u8f91\u65e5\u5fd7\u548c\u955c\u50cf\u6587\u4ef6\u62f7\u8d1d\u5230 Secondary NameNode\u3002</p> <p>\uff085\uff09Secondary NameNode \u52a0\u8f7d\u7f16\u8f91\u65e5\u5fd7\u548c\u955c\u50cf\u6587\u4ef6\u5230\u5185\u5b58\uff0c\u5e76\u5408\u5e76\u3002</p> <p>\uff086\uff09\u751f\u6210\u65b0\u7684\u955c\u50cf\u6587\u4ef6 fsimage.chkpoint\u3002</p> <p>\uff087\uff09\u62f7\u8d1d fsimage.chkpoint \u5230 NameNode\u3002</p> <p>\uff088\uff09NameNode \u5c06 fsimage.chkpoint \u91cd\u65b0\u547d\u540d\u6210 fsimage\u3002</p>"},{"location":"hadoop/hdp_09/#52-fsimageedits","title":"5.2 Fsimage\u548cEdits\u89e3\u6790","text":"<p>1\uff09oiv \u67e5\u770b Fsimage \u6587\u4ef6</p> <p>\uff081\uff09\u67e5\u770b oiv \u548c oev \u547d\u4ee4</p> <pre><code>hdfs\n\noiv            apply the offline fsimage viewer to an fsimage\noev            apply the offline edits viewer to an edits file\n</code></pre> <p>\uff082\uff09\u57fa\u672c\u8bed\u6cd5</p> <p><code>hdfs oiv -p \u6587\u4ef6\u7c7b\u578b -i\u955c\u50cf\u6587\u4ef6 -o \u8f6c\u6362\u540e\u6587\u4ef6\u8f93\u51fa\u8def\u5f84</code></p> <p>\uff083\uff09\u6848\u4f8b\u5b9e\u64cd</p> <pre><code>hdfs oiv -p XML -i fsimage_0000000000000000025 -o /opt/module/hadoop-3.1.3/fsimage.xml\n</code></pre> <p>\u5c06\u663e\u793a\u7684 xml \u6587\u4ef6\u5185\u5bb9\u62f7\u8d1d\u5230 Idea \u4e2d\u521b\u5efa\u7684 xml \u6587\u4ef6\u4e2d\uff0c\u5e76\u683c\u5f0f\u5316\u3002\u90e8\u5206\u663e\u793a\u7ed3\u679c\u5982\u4e0b\u3002</p> fsimage.xml<pre><code>&lt;inode&gt;\n&lt;id&gt;16386&lt;/id&gt;\n&lt;type&gt;DIRECTORY&lt;/type&gt;\n&lt;name&gt;user&lt;/name&gt;\n&lt;mtime&gt;1512722284477&lt;/mtime&gt;\n&lt;permission&gt;atguigu:supergroup:rwxr-xr-x&lt;/permission&gt;\n&lt;nsquota&gt;-1&lt;/nsquota&gt;\n&lt;dsquota&gt;-1&lt;/dsquota&gt;\n&lt;/inode&gt;\n&lt;inode&gt;\n&lt;id&gt;16387&lt;/id&gt;\n&lt;type&gt;DIRECTORY&lt;/type&gt;\n&lt;name&gt;atguigu&lt;/name&gt;\n&lt;mtime&gt;1512790549080&lt;/mtime&gt;\n&lt;permission&gt;atguigu:supergroup:rwxr-xr-x&lt;/permission&gt;\n&lt;nsquota&gt;-1&lt;/nsquota&gt;\n&lt;dsquota&gt;-1&lt;/dsquota&gt;\n&lt;/inode&gt;\n&lt;inode&gt;\n&lt;id&gt;16389&lt;/id&gt;\n&lt;type&gt;FILE&lt;/type&gt;\n&lt;name&gt;wc.input&lt;/name&gt;\n&lt;replication&gt;3&lt;/replication&gt;\n&lt;mtime&gt;1512722322219&lt;/mtime&gt;\n&lt;atime&gt;1512722321610&lt;/atime&gt;\n&lt;perferredBlockSize&gt;134217728&lt;/perferredBlockSize&gt;\n&lt;permission&gt;atguigu:supergroup:rw-r--r--&lt;/permission&gt;\n&lt;blocks&gt;\n&lt;block&gt;\n&lt;id&gt;1073741825&lt;/id&gt;\n&lt;genstamp&gt;1001&lt;/genstamp&gt;\n&lt;numBytes&gt;59&lt;/numBytes&gt;\n&lt;/block&gt;\n&lt;/blocks&gt;\n&lt;/inode &gt;\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\uff0cFsimage \u4e2d\u6ca1\u6709\u8bb0\u5f55\u5757\u6240\u5bf9\u5e94 DataNode\uff0c\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u5728\u96c6\u7fa4\u542f\u52a8\u540e\uff0c\u8981\u6c42 DataNode \u4e0a\u62a5\u6570\u636e\u5757\u4fe1\u606f\uff0c\u5e76\u95f4\u9694\u4e00\u6bb5\u65f6\u95f4\u540e\u518d\u6b21\u4e0a\u62a5\u3002</p> <p>2\uff09oev \u67e5\u770b Edits \u6587\u4ef6</p> <p>\uff081\uff09\u57fa\u672c\u8bed\u6cd5</p> <p><code>hdfs oev -p \u6587\u4ef6\u7c7b\u578b -i\u7f16\u8f91\u65e5\u5fd7 -o \u8f6c\u6362\u540e\u6587\u4ef6\u8f93\u51fa\u8def\u5f84</code></p> <p>\uff082\uff09\u6848\u4f8b\u5b9e\u64cd</p> <pre><code>hdfs oev -p XML -i edits_0000000000000000012-0000000000000000013 -o /opt/module/hadoop-3.1.3/edits.xml\n</code></pre> <p>\u5c06\u663e\u793a\u7684 xml \u6587\u4ef6\u5185\u5bb9\u62f7\u8d1d\u5230 Idea \u4e2d\u521b\u5efa\u7684 xml \u6587\u4ef6\u4e2d\uff0c\u5e76\u683c\u5f0f\u5316\u3002\u663e\u793a\u7ed3\u679c\u5982\u4e0b\u3002</p> edits.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;EDITS&gt;\n&lt;EDITS_VERSION&gt;-63&lt;/EDITS_VERSION&gt;\n&lt;RECORD&gt;\n&lt;OPCODE&gt;OP_START_LOG_SEGMENT&lt;/OPCODE&gt;\n&lt;DATA&gt;\n&lt;TXID&gt;129&lt;/TXID&gt;\n&lt;/DATA&gt;\n&lt;/RECORD&gt;\n&lt;RECORD&gt;\n&lt;OPCODE&gt;OP_ADD&lt;/OPCODE&gt;\n&lt;DATA&gt;\n&lt;TXID&gt;130&lt;/TXID&gt;\n&lt;LENGTH&gt;0&lt;/LENGTH&gt;\n&lt;INODEID&gt;16407&lt;/INODEID&gt;\n&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;\n&lt;REPLICATION&gt;2&lt;/REPLICATION&gt;\n&lt;MTIME&gt;1512943607866&lt;/MTIME&gt;\n&lt;ATIME&gt;1512943607866&lt;/ATIME&gt;\n&lt;BLOCKSIZE&gt;134217728&lt;/BLOCKSIZE&gt;\n&lt;CLIENT_NAME&gt;DFSClient_NONMAPREDUCE_-1544295051_1&lt;/CLIENT_NAME&gt;\n&lt;CLIENT_MACHINE&gt;192.168.10.102&lt;/CLIENT_MACHINE&gt;\n&lt;OVERWRITE&gt;true&lt;/OVERWRITE&gt;\n&lt;PERMISSION_STATUS&gt;\n&lt;USERNAME&gt;atguigu&lt;/USERNAME&gt;\n&lt;GROUPNAME&gt;supergroup&lt;/GROUPNAME&gt;\n&lt;MODE&gt;420&lt;/MODE&gt;\n&lt;/PERMISSION_STATUS&gt;\n&lt;RPC_CLIENTID&gt;908eafd4-9aec-4288-96f1-e8011d181561&lt;/RPC_CLIENTID&gt;\n&lt;RPC_CALLID&gt;0&lt;/RPC_CALLID&gt;\n&lt;/DATA&gt;\n&lt;/RECORD&gt;\n&lt;RECORD&gt;\n&lt;OPCODE&gt;OP_ALLOCATE_BLOCK_ID&lt;/OPCODE&gt;\n&lt;DATA&gt;\n&lt;TXID&gt;131&lt;/TXID&gt;\n&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;\n&lt;/DATA&gt;\n&lt;/RECORD&gt;\n&lt;RECORD&gt;\n&lt;OPCODE&gt;OP_SET_GENSTAMP_V2&lt;/OPCODE&gt;\n&lt;DATA&gt;\n&lt;TXID&gt;132&lt;/TXID&gt;\n&lt;GENSTAMPV2&gt;1016&lt;/GENSTAMPV2&gt;\n&lt;/DATA&gt;\n&lt;/RECORD&gt;\n&lt;RECORD&gt;\n&lt;OPCODE&gt;OP_ADD_BLOCK&lt;/OPCODE&gt;\n&lt;DATA&gt;\n&lt;TXID&gt;133&lt;/TXID&gt;\n&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;\n&lt;BLOCK&gt;\n&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;\n&lt;NUM_BYTES&gt;0&lt;/NUM_BYTES&gt;\n&lt;GENSTAMP&gt;1016&lt;/GENSTAMP&gt;\n&lt;/BLOCK&gt;\n&lt;RPC_CLIENTID&gt;&lt;/RPC_CLIENTID&gt;\n&lt;RPC_CALLID&gt;-2&lt;/RPC_CALLID&gt;\n&lt;/DATA&gt;\n&lt;/RECORD&gt;\n&lt;RECORD&gt;\n&lt;OPCODE&gt;OP_CLOSE&lt;/OPCODE&gt;\n&lt;DATA&gt;\n&lt;TXID&gt;134&lt;/TXID&gt;\n&lt;LENGTH&gt;0&lt;/LENGTH&gt;\n&lt;INODEID&gt;0&lt;/INODEID&gt;\n&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;\n&lt;REPLICATION&gt;2&lt;/REPLICATION&gt;\n&lt;MTIME&gt;1512943608761&lt;/MTIME&gt;\n&lt;ATIME&gt;1512943607866&lt;/ATIME&gt;\n&lt;BLOCKSIZE&gt;134217728&lt;/BLOCKSIZE&gt;\n&lt;CLIENT_NAME&gt;&lt;/CLIENT_NAME&gt;\n&lt;CLIENT_MACHINE&gt;&lt;/CLIENT_MACHINE&gt;\n&lt;OVERWRITE&gt;false&lt;/OVERWRITE&gt;\n&lt;BLOCK&gt;\n&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;\n&lt;NUM_BYTES&gt;25&lt;/NUM_BYTES&gt;\n&lt;GENSTAMP&gt;1016&lt;/GENSTAMP&gt;\n&lt;/BLOCK&gt;\n&lt;PERMISSION_STATUS&gt;\n&lt;USERNAME&gt;atguigu&lt;/USERNAME&gt;\n&lt;GROUPNAME&gt;supergroup&lt;/GROUPNAME&gt;\n&lt;MODE&gt;420&lt;/MODE&gt;\n&lt;/PERMISSION_STATUS&gt;\n&lt;/DATA&gt;\n&lt;/RECORD&gt;\n&lt;/EDITS &gt;\n</code></pre> <p>\u601d\u8003</p> <p>NameNode \u5982\u4f55\u786e\u5b9a\u4e0b\u6b21\u5f00\u673a\u542f\u52a8\u7684\u65f6\u5019\u5408\u5e76\u54ea\u4e9b Edits\uff1f</p>"},{"location":"hadoop/hdp_09/#53-checkpoint","title":"5.3 CheckPoint\u65f6\u95f4\u8bbe\u7f6e","text":"<p>1\uff09\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cSecondaryNameNode \u6bcf\u9694\u4e00\u5c0f\u65f6\u6267\u884c\u4e00\u6b21\u3002</p> hdfs-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt;\n&lt;value&gt;3600s&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>2\uff09\u4e00\u5206\u949f\u68c0\u67e5\u4e00\u6b21\u64cd\u4f5c\u6b21\u6570\uff0c\u5f53\u64cd\u4f5c\u6b21\u6570\u8fbe\u5230 1 \u767e\u4e07\u65f6\uff0cSecondaryNameNode \u6267\u884c\u4e00\u6b21\u3002</p> <pre><code>&lt;property&gt;\n  &lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt;\n  &lt;value&gt;1000000&lt;/value&gt;\n&lt;description&gt;\u64cd\u4f5c\u52a8\u4f5c\u6b21\u6570&lt;/description&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n  &lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt;\n  &lt;value&gt;60s&lt;/value&gt;\n&lt;description&gt; 1\u5206\u949f\u68c0\u67e5\u4e00\u6b21\u64cd\u4f5c\u6b21\u6570&lt;/description&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"hadoop/hdp_10/","title":"\u7b2c6\u7ae0 DataNode","text":""},{"location":"hadoop/hdp_10/#61-datanode","title":"6.1 DataNode\u5de5\u4f5c\u673a\u5236","text":"<p>\uff081\uff09\u4e00\u4e2a\u6570\u636e\u5757\u5728 DataNode \u4e0a\u4ee5\u6587\u4ef6\u5f62\u5f0f\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\uff0c\u5305\u62ec\u4e24\u4e2a\u6587\u4ef6\uff0c\u4e00\u4e2a\u662f\u6570\u636e\u672c\u8eab\uff0c\u4e00\u4e2a\u662f\u5143\u6570\u636e\u5305\u62ec\u6570\u636e\u5757\u7684\u957f\u5ea6\uff0c\u5757\u6570\u636e\u7684\u6821\u9a8c\u548c\uff0c\u4ee5\u53ca\u65f6\u95f4\u6233\u3002</p> <p>\uff082\uff09DataNode \u542f\u52a8\u540e\u5411 NameNode \u6ce8\u518c\uff0c\u901a\u8fc7\u540e\uff0c\u5468\u671f\u6027\uff08 6 \u5c0f\u65f6\uff09\u7684\u5411 NameNode \u4e0a\u62a5\u6240\u6709\u7684\u5757\u4fe1\u606f\u3002</p> <p>DN \u5411 NN \u6c47\u62a5\u5f53\u524d\u89e3\u8bfb\u4fe1\u606f\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba4 6 \u5c0f\u65f6\uff1b</p> hdfs-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;dfs.blockreport.intervalMsec&lt;/name&gt;\n&lt;value&gt;21600000&lt;/value&gt;\n&lt;description&gt;Determines block reporting interval in milliseconds.&lt;/description&gt;\n&lt;/property&gt;\n</code></pre> <p>DN \u626b\u63cf\u81ea\u5df1\u8282\u70b9\u5757\u4fe1\u606f\u5217\u8868\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4 6 \u5c0f\u65f6\u3002</p> hdfs-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;dfs.datanode.directoryscan.interval&lt;/name&gt;\n&lt;value&gt;21600s&lt;/value&gt;\n&lt;description&gt;Interval in seconds for Datanode to scan data directories and reconcile the difference between blocks in memory and on the disk.\n    Support multiple time unit suffix(case insensitive), as described\n    in dfs.heartbeat.interval.\n    &lt;/description&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff083\uff09\u5fc3\u8df3\u662f\u6bcf 3 \u79d2\u4e00\u6b21\uff0c\u5fc3\u8df3\u8fd4\u56de\u7ed3\u679c\u5e26\u6709 NameNode \u7ed9\u8be5 DataNode \u7684\u547d\u4ee4\u5982\u590d\u5236\u5757\u6570\u636e\u5230\u53e6\u4e00\u53f0\u673a\u5668\uff0c\u6216\u5220\u9664\u67d0\u4e2a\u6570\u636e\u5757\u3002\u5982\u679c\u8d85\u8fc7 10 \u5206\u949f\u6ca1\u6709\u6536\u5230\u67d0\u4e2a DataNode \u7684\u5fc3\u8df3\uff0c\u5219\u8ba4\u4e3a\u8be5\u8282\u70b9\u4e0d\u53ef\u7528\u3002</p> <p>\uff084\uff09\u96c6\u7fa4\u8fd0\u884c\u4e2d\u53ef\u4ee5\u5b89\u5168\u52a0\u5165\u548c\u9000\u51fa\u4e00\u4e9b\u673a\u5668\u3002</p>"},{"location":"hadoop/hdp_10/#62","title":"6.2 \u6570\u636e\u5b8c\u6574\u6027","text":"<p>\u601d\u8003</p> <p>\u5982\u679c\u7535\u8111\u78c1\u76d8\u91cc\u9762\u5b58\u50a8\u7684\u6570\u636e\u662f\u63a7\u5236\u9ad8\u94c1\u4fe1\u53f7\u706f\u7684\u7ea2\u706f\u4fe1\u53f7\uff081\uff09\u548c\u7eff\u706f\u4fe1\u53f7\uff080\uff09\uff0c\u4f46\u662f\u5b58\u50a8\u8be5\u6570\u636e\u7684\u78c1\u76d8\u574f\u4e86\uff0c\u4e00\u76f4\u663e\u793a\u662f\u7eff\u706f\uff0c\u662f\u5426\u5f88\u5371\u9669\uff1f\u540c\u7406 DataNode \u8282\u70b9\u4e0a\u7684\u6570\u636e\u635f\u574f\u4e86\uff0c\u5374\u6ca1\u6709\u53d1\u73b0\uff0c\u662f\u5426\u4e5f\u5f88\u5371\u9669\uff0c\u90a3\u4e48\u5982\u4f55\u89e3\u51b3\u5462\uff1f</p> <p>\u5982\u4e0b\u662f DataNode \u8282\u70b9\u4fdd\u8bc1\u6570\u636e\u5b8c\u6574\u6027\u7684\u65b9\u6cd5\u3002</p> <p>\uff081\uff09\u5f53 DataNode \u8bfb\u53d6 Block \u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u8ba1\u7b97 CheckSum\u3002</p> <p>\uff082\uff09\u5982\u679c\u8ba1\u7b97\u540e\u7684 CheckSum\uff0c\u4e0e Block \u521b\u5efa\u65f6\u503c\u4e0d\u4e00\u6837\uff0c\u8bf4\u660e Block \u5df2\u7ecf\u635f\u574f\u3002</p> <p>\uff083\uff09Client \u8bfb\u53d6\u5176\u4ed6 DataNode \u4e0a\u7684 Block\u3002</p> <p>\uff084\uff09\u5e38\u89c1\u7684\u6821\u9a8c\u7b97\u6cd5 crc\uff0832\uff09\uff0cmd5\uff08128\uff09\uff0csha1\uff08160\uff09\u3002</p> <p>\uff085\uff09DataNode \u5728\u5176\u6587\u4ef6\u521b\u5efa\u540e\u5468\u671f\u9a8c\u8bc1 CheckSum\u3002</p> <p></p>"},{"location":"hadoop/hdp_10/#63","title":"6.3 \u6389\u7ebf\u65f6\u9650\u53c2\u6570\u8bbe\u7f6e","text":"<p>\u200b   \u9700\u8981\u6ce8\u610f\u7684\u662f hdfs-site.xml \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 heartbeat.recheck.interval \u7684\u5355\u4f4d\u4e3a\u6beb\u79d2\uff0cdfs.heartbeat.interval \u7684\u5355\u4f4d\u4e3a\u79d2\u3002</p> hdfs-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;dfs.namenode.heartbeat.recheck-interval&lt;/name&gt;\n&lt;value&gt;300000&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n&lt;name&gt;dfs.heartbeat.interval&lt;/name&gt;\n&lt;value&gt;3&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"hadoop/hdp_11/","title":"\u7b2c1\u7ae0 MapReduce\u6982\u8ff0","text":""},{"location":"hadoop/hdp_11/#11-mapreduce","title":"1.1 MapReduce\u5b9a\u4e49","text":"<p>MapReduce \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u8fd0\u7b97\u7a0b\u5e8f\u7684\u7f16\u7a0b\u6846\u67b6\uff0c\u662f\u7528\u6237\u5f00\u53d1\u201c\u57fa\u4e8e Hadoop \u7684\u6570\u636e\u5206\u6790\u5e94\u7528\u201d\u7684\u6838\u5fc3\u6846\u67b6\u3002</p> <p>MapReduce \u6838\u5fc3\u529f\u80fd\u662f\u5c06\u7528\u6237\u7f16\u5199\u7684\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801\u548c\u81ea\u5e26\u9ed8\u8ba4\u7ec4\u4ef6 \u6574\u5408\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u5206\u5e03\u5f0f\u8fd0\u7b97\u7a0b\u5e8f\uff0c\u5e76\u53d1\u8fd0\u884c\u5728\u4e00\u4e2a Hadoop \u96c6\u7fa4\u4e0a\u3002</p>"},{"location":"hadoop/hdp_11/#12-mapreduce","title":"1.2 MapReduce\u4f18\u7f3a\u70b9","text":""},{"location":"hadoop/hdp_11/#121","title":"1.2.1 \u4f18\u70b9","text":"<ul> <li> MapReduce \u6613\u4e8e\u7f16\u7a0b</li> </ul> <p>\u5b83\u7b80\u5355\u7684\u5b9e\u73b0\u4e00\u4e9b\u63a5\u53e3\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e00\u4e2a\u5206\u5e03\u5f0f\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u5206\u5e03\u5f0f\u7a0b\u5e8f\u53ef\u4ee5\u5206\u5e03\u5230\u5927\u91cf\u5ec9\u4ef7\u7684 PC \u673a\u5668\u4e0a\u8fd0\u884c\u3002\u4e5f\u5c31\u662f\u8bf4\u4f60\u5199\u4e00\u4e2a\u5206\u5e03\u5f0f\u7a0b\u5e8f\uff0c\u8ddf\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u4e32\u884c\u7a0b\u5e8f\u662f\u4e00\u6a21\u4e00\u6837\u7684\u3002\u5c31\u662f\u56e0\u4e3a\u8fd9\u4e2a\u7279\u70b9\u4f7f\u5f97 MapReduce \u7f16\u7a0b\u53d8\u5f97\u975e\u5e38\u6d41\u884c\u3002</p> <ul> <li> \u826f\u597d\u7684\u6269\u5c55\u6027</li> </ul> <p>\u5f53\u4f60\u7684\u8ba1\u7b97\u8d44\u6e90\u4e0d\u80fd\u5f97\u5230\u6ee1\u8db3\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u7684\u589e\u52a0\u673a\u5668\u6765\u6269\u5c55\u5b83\u7684\u8ba1\u7b97\u80fd\u529b\u3002</p> <ul> <li> \u9ad8\u5bb9\u9519\u6027</li> </ul> <p>MapReduce \u8bbe\u8ba1\u7684\u521d\u8877\u5c31\u662f\u4f7f\u7a0b\u5e8f\u80fd\u591f\u90e8\u7f72\u5728\u5ec9\u4ef7\u7684 PC \u673a\u5668\u4e0a\uff0c\u8fd9\u5c31\u8981\u6c42\u5b83\u5177\u6709\u5f88\u9ad8\u7684\u5bb9\u9519\u6027\u3002\u6bd4\u5982\u5176\u4e2d\u4e00\u53f0\u673a\u5668\u6302\u4e86\uff0c\u5b83\u53ef\u4ee5\u628a\u4e0a\u9762\u7684\u8ba1\u7b97\u4efb\u52a1\u8f6c\u79fb\u5230\u53e6\u5916\u4e00\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u4e0d\u81f3\u4e8e\u8fd9\u4e2a\u4efb\u52a1\u8fd0\u884c\u5931\u8d25\uff0c\u800c\u4e14\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u9700\u8981\u4eba\u5de5\u53c2\u4e0e\uff0c\u800c\u5b8c\u5168\u662f\u7531 Hadoop \u5185\u90e8\u5b8c\u6210\u7684\u3002</p> <ul> <li> \u9002\u5408 PB \u7ea7\u4ee5\u4e0a\u6d77\u91cf\u6570\u636e\u7684\u79bb\u7ebf\u5904\u7406</li> </ul> <p>\u53ef\u4ee5\u5b9e\u73b0\u4e0a\u5343\u53f0\u670d\u52a1\u5668\u96c6\u7fa4\u5e76\u53d1\u5de5\u4f5c\uff0c\u63d0\u4f9b\u6570\u636e\u5904\u7406\u80fd\u529b\u3002</p>"},{"location":"hadoop/hdp_11/#122","title":"1.2.2 \u7f3a\u70b9","text":"<ul> <li> \u4e0d\u64c5\u957f\u5b9e\u65f6\u8ba1\u7b97</li> </ul> <p>MapReduce \u65e0\u6cd5\u50cf MySQL \u4e00\u6837\uff0c\u5728\u6beb\u79d2\u6216\u8005\u79d2\u7ea7\u5185\u8fd4\u56de\u7ed3\u679c\u3002</p> <ul> <li> \u4e0d\u64c5\u957f\u6d41\u5f0f\u8ba1\u7b97</li> </ul> <p>\u6d41\u5f0f\u8ba1\u7b97\u7684\u8f93\u5165\u6570\u636e\u662f\u52a8\u6001\u7684\uff0c\u800c MapReduce \u7684\u8f93\u5165\u6570\u636e\u96c6\u662f\u9759\u6001\u7684\uff0c\u4e0d\u80fd\u52a8\u6001\u53d8\u5316\u3002\u8fd9\u662f\u56e0\u4e3a MapReduce \u81ea\u8eab\u7684\u8bbe\u8ba1\u7279\u70b9\u51b3\u5b9a\u4e86\u6570\u636e\u6e90\u5fc5\u987b\u662f\u9759\u6001\u7684\u3002</p> <ul> <li> \u4e0d\u64c5\u957f DAG\uff08\u6709\u5411\u65e0\u73af\u56fe\uff09\u8ba1\u7b97</li> </ul> <p>\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\uff0c\u540e\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u8f93\u5165\u4e3a\u524d\u4e00\u4e2a\u7684\u8f93\u51fa\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cMapReduce \u5e76\u4e0d\u662f\u4e0d\u80fd\u505a\uff0c\u800c\u662f\u4f7f\u7528\u540e\uff0c\u6bcf\u4e2a MapReduce \u4f5c\u4e1a\u7684\u8f93\u51fa\u7ed3\u679c\u90fd\u4f1a\u5199\u5165\u5230\u78c1\u76d8\uff0c\u4f1a\u9020\u6210\u5927\u91cf\u7684\u78c1\u76d8 IO\uff0c\u5bfc\u81f4\u6027\u80fd\u975e\u5e38\u7684\u4f4e\u4e0b\u3002</p>"},{"location":"hadoop/hdp_11/#13-mapreduce","title":"1.3 MapReduce\u6838\u5fc3\u601d\u60f3","text":"<p>\uff081\uff09\u5206\u5e03\u5f0f\u7684\u8fd0\u7b97\u7a0b\u5e8f\u5f80\u5f80\u9700\u8981\u5206\u6210\u81f3\u5c11 2 \u4e2a\u9636\u6bb5\u3002</p> <p>\uff082\uff09\u7b2c\u4e00\u4e2a\u9636\u6bb5\u7684 MapTask \u5e76\u53d1\u5b9e\u4f8b\uff0c\u5b8c\u5168\u5e76\u884c\u8fd0\u884c\uff0c\u4e92\u4e0d\u76f8\u5e72\u3002</p> <p>\uff083\uff09\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u7684 ReduceTask \u5e76\u53d1\u5b9e\u4f8b\u4e92\u4e0d\u76f8\u5e72\uff0c\u4f46\u662f\u4ed6\u4eec\u7684\u6570\u636e\u4f9d\u8d56\u4e8e\u4e0a\u4e00\u4e2a\u9636\u6bb5\u7684\u6240\u6709 MapTask \u5e76\u53d1\u5b9e\u4f8b\u7684\u8f93\u51fa\u3002</p> <p>\uff084\uff09MapReduce \u7f16\u7a0b\u6a21\u578b\u53ea\u80fd\u5305\u542b\u4e00\u4e2a Map \u9636\u6bb5\u548c\u4e00\u4e2a Reduce \u9636\u6bb5\uff0c\u5982\u679c\u7528\u6237\u7684\u4e1a\u52a1\u903b\u8f91\u975e\u5e38\u590d\u6742\uff0c\u90a3\u5c31\u53ea\u80fd\u591a\u4e2a MapReduce \u7a0b\u5e8f\uff0c\u4e32\u884c\u8fd0\u884c\u3002</p> <p>\u603b\u7ed3\uff1a\u5206\u6790 WordCount \u6570\u636e\u6d41\u8d70\u5411\u6df1\u5165\u7406\u89e3 MapReduce \u6838\u5fc3\u601d\u60f3\u3002</p>"},{"location":"hadoop/hdp_11/#14-mapreduce","title":"1.4 MapReduce\u8fdb\u7a0b","text":"<p>\u4e00\u4e2a\u5b8c\u6574\u7684 MapReduce \u7a0b\u5e8f\u5728\u5206\u5e03\u5f0f\u8fd0\u884c\u65f6\u6709\u4e09\u7c7b\u5b9e\u4f8b\u8fdb\u7a0b\uff1a</p> <ul> <li>MrAppMaster\uff1a\u8d1f\u8d23\u6574\u4e2a\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u8c03\u5ea6\u53ca\u72b6\u6001\u534f\u8c03\u3002</li> <li>MapTask\uff1a\u8d1f\u8d23 Ma p\u9636\u6bb5\u7684\u6574\u4e2a\u6570\u636e\u5904\u7406\u6d41\u7a0b\u3002</li> <li>ReduceTask\uff1a\u8d1f\u8d23 Reduce \u9636\u6bb5\u7684\u6574\u4e2a\u6570\u636e\u5904\u7406\u6d41\u7a0b\u3002</li> </ul>"},{"location":"hadoop/hdp_11/#15-wordcount","title":"1.5 \u5b98\u65b9WordCount\u6e90\u7801","text":"<p>\u91c7\u7528\u53cd\u7f16\u8bd1\u5de5\u5177\u53cd\u7f16\u8bd1\u6e90\u7801\uff0c\u53d1\u73b0 WordCount \u6848\u4f8b\u6709 Map \u7c7b\u3001Reduce \u7c7b\u548c Driver \u7c7b\u3002\u4e14\u6570\u636e\u7684\u7c7b\u578b\u662f Hadoop \u81ea\u8eab\u5c01\u88c5\u7684\u5e8f\u5217\u5316\u7c7b\u578b\u3002</p>"},{"location":"hadoop/hdp_11/#16","title":"1.6 \u5e38\u7528\u6570\u636e\u5e8f\u5217\u5316\u7c7b\u578b","text":"Java\u7c7b\u578b Hadoop Writable\u7c7b\u578b Boolean BooleanWritable Byte ByteWritable Int IntWritable Float FloatWritable Long LongWritable Double DoubleWritable String Text Map MapWritable Array ArrayWritable Null NullWritable"},{"location":"hadoop/hdp_11/#17-mapreduce","title":"1.7 MapReduce\u7f16\u7a0b\u89c4\u8303","text":"<p>\u7528\u6237\u7f16\u5199\u7684\u7a0b\u5e8f\u5206\u6210\u4e09\u4e2a\u90e8\u5206\uff1aMapper\u3001Reducer \u548c Driver\u3002</p> <p></p> <p></p>"},{"location":"hadoop/hdp_11/#18-wordcount","title":"1.8 WordCount\u6848\u4f8b\u5b9e\u64cd","text":""},{"location":"hadoop/hdp_11/#181","title":"1.8.1 \u672c\u5730\u6d4b\u8bd5","text":"<p>1\uff09\u9700\u6c42</p> <p>\u5728\u7ed9\u5b9a\u7684\u6587\u672c\u6587\u4ef6\u4e2d\u7edf\u8ba1\u8f93\u51fa\u6bcf\u4e00\u4e2a\u5355\u8bcd\u51fa\u73b0\u7684\u603b\u6b21\u6570\u3002</p> <p>\uff081\uff09\u8f93\u5165\u6570\u636e</p> hello.txt<pre><code>atguigu atguigu\nss ss\ncls cls\njiao\nbanzhang\nxue\nhadoop\n</code></pre> <p>\uff082\uff09\u671f\u671b\u8f93\u51fa\u6570\u636e</p> <pre><code>atguigu 2\nbanzhang    1\ncls 2\nhadoop  1\njiao    1\nss  2\nxue 1\n</code></pre> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p>\u6309\u7167 MapReduce \u7f16\u7a0b\u89c4\u8303\uff0c\u5206\u522b\u7f16\u5199 Mapper\uff0cReducer\uff0cDriver\u3002</p> <p></p> <p>3\uff09\u73af\u5883\u51c6\u5907</p> <p>\uff081\uff09\u521b\u5efa maven \u5de5\u7a0b\uff0cMapReduceDemo</p> <p>\uff082\uff09\u5728 pom.xml \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n&lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;version&gt;4.12&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;\n&lt;version&gt;1.7.30&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>\uff082\uff09\u5728\u9879\u76ee\u7684 src/main/resources \u76ee\u5f55\u4e0b\uff0c\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u547d\u540d\u4e3a <code>log4j.properties</code>\uff0c\u5728\u6587\u4ef6\u4e2d\u586b\u5165\u3002</p> log4j.properties<pre><code>log4j.rootLogger=INFO, stdout  \nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender  \nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout  \nlog4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n  \nlog4j.appender.logfile=org.apache.log4j.FileAppender  \nlog4j.appender.logfile.File=target/spring.log  \nlog4j.appender.logfile.layout=org.apache.log4j.PatternLayout  \nlog4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n\n</code></pre> <p>\uff083\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.mapreduce.wordcount</p> <p>4\uff09\u7f16\u5199\u7a0b\u5e8f</p> <p>\uff081\uff09\u7f16\u5199 Mapper \u7c7b</p> <pre><code>package com.atguigu.mapreduce.wordcount;\nimport java.io.IOException;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\n\npublic class WordCountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;{\n\nText k = new Text();\nIntWritable v = new IntWritable(1);\n\n@Override\nprotected void map(LongWritable key, Text value, Context context)   throws IOException, InterruptedException {\n\n// 1 \u83b7\u53d6\u4e00\u884c\nString line = value.toString();\n\n// 2 \u5207\u5272\nString[] words = line.split(\" \");\n\n// 3 \u8f93\u51fa\nfor (String word : words) {\n\nk.set(word);\ncontext.write(k, v);\n}\n}\n}\n</code></pre> <p>\uff082\uff09\u7f16\u5199 Reducer \u7c7b</p> <pre><code>package com.atguigu.mapreduce.wordcount;\nimport java.io.IOException;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\n\npublic class WordCountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt;{\n\nint sum;\nIntWritable v = new IntWritable();\n\n@Override\nprotected void reduce(Text key, Iterable&lt;IntWritable&gt; values,Context context) throws IOException, InterruptedException {\n\n// 1 \u7d2f\u52a0\u6c42\u548c\nsum = 0;\nfor (IntWritable count : values) {\nsum += count.get();\n}\n\n// 2 \u8f93\u51fa\nv.set(sum);\ncontext.write(key,v);\n}\n}\n</code></pre> <p>\uff083\uff09\u7f16\u5199 Driver \u9a71\u52a8\u7c7b</p> <pre><code>package com.atguigu.mapreduce.wordcount;\nimport java.io.IOException;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class WordCountDriver {\n\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n// 1 \u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\u4ee5\u53ca\u83b7\u53d6job\u5bf9\u8c61\n        Configuration conf = new Configuration();\nJob job = Job.getInstance(conf);\n\n// 2 \u5173\u8054\u672cDriver\u7a0b\u5e8f\u7684jar\n        job.setJarByClass(WordCountDriver.class);\n\n// 3 \u5173\u8054Mapper\u548cReducer\u7684jar\n        job.setMapperClass(WordCountMapper.class);\njob.setReducerClass(WordCountReducer.class);\n\n// 4 \u8bbe\u7f6eMapper\u8f93\u51fa\u7684kv\u7c7b\u578b\n        job.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(IntWritable.class);\n\n// 5 \u8bbe\u7f6e\u6700\u7ec8\u8f93\u51fakv\u7c7b\u578b\n        job.setOutputKeyClass(Text.class);\njob.setOutputValueClass(IntWritable.class);\n\n// 6 \u8bbe\u7f6e\u8f93\u5165\u548c\u8f93\u51fa\u8def\u5f84\n        FileInputFormat.setInputPaths(job, new Path(args[0]));\nFileOutputFormat.setOutputPath(job, new Path(args[1]));\n\n// 7 \u63d0\u4ea4job\n        boolean result = job.waitForCompletion(true);\nSystem.exit(result ? 0 : 1);\n}\n}\n</code></pre> <p>5\uff09\u672c\u5730\u6d4b\u8bd5</p> <p>\uff081\uff09\u9700\u8981\u9996\u5148\u914d\u7f6e\u597d HADOOP_HOME \u53d8\u91cf\u4ee5\u53ca Windows \u8fd0\u884c\u4f9d\u8d56</p> <p>\uff082\uff09\u5728 IDEA / Eclipse \u4e0a\u8fd0\u884c\u7a0b\u5e8f</p>"},{"location":"hadoop/hdp_11/#182","title":"1.8.2 \u63d0\u4ea4\u5230\u96c6\u7fa4\u6d4b\u8bd5","text":"<p>1\uff09\u96c6\u7fa4\u4e0a\u6d4b\u8bd5</p> <p>\uff081\uff09\u7528 maven \u6253 jar \u5305\uff0c\u9700\u8981\u6dfb\u52a0\u7684\u6253\u5305\u63d2\u4ef6\u4f9d\u8d56</p> pom.xml<pre><code>&lt;build&gt;\n&lt;plugins&gt;\n&lt;plugin&gt;\n&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n&lt;version&gt;3.6.1&lt;/version&gt;\n&lt;configuration&gt;\n&lt;source&gt;1.8&lt;/source&gt;\n&lt;target&gt;1.8&lt;/target&gt;\n&lt;/configuration&gt;\n&lt;/plugin&gt;\n&lt;plugin&gt;\n&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;\n&lt;configuration&gt;\n&lt;descriptorRefs&gt;\n&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;\n&lt;/descriptorRefs&gt;\n&lt;/configuration&gt;\n&lt;executions&gt;\n&lt;execution&gt;\n&lt;id&gt;make-assembly&lt;/id&gt;\n&lt;phase&gt;package&lt;/phase&gt;\n&lt;goals&gt;\n&lt;goal&gt;single&lt;/goal&gt;\n&lt;/goals&gt;\n&lt;/execution&gt;\n&lt;/executions&gt;\n&lt;/plugin&gt;\n&lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u5de5\u7a0b\u4e0a\u663e\u793a\u7ea2\u53c9\u3002\u5728\u9879\u76ee\u4e0a\u53f3\u952e -&gt; maven -&gt; Reimport \u5237\u65b0\u5373\u53ef\u3002</p> <p>\uff082\uff09\u5c06\u7a0b\u5e8f\u6253\u6210 jar \u5305</p> <p></p> <p>\uff083\uff09\u4fee\u6539\u4e0d\u5e26\u4f9d\u8d56\u7684 jar \u5305\u540d\u79f0\u4e3a wc.jar\uff0c\u5e76\u62f7\u8d1d\u8be5 jar \u5305\u5230 Hadoop \u96c6\u7fa4\u7684 /opt/module/hadoop-3.1.3 \u8def\u5f84\u3002</p> <p>\uff084\uff09\u542f\u52a8 Hadoop \u96c6\u7fa4</p> <pre><code>sbin/start-dfs.sh\nsbin/start-yarn.sh\n</code></pre> <p>\uff085\uff09\u6267\u884c WordCount \u7a0b\u5e8f</p> <pre><code>hadoop jar  wc.jar com.atguigu.mapreduce.wordcount.WordCountDriver /user/atguigu/input /user/atguigu/output\n</code></pre>"},{"location":"hadoop/hdp_12/","title":"\u7b2c2\u7ae0 Hadoop\u5e8f\u5217\u5316","text":""},{"location":"hadoop/hdp_12/#21","title":"2.1 \u5e8f\u5217\u5316\u6982\u8ff0","text":"<p>1\uff09\u4ec0\u4e48\u662f\u5e8f\u5217\u5316</p> <p>\u5e8f\u5217\u5316\u5c31\u662f\u628a\u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\uff0c\u8f6c\u6362\u6210\u5b57\u8282\u5e8f\u5217\uff08\u6216\u5176\u4ed6\u6570\u636e\u4f20\u8f93\u534f\u8bae\uff09\u4ee5\u4fbf\u4e8e\u5b58\u50a8\u5230\u78c1\u76d8\uff08\u6301\u4e45\u5316\uff09\u548c\u7f51\u7edc\u4f20\u8f93\u3002 </p> <p>\u53cd\u5e8f\u5217\u5316\u5c31\u662f\u5c06\u6536\u5230\u5b57\u8282\u5e8f\u5217\uff08\u6216\u5176\u4ed6\u6570\u636e\u4f20\u8f93\u534f\u8bae\uff09\u6216\u8005\u662f\u78c1\u76d8\u7684\u6301\u4e45\u5316\u6570\u636e\uff0c\u8f6c\u6362\u6210\u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\u3002</p> <p>2\uff09\u4e3a\u4ec0\u4e48\u8981\u5e8f\u5217\u5316</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u201c\u6d3b\u7684\u201d\u5bf9\u8c61\u53ea\u751f\u5b58\u5728\u5185\u5b58\u91cc\uff0c\u5173\u673a\u65ad\u7535\u5c31\u6ca1\u6709\u4e86\u3002\u800c\u4e14\u201c\u6d3b\u7684\u201d\u5bf9\u8c61\u53ea\u80fd\u7531\u672c\u5730\u7684\u8fdb\u7a0b\u4f7f\u7528\uff0c\u4e0d\u80fd\u88ab\u53d1\u9001\u5230\u7f51\u7edc\u4e0a\u7684\u53e6\u5916\u4e00\u53f0\u8ba1\u7b97\u673a\u3002 \u7136\u800c\u5e8f\u5217\u5316\u53ef\u4ee5\u5b58\u50a8\u201c\u6d3b\u7684\u201d\u5bf9\u8c61\uff0c\u53ef\u4ee5\u5c06\u201c\u6d3b\u7684\u201d\u5bf9\u8c61\u53d1\u9001\u5230\u8fdc\u7a0b\u8ba1\u7b97\u673a\u3002</p> <p>3\uff09\u4e3a\u4ec0\u4e48\u4e0d\u7528 Java \u7684\u5e8f\u5217\u5316</p> <p>Java \u7684\u5e8f\u5217\u5316\u662f\u4e00\u4e2a\u91cd\u91cf\u7ea7\u5e8f\u5217\u5316\u6846\u67b6\uff08Serializable\uff09\uff0c\u4e00\u4e2a\u5bf9\u8c61\u88ab\u5e8f\u5217\u5316\u540e\uff0c\u4f1a\u9644\u5e26\u5f88\u591a\u989d\u5916\u7684\u4fe1\u606f\uff08\u5404\u79cd\u6821\u9a8c\u4fe1\u606f\uff0cHeader\uff0c\u7ee7\u627f\u4f53\u7cfb\u7b49\uff09\uff0c\u4e0d\u4fbf\u4e8e\u5728\u7f51\u7edc\u4e2d\u9ad8\u6548\u4f20\u8f93\u3002\u6240\u4ee5\uff0cHadoop \u81ea\u5df1\u5f00\u53d1\u4e86\u4e00\u5957\u5e8f\u5217\u5316\u673a\u5236\uff08Writable\uff09\u3002</p> <p>4\uff09Hadoop \u5e8f\u5217\u5316\u7279\u70b9</p> <ul> <li>\u7d27\u51d1 \uff1a\u9ad8\u6548\u4f7f\u7528\u5b58\u50a8\u7a7a\u95f4\u3002</li> <li>\u5feb\u901f\uff1a\u8bfb\u5199\u6570\u636e\u7684\u989d\u5916\u5f00\u9500\u5c0f\u3002</li> <li>\u4e92\u64cd\u4f5c\uff1a\u652f\u6301\u591a\u8bed\u8a00\u7684\u4ea4\u4e92</li> </ul>"},{"location":"hadoop/hdp_12/#22-beanwritable","title":"2.2 \u81ea\u5b9a\u4e49bean\u5bf9\u8c61\u5b9e\u73b0\u5e8f\u5217\u5316\u63a5\u53e3\uff08Writable\uff09","text":"<p>\u5728\u4f01\u4e1a\u5f00\u53d1\u4e2d\u5f80\u5f80\u5e38\u7528\u7684\u57fa\u672c\u5e8f\u5217\u5316\u7c7b\u578b\u4e0d\u80fd\u6ee1\u8db3\u6240\u6709\u9700\u6c42\uff0c\u6bd4\u5982\u5728 Hadoop \u6846\u67b6\u5185\u90e8\u4f20\u9012\u4e00\u4e2a bean \u5bf9\u8c61\uff0c\u90a3\u4e48\u8be5\u5bf9\u8c61\u5c31\u9700\u8981\u5b9e\u73b0\u5e8f\u5217\u5316\u63a5\u53e3\u3002</p> <p>\u5177\u4f53\u5b9e\u73b0 bean \u5bf9\u8c61\u5e8f\u5217\u5316\u6b65\u9aa4\u5982\u4e0b 7 \u6b65\u3002</p> <p>\uff081\uff09\u5fc5\u987b\u5b9e\u73b0 Writable \u63a5\u53e3</p> <p>\uff082\uff09\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u9700\u8981\u53cd\u5c04\u8c03\u7528\u7a7a\u53c2\u6784\u9020\u51fd\u6570\uff0c\u6240\u4ee5\u5fc5\u987b\u6709\u7a7a\u53c2\u6784\u9020</p> <pre><code>public FlowBean() {\nsuper();\n}\n</code></pre> <p>\uff083\uff09\u91cd\u5199\u5e8f\u5217\u5316\u65b9\u6cd5</p> <pre><code>@Override\npublic void write(DataOutput out) throws IOException {\nout.writeLong(upFlow);\nout.writeLong(downFlow);\nout.writeLong(sumFlow);\n}\n</code></pre> <p>\uff084\uff09\u91cd\u5199\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5</p> <pre><code>@Override\npublic void readFields(DataInput in) throws IOException {\nupFlow = in.readLong();\ndownFlow = in.readLong();\nsumFlow = in.readLong();\n}\n</code></pre> <p>\uff085\uff09\u6ce8\u610f\u53cd\u5e8f\u5217\u5316\u7684\u987a\u5e8f\u548c\u5e8f\u5217\u5316\u7684\u987a\u5e8f\u5b8c\u5168\u4e00\u81f4\u3002</p> <p>\uff086\uff09\u8981\u60f3\u628a\u7ed3\u679c\u663e\u793a\u5728\u6587\u4ef6\u4e2d\uff0c\u9700\u8981\u91cd\u5199 toString()\uff0c\u53ef\u7528 <code>\\t</code> \u5206\u5f00\uff0c\u65b9\u4fbf\u540e\u7eed\u7528\u3002</p> <p>\uff087\uff09\u5982\u679c\u9700\u8981\u5c06\u81ea\u5b9a\u4e49\u7684 bean \u653e\u5728 key \u4e2d\u4f20\u8f93\uff0c\u5219\u8fd8\u9700\u8981\u5b9e\u73b0 Comparable \u63a5\u53e3\uff0c\u56e0\u4e3a MapReduce \u6846\u4e2d\u7684 Shuffle \u8fc7\u7a0b\u8981\u6c42\u5bf9 key \u5fc5\u987b\u80fd\u6392\u5e8f\u3002\u8be6\u89c1\u540e\u9762\u6392\u5e8f\u6848\u4f8b\u3002</p> <pre><code>@Override\npublic int compareTo(FlowBean o) {\n// \u5012\u5e8f\u6392\u5217\uff0c\u4ece\u5927\u5230\u5c0f\nreturn this.sumFlow &gt; o.getSumFlow() ? -1 : 1;\n}\n</code></pre>"},{"location":"hadoop/hdp_12/#23","title":"2.3 \u5e8f\u5217\u5316\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u9700\u6c42</p> <p>\u7edf\u8ba1\u6bcf\u4e00\u4e2a\u624b\u673a\u53f7\u8017\u8d39\u7684\u603b\u4e0a\u884c\u6d41\u91cf\u3001\u603b\u4e0b\u884c\u6d41\u91cf\u3001\u603b\u6d41\u91cf</p> <p>\uff081\uff09\u8f93\u5165\u6570\u636e</p> phone_data.txt<pre><code>1   13736230513 192.196.100.1   www.atguigu.com 2481    24681   200\n2   13846544121 192.196.100.2           264 0   200\n3   13956435636 192.196.100.3           132 1512    200\n4   13966251146 192.168.100.1           240 0   404\n5   18271575951 192.168.100.2   www.atguigu.com 1527    2106    200\n6   84188413    192.168.100.3   www.atguigu.com 4116    1432    200\n7   13590439668 192.168.100.4           1116    954 200\n8   15910133277 192.168.100.5   www.hao123.com  3156    2936    200\n9   13729199489 192.168.100.6           240 0   200\n10  13630577991 192.168.100.7   www.shouhu.com  6960    690 200\n11  15043685818 192.168.100.8   www.baidu.com   3659    3538    200\n12  15959002129 192.168.100.9   www.atguigu.com 1938    180 500\n13  13560439638 192.168.100.10          918 4938    200\n14  13470253144 192.168.100.11          180 180 200\n15  13682846555 192.168.100.12  www.qq.com  1938    2910    200\n16  13992314666 192.168.100.13  www.gaga.com    3008    3720    200\n17  13509468723 192.168.100.14  www.qinghua.com 7335    110349  404\n18  18390173782 192.168.100.15  www.sogou.com   9531    2412    200\n19  13975057813 192.168.100.16  www.baidu.com   11058   48243   200\n20  13768778790 192.168.100.17          120 120 200\n21  13568436656 192.168.100.18  www.alibaba.com 2481    24681   200\n22  13568436656 192.168.100.19          1116    954 200\n</code></pre> <p>\uff082\uff09\u8f93\u5165\u6570\u636e\u683c\u5f0f\uff1a</p> <p>\u624b\u673a\u53f7\u7801        \u7f51\u7edcip            \u4e0a\u884c\u6d41\u91cf \u4e0b\u884c\u6d41\u91cf   \u7f51\u7edc\u72b6\u6001\u7801</p> <p>7   13560436666 120.196.100.99      1116         954            200id</p> <p>\uff083\uff09\u671f\u671b\u8f93\u51fa\u6570\u636e\u683c\u5f0f</p> <p>\u624b\u673a\u53f7\u7801          \u4e0a\u884c\u6d41\u91cf    \u4e0b\u884c\u6d41\u91cf      \u603b\u6d41\u91cf</p> <p>13560436666         1116           954          2070</p> <p>2\uff09\u9700\u6c42\u5206\u6790 </p> <p></p> <p>3\uff09\u7f16\u5199 MapReduce \u7a0b\u5e8f</p> <p>\uff081\uff09\u7f16\u5199\u6d41\u91cf\u7edf\u8ba1\u7684 Bean \u5bf9\u8c61</p> <pre><code>package com.atguigu.mapreduce.writable;\n\nimport org.apache.hadoop.io.Writable;\nimport java.io.DataInput;\nimport java.io.DataOutput;\nimport java.io.IOException;\n\n//1 \u7ee7\u627fWritable\u63a5\u53e3\npublic class FlowBean implements Writable {\n\nprivate long upFlow; //\u4e0a\u884c\u6d41\u91cf\nprivate long downFlow; //\u4e0b\u884c\u6d41\u91cf\nprivate long sumFlow; //\u603b\u6d41\u91cf\n\n//2 \u63d0\u4f9b\u65e0\u53c2\u6784\u9020\npublic FlowBean() {\n}\n\n//3 \u63d0\u4f9b\u4e09\u4e2a\u53c2\u6570\u7684getter\u548csetter\u65b9\u6cd5\npublic long getUpFlow() {\nreturn upFlow;\n}\n\npublic void setUpFlow(long upFlow) {\nthis.upFlow = upFlow;\n}\n\npublic long getDownFlow() {\nreturn downFlow;\n}\n\npublic void setDownFlow(long downFlow) {\nthis.downFlow = downFlow;\n}\n\npublic long getSumFlow() {\nreturn sumFlow;\n}\n\npublic void setSumFlow(long sumFlow) {\nthis.sumFlow = sumFlow;\n}\n\npublic void setSumFlow() {\nthis.sumFlow = this.upFlow + this.downFlow;\n}\n\n//4 \u5b9e\u73b0\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5,\u6ce8\u610f\u987a\u5e8f\u4e00\u5b9a\u8981\u4fdd\u6301\u4e00\u81f4\n@Override\npublic void write(DataOutput dataOutput) throws IOException {\ndataOutput.writeLong(upFlow);\ndataOutput.writeLong(downFlow);\ndataOutput.writeLong(sumFlow);\n}\n\n@Override\npublic void readFields(DataInput dataInput) throws IOException {\nthis.upFlow = dataInput.readLong();\nthis.downFlow = dataInput.readLong();\nthis.sumFlow = dataInput.readLong();\n}\n\n//5 \u91cd\u5199ToString\n@Override\npublic String toString() {\nreturn upFlow + \"\\t\" + downFlow + \"\\t\" + sumFlow;\n}\n}\n</code></pre> <p>\uff082\uff09\u7f16\u5199 Mapper \u7c7b</p> <pre><code>package com.atguigu.mapreduce.writable;\n\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport java.io.IOException;\n\npublic class FlowMapper extends Mapper&lt;LongWritable, Text, Text, FlowBean&gt; {\nprivate Text outK = new Text();\nprivate FlowBean outV = new FlowBean();\n\n@Override\nprotected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\n//1 \u83b7\u53d6\u4e00\u884c\u6570\u636e,\u8f6c\u6210\u5b57\u7b26\u4e32\nString line = value.toString();\n\n//2 \u5207\u5272\u6570\u636e\nString[] split = line.split(\"\\t\");\n\n//3 \u6293\u53d6\u6211\u4eec\u9700\u8981\u7684\u6570\u636e:\u624b\u673a\u53f7,\u4e0a\u884c\u6d41\u91cf,\u4e0b\u884c\u6d41\u91cf\nString phone = split[1];\nString up = split[split.length - 3];\nString down = split[split.length - 2];\n\n//4 \u5c01\u88c5outK outV\noutK.set(phone);\noutV.setUpFlow(Long.parseLong(up));\noutV.setDownFlow(Long.parseLong(down));\noutV.setSumFlow();\n\n//5 \u5199\u51faoutK outV\ncontext.write(outK, outV);\n}\n}\n</code></pre> <p>\uff083\uff09\u7f16\u5199 Reducer \u7c7b</p> <pre><code>package com.atguigu.mapreduce.writable;\n\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport java.io.IOException;\n\npublic class FlowReducer extends Reducer&lt;Text, FlowBean, Text, FlowBean&gt; {\nprivate FlowBean outV = new FlowBean();\n@Override\nprotected void reduce(Text key, Iterable&lt;FlowBean&gt; values, Context context) throws IOException, InterruptedException {\n\nlong totalUp = 0;\nlong totalDown = 0;\n\n//1 \u904d\u5386values,\u5c06\u5176\u4e2d\u7684\u4e0a\u884c\u6d41\u91cf,\u4e0b\u884c\u6d41\u91cf\u5206\u522b\u7d2f\u52a0\nfor (FlowBean flowBean : values) {\ntotalUp += flowBean.getUpFlow();\ntotalDown += flowBean.getDownFlow();\n}\n\n//2 \u5c01\u88c5outKV\noutV.setUpFlow(totalUp);\noutV.setDownFlow(totalDown);\noutV.setSumFlow();\n\n//3 \u5199\u51faoutK outV\ncontext.write(key,outV);\n}\n}\n</code></pre> <p>\uff084\uff09\u7f16\u5199 Driver \u9a71\u52a8\u7c7b</p> <pre><code>package com.atguigu.mapreduce.writable;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport java.io.IOException;\n\npublic class FlowDriver {\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n//1 \u83b7\u53d6job\u5bf9\u8c61\nConfiguration conf = new Configuration();\nJob job = Job.getInstance(conf);\n\n//2 \u5173\u8054\u672cDriver\u7c7b\njob.setJarByClass(FlowDriver.class);\n\n//3 \u5173\u8054Mapper\u548cReducer\njob.setMapperClass(FlowMapper.class);\njob.setReducerClass(FlowReducer.class);\n\n//4 \u8bbe\u7f6eMap\u7aef\u8f93\u51faKV\u7c7b\u578b\njob.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(FlowBean.class);\n\n//5 \u8bbe\u7f6e\u7a0b\u5e8f\u6700\u7ec8\u8f93\u51fa\u7684KV\u7c7b\u578b\njob.setOutputKeyClass(Text.class);\njob.setOutputValueClass(FlowBean.class);\n\n//6 \u8bbe\u7f6e\u7a0b\u5e8f\u7684\u8f93\u5165\u8f93\u51fa\u8def\u5f84\nFileInputFormat.setInputPaths(job, new Path(\"D:\\\\inputflow\"));\nFileOutputFormat.setOutputPath(job, new Path(\"D:\\\\flowoutput\"));\n\n//7 \u63d0\u4ea4Job\nboolean b = job.waitForCompletion(true);\nSystem.exit(b ? 0 : 1);\n}\n}\n</code></pre>"},{"location":"hadoop/hdp_13/","title":"\u7b2c3\u7ae0 MapReduce\u6846\u67b6\u539f\u7406","text":""},{"location":"hadoop/hdp_13/#31-inputformat","title":"3.1 InputFormat\u6570\u636e\u8f93\u5165","text":""},{"location":"hadoop/hdp_13/#311-maptask","title":"3.1.1 \u5207\u7247\u4e0eMapTask\u5e76\u884c\u5ea6\u51b3\u5b9a\u673a\u5236","text":"<p>1\uff09\u95ee\u9898\u5f15\u51fa</p> <p>MapTask \u7684\u5e76\u884c\u5ea6\u51b3\u5b9a Map \u9636\u6bb5\u7684\u4efb\u52a1\u5904\u7406\u5e76\u53d1\u5ea6\uff0c\u8fdb\u800c\u5f71\u54cd\u5230\u6574\u4e2a Job \u7684\u5904\u7406\u901f\u5ea6\u3002</p> <p>\u601d\u8003</p> <p>1G \u7684\u6570\u636e\uff0c\u542f\u52a8 8 \u4e2a MapTask\uff0c\u53ef\u4ee5\u63d0\u9ad8\u96c6\u7fa4\u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3002\u90a3\u4e48 1K \u7684\u6570\u636e\uff0c\u4e5f\u542f\u52a8 8 \u4e2a MapTask\uff0c\u4f1a\u63d0\u9ad8\u96c6\u7fa4\u6027\u80fd\u5417\uff1fMapTask \u5e76\u884c\u4efb\u52a1\u662f\u5426\u8d8a\u591a\u8d8a\u597d\u5462\uff1f\u54ea\u4e9b\u56e0\u7d20\u5f71\u54cd\u4e86 MapTask \u5e76\u884c\u5ea6\uff1f</p> <p>2\uff09MapTask \u5e76\u884c\u5ea6\u51b3\u5b9a\u673a\u5236</p> <ul> <li>\u6570\u636e\u5757\uff1aBlock \u662f HDFS \u7269\u7406\u4e0a\u628a\u6570\u636e\u5206\u6210\u4e00\u5757\u4e00\u5757\u3002\u6570\u636e\u5757\u662f HDFS \u5b58\u50a8\u6570\u636e\u5355\u4f4d\u3002</li> <li>\u6570\u636e\u5207\u7247\uff1a\u6570\u636e\u5207\u7247\u53ea\u662f\u5728\u903b\u8f91\u4e0a\u5bf9\u8f93\u5165\u8fdb\u884c\u5206\u7247\uff0c\u5e76\u4e0d\u4f1a\u5728\u78c1\u76d8\u4e0a\u5c06\u5176\u5207\u5206\u6210\u7247\u8fdb\u884c\u5b58\u50a8\u3002\u6570\u636e\u5207\u7247\u662f MapReduce \u7a0b\u5e8f\u8ba1\u7b97\u8f93\u5165\u6570\u636e\u7684\u5355\u4f4d\uff0c\u4e00\u4e2a\u5207\u7247\u4f1a\u5bf9\u5e94\u542f\u52a8\u4e00\u4e2a MapTask\u3002</li> </ul> <p></p>"},{"location":"hadoop/hdp_13/#312-job","title":"3.1.2 Job\u63d0\u4ea4\u6d41\u7a0b\u6e90\u7801\u548c\u5207\u7247\u6e90\u7801\u8be6\u89e3","text":"<p>1\uff09Job \u63d0\u4ea4\u6d41\u7a0b\u6e90\u7801\u8be6\u89e3</p> <pre><code>waitForCompletion()\n\nsubmit();\n\n// 1\u5efa\u7acb\u8fde\u63a5\nconnect();  // 1\uff09\u521b\u5efa\u63d0\u4ea4Job\u7684\u4ee3\u7406\nnew Cluster(getConfiguration());\n// \uff081\uff09\u5224\u65ad\u662f\u672c\u5730\u8fd0\u884c\u73af\u5883\u8fd8\u662fyarn\u96c6\u7fa4\u8fd0\u884c\u73af\u5883\ninitialize(jobTrackAddr, conf); // 2 \u63d0\u4ea4job\nsubmitter.submitJobInternal(Job.this, cluster)\n\n// 1\uff09\u521b\u5efa\u7ed9\u96c6\u7fa4\u63d0\u4ea4\u6570\u636e\u7684Stag\u8def\u5f84\nPath jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf);\n\n// 2\uff09\u83b7\u53d6jobid \uff0c\u5e76\u521b\u5efaJob\u8def\u5f84\nJobID jobId = submitClient.getNewJobID();\n\n// 3\uff09\u62f7\u8d1djar\u5305\u5230\u96c6\u7fa4\ncopyAndConfigureFiles(job, submitJobDir);   rUploader.uploadFiles(job, jobSubmitDir);\n\n// 4\uff09\u8ba1\u7b97\u5207\u7247\uff0c\u751f\u6210\u5207\u7247\u89c4\u5212\u6587\u4ef6\nwriteSplits(job, submitJobDir);\nmaps = writeNewSplits(job, jobSubmitDir);\ninput.getSplits(job);\n\n// 5\uff09\u5411Stag\u8def\u5f84\u5199XML\u914d\u7f6e\u6587\u4ef6\nwriteConf(conf, submitJobFile);\nconf.writeXml(out);\n\n// 6\uff09\u63d0\u4ea4Job,\u8fd4\u56de\u63d0\u4ea4\u72b6\u6001\nstatus = submitClient.submitJob(jobId, submitJobDir.toString(), job.getCredentials());\n</code></pre> <p> </p> Job\u63d0\u4ea4\u6d41\u7a0b\u6e90\u7801\u5206\u6790 <p>2\uff09FileInputFormat \u5207\u7247\u6e90\u7801\u89e3\u6790\uff08<code>input.getSplits(job)</code>\uff09</p> <p></p>"},{"location":"hadoop/hdp_13/#313-fileinputformat","title":"3.1.3 FileInputFormat\u5207\u7247\u673a\u5236","text":"FileInputFormat\u5207\u7247\u673a\u5236 FileInputFormat\u5207\u7247\u5927\u5c0f\u7684\u53c2\u6570\u914d\u7f6e"},{"location":"hadoop/hdp_13/#314-textinputformat","title":"3.1.4 TextInputFormat","text":"<p>1\uff09FileInputFormat \u5b9e\u73b0\u7c7b</p> <p>\u601d\u8003</p> <p>\u5728\u8fd0\u884c MapReduce \u7a0b\u5e8f\u65f6\uff0c\u8f93\u5165\u7684\u6587\u4ef6\u683c\u5f0f\u5305\u62ec\uff1a\u57fa\u4e8e\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3001\u4e8c\u8fdb\u5236\u683c\u5f0f\u6587\u4ef6\u3001\u6570\u636e\u5e93\u8868\u7b49\u3002\u90a3\u4e48\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0cMapReduce \u662f\u5982\u4f55\u8bfb\u53d6\u8fd9\u4e9b\u6570\u636e\u7684\u5462\uff1f</p> <p>FileInputFormat \u5e38\u89c1\u7684\u63a5\u53e3\u5b9e\u73b0\u7c7b\u5305\u62ec\uff1aTextInputFormat\u3001KeyValueTextInputFormat\u3001NLineInputFormat\u3001CombineTextInputFormat \u548c\u81ea\u5b9a\u4e49 InputFormat \u7b49\u3002</p> <p>2\uff09TextInputFormat</p> <p>TextInputFormat \u662f\u9ed8\u8ba4\u7684 FileInputFormat \u5b9e\u73b0\u7c7b\u3002\u6309\u884c\u8bfb\u53d6\u6bcf\u6761\u8bb0\u5f55\u3002\u952e\u662f\u5b58\u50a8\u8be5\u884c\u5728\u6574\u4e2a\u6587\u4ef6\u4e2d\u7684\u8d77\u59cb\u5b57\u8282\u504f\u79fb\u91cf\uff0c LongWritable \u7c7b\u578b\u3002\u503c\u662f\u8fd9\u884c\u7684\u5185\u5bb9\uff0c\u4e0d\u5305\u62ec\u4efb\u4f55\u884c\u7ec8\u6b62\u7b26\uff08\u6362\u884c\u7b26\u548c\u56de\u8f66\u7b26\uff09\uff0cText \u7c7b\u578b\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u6bd4\u5982\uff0c\u4e00\u4e2a\u5206\u7247\u5305\u542b\u4e86\u5982\u4e0b 4 \u6761\u6587\u672c\u8bb0\u5f55\u3002</p> <pre><code>Rich learning form\nIntelligent learning engine\nLearning more convenient\nFrom the real demand for more close to the enterprise\n</code></pre> <p>\u6bcf\u6761\u8bb0\u5f55\u8868\u793a\u4e3a\u4ee5\u4e0b\u952e/\u503c\u5bf9\uff1a</p> <pre><code>(0,Rich learning form)\n(20,Intelligent learning engine)\n(49,Learning more convenient)\n(74,From the real demand for more close to the enterprise)\n</code></pre>"},{"location":"hadoop/hdp_13/#315-combinetextinputformat","title":"3.1.5 CombineTextInputFormat\u5207\u7247\u673a\u5236","text":"<p>\u6846\u67b6\u9ed8\u8ba4\u7684 TextInputFormat \u5207\u7247\u673a\u5236\u662f\u5bf9\u4efb\u52a1\u6309\u6587\u4ef6\u89c4\u5212\u5207\u7247\uff0c\u4e0d\u7ba1\u6587\u4ef6\u591a\u5c0f\uff0c\u90fd\u4f1a\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u5207\u7247\uff0c\u90fd\u4f1a\u4ea4\u7ed9\u4e00\u4e2a MapTask\uff0c\u8fd9\u6837\u5982\u679c\u6709\u5927\u91cf\u5c0f\u6587\u4ef6\uff0c\u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684 MapTask\uff0c\u5904\u7406\u6548\u7387\u6781\u5176\u4f4e\u4e0b\u3002</p> <p>1\uff09\u5e94\u7528\u573a\u666f</p> <p>CombineTextInputFormat \u7528\u4e8e\u5c0f\u6587\u4ef6\u8fc7\u591a\u7684\u573a\u666f\uff0c\u5b83\u53ef\u4ee5\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u4ece\u903b\u8f91\u4e0a\u89c4\u5212\u5230\u4e00\u4e2a\u5207\u7247\u4e2d\uff0c\u8fd9\u6837\uff0c\u591a\u4e2a\u5c0f\u6587\u4ef6\u5c31\u53ef\u4ee5\u4ea4\u7ed9\u4e00\u4e2a MapTask \u5904\u7406\u3002</p> <p>2\uff09\u865a\u62df\u5b58\u50a8\u5207\u7247\u6700\u5927\u503c\u8bbe\u7f6e</p> <p><code>CombineTextInputFormat.setMaxInputSplitSize(job, 4194304);// 4m</code></p> <p>\u6ce8\u610f</p> <p>\u865a\u62df\u5b58\u50a8\u5207\u7247\u6700\u5927\u503c\u8bbe\u7f6e\u6700\u597d\u6839\u636e\u5b9e\u9645\u7684\u5c0f\u6587\u4ef6\u5927\u5c0f\u60c5\u51b5\u6765\u8bbe\u7f6e\u5177\u4f53\u7684\u503c\u3002</p> <p>3\uff09\u5207\u7247\u673a\u5236</p> <p>\u751f\u6210\u5207\u7247\u8fc7\u7a0b\u5305\u62ec\uff1a\u865a\u62df\u5b58\u50a8\u8fc7\u7a0b\u548c\u5207\u7247\u8fc7\u7a0b\u4e8c\u90e8\u5206\u3002</p> <p></p> <p>\uff081\uff09\u865a\u62df\u5b58\u50a8\u8fc7\u7a0b\uff1a</p> <p>\u5c06\u8f93\u5165\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u5927\u5c0f\uff0c\u4f9d\u6b21\u548c\u8bbe\u7f6e\u7684 setMaxInputSplitSize \u503c\u6bd4\u8f83\uff0c\u5982\u679c\u4e0d\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u503c\uff0c\u903b\u8f91\u4e0a\u5212\u5206\u4e00\u4e2a\u5757\u3002\u5982\u679c\u8f93\u5165\u6587\u4ef6\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u4e14\u5927\u4e8e\u4e24\u500d\uff0c\u90a3\u4e48\u4ee5\u6700\u5927\u503c\u5207\u5272\u4e00\u5757\uff1b\u5f53\u5269\u4f59\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u4e14\u4e0d\u5927\u4e8e\u6700\u5927\u503c 2 \u500d\uff0c\u6b64\u65f6\u5c06\u6587\u4ef6\u5747\u5206\u6210 2 \u4e2a\u865a\u62df\u5b58\u50a8\u5757\uff08\u9632\u6b62\u51fa\u73b0\u592a\u5c0f\u5207\u7247\uff09\u3002</p> <p>\u4f8b\u5982 setMaxInputSplitSize \u503c\u4e3a 4M\uff0c\u8f93\u5165\u6587\u4ef6\u5927\u5c0f\u4e3a 8.02 M\uff0c\u5219\u5148\u903b\u8f91\u4e0a \u5206\u6210\u4e00\u4e2a 4M\u3002\u5269\u4f59\u7684\u5927\u5c0f\u4e3a 4.02M\uff0c\u5982\u679c\u6309\u7167 4M \u903b\u8f91\u5212\u5206\uff0c\u5c31\u4f1a\u51fa\u73b0 0.02M \u7684\u5c0f\u7684\u865a\u62df\u5b58\u50a8\u6587\u4ef6\uff0c\u6240\u4ee5\u5c06\u5269\u4f59\u7684 4.02M \u6587\u4ef6\u5207\u5206\u6210\uff082.01M \u548c 2.01M\uff09\u4e24\u4e2a\u6587\u4ef6\u3002</p> <p>\uff082\uff09\u5207\u7247\u8fc7\u7a0b\uff1a</p> <p>\u2460\u5224\u65ad\u865a\u62df\u5b58\u50a8\u7684\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e setMaxInputSplitSize \u503c\uff0c\u5927\u4e8e\u7b49\u4e8e\u5219\u5355\u72ec\u5f62\u6210\u4e00\u4e2a\u5207\u7247\u3002</p> <p>\u2461\u5982\u679c\u4e0d\u5927\u4e8e\u5219\u8ddf\u4e0b\u4e00\u4e2a\u865a\u62df\u5b58\u50a8\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u5171\u540c\u5f62\u6210\u4e00\u4e2a\u5207\u7247\u3002</p> <p>\u2462\u6d4b\u8bd5\u4e3e\u4f8b\uff1a\u6709 4 \u4e2a\u5c0f\u6587\u4ef6\u5927\u5c0f\u5206\u522b\u4e3a 1.7M\u30015.1M\u30013.4M \u4ee5\u53ca 6.8M \u8fd9\u56db\u4e2a\u5c0f\u6587\u4ef6\uff0c\u5219\u865a\u62df\u5b58\u50a8\u4e4b\u540e\u5f62\u6210 6 \u4e2a\u6587\u4ef6\u5757\uff0c\u5927\u5c0f\u5206\u522b\u4e3a\uff1a 1.7M\uff0c\uff082.55M\u30012.55M\uff09\uff0c3.4M\u4ee5\u53ca\uff083.4M\u30013.4M\uff09 \u6700\u7ec8\u4f1a\u5f62\u6210 3 \u4e2a\u5207\u7247\uff0c\u5927\u5c0f\u5206\u522b\u4e3a\uff1a \uff081.7 + 2.55\uff09M\uff0c\uff082.55 + 3.4M \uff0c\uff083.4 + 3.4\uff09M</p>"},{"location":"hadoop/hdp_13/#316-combinetextinputformat","title":"3.1.6 CombineTextInputFormat\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u9700\u6c42</p> <p>\u5c06\u8f93\u5165\u7684\u5927\u91cf\u5c0f\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2a\u5207\u7247\u7edf\u4e00\u5904\u7406\u3002</p> <p>\uff081\uff09\u8f93\u5165\u6570\u636e</p> <p>\u51c6\u5907 4 \u4e2a\u5c0f\u6587\u4ef6</p> <p>\uff082\uff09\u671f\u671b</p> <p>\u671f\u671b\u4e00\u4e2a\u5207\u7247\u5904\u7406 4 \u4e2a\u6587\u4ef6</p> <p>2\uff09\u5b9e\u73b0\u8fc7\u7a0b</p> <p>\uff081\uff09\u4e0d\u505a\u4efb\u4f55\u5904\u7406\uff0c\u8fd0\u884c 1.8 \u8282\u7684 WordCount \u6848\u4f8b\u7a0b\u5e8f\uff0c\u89c2\u5bdf\u5207\u7247\u4e2a\u6570\u4e3a 4\u3002</p> <pre><code>number of splits:4\n</code></pre> <p>\uff082\uff09\u5728 WordcountDriver \u4e2d\u589e\u52a0\u5982\u4e0b\u4ee3\u7801\uff0c\u8fd0\u884c\u7a0b\u5e8f\uff0c\u5e76\u89c2\u5bdf\u8fd0\u884c\u7684\u5207\u7247\u4e2a\u6570\u4e3a 3\u3002</p> <p>\u2460\u9a71\u52a8\u7c7b\u4e2d\u6dfb\u52a0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>// \u5982\u679c\u4e0d\u8bbe\u7f6eInputFormat\uff0c\u5b83\u9ed8\u8ba4\u7528\u7684\u662fTextInputFormat.class\njob.setInputFormatClass(CombineTextInputFormat.class);\n\n//\u865a\u62df\u5b58\u50a8\u5207\u7247\u6700\u5927\u503c\u8bbe\u7f6e4m\nCombineTextInputFormat.setMaxInputSplitSize(job, 4194304);\n</code></pre> <p>\u200b   \u2461\u8fd0\u884c\u5982\u679c\u4e3a 3 \u4e2a\u5207\u7247\u3002</p> <pre><code>number of splits:3\n</code></pre> <p>\uff083\uff09\u5728 WordcountDriver \u4e2d\u589e\u52a0\u5982\u4e0b\u4ee3\u7801\uff0c\u8fd0\u884c\u7a0b\u5e8f\uff0c\u5e76\u89c2\u5bdf\u8fd0\u884c\u7684\u5207\u7247\u4e2a\u6570\u4e3a 1\u3002</p> <p>\u2460\u9a71\u52a8\u4e2d\u6dfb\u52a0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>// \u5982\u679c\u4e0d\u8bbe\u7f6eInputFormat\uff0c\u5b83\u9ed8\u8ba4\u7528\u7684\u662fTextInputFormat.class\njob.setInputFormatClass(CombineTextInputFormat.class);\n\n//\u865a\u62df\u5b58\u50a8\u5207\u7247\u6700\u5927\u503c\u8bbe\u7f6e20m\nCombineTextInputFormat.setMaxInputSplitSize(job, 20971520);\n</code></pre> <p>\u2461\u8fd0\u884c\u5982\u679c\u4e3a 1 \u4e2a\u5207\u7247\u3002</p> <pre><code>number of splits:1\n</code></pre>"},{"location":"hadoop/hdp_13/#32-mapreduce","title":"3.2 MapReduce\u5de5\u4f5c\u6d41\u7a0b","text":"<p>\u4e0a\u9762\u7684\u6d41\u7a0b\u662f\u6574\u4e2a MapReduce \u6700\u5168\u5de5\u4f5c\u6d41\u7a0b\uff0c\u4f46\u662f Shuffle \u8fc7\u7a0b\u53ea\u662f\u4ece\u7b2c 7 \u6b65\u5f00\u59cb\u5230\u7b2c 16 \u6b65\u7ed3\u675f\uff0c\u5177\u4f53 Shuffle \u8fc7\u7a0b\u8be6\u89e3\uff0c\u5982\u4e0b\uff1a</p> <p>\uff081\uff09MapTask \u6536\u96c6\u6211\u4eec\u7684 map() \u65b9\u6cd5\u8f93\u51fa\u7684 kv \u5bf9\uff0c\u653e\u5230\u5185\u5b58\u7f13\u51b2\u533a\u4e2d</p> <p>\uff082\uff09\u4ece\u5185\u5b58\u7f13\u51b2\u533a\u4e0d\u65ad\u6ea2\u51fa\u672c\u5730\u78c1\u76d8\u6587\u4ef6\uff0c\u53ef\u80fd\u4f1a\u6ea2\u51fa\u591a\u4e2a\u6587\u4ef6</p> <p>\uff083\uff09\u591a\u4e2a\u6ea2\u51fa\u6587\u4ef6\u4f1a\u88ab\u5408\u5e76\u6210\u5927\u7684\u6ea2\u51fa\u6587\u4ef6</p> <p>\uff084\uff09\u5728\u6ea2\u51fa\u8fc7\u7a0b\u53ca\u5408\u5e76\u7684\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u8981\u8c03\u7528 Partitioner \u8fdb\u884c\u5206\u533a\u548c\u9488\u5bf9 key \u8fdb\u884c\u6392\u5e8f</p> <p>\uff085\uff09ReduceTask \u6839\u636e\u81ea\u5df1\u7684\u5206\u533a\u53f7\uff0c\u53bb\u5404\u4e2a MapTask \u673a\u5668\u4e0a\u53d6\u76f8\u5e94\u7684\u7ed3\u679c\u5206\u533a\u6570\u636e</p> <p>\uff086\uff09ReduceTask \u4f1a\u6293\u53d6\u5230\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6765\u81ea\u4e0d\u540c MapTask \u7684\u7ed3\u679c\u6587\u4ef6\uff0cReduceTask \u4f1a\u5c06\u8fd9\u4e9b\u6587\u4ef6\u518d\u8fdb\u884c\u5408\u5e76\uff08\u5f52\u5e76\u6392\u5e8f\uff09</p> <p>\uff087\uff09\u5408\u5e76\u6210\u5927\u6587\u4ef6\u540e\uff0cShuffle \u7684\u8fc7\u7a0b\u4e5f\u5c31\u7ed3\u675f\u4e86\uff0c\u540e\u9762\u8fdb\u5165 ReduceTask \u7684\u903b\u8f91\u8fd0\u7b97\u8fc7\u7a0b\uff08\u4ece\u6587\u4ef6\u4e2d\u53d6\u51fa\u4e00\u4e2a\u4e00\u4e2a\u7684\u952e\u503c\u5bf9 Group\uff0c\u8c03\u7528\u7528\u6237\u81ea\u5b9a\u4e49\u7684 reduce() \u65b9\u6cd5\uff09</p> <p>\u6ce8\u610f</p> <p>\uff081\uff09Shuffle \u4e2d\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u4f1a\u5f71\u54cd\u5230 MapReduce \u7a0b\u5e8f\u7684\u6267\u884c\u6548\u7387\uff0c\u539f\u5219\u4e0a\u8bf4\uff0c\u7f13\u51b2\u533a\u8d8a\u5927\uff0c\u78c1\u76d8 io \u7684\u6b21\u6570\u8d8a\u5c11\uff0c\u6267\u884c\u901f\u5ea6\u5c31\u8d8a\u5feb\u3002</p> <p>\uff082\uff09\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u8c03\u6574\uff0c\u53c2\u6570\uff1a<code>mapreduce.task.io.sort.mb</code> \u9ed8\u8ba4 100M\u3002</p>"},{"location":"hadoop/hdp_13/#33-shuffle","title":"3.3 Shuffle\u673a\u5236","text":""},{"location":"hadoop/hdp_13/#331-shuffle","title":"3.3.1 Shuffle\u673a\u5236","text":"<p>Map \u65b9\u6cd5\u4e4b\u540e\uff0cReduce \u65b9\u6cd5\u4e4b\u524d\u7684\u6570\u636e\u5904\u7406\u8fc7\u7a0b\u79f0\u4e4b\u4e3a Shuffle\u3002</p> <p></p>"},{"location":"hadoop/hdp_13/#332-partition","title":"3.3.2 Partition\u5206\u533a","text":""},{"location":"hadoop/hdp_13/#333-partition","title":"3.3.3 Partition\u5206\u533a\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u9700\u6c42</p> <p>\u5c06\u7edf\u8ba1\u7ed3\u679c\u6309\u7167\u624b\u673a\u5f52\u5c5e\u5730\u4e0d\u540c\u7701\u4efd\u8f93\u51fa\u5230\u4e0d\u540c\u6587\u4ef6\u4e2d\uff08\u5206\u533a\uff09</p> <p>\uff081\uff09\u8f93\u5165\u6570\u636e</p> phone_data.txt<pre><code>1   13736230513 192.196.100.1   www.atguigu.com 2481    24681   200\n2   13846544121 192.196.100.2           264 0   200\n3   13956435636 192.196.100.3           132 1512    200\n4   13966251146 192.168.100.1           240 0   404\n5   18271575951 192.168.100.2   www.atguigu.com 1527    2106    200\n6   84188413    192.168.100.3   www.atguigu.com 4116    1432    200\n7   13590439668 192.168.100.4           1116    954 200\n8   15910133277 192.168.100.5   www.hao123.com  3156    2936    200\n9   13729199489 192.168.100.6           240 0   200\n10  13630577991 192.168.100.7   www.shouhu.com  6960    690 200\n11  15043685818 192.168.100.8   www.baidu.com   3659    3538    200\n12  15959002129 192.168.100.9   www.atguigu.com 1938    180 500\n13  13560439638 192.168.100.10          918 4938    200\n14  13470253144 192.168.100.11          180 180 200\n15  13682846555 192.168.100.12  www.qq.com  1938    2910    200\n16  13992314666 192.168.100.13  www.gaga.com    3008    3720    200\n17  13509468723 192.168.100.14  www.qinghua.com 7335    110349  404\n18  18390173782 192.168.100.15  www.sogou.com   9531    2412    200\n19  13975057813 192.168.100.16  www.baidu.com   11058   48243   200\n20  13768778790 192.168.100.17          120 120 200\n21  13568436656 192.168.100.18  www.alibaba.com 2481    24681   200\n22  13568436656 192.168.100.19          1116    954 200\n</code></pre> <p>\uff082\uff09\u671f\u671b\u8f93\u51fa\u6570\u636e</p> <p>\u200b   \u624b\u673a\u53f7 136\u3001137\u3001138\u3001139 \u5f00\u5934\u90fd\u5206\u522b\u653e\u5230\u4e00\u4e2a\u72ec\u7acb\u7684 4 \u4e2a\u6587\u4ef6\u4e2d\uff0c\u5176\u4ed6\u5f00\u5934\u7684\u653e\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002</p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p></p> <p>3\uff09\u5728\u6848\u4f8b 2.3 \u7684\u57fa\u7840\u4e0a\uff0c\u589e\u52a0\u4e00\u4e2a\u5206\u533a\u7c7b</p> <pre><code>package com.atguigu.mapreduce.partitioner;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Partitioner;\n\npublic class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; {\n\n@Override\npublic int getPartition(Text text, FlowBean flowBean, int numPartitions) {\n//\u83b7\u53d6\u624b\u673a\u53f7\u524d\u4e09\u4f4dprePhone\nString phone = text.toString();\nString prePhone = phone.substring(0, 3);\n\n//\u5b9a\u4e49\u4e00\u4e2a\u5206\u533a\u53f7\u53d8\u91cfpartition,\u6839\u636eprePhone\u8bbe\u7f6e\u5206\u533a\u53f7\nint partition;\n\nif(\"136\".equals(prePhone)){\npartition = 0;\n}else if(\"137\".equals(prePhone)){\npartition = 1;\n}else if(\"138\".equals(prePhone)){\npartition = 2;\n}else if(\"139\".equals(prePhone)){\npartition = 3;\n}else {\npartition = 4;\n}\n\n//\u6700\u540e\u8fd4\u56de\u5206\u533a\u53f7partition\nreturn partition;\n}\n}\n</code></pre> <p>4\uff09\u5728\u9a71\u52a8\u51fd\u6570\u4e2d\u589e\u52a0\u81ea\u5b9a\u4e49\u6570\u636e\u5206\u533a\u8bbe\u7f6e\u548c ReduceTask \u8bbe\u7f6e</p> <pre><code>package com.atguigu.mapreduce.partitioner;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport java.io.IOException;\n\npublic class FlowDriver {\n\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n//1 \u83b7\u53d6job\u5bf9\u8c61\nConfiguration conf = new Configuration();\nJob job = Job.getInstance(conf);\n\n//2 \u5173\u8054\u672cDriver\u7c7b\njob.setJarByClass(FlowDriver.class);\n\n//3 \u5173\u8054Mapper\u548cReducer\njob.setMapperClass(FlowMapper.class);\njob.setReducerClass(FlowReducer.class);\n\n//4 \u8bbe\u7f6eMap\u7aef\u8f93\u51fa\u6570\u636e\u7684KV\u7c7b\u578b\njob.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(FlowBean.class);\n\n//5 \u8bbe\u7f6e\u7a0b\u5e8f\u6700\u7ec8\u8f93\u51fa\u7684KV\u7c7b\u578b\njob.setOutputKeyClass(Text.class);\njob.setOutputValueClass(FlowBean.class);\n\n//8 \u6307\u5b9a\u81ea\u5b9a\u4e49\u5206\u533a\u5668\njob.setPartitionerClass(ProvincePartitioner.class);\n\n//9 \u540c\u65f6\u6307\u5b9a\u76f8\u5e94\u6570\u91cf\u7684ReduceTask\njob.setNumReduceTasks(5);\n\n//6 \u8bbe\u7f6e\u8f93\u5165\u8f93\u51fa\u8def\u5f84\nFileInputFormat.setInputPaths(job, new Path(\"D:\\\\inputflow\"));\nFileOutputFormat.setOutputPath(job, new Path(\"D\\\\partitionout\"));\n\n//7 \u63d0\u4ea4Job\nboolean b = job.waitForCompletion(true);\nSystem.exit(b ? 0 : 1);\n}\n}\n</code></pre>"},{"location":"hadoop/hdp_13/#334-writablecomparable","title":"3.3.4 WritableComparable\u6392\u5e8f","text":"\u6392\u5e8f\u5206\u7c7b <p>\u81ea\u5b9a\u4e49\u6392\u5e8f WritableComparable \u539f\u7406\u5206\u6790</p> <p>bean \u5bf9\u8c61\u505a\u4e3a key \u4f20\u8f93\uff0c\u9700\u8981\u5b9e\u73b0 <code>WritableComparable</code> \u63a5\u53e3\u91cd\u5199 compareTo \u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6392\u5e8f\u3002</p> <pre><code>@Override\npublic int compareTo(FlowBean bean) {\n\nint result;\n\n// \u6309\u7167\u603b\u6d41\u91cf\u5927\u5c0f\uff0c\u5012\u5e8f\u6392\u5217\nif (this.sumFlow &gt; bean.getSumFlow()) {\nresult = -1;\n}else if (this.sumFlow &lt; bean.getSumFlow()) {\nresult = 1;\n}else {\nresult = 0;\n}\n\nreturn result;\n}\n</code></pre>"},{"location":"hadoop/hdp_13/#335-writablecomparable","title":"3.3.5 WritableComparable\u6392\u5e8f\u6848\u4f8b\u5b9e\u64cd\uff08\u5168\u6392\u5e8f\uff09","text":"<p>1\uff09\u9700\u6c42</p> <p>\u6839\u636e\u6848\u4f8b 2.3 \u5e8f\u5217\u5316\u6848\u4f8b\u4ea7\u751f\u7684\u7ed3\u679c\u518d\u6b21\u5bf9\u603b\u6d41\u91cf\u8fdb\u884c\u5012\u5e8f\u6392\u5e8f\u3002</p> <p>\uff081\uff09\u8f93\u5165\u6570\u636e</p> <p>\uff082\uff09\u671f\u671b\u8f93\u51fa\u6570\u636e</p> <pre><code>13509468723 7335    110349  117684\n13736230513 2481    24681   27162\n13956435636 132     1512    1644\n13846544121 264     0       264\n\u3002\u3002\u3002 \u3002\u3002\u3002\n</code></pre> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p></p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0</p> <p>\uff081\uff09FlowBean \u5bf9\u8c61\u5728\u5728\u9700\u6c42 1 \u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u6bd4\u8f83\u529f\u80fd</p> <pre><code>package com.atguigu.mapreduce.writablecompable;\n\nimport org.apache.hadoop.io.WritableComparable;\nimport java.io.DataInput;\nimport java.io.DataOutput;\nimport java.io.IOException;\n\npublic class FlowBean implements WritableComparable&lt;FlowBean&gt; {\n\nprivate long upFlow; //\u4e0a\u884c\u6d41\u91cf\nprivate long downFlow; //\u4e0b\u884c\u6d41\u91cf\nprivate long sumFlow; //\u603b\u6d41\u91cf\n\n//\u63d0\u4f9b\u65e0\u53c2\u6784\u9020\npublic FlowBean() {\n}\n\n//\u751f\u6210\u4e09\u4e2a\u5c5e\u6027\u7684getter\u548csetter\u65b9\u6cd5\npublic long getUpFlow() {\nreturn upFlow;\n}\n\npublic void setUpFlow(long upFlow) {\nthis.upFlow = upFlow;\n}\n\npublic long getDownFlow() {\nreturn downFlow;\n}\n\npublic void setDownFlow(long downFlow) {\nthis.downFlow = downFlow;\n}\n\npublic long getSumFlow() {\nreturn sumFlow;\n}\n\npublic void setSumFlow(long sumFlow) {\nthis.sumFlow = sumFlow;\n}\n\npublic void setSumFlow() {\nthis.sumFlow = this.upFlow + this.downFlow;\n}\n\n//\u5b9e\u73b0\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5,\u6ce8\u610f\u987a\u5e8f\u4e00\u5b9a\u8981\u4e00\u81f4\n@Override\npublic void write(DataOutput out) throws IOException {\nout.writeLong(this.upFlow);\nout.writeLong(this.downFlow);\nout.writeLong(this.sumFlow);\n\n}\n\n@Override\npublic void readFields(DataInput in) throws IOException {\nthis.upFlow = in.readLong();\nthis.downFlow = in.readLong();\nthis.sumFlow = in.readLong();\n}\n\n//\u91cd\u5199ToString,\u6700\u540e\u8981\u8f93\u51faFlowBean\n@Override\npublic String toString() {\nreturn upFlow + \"\\t\" + downFlow + \"\\t\" + sumFlow;\n}\n\n@Override\npublic int compareTo(FlowBean o) {\n\n//\u6309\u7167\u603b\u6d41\u91cf\u6bd4\u8f83,\u5012\u5e8f\u6392\u5217\nif(this.sumFlow &gt; o.sumFlow){\nreturn -1;\n}else if(this.sumFlow &lt; o.sumFlow){\nreturn 1;\n}else {\nreturn 0;\n}\n}\n}\n</code></pre> <p>\uff082\uff09\u7f16\u5199 Mapper \u7c7b</p> <pre><code>package com.atguigu.mapreduce.writablecompable;\n\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport java.io.IOException;\n\npublic class FlowMapper extends Mapper&lt;LongWritable, Text, FlowBean, Text&gt; {\nprivate FlowBean outK = new FlowBean();\nprivate Text outV = new Text();\n\n@Override\nprotected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\n//1 \u83b7\u53d6\u4e00\u884c\u6570\u636e\nString line = value.toString();\n\n//2 \u6309\u7167\"\\t\",\u5207\u5272\u6570\u636e\nString[] split = line.split(\"\\t\");\n\n//3 \u5c01\u88c5outK outV\noutK.setUpFlow(Long.parseLong(split[1]));\noutK.setDownFlow(Long.parseLong(split[2]));\noutK.setSumFlow();\noutV.set(split[0]);\n\n//4 \u5199\u51faoutK outV\ncontext.write(outK,outV);\n}\n}\n</code></pre> <p>\uff083\uff09\u7f16\u5199 Reducer \u7c7b</p> <pre><code>package com.atguigu.mapreduce.writablecompable;\n\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport java.io.IOException;\n\npublic class FlowReducer extends Reducer&lt;FlowBean, Text, Text, FlowBean&gt; {\n@Override\nprotected void reduce(FlowBean key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException {\n\n//\u904d\u5386values\u96c6\u5408,\u5faa\u73af\u5199\u51fa,\u907f\u514d\u603b\u6d41\u91cf\u76f8\u540c\u7684\u60c5\u51b5\nfor (Text value : values) {\n//\u8c03\u6362KV\u4f4d\u7f6e,\u53cd\u5411\u5199\u51fa\ncontext.write(value,key);\n}\n}\n}\n</code></pre> <p>\uff084\uff09\u7f16\u5199 Driver \u7c7b</p> <pre><code>package com.atguigu.mapreduce.writablecompable;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport java.io.IOException;\n\npublic class FlowDriver {\n\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n//1 \u83b7\u53d6job\u5bf9\u8c61\nConfiguration conf = new Configuration();\nJob job = Job.getInstance(conf);\n\n//2 \u5173\u8054\u672cDriver\u7c7b\njob.setJarByClass(FlowDriver.class);\n\n//3 \u5173\u8054Mapper\u548cReducer\njob.setMapperClass(FlowMapper.class);\njob.setReducerClass(FlowReducer.class);\n\n//4 \u8bbe\u7f6eMap\u7aef\u8f93\u51fa\u6570\u636e\u7684KV\u7c7b\u578b\njob.setMapOutputKeyClass(FlowBean.class);\njob.setMapOutputValueClass(Text.class);\n\n//5 \u8bbe\u7f6e\u7a0b\u5e8f\u6700\u7ec8\u8f93\u51fa\u7684KV\u7c7b\u578b\njob.setOutputKeyClass(Text.class);\njob.setOutputValueClass(FlowBean.class);\n\n//6 \u8bbe\u7f6e\u8f93\u5165\u8f93\u51fa\u8def\u5f84\nFileInputFormat.setInputPaths(job, new Path(\"D:\\\\inputflow2\"));\nFileOutputFormat.setOutputPath(job, new Path(\"D:\\\\comparout\"));\n\n//7 \u63d0\u4ea4Job\nboolean b = job.waitForCompletion(true);\nSystem.exit(b ? 0 : 1);\n}\n}\n</code></pre>"},{"location":"hadoop/hdp_13/#336-writablecomparable","title":"3.3.6 WritableComparable\u6392\u5e8f\u6848\u4f8b\u5b9e\u64cd\uff08\u533a\u5185\u6392\u5e8f\uff09","text":"<p>1\uff09\u9700\u6c42</p> <p>\u8981\u6c42\u6bcf\u4e2a\u7701\u4efd\u624b\u673a\u53f7\u8f93\u51fa\u7684\u6587\u4ef6\u4e2d\u6309\u7167\u603b\u6d41\u91cf\u5185\u90e8\u6392\u5e8f\u3002</p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p>\u57fa\u4e8e\u524d\u4e00\u4e2a\u9700\u6c42\uff0c\u589e\u52a0\u81ea\u5b9a\u4e49\u5206\u533a\u7c7b\uff0c\u5206\u533a\u6309\u7167\u7701\u4efd\u624b\u673a\u53f7\u8bbe\u7f6e\u3002</p> <p></p> <p>3\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u589e\u52a0\u81ea\u5b9a\u4e49\u5206\u533a\u7c7b</p> <pre><code>package com.atguigu.mapreduce.partitionercompable;\n\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Partitioner;\n\npublic class ProvincePartitioner2 extends Partitioner&lt;FlowBean, Text&gt; {\n\n@Override\npublic int getPartition(FlowBean flowBean, Text text, int numPartitions) {\n//\u83b7\u53d6\u624b\u673a\u53f7\u524d\u4e09\u4f4d\nString phone = text.toString();\nString prePhone = phone.substring(0, 3);\n\n//\u5b9a\u4e49\u4e00\u4e2a\u5206\u533a\u53f7\u53d8\u91cfpartition,\u6839\u636eprePhone\u8bbe\u7f6e\u5206\u533a\u53f7\nint partition;\nif(\"136\".equals(prePhone)){\npartition = 0;\n}else if(\"137\".equals(prePhone)){\npartition = 1;\n}else if(\"138\".equals(prePhone)){\npartition = 2;\n}else if(\"139\".equals(prePhone)){\npartition = 3;\n}else {\npartition = 4;\n}\n\n//\u6700\u540e\u8fd4\u56de\u5206\u533a\u53f7partition\nreturn partition;\n}\n}\n</code></pre> <p>\uff082\uff09\u5728\u9a71\u52a8\u7c7b\u4e2d\u6dfb\u52a0\u5206\u533a\u7c7b</p> <pre><code>// \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u5206\u533a\u5668\njob.setPartitionerClass(ProvincePartitioner2.class);\n\n// \u8bbe\u7f6e\u5bf9\u5e94\u7684ReduceTask\u7684\u4e2a\u6570\njob.setNumReduceTasks(5);\n</code></pre>"},{"location":"hadoop/hdp_13/#337-combiner","title":"3.3.7 Combiner\u5408\u5e76","text":"<p>\uff086\uff09\u81ea\u5b9a\u4e49 Combiner \u5b9e\u73b0\u6b65\u9aa4</p> <p>\u2460\u81ea\u5b9a\u4e49\u4e00\u4e2a Combiner \u7ee7\u627f Reducer\uff0c\u91cd\u5199 Reduce \u65b9\u6cd5</p> <pre><code>public class WordCountCombiner extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; {\n\nprivate IntWritable outV = new IntWritable();\n\n@Override\nprotected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException {\n\nint sum = 0;\nfor (IntWritable value : values) {\nsum += value.get();\n}\n\noutV.set(sum);\n\ncontext.write(key,outV);\n}\n}\n</code></pre> <p>\u2461\u5728 Job \u9a71\u52a8\u7c7b\u4e2d\u8bbe\u7f6e</p> <pre><code>job.setCombinerClass(WordCountCombiner.class);\n</code></pre>"},{"location":"hadoop/hdp_13/#338-combiner","title":"3.3.8 Combiner\u5408\u5e76\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u9700\u6c42</p> <p>\u7edf\u8ba1\u8fc7\u7a0b\u4e2d\u5bf9\u6bcf\u4e00\u4e2a MapTask \u7684\u8f93\u51fa\u8fdb\u884c\u5c40\u90e8\u6c47\u603b\uff0c\u4ee5\u51cf\u5c0f\u7f51\u7edc\u4f20\u8f93\u91cf\u5373\u91c7\u7528 Combiner \u529f\u80fd\u3002</p> <p>\uff081\uff09\u6570\u636e\u8f93\u5165</p> phone_data.txt<pre><code>atguigu atguigu\nss ss\ncls cls\njiao\nbanzhang\nxue\nhadoop\n</code></pre> <p>\uff082\uff09\u671f\u671b\u8f93\u51fa\u6570\u636e</p> <p>\u671f\u671b\uff1aCombine \u8f93\u5165\u6570\u636e\u591a\uff0c\u8f93\u51fa\u65f6\u7ecf\u8fc7\u5408\u5e76\uff0c\u8f93\u51fa\u6570\u636e\u964d\u4f4e\u3002</p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p></p> <p>3\uff09\u6848\u4f8b\u5b9e\u64cd-\u65b9\u6848\u4e00</p> <p>\uff081\uff09\u589e\u52a0\u4e00\u4e2a WordCountCombiner \u7c7b\u7ee7\u627f Reducer</p> <pre><code>ackage com.atguigu.mapreduce.combiner;\n\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport java.io.IOException;\n\npublic class WordCountCombiner extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; {\n\nprivate IntWritable outV = new IntWritable();\n\n@Override\nprotected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException {\n\nint sum = 0;\nfor (IntWritable value : values) {\nsum += value.get();\n}\n\n//\u5c01\u88c5outKV\noutV.set(sum);\n\n//\u5199\u51faoutKV\ncontext.write(key,outV);\n}\n}\n</code></pre> <p>\uff082\uff09\u5728 WordcountDriver \u9a71\u52a8\u7c7b\u4e2d\u6307\u5b9a Combiner</p> <pre><code>// \u6307\u5b9a\u9700\u8981\u4f7f\u7528combiner\uff0c\u4ee5\u53ca\u7528\u54ea\u4e2a\u7c7b\u4f5c\u4e3acombiner\u7684\u903b\u8f91\njob.setCombinerClass(WordCountCombiner.class);\n</code></pre> <p>4\uff09\u6848\u4f8b\u5b9e\u64cd-\u65b9\u6848\u4e8c</p> <p>\uff081\uff09\u5c06 WordcountReducer \u4f5c\u4e3a Combiner \u5728 WordcountDriver \u9a71\u52a8\u7c7b\u4e2d\u6307\u5b9a</p> <pre><code>// \u6307\u5b9a\u9700\u8981\u4f7f\u7528Combiner\uff0c\u4ee5\u53ca\u7528\u54ea\u4e2a\u7c7b\u4f5c\u4e3aCombiner\u7684\u903b\u8f91\njob.setCombinerClass(WordCountReducer.class);\n</code></pre> <p>\u8fd0\u884c\u7a0b\u5e8f\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> \u4f7f\u7528\u524d\u4f7f\u7528\u540e <p></p> <p></p>"},{"location":"hadoop/hdp_13/#34-outputformat","title":"3.4 OutputFormat\u6570\u636e\u8f93\u51fa","text":""},{"location":"hadoop/hdp_13/#341-outputformat","title":"3.4.1 OutputFormat\u63a5\u53e3\u5b9e\u73b0\u7c7b","text":""},{"location":"hadoop/hdp_13/#342-outputformat","title":"3.4.2 \u81ea\u5b9a\u4e49OutputFormat\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u9700\u6c42</p> <p>\u200b   \u8fc7\u6ee4\u8f93\u5165\u7684 log \u65e5\u5fd7\uff0c\u5305\u542b atguigu \u7684\u7f51\u7ad9\u8f93\u51fa\u5230 e:/atguigu.log\uff0c\u4e0d\u5305\u542b atguigu \u7684\u7f51\u7ad9\u8f93\u51fa\u5230 e:/other.log\u3002</p> <p>\uff081\uff09\u8f93\u5165\u6570\u636e</p> hello.txt<pre><code>http://www.baidu.com\nhttp://www.google.com\nhttp://cn.bing.com\nhttp://www.atguigu.com\nhttp://www.sohu.com\nhttp://www.sina.com\nhttp://www.sin2a.com\nhttp://www.sin2desa.com\nhttp://www.sindsafa.com\n</code></pre> <p>\uff082\uff09\u671f\u671b\u8f93\u51fa\u6570\u636e</p> <p>\u5305\u542b atguigu ===&gt; atguigu.txt \u5176\u4ed6 ==&gt; other.txt</p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p></p> <p>3\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u7f16\u5199 LogMapper \u7c7b</p> <pre><code>package com.atguigu.mapreduce.outputformat;\n\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\n\nimport java.io.IOException;\n\npublic class LogMapper extends Mapper&lt;LongWritable, Text,Text, NullWritable&gt; {\n@Override\nprotected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n//\u4e0d\u505a\u4efb\u4f55\u5904\u7406,\u76f4\u63a5\u5199\u51fa\u4e00\u884clog\u6570\u636e\ncontext.write(value,NullWritable.get());\n}\n}\n</code></pre> <p>\uff082\uff09\u7f16\u5199 LogReducer \u7c7b</p> <pre><code>package com.atguigu.mapreduce.outputformat;\n\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\n\nimport java.io.IOException;\n\npublic class LogReducer extends Reducer&lt;Text, NullWritable,Text, NullWritable&gt; {\n@Override\nprotected void reduce(Text key, Iterable&lt;NullWritable&gt; values, Context context) throws IOException, InterruptedException {\n// \u9632\u6b62\u6709\u76f8\u540c\u7684\u6570\u636e,\u8fed\u4ee3\u5199\u51fa\nfor (NullWritable value : values) {\ncontext.write(key,NullWritable.get());\n}\n}\n}\n</code></pre> <p>\uff083\uff09\u81ea\u5b9a\u4e49\u4e00\u4e2a LogOutputFormat \u7c7b</p> <pre><code>package com.atguigu.mapreduce.outputformat;\n\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.RecordWriter;\nimport org.apache.hadoop.mapreduce.TaskAttemptContext;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\n\npublic class LogOutputFormat extends FileOutputFormat&lt;Text, NullWritable&gt; {\n@Override\npublic RecordWriter&lt;Text, NullWritable&gt; getRecordWriter(TaskAttemptContext job) throws IOException, InterruptedException {\n//\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684RecordWriter\u8fd4\u56de\nLogRecordWriter logRecordWriter = new LogRecordWriter(job);\nreturn logRecordWriter;\n}\n}\n</code></pre> <p>\uff084\uff09\u7f16\u5199 LogRecordWriter \u7c7b</p> <pre><code>package com.atguigu.mapreduce.outputformat;\n\nimport org.apache.hadoop.fs.FSDataOutputStream;\nimport org.apache.hadoop.fs.FileSystem;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IOUtils;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.RecordWriter;\nimport org.apache.hadoop.mapreduce.TaskAttemptContext;\n\nimport java.io.IOException;\n\npublic class LogRecordWriter extends RecordWriter&lt;Text, NullWritable&gt; {\n\nprivate FSDataOutputStream atguiguOut;\nprivate FSDataOutputStream otherOut;\n\npublic LogRecordWriter(TaskAttemptContext job) {\ntry {\n//\u83b7\u53d6\u6587\u4ef6\u7cfb\u7edf\u5bf9\u8c61\nFileSystem fs = FileSystem.get(job.getConfiguration());\n//\u7528\u6587\u4ef6\u7cfb\u7edf\u5bf9\u8c61\u521b\u5efa\u4e24\u4e2a\u8f93\u51fa\u6d41\u5bf9\u5e94\u4e0d\u540c\u7684\u76ee\u5f55\natguiguOut = fs.create(new Path(\"d:/hadoop/atguigu.log\"));\notherOut = fs.create(new Path(\"d:/hadoop/other.log\"));\n} catch (IOException e) {\ne.printStackTrace();\n}\n}\n\n@Override\npublic void write(Text key, NullWritable value) throws IOException, InterruptedException {\nString log = key.toString();\n//\u6839\u636e\u4e00\u884c\u7684log\u6570\u636e\u662f\u5426\u5305\u542batguigu,\u5224\u65ad\u4e24\u6761\u8f93\u51fa\u6d41\u8f93\u51fa\u7684\u5185\u5bb9\nif (log.contains(\"atguigu\")) {\natguiguOut.writeBytes(log + \"\\n\");\n} else {\notherOut.writeBytes(log + \"\\n\");\n}\n}\n\n@Override\npublic void close(TaskAttemptContext context) throws IOException, InterruptedException {\n//\u5173\u6d41\nIOUtils.closeStream(atguiguOut);\nIOUtils.closeStream(otherOut);\n}\n}\n</code></pre> <p>\uff085\uff09\u7f16\u5199 LogDriver \u7c7b</p> <pre><code>package com.atguigu.mapreduce.outputformat;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\n\npublic class LogDriver {\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\nConfiguration conf = new Configuration();\nJob job = Job.getInstance(conf);\n\njob.setJarByClass(LogDriver.class);\njob.setMapperClass(LogMapper.class);\njob.setReducerClass(LogReducer.class);\n\njob.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(NullWritable.class);\n\njob.setOutputKeyClass(Text.class);\njob.setOutputValueClass(NullWritable.class);\n\n//\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684outputformat\njob.setOutputFormatClass(LogOutputFormat.class);\n\nFileInputFormat.setInputPaths(job, new Path(\"D:\\\\input\"));\n//\u867d\u7136\u6211\u4eec\u81ea\u5b9a\u4e49\u4e86outputformat\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u7684outputformat\u7ee7\u627f\u81eafileoutputformat\n//\u800cfileoutputformat\u8981\u8f93\u51fa\u4e00\u4e2a_SUCCESS\u6587\u4ef6\uff0c\u6240\u4ee5\u5728\u8fd9\u8fd8\u5f97\u6307\u5b9a\u4e00\u4e2a\u8f93\u51fa\u76ee\u5f55\nFileOutputFormat.setOutputPath(job, new Path(\"D:\\\\logoutput\"));\n\nboolean b = job.waitForCompletion(true);\nSystem.exit(b ? 0 : 1);\n}\n}\n</code></pre>"},{"location":"hadoop/hdp_13/#35-mapreduce","title":"3.5 MapReduce\u5185\u6838\u6e90\u7801\u89e3\u6790","text":""},{"location":"hadoop/hdp_13/#351-maptask","title":"3.5.1 MapTask\u5de5\u4f5c\u673a\u5236","text":"<p>\uff081\uff09Read \u9636\u6bb5\uff1aMapTask \u901a\u8fc7 InputFormat \u83b7\u5f97\u7684 RecordReader\uff0c\u4ece\u8f93\u5165 InputSplit \u4e2d\u89e3\u6790\u51fa\u4e00\u4e2a\u4e2a key/value\u3002</p> <p>\uff082\uff09Map \u9636\u6bb5\uff1a\u8be5\u8282\u70b9\u4e3b\u8981\u662f\u5c06\u89e3\u6790\u51fa\u7684 key/value \u4ea4\u7ed9\u7528\u6237\u7f16\u5199 map() \u51fd\u6570\u5904\u7406\uff0c\u5e76\u4ea7\u751f\u4e00\u7cfb\u5217\u65b0\u7684 key/value\u3002</p> <p>\uff083\uff09Collect \u6536\u96c6\u9636\u6bb5\uff1a\u5728\u7528\u6237\u7f16\u5199 map() \u51fd\u6570\u4e2d\uff0c\u5f53\u6570\u636e\u5904\u7406\u5b8c\u6210\u540e\uff0c\u4e00\u822c\u4f1a\u8c03\u7528 OutputCollector.collect() \u8f93\u51fa\u7ed3\u679c\u3002\u5728\u8be5\u51fd\u6570\u5185\u90e8\uff0c\u5b83\u4f1a\u5c06\u751f\u6210\u7684 key/value \u5206\u533a\uff08\u8c03\u7528 Partitioner\uff09\uff0c\u5e76\u5199\u5165\u4e00\u4e2a\u73af\u5f62\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\u3002</p> <p>\uff084\uff09Spill \u9636\u6bb5\uff1a\u5373\u201c\u6ea2\u5199\u201d\uff0c\u5f53\u73af\u5f62\u7f13\u51b2\u533a\u6ee1\u540e\uff0cMapReduce \u4f1a\u5c06\u6570\u636e\u5199\u5230\u672c\u5730\u78c1\u76d8\u4e0a\uff0c\u751f\u6210\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5c06\u6570\u636e\u5199\u5165\u672c\u5730\u78c1\u76d8\u4e4b\u524d\uff0c\u5148\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u672c\u5730\u6392\u5e8f\uff0c\u5e76\u5728\u5fc5\u8981\u65f6\u5bf9\u6570\u636e\u8fdb\u884c\u5408\u5e76\u3001\u538b\u7f29\u7b49\u64cd\u4f5c\u3002</p> <p>\u200b   \u6ea2\u5199\u9636\u6bb5\u8be6\u60c5\uff1a</p> <p>\u6b65\u9aa4 1\uff1a\u5229\u7528\u5feb\u901f\u6392\u5e8f\u7b97\u6cd5\u5bf9\u7f13\u5b58\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u6392\u5e8f\u65b9\u5f0f\u662f\uff0c\u5148\u6309\u7167\u5206\u533a\u7f16\u53f7 Partition \u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u6309\u7167 key \u8fdb\u884c\u6392\u5e8f\u3002\u8fd9\u6837\uff0c\u7ecf\u8fc7\u6392\u5e8f\u540e\uff0c\u6570\u636e\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u805a\u96c6\u5728\u4e00\u8d77\uff0c\u4e14\u540c\u4e00\u5206\u533a\u5185\u6240\u6709\u6570\u636e\u6309\u7167 key \u6709\u5e8f\u3002</p> <p>\u6b65\u9aa4 2\uff1a\u6309\u7167\u5206\u533a\u7f16\u53f7\u7531\u5c0f\u5230\u5927\u4f9d\u6b21\u5c06\u6bcf\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u5199\u5165\u4efb\u52a1\u5de5\u4f5c\u76ee\u5f55\u4e0b\u7684\u4e34\u65f6\u6587\u4ef6 output / spillN.out\uff08N \u8868\u793a\u5f53\u524d\u6ea2\u5199\u6b21\u6570\uff09\u4e2d\u3002\u5982\u679c\u7528\u6237\u8bbe\u7f6e\u4e86 Combiner\uff0c\u5219\u5199\u5165\u6587\u4ef6\u4e4b\u524d\uff0c\u5bf9\u6bcf\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u805a\u96c6\u64cd\u4f5c\u3002</p> <p>\u6b65\u9aa4 3\uff1a\u5c06\u5206\u533a\u6570\u636e\u7684\u5143\u4fe1\u606f\u5199\u5230\u5185\u5b58\u7d22\u5f15\u6570\u636e\u7ed3\u6784 SpillRecord \u4e2d\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5206\u533a\u7684\u5143\u4fe1\u606f\u5305\u62ec\u5728\u4e34\u65f6\u6587\u4ef6\u4e2d\u7684\u504f\u79fb\u91cf\u3001\u538b\u7f29\u524d\u6570\u636e\u5927\u5c0f\u548c\u538b\u7f29\u540e\u6570\u636e\u5927\u5c0f\u3002\u5982\u679c\u5f53\u524d\u5185\u5b58\u7d22\u5f15\u5927\u5c0f\u8d85\u8fc7 1MB\uff0c\u5219\u5c06\u5185\u5b58\u7d22\u5f15\u5199\u5230\u6587\u4ef6 output / spillN.out.index \u4e2d\u3002</p> <p>\uff085\uff09Merge \u9636\u6bb5\uff1a\u5f53\u6240\u6709\u6570\u636e\u5904\u7406\u5b8c\u6210\u540e\uff0cMapTask \u5bf9\u6240\u6709\u4e34\u65f6\u6587\u4ef6\u8fdb\u884c\u4e00\u6b21\u5408\u5e76\uff0c\u4ee5\u786e\u4fdd\u6700\u7ec8\u53ea\u4f1a\u751f\u6210\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\u3002</p> <p>\u5f53\u6240\u6709\u6570\u636e\u5904\u7406\u5b8c\u540e\uff0cMapTask \u4f1a\u5c06\u6240\u6709\u4e34\u65f6\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u6587\u4ef6\uff0c\u5e76\u4fdd\u5b58\u5230\u6587\u4ef6 output / file.out \u4e2d\uff0c\u540c\u65f6\u751f\u6210\u76f8\u5e94\u7684\u7d22\u5f15\u6587\u4ef6 output / file.out.index\u3002</p> <p>\u5728\u8fdb\u884c\u6587\u4ef6\u5408\u5e76\u8fc7\u7a0b\u4e2d\uff0cMapTask \u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u8fdb\u884c\u5408\u5e76\u3002\u5bf9\u4e8e\u67d0\u4e2a\u5206\u533a\uff0c\u5b83\u5c06\u91c7\u7528\u591a\u8f6e\u9012\u5f52\u5408\u5e76\u7684\u65b9\u5f0f\u3002\u6bcf\u8f6e\u5408\u5e76<code>mapreduce.task.io.sort.factor</code>\uff08\u9ed8\u8ba4 10\uff09\u4e2a\u6587\u4ef6\uff0c\u5e76\u5c06\u4ea7\u751f\u7684\u6587\u4ef6\u91cd\u65b0\u52a0\u5165\u5f85\u5408\u5e76\u5217\u8868\u4e2d\uff0c\u5bf9\u6587\u4ef6\u6392\u5e8f\u540e\uff0c\u91cd\u590d\u4ee5\u4e0a\u8fc7\u7a0b\uff0c\u76f4\u5230\u6700\u7ec8\u5f97\u5230\u4e00\u4e2a\u5927\u6587\u4ef6\u3002</p> <p>\u8ba9\u6bcf\u4e2a MapTask \u6700\u7ec8\u53ea\u751f\u6210\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u907f\u514d\u540c\u65f6\u6253\u5f00\u5927\u91cf\u6587\u4ef6\u548c\u540c\u65f6\u8bfb\u53d6\u5927\u91cf\u5c0f\u6587\u4ef6\u4ea7\u751f\u7684\u968f\u673a\u8bfb\u53d6\u5e26\u6765\u7684\u5f00\u9500\u3002</p>"},{"location":"hadoop/hdp_13/#352-reducetask","title":"3.5.2 ReduceTask\u5de5\u4f5c\u673a\u5236","text":"<p>\uff081\uff09Copy \u9636\u6bb5\uff1aReduceTask \u4ece\u5404\u4e2a MapTask \u4e0a\u8fdc\u7a0b\u62f7\u8d1d\u4e00\u7247\u6570\u636e\uff0c\u5e76\u9488\u5bf9\u67d0\u4e00\u7247\u6570\u636e\uff0c\u5982\u679c\u5176\u5927\u5c0f\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\uff0c\u5219\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u5426\u5219\u76f4\u63a5\u653e\u5230\u5185\u5b58\u4e2d\u3002</p> <p>\uff082\uff09Sort \u9636\u6bb5\uff1a\u5728\u8fdc\u7a0b\u62f7\u8d1d\u6570\u636e\u7684\u540c\u65f6\uff0cReduceTask \u542f\u52a8\u4e86\u4e24\u4e2a\u540e\u53f0\u7ebf\u7a0b\u5bf9\u5185\u5b58\u548c\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u4ee5\u9632\u6b62\u5185\u5b58\u4f7f\u7528\u8fc7\u591a\u6216\u78c1\u76d8\u4e0a\u6587\u4ef6\u8fc7\u591a\u3002\u6309\u7167 MapReduce \u8bed\u4e49\uff0c\u7528\u6237\u7f16\u5199 reduce() \u51fd\u6570\u8f93\u5165\u6570\u636e\u662f\u6309 key \u8fdb\u884c\u805a\u96c6\u7684\u4e00\u7ec4\u6570\u636e\u3002\u4e3a\u4e86\u5c06 key \u76f8\u540c\u7684\u6570\u636e\u805a\u5728\u4e00\u8d77\uff0cHadoop \u91c7\u7528\u4e86\u57fa\u4e8e\u6392\u5e8f\u7684\u7b56\u7565\u3002\u7531\u4e8e\u5404\u4e2a MapTask \u5df2\u7ecf\u5b9e\u73b0\u5bf9\u81ea\u5df1\u7684\u5904\u7406\u7ed3\u679c\u8fdb\u884c\u4e86\u5c40\u90e8\u6392\u5e8f\uff0c\u56e0\u6b64\uff0cReduceTask \u53ea\u9700\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5f52\u5e76\u6392\u5e8f\u5373\u53ef\u3002 \uff083\uff09Reduce \u9636\u6bb5\uff1areduce() \u51fd\u6570\u5c06\u8ba1\u7b97\u7ed3\u679c\u5199\u5230 HDFS \u4e0a\u3002</p>"},{"location":"hadoop/hdp_13/#353-reducetask","title":"3.5.3 ReduceTask\u5e76\u884c\u5ea6\u51b3\u5b9a\u673a\u5236","text":"<p>\u601d\u8003</p> <p>MapTask \u5e76\u884c\u5ea6\u7531\u5207\u7247\u4e2a\u6570\u51b3\u5b9a\uff0c\u5207\u7247\u4e2a\u6570\u7531\u8f93\u5165\u6587\u4ef6\u548c\u5207\u7247\u89c4\u5219\u51b3\u5b9a\u3002</p> <p>ReduceTask \u5e76\u884c\u5ea6\u7531\u8c01\u51b3\u5b9a\uff1f</p> <p>1\uff09\u8bbe\u7f6e ReduceTask \u5e76\u884c\u5ea6\uff08\u4e2a\u6570\uff09</p> <p>ReduceTask \u7684\u5e76\u884c\u5ea6\u540c\u6837\u5f71\u54cd\u6574\u4e2a Job \u7684\u6267\u884c\u5e76\u53d1\u5ea6\u548c\u6267\u884c\u6548\u7387\uff0c\u4f46\u4e0e MapTask \u7684\u5e76\u53d1\u6570\u7531\u5207\u7247\u6570\u51b3\u5b9a\u4e0d\u540c\uff0cReduceTask \u6570\u91cf\u7684\u51b3\u5b9a\u662f\u53ef\u4ee5\u76f4\u63a5\u624b\u52a8\u8bbe\u7f6e\uff1a</p> <pre><code>// \u9ed8\u8ba4\u503c\u662f1\uff0c\u624b\u52a8\u8bbe\u7f6e\u4e3a4\njob.setNumReduceTasks(4);\n</code></pre> <p>2\uff09\u5b9e\u9a8c\uff1a\u6d4b\u8bd5 ReduceTask \u591a\u5c11\u5408\u9002</p> <p>\uff081\uff09\u5b9e\u9a8c\u73af\u5883\uff1a1 \u4e2a Master \u8282\u70b9\uff0c16 \u4e2a Worker \u8282\u70b9\uff1aCPU:8GHZ\uff0c\u5185\u5b58: 2G</p> <p>\uff082\uff09\u5b9e\u9a8c\u7ed3\u8bba\uff1a</p> MapTask =16 ReduceTask 1 5 10 15 16 20 25 30 45 60 \u603b\u65f6\u95f4 892 146 110 92 88 100 128 101 145 104 <p>3\uff09\u6ce8\u610f\u4e8b\u9879</p> <p></p>"},{"location":"hadoop/hdp_13/#354-maptask-reducetask","title":"3.5.4 MapTask &amp; ReduceTask\u6e90\u7801\u89e3\u6790","text":"<p>1\uff09MapTask \u6e90\u7801\u89e3\u6790\u6d41\u7a0b</p> <pre><code>=================== MapTask ===================\ncontext.write(k, NullWritable.get());   //\u81ea\u5b9a\u4e49\u7684map\u65b9\u6cd5\u7684\u5199\u51fa\uff0c\u8fdb\u5165\noutput.write(key, value);  //MapTask727\u884c\uff0c\u6536\u96c6\u65b9\u6cd5\uff0c\u8fdb\u5165\u4e24\u6b21 \ncollector.collect(key, value,partitioner.getPartition(key, value, partitions));\nHashPartitioner(); //\u9ed8\u8ba4\u5206\u533a\u5668\ncollect()  //MapTask1082\u884c map\u7aef\u6240\u6709\u7684kv\u5168\u90e8\u5199\u51fa\u540e\u4f1a\u8d70\u4e0b\u9762\u7684close\u65b9\u6cd5\nclose() //MapTask732\u884c\ncollector.flush() // \u6ea2\u51fa\u5237\u5199\u65b9\u6cd5\uff0cMapTask735\u884c\uff0c\u63d0\u524d\u6253\u4e2a\u65ad\u70b9\uff0c\u8fdb\u5165\nsortAndSpill() //\u6ea2\u5199\u6392\u5e8f\uff0cMapTask1505\u884c\uff0c\u8fdb\u5165\nsorter.sort()   QuickSort //\u6ea2\u5199\u6392\u5e8f\u65b9\u6cd5\uff0cMapTask1625\u884c\uff0c\u8fdb\u5165\nmergeParts(); //\u5408\u5e76\u6587\u4ef6\uff0cMapTask1527\u884c\uff0c\u8fdb\u5165    \ncollector.close(); //MapTask739\u884c,\u6536\u96c6\u5668\u5173\u95ed,\u5373\u5c06\u8fdb\u5165ReduceTask\n</code></pre> <p>2\uff09ReduceTask \u6e90\u7801\u89e3\u6790\u6d41\u7a0b</p> <pre><code>=================== ReduceTask ===================\nif (isMapOrReduce())  //reduceTask324\u884c\uff0c\u63d0\u524d\u6253\u65ad\u70b9\ninitialize()   // reduceTask333\u884c,\u8fdb\u5165\ninit(shuffleContext);  // reduceTask375\u884c,\u8d70\u5230\u8fd9\u9700\u8981\u5148\u7ed9\u4e0b\u9762\u7684\u6253\u65ad\u70b9\ntotalMaps = job.getNumMapTasks(); // ShuffleSchedulerImpl\u7b2c120\u884c\uff0c\u63d0\u524d\u6253\u65ad\u70b9\nmerger = createMergeManager(context); //\u5408\u5e76\u65b9\u6cd5\uff0cShuffle\u7b2c80\u884c\n// MergeManagerImpl\u7b2c232 235\u884c\uff0c\u63d0\u524d\u6253\u65ad\u70b9\nthis.inMemoryMerger = createInMemoryMerger(); //\u5185\u5b58\u5408\u5e76\nthis.onDiskMerger = new OnDiskMerger(this); //\u78c1\u76d8\u5408\u5e76\nrIter = shuffleConsumerPlugin.run();\neventFetcher.start();  //\u5f00\u59cb\u6293\u53d6\u6570\u636e\uff0cShuffle\u7b2c107\u884c\uff0c\u63d0\u524d\u6253\u65ad\u70b9\neventFetcher.shutDown();  //\u6293\u53d6\u7ed3\u675f\uff0cShuffle\u7b2c141\u884c\uff0c\u63d0\u524d\u6253\u65ad\u70b9\ncopyPhase.complete();   //copy\u9636\u6bb5\u5b8c\u6210\uff0cShuffle\u7b2c151\u884c\ntaskStatus.setPhase(TaskStatus.Phase.SORT);  //\u5f00\u59cb\u6392\u5e8f\u9636\u6bb5\uff0cShuffle\u7b2c152\u884c\nsortPhase.complete();   //\u6392\u5e8f\u9636\u6bb5\u5b8c\u6210\uff0c\u5373\u5c06\u8fdb\u5165reduce\u9636\u6bb5 reduceTask382\u884c\nreduce();  //reduce\u9636\u6bb5\u8c03\u7528\u7684\u5c31\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684reduce\u65b9\u6cd5\uff0c\u4f1a\u88ab\u8c03\u7528\u591a\u6b21\ncleanup(context); //reduce\u5b8c\u6210\u4e4b\u524d\uff0c\u4f1a\u6700\u540e\u8c03\u7528\u4e00\u6b21Reducer\u91cc\u9762\u7684cleanup\u65b9\u6cd5\n</code></pre>"},{"location":"hadoop/hdp_13/#36-join","title":"3.6 Join\u5e94\u7528","text":""},{"location":"hadoop/hdp_13/#361-reduce-join","title":"3.6.1 Reduce Join","text":"<p>Map \u7aef\u7684\u4e3b\u8981\u5de5\u4f5c\uff1a\u4e3a\u6765\u81ea\u4e0d\u540c\u8868\u6216\u6587\u4ef6\u7684 key / value \u5bf9\uff0c\u6253\u6807\u7b7e\u4ee5\u533a\u522b\u4e0d\u540c\u6765\u6e90\u7684\u8bb0\u5f55\u3002\u7136\u540e\u7528\u8fde\u63a5\u5b57\u6bb5\u4f5c\u4e3a key\uff0c\u5176\u4f59\u90e8\u5206\u548c\u65b0\u52a0\u7684\u6807\u5fd7\u4f5c\u4e3a value\uff0c\u6700\u540e\u8fdb\u884c\u8f93\u51fa\u3002</p> <p>Reduce \u7aef\u7684\u4e3b\u8981\u5de5\u4f5c\uff1a\u5728 Reduce \u7aef\u4ee5\u8fde\u63a5\u5b57\u6bb5\u4f5c\u4e3a key \u7684\u5206\u7ec4\u5df2\u7ecf\u5b8c\u6210\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u6bcf\u4e00\u4e2a\u5206\u7ec4\u5f53\u4e2d\u5c06\u90a3\u4e9b\u6765\u6e90\u4e8e\u4e0d\u540c\u6587\u4ef6\u7684\u8bb0\u5f55\uff08\u5728 Map \u9636\u6bb5\u5df2\u7ecf\u6253\u6807\u5fd7\uff09\u5206\u5f00\uff0c\u6700\u540e\u8fdb\u884c\u5408\u5e76\u5c31 ok \u4e86\u3002</p>"},{"location":"hadoop/hdp_13/#362-reduce-join","title":"3.6.2 Reduce Join\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u9700\u6c42</p> id pid amount 1001 01 1 1002 02 2 1003 03 3 1004 01 4 1005 02 5 1006 03 6 pid pname 01 \u5c0f\u7c73 02 \u534e\u4e3a 03 \u683c\u529b <p>\u200b   \u5c06\u5546\u54c1\u4fe1\u606f\u8868\u4e2d\u6570\u636e\u6839\u636e\u5546\u54c1 pid \u5408\u5e76\u5230\u8ba2\u5355\u6570\u636e\u8868\u4e2d\u3002</p> id pname amount 1001 \u5c0f\u7c73 1 1004 \u5c0f\u7c73 4 1002 \u534e\u4e3a 2 1005 \u534e\u4e3a 5 1003 \u683c\u529b 3 1006 \u683c\u529b 6 <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p>\u901a\u8fc7\u5c06\u5173\u8054\u6761\u4ef6\u4f5c\u4e3a Map \u8f93\u51fa\u7684 key\uff0c\u5c06\u4e24\u8868\u6ee1\u8db3 Join \u6761\u4ef6\u7684\u6570\u636e\u5e76\u643a\u5e26\u6570\u636e\u6240\u6765\u6e90\u7684\u6587\u4ef6\u4fe1\u606f\uff0c\u53d1\u5f80\u540c\u4e00\u4e2a ReduceTask\uff0c\u5728 Reduce \u4e2d\u8fdb\u884c\u6570\u636e\u7684\u4e32\u8054\u3002</p> <p></p> <p>3\uff09\u4ee3\u7801\u5b9e\u73b0</p> <p>\uff081\uff09\u521b\u5efa\u5546\u54c1\u548c\u8ba2\u5355\u5408\u5e76\u540e\u7684 TableBean \u7c7b</p> <pre><code>package com.atguigu.mapreduce.reducejoin;\n\nimport org.apache.hadoop.io.Writable;\n\nimport java.io.DataInput;\nimport java.io.DataOutput;\nimport java.io.IOException;\n\npublic class TableBean implements Writable {\n\nprivate String id; //\u8ba2\u5355id\nprivate String pid; //\u4ea7\u54c1id\nprivate int amount; //\u4ea7\u54c1\u6570\u91cf\nprivate String pname; //\u4ea7\u54c1\u540d\u79f0\nprivate String flag; //\u5224\u65ad\u662forder\u8868\u8fd8\u662fpd\u8868\u7684\u6807\u5fd7\u5b57\u6bb5\n\npublic TableBean() {\n}\n\npublic String getId() {\nreturn id;\n}\n\npublic void setId(String id) {\nthis.id = id;\n}\n\npublic String getPid() {\nreturn pid;\n}\n\npublic void setPid(String pid) {\nthis.pid = pid;\n}\n\npublic int getAmount() {\nreturn amount;\n}\n\npublic void setAmount(int amount) {\nthis.amount = amount;\n}\n\npublic String getPname() {\nreturn pname;\n}\n\npublic void setPname(String pname) {\nthis.pname = pname;\n}\n\npublic String getFlag() {\nreturn flag;\n}\n\npublic void setFlag(String flag) {\nthis.flag = flag;\n}\n\n@Override\npublic String toString() {\nreturn id + \"\\t\" + pname + \"\\t\" + amount;\n}\n\n@Override\npublic void write(DataOutput out) throws IOException {\nout.writeUTF(id);\nout.writeUTF(pid);\nout.writeInt(amount);\nout.writeUTF(pname);\nout.writeUTF(flag);\n}\n\n@Override\npublic void readFields(DataInput in) throws IOException {\nthis.id = in.readUTF();\nthis.pid = in.readUTF();\nthis.amount = in.readInt();\nthis.pname = in.readUTF();\nthis.flag = in.readUTF();\n}\n}\n</code></pre> <p>\uff082\uff09\u7f16\u5199 TableMapper \u7c7b</p> <pre><code>package com.atguigu.mapreduce.reducejoin;\n\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.InputSplit;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.lib.input.FileSplit;\n\nimport java.io.IOException;\n\npublic class TableMapper extends Mapper&lt;LongWritable,Text,Text,TableBean&gt; {\n\nprivate String filename;\nprivate Text outK = new Text();\nprivate TableBean outV = new TableBean();\n\n@Override\nprotected void setup(Context context) throws IOException, InterruptedException {\n//\u83b7\u53d6\u5bf9\u5e94\u6587\u4ef6\u540d\u79f0\nInputSplit split = context.getInputSplit();\nFileSplit fileSplit = (FileSplit) split;\nfilename = fileSplit.getPath().getName();\n}\n\n@Override\nprotected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\n//\u83b7\u53d6\u4e00\u884c\nString line = value.toString();\n\n//\u5224\u65ad\u662f\u54ea\u4e2a\u6587\u4ef6,\u7136\u540e\u9488\u5bf9\u6587\u4ef6\u8fdb\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\nif(filename.contains(\"order\")){  //\u8ba2\u5355\u8868\u7684\u5904\u7406\nString[] split = line.split(\"\\t\");\n//\u5c01\u88c5outK\noutK.set(split[1]);\n//\u5c01\u88c5outV\noutV.setId(split[0]);\noutV.setPid(split[1]);\noutV.setAmount(Integer.parseInt(split[2]));\noutV.setPname(\"\");\noutV.setFlag(\"order\");\n}else {                             //\u5546\u54c1\u8868\u7684\u5904\u7406\nString[] split = line.split(\"\\t\");\n//\u5c01\u88c5outK\noutK.set(split[0]);\n//\u5c01\u88c5outV\noutV.setId(\"\");\noutV.setPid(split[0]);\noutV.setAmount(0);\noutV.setPname(split[1]);\noutV.setFlag(\"pd\");\n}\n\n//\u5199\u51faKV\ncontext.write(outK,outV);\n}\n}\n</code></pre> <p>\uff083\uff09\u7f16\u5199 TableReducer \u7c7b</p> <pre><code>package com.atguigu.mapreduce.reducejoin;\n\nimport org.apache.commons.beanutils.BeanUtils;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\n\nimport java.io.IOException;\nimport java.lang.reflect.InvocationTargetException;\nimport java.util.ArrayList;\n\npublic class TableReducer extends Reducer&lt;Text,TableBean,TableBean, NullWritable&gt; {\n\n@Override\nprotected void reduce(Text key, Iterable&lt;TableBean&gt; values, Context context) throws IOException, InterruptedException {\n\nArrayList&lt;TableBean&gt; orderBeans = new ArrayList&lt;&gt;();\nTableBean pdBean = new TableBean();\n\nfor (TableBean value : values) {\n\n//\u5224\u65ad\u6570\u636e\u6765\u81ea\u54ea\u4e2a\u8868\nif(\"order\".equals(value.getFlag())){   //\u8ba2\u5355\u8868\n\n//\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6TableBean\u5bf9\u8c61\u63a5\u6536value\nTableBean tmpOrderBean = new TableBean();\n\ntry {\nBeanUtils.copyProperties(tmpOrderBean,value);\n} catch (IllegalAccessException e) {\ne.printStackTrace();\n} catch (InvocationTargetException e) {\ne.printStackTrace();\n}\n\n//\u5c06\u4e34\u65f6TableBean\u5bf9\u8c61\u6dfb\u52a0\u5230\u96c6\u5408orderBeans\norderBeans.add(tmpOrderBean);\n}else {                                    //\u5546\u54c1\u8868\ntry {\nBeanUtils.copyProperties(pdBean,value);\n} catch (IllegalAccessException e) {\ne.printStackTrace();\n} catch (InvocationTargetException e) {\ne.printStackTrace();\n}\n}\n}\n\n//\u904d\u5386\u96c6\u5408orderBeans,\u66ff\u6362\u6389\u6bcf\u4e2aorderBean\u7684pid\u4e3apname,\u7136\u540e\u5199\u51fa\nfor (TableBean orderBean : orderBeans) {\n\norderBean.setPname(pdBean.getPname());\n\n//\u5199\u51fa\u4fee\u6539\u540e\u7684orderBean\u5bf9\u8c61\ncontext.write(orderBean,NullWritable.get());\n}\n}\n}\n</code></pre> <p>\uff084\uff09\u7f16\u5199 TableDriver \u7c7b</p> <pre><code>package com.atguigu.mapreduce.reducejoin;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\n\npublic class TableDriver {\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\nJob job = Job.getInstance(new Configuration());\n\njob.setJarByClass(TableDriver.class);\njob.setMapperClass(TableMapper.class);\njob.setReducerClass(TableReducer.class);\n\njob.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(TableBean.class);\n\njob.setOutputKeyClass(TableBean.class);\njob.setOutputValueClass(NullWritable.class);\n\nFileInputFormat.setInputPaths(job, new Path(\"D:\\\\input\"));\nFileOutputFormat.setOutputPath(job, new Path(\"D:\\\\output\"));\n\nboolean b = job.waitForCompletion(true);\nSystem.exit(b ? 0 : 1);\n}\n}\n</code></pre> <p>4\uff09\u6d4b\u8bd5</p> <p>\u8fd0\u884c\u7a0b\u5e8f\u67e5\u770b\u7ed3\u679c</p> <pre><code>1004    \u5c0f\u7c73  4\n1001    \u5c0f\u7c73  1\n1005    \u534e\u4e3a  5\n1002    \u534e\u4e3a  2\n1006    \u683c\u529b  6\n1003    \u683c\u529b  3\n</code></pre> <p>5\uff09\u603b\u7ed3</p> <p>\u7f3a\u70b9\uff1a\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c\u5408\u5e76\u7684\u64cd\u4f5c\u662f\u5728 Reduce \u9636\u6bb5\u5b8c\u6210\uff0cReduce \u7aef\u7684\u5904\u7406\u538b\u529b\u592a\u5927\uff0cMap \u8282\u70b9\u7684\u8fd0\u7b97\u8d1f\u8f7d\u5219\u5f88\u4f4e\uff0c\u8d44\u6e90\u5229\u7528\u7387\u4e0d\u9ad8\uff0c\u4e14\u5728 Reduce \u9636\u6bb5\u6781\u6613\u4ea7\u751f\u6570\u636e\u503e\u659c\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1aMap \u7aef\u5b9e\u73b0\u6570\u636e\u5408\u5e76\u3002</p>"},{"location":"hadoop/hdp_13/#363-map-join","title":"3.6.3 Map Join","text":"<p>1\uff09\u4f7f\u7528\u573a\u666f</p> <p>Map Join \u9002\u7528\u4e8e\u4e00\u5f20\u8868\u5341\u5206\u5c0f\u3001\u4e00\u5f20\u8868\u5f88\u5927\u7684\u573a\u666f\u3002</p> <p>2\uff09\u4f18\u70b9</p> <p>\u601d\u8003</p> <p>\u5728 Reduce \u7aef\u5904\u7406\u8fc7\u591a\u7684\u8868\uff0c\u975e\u5e38\u5bb9\u6613\u4ea7\u751f\u6570\u636e\u503e\u659c\u3002\u600e\u4e48\u529e\uff1f</p> <p>\u5728 Map \u7aef\u7f13\u5b58\u591a\u5f20\u8868\uff0c\u63d0\u524d\u5904\u7406\u4e1a\u52a1\u903b\u8f91\uff0c\u8fd9\u6837\u589e\u52a0 Map \u7aef\u4e1a\u52a1\uff0c\u51cf\u5c11 Reduce \u7aef\u6570\u636e\u7684\u538b\u529b\uff0c\u5c3d\u53ef\u80fd\u7684\u51cf\u5c11\u6570\u636e\u503e\u659c\u3002</p> <p>3\uff09\u5177\u4f53\u529e\u6cd5\uff1a\u91c7\u7528 DistributedCache</p> <p>\uff081\uff09\u5728 Mapper \u7684 setup \u9636\u6bb5\uff0c\u5c06\u6587\u4ef6\u8bfb\u53d6\u5230\u7f13\u5b58\u96c6\u5408\u4e2d\u3002</p> <p>\uff082\uff09\u5728 Driver \u9a71\u52a8\u7c7b\u4e2d\u52a0\u8f7d\u7f13\u5b58\u3002</p> <pre><code>//\u7f13\u5b58\u666e\u901a\u6587\u4ef6\u5230Task\u8fd0\u884c\u8282\u70b9\u3002\njob.addCacheFile(new URI(\"file:///e:/cache/pd.txt\"));\n//\u5982\u679c\u662f\u96c6\u7fa4\u8fd0\u884c,\u9700\u8981\u8bbe\u7f6eHDFS\u8def\u5f84\njob.addCacheFile(new URI(\"hdfs://hadoop102:8020/cache/pd.txt\"));\n</code></pre>"},{"location":"hadoop/hdp_13/#364-map-join","title":"3.6.4 Map Join\u6848\u4f8b\u5b9e\u64cd","text":"<p>1\uff09\u9700\u6c42</p> id pid amount 1001 01 1 1002 02 2 1003 03 3 1004 01 4 1005 02 5 1006 03 6 pid pname 01 \u5c0f\u7c73 02 \u534e\u4e3a 03 \u683c\u529b <p>\u200b   \u5c06\u5546\u54c1\u4fe1\u606f\u8868\u4e2d\u6570\u636e\u6839\u636e\u5546\u54c1 pid \u5408\u5e76\u5230\u8ba2\u5355\u6570\u636e\u8868\u4e2d\u3002</p> id pname amount 1001 \u5c0f\u7c73 1 1004 \u5c0f\u7c73 4 1002 \u534e\u4e3a 2 1005 \u534e\u4e3a 5 1003 \u683c\u529b 3 1006 \u683c\u529b 6 <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p>MapJoin \u9002\u7528\u4e8e\u5173\u8054\u8868\u4e2d\u6709\u5c0f\u8868\u7684\u60c5\u5f62\u3002</p> <p></p> <p>3\uff09\u5b9e\u73b0\u4ee3\u7801</p> <p>\uff081\uff09\u5148\u5728 MapJoinDriver \u9a71\u52a8\u7c7b\u4e2d\u6dfb\u52a0\u7f13\u5b58\u6587\u4ef6</p> <pre><code>package com.atguigu.mapreduce.mapjoin;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\nimport java.net.URI;\nimport java.net.URISyntaxException;\n\npublic class MapJoinDriver {\n\npublic static void main(String[] args) throws IOException, URISyntaxException, ClassNotFoundException, InterruptedException {\n\n// 1 \u83b7\u53d6job\u4fe1\u606f\nConfiguration conf = new Configuration();\nJob job = Job.getInstance(conf);\n// 2 \u8bbe\u7f6e\u52a0\u8f7djar\u5305\u8def\u5f84\njob.setJarByClass(MapJoinDriver.class);\n// 3 \u5173\u8054mapper\njob.setMapperClass(MapJoinMapper.class);\n// 4 \u8bbe\u7f6eMap\u8f93\u51faKV\u7c7b\u578b\njob.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(NullWritable.class);\n// 5 \u8bbe\u7f6e\u6700\u7ec8\u8f93\u51faKV\u7c7b\u578b\njob.setOutputKeyClass(Text.class);\njob.setOutputValueClass(NullWritable.class);\n\n// \u52a0\u8f7d\u7f13\u5b58\u6570\u636e\njob.addCacheFile(new URI(\"file:///D:/input/tablecache/pd.txt\"));\n// Map\u7aefJoin\u7684\u903b\u8f91\u4e0d\u9700\u8981Reduce\u9636\u6bb5\uff0c\u8bbe\u7f6ereduceTask\u6570\u91cf\u4e3a0\njob.setNumReduceTasks(0);\n\n// 6 \u8bbe\u7f6e\u8f93\u5165\u8f93\u51fa\u8def\u5f84\nFileInputFormat.setInputPaths(job, new Path(\"D:\\\\input\"));\nFileOutputFormat.setOutputPath(job, new Path(\"D:\\\\output\"));\n// 7 \u63d0\u4ea4\nboolean b = job.waitForCompletion(true);\nSystem.exit(b ? 0 : 1);\n}\n}\n</code></pre> <p>\uff082\uff09\u5728 MapJoinMapper \u7c7b\u4e2d\u7684 setup \u65b9\u6cd5\u4e2d\u8bfb\u53d6\u7f13\u5b58\u6587\u4ef6</p> <pre><code>package com.atguigu.mapreduce.mapjoin;\n\nimport org.apache.commons.lang.StringUtils;\nimport org.apache.hadoop.fs.FSDataInputStream;\nimport org.apache.hadoop.fs.FileSystem;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IOUtils;\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.net.URI;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class MapJoinMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt; {\n\nprivate Map&lt;String, String&gt; pdMap = new HashMap&lt;&gt;();\nprivate Text text = new Text();\n\n//\u4efb\u52a1\u5f00\u59cb\u524d\u5c06pd\u6570\u636e\u7f13\u5b58\u8fdbpdMap\n@Override\nprotected void setup(Context context) throws IOException, InterruptedException {\n\n//\u901a\u8fc7\u7f13\u5b58\u6587\u4ef6\u5f97\u5230\u5c0f\u8868\u6570\u636epd.txt\nURI[] cacheFiles = context.getCacheFiles();\nPath path = new Path(cacheFiles[0]);\n\n//\u83b7\u53d6\u6587\u4ef6\u7cfb\u7edf\u5bf9\u8c61,\u5e76\u5f00\u6d41\nFileSystem fs = FileSystem.get(context.getConfiguration());\nFSDataInputStream fis = fs.open(path);\n\n//\u901a\u8fc7\u5305\u88c5\u6d41\u8f6c\u6362\u4e3areader,\u65b9\u4fbf\u6309\u884c\u8bfb\u53d6\nBufferedReader reader = new BufferedReader(new InputStreamReader(fis, \"UTF-8\"));\n\n//\u9010\u884c\u8bfb\u53d6\uff0c\u6309\u884c\u5904\u7406\nString line;\nwhile (StringUtils.isNotEmpty(line = reader.readLine())) {\n//\u5207\u5272\u4e00\u884c    \n//01    \u5c0f\u7c73\nString[] split = line.split(\"\\t\");\npdMap.put(split[0], split[1]);\n}\n\n//\u5173\u6d41\nIOUtils.closeStream(reader);\nIOUtils.closeStream(fis);\n}\n\n@Override\nprotected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\n//\u8bfb\u53d6\u5927\u8868\u6570\u636e    \n//1001  01  1\nString[] fields = value.toString().split(\"\\t\");\n\n//\u901a\u8fc7\u5927\u8868\u6bcf\u884c\u6570\u636e\u7684pid,\u53bbpdMap\u91cc\u9762\u53d6\u51fapname\nString pname = pdMap.get(fields[1]);\n\n//\u5c06\u5927\u8868\u6bcf\u884c\u6570\u636e\u7684pid\u66ff\u6362\u4e3apname\ntext.set(fields[0] + \"\\t\" + pname + \"\\t\" + fields[2]);\n\n//\u5199\u51fa\ncontext.write(text,NullWritable.get());\n}\n}\n</code></pre>"},{"location":"hadoop/hdp_13/#37-mapreduce","title":"3.7 MapReduce\u5f00\u53d1\u603b\u7ed3","text":"<p>1\uff09\u8f93\u5165\u6570\u636e\u63a5\u53e3\uff1aInputFormat</p> <p>\uff081\uff09\u9ed8\u8ba4\u4f7f\u7528\u7684\u5b9e\u73b0\u7c7b\u662f\uff1aTextInputFormat</p> <p>\uff082\uff09TextInputFormat \u7684\u529f\u80fd\u903b\u8f91\u662f\uff1a\u4e00\u6b21\u8bfb\u4e00\u884c\u6587\u672c\uff0c\u7136\u540e\u5c06\u8be5\u884c\u7684\u8d77\u59cb\u504f\u79fb\u91cf\u4f5c\u4e3a key\uff0c\u884c\u5185\u5bb9\u4f5c\u4e3a value \u8fd4\u56de\u3002</p> <p>\uff083\uff09CombineTextInputFormat \u53ef\u4ee5\u628a\u591a\u4e2a\u5c0f\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2a\u5207\u7247\u5904\u7406\uff0c\u63d0\u9ad8\u5904\u7406\u6548\u7387\u3002</p> <p>2\uff09\u903b\u8f91\u5904\u7406\u63a5\u53e3\uff1aMapper </p> <p>\u7528\u6237\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u5b9e\u73b0\u5176\u4e2d\u4e09\u4e2a\u65b9\u6cd5\uff1amap()   setup()   cleanup () </p> <p>3\uff09Partitioner \u5206\u533a</p> <p>\uff081\uff09\u6709\u9ed8\u8ba4\u5b9e\u73b0 HashPartitioner\uff0c\u903b\u8f91\u662f\u6839\u636e key \u7684\u54c8\u5e0c\u503c\u548c numReduces \u6765\u8fd4\u56de\u4e00\u4e2a\u5206\u533a\u53f7\uff1b<code>key.hashCode()&amp;Integer.MAXVALUE % numReduces</code></p> <p>\uff082\uff09\u5982\u679c\u4e1a\u52a1\u4e0a\u6709\u7279\u522b\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5206\u533a\u3002</p> <p>4\uff09Comparable \u6392\u5e8f</p> <p>\uff081\uff09\u5f53\u6211\u4eec\u7528\u81ea\u5b9a\u4e49\u7684\u5bf9\u8c61\u4f5c\u4e3a key \u6765\u8f93\u51fa\u65f6\uff0c\u5c31\u5fc5\u987b\u8981\u5b9e\u73b0 WritableComparable \u63a5\u53e3\uff0c\u91cd\u5199\u5176\u4e2d\u7684 compareTo() \u65b9\u6cd5\u3002</p> <p>\uff082\uff09\u90e8\u5206\u6392\u5e8f\uff1a\u5bf9\u6700\u7ec8\u8f93\u51fa\u7684\u6bcf\u4e00\u4e2a\u6587\u4ef6\u8fdb\u884c\u5185\u90e8\u6392\u5e8f\u3002</p> <p>\uff083\uff09\u5168\u6392\u5e8f\uff1a\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u901a\u5e38\u53ea\u6709\u4e00\u4e2a Reduce\u3002</p> <p>\uff084\uff09\u4e8c\u6b21\u6392\u5e8f\uff1a\u6392\u5e8f\u7684\u6761\u4ef6\u6709\u4e24\u4e2a\u3002</p> <p>5\uff09Combiner \u5408\u5e76</p> <p>Combiner \u5408\u5e76\u53ef\u4ee5\u63d0\u9ad8\u7a0b\u5e8f\u6267\u884c\u6548\u7387\uff0c\u51cf\u5c11 IO \u4f20\u8f93\u3002\u4f46\u662f\u4f7f\u7528\u65f6\u5fc5\u987b\u4e0d\u80fd\u5f71\u54cd\u539f\u6709\u7684\u4e1a\u52a1\u5904\u7406\u7ed3\u679c\u3002</p> <p>6\uff09\u903b\u8f91\u5904\u7406\u63a5\u53e3\uff1aReducer</p> <p>\u7528\u6237\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u5b9e\u73b0\u5176\u4e2d\u4e09\u4e2a\u65b9\u6cd5\uff1areduce()   setup()   cleanup () </p> <p>7\uff09\u8f93\u51fa\u6570\u636e\u63a5\u53e3\uff1aOutputFormat</p> <p>\uff081\uff09\u9ed8\u8ba4\u5b9e\u73b0\u7c7b\u662f TextOutputFormat\uff0c\u529f\u80fd\u903b\u8f91\u662f\uff1a\u5c06\u6bcf\u4e00\u4e2a KV \u5bf9\uff0c\u5411\u76ee\u6807\u6587\u672c\u6587\u4ef6\u8f93\u51fa\u4e00\u884c\u3002</p> <p>\uff082\uff09\u7528\u6237\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49 OutputFormat\u3002</p>"},{"location":"hadoop/hdp_14/","title":"\u7b2c4\u7ae0 Hadoop\u6570\u636e\u538b\u7f29","text":""},{"location":"hadoop/hdp_14/#41","title":"4.1 \u6982\u8ff0","text":"<p>1\uff09\u538b\u7f29\u7684\u597d\u5904\u548c\u574f\u5904</p> <p>\u538b\u7f29\u7684\u4f18\u70b9\uff1a\u4ee5\u51cf\u5c11\u78c1\u76d8 IO\u3001\u8282\u7701\u78c1\u76d8\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u538b\u7f29\u7684\u7f3a\u70b9\uff1a\u589e\u52a0 CPU \u5f00\u9500\u3002</p> <p>2\uff09\u538b\u7f29\u539f\u5219</p> <p>\uff081\uff09\u8fd0\u7b97\u5bc6\u96c6\u578b\u7684 Job\uff0c\u5c11\u7528\u538b\u7f29\u3002</p> <p>\uff082\uff09IO \u5bc6\u96c6\u578b\u7684 Job\uff0c\u591a\u7528\u538b\u7f29\u3002</p>"},{"location":"hadoop/hdp_14/#42-mr","title":"4.2 MR\u652f\u6301\u7684\u538b\u7f29\u7f16\u7801","text":"<p>1\uff09\u538b\u7f29\u7b97\u6cd5\u5bf9\u6bd4\u4ecb\u7ecd</p> \u538b\u7f29\u683c\u5f0f Hadoop\u81ea\u5e26\uff1f \u7b97\u6cd5 \u6587\u4ef6\u6269\u5c55\u540d \u662f\u5426\u53ef\u5207\u7247 \u6362\u6210\u538b\u7f29\u683c\u5f0f\u540e\uff0c\u539f\u6765\u7684\u7a0b\u5e8f\u662f\u5426\u9700\u8981\u4fee\u6539 DEFLATE \u662f\uff0c\u76f4\u63a5\u4f7f\u7528 DEFLATE .deflate \u5426 \u548c\u6587\u672c\u5904\u7406\u4e00\u6837\uff0c\u4e0d\u9700\u8981\u4fee\u6539 Gzip \u662f\uff0c\u76f4\u63a5\u4f7f\u7528 DEFLATE .gz \u5426 \u548c\u6587\u672c\u5904\u7406\u4e00\u6837\uff0c\u4e0d\u9700\u8981\u4fee\u6539 bzip2 \u662f\uff0c\u76f4\u63a5\u4f7f\u7528 bzip2 .bz2 \u662f \u548c\u6587\u672c\u5904\u7406\u4e00\u6837\uff0c\u4e0d\u9700\u8981\u4fee\u6539 LZO \u5426\uff0c\u9700\u8981\u5b89\u88c5 LZO .lzo \u662f \u9700\u8981\u5efa\u7d22\u5f15\uff0c\u8fd8\u9700\u8981\u6307\u5b9a\u8f93\u5165\u683c\u5f0f Snappy \u662f\uff0c\u76f4\u63a5\u4f7f\u7528 Snappy .snappy \u5426 \u548c\u6587\u672c\u5904\u7406\u4e00\u6837\uff0c\u4e0d\u9700\u8981\u4fee\u6539 <p>2\uff09\u538b\u7f29\u6027\u80fd\u7684\u6bd4\u8f83   </p> \u538b\u7f29\u7b97\u6cd5 \u539f\u59cb\u6587\u4ef6\u5927\u5c0f \u538b\u7f29\u6587\u4ef6\u5927\u5c0f \u538b\u7f29\u901f\u5ea6 \u89e3\u538b\u901f\u5ea6 gzip 8.3GB 1.8GB 17.5MB/s 58MB/s bzip2 8.3GB 1.1GB 2.4MB/s 9.5MB/s LZO 8.3GB 2.9GB 49.3MB/s 74.6MB/s <p>http://google.github.io/snappy/</p> <p>Snappy is a compression/decompression library. It does not aim for maximum compression, or compatibility with any other compression library; instead, it aims for very high speeds and reasonable compression. For instance, compared to the fastest mode of zlib, Snappy is an order of magnitude faster for most inputs, but the resulting compressed files are anywhere from 20% to 100% bigger.On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250 MB/sec or more and decompresses at about 500 MB/sec or more.</p>"},{"location":"hadoop/hdp_14/#43","title":"4.3 \u538b\u7f29\u65b9\u5f0f\u9009\u62e9","text":"<p>\u538b\u7f29\u65b9\u5f0f\u9009\u62e9\u65f6\u91cd\u70b9\u8003\u8651\uff1a\u538b\u7f29/\u89e3\u538b\u7f29\u901f\u5ea6\u3001\u538b\u7f29\u7387\uff08\u538b\u7f29\u540e\u5b58\u50a8\u5927\u5c0f\uff09\u3001\u538b\u7f29\u540e\u662f\u5426\u53ef\u4ee5\u652f\u6301\u5207\u7247\u3002</p>"},{"location":"hadoop/hdp_14/#431-gzip","title":"4.3.1 Gzip\u538b\u7f29","text":"<p>\u4f18\u70b9\uff1a\u538b\u7f29\u7387\u6bd4\u8f83\u9ad8\u3002 </p> <p>\u7f3a\u70b9\uff1a\u4e0d\u652f\u6301 Split\uff1b\u538b\u7f29/\u89e3\u538b\u901f\u5ea6\u4e00\u822c\u3002</p>"},{"location":"hadoop/hdp_14/#432-bzip2","title":"4.3.2 Bzip2\u538b\u7f29","text":"<p>\u4f18\u70b9\uff1a\u538b\u7f29\u7387\u9ad8\uff1b\u652f\u6301 Split\u3002</p> <p>\u7f3a\u70b9\uff1a\u538b\u7f29/\u89e3\u538b\u901f\u5ea6\u6162\u3002</p>"},{"location":"hadoop/hdp_14/#433-lzo","title":"4.3.3 Lzo\u538b\u7f29","text":"<p>\u4f18\u70b9\uff1a\u538b\u7f29/\u89e3\u538b\u901f\u5ea6\u6bd4\u8f83\u5feb\uff1b\u652f\u6301 Split\u3002</p> <p>\u7f3a\u70b9\uff1a\u538b\u7f29\u7387\u4e00\u822c\uff1b\u60f3\u652f\u6301\u5207\u7247\u9700\u8981\u989d\u5916\u521b\u5efa\u7d22\u5f15\u3002</p>"},{"location":"hadoop/hdp_14/#434-snappy","title":"4.3.4 Snappy\u538b\u7f29","text":"<p>\u4f18\u70b9\uff1a\u538b\u7f29\u548c\u89e3\u538b\u7f29\u901f\u5ea6\u5feb\u3002 </p> <p>\u7f3a\u70b9\uff1a\u4e0d\u652f\u6301 Split\uff1b\u538b\u7f29\u7387\u4e00\u822c\u3002</p>"},{"location":"hadoop/hdp_14/#435","title":"4.3.5 \u538b\u7f29\u4f4d\u7f6e\u9009\u62e9","text":"<p>\u538b\u7f29\u53ef\u4ee5\u5728 MapReduce \u4f5c\u7528\u7684\u4efb\u610f\u9636\u6bb5\u542f\u7528\u3002</p> <p></p>"},{"location":"hadoop/hdp_14/#44","title":"4.4 \u538b\u7f29\u53c2\u6570\u914d\u7f6e","text":"<p>1\uff09\u4e3a\u4e86\u652f\u6301\u591a\u79cd\u538b\u7f29/\u89e3\u538b\u7f29\u7b97\u6cd5\uff0cHadoop \u5f15\u5165\u4e86\u7f16\u7801/\u89e3\u7801\u5668</p> \u538b\u7f29\u683c\u5f0f \u5bf9\u5e94\u7684\u7f16\u7801/\u89e3\u7801\u5668 DEFLATE org.apache.hadoop.io.compress.DefaultCodec gzip org.apache.hadoop.io.compress.GzipCodec bzip2 org.apache.hadoop.io.compress.BZip2Codec LZO com.hadoop.compression.lzo.LzopCodec Snappy org.apache.hadoop.io.compress.SnappyCodec <p>2\uff09\u8981\u5728 Hadoop \u4e2d\u542f\u7528\u538b\u7f29\uff0c\u53ef\u4ee5\u914d\u7f6e\u5982\u4e0b\u53c2\u6570</p> \u53c2\u6570 \u9ed8\u8ba4\u503c \u9636\u6bb5 \u5efa\u8bae io.compression.codecs  \uff08\u5728core-site.xml\u4e2d\u914d\u7f6e\uff09 \u65e0\uff0c\u8fd9\u4e2a\u9700\u8981\u5728\u547d\u4ee4\u884c\u8f93\u5165hadoop checknative\u67e5\u770b \u8f93\u5165\u538b\u7f29 Hadoop\u4f7f\u7528\u6587\u4ef6\u6269\u5c55\u540d\u5224\u65ad\u662f\u5426\u652f\u6301\u67d0\u79cd\u7f16\u89e3\u7801\u5668 mapreduce.map.output.compress\uff08\u5728mapred-site.xml\u4e2d\u914d\u7f6e\uff09 false mapper\u8f93\u51fa \u8fd9\u4e2a\u53c2\u6570\u8bbe\u4e3atrue\u542f\u7528\u538b\u7f29 mapreduce.map.output.compress.codec\uff08\u5728mapred-site.xml\u4e2d\u914d\u7f6e\uff09 org.apache.hadoop.io.compress.DefaultCodec mapper\u8f93\u51fa \u4f01\u4e1a\u591a\u4f7f\u7528LZO\u6216Snappy\u7f16\u89e3\u7801\u5668\u5728\u6b64\u9636\u6bb5\u538b\u7f29\u6570\u636e mapreduce.output.fileoutputformat.compress\uff08\u5728mapred-site.xml\u4e2d\u914d\u7f6e\uff09 false reducer\u8f93\u51fa \u8fd9\u4e2a\u53c2\u6570\u8bbe\u4e3atrue\u542f\u7528\u538b\u7f29 mapreduce.output.fileoutputformat.compress.codec\uff08\u5728mapred-site.xml\u4e2d\u914d\u7f6e\uff09 org.apache.hadoop.io.compress.DefaultCodec reducer\u8f93\u51fa \u4f7f\u7528\u6807\u51c6\u5de5\u5177\u6216\u8005\u7f16\u89e3\u7801\u5668\uff0c\u5982gzip\u548cbzip2"},{"location":"hadoop/hdp_14/#45","title":"4.5 \u538b\u7f29\u5b9e\u64cd\u6848\u4f8b","text":""},{"location":"hadoop/hdp_14/#451-map","title":"4.5.1 Map\u8f93\u51fa\u7aef\u91c7\u7528\u538b\u7f29","text":"<p>\u5373\u4f7f\u4f60\u7684 MapReduce \u7684\u8f93\u5165\u8f93\u51fa\u6587\u4ef6\u90fd\u662f\u672a\u538b\u7f29\u7684\u6587\u4ef6\uff0c\u4f60\u4ecd\u7136\u53ef\u4ee5\u5bf9 Map \u4efb\u52a1\u7684\u4e2d\u95f4\u7ed3\u679c\u8f93\u51fa\u505a\u538b\u7f29\uff0c\u56e0\u4e3a\u5b83\u8981\u5199\u5728\u786c\u76d8\u5e76\u4e14\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u5230 Reduce \u8282\u70b9\uff0c\u5bf9\u5176\u538b\u7f29\u53ef\u4ee5\u63d0\u9ad8\u5f88\u591a\u6027\u80fd\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u53ea\u8981\u8bbe\u7f6e\u4e24\u4e2a\u5c5e\u6027\u5373\u53ef\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u4ee3\u7801\u600e\u4e48\u8bbe\u7f6e\u3002</p> <p>1\uff09\u7ed9\u5927\u5bb6\u63d0\u4f9b\u7684 Hadoop \u6e90\u7801\u652f\u6301\u7684\u538b\u7f29\u683c\u5f0f\u6709\uff1aBZip2Codec\u3001DefaultCodec</p> <pre><code>package com.atguigu.mapreduce.compress;\nimport java.io.IOException;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.io.compress.BZip2Codec;    import org.apache.hadoop.io.compress.CompressionCodec;\nimport org.apache.hadoop.io.compress.GzipCodec;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class WordCountDriver {\n\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\nConfiguration conf = new Configuration();\n\n// \u5f00\u542fmap\u7aef\u8f93\u51fa\u538b\u7f29\nconf.setBoolean(\"mapreduce.map.output.compress\", true);\n\n// \u8bbe\u7f6emap\u7aef\u8f93\u51fa\u538b\u7f29\u65b9\u5f0f\nconf.setClass(\"mapreduce.map.output.compress.codec\", BZip2Codec.class,CompressionCodec.class);\n\nJob job = Job.getInstance(conf);\n\njob.setJarByClass(WordCountDriver.class);\n\njob.setMapperClass(WordCountMapper.class);\njob.setReducerClass(WordCountReducer.class);\n\njob.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(IntWritable.class);\n\njob.setOutputKeyClass(Text.class);\njob.setOutputValueClass(IntWritable.class);\n\nFileInputFormat.setInputPaths(job, new Path(args[0]));\nFileOutputFormat.setOutputPath(job, new Path(args[1]));\n\nboolean result = job.waitForCompletion(true);\n\nSystem.exit(result ? 0 : 1);\n}\n}\n</code></pre> <p>2\uff09Mapper \u4fdd\u6301\u4e0d\u53d8</p> <pre><code>package com.atguigu.mapreduce.compress;\nimport java.io.IOException;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\n\npublic class WordCountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;{\n\nText k = new Text();\nIntWritable v = new IntWritable(1);\n\n@Override\nprotected void map(LongWritable key, Text value, Context context)throws IOException, InterruptedException {\n\n// 1 \u83b7\u53d6\u4e00\u884c\nString line = value.toString();\n\n// 2 \u5207\u5272\nString[] words = line.split(\" \");\n\n// 3 \u5faa\u73af\u5199\u51fa\nfor(String word:words){\nk.set(word);\ncontext.write(k, v);\n}\n}\n}\n</code></pre> <p>3\uff09Reducer \u4fdd\u6301\u4e0d\u53d8</p> <pre><code>package com.atguigu.mapreduce.compress;\nimport java.io.IOException;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\n\npublic class WordCountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt;{\n\nIntWritable v = new IntWritable();\n\n@Override\nprotected void reduce(Text key, Iterable&lt;IntWritable&gt; values,\nContext context) throws IOException, InterruptedException {\n\nint sum = 0;\n\n// 1 \u6c47\u603b\nfor(IntWritable value:values){\nsum += value.get();\n}\n\nv.set(sum);\n\n// 2 \u8f93\u51fa\ncontext.write(key, v);\n}\n}\n</code></pre>"},{"location":"hadoop/hdp_14/#452-reduce","title":"4.5.2 Reduce\u8f93\u51fa\u7aef\u91c7\u7528\u538b\u7f29","text":"<p>\u57fa\u4e8e WordCount \u6848\u4f8b\u5904\u7406\u3002</p> <p>1\uff09\u4fee\u6539\u9a71\u52a8</p> <pre><code>package com.atguigu.mapreduce.compress;\nimport java.io.IOException;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.io.compress.BZip2Codec;\nimport org.apache.hadoop.io.compress.DefaultCodec;\nimport org.apache.hadoop.io.compress.GzipCodec;\nimport org.apache.hadoop.io.compress.Lz4Codec;\nimport org.apache.hadoop.io.compress.SnappyCodec;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class WordCountDriver {\n\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\nConfiguration conf = new Configuration();\n\nJob job = Job.getInstance(conf);\n\njob.setJarByClass(WordCountDriver.class);\n\njob.setMapperClass(WordCountMapper.class);\njob.setReducerClass(WordCountReducer.class);\n\njob.setMapOutputKeyClass(Text.class);\njob.setMapOutputValueClass(IntWritable.class);\n\njob.setOutputKeyClass(Text.class);\njob.setOutputValueClass(IntWritable.class);\n\nFileInputFormat.setInputPaths(job, new Path(args[0]));\nFileOutputFormat.setOutputPath(job, new Path(args[1]));\n\n// \u8bbe\u7f6ereduce\u7aef\u8f93\u51fa\u538b\u7f29\u5f00\u542f\nFileOutputFormat.setCompressOutput(job, true);\n\n// \u8bbe\u7f6e\u538b\u7f29\u7684\u65b9\u5f0f\nFileOutputFormat.setOutputCompressorClass(job, BZip2Codec.class); //      FileOutputFormat.setOutputCompressorClass(job, GzipCodec.class); \n//      FileOutputFormat.setOutputCompressorClass(job, DefaultCodec.class); \n\nboolean result = job.waitForCompletion(true);\n\nSystem.exit(result?0:1);\n}\n}\n</code></pre> <p>2\uff09Mapper \u548c Reducer \u4fdd\u6301\u4e0d\u53d8\uff08\u8be6\u89c1 4.5.1\uff09</p>"},{"location":"hadoop/hdp_15/","title":"\u7b2c5\u7ae0 Yarn\u8d44\u6e90\u8c03\u5ea6\u5668","text":"<p>\u601d\u8003\uff1a</p> <p>1\uff09\u5982\u4f55\u7ba1\u7406\u96c6\u7fa4\u8d44\u6e90\uff1f</p> <p>2\uff09\u5982\u4f55\u7ed9\u4efb\u52a1\u5408\u7406\u5206\u914d\u8d44\u6e90\uff1f</p> <p></p> <p>Yarn \u662f\u4e00\u4e2a\u8d44\u6e90\u8c03\u5ea6\u5e73\u53f0\uff0c\u8d1f\u8d23\u4e3a\u8fd0\u7b97\u7a0b\u5e8f\u63d0\u4f9b\u670d\u52a1\u5668\u8fd0\u7b97\u8d44\u6e90\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\uff0c\u800c MapReduce \u7b49\u8fd0\u7b97\u7a0b\u5e8f\u5219\u76f8\u5f53\u4e8e\u8fd0\u884c\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"hadoop/hdp_15/#51-yarn","title":"5.1 Yarn\u57fa\u7840\u67b6\u6784","text":"<p>YARN \u4e3b\u8981\u7531 ResourceManager\u3001NodeManager\u3001ApplicationMaster \u548c Container \u7b49\u7ec4\u4ef6\u6784\u6210\u3002</p> <p></p> <p> </p> yarn\u5de5\u4f5c\u6d41\u7a0b <p>\uff081\uff09MR \u7a0b\u5e8f\u63d0\u4ea4\u5230\u5ba2\u6237\u7aef\u6240\u5728\u7684\u8282\u70b9\u3002</p> <p>\uff082\uff09YarnRunner \u5411 ResourceManager \u7533\u8bf7\u4e00\u4e2a Application\u3002</p> <p>\uff083\uff09RM \u5c06\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\u8d44\u6e90\u8def\u5f84\u8fd4\u56de\u7ed9 YarnRunner\u3002</p> <p>\uff084\uff09\u8be5\u7a0b\u5e8f\u5c06\u8fd0\u884c\u6240\u9700\u8d44\u6e90\u63d0\u4ea4\u5230 HDFS \u4e0a\u3002</p> <p>\uff085\uff09\u7a0b\u5e8f\u8d44\u6e90\u63d0\u4ea4\u5b8c\u6bd5\u540e\uff0c\u7533\u8bf7\u8fd0\u884c mrAppMaster\u3002</p> <p>\uff086\uff09RM \u5c06\u7528\u6237\u7684\u8bf7\u6c42\u521d\u59cb\u5316\u6210\u4e00\u4e2a Task\u3002</p> <p>\uff087\uff09\u5176\u4e2d\u4e00\u4e2a NodeManager \u9886\u53d6\u5230 Task \u4efb\u52a1\u3002</p> <p>\uff088\uff09\u8be5 NodeManager \u521b\u5efa\u5bb9\u5668 Container\uff0c\u5e76\u4ea7\u751f MRAppmaster\u3002</p> <p>\uff089\uff09Container \u4ece HDFS \u4e0a\u62f7\u8d1d\u8d44\u6e90\u5230\u672c\u5730\u3002</p> <p>\uff0810\uff09MRAppmaster \u5411 RM \u7533\u8bf7\u8fd0\u884c MapTask \u8d44\u6e90\u3002</p> <p>\uff0811\uff09RM \u5c06\u8fd0\u884c MapTask \u4efb\u52a1\u5206\u914d\u7ed9\u53e6\u5916\u4e24\u4e2a NodeManager\uff0c\u53e6\u4e24\u4e2a NodeManager \u5206\u522b\u9886\u53d6\u4efb\u52a1\u5e76\u521b\u5efa\u5bb9\u5668\u3002</p> <p>\uff0812\uff09MR \u5411\u4e24\u4e2a\u63a5\u6536\u5230\u4efb\u52a1\u7684 NodeManager \u53d1\u9001\u7a0b\u5e8f\u542f\u52a8\u811a\u672c\uff0c\u8fd9\u4e24\u4e2a NodeManager \u5206\u522b\u542f\u52a8 MapTask\uff0cMapTask \u5bf9\u6570\u636e\u5206\u533a\u6392\u5e8f\u3002</p> <p>\uff0813\uff09MrAppMaster \u7b49\u5f85\u6240\u6709 MapTask \u8fd0\u884c\u5b8c\u6bd5\u540e\uff0c\u5411 RM \u7533\u8bf7\u5bb9\u5668\uff0c\u8fd0\u884c ReduceTask\u3002</p> <p>\uff0814\uff09ReduceTask \u5411 MapTask \u83b7\u53d6\u76f8\u5e94\u5206\u533a\u7684\u6570\u636e\u3002</p> <p>\uff0815\uff09\u7a0b\u5e8f\u8fd0\u884c\u5b8c\u6bd5\u540e\uff0cMR \u4f1a\u5411 RM \u7533\u8bf7\u6ce8\u9500\u81ea\u5df1\u3002</p>"},{"location":"hadoop/hdp_15/#53","title":"5.3 \u4f5c\u4e1a\u63d0\u4ea4\u5168\u8fc7\u7a0b","text":"HDFS\u3001MapReduce\u3001Yarn\u7684\u5173\u7cfb Yarn\u63d0\u4ea4\u4efb\u52a1\u6d41\u7a0b HDFS\u3001MapReduce\u63d0\u4ea4\u6d41\u7a0b <p>\u4f5c\u4e1a\u63d0\u4ea4\u5168\u8fc7\u7a0b\u8be6\u89e3</p> <p>\uff081\uff09\u4f5c\u4e1a\u63d0\u4ea4</p> <p>\u7b2c 1 \u6b65\uff1aClient \u8c03\u7528 job.waitForCompletion \u65b9\u6cd5\uff0c\u5411\u6574\u4e2a\u96c6\u7fa4\u63d0\u4ea4 MapReduce \u4f5c\u4e1a\u3002</p> <p>\u7b2c 2 \u6b65\uff1aClient \u5411 RM \u7533\u8bf7\u4e00\u4e2a\u4f5c\u4e1a id\u3002</p> <p>\u7b2c 3 \u6b65\uff1aRM \u7ed9 Client \u8fd4\u56de\u8be5 job \u8d44\u6e90\u7684\u63d0\u4ea4\u8def\u5f84\u548c\u4f5c\u4e1a id\u3002</p> <p>\u7b2c 4 \u6b65\uff1aClient \u63d0\u4ea4 jar \u5305\u3001\u5207\u7247\u4fe1\u606f\u548c\u914d\u7f6e\u6587\u4ef6\u5230\u6307\u5b9a\u7684\u8d44\u6e90\u63d0\u4ea4\u8def\u5f84\u3002</p> <p>\u7b2c 5 \u6b65\uff1aClient \u63d0\u4ea4\u5b8c\u8d44\u6e90\u540e\uff0c\u5411 RM \u7533\u8bf7\u8fd0\u884c MrAppMaster\u3002</p> <p>\uff082\uff09\u4f5c\u4e1a\u521d\u59cb\u5316</p> <p>\u7b2c 6 \u6b65\uff1a\u5f53 RM \u6536\u5230 Client \u7684\u8bf7\u6c42\u540e\uff0c\u5c06\u8be5 job \u6dfb\u52a0\u5230\u5bb9\u91cf\u8c03\u5ea6\u5668\u4e2d\u3002</p> <p>\u7b2c 7 \u6b65\uff1a\u67d0\u4e00\u4e2a\u7a7a\u95f2\u7684 NM \u9886\u53d6\u5230\u8be5 Job\u3002</p> <p>\u7b2c 8 \u6b65\uff1a\u8be5 NM \u521b\u5efa Container\uff0c\u5e76\u4ea7\u751f MRAppmaster\u3002</p> <p>\u7b2c 9 \u6b65\uff1a\u4e0b\u8f7d Client \u63d0\u4ea4\u7684\u8d44\u6e90\u5230\u672c\u5730\u3002</p> <p>\uff083\uff09\u4efb\u52a1\u5206\u914d</p> <p>\u7b2c 10 \u6b65\uff1aMrAppMaster \u5411 RM \u7533\u8bf7\u8fd0\u884c\u591a\u4e2a MapTask \u4efb\u52a1\u8d44\u6e90\u3002</p> <p>\u7b2c 11 \u6b65\uff1aRM \u5c06\u8fd0\u884c MapTask \u4efb\u52a1\u5206\u914d\u7ed9\u53e6\u5916\u4e24\u4e2a NodeManager\uff0c\u53e6\u4e24\u4e2a NodeManager \u5206\u522b\u9886\u53d6\u4efb\u52a1\u5e76\u521b\u5efa\u5bb9\u5668\u3002</p> <p>\uff084\uff09\u4efb\u52a1\u8fd0\u884c</p> <p>\u7b2c 12 \u6b65\uff1aMR \u5411\u4e24\u4e2a\u63a5\u6536\u5230\u4efb\u52a1\u7684 NodeManager \u53d1\u9001\u7a0b\u5e8f\u542f\u52a8\u811a\u672c\uff0c\u8fd9\u4e24\u4e2a NodeManager \u5206\u522b\u542f\u52a8 MapTask\uff0cMapTask \u5bf9\u6570\u636e\u5206\u533a\u6392\u5e8f\u3002</p> <p>\u7b2c 13 \u6b65\uff1aMrAppMaster \u7b49\u5f85\u6240\u6709 MapTask \u8fd0\u884c\u5b8c\u6bd5\u540e\uff0c\u5411 RM \u7533\u8bf7\u5bb9\u5668\uff0c\u8fd0\u884c ReduceTask\u3002</p> <p>\u7b2c 14 \u6b65\uff1aReduceTask \u5411 MapTask \u83b7\u53d6\u76f8\u5e94\u5206\u533a\u7684\u6570\u636e\u3002</p> <p>\u7b2c 15 \u6b65\uff1a\u7a0b\u5e8f\u8fd0\u884c\u5b8c\u6bd5\u540e\uff0cMR \u4f1a\u5411 RM \u7533\u8bf7\u6ce8\u9500\u81ea\u5df1\u3002</p> <p>\uff085\uff09\u8fdb\u5ea6\u548c\u72b6\u6001\u66f4\u65b0</p> <p>YARN \u4e2d\u7684\u4efb\u52a1\u5c06\u5176\u8fdb\u5ea6\u548c\u72b6\u6001(\u5305\u62ec counter )\u8fd4\u56de\u7ed9\u5e94\u7528\u7ba1\u7406\u5668, \u5ba2\u6237\u7aef\u6bcf\u79d2(\u901a\u8fc7 <code>mapreduce.client.progressmonitor.pollinterval</code> \u8bbe\u7f6e)\u5411\u5e94\u7528\u7ba1\u7406\u5668\u8bf7\u6c42\u8fdb\u5ea6\u66f4\u65b0, \u5c55\u793a\u7ed9\u7528\u6237\u3002</p> <p>\uff086\uff09\u4f5c\u4e1a\u5b8c\u6210</p> <p>\u9664\u4e86\u5411\u5e94\u7528\u7ba1\u7406\u5668\u8bf7\u6c42\u4f5c\u4e1a\u8fdb\u5ea6\u5916, \u5ba2\u6237\u7aef\u6bcf 5 \u79d2\u90fd\u4f1a\u901a\u8fc7\u8c03\u7528 waitForCompletion() \u6765\u68c0\u67e5\u4f5c\u4e1a\u662f\u5426\u5b8c\u6210\u3002\u65f6\u95f4\u95f4\u9694\u53ef\u4ee5\u901a\u8fc7<code>mapreduce.client.completion.pollinterval</code> \u6765\u8bbe\u7f6e\u3002\u4f5c\u4e1a\u5b8c\u6210\u4e4b\u540e, \u5e94\u7528\u7ba1\u7406\u5668\u548c Container \u4f1a\u6e05\u7406\u5de5\u4f5c\u72b6\u6001\u3002\u4f5c\u4e1a\u7684\u4fe1\u606f\u4f1a\u88ab\u4f5c\u4e1a\u5386\u53f2\u670d\u52a1\u5668\u5b58\u50a8\u4ee5\u5907\u4e4b\u540e\u7528\u6237\u6838\u67e5\u3002</p>"},{"location":"hadoop/hdp_15/#54-yarn","title":"5.4 Yarn\u8c03\u5ea6\u5668\u548c\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u76ee\u524d\uff0cHadoop \u4f5c\u4e1a\u8c03\u5ea6\u5668\u4e3b\u8981\u6709\u4e09\u79cd\uff1aFIFO\u3001\u5bb9\u91cf\uff08Capacity Scheduler\uff09\u548c\u516c\u5e73\uff08Fair Scheduler\uff09\u3002Apache Hadoop 3.1.3 \u9ed8\u8ba4\u7684\u8d44\u6e90\u8c03\u5ea6\u5668\u662f Capacity Scheduler\u3002</p> <p>CDH \u6846\u67b6\u9ed8\u8ba4\u8c03\u5ea6\u5668\u662f Fair Scheduler\u3002</p> yarn-site.xml<pre><code>&lt;property&gt;\n&lt;description&gt;The class to use as the resource scheduler.&lt;/description&gt;\n&lt;name&gt;yarn.resourcemanager.scheduler.class&lt;/name&gt;\n&lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"hadoop/hdp_15/#541-fifo","title":"5.4.1 \u5148\u8fdb\u5148\u51fa\u8c03\u5ea6\u5668\uff08FIFO\uff09","text":"<p>FIFO \u8c03\u5ea6\u5668\uff08First In First Out\uff09\uff1a\u5355\u961f\u5217\uff0c\u6839\u636e\u63d0\u4ea4\u4f5c\u4e1a\u7684\u5148\u540e\u987a\u5e8f\uff0c\u5148\u6765\u5148\u670d\u52a1\u3002</p> <p></p> <p>\u4f18\u70b9\uff1a\u7b80\u5355\u6613\u61c2\u3002</p> <p>\u7f3a\u70b9\uff1a\u4e0d\u652f\u6301\u591a\u961f\u5217\uff0c\u751f\u4ea7\u73af\u5883\u5f88\u5c11\u4f7f\u7528\u3002</p>"},{"location":"hadoop/hdp_15/#542-capacity-scheduler","title":"5.4.2 \u5bb9\u91cf\u8c03\u5ea6\u5668\uff08Capacity Scheduler\uff09","text":"<p>Capacity Scheduler \u662f Yahoo \u5f00\u53d1\u7684\u591a\u7528\u6237\u8c03\u5ea6\u5668\u3002</p> <p></p> <p></p>"},{"location":"hadoop/hdp_15/#543-fair-scheduler","title":"5.4.3 \u516c\u5e73\u8c03\u5ea6\u5668\uff08Fair Scheduler\uff09","text":"<p>Fair Scheduler \u662f Facebook \u5f00\u53d1\u7684\u591a\u7528\u6237\u8c03\u5ea6\u5668\u3002</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p>"},{"location":"hadoop/hdp_16/","title":"\u7b2c6\u7ae0 Yarn\u6848\u4f8b\u5b9e\u64cd","text":""},{"location":"hadoop/hdp_16/#61-yarn","title":"6.1 Yarn\u751f\u4ea7\u73af\u5883\u6838\u5fc3\u53c2\u6570\u914d\u7f6e\u6848\u4f8b","text":"<p>1\uff09\u9700\u6c42\uff1a\u4ece 1G \u6570\u636e\u4e2d\uff0c\u7edf\u8ba1\u6bcf\u4e2a\u5355\u8bcd\u51fa\u73b0\u6b21\u6570\u3002\u670d\u52a1\u5668 3 \u53f0\uff0c\u6bcf\u53f0\u914d\u7f6e 4G \u5185\u5b58\uff0c4 \u6838CPU\uff0c4 \u7ebf\u7a0b\u3002</p> <p>2\uff09\u9700\u6c42\u5206\u6790\uff1a</p> <p>1G / 128m = 8 \u4e2a MapTask\uff1b1 \u4e2a ReduceTask\uff1b1 \u4e2a mrAppMaster \u5e73\u5747\u6bcf\u4e2a\u8282\u70b9\u8fd0\u884c 10\u4e2a / 3\u53f0 \u2248 3\u4e2a\u4efb\u52a1\uff084  3   3\uff09</p> <p>3\uff09\u4fee\u6539 yarn-site.xml \u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> yarn-site.xml<pre><code>&lt;!-- \u9009\u62e9\u8c03\u5ea6\u5668\uff0c\u9ed8\u8ba4\u5bb9\u91cf --&gt;\n&lt;property&gt;\n&lt;description&gt;The class to use as the resource scheduler.&lt;/description&gt;\n&lt;name&gt;yarn.resourcemanager.scheduler.class&lt;/name&gt;\n&lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- ResourceManager\u5904\u7406\u8c03\u5ea6\u5668\u8bf7\u6c42\u7684\u7ebf\u7a0b\u6570\u91cf,\u9ed8\u8ba450\uff1b\u5982\u679c\u63d0\u4ea4\u7684\u4efb\u52a1\u6570\u5927\u4e8e50\uff0c\u53ef\u4ee5\u589e\u52a0\u8be5\u503c\uff0c\u4f46\u662f\u4e0d\u80fd\u8d85\u8fc73\u53f0 * 4\u7ebf\u7a0b = 12\u7ebf\u7a0b\uff08\u53bb\u9664\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u5b9e\u9645\u4e0d\u80fd\u8d85\u8fc78\uff09 --&gt;\n&lt;property&gt;\n&lt;description&gt;Number of threads to handle scheduler interface.&lt;/description&gt;\n&lt;name&gt;yarn.resourcemanager.scheduler.client.thread-count&lt;/name&gt;\n&lt;value&gt;8&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u662f\u5426\u8ba9yarn\u81ea\u52a8\u68c0\u6d4b\u786c\u4ef6\u8fdb\u884c\u914d\u7f6e\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u5982\u679c\u8be5\u8282\u70b9\u6709\u5f88\u591a\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\uff0c\u5efa\u8bae\u624b\u52a8\u914d\u7f6e\u3002\u5982\u679c\u8be5\u8282\u70b9\u6ca1\u6709\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u91c7\u7528\u81ea\u52a8 --&gt;\n&lt;property&gt;\n&lt;description&gt;Enable auto-detection of node capabilities such as\n    memory and CPU.\n    &lt;/description&gt;\n&lt;name&gt;yarn.nodemanager.resource.detect-hardware-capabilities&lt;/name&gt;\n&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u662f\u5426\u5c06\u865a\u62df\u6838\u6570\u5f53\u4f5cCPU\u6838\u6570\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u91c7\u7528\u7269\u7406CPU\u6838\u6570 --&gt;\n&lt;property&gt;\n&lt;description&gt;Flag to determine if logical processors(such as\n    hyperthreads) should be counted as cores. Only applicable on Linux\n    when yarn.nodemanager.resource.cpu-vcores is set to -1 and\n    yarn.nodemanager.resource.detect-hardware-capabilities is true.\n    &lt;/description&gt;\n&lt;name&gt;yarn.nodemanager.resource.count-logical-processors-as-cores&lt;/name&gt;\n&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u865a\u62df\u6838\u6570\u548c\u7269\u7406\u6838\u6570\u4e58\u6570\uff0c\u9ed8\u8ba4\u662f1.0 --&gt;\n&lt;property&gt;\n&lt;description&gt;Multiplier to determine how to convert phyiscal cores to\n    vcores. This value is used if yarn.nodemanager.resource.cpu-vcores\n    is set to -1(which implies auto-calculate vcores) and\n    yarn.nodemanager.resource.detect-hardware-capabilities is set to true. The  number of vcores will be calculated as  number of CPUs * multiplier.\n    &lt;/description&gt;\n&lt;name&gt;yarn.nodemanager.resource.pcores-vcores-multiplier&lt;/name&gt;\n&lt;value&gt;1.0&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- NodeManager\u4f7f\u7528\u5185\u5b58\u6570\uff0c\u9ed8\u8ba48G\uff0c\u4fee\u6539\u4e3a4G\u5185\u5b58 --&gt;\n&lt;property&gt;\n&lt;description&gt;Amount of physical memory, in MB, that can be allocated for containers. If set to -1 and\n    yarn.nodemanager.resource.detect-hardware-capabilities is true, it is\n    automatically calculated(in case of Windows and Linux).\n    In other cases, the default is 8192MB.\n    &lt;/description&gt;\n&lt;name&gt;yarn.nodemanager.resource.memory-mb&lt;/name&gt;\n&lt;value&gt;4096&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- nodemanager\u7684CPU\u6838\u6570\uff0c\u4e0d\u6309\u7167\u786c\u4ef6\u73af\u5883\u81ea\u52a8\u8bbe\u5b9a\u65f6\u9ed8\u8ba4\u662f8\u4e2a\uff0c\u4fee\u6539\u4e3a4\u4e2a --&gt;\n&lt;property&gt;\n&lt;description&gt;Number of vcores that can be allocated\n    for containers. This is used by the RM scheduler when allocating\n    resources for containers. This is not used to limit the number of\n    CPUs used by YARN containers. If it is set to -1 and\n    yarn.nodemanager.resource.detect-hardware-capabilities is true, it is\n    automatically determined from the hardware in case of Windows and Linux.\n    In other cases, number of vcores is 8 by default.&lt;/description&gt;\n&lt;name&gt;yarn.nodemanager.resource.cpu-vcores&lt;/name&gt;\n&lt;value&gt;4&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u5bb9\u5668\u6700\u5c0f\u5185\u5b58\uff0c\u9ed8\u8ba41G --&gt;\n&lt;property&gt;\n&lt;description&gt;The minimum allocation for every container request at the RM   in MBs. Memory requests lower than this will be set to the value of this    property. Additionally, a node manager that is configured to have less memory   than this value will be shut down by the resource manager.\n    &lt;/description&gt;\n&lt;name&gt;yarn.scheduler.minimum-allocation-mb&lt;/name&gt;\n&lt;value&gt;1024&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u5bb9\u5668\u6700\u5927\u5185\u5b58\uff0c\u9ed8\u8ba48G\uff0c\u4fee\u6539\u4e3a2G --&gt;\n&lt;property&gt;\n&lt;description&gt;The maximum allocation for every container request at the RM   in MBs. Memory requests higher than this will throw an  InvalidResourceRequestException.\n    &lt;/description&gt;\n&lt;name&gt;yarn.scheduler.maximum-allocation-mb&lt;/name&gt;\n&lt;value&gt;2048&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u5bb9\u5668\u6700\u5c0fCPU\u6838\u6570\uff0c\u9ed8\u8ba41\u4e2a --&gt;\n&lt;property&gt;\n&lt;description&gt;The minimum allocation for every container request at the RM   in terms of virtual CPU cores. Requests lower than this will be set to the  value of this property. Additionally, a node manager that is configured to  have fewer virtual cores than this value will be shut down by the resource  manager.\n    &lt;/description&gt;\n&lt;name&gt;yarn.scheduler.minimum-allocation-vcores&lt;/name&gt;\n&lt;value&gt;1&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u5bb9\u5668\u6700\u5927CPU\u6838\u6570\uff0c\u9ed8\u8ba44\u4e2a\uff0c\u4fee\u6539\u4e3a2\u4e2a --&gt;\n&lt;property&gt;\n&lt;description&gt;The maximum allocation for every container request at the RM   in terms of virtual CPU cores. Requests higher than this will throw an\n    InvalidResourceRequestException.&lt;/description&gt;\n&lt;name&gt;yarn.scheduler.maximum-allocation-vcores&lt;/name&gt;\n&lt;value&gt;2&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u865a\u62df\u5185\u5b58\u68c0\u67e5\uff0c\u9ed8\u8ba4\u6253\u5f00\uff0c\u4fee\u6539\u4e3a\u5173\u95ed --&gt;\n&lt;property&gt;\n&lt;description&gt;Whether virtual memory limits will be enforced for\n    containers.&lt;/description&gt;\n&lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;\n&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u8bbe\u7f6e\u6bd4\u4f8b,\u9ed8\u8ba42.1 --&gt;\n&lt;property&gt;\n&lt;description&gt;Ratio between virtual memory to physical memory when   setting memory limits for containers. Container allocations are expressed in terms of physical memory, and virtual memory usage is allowed to exceed this allocation by this ratio.\n    &lt;/description&gt;\n&lt;name&gt;yarn.nodemanager.vmem-pmem-ratio&lt;/name&gt;\n&lt;value&gt;2.1&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p> </p> \u5173\u95ed\u865a\u62df\u5185\u5b58\u68c0\u67e5\u539f\u56e0 <p>4\uff09\u5206\u53d1\u914d\u7f6e</p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u96c6\u7fa4\u7684\u786c\u4ef6\u8d44\u6e90\u4e0d\u4e00\u81f4\uff0c\u8981\u6bcf\u4e2a NodeManager \u5355\u72ec\u914d\u7f6e\u3002</p> <p>5\uff09\u91cd\u542f\u96c6\u7fa4</p> <pre><code>sbin/stop-yarn.sh\nsbin/start-yarn.sh\n</code></pre> <p>6\uff09\u6267\u884c WordCount \u7a0b\u5e8f</p> <pre><code>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output\n</code></pre> <p>7\uff09\u89c2\u5bdf Yarn \u4efb\u52a1\u6267\u884c\u9875\u9762</p> <p>http://hadoop103:8088/cluster/apps</p>"},{"location":"hadoop/hdp_16/#62","title":"6.2 \u5bb9\u91cf\u8c03\u5ea6\u5668\u591a\u961f\u5217\u63d0\u4ea4\u6848\u4f8b","text":"<p>1\uff09\u5728\u751f\u4ea7\u73af\u5883\u600e\u4e48\u521b\u5efa\u961f\u5217\uff1f</p> <p>\uff081\uff09\u8c03\u5ea6\u5668\u9ed8\u8ba4\u5c31 1 \u4e2a default \u961f\u5217\uff0c\u4e0d\u80fd\u6ee1\u8db3\u751f\u4ea7\u8981\u6c42\u3002</p> <p>\uff082\uff09\u6309\u7167\u6846\u67b6\uff1ahive /spark/ flink \u6bcf\u4e2a\u6846\u67b6\u7684\u4efb\u52a1\u653e\u5165\u6307\u5b9a\u7684\u961f\u5217\uff08\u4f01\u4e1a\u7528\u7684\u4e0d\u662f\u7279\u522b\u591a\uff09\u3002</p> <p>\uff083\uff09\u6309\u7167\u4e1a\u52a1\u6a21\u5757\uff1a\u767b\u5f55\u6ce8\u518c\u3001\u8d2d\u7269\u8f66\u3001\u4e0b\u5355\u3001\u4e1a\u52a1\u90e8\u95e81\u3001\u4e1a\u52a1\u90e8\u95e82\u3002</p> <p>2\uff09\u521b\u5efa\u591a\u961f\u5217\u7684\u597d\u5904\uff1f</p> <p>\uff081\uff09\u56e0\u4e3a\u62c5\u5fc3\u5458\u5de5\u4e0d\u5c0f\u5fc3\uff0c\u5199\u9012\u5f52\u6b7b\u5faa\u73af\u4ee3\u7801\uff0c\u628a\u6240\u6709\u8d44\u6e90\u5168\u90e8\u8017\u5c3d\u3002</p> <p>\uff082\uff09\u5b9e\u73b0\u4efb\u52a1\u7684\u964d\u7ea7\u4f7f\u7528\uff0c\u7279\u6b8a\u65f6\u671f\u4fdd\u8bc1\u91cd\u8981\u7684\u4efb\u52a1\u961f\u5217\u8d44\u6e90\u5145\u8db3\u300211.11  6.18</p> <p>\u4e1a\u52a1\u90e8\u95e81\uff08\u91cd\u8981\uff09=\u300b\u4e1a\u52a1\u90e8\u95e82\uff08\u6bd4\u8f83\u91cd\u8981\uff09=\u300b\u4e0b\u5355\uff08\u4e00\u822c\uff09=\u300b\u8d2d\u7269\u8f66\uff08\u4e00\u822c\uff09=\u300b\u767b\u5f55\u6ce8\u518c\uff08\u6b21\u8981\uff09\u3002</p>"},{"location":"hadoop/hdp_16/#621","title":"6.2.1 \u9700\u6c42","text":"<p>\u9700\u6c421\uff1adefault \u961f\u5217\u5360\u603b\u5185\u5b58\u7684 40%\uff0c\u6700\u5927\u8d44\u6e90\u5bb9\u91cf\u5360\u603b\u8d44\u6e90 60%\uff0chive \u961f\u5217\u5360\u603b\u5185\u5b58\u7684 60%\uff0c\u6700\u5927\u8d44\u6e90\u5bb9\u91cf\u5360\u603b\u8d44\u6e90 80%\u3002</p>"},{"location":"hadoop/hdp_16/#622","title":"6.2.2 \u914d\u7f6e\u591a\u961f\u5217\u7684\u5bb9\u91cf\u8c03\u5ea6\u5668","text":"<p>1\uff09\u5728 capacity-scheduler.xml \u4e2d\u914d\u7f6e\u5982\u4e0b</p> <p>\u200b   \uff081\uff09\u4fee\u6539\u5982\u4e0b\u914d\u7f6e</p> capacity-scheduler.xml<pre><code>&lt;!-- \u6307\u5b9a\u591a\u961f\u5217\uff0c\u589e\u52a0hive\u961f\u5217 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.queues&lt;/name&gt;\n&lt;value&gt;default,hive&lt;/value&gt;\n&lt;description&gt;\nThe queues at the this level (root is the root queue).\n    &lt;/description&gt;\n&lt;/property&gt;\n\n&lt;!-- \u964d\u4f4edefault\u961f\u5217\u8d44\u6e90\u989d\u5b9a\u5bb9\u91cf\u4e3a40%\uff0c\u9ed8\u8ba4100% --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.default.capacity&lt;/name&gt;\n&lt;value&gt;40&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u964d\u4f4edefault\u961f\u5217\u8d44\u6e90\u6700\u5927\u5bb9\u91cf\u4e3a60%\uff0c\u9ed8\u8ba4100% --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.default.maximum-capacity&lt;/name&gt;\n&lt;value&gt;60&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09\u4e3a\u65b0\u52a0\u961f\u5217\u6dfb\u52a0\u5fc5\u8981\u5c5e\u6027</p> capacity-scheduler.xml<pre><code>&lt;!-- \u6307\u5b9ahive\u961f\u5217\u7684\u8d44\u6e90\u989d\u5b9a\u5bb9\u91cf --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.capacity&lt;/name&gt;\n&lt;value&gt;60&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u7528\u6237\u6700\u591a\u53ef\u4ee5\u4f7f\u7528\u961f\u5217\u591a\u5c11\u8d44\u6e90\uff0c1\u8868\u793a --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.user-limit-factor&lt;/name&gt;\n&lt;value&gt;1&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9ahive\u961f\u5217\u7684\u8d44\u6e90\u6700\u5927\u5bb9\u91cf --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.maximum-capacity&lt;/name&gt;\n&lt;value&gt;80&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u542f\u52a8hive\u961f\u5217 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.state&lt;/name&gt;\n&lt;value&gt;RUNNING&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u54ea\u4e9b\u7528\u6237\u6709\u6743\u5411\u961f\u5217\u63d0\u4ea4\u4f5c\u4e1a --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.acl_submit_applications&lt;/name&gt;\n&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u54ea\u4e9b\u7528\u6237\u6709\u6743\u64cd\u4f5c\u961f\u5217\uff0c\u7ba1\u7406\u5458\u6743\u9650\uff08\u67e5\u770b/\u6740\u6b7b\uff09 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.acl_administer_queue&lt;/name&gt;\n&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u54ea\u4e9b\u7528\u6237\u6709\u6743\u914d\u7f6e\u63d0\u4ea4\u4efb\u52a1\u4f18\u5148\u7ea7 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.acl_application_max_priority&lt;/name&gt;\n&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u4efb\u52a1\u7684\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\uff1ayarn application -appId appId -updateLifetime Timeout\n\u53c2\u8003\u8d44\u6599\uff1ahttps://blog.cloudera.com/enforcing-application-lifetime-slas-yarn/ --&gt;\n\n&lt;!-- \u5982\u679capplication\u6307\u5b9a\u4e86\u8d85\u65f6\u65f6\u95f4\uff0c\u5219\u63d0\u4ea4\u5230\u8be5\u961f\u5217\u7684application\u80fd\u591f\u6307\u5b9a\u7684\u6700\u5927\u8d85\u65f6\u65f6\u95f4\u4e0d\u80fd\u8d85\u8fc7\u8be5\u503c\u3002 \n--&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.maximum-application-lifetime&lt;/name&gt;\n&lt;value&gt;-1&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u5982\u679capplication\u6ca1\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\uff0c\u5219\u7528default-application-lifetime\u4f5c\u4e3a\u9ed8\u8ba4\u503c --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.scheduler.capacity.root.hive.default-application-lifetime&lt;/name&gt;\n&lt;value&gt;-1&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>2\uff09\u5206\u53d1\u914d\u7f6e\u6587\u4ef6</p> <p>3\uff09\u91cd\u542f Yarn \u6216\u8005\u6267\u884c <code>yarn rmadmin -refreshQueues</code> \u5237\u65b0\u961f\u5217\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u4e24\u6761\u961f\u5217</p> <p></p>"},{"location":"hadoop/hdp_16/#623-hive","title":"6.2.3 \u5411Hive\u961f\u5217\u63d0\u4ea4\u4efb\u52a1","text":"<p>1\uff09hadoop jar \u7684\u65b9\u5f0f</p> <pre><code>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount -D mapreduce.job.queuename=hive /input /output\n</code></pre> <p>\u6ce8: -D \u8868\u793a\u8fd0\u884c\u65f6\u6539\u53d8\u53c2\u6570\u503c</p> <p>2\uff09\u6253 jar \u5305\u7684\u65b9\u5f0f</p> <p>\u9ed8\u8ba4\u7684\u4efb\u52a1\u63d0\u4ea4\u90fd\u662f\u63d0\u4ea4\u5230 default \u961f\u5217\u7684\u3002\u5982\u679c\u5e0c\u671b\u5411\u5176\u4ed6\u961f\u5217\u63d0\u4ea4\u4efb\u52a1\uff0c\u9700\u8981\u5728 Driver \u4e2d\u58f0\u660e\uff1a</p> <pre><code>public class WcDrvier {\n\npublic static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\nConfiguration conf = new Configuration();\n\nconf.set(\"mapreduce.job.queuename\",\"hive\");\n\n//1. \u83b7\u53d6\u4e00\u4e2aJob\u5b9e\u4f8b\nJob job = Job.getInstance(conf);\n\n\u3002\u3002\u3002 \u3002\u3002\u3002\n\n//6. \u63d0\u4ea4Job\nboolean b = job.waitForCompletion(true);\nSystem.exit(b ? 0 : 1);\n}\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u8fd9\u4e2a\u4efb\u52a1\u5728\u96c6\u7fa4\u63d0\u4ea4\u65f6\uff0c\u5c31\u4f1a\u63d0\u4ea4\u5230 hive \u961f\u5217\uff1a</p> <p></p>"},{"location":"hadoop/hdp_17/","title":"\u7b2c7\u7ae0 \u5e38\u89c1\u9519\u8bef\u53ca\u89e3\u51b3\u65b9\u6848","text":"<p>1\uff09\u5bfc\u5305\u5bb9\u6613\u51fa\u9519\u3002\u5c24\u5176 Text \u548c CombineTextInputFormat\u3002</p> <p>2\uff09Mapper \u4e2d\u7b2c\u4e00\u4e2a\u8f93\u5165\u7684\u53c2\u6570\u5fc5\u987b\u662f LongWritable \u6216\u8005 NullWritable\uff0c\u4e0d\u53ef\u4ee5\u662f IntWritable.  \u62a5\u7684\u9519\u8bef\u662f\u7c7b\u578b\u8f6c\u6362\u5f02\u5e38\u3002</p> <p>3\uff09<code>java.lang.Exception: java.io.IOException: Illegal partition for 13926435656 (4)</code>\uff0c\u8bf4\u660e Partition \u548c ReduceTask \u4e2a\u6570\u6ca1\u5bf9\u4e0a\uff0c\u8c03\u6574 ReduceTask \u4e2a\u6570\u3002</p> <p>4\uff09\u5982\u679c\u5206\u533a\u6570\u4e0d\u662f 1\uff0c\u4f46\u662f reducetask \u4e3a 1\uff0c\u662f\u5426\u6267\u884c\u5206\u533a\u8fc7\u7a0b\u3002\u7b54\u6848\u662f\uff1a\u4e0d\u6267\u884c\u5206\u533a\u8fc7\u7a0b\u3002\u56e0\u4e3a\u5728 MapTask \u7684\u6e90\u7801\u4e2d\uff0c\u6267\u884c\u5206\u533a\u7684\u524d\u63d0\u662f\u5148\u5224\u65ad ReduceNum \u4e2a\u6570\u662f\u5426\u5927\u4e8e 1\u3002\u4e0d\u5927\u4e8e 1 \u80af\u5b9a\u4e0d\u6267\u884c\u3002</p> <p>5\uff09\u5728 Windows \u73af\u5883\u7f16\u8bd1\u7684 jar \u5305\u5bfc\u5165\u5230 Linux \u73af\u5883\u4e2d\u8fd0\u884c\uff0c</p> <p><code>hadoop jar wc.jar com.atguigu.mapreduce.wordcount.WordCountDriver /user/atguigu/ /user/atguigu/output</code></p> <p>\u62a5\u5982\u4e0b\u9519\u8bef\uff1a</p> <pre><code>Exception in thread \"main\" java.lang.UnsupportedClassVersionError: com/atguigu/mapreduce/wordcount/WordCountDriver : Unsupported major.minor version 52.0\n</code></pre> <p>\u539f\u56e0\u662f Windows \u73af\u5883\u7528\u7684 jdk1.7\uff0cLinux \u73af\u5883\u7528\u7684 jdk1.8\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u7edf\u4e00 jdk \u7248\u672c\u3002</p> <p>6\uff09\u7f13\u5b58 pd.txt \u5c0f\u6587\u4ef6\u6848\u4f8b\u4e2d\uff0c\u62a5\u627e\u4e0d\u5230 pd.txt \u6587\u4ef6</p> <p>\u539f\u56e0\uff1a\u5927\u90e8\u5206\u4e3a\u8def\u5f84\u4e66\u5199\u9519\u8bef\u3002\u8fd8\u6709\u5c31\u662f\u8981\u68c0\u67e5 pd.txt \u7684\u95ee\u9898\u3002\u8fd8\u6709\u4e2a\u522b\u7535\u8111\u5199\u76f8\u5bf9\u8def\u5f84\u627e\u4e0d\u5230 pd.txt\uff0c\u53ef\u4ee5\u4fee\u6539\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002</p> <p>7\uff09\u62a5\u7c7b\u578b\u8f6c\u6362\u5f02\u5e38\u3002</p> <p>\u901a\u5e38\u90fd\u662f\u5728\u9a71\u52a8\u51fd\u6570\u4e2d\u8bbe\u7f6e Map \u8f93\u51fa\u548c\u6700\u7ec8\u8f93\u51fa\u65f6\u7f16\u5199\u9519\u8bef\u3002</p> <p>Map \u8f93\u51fa\u7684 key \u5982\u679c\u6ca1\u6709\u6392\u5e8f\uff0c\u4e5f\u4f1a\u62a5\u7c7b\u578b\u8f6c\u6362\u5f02\u5e38\u3002</p> <p>8\uff09\u96c6\u7fa4\u4e2d\u8fd0\u884c wc.jar \u65f6\u51fa\u73b0\u4e86\u65e0\u6cd5\u83b7\u5f97\u8f93\u5165\u6587\u4ef6\u3002</p> <p>\u539f\u56e0\uff1aWordCount \u6848\u4f8b\u7684\u8f93\u5165\u6587\u4ef6\u4e0d\u80fd\u653e\u7528 HDFS \u96c6\u7fa4\u7684\u6839\u76ee\u5f55\u3002</p> <p>9\uff09\u51fa\u73b0\u4e86\u5982\u4e0b\u76f8\u5173\u5f02\u5e38</p> <pre><code>Exception in thread \"main\" java.lang.UnsatisfiedLinkError: org.apache.hadoop.io.nativeio.NativeIO$Windows.access0(Ljava/lang/String;I)Z\n    at org.apache.hadoop.io.nativeio.NativeIO$Windows.access0(Native Method)\nat org.apache.hadoop.io.nativeio.NativeIO$Windows.access(NativeIO.java:609)\nat org.apache.hadoop.fs.FileUtil.canRead(FileUtil.java:977)\njava.io.IOException: Could not locate executable null\\bin\\winutils.exe in the Hadoop binaries.\n    at org.apache.hadoop.util.Shell.getQualifiedBinPath(Shell.java:356)\nat org.apache.hadoop.util.Shell.getWinUtilsPath(Shell.java:371)\nat org.apache.hadoop.util.Shell.&lt;clinit&gt;(Shell.java:364)\n</code></pre> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u62f7\u8d1d hadoop.dll \u6587\u4ef6\u5230 Windows \u76ee\u5f55 C:\\Windows\\System32\u3002\u4e2a\u522b\u540c\u5b66\u7535\u8111\u8fd8\u9700\u8981\u4fee\u6539 Hadoop \u6e90\u7801\u3002</p> <p>\u65b9\u6848\u4e8c\uff1a\u521b\u5efa\u5982\u4e0b\u5305\u540d\uff0c\u5e76\u5c06 NativeIO.java \u62f7\u8d1d\u5230\u8be5\u5305\u540d\u4e0b</p> <p>10\uff09\u81ea\u5b9a\u4e49 Outputformat \u65f6\uff0c\u6ce8\u610f\u5728 RecordWirter \u4e2d\u7684 close \u65b9\u6cd5\u5fc5\u987b\u5173\u95ed\u6d41\u8d44\u6e90\u3002\u5426\u5219\u8f93\u51fa\u7684\u6587\u4ef6\u5185\u5bb9\u4e2d\u6570\u636e\u4e3a\u7a7a\u3002</p> <pre><code>@Override\npublic void close(TaskAttemptContext context) throws IOException, InterruptedException {\nif (atguigufos != null) {\natguigufos.close();\n}\nif (otherfos != null) {\notherfos.close();\n}\n}\n</code></pre>"},{"location":"hadoop/hdp_18/","title":"\u7b2c1\u7ae0 HDFS\u2014\u591a\u76ee\u5f55","text":""},{"location":"hadoop/hdp_18/#11-datanode","title":"1.1 DataNode\u591a\u76ee\u5f55\u914d\u7f6e","text":"<p>1\uff09DataNode \u53ef\u4ee5\u914d\u7f6e\u6210\u591a\u4e2a\u76ee\u5f55\uff0c\u6bcf\u4e2a\u76ee\u5f55\u5b58\u50a8\u7684\u6570\u636e\u4e0d\u4e00\u6837\uff08\u6570\u636e\u4e0d\u662f\u526f\u672c\uff09</p> <p></p> <p>2\uff09\u5177\u4f53\u914d\u7f6e\u5982\u4e0b</p> <p>\u5728 hdfs-site.xml \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\u3002</p> hdfs-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;\n&lt;value&gt;file://${hadoop.tmp.dir}/dfs/data1,file://${hadoop.tmp.dir}/dfs/data2&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>3\uff09\u67e5\u770b\u7ed3\u679c</p> <pre><code>ll\n\n\u603b\u7528\u91cf 12\ndrwx------. 3 atguigu atguigu 4096 4\u6708   4 14:22 data1\ndrwx------. 3 atguigu atguigu 4096 4\u6708   4 14:22 data2\ndrwxrwxr-x. 3 atguigu atguigu 4096 12\u6708 11 08:03 name1\ndrwxrwxr-x. 3 atguigu atguigu 4096 12\u6708 11 08:03 name2\n</code></pre> <p>4\uff09\u5411\u96c6\u7fa4\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\uff0c\u518d\u6b21\u89c2\u5bdf\u4e24\u4e2a\u6587\u4ef6\u5939\u91cc\u9762\u7684\u5185\u5bb9\u53d1\u73b0\u4e0d\u4e00\u81f4\uff08\u4e00\u4e2a\u6709\u6570\u4e00\u4e2a\u6ca1\u6709\uff09</p> <pre><code>hadoop fs -put wcinput/word.txt /\n</code></pre>"},{"location":"hadoop/hdp_18/#12","title":"1.2 \u96c6\u7fa4\u6570\u636e\u5747\u8861\u4e4b\u78c1\u76d8\u95f4\u6570\u636e\u5747\u8861","text":"<p>\u751f\u4ea7\u73af\u5883\uff0c\u7531\u4e8e\u786c\u76d8\u7a7a\u95f4\u4e0d\u8db3\uff0c\u5f80\u5f80\u9700\u8981\u589e\u52a0\u4e00\u5757\u786c\u76d8\u3002\u521a\u52a0\u8f7d\u7684\u786c\u76d8\u6ca1\u6709\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u6267\u884c\u78c1\u76d8\u6570\u636e\u5747\u8861\u547d\u4ee4\u3002\uff08Hadoop3.x \u65b0\u7279\u6027\uff09\u3002</p> <p></p> <p>\uff081\uff09\u751f\u6210\u5747\u8861\u8ba1\u5212\uff08\u6211\u4eec\u53ea\u6709\u4e00\u5757\u78c1\u76d8\uff0c\u4e0d\u4f1a\u751f\u6210\u8ba1\u5212\uff09</p> <pre><code>hdfs diskbalancer -plan hadoop103\n</code></pre> <p>\uff082\uff09\u6267\u884c\u5747\u8861\u8ba1\u5212</p> <pre><code>hdfs diskbalancer -execute hadoop103.plan.json\n</code></pre> <p>\uff083\uff09\u67e5\u770b\u5f53\u524d\u5747\u8861\u4efb\u52a1\u7684\u6267\u884c\u60c5\u51b5</p> <pre><code>hdfs diskbalancer -query hadoop103\n</code></pre> <p>\uff084\uff09\u53d6\u6d88\u5747\u8861\u4efb\u52a1</p> <pre><code>hdfs diskbalancer -cancel hadoop103.plan.json\n</code></pre>"},{"location":"hadoop/hdp_19/","title":"\u7b2c2\u7ae0 HDFS\u2014\u96c6\u7fa4\u6269\u5bb9\u53ca\u7f29\u5bb9","text":""},{"location":"hadoop/hdp_19/#21","title":"2.1 \u6dfb\u52a0\u767d\u540d\u5355","text":"<p>\u767d\u540d\u5355\uff1a\u8868\u793a\u5728\u767d\u540d\u5355\u7684\u4e3b\u673a IP \u5730\u5740\u53ef\u4ee5\uff0c\u7528\u6765\u5b58\u50a8\u6570\u636e\u3002</p> <p>\u4f01\u4e1a\u4e2d\uff1a\u914d\u7f6e\u767d\u540d\u5355\uff0c\u53ef\u4ee5\u5c3d\u91cf\u9632\u6b62\u9ed1\u5ba2\u6076\u610f\u8bbf\u95ee\u653b\u51fb\u3002</p> <p></p> <p>\u914d\u7f6e\u767d\u540d\u5355\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>1\uff09\u5728 NameNode \u8282\u70b9\u7684 /opt/module/hadoop-3.1.3/etc/hadoop \u76ee\u5f55\u4e0b\u5206\u522b\u521b\u5efa whitelist \u548c blacklist \u6587\u4ef6</p> <p>\uff081\uff09\u521b\u5efa\u767d\u540d\u5355</p> whitelist<pre><code>hadoop102\nhadoop103\n</code></pre> <p>\uff082\uff09\u521b\u5efa\u9ed1\u540d\u5355</p> <pre><code>touch blacklist\n</code></pre> <p>\u200b   \u4fdd\u6301\u7a7a\u7684\u5c31\u53ef\u4ee5\u3002</p> <p>2\uff09\u5728 hdfs-site.xml \u914d\u7f6e\u6587\u4ef6\u4e2d\u589e\u52a0 dfs.hosts \u914d\u7f6e\u53c2\u6570</p> hdfs-site.xml<pre><code>&lt;!-- \u767d\u540d\u5355 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.hosts&lt;/name&gt;\n&lt;value&gt;/opt/module/hadoop-3.1.3/etc/hadoop/whitelist&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u9ed1\u540d\u5355 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.hosts.exclude&lt;/name&gt;\n&lt;value&gt;/opt/module/hadoop-3.1.3/etc/hadoop/blacklist&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>3\uff09\u5206\u53d1\u914d\u7f6e\u6587\u4ef6 whitelist\uff0chdfs-site.xml</p> <pre><code>xsync hdfs-site.xml whitelist\n</code></pre> <p>4\uff09\u7b2c\u4e00\u6b21\u6dfb\u52a0\u767d\u540d\u5355\u5fc5\u987b\u91cd\u542f\u96c6\u7fa4\uff0c\u4e0d\u662f\u7b2c\u4e00\u6b21\uff0c\u53ea\u9700\u8981\u5237\u65b0 NameNode \u8282\u70b9\u5373\u53ef</p> <pre><code>myhadoop.sh stop\nmyhadoop.sh start\n</code></pre> <p>5\uff09\u5728 web \u6d4f\u89c8\u5668\u4e0a\u67e5\u770b DN\uff0chttp://hadoop102:9870/dfshealth.html#tab-datanode</p> <p></p> <p>6\uff09\u4e8c\u6b21\u4fee\u6539\u767d\u540d\u5355\uff0c\u589e\u52a0 hadoop104</p> whitelist<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre> <p>7\uff09\u5237\u65b0 NameNode</p> <pre><code>hdfs dfsadmin -refreshNodes\n</code></pre> <p>8\uff09\u5728 web \u6d4f\u89c8\u5668\u4e0a\u67e5\u770b DN\uff0chttp://hadoop102:9870/dfshealth.html#tab-datanode</p> <p></p>"},{"location":"hadoop/hdp_19/#22","title":"2.2 \u670d\u5f79\u65b0\u670d\u52a1\u5668","text":"<p>1\uff09\u9700\u6c42</p> <p>\u968f\u7740\u516c\u53f8\u4e1a\u52a1\u7684\u589e\u957f\uff0c\u6570\u636e\u91cf\u8d8a\u6765\u8d8a\u5927\uff0c\u539f\u6709\u7684\u6570\u636e\u8282\u70b9\u7684\u5bb9\u91cf\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u5b58\u50a8\u6570\u636e\u7684\u9700\u6c42\uff0c\u9700\u8981\u5728\u539f\u6709\u96c6\u7fa4\u57fa\u7840\u4e0a\u52a8\u6001\u6dfb\u52a0\u65b0\u7684\u6570\u636e\u8282\u70b9\u3002</p> <p>2\uff09\u73af\u5883\u51c6\u5907</p> <p>\uff081\uff09\u5728 hadoop100 \u4e3b\u673a\u4e0a\u518d\u514b\u9686\u4e00\u53f0 hadoop105 \u4e3b\u673a</p> <p>\uff082\uff09\u4fee\u6539 IP \u5730\u5740\u548c\u4e3b\u673a\u540d\u79f0</p> <p>\uff083\uff09\u62f7\u8d1d hadoop102 \u7684 /opt/module \u76ee\u5f55\u548c /etc/profile.d/my_env.sh \u5230 hadoop105</p> <p>\uff084\uff09\u5220\u9664 hadoop105 \u4e0a Hadoop \u7684\u5386\u53f2\u6570\u636e\uff0cdata \u548c log \u6570\u636e</p> <p>\uff085\uff09\u914d\u7f6e hadoop102 \u548c hadoop103 \u5230 hadoop105 \u7684 ssh \u65e0\u5bc6\u767b\u5f55</p> <p>3\uff09\u670d\u5f79\u65b0\u8282\u70b9\u5177\u4f53\u6b65\u9aa4</p> <p>\uff081\uff09\u76f4\u63a5\u542f\u52a8 DataNode\uff0c\u5373\u53ef\u5173\u8054\u5230\u96c6\u7fa4</p> <pre><code>hdfs --daemon start datanode\nyarn --daemon start nodemanager\n</code></pre> <p></p> <p>4\uff09\u5728\u767d\u540d\u5355\u4e2d\u589e\u52a0\u65b0\u670d\u5f79\u7684\u670d\u52a1\u5668</p> <p>\uff081\uff09\u5728\u767d\u540d\u5355 whitelist \u4e2d\u589e\u52a0 hadoop104\u3001hadoop105\uff0c\u5e76\u91cd\u542f\u96c6\u7fa4</p> whitelist<pre><code>hadoop102\nhadoop103\nhadoop104\nhadoop105\n</code></pre> <p>\uff082\uff09\u5206\u53d1</p> <pre><code>xsync whitelist\n</code></pre> <p>\uff083\uff09\u5237\u65b0 NameNode</p> <pre><code>hdfs dfsadmin -refreshNodes\n</code></pre> <p>5\uff09\u5728 hadoop105 \u4e0a\u4e0a\u4f20\u6587\u4ef6</p> <pre><code>hadoop fs -put /opt/module/hadoop-3.1.3/LICENSE.txt /\n</code></pre> <p></p> <p>\u601d\u8003</p> <p>\u5982\u679c\u6570\u636e\u4e0d\u5747\u8861\uff08hadoop105 \u6570\u636e\u5c11\uff0c\u5176\u4ed6\u8282\u70b9\u6570\u636e\u591a\uff09\uff0c\u600e\u4e48\u5904\u7406\uff1f</p>"},{"location":"hadoop/hdp_19/#23","title":"2.3 \u670d\u52a1\u5668\u95f4\u6570\u636e\u5747\u8861","text":"<p>1\uff09\u4f01\u4e1a\u7ecf\u9a8c\uff1a</p> <p>\u5728\u4f01\u4e1a\u5f00\u53d1\u4e2d\uff0c\u5982\u679c\u7ecf\u5e38\u5728 hadoop102 \u548c hadoop104 \u4e0a\u63d0\u4ea4\u4efb\u52a1\uff0c\u4e14\u526f\u672c\u6570\u4e3a 2\uff0c\u7531\u4e8e\u6570\u636e\u672c\u5730\u6027\u539f\u5219\uff0c\u5c31\u4f1a\u5bfc\u81f4 hadoop102 \u548c hadoop104 \u6570\u636e\u8fc7\u591a\uff0chadoop103 \u5b58\u50a8\u7684\u6570\u636e\u91cf\u5c0f\u3002</p> <p>\u53e6\u4e00\u79cd\u60c5\u51b5\uff0c\u5c31\u662f\u65b0\u670d\u5f79\u7684\u670d\u52a1\u5668\u6570\u636e\u91cf\u6bd4\u8f83\u5c11\uff0c\u9700\u8981\u6267\u884c\u96c6\u7fa4\u5747\u8861\u547d\u4ee4\u3002</p> <p></p> <p>2\uff09\u5f00\u542f\u6570\u636e\u5747\u8861\u547d\u4ee4</p> <pre><code>sbin/start-balancer.sh -threshold 10\n</code></pre> <p>\u5bf9\u4e8e\u53c2\u6570 10\uff0c\u4ee3\u8868\u7684\u662f\u96c6\u7fa4\u4e2d\u5404\u4e2a\u8282\u70b9\u7684\u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\u76f8\u5dee\u4e0d\u8d85\u8fc7 10%\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u8c03\u6574\u3002</p> <p>3\uff09\u505c\u6b62\u6570\u636e\u5747\u8861\u547d\u4ee4</p> <pre><code>sbin/stop-balancer.sh\n</code></pre> <p>\u6ce8\u610f</p> <p>\u7531\u4e8e HDFS \u9700\u8981\u542f\u52a8\u5355\u72ec\u7684 Rebalance Server \u6765\u6267\u884c Rebalance \u64cd\u4f5c\uff0c\u6240\u4ee5\u5c3d\u91cf\u4e0d\u8981\u5728 NameNode \u4e0a\u6267\u884c start-balancer.sh\uff0c\u800c\u662f\u627e\u4e00\u53f0\u6bd4\u8f83\u7a7a\u95f2\u7684\u673a\u5668\u3002</p>"},{"location":"hadoop/hdp_19/#24","title":"2.4 \u9ed1\u540d\u5355\u9000\u5f79\u670d\u52a1\u5668","text":"<p>\u9ed1\u540d\u5355\uff1a\u8868\u793a\u5728\u9ed1\u540d\u5355\u7684\u4e3b\u673a IP \u5730\u5740\u4e0d\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u6570\u636e\u3002</p> <p>\u4f01\u4e1a\u4e2d\uff1a\u914d\u7f6e\u9ed1\u540d\u5355\uff0c\u7528\u6765\u9000\u5f79\u670d\u52a1\u5668\u3002</p> <p></p> <p>\u9ed1\u540d\u5355\u914d\u7f6e\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>1\uff09\u7f16\u8f91 /opt/module/hadoop-3.1.3/etc/hadoop \u76ee\u5f55\u4e0b\u7684 blacklist \u6587\u4ef6</p> blacklist<pre><code>hadoop105\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u767d\u540d\u5355\u4e2d\u6ca1\u6709\u914d\u7f6e\uff0c\u9700\u8981\u5728 hdfs-site.xml \u914d\u7f6e\u6587\u4ef6\u4e2d\u589e\u52a0 dfs.hosts \u914d\u7f6e\u53c2\u6570</p> hdfs-site.xml<pre><code>&lt;!-- \u9ed1\u540d\u5355 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.hosts.exclude&lt;/name&gt;\n&lt;value&gt;/opt/module/hadoop-3.1.3/etc/hadoop/blacklist&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>2\uff09\u5206\u53d1\u914d\u7f6e\u6587\u4ef6 blacklist\uff0chdfs-site.xml</p> <pre><code>xsync hdfs-site.xml blacklist\n</code></pre> <p>3\uff09\u7b2c\u4e00\u6b21\u6dfb\u52a0\u9ed1\u540d\u5355\u5fc5\u987b\u91cd\u542f\u96c6\u7fa4\uff0c\u4e0d\u662f\u7b2c\u4e00\u6b21\uff0c\u53ea\u9700\u8981\u5237\u65b0 NameNode \u8282\u70b9\u5373\u53ef</p> <pre><code>hdfs dfsadmin -refreshNodes\n</code></pre> <p>4\uff09\u68c0\u67e5 Web \u6d4f\u89c8\u5668\uff0c\u9000\u5f79\u8282\u70b9\u7684\u72b6\u6001\u4e3a decommission in progress\uff08\u9000\u5f79\u4e2d\uff09\uff0c\u8bf4\u660e\u6570\u636e\u8282\u70b9\u6b63\u5728\u590d\u5236\u5757\u5230\u5176\u4ed6\u8282\u70b9</p> <p></p> <p></p> <p>5\uff09\u7b49\u5f85\u9000\u5f79\u8282\u70b9\u72b6\u6001\u4e3a decommissioned\uff08\u6240\u6709\u5757\u5df2\u7ecf\u590d\u5236\u5b8c\u6210\uff09\uff0c\u505c\u6b62\u8be5\u8282\u70b9\u53ca\u8282\u70b9\u8d44\u6e90\u7ba1\u7406\u5668\u3002</p> <p>\u6ce8\u610f</p> <p>\u5982\u679c\u526f\u672c\u6570\u662f 3\uff0c\u670d\u5f79\u7684\u8282\u70b9\u5c0f\u4e8e\u7b49\u4e8e 3\uff0c\u662f\u4e0d\u80fd\u9000\u5f79\u6210\u529f\u7684\uff0c\u9700\u8981\u4fee\u6539\u526f\u672c\u6570\u540e\u624d\u80fd\u9000\u5f79</p> <p></p> <pre><code>hdfs --daemon stop datanode\nyarn --daemon stop nodemanager\n</code></pre> <p>6\uff09\u5982\u679c\u6570\u636e\u4e0d\u5747\u8861\uff0c\u53ef\u4ee5\u7528\u547d\u4ee4\u5b9e\u73b0\u96c6\u7fa4\u7684\u518d\u5e73\u8861</p> <pre><code>sbin/start-balancer.sh -threshold 10\n</code></pre>"},{"location":"hadoop/hdp_20/","title":"\u7b2c3\u7ae0 HDFS\u2014\u6545\u969c\u6392\u9664","text":""},{"location":"hadoop/hdp_20/#31-namenode","title":"3.1 NameNode\u6545\u969c\u5904\u7406","text":"<p>1\uff09\u9700\u6c42</p> <p>NameNode \u8fdb\u7a0b\u6302\u4e86\u5e76\u4e14\u5b58\u50a8\u7684\u6570\u636e\u4e5f\u4e22\u5931\u4e86\uff0c\u5982\u4f55\u6062\u590d NameNode</p> <p>2\uff09\u6545\u969c\u6a21\u62df</p> <p>\uff081\uff09kill -9 NameNode\u8fdb\u7a0b</p> <pre><code>kill -9 19886\n</code></pre> <p>\uff082\uff09\u5220\u9664 NameNode \u5b58\u50a8\u7684\u6570\u636e\uff08 /opt/module/hadoop-3.1.3/data/tmp/dfs/name \uff09</p> <pre><code>rm -rf /opt/module/hadoop-3.1.3/data/dfs/name/*\n</code></pre> <p>3\uff09\u95ee\u9898\u89e3\u51b3</p> <p>\uff081\uff09\u62f7\u8d1d SecondaryNameNode \u4e2d\u6570\u636e\u5230\u539f NameNode \u5b58\u50a8\u6570\u636e\u76ee\u5f55</p> <pre><code>scp -r atguigu@hadoop104:/opt/module/hadoop-3.1.3/data/dfs/namesecondary/* ./name/\n</code></pre> <p>\uff082\uff09\u91cd\u65b0\u542f\u52a8 NameNode</p> <pre><code>hdfs --daemon start namenode\n</code></pre> <p>\uff083\uff09\u5411\u96c6\u7fa4\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6</p>"},{"location":"hadoop/hdp_20/#32","title":"3.2 \u96c6\u7fa4\u5b89\u5168\u6a21\u5f0f&amp;\u78c1\u76d8\u4fee\u590d","text":"<p>1\uff09\u5b89\u5168\u6a21\u5f0f\uff1a\u6587\u4ef6\u7cfb\u7edf\u53ea\u63a5\u53d7\u8bfb\u6570\u636e\u8bf7\u6c42\uff0c\u800c\u4e0d\u63a5\u53d7\u5220\u9664\u3001\u4fee\u6539\u7b49\u53d8\u66f4\u8bf7\u6c42</p> <p>2\uff09\u8fdb\u5165\u5b89\u5168\u6a21\u5f0f\u573a\u666f</p> <ul> <li>NameNode \u5728\u52a0\u8f7d\u955c\u50cf\u6587\u4ef6\u548c\u7f16\u8f91\u65e5\u5fd7\u671f\u95f4\u5904\u4e8e\u5b89\u5168\u6a21\u5f0f</li> <li>NameNode \u5728\u63a5\u6536 DataNode \u6ce8\u518c\u65f6\uff0c\u5904\u4e8e\u5b89\u5168\u6a21\u5f0f</li> </ul> <p></p> <p>3\uff09\u9000\u51fa\u5b89\u5168\u6a21\u5f0f\u6761\u4ef6</p> <p><code>dfs.namenode.safemode.threshold-pct</code>: \u526f\u672c\u6570\u8fbe\u5230\u6700\u5c0f\u8981\u6c42\u7684 block \u5360\u7cfb\u7edf\u603b block \u6570\u7684\u767e\u5206\u6bd4\uff0c\u9ed8\u8ba4 0.999f\u3002\uff08\u53ea\u5141\u8bb8\u4e22\u4e00\u4e2a\u5757\uff09</p> <p>4\uff09\u57fa\u672c\u8bed\u6cd5</p> <p>\u96c6\u7fa4\u5904\u4e8e\u5b89\u5168\u6a21\u5f0f\uff0c\u4e0d\u80fd\u6267\u884c\u91cd\u8981\u64cd\u4f5c\uff08\u5199\u64cd\u4f5c\uff09\u3002\u96c6\u7fa4\u542f\u52a8\u5b8c\u6210\u540e\uff0c\u81ea\u52a8\u9000\u51fa\u5b89\u5168\u6a21\u5f0f\u3002</p> <pre><code>\uff081\uff09bin/hdfs dfsadmin -safemode get  \uff08\u529f\u80fd\u63cf\u8ff0\uff1a\u67e5\u770b\u5b89\u5168\u6a21\u5f0f\u72b6\u6001\uff09\n\uff082\uff09bin/hdfs dfsadmin -safemode enter \uff08\u529f\u80fd\u63cf\u8ff0\uff1a\u8fdb\u5165\u5b89\u5168\u6a21\u5f0f\u72b6\u6001\uff09\n\uff083\uff09bin/hdfs dfsadmin -safemode leave    \uff08\u529f\u80fd\u63cf\u8ff0\uff1a\u79bb\u5f00\u5b89\u5168\u6a21\u5f0f\u72b6\u6001\uff09\n\uff084\uff09bin/hdfs dfsadmin -safemode wait \uff08\u529f\u80fd\u63cf\u8ff0\uff1a\u7b49\u5f85\u5b89\u5168\u6a21\u5f0f\u72b6\u6001\uff09\n</code></pre> <p>5\uff09\u6848\u4f8b 1\uff1a\u542f\u52a8\u96c6\u7fa4\u8fdb\u5165\u5b89\u5168\u6a21\u5f0f</p> <p>\uff081\uff09\u91cd\u65b0\u542f\u52a8\u96c6\u7fa4</p> <pre><code>myhadoop.sh stop\nmyhadoop.sh start\n</code></pre> <p>\uff082\uff09\u96c6\u7fa4\u542f\u52a8\u540e\uff0c\u7acb\u5373\u6765\u5230\u96c6\u7fa4\u4e0a\u5220\u9664\u6570\u636e\uff0c\u63d0\u793a\u96c6\u7fa4\u5904\u4e8e\u5b89\u5168\u6a21\u5f0f</p> <p></p> <p>6\uff09\u6848\u4f8b2\uff1a\u78c1\u76d8\u4fee\u590d</p> <p>\u200b   \u9700\u6c42\uff1a\u6570\u636e\u5757\u635f\u574f\uff0c\u8fdb\u5165\u5b89\u5168\u6a21\u5f0f\uff0c\u5982\u4f55\u5904\u7406</p> <p>\uff081\uff09\u5206\u522b\u8fdb\u5165 hadoop102\u3001hadoop103\u3001hadoop104 \u7684 /opt/module/hadoop-3.1.3/data/dfs/data/current/BP-1015489500-192.168.10.102-1611909480872/current/finalized/subdir0/subdir0 \u76ee\u5f55\uff0c\u7edf\u4e00\u5220\u9664\u67d0 2 \u4e2a\u5757\u4fe1\u606f</p> <pre><code>rm -rf blk_1073741847 blk_1073741847_1023.meta\nrm -rf blk_1073741865 blk_1073741865_1042.meta\n</code></pre> <p>\u8bf4\u660e\uff1ahadoop103 / hadoop104 \u91cd\u590d\u6267\u884c\u4ee5\u4e0a\u547d\u4ee4</p> <p>\uff082\uff09\u91cd\u65b0\u542f\u52a8\u96c6\u7fa4</p> <pre><code>myhadoop.sh stop\nmyhadoop.sh start\n</code></pre> <p>\uff083\uff09\u89c2\u5bdf http://hadoop102:9870/dfshealth.html#tab-overview</p> <p></p> <p>\u8bf4\u660e</p> <p>\u5b89\u5168\u6a21\u5f0f\u5df2\u7ecf\u6253\u5f00\uff0c\u5757\u7684\u6570\u91cf\u6ca1\u6709\u8fbe\u5230\u8981\u6c42\u3002</p> <p>\uff084\uff09\u79bb\u5f00\u5b89\u5168\u6a21\u5f0f</p> <pre><code>hdfs dfsadmin -safemode get\nSafe mode is ON\n\nhdfs dfsadmin -safemode leave\nSafe mode is OFF\n</code></pre> <p>\uff085\uff09\u89c2\u5bdf http://hadoop102:9870/dfshealth.html#tab-overview</p> <p></p> <p>\uff086\uff09\u5c06\u5143\u6570\u636e\u5220\u9664</p> <p></p> <p></p> <p>\uff087\uff09\u89c2\u5bdf http://hadoop102:9870/dfshealth.html#tab-overview\uff0c\u96c6\u7fa4\u5df2\u7ecf\u6b63\u5e38</p> <p>7\uff09\u6848\u4f8b3\uff1a</p> <p>\u9700\u6c42\uff1a\u6a21\u62df\u7b49\u5f85\u5b89\u5168\u6a21\u5f0f\u3002</p> <p>\uff081\uff09\u67e5\u770b\u5f53\u524d\u6a21\u5f0f</p> <pre><code>hdfs dfsadmin -safemode get\nSafe mode is OFF\n</code></pre> <p>\uff082\uff09\u5148\u8fdb\u5165\u5b89\u5168\u6a21\u5f0f</p> <pre><code>bin/hdfs dfsadmin -safemode enter\n</code></pre> <p>\uff083\uff09\u521b\u5efa\u5e76\u6267\u884c\u4e0b\u9762\u7684\u811a\u672c</p> <p>\u5728 /opt/module/hadoop-3.1.3 \u8def\u5f84\u4e0a\uff0c\u7f16\u8f91\u4e00\u4e2a\u811a\u672c safemode.sh\u3002</p> safemode.sh<pre><code>#!/bin/bash\nhdfs dfsadmin -safemode wait\nhdfs dfs -put /opt/module/hadoop-3.1.3/README.txt /\n</code></pre> <p>\uff084\uff09\u518d\u6253\u5f00\u4e00\u4e2a\u7a97\u53e3\uff0c\u6267\u884c</p> <pre><code>bin/hdfs dfsadmin -safemode leave\n</code></pre> <p>\uff085\uff09\u518d\u89c2\u5bdf\u4e0a\u4e00\u4e2a\u7a97\u53e3</p> <pre><code>Safe mode is OFF\n</code></pre> <p>\uff086\uff09HDFS \u96c6\u7fa4\u4e0a\u5df2\u7ecf\u6709\u4e0a\u4f20\u7684\u6570\u636e\u4e86</p> <p></p>"},{"location":"hadoop/hdp_21/","title":"\u7b2c4\u7ae0Hadoop\u4f01\u4e1a\u4f18\u5316","text":""},{"location":"hadoop/hdp_21/#41-mapreduce","title":"4.1 MapReduce\u4f18\u5316\u65b9\u6cd5","text":"<p>MapReduce \u4f18\u5316\u65b9\u6cd5\u4e3b\u8981\u4ece\u516d\u4e2a\u65b9\u9762\u8003\u8651\uff1a\u6570\u636e\u8f93\u5165\u3001Map \u9636\u6bb5\u3001Reduce \u9636\u6bb5\u3001IO \u4f20\u8f93\u3001\u6570\u636e\u503e\u659c\u95ee\u9898\u548c\u5e38\u7528\u7684\u8c03\u4f18\u53c2\u6570\u3002</p>"},{"location":"hadoop/hdp_21/#411","title":"4.1.1 \u6570\u636e\u8f93\u5165","text":""},{"location":"hadoop/hdp_21/#412-map","title":"4.1.2 Map\u9636\u6bb5","text":""},{"location":"hadoop/hdp_21/#413-reduce","title":"4.1.3 Reduce\u9636\u6bb5","text":""},{"location":"hadoop/hdp_21/#414-io","title":"4.1.4 I/O\u4f20\u8f93","text":""},{"location":"hadoop/hdp_21/#42","title":"4.2 \u5e38\u7528\u7684\u8c03\u4f18\u53c2\u6570","text":"<p>1\uff09\u8d44\u6e90\u76f8\u5173\u53c2\u6570</p> <p>\uff081\uff09\u4ee5\u4e0b\u53c2\u6570\u662f\u5728\u7528\u6237\u81ea\u5df1\u7684 MR \u5e94\u7528\u7a0b\u5e8f\u4e2d\u914d\u7f6e\u5c31\u53ef\u4ee5\u751f\u6548\uff08mapred-default.xml\uff09</p> \u914d\u7f6e\u53c2\u6570 \u53c2\u6570\u8bf4\u660e mapreduce.map.memory.mb \u4e00\u4e2aMapTask\u53ef\u4f7f\u7528\u7684\u8d44\u6e90\u4e0a\u9650\uff08\u5355\u4f4d:MB\uff09\uff0c\u9ed8\u8ba4\u4e3a1024\u3002\u5982\u679cMapTask\u5b9e\u9645\u4f7f\u7528\u7684\u8d44\u6e90\u91cf\u8d85\u8fc7\u8be5\u503c\uff0c\u5219\u4f1a\u88ab\u5f3a\u5236\u6740\u6b7b\u3002 mapreduce.reduce.memory.mb \u4e00\u4e2aReduceTask\u53ef\u4f7f\u7528\u7684\u8d44\u6e90\u4e0a\u9650\uff08\u5355\u4f4d:MB\uff09\uff0c\u9ed8\u8ba4\u4e3a1024\u3002\u5982\u679cReduceTask\u5b9e\u9645\u4f7f\u7528\u7684\u8d44\u6e90\u91cf\u8d85\u8fc7\u8be5\u503c\uff0c\u5219\u4f1a\u88ab\u5f3a\u5236\u6740\u6b7b\u3002 mapreduce.map.cpu.vcores \u6bcf\u4e2aMapTask\u53ef\u4f7f\u7528\u7684\u6700\u591acpu core\u6570\u76ee\uff0c\u9ed8\u8ba4\u503c: 1 mapreduce.reduce.cpu.vcores \u6bcf\u4e2aReduceTask\u53ef\u4f7f\u7528\u7684\u6700\u591acpu core\u6570\u76ee\uff0c\u9ed8\u8ba4\u503c: 1 mapreduce.reduce.shuffle.parallelcopies \u6bcf\u4e2aReduce\u53bbMap\u4e2d\u53d6\u6570\u636e\u7684\u5e76\u884c\u6570\u3002\u9ed8\u8ba4\u503c\u662f5 mapreduce.reduce.shuffle.merge.percent Buffer\u4e2d\u7684\u6570\u636e\u8fbe\u5230\u591a\u5c11\u6bd4\u4f8b\u5f00\u59cb\u5199\u5165\u78c1\u76d8\u3002\u9ed8\u8ba4\u503c0.66 mapreduce.reduce.shuffle.input.buffer.percent Buffer\u5927\u5c0f\u5360Reduce\u53ef\u7528\u5185\u5b58\u7684\u6bd4\u4f8b\u3002\u9ed8\u8ba4\u503c0.7 mapreduce.reduce.input.buffer.percent \u6307\u5b9a\u591a\u5c11\u6bd4\u4f8b\u7684\u5185\u5b58\u7528\u6765\u5b58\u653eBuffer\u4e2d\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u503c\u662f0.0 <p>\uff082\uff09\u5e94\u8be5\u5728 YARN \u542f\u52a8\u4e4b\u524d\u5c31\u914d\u7f6e\u5728\u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u624d\u80fd\u751f\u6548\uff08yarn-default.xml\uff09</p> \u914d\u7f6e\u53c2\u6570 \u53c2\u6570\u8bf4\u660e yarn.scheduler.minimum-allocation-mb \u7ed9\u5e94\u7528\u7a0b\u5e8fContainer\u5206\u914d\u7684\u6700\u5c0f\u5185\u5b58\uff0c\u9ed8\u8ba4\u503c\uff1a1024 yarn.scheduler.maximum-allocation-mb \u7ed9\u5e94\u7528\u7a0b\u5e8fContainer\u5206\u914d\u7684\u6700\u5927\u5185\u5b58\uff0c\u9ed8\u8ba4\u503c\uff1a8192 yarn.scheduler.minimum-allocation-vcores \u6bcf\u4e2aContainer\u7533\u8bf7\u7684\u6700\u5c0fCPU\u6838\u6570\uff0c\u9ed8\u8ba4\u503c\uff1a1 yarn.scheduler.maximum-allocation-vcores \u6bcf\u4e2aContainer\u7533\u8bf7\u7684\u6700\u5927CPU\u6838\u6570\uff0c\u9ed8\u8ba4\u503c\uff1a32 yarn.nodemanager.resource.memory-mb \u7ed9Containers\u5206\u914d\u7684\u6700\u5927\u7269\u7406\u5185\u5b58\uff0c\u9ed8\u8ba4\u503c\uff1a8192 <p>\uff083\uff09Shuffle \u6027\u80fd\u4f18\u5316\u7684\u5173\u952e\u53c2\u6570\uff0c\u5e94\u5728 YARN \u542f\u52a8\u4e4b\u524d\u5c31\u914d\u7f6e\u597d\uff08mapred-default.xml\uff09</p> \u914d\u7f6e\u53c2\u6570 \u53c2\u6570\u8bf4\u660e mapreduce.task.io.sort.mb Shuffle\u7684\u73af\u5f62\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u9ed8\u8ba4100m mapreduce.map.sort.spill.percent \u73af\u5f62\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u9608\u503c\uff0c\u9ed8\u8ba480% <p>2\uff09\u5bb9\u9519\u76f8\u5173\u53c2\u6570\uff08MapReduce \u6027\u80fd\u4f18\u5316\uff09</p> \u914d\u7f6e\u53c2\u6570 \u53c2\u6570\u8bf4\u660e mapreduce.map.maxattempts \u6bcf\u4e2aMap Task\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u4e00\u65e6\u91cd\u8bd5\u6b21\u6570\u8d85\u8fc7\u8be5\u503c\uff0c\u5219\u8ba4\u4e3aMap Task\u8fd0\u884c\u5931\u8d25\uff0c\u9ed8\u8ba4\u503c\uff1a4\u3002 mapreduce.reduce.maxattempts \u6bcf\u4e2aReduce Task\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u4e00\u65e6\u91cd\u8bd5\u6b21\u6570\u8d85\u8fc7\u8be5\u503c\uff0c\u5219\u8ba4\u4e3aMap Task\u8fd0\u884c\u5931\u8d25\uff0c\u9ed8\u8ba4\u503c\uff1a4\u3002 mapreduce.task.timeout Task\u8d85\u65f6\u65f6\u95f4\uff0c\u7ecf\u5e38\u9700\u8981\u8bbe\u7f6e\u7684\u4e00\u4e2a\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u8868\u8fbe\u7684\u610f\u601d\u4e3a\uff1a\u5982\u679c\u4e00\u4e2aTask\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u4efb\u4f55\u8fdb\u5165\uff0c\u5373\u4e0d\u4f1a\u8bfb\u53d6\u65b0\u7684\u6570\u636e\uff0c\u4e5f\u6ca1\u6709\u8f93\u51fa\u6570\u636e\uff0c\u5219\u8ba4\u4e3a\u8be5Task\u5904\u4e8eBlock\u72b6\u6001\uff0c\u53ef\u80fd\u662f\u5361\u4f4f\u4e86\uff0c\u4e5f\u8bb8\u6c38\u8fdc\u4f1a\u5361\u4f4f\uff0c\u4e3a\u4e86\u9632\u6b62\u56e0\u4e3a\u7528\u6237\u7a0b\u5e8f\u6c38\u8fdcBlock\u4f4f\u4e0d\u9000\u51fa\uff0c\u5219\u5f3a\u5236\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u8be5\u8d85\u65f6\u65f6\u95f4\uff08\u5355\u4f4d\u6beb\u79d2\uff09\uff0c\u9ed8\u8ba4\u662f600000\uff0810\u5206\u949f\uff09\u3002\u5982\u679c\u4f60\u7684\u7a0b\u5e8f\u5bf9\u6bcf\u6761\u8f93\u5165\u6570\u636e\u7684\u5904\u7406\u65f6\u95f4\u8fc7\u957f\uff08\u6bd4\u5982\u4f1a\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u901a\u8fc7\u7f51\u7edc\u62c9\u53d6\u6570\u636e\u7b49\uff09\uff0c\u5efa\u8bae\u5c06\u8be5\u53c2\u6570\u8c03\u5927\uff0c\u8be5\u53c2\u6570\u8fc7\u5c0f\u5e38\u51fa\u73b0\u7684\u9519\u8bef\u63d0\u793a\u662f\uff1a\u201cAttemptID:attempt_14267829456721_123456_m_000224_0 Timed out after 300 secsContainer killed by the ApplicationMaster.\u201d\u3002"},{"location":"hadoop/hdp_21/#44-hadoop","title":"4.4 Hadoop\u5c0f\u6587\u4ef6\u4f18\u5316\u65b9\u6cd5","text":""},{"location":"hadoop/hdp_21/#441-hadoop","title":"4.4.1 Hadoop\u5c0f\u6587\u4ef6\u5f0a\u7aef","text":"<p>HDFS \u4e0a\u6bcf\u4e2a\u6587\u4ef6\u90fd\u8981\u5728 NameNode \u4e0a\u521b\u5efa\u5bf9\u5e94\u7684\u5143\u6570\u636e\uff0c\u8fd9\u4e2a\u5143\u6570\u636e\u7684\u5927\u5c0f\u7ea6\u4e3a 150byte\uff0c\u8fd9\u6837\u5f53\u5c0f\u6587\u4ef6\u6bd4\u8f83\u591a\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4ea7\u751f\u5f88\u591a\u7684\u5143\u6570\u636e\u6587\u4ef6\uff0c\u4e00\u65b9\u9762\u4f1a\u5927\u91cf\u5360\u7528 NameNode \u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u53e6\u4e00\u65b9\u9762\u5c31\u662f\u5143\u6570\u636e\u6587\u4ef6\u8fc7\u591a\uff0c\u4f7f\u5f97\u5bfb\u5740\u7d22\u5f15\u901f\u5ea6\u53d8\u6162\u3002</p> <p>\u5c0f\u6587\u4ef6\u8fc7\u591a\uff0c\u5728\u8fdb\u884c MR \u8ba1\u7b97\u65f6\uff0c\u4f1a\u751f\u6210\u8fc7\u591a\u5207\u7247\uff0c\u9700\u8981\u542f\u52a8\u8fc7\u591a\u7684 MapTask\u3002\u6bcf\u4e2a MapTask \u5904\u7406\u7684\u6570\u636e\u91cf\u5c0f\uff0c\u5bfc\u81f4 MapTask \u7684\u5904\u7406\u65f6\u95f4\u6bd4\u542f\u52a8\u65f6\u95f4\u8fd8\u5c0f\uff0c\u767d\u767d\u6d88\u8017\u8d44\u6e90\u3002</p>"},{"location":"hadoop/hdp_21/#442hadoop","title":"4.4.2Hadoop\u5c0f\u6587\u4ef6\u89e3\u51b3\u65b9\u6848","text":"<p>1\uff09\u5c0f\u6587\u4ef6\u4f18\u5316\u7684\u65b9\u5411\uff1a</p> <p>\uff081\uff09\u5728\u6570\u636e\u91c7\u96c6\u7684\u65f6\u5019\uff0c\u5c31\u5c06\u5c0f\u6587\u4ef6\u6216\u5c0f\u6279\u6570\u636e\u5408\u6210\u5927\u6587\u4ef6\u518d\u4e0a\u4f20 HDFS\u3002</p> <p>\uff082\uff09\u5728\u4e1a\u52a1\u5904\u7406\u4e4b\u524d\uff0c\u5728 HDFS \u4e0a\u4f7f\u7528 MapReduce \u7a0b\u5e8f\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u3002</p> <p>\uff083\uff09\u5728 MapReduce \u5904\u7406\u65f6\uff0c\u53ef\u91c7\u7528 CombineTextInputFormat \u63d0\u9ad8\u6548\u7387\u3002</p> <p>\uff084\uff09\u5f00\u542f uber \u6a21\u5f0f\uff0c\u5b9e\u73b0 jvm \u91cd\u7528</p> <p>2\uff09Hadoop Archive</p> <p>\u662f\u4e00\u4e2a\u9ad8\u6548\u7684\u5c06\u5c0f\u6587\u4ef6\u653e\u5165 HDFS \u5757\u4e2d\u7684\u6587\u4ef6\u5b58\u6863\u5de5\u5177\uff0c\u80fd\u591f\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u6253\u5305\u6210\u4e00\u4e2a HAR \u6587\u4ef6\uff0c\u4ece\u800c\u8fbe\u5230\u51cf\u5c11 NameNode \u7684\u5185\u5b58\u4f7f\u7528</p> <p>3\uff09CombineTextInputFormat</p> <p>CombineTextInputFormat \u7528\u4e8e\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u5728\u5207\u7247\u8fc7\u7a0b\u4e2d\u751f\u6210\u4e00\u4e2a\u5355\u72ec\u7684\u5207\u7247\u6216\u8005\u5c11\u91cf\u7684\u5207\u7247\u3002 </p> <p>4\uff09\u5f00\u542f uber \u6a21\u5f0f\uff0c\u5b9e\u73b0 JVM \u91cd\u7528\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a Task \u4efb\u52a1\u90fd\u9700\u8981\u542f\u52a8\u4e00\u4e2a JVM \u6765\u8fd0\u884c\uff0c\u5982\u679c Task \u4efb\u52a1\u8ba1\u7b97\u7684\u6570\u636e\u91cf\u5f88\u5c0f\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u540c\u4e00\u4e2a Job \u7684\u591a\u4e2a Task \u8fd0\u884c\u5728\u4e00\u4e2a JVM \u4e2d\uff0c\u4e0d\u5fc5\u4e3a\u6bcf\u4e2a Task \u90fd\u5f00\u542f\u4e00\u4e2a JVM. </p> <p>\u5f00\u542f uber \u6a21\u5f0f\uff0c\u5728 mapred-site.xml \u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e</p> mapred-site.xml<pre><code>&lt;!--  \u5f00\u542fuber\u6a21\u5f0f --&gt;\n&lt;property&gt;\n&lt;name&gt;mapreduce.job.ubertask.enable&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- uber\u6a21\u5f0f\u4e2d\u6700\u5927\u7684mapTask\u6570\u91cf\uff0c\u53ef\u5411\u4e0b\u4fee\u6539  --&gt; &lt;property&gt;\n&lt;name&gt;mapreduce.job.ubertask.maxmaps&lt;/name&gt;\n&lt;value&gt;9&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- uber\u6a21\u5f0f\u4e2d\u6700\u5927\u7684reduce\u6570\u91cf\uff0c\u53ef\u5411\u4e0b\u4fee\u6539 --&gt;\n&lt;property&gt;\n&lt;name&gt;mapreduce.job.ubertask.maxreduces&lt;/name&gt;\n&lt;value&gt;1&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- uber\u6a21\u5f0f\u4e2d\u6700\u5927\u7684\u8f93\u5165\u6570\u636e\u91cf\uff0c\u9ed8\u8ba4\u4f7f\u7528dfs.blocksize \u7684\u503c\uff0c\u53ef\u5411\u4e0b\u4fee\u6539 --&gt;\n&lt;property&gt;\n&lt;name&gt;mapreduce.job.ubertask.maxbytes&lt;/name&gt;\n&lt;value&gt;&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"hadoop/hdp_22/","title":"\u7b2c5\u7ae0 Hadoop\u6269\u5c55\uff08\u65b0\u7279\u6027\uff09","text":""},{"location":"hadoop/hdp_22/#51","title":"5.1 \u96c6\u7fa4\u95f4\u6570\u636e\u62f7\u8d1d","text":"<p>1\uff09scp \u5b9e\u73b0\u4e24\u4e2a\u8fdc\u7a0b\u4e3b\u673a\u4e4b\u95f4\u7684\u6587\u4ef6\u590d\u5236</p> <pre><code>    scp -r hello.txt root@hadoop103:/user/atguigu/hello.txt     // \u63a8 push\n    scp -r root@hadoop103:/user/atguigu/hello.txt  hello.txt        // \u62c9 pull\n    scp -r root@hadoop103:/user/atguigu/hello.txt root@hadoop104:/user/atguigu   //\u662f\u901a\u8fc7\u672c\u5730\u4e3b\u673a\u4e2d\u8f6c\u5b9e\u73b0\u4e24\u4e2a\u8fdc\u7a0b\u4e3b\u673a\u7684\u6587\u4ef6\u590d\u5236\uff1b\u5982\u679c\u5728\u4e24\u4e2a\u8fdc\u7a0b\u4e3b\u673a\u4e4b\u95f4ssh\u6ca1\u6709\u914d\u7f6e\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\u8be5\u65b9\u5f0f\u3002\n</code></pre> <p>2\uff09\u91c7\u7528 distcp \u547d\u4ee4\u5b9e\u73b0\u4e24\u4e2a Hadoop \u96c6\u7fa4\u4e4b\u95f4\u7684\u9012\u5f52\u6570\u636e\u590d\u5236</p> <pre><code>bin/hadoop distcp hdfs://hadoop102:8020/user/atguigu/hello.txt hdfs://hadoop105:8020/user/atguigu/hello.txt\n</code></pre>"},{"location":"hadoop/hdp_22/#52","title":"5.2 \u5c0f\u6587\u4ef6\u5b58\u6863","text":"<p>1\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\uff081\uff09\u9700\u8981\u542f\u52a8YARN\u8fdb\u7a0b</p> <pre><code>start-yarn.sh\n</code></pre> <p>\uff082\uff09\u5f52\u6863\u6587\u4ef6</p> <p>\u628a /user/atguigu/input \u76ee\u5f55\u91cc\u9762\u7684\u6240\u6709\u6587\u4ef6\u5f52\u6863\u6210\u4e00\u4e2a\u53eb input.har \u7684\u5f52\u6863\u6587\u4ef6\uff0c\u5e76\u628a\u5f52\u6863\u540e\u6587\u4ef6\u5b58\u50a8\u5230 /user/atguigu/output \u8def\u5f84\u4e0b\u3002</p> <pre><code>hadoop archive -archiveName input.har -p  /user/atguigu/input   /user/atguigu/output\n</code></pre> <p>\uff083\uff09\u67e5\u770b\u5f52\u6863</p> <pre><code>hadoop fs -ls har:///user/atguigu/output/input.har\n</code></pre> <p>\uff084\uff09\u89e3\u5f52\u6863\u6587\u4ef6</p> <pre><code>hadoop fs -cp har:///user/atguigu/output/input.har/*    /user/atguigu\n</code></pre>"},{"location":"hadoop/hdp_22/#53","title":"5.3 \u56de\u6536\u7ad9","text":"<p>\u5f00\u542f\u56de\u6536\u7ad9\u529f\u80fd\uff0c\u53ef\u4ee5\u5c06\u5220\u9664\u7684\u6587\u4ef6\u5728\u4e0d\u8d85\u65f6\u7684\u60c5\u51b5\u4e0b\uff0c\u6062\u590d\u539f\u6570\u636e\uff0c\u8d77\u5230\u9632\u6b62\u8bef\u5220\u9664\u3001\u5907\u4efd\u7b49\u4f5c\u7528\u3002</p> <p>1\uff09\u56de\u6536\u7ad9\u53c2\u6570\u8bbe\u7f6e\u53ca\u5de5\u4f5c\u673a\u5236</p> <p></p> <p>2\uff09\u542f\u7528\u56de\u6536\u7ad9</p> <p>\u4fee\u6539 core-site.xml\uff0c\u914d\u7f6e\u5783\u573e\u56de\u6536\u65f6\u95f4\u4e3a 1 \u5206\u949f\u3002</p> core-site.xml<pre><code>&lt;property&gt;\n&lt;name&gt;fs.trash.interval&lt;/name&gt;\n&lt;value&gt;1&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;fs.trash.checkpoint.interval&lt;/name&gt;\n&lt;value&gt;1&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>3\uff09\u67e5\u770b\u56de\u6536\u7ad9</p> <p>\u56de\u6536\u7ad9\u76ee\u5f55\u5728 hdfs \u96c6\u7fa4\u4e2d\u7684\u8def\u5f84\uff1a/user/atguigu/.Trash/\u2026.</p> <p>4\uff09\u901a\u8fc7\u7a0b\u5e8f\u5220\u9664\u7684\u6587\u4ef6\u4e0d\u4f1a\u7ecf\u8fc7\u56de\u6536\u7ad9\uff0c\u9700\u8981\u8c03\u7528 moveToTrash() \u624d\u8fdb\u5165\u56de\u6536\u7ad9</p> <pre><code>//\u56e0\u4e3a\u672c\u5730\u7684\u5ba2\u6237\u7aef\u62ff\u4e0d\u5230\u96c6\u7fa4\u7684\u914d\u7f6e\u4fe1\u606f \u6240\u4ee5\u9700\u8981\u81ea\u5df1\u624b\u52a8\u8bbe\u7f6e\u4e00\u4e0b\u56de\u6536\u7ad9\nconf.set(\u201cfs.trash.interval\u201d,\u201d1\u201d);\nconf.set(\u201cfs.trash.checkpoint.interval\u201d,\u201d1\u201d);\n//\u521b\u5efa\u4e00\u4e2a\u56de\u6536\u7ad9\u5bf9\u8c61\nTrash trash = New Trash(conf);\ntrash.moveToTrash(path);\n</code></pre> <p>5\uff09\u901a\u8fc7\u7f51\u9875\u4e0a\u76f4\u63a5\u5220\u9664\u7684\u6587\u4ef6\u4e5f\u4e0d\u4f1a\u8d70\u56de\u6536\u7ad9\u3002</p> <p>6\uff09\u53ea\u6709\u5728\u547d\u4ee4\u884c\u5229\u7528 <code>hadoop fs -rm</code> \u547d\u4ee4\u5220\u9664\u7684\u6587\u4ef6\u624d\u4f1a\u8d70\u56de\u6536\u7ad9\u3002</p> <pre><code>hadoop fs -rm -r /user/atguigu/input\n\n2020-07-14 16:13:42,643 INFO fs.TrashPolicyDefault: Moved: 'hdfs://hadoop102:8020/user/atguigu/input' to trash at: hdfs://hadoop102:8020/user/atguigu/.Trash/Current/user/atguigu/input\n</code></pre> <p>7\uff09\u6062\u590d\u56de\u6536\u7ad9\u6570\u636e</p> <pre><code>hadoop fs -mv\n/user/atguigu/.Trash/Current/user/atguigu/input    /user/atguigu/input\n</code></pre>"},{"location":"hadoop/hdp_23/","title":"\u7b2c1\u7ae0 Hadoop HA\u9ad8\u53ef\u7528","text":""},{"location":"hadoop/hdp_23/#11-ha","title":"1.1 HA\u6982\u8ff0","text":"<p>\uff081\uff09\u6240\u8c13 HA\uff08 High Availablity \uff09\uff0c\u5373\u9ad8\u53ef\u7528\uff08 7 * 24 \u5c0f\u65f6\u4e0d\u4e2d\u65ad\u670d\u52a1\uff09\u3002</p> <p>\uff082\uff09\u5b9e\u73b0\u9ad8\u53ef\u7528\u6700\u5173\u952e\u7684\u7b56\u7565\u662f\u6d88\u9664\u5355\u70b9\u6545\u969c\u3002HA \u4e25\u683c\u6765\u8bf4\u5e94\u8be5\u5206\u6210\u5404\u4e2a\u7ec4\u4ef6\u7684 HA \u673a\u5236\uff1aHDFS \u7684 HA \u548c YARN \u7684 HA\u3002</p> <p>\uff083\uff09NameNode \u4e3b\u8981\u5728\u4ee5\u4e0b\u4e24\u4e2a\u65b9\u9762\u5f71\u54cd HDFS \u96c6\u7fa4</p> <ul> <li> <p>NameNode \u673a\u5668\u53d1\u751f\u610f\u5916\uff0c\u5982\u5b95\u673a\uff0c\u96c6\u7fa4\u5c06\u65e0\u6cd5\u4f7f\u7528\uff0c\u76f4\u5230\u7ba1\u7406\u5458\u91cd\u542f\u3002</p> </li> <li> <p>NameNode \u673a\u5668\u9700\u8981\u5347\u7ea7\uff0c\u5305\u62ec\u8f6f\u4ef6\u3001\u786c\u4ef6\u5347\u7ea7\uff0c\u6b64\u65f6\u96c6\u7fa4\u4e5f\u5c06\u65e0\u6cd5\u4f7f\u7528\u3002</p> </li> </ul> <p>HDFS HA \u529f\u80fd\u901a\u8fc7\u914d\u7f6e\u591a\u4e2a NameNodes ( Active / Standby )\u5b9e\u73b0\u5728\u96c6\u7fa4\u4e2d\u5bf9 NameNode \u7684\u70ed\u5907\u6765\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002\u5982\u679c\u51fa\u73b0\u6545\u969c\uff0c\u5982\u673a\u5668\u5d29\u6e83\u6216\u673a\u5668\u9700\u8981\u5347\u7ea7\u7ef4\u62a4\uff0c\u8fd9\u65f6\u53ef\u901a\u8fc7\u6b64\u79cd\u65b9\u5f0f\u5c06 NameNode \u5f88\u5feb\u7684\u5207\u6362\u5230\u53e6\u5916\u4e00\u53f0\u673a\u5668\u3002</p> <p>## 1.2 HDFS-HA\u96c6\u7fa4\u642d\u5efa</p> <p>\u5f53\u524d HDFS \u96c6\u7fa4\u7684\u89c4\u5212</p> hadoop102 hadoop103 hadoop104 NameNode Secondarynamenode DataNode DataNode DataNode <p>HA \u7684\u4e3b\u8981\u76ee\u7684\u662f\u6d88\u9664 NameNode \u7684\u5355\u70b9\u6545\u969c,\u9700\u8981\u5c06 HDFS \u96c6\u7fa4\u89c4\u5212\u6210\u4ee5\u4e0b\u6a21\u6837</p> hadoop102 hadoop103 hadoop104 NameNode NameNode NameNode DataNode DataNode DataNode"},{"location":"hadoop/hdp_23/#121-hdfs-ha","title":"1.2.1 HDFS-HA\u6838\u5fc3\u95ee\u9898","text":"<p>1\uff09\u600e\u4e48\u4fdd\u8bc1\u4e09\u53f0 NameNode \u7684\u6570\u636e\u4e00\u81f4</p> <p>\uff081\uff09Fsimage\uff1a\u8ba9\u4e00\u53f0 nn \u751f\u6210\u6570\u636e\uff0c\u8ba9\u5176\u4ed6\u673a\u5668 nn \u540c\u6b65\u3002</p> <p>\uff082\uff09Edits\uff1a\u9700\u8981\u5f15\u8fdb\u65b0\u7684\u6a21\u5757 JournalNode \u6765\u4fdd\u8bc1 edtis \u7684\u6587\u4ef6\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002</p> <p>2\uff09\u600e\u4e48\u8ba9\u540c\u65f6\u53ea\u6709\u4e00\u53f0 nn \u662f active\uff0c\u5176\u4ed6\u6240\u6709\u662f standby \u7684</p> <p>\uff081\uff09\u624b\u52a8\u5206\u914d</p> <p>\uff082\uff09\u81ea\u52a8\u5206\u914d</p> <p>3\uff092nn \u5728 ha \u67b6\u6784\u4e2d\u5e76\u4e0d\u5b58\u5728\uff0c\u5b9a\u671f\u5408\u5e76 fsimage \u548c edtis \u7684\u6d3b\u8c01\u6765\u5e72</p> <p>\u7531 standby \u7684 nn \u6765\u5e72\u3002</p> <p>4\uff09\u5982\u679c nn \u771f\u7684\u53d1\u751f\u4e86\u95ee\u9898\uff0c\u600e\u4e48\u8ba9\u5176\u4ed6\u7684 nn \u4e0a\u4f4d\u5e72\u6d3b</p> <p>\uff081\uff09\u624b\u52a8\u6545\u969c\u8f6c\u79fb</p> <p>\uff082\uff09\u81ea\u52a8\u6545\u969c\u8f6c\u79fb</p>"},{"location":"hadoop/hdp_23/#13-hdfs-ha","title":"1.3 HDFS-HA\u624b\u52a8\u6a21\u5f0f","text":""},{"location":"hadoop/hdp_23/#131","title":"1.3.1 \u73af\u5883\u51c6\u5907","text":"<p>\uff081\uff09\u4fee\u6539 IP</p> <p>\uff082\uff09\u4fee\u6539\u4e3b\u673a\u540d\u53ca\u4e3b\u673a\u540d\u548c IP \u5730\u5740\u7684\u6620\u5c04</p> <p>\uff083\uff09\u5173\u95ed\u9632\u706b\u5899</p> <p>\uff084\uff09ssh \u514d\u5bc6\u767b\u5f55</p> <p>\uff085\uff09\u5b89\u88c5 JDK\uff0c\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u7b49</p>"},{"location":"hadoop/hdp_23/#132","title":"1.3.2 \u89c4\u5212\u96c6\u7fa4","text":"hadoop102 hadoop103 hadoop104 NameNode NameNode NameNode JournalNode JournalNode JournalNode DataNode DataNode DataNode"},{"location":"hadoop/hdp_23/#133-hdfs-ha","title":"1.3.3 \u914d\u7f6eHDFS-HA\u96c6\u7fa4","text":"<p>1\uff09\u5b98\u65b9\u5730\u5740</p> <p>2\uff09\u5728 opt \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a ha \u6587\u4ef6\u5939</p> <pre><code>cd /opt\nsudo mkdir ha\nsudo chown atguigu:atguigu /opt/ha\n</code></pre> <p>3\uff09\u5c06 /opt/module/ \u4e0b\u7684  hadoop-3.1.3 \u62f7\u8d1d\u5230 /opt/ha \u76ee\u5f55\u4e0b\uff08\u8bb0\u5f97\u5220\u9664 data \u548c log \u76ee\u5f55\uff09</p> <pre><code>cp -r /opt/module/hadoop-3.1.3 /opt/ha/\n</code></pre> <p>4\uff09\u914d\u7f6e core-site.xml</p> core-site.xml<pre><code>&lt;configuration&gt;\n&lt;!-- \u628a\u591a\u4e2aNameNode\u7684\u5730\u5740\u7ec4\u88c5\u6210\u4e00\u4e2a\u96c6\u7fa4mycluster --&gt;\n&lt;property&gt;\n&lt;name&gt;fs.defaultFS&lt;/name&gt;\n&lt;value&gt;hdfs://mycluster&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9ahadoop\u8fd0\u884c\u65f6\u4ea7\u751f\u6587\u4ef6\u7684\u5b58\u50a8\u76ee\u5f55 --&gt;\n&lt;property&gt;\n&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;\n&lt;value&gt;/opt/ha/hadoop-3.1.3/data&lt;/value&gt;\n&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>5\uff09\u914d\u7f6e hdfs-site.xml</p> hdfs-site.xml<pre><code>&lt;configuration&gt;\n\n&lt;!-- NameNode\u6570\u636e\u5b58\u50a8\u76ee\u5f55 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;\n&lt;value&gt;file://${hadoop.tmp.dir}/name&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- DataNode\u6570\u636e\u5b58\u50a8\u76ee\u5f55 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;\n&lt;value&gt;file://${hadoop.tmp.dir}/data&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- JournalNode\u6570\u636e\u5b58\u50a8\u76ee\u5f55 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt;\n&lt;value&gt;${hadoop.tmp.dir}/jn&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u5b8c\u5168\u5206\u5e03\u5f0f\u96c6\u7fa4\u540d\u79f0 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.nameservices&lt;/name&gt;\n&lt;value&gt;mycluster&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u96c6\u7fa4\u4e2dNameNode\u8282\u70b9\u90fd\u6709\u54ea\u4e9b --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.ha.namenodes.mycluster&lt;/name&gt;\n&lt;value&gt;nn1,nn2,nn3&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- NameNode\u7684RPC\u901a\u4fe1\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.rpc-address.mycluster.nn1&lt;/name&gt;\n&lt;value&gt;hadoop102:8020&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.rpc-address.mycluster.nn2&lt;/name&gt;\n&lt;value&gt;hadoop103:8020&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.rpc-address.mycluster.nn3&lt;/name&gt;\n&lt;value&gt;hadoop104:8020&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- NameNode\u7684http\u901a\u4fe1\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.http-address.mycluster.nn1&lt;/name&gt;\n&lt;value&gt;hadoop102:9870&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.http-address.mycluster.nn2&lt;/name&gt;\n&lt;value&gt;hadoop103:9870&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.http-address.mycluster.nn3&lt;/name&gt;\n&lt;value&gt;hadoop104:9870&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9aNameNode\u5143\u6570\u636e\u5728JournalNode\u4e0a\u7684\u5b58\u653e\u4f4d\u7f6e --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;\n&lt;value&gt;qjournal://hadoop102:8485;hadoop103:8485;hadoop104:8485/mycluster&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u8bbf\u95ee\u4ee3\u7406\u7c7b\uff1aclient\u7528\u4e8e\u786e\u5b9a\u54ea\u4e2aNameNode\u4e3aActive --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.client.failover.proxy.provider.mycluster&lt;/name&gt;\n&lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u914d\u7f6e\u9694\u79bb\u673a\u5236\uff0c\u5373\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u53f0\u670d\u52a1\u5668\u5bf9\u5916\u54cd\u5e94 --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;\n&lt;value&gt;sshfence&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u4f7f\u7528\u9694\u79bb\u673a\u5236\u65f6\u9700\u8981ssh\u79d8\u94a5\u767b\u5f55--&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;\n&lt;value&gt;/home/atguigu/.ssh/id_rsa&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre> <p>6\uff09\u5206\u53d1\u914d\u7f6e\u597d\u7684 hadoop \u73af\u5883\u5230\u5176\u4ed6\u8282\u70b9</p>"},{"location":"hadoop/hdp_23/#134-hdfs-ha","title":"1.3.4 \u542f\u52a8HDFS-HA\u96c6\u7fa4","text":"<p>1\uff09\u5c06 HADOOP_HOME \u73af\u5883\u53d8\u91cf\u66f4\u6539\u5230 HA \u76ee\u5f55(\u4e09\u53f0\u673a\u5668)</p> my_env.sh<pre><code>#HADOOP_HOME\nexport HADOOP_HOME=/opt/ha/hadoop-3.1.3\nexport PATH=$PATH:$HADOOP_HOME/bin\nexport PATH=$PATH:$HADOOP_HOME/sbin\n</code></pre> <p>2\uff09\u5728\u5404\u4e2a JournalNode \u8282\u70b9\u4e0a\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 journalnode \u670d\u52a1</p> <pre><code>hdfs --daemon start journalnode\n</code></pre> <p>3\uff09\u5728 [nn1] \u4e0a\uff0c\u5bf9\u5176\u8fdb\u884c\u683c\u5f0f\u5316\uff0c\u5e76\u542f\u52a8</p> <pre><code>hdfs namenode -format\nhdfs --daemon start namenode\n</code></pre> <p>4\uff09\u5728 [nn2] \u548c [nn3] \u4e0a\uff0c\u540c\u6b65 nn1 \u7684\u5143\u6570\u636e\u4fe1\u606f</p> <pre><code>hdfs namenode -bootstrapStandby\n</code></pre> <p>5\uff09\u542f\u52a8 [nn2] \u548c [nn3]</p> <pre><code>hdfs --daemon start namenode\n</code></pre> <p>6\uff09\u67e5\u770b web \u9875\u9762\u663e\u793a </p> <p></p> <p></p> <p></p> <p>7\uff09\u5728\u6240\u6709\u8282\u70b9\u4e0a\uff0c\u542f\u52a8 datanode</p> <pre><code>hdfs --daemon start datanode\n</code></pre> <p>8\uff09\u5c06 [nn1] \u5207\u6362\u4e3a Active</p> <pre><code>hdfs haadmin -transitionToActive nn1\n</code></pre> <p>9\uff09\u67e5\u770b\u662f\u5426 Active</p> <pre><code>hdfs haadmin -getServiceState nn1\n</code></pre>"},{"location":"hadoop/hdp_23/#14-hdfs-ha","title":"1.4 HDFS-HA \u81ea\u52a8\u6a21\u5f0f","text":""},{"location":"hadoop/hdp_23/#141-hdfs-ha","title":"1.4.1 HDFS-HA\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u5de5\u4f5c\u673a\u5236","text":"<p>\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u4e3a HDFS \u90e8\u7f72\u589e\u52a0\u4e86\u4e24\u4e2a\u65b0\u7ec4\u4ef6\uff1aZooKeeper \u548c ZKFailoverController\uff08ZKFC\uff09\u8fdb\u7a0b\uff0c\u5982\u56fe\u6240\u793a\u3002ZooKeeper \u662f\u7ef4\u62a4\u5c11\u91cf\u534f\u8c03\u6570\u636e\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u8fd9\u4e9b\u6570\u636e\u7684\u6539\u53d8\u548c\u76d1\u89c6\u5ba2\u6237\u7aef\u6545\u969c\u7684\u9ad8\u53ef\u7528\u670d\u52a1\u3002</p> <p></p>"},{"location":"hadoop/hdp_23/#142-hdfs-ha","title":"1.4.2 HDFS-HA\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u7684\u96c6\u7fa4\u89c4\u5212","text":"hadoop102 hadoop103 hadoop104 NameNode NameNode NameNode JournalNode JournalNode JournalNode DataNode DataNode DataNode Zookeeper Zookeeper Zookeeper ZKFC ZKFC ZKFC"},{"location":"hadoop/hdp_23/#143-hdfs-ha","title":"1.4.3 \u914d\u7f6eHDFS-HA\u81ea\u52a8\u6545\u969c\u8f6c\u79fb","text":"<p>1\uff09\u5177\u4f53\u914d\u7f6e</p> <p>\uff081\uff09\u5728 hdfs-site.xml \u4e2d\u589e\u52a0</p> hdfs-site.xml<pre><code>&lt;!-- \u542f\u7528nn\u6545\u969c\u81ea\u52a8\u8f6c\u79fb --&gt;\n&lt;property&gt;\n&lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff082\uff09\u5728 core-site.xml \u6587\u4ef6\u4e2d\u589e\u52a0</p> core-site.xml<pre><code>&lt;!-- \u6307\u5b9azkfc\u8981\u8fde\u63a5\u7684zkServer\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;\n&lt;value&gt;hadoop102:2181,hadoop103:2181,hadoop104:2181&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\uff083\uff09\u4fee\u6539\u540e\u5206\u53d1\u914d\u7f6e\u6587\u4ef6</p> <pre><code>xsync hadoop/\n</code></pre> <p>2\uff09\u542f\u52a8</p> <p>\uff081\uff09\u5173\u95ed\u6240\u6709 HDFS \u670d\u52a1\uff1a</p> <pre><code>stop-dfs.sh\n</code></pre> <p>\uff082\uff09\u542f\u52a8 Zookeeper \u96c6\u7fa4\uff1a</p> <pre><code>zkServer.sh start\n</code></pre> <p>\uff083\uff09\u542f\u52a8 Zookeeper \u4ee5\u540e\uff0c\u7136\u540e\u518d\u521d\u59cb\u5316 HA \u5728 Zookeeper \u4e2d\u72b6\u6001\uff1a</p> <pre><code>hdfs zkfc -formatZK\n</code></pre> <p>\uff084\uff09\u542f\u52a8 HDFS \u670d\u52a1\uff1a</p> <pre><code>start-dfs.sh\n</code></pre> <p>\uff085\uff09\u53ef\u4ee5\u53bb zkCli.sh \u5ba2\u6237\u7aef\u67e5\u770b Namenode \u9009\u4e3e\u9501\u8282\u70b9\u5185\u5bb9\uff1a</p> <pre><code>get -s /hadoop-ha/mycluster/ActiveStandbyElectorLock\n\n    myclusternn2    hadoop103 \ufffd&gt;(\ufffd&gt;\ncZxid = 0x10000000b\nctime = Tue Jul 14 17:00:13 CST 2020\nmZxid = 0x10000000b\nmtime = Tue Jul 14 17:00:13 CST 2020\npZxid = 0x10000000b\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x40000da2eb70000\ndataLength = 33\nnumChildren = 0\n</code></pre> <p>3\uff09\u9a8c\u8bc1</p> <p>\uff081\uff09\u5c06 Active NameNode \u8fdb\u7a0b kill\uff0c\u67e5\u770b\u7f51\u9875\u7aef\u4e09\u53f0 Namenode \u7684\u72b6\u6001\u53d8\u5316</p> <pre><code>kill -9 namenode\u7684\u8fdb\u7a0bid\n</code></pre>"},{"location":"hadoop/hdp_23/#143-nnjn","title":"1.4.3 \u89e3\u51b3NN\u8fde\u63a5\u4e0d\u4e0aJN\u7684\u95ee\u9898","text":"<p>\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u914d\u7f6e\u597d\u4ee5\u540e\uff0c\u7136\u540e\u4f7f\u7528 start-dfs.sh \u7fa4\u8d77\u811a\u672c\u542f\u52a8 hdfs \u96c6\u7fa4\uff0c\u6709\u53ef\u80fd\u4f1a\u9047\u5230 NameNode \u8d77\u6765\u4e00\u4f1a\u540e\uff0c\u8fdb\u7a0b\u81ea\u52a8\u5173\u95ed\u7684\u95ee\u9898\u3002\u67e5\u770b NameNode \u65e5\u5fd7\uff0c\u62a5\u9519\u4fe1\u606f\u5982\u4e0b\uff1a</p> <pre><code>2020-08-17 10:11:40,658 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: hadoop104/192.168.6.104:8485. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, sleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:40,659 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: hadoop102/192.168.6.102:8485. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, sleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:40,659 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: hadoop103/192.168.6.103:8485. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, sleepTime=1000 MILLISECONDS)\n\n\u2026 \u2026\n\n2020-08-17 10:11:49,669 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: hadoop102/192.168.6.102:8485. Already tried 9 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, sleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:49,673 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: hadoop104/192.168.6.104:8485. Already tried 9 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, sleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:49,676 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: hadoop103/192.168.6.103:8485. Already tried 9 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, sleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:49,678 WARN org.apache.hadoop.hdfs.server.namenode.FSEditLog: Unable to determine input streams from QJM to [192.168.6.102:8485, 192.168.6.103:8485, 192.168.6.104:8485]. Skipping.\norg.apache.hadoop.hdfs.qjournal.client.QuorumException: Got too many exceptions to achieve quorum size 2/3. 3 exceptions thrown:\n192.168.6.103:8485: Call From hadoop102/192.168.6.102 to hadoop103:8485 failed on connection exception: java.net.ConnectException: \u62d2\u7edd\u8fde\u63a5; For more details see:  http://wiki.apache.org/hadoop/ConnectionRefused\n192.168.6.102:8485: Call From hadoop102/192.168.6.102 to hadoop102:8485 failed on connection exception: java.net.ConnectException: \u62d2\u7edd\u8fde\u63a5; For more details see:  http://wiki.apache.org/hadoop/ConnectionRefused\n192.168.6.104:8485: Call From hadoop102/192.168.6.102 to hadoop104:8485 failed on connection exception: java.net.ConnectException: \u62d2\u7edd\u8fde\u63a5; For more details see:  http://wiki.apache.org/hadoop/ConnectionRefused\n</code></pre> <p>\u67e5\u770b\u62a5\u9519\u65e5\u5fd7\uff0c\u53ef\u5206\u6790\u51fa\u62a5\u9519\u539f\u56e0\u662f\u56e0\u4e3a NameNode \u8fde\u63a5\u4e0d\u4e0a JournalNode\uff0c\u800c\u5229\u7528 jps \u547d\u4ee4\u67e5\u770b\u5230\u4e09\u53f0 JN \u90fd\u5df2\u7ecf\u6b63\u5e38\u542f\u52a8\uff0c\u4e3a\u4ec0\u4e48 NN \u8fd8\u662f\u65e0\u6cd5\u6b63\u5e38\u8fde\u63a5\u5230 JN \u5462\uff1f\u8fd9\u662f\u56e0\u4e3a start-dfs.sh \u7fa4\u8d77\u811a\u672c\u9ed8\u8ba4\u7684\u542f\u52a8\u987a\u5e8f\u662f\u5148\u542f\u52a8 NN\uff0c\u518d\u542f\u52a8 DN\uff0c\u7136\u540e\u518d\u542f\u52a8 JN\uff0c\u5e76\u4e14\u9ed8\u8ba4\u7684 rpc \u8fde\u63a5\u53c2\u6570\u662f\u91cd\u8bd5\u6b21\u6570\u4e3a 10\uff0c\u6bcf\u6b21\u91cd\u8bd5\u7684\u95f4\u9694\u662f 1s\uff0c\u4e5f\u5c31\u662f\u8bf4\u542f\u52a8\u5b8c NN \u4ee5\u540e\u7684 10s \u4e2d\u5185\uff0cJN \u8fd8\u542f\u52a8\u4e0d\u8d77\u6765\uff0cNN \u5c31\u4f1a\u62a5\u9519\u4e86\u3002</p> <p>core-default.xml \u91cc\u9762\u6709\u4e24\u4e2a\u53c2\u6570\u5982\u4e0b\uff1a</p> core-site.xml<pre><code>&lt;!-- NN\u8fde\u63a5JN\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba4\u662f10\u6b21 --&gt;\n&lt;property&gt;\n&lt;name&gt;ipc.client.connect.max.retries&lt;/name&gt;\n&lt;value&gt;10&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u91cd\u8bd5\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba41s --&gt;\n&lt;property&gt;\n&lt;name&gt;ipc.client.connect.retry.interval&lt;/name&gt;\n&lt;value&gt;1000&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u9047\u5230\u4e0a\u8ff0\u95ee\u9898\u540e\uff0c\u53ef\u4ee5\u7a0d\u7b49\u7247\u523b\uff0c\u7b49 JN \u6210\u529f\u542f\u52a8\u540e\uff0c\u624b\u52a8\u542f\u52a8\u4e0b\u4e09\u53f0 NN\uff1a</p> <pre><code>hdfs --daemon start namenode\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5728 core-site.xml \u91cc\u9762\u9002\u5f53\u8c03\u5927\u4e0a\u9762\u7684\u4e24\u4e2a\u53c2\u6570\uff1a</p> core-site.xml<pre><code>&lt;!-- NN\u8fde\u63a5JN\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba4\u662f10\u6b21 --&gt;\n&lt;property&gt;\n&lt;name&gt;ipc.client.connect.max.retries&lt;/name&gt;\n&lt;value&gt;20&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u91cd\u8bd5\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba41s --&gt;\n&lt;property&gt;\n&lt;name&gt;ipc.client.connect.retry.interval&lt;/name&gt;\n&lt;value&gt;5000&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"hadoop/hdp_23/#15-yarn-ha","title":"1.5 YARN-HA\u914d\u7f6e","text":""},{"location":"hadoop/hdp_23/#151-yarn-ha","title":"1.5.1 YARN-HA\u5de5\u4f5c\u673a\u5236","text":"<p>1\uff09\u5b98\u65b9\u6587\u6863</p> <p>2\uff09YARN-HA \u5de5\u4f5c\u673a\u5236</p> <p></p>"},{"location":"hadoop/hdp_23/#152-yarn-ha","title":"1.5.2 \u914d\u7f6eYARN-HA\u96c6\u7fa4","text":"<p>1\uff09\u73af\u5883\u51c6\u5907</p> <p>\uff081\uff09\u4fee\u6539 IP</p> <p>\uff082\uff09\u4fee\u6539\u4e3b\u673a\u540d\u53ca\u4e3b\u673a\u540d\u548c IP \u5730\u5740\u7684\u6620\u5c04</p> <p>\uff083\uff09\u5173\u95ed\u9632\u706b\u5899</p> <p>\uff084\uff09ssh \u514d\u5bc6\u767b\u5f55</p> <p>\uff085\uff09\u5b89\u88c5 JDK\uff0c\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u7b49</p> <p>\uff086\uff09\u914d\u7f6e Zookeeper \u96c6\u7fa4</p> <p>2\uff09\u89c4\u5212\u96c6\u7fa4</p> hadoop102 hadoop103 hadoop104 ResourceManager ResourceManager ResourceManager NodeManager NodeManager NodeManager Zookeeper Zookeeper Zookeeper <p>3\uff09\u6838\u5fc3\u95ee\u9898</p> <p>\uff081\uff09\u5982\u679c\u5f53\u524d active rm \u6302\u4e86\uff0c\u5176\u4ed6 rm \u600e\u4e48\u5c06\u5176\u4ed6 standby rm \u4e0a\u4f4d</p> <p>\u6838\u5fc3\u539f\u7406\u8ddf HDFS \u4e00\u6837\uff0c\u5229\u7528\u4e86 zk \u7684\u4e34\u65f6\u8282\u70b9\u3002</p> <p>\uff082\uff09\u5f53\u524d rm \u4e0a\u6709\u5f88\u591a\u7684\u8ba1\u7b97\u7a0b\u5e8f\u5728\u7b49\u5f85\u8fd0\u884c\uff0c\u5176\u4ed6\u7684 rm \u600e\u4e48\u5c06\u8fd9\u4e9b\u7a0b\u5e8f\u63a5\u624b\u8fc7\u6765\u63a5\u7740\u8dd1</p> <p>rm \u4f1a\u5c06\u5f53\u524d\u7684\u6240\u6709\u8ba1\u7b97\u7a0b\u5e8f\u7684\u72b6\u6001\u5b58\u50a8\u5728 zk \u4e2d\uff0c\u5176\u4ed6 rm \u4e0a\u4f4d\u540e\u4f1a\u53bb\u8bfb\u53d6\uff0c\u7136\u540e\u63a5\u7740\u8dd1\u3002</p> <p>4\uff09\u5177\u4f53\u914d\u7f6e</p> <p>\uff081\uff09yarn-site.xml</p> yarn-site.xml<pre><code>&lt;configuration&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;\n&lt;value&gt;mapreduce_shuffle&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u542f\u7528resourcemanager ha --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u58f0\u660e\u4e24\u53f0resourcemanager\u7684\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt;\n&lt;value&gt;cluster-yarn1&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!--\u6307\u5b9aresourcemanager\u7684\u903b\u8f91\u5217\u8868--&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt;\n&lt;value&gt;rm1,rm2,rm3&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- ========== rm1\u7684\u914d\u7f6e ========== --&gt;\n&lt;!-- \u6307\u5b9arm1\u7684\u4e3b\u673a\u540d --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt;\n&lt;value&gt;hadoop102&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9arm1\u7684web\u7aef\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.webapp.address.rm1&lt;/name&gt;\n&lt;value&gt;hadoop102:8088&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9arm1\u7684\u5185\u90e8\u901a\u4fe1\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.address.rm1&lt;/name&gt;\n&lt;value&gt;hadoop102:8032&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9aAM\u5411rm1\u7533\u8bf7\u8d44\u6e90\u7684\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.scheduler.address.rm1&lt;/name&gt;  &lt;value&gt;hadoop102:8030&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9a\u4f9bNM\u8fde\u63a5\u7684\u5730\u5740 --&gt;  &lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.resource-tracker.address.rm1&lt;/name&gt;\n&lt;value&gt;hadoop102:8031&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- ========== rm2\u7684\u914d\u7f6e ========== --&gt;\n&lt;!-- \u6307\u5b9arm2\u7684\u4e3b\u673a\u540d --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt;\n&lt;value&gt;hadoop103&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.webapp.address.rm2&lt;/name&gt;\n&lt;value&gt;hadoop103:8088&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.address.rm2&lt;/name&gt;\n&lt;value&gt;hadoop103:8032&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.scheduler.address.rm2&lt;/name&gt;\n&lt;value&gt;hadoop103:8030&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.resource-tracker.address.rm2&lt;/name&gt;\n&lt;value&gt;hadoop103:8031&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- ========== rm3\u7684\u914d\u7f6e ========== --&gt;\n&lt;!-- \u6307\u5b9arm1\u7684\u4e3b\u673a\u540d --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.hostname.rm3&lt;/name&gt;\n&lt;value&gt;hadoop104&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u6307\u5b9arm1\u7684web\u7aef\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.webapp.address.rm3&lt;/name&gt;\n&lt;value&gt;hadoop104:8088&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u6307\u5b9arm1\u7684\u5185\u90e8\u901a\u4fe1\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.address.rm3&lt;/name&gt;\n&lt;value&gt;hadoop104:8032&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u6307\u5b9aAM\u5411rm1\u7533\u8bf7\u8d44\u6e90\u7684\u5730\u5740 --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.scheduler.address.rm3&lt;/name&gt;  &lt;value&gt;hadoop104:8030&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9a\u4f9bNM\u8fde\u63a5\u7684\u5730\u5740 --&gt;  &lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.resource-tracker.address.rm3&lt;/name&gt;\n&lt;value&gt;hadoop104:8031&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9azookeeper\u96c6\u7fa4\u7684\u5730\u5740 --&gt; &lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.zk-address&lt;/name&gt;\n&lt;value&gt;hadoop102:2181,hadoop103:2181,hadoop104:2181&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u542f\u7528\u81ea\u52a8\u6062\u590d --&gt; &lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.recovery.enabled&lt;/name&gt;\n&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9aresourcemanager\u7684\u72b6\u6001\u4fe1\u606f\u5b58\u50a8\u5728zookeeper\u96c6\u7fa4 --&gt; &lt;property&gt;\n&lt;name&gt;yarn.resourcemanager.store.class&lt;/name&gt;     &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u73af\u5883\u53d8\u91cf\u7684\u7ee7\u627f --&gt;\n&lt;property&gt;\n&lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;\n&lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre> <p>\uff082\uff09\u540c\u6b65\u66f4\u65b0\u5176\u4ed6\u8282\u70b9\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u5206\u53d1\u914d\u7f6e\u6587\u4ef6</p> <pre><code>xsync hadoop/\n</code></pre> <p>5\uff09\u542f\u52a8 YARN </p> <p>\uff081\uff09\u5728 hadoop102 \u6216\u8005 hadoop103 \u4e2d\u6267\u884c\u3002</p> <pre><code>start-yarn.sh\n</code></pre> <p>\uff082\uff09\u67e5\u770b\u670d\u52a1\u72b6\u6001</p> <pre><code>yarn rmadmin -getServiceState rm1\n</code></pre> <p>\uff083\uff09\u53ef\u4ee5\u53bb zkCli.sh \u5ba2\u6237\u7aef\u67e5\u770b ResourceManager \u9009\u4e3e\u9501\u8282\u70b9\u5185\u5bb9\u3002</p> <pre><code>zkCli.sh\n[zk: localhost:2181(CONNECTED) 16] get -s /yarn-leader-election/cluster-yarn1/ActiveStandbyElectorLock\n\ncluster-yarn1rm1\ncZxid = 0x100000022\nctime = Tue Jul 14 17:06:44 CST 2020\nmZxid = 0x100000022\nmtime = Tue Jul 14 17:06:44 CST 2020\npZxid = 0x100000022\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x30000da33080005\ndataLength = 20\nnumChildren = 0\n</code></pre> <p>\uff084\uff09web \u7aef\u67e5\u770b hadoop102:8088 \u548c hadoop103:8088 \u7684 YARN \u7684\u72b6\u6001</p> <p></p>"},{"location":"hadoop/hdp_23/#16-hadoop-ha","title":"1.6 HADOOP HA\u7684\u6700\u7ec8\u89c4\u5212","text":"<p>\u5c06\u6574\u4e2a ha \u642d\u5efa\u5b8c\u6210\u540e,\u96c6\u7fa4\u5c06\u5f62\u6210\u4ee5\u4e0b\u6a21\u6837</p> hadoop102 hadoop103 hadoop104 NameNode NameNode NameNode JournalNode JournalNode JournalNode DataNode DataNode DataNode Zookeeper Zookeeper Zookeeper ZKFC ZKFC ZKFC ResourceManager ResourceManager ResourceManager NodeManager NodeManager NodeManager"},{"location":"mkdocs/admonitions/","title":"\u63d0\u793a","text":"<p>\u63d0\u793a\uff0c\u4e5f\u53eb\u505a call-outs\uff0c \u662f\u4e00\u79cd\u4e0d\u6253\u65ad\u6587\u672c\u6d41\u5e76\u4e14\u5305\u542b\u9644\u52a0\u5185\u5bb9\u7684\u5f88\u597d\u7684\u9009\u62e9. Material for MkDocs \u63d0\u4f9b\u4e86\u591a\u79cd\u4e0d\u540c\u7684\u63d0\u793a\u7c7b\u578b\u3002</p>"},{"location":"mkdocs/admonitions/#_2","title":"\u914d\u7f6e","text":"<p>\u4e3a\u4e86\u5f00\u542f\u63d0\u793a\uff0c\u8bf7\u628a\u4e0b\u9762\u7684\u4ee3\u7801\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- admonition\n- pymdownx.details\n- pymdownx.superfences\n</code></pre>"},{"location":"mkdocs/admonitions/#_3","title":"\u63d0\u793a\u56fe\u6807","text":"<p>\u6bcf\u79cd\u88ab\u652f\u6301\u7684\u63d0\u793a\u7c7b\u578b\u90fd\u6709\u4e00\u4e2a\u81ea\u5df1\u7684\u56fe\u6807\uff0c\u8fd9\u4e2a\u56fe\u6807\u4e5f\u53ef\u4ee5\u4fee\u6539\u4e3a\u4efb\u4f55\u4e3b\u9898\u81ea\u5e26\u7684\u56fe\u6807 \uff0c\u8bf7\u628a\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>theme:\nicon:\nadmonition:\n&lt;type&gt;: &lt;icon&gt; # (1)!\n</code></pre> <ol> <li> <p>\u8f93\u5165\u51e0\u4e2a\u5173\u952e\u8bcd\u6765\u67e5\u627e\u6700\u5408\u9002\u7684\u56fe\u6807\uff0c\u4f7f\u7528\u6211\u4eec\u7684 [\u56fe\u6807\u641c\u7d22] \uff0c\u70b9\u51fb\u56fe\u6807\u7801\u4ee5\u590d\u5236\u5230\u526a\u8d34\u677f:</p> <p> <ol></ol> </p> </li> </ol> \u5c55\u5f00\u67e5\u770b\u53ef\u9009\u7684\u56fe\u6807\u96c6  Octicons FontAwesome <pre><code>theme:\nicon:\nadmonition:\nnote: octicons/tag-16\nabstract: octicons/checklist-16\ninfo: octicons/info-16\ntip: octicons/squirrel-16\nsuccess: octicons/check-16\nquestion: octicons/question-16\nwarning: octicons/alert-16\nfailure: octicons/x-circle-16\ndanger: octicons/zap-16\nbug: octicons/bug-16\nexample: octicons/beaker-16\nquote: octicons/quote-16\n</code></pre> <pre><code>theme:\nicon:\nadmonition:\nnote: fontawesome/solid/note-sticky\nabstract: fontawesome/solid/book\ninfo: fontawesome/solid/circle-info\ntip: fontawesome/solid/bullhorn\nsuccess: fontawesome/solid/check\nquestion: fontawesome/solid/circle-question\nwarning: fontawesome/solid/triangle-exclamation\nfailure: fontawesome/solid/bomb\ndanger: fontawesome/solid/skull\nbug: fontawesome/solid/robot\nexample: fontawesome/solid/flask\nquote: fontawesome/solid/quote-left\n</code></pre>"},{"location":"mkdocs/admonitions/#_4","title":"\u4f7f\u7528\u65b9\u6cd5","text":"<p>\u63d0\u793a\u9075\u5faa\u4e00\u4e2a\u7b80\u5355\u7684\u8bed\u6cd5: \u4e00\u4e2a\u5e26\u6709 <code>!!!</code> \u7684\u5757, \u8ddf\u7740\u4e00\u4e2a\u4ee3\u8868\u7c7b\u578b\u7684\u5173\u952e\u8bcd. \u5757\u7684\u5185\u5bb9\u5728\u4e0b\u9762\u9694\u7740\u4e00\u884c,\u7f29\u8fdb\u56db\u4e2a\u7a7a\u683c\uff1a</p> \u63d0\u793a<pre><code>!!! note\n\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> <p>Note</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p>"},{"location":"mkdocs/admonitions/#_5","title":"\u4fee\u6539\u6807\u9898","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6807\u9898\u5c31\u662f\u63d0\u793a\u7c7b\u578b\u7684\u5173\u952e\u8bcd\u3002\u4e0d\u8fc7, \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728\u63d0\u793a\u7c7b\u578b\u540e\u9762\u6dfb\u52a0\u4e00\u4e2a\u88ab\u5f15\u53f7\u5305\u56f4\u7684\u5b57\u7b26\u4e32\u6765\u6539\u53d8:</p> \u5e26\u6709\u81ea\u5b9a\u4e49\u6807\u9898\u7684\u63d0\u793a<pre><code>!!! note \"Phasellus posuere in sem ut cursus\"\n\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> <p>Phasellus posuere in sem ut cursus</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p>"},{"location":"mkdocs/admonitions/#_6","title":"\u79fb\u9664\u6807\u9898","text":"<p>\u548c\u6539\u53d8\u6807\u9898\u7c7b\u4f3c, \u56fe\u6807\u548c\u6807\u9898\u53ef\u4ee5\u88ab\u5b8c\u5168\u9690\u85cf\u901a\u8fc7 \u5728\u63d0\u793a\u7c7b\u578b\u540e\u6dfb\u52a0\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32.\u6ce8\u610f\uff0c\u8fd9\u5bf9\u4e8e\u6298\u53e0\u5757\u6765\u8bf4\u4e0d\u751f\u6548:</p> \u6ca1\u6709\u6807\u9898\u7684\u63d0\u793a<pre><code>!!! note \"\"\n\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p>"},{"location":"mkdocs/admonitions/#_7","title":"\u53ef\u6298\u53e0\u5757","text":"<p>\u5f53\u4e00\u4e2a\u5757\u662f\u4ee5 <code>???</code> \u5f00\u59cb\u800c\u4e0d\u662f <code>!!!</code>, \u8fd9\u4e2a\u5757\u4f1a\u88ab\u6e32\u67d3\u4e3a\u53f3\u8fb9\u5e26\u6709\u5c55\u5f00\u6807\u5fd7\u7684\u6298\u53e0\u5757:</p> \u53ef\u6298\u53e0\u7684\u63d0\u793a<pre><code>??? note\n\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> Note <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <p>\u5728 <code>???</code> \u540e\u9762\u6dfb\u52a0\u4e00\u4e2a <code>+</code> \u5219\u4f1a\u6e32\u67d3\u4e00\u4e2a\u9ed8\u8ba4\u5c55\u5f00\u7684\u5757:</p> \u9ed8\u8ba4\u5c55\u5f00\u7684\u6298\u53e0\u5757<pre><code>???+ note\n\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> Note <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p>"},{"location":"mkdocs/admonitions/#_8","title":"\u884c\u5185\u5757","text":"<p>\u63d0\u793a\u4e5f\u53ef\u4ee5\u88ab\u6e32\u67d3\u4e3a\u884c\u5185\u5757 (\u4f8b\u5982\u4fa7\u8fb9\u680f),  \u4f7f\u7528 <code>inline</code> + <code>end</code> \u6807\u8bc6\u7b26\u628a\u5757\u7f6e\u4e8e\u53f3\u8fb9, \u6216\u8005\u53ea\u4f7f\u7528 <code>inline</code> \u6807\u8bc6\u7b26\u628a\u5757\u7f6e\u4e8e\u5de6\u8fb9:</p>  inline end inline <p>Info</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <pre><code>!!! info inline end\n\n    Lorem ipsum dolor sit amet, consectetur\n    adipiscing elit. Nulla et euismod nulla.\n    Curabitur feugiat, tortor non consequat\n    finibus, justo purus auctor massa, nec\n    semper lorem quam in massa.\n</code></pre> <p>\u4f7f\u7528 <code>inline end</code> \u5bf9\u9f50\u5230\u53f3\u8fb9\u3002</p> <p>Info</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <pre><code>!!! info inline\n\n    Lorem ipsum dolor sit amet, consectetur\n    adipiscing elit. Nulla et euismod nulla.\n    Curabitur feugiat, tortor non consequat\n    finibus, justo purus auctor massa, nec\n    semper lorem quam in massa.\n</code></pre> <p>\u4f7f\u7528 <code>inline</code> \u5bf9\u9f50\u5230\u5de6\u8fb9\u3002</p> <p>Important: \u4f7f\u7528 <code>inline</code> \u6807\u8bc6\u7b26\u7684\u63d0\u793a \u5fc5\u987b \u5728\u58f0\u660e\u5728\u4f60\u60f3\u653e\u5728\u4ed6\u4eec\u65c1\u8fb9\u7684\u5185\u5bb9\u5757\u4e4b\u524d\u58f0\u660e\u3002 \u5982\u679c\u6ca1\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u6e32\u67d3\u5728\u5185\u5bb9\u65c1\u8fb9\u7684\u63d0\u793a, \u63d0\u793a\u4f1a\u81a8\u80c0\u5230\u6574\u4e2a\u89c6\u56fe\u5927\u5c0f, \u4f8b\u5982\u79fb\u52a8\u8bbe\u5907\u8bd5\u56fe.</p>"},{"location":"mkdocs/admonitions/#_9","title":"\u53d7\u652f\u6301\u7684\u7c7b\u578b","text":"<p>\u4e0b\u9762\u662f Material for MkDocs \u63d0\u4f9b\u7684\u63d0\u793a\u7c7b\u578b</p> <code>note</code> <p>Note</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>abstract</code> <p>Abstract</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>info</code> <p>Info</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>tip</code> <p>Tip</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>success</code> <p>Success</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>question</code> <p>Question</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>warning</code> <p>Warning</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>failure</code> <p>Failure</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>danger</code> <p>Danger</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>bug</code> <p>Bug</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>example</code> <p>Example</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <code>quote</code> <p>Quote</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p>"},{"location":"mkdocs/buttons/","title":"\u6309\u94ae","text":"<p>Material for MkDocs \u4e3a\u80fd\u591f\u628a\u94fe\u63a5\u8f6c\u5316\u4e3a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6309\u94ae\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6837\u5f0f\uff08<code>label</code> \u6216\u8005 <code>button</code> \u5143\u7d20\uff09. \u8fd9\u5bf9\u6587\u6863\u6216\u8005\u590d\u6742\u9875\u9762\u4e2d\u7684\u4e2d \u8c03\u7528\u52a8\u4f5c \u7279\u522b\u6709\u7528\u3002</p>"},{"location":"mkdocs/buttons/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u628a\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- attr_list\n</code></pre>"},{"location":"mkdocs/buttons/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/buttons/#_4","title":"\u6dfb\u52a0\u6309\u94ae","text":"<p>\u4e3a\u4e86\u628a\u94fe\u63a5\u6e32\u67d3\u4e3a\u6309\u94ae, \u5728\u5b83\u7684\u540e\u7f00\u6dfb\u52a0\u5927\u62ec\u53f7\u5e76\u5728\u5176\u4e2d\u6dfb\u52a0 <code>.md-button</code> \u7c7b\u9009\u62e9\u5668\u3002</p> \u6309\u94ae<pre><code>[Subscribe to our newsletter](#){ .md-button }\n</code></pre> <p>Subscribe to our newsletter</p>"},{"location":"mkdocs/buttons/#_5","title":"\u6dfb\u52a0\u4e00\u7ea7\u6309\u94ae","text":"<p>\u5982\u679c\u60f3\u5c55\u793a\u4e00\u4e2a\u4e00\u7ea7\u88ab\u586b\u5145\u7684\u6309\u94ae, \u540c\u65f6\u6dfb\u52a0 <code>.md-button</code> \u548c <code>.md-button--primary</code> CSS \u7c7b\u9009\u62e9\u5668.</p> \u4e00\u7ea7\u6309\u94ae<pre><code>[Subscribe to our newsletter](#){ .md-button .md-button--primary }\n</code></pre> <p>Subscribe to our newsletter</p>"},{"location":"mkdocs/buttons/#_6","title":"\u6dfb\u52a0\u56fe\u6807\u6309\u94ae","text":"<p>\u5f53\u7136,\u901a\u8fc7\u4f7f\u7528\u56fe\u6807\u8bed\u6cd5\u548c\u56fe\u6807\u7801\u53ef\u4ee5\u5728\u4efb\u4f55\u7c7b\u578b\u7684\u6309\u94ae\u4e0a\u6dfb\u52a0\u56fe\u6807\u3002</p> \u5e26\u56fe\u6807\u6309\u94ae<pre><code>[Send :fontawesome-solid-paper-plane:](#){ .md-button }\n</code></pre> <p>Send </p>"},{"location":"mkdocs/code-blocks/","title":"\u4ee3\u7801\u5757","text":"<p>\u4ee3\u7801\u5757\u548c\u793a\u4f8b\u4ee3\u7801\u5728\u6280\u672f\u9879\u76ee\u6587\u6863\u4e2d\u81f3\u5173\u91cd\u8981\u3002Material for MkDocs \u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u4e3a\u4ee3\u7801\u5757\u5f00\u542f\u8bed\u6cd5\u9ad8\u4eae\u3002</p>"},{"location":"mkdocs/code-blocks/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u628a\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- pymdownx.highlight:\nanchor_linenums: true\n- pymdownx.inlinehilite\n- pymdownx.snippets\n- pymdownx.superfences\n</code></pre>"},{"location":"mkdocs/code-blocks/#_3","title":"\u4ee3\u7801\u590d\u5236\u6309\u94ae","text":"<p>\u4ee3\u7801\u5757\u53ef\u4ee5\u81ea\u52a8\u5728\u53f3\u8fb9\u6e32\u67d3\u4e00\u4e2a\u6309\u94ae\u6765\u5141\u8bb8\u7528\u6237\u590d\u5236\u5757\u4e2d\u7684\u4ee3\u7801\u5230\u526a\u8d34\u677f\u3002\u8bf7\u6dfb\u52a0\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code> \u6765\u5168\u5c40\u5f00\u542f:</p> <pre><code>theme:\nfeatures:\n- content.code.copy\n</code></pre>"},{"location":"mkdocs/code-blocks/#_4","title":"\u4ee3\u7801\u6807\u8bb0","text":"<p>\u4ee3\u7801\u6807\u8bb0\u63d0\u4f9b\u4e86\u4e00\u79cd\u53cb\u597d\u7684\u65b9\u5f0f\u4e3a\u7279\u5b9a\u4ee3\u7801\u5757\u6bb5\u843d\u9644\u52a0\u89e3\u91ca\u5185\u5bb9\uff0c\u901a\u8fc7\u5728\u4ee3\u7801\u5757\u4e2d\u6dfb\u52a0\u4e00\u4e9b\u6807\u8bb0\u548c\u884c\u5185\u8bc4\u8bba.  \u8bf7\u6dfb\u52a0\u4e00\u4e0b\u51e0\u884c\u5230 <code>mkdocs.yml</code> \u6765\u5168\u5c40\u5f00\u542f:</p> <pre><code>theme:\nfeatures:\n- content.code.annotate # (1)!\n</code></pre> <ol> <li> I'm a code annotation! I can contain <code>code</code>, formatted     text, images, ... basically anything that can be written in Markdown.</li> </ol>"},{"location":"mkdocs/code-blocks/#_5","title":"\u951a\u70b9\u94fe\u63a5","text":"<p>\u4e3a\u4e86\u66f4\u7b80\u5355\u7684\u94fe\u63a5\u548c\u5206\u4eab\u4ee3\u7801\u6807\u8bb0, \u6bcf\u4e2a\u4ee3\u7801\u6807\u8bb0\u90fd\u88ab\u6dfb\u52a0\u4e86\u951a\u70b9\u94fe\u63a5, \u4f60\u53ef\u4ee5\u901a\u8fc7\u53f3\u952e\u590d\u5236\u6216\u8005\u5728\u65b0\u6807\u7b7e\u9875\u6253\u5f00:</p> <pre><code># (1)!\n</code></pre> <ol> <li>If you Cmd  me, I'm     rendered open in a new tab. You can also right-click me to copy link     address to share me with others.</li> </ol>"},{"location":"mkdocs/code-blocks/#_6","title":"\u4f7f\u7528","text":"<p>\u4ee3\u7801\u5757\u5fc5\u987b\u88ab\u4e24\u4e2a\u4e09\u5f15\u53f7\u5305\u56f4\uff0c \u4e3a\u8fd9\u4e9b\u4ee3\u7801\u5757\u6dfb\u52a0\u4ee3\u7801\u9ad8\u4eae, \u5728\u5757\u5f00\u5934\u5904\u6dfb\u52a0\u8bed\u8a00\u7801\u3002\u67e5\u770b list of available lexers \u4ee5\u627e\u5230\u5bf9\u5e94\u7684\u8bed\u8a00\u7801:</p> \u4ee3\u7801\u5757<pre><code>``` py\nimport tensorflow as tf\n```\n</code></pre> <pre><code>import tensorflow as tf\n</code></pre>"},{"location":"mkdocs/code-blocks/#_7","title":"\u6dfb\u52a0\u4e00\u4e2a\u6807\u9898","text":"<p>\u4e3a\u4e86\u63d0\u4f9b\u989d\u5916\u7684\u4e0a\u4e0b\u6587\uff0c\u4f7f\u7528 <code>title=\"&lt;custom title&gt;\"</code> \u53ef\u4ee5\u5728\u8bed\u8a00\u7801\u540e\u9762\u76f4\u63a5\u7ed9\u4ee3\u7801\u5757\u6dfb\u52a0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u6807\u9898\uff0c \u4f8b\u5982\u5c55\u793a\u6587\u4ef6\u540d:</p> \u5e26\u6807\u9898\u7684\u4ee3\u7801\u5757<pre><code>``` py title=\"bubble_sort.py\"\ndef bubble_sort(items):\n    for i in range(len(items)):\n        for j in range(len(items) - 1 - i):\n            if items[j] &gt; items[j + 1]:\n                items[j], items[j + 1] = items[j + 1], items[j]\n```\n</code></pre> bubble_sort.py<pre><code>def bubble_sort(items):\n    for i in range(len(items)):\n        for j in range(len(items) - 1 - i):\n            if items[j] &gt; items[j + 1]:\n                items[j], items[j + 1] = items[j + 1], items[j]\n</code></pre>"},{"location":"mkdocs/code-blocks/#_8","title":"\u6dfb\u52a0\u6807\u8bb0","text":"<p>Code annotations can be placed anywhere in a code block where a comment for the language of the block can be placed, e.g. for JavaScript in <code>// ...</code> and <code>/* ... */</code>, for YAML in <code># ...</code>, etc.1:</p> Code block with annotation<pre><code>``` yaml\ntheme:\n  features:\n    - content.code.annotate # (1)\n```\n\n1.  :man_raising_hand: I'm a code annotation! I can contain `code`, __formatted\n    text__, images, ... basically anything that can be written in Markdown.\n</code></pre> <pre><code>theme:\nfeatures:\n- content.code.annotate # (1)\n</code></pre> <ol> <li> I'm a code annotation! I can contain <code>code</code>, formatted     text, images, ... basically anything that can be written in Markdown.</li> </ol>"},{"location":"mkdocs/code-blocks/#_9","title":"\u5220\u9664\u6ce8\u91ca","text":"<p>\u5982\u679c\u4f60\u60f3\u5220\u9664\u56f4\u7ed5\u7740\u4ee3\u7801\u6807\u8bb0\u7684\u6ce8\u91ca\u81ea\u8d1f\uff0c\u53ea\u9700\u8981\u5728\u5b83\u540e\u9762\u52a0\u4e00\u4e2a <code>!</code> :</p> Code block with annotation, stripped<pre><code>``` yaml\n# (1)!\n```\n\n1.  Look ma, less line noise!\n</code></pre> <pre><code># (1)!\n</code></pre> <ol> <li>Look ma, less line noise!</li> </ol> <p>Note that this only allows for a single code annotation to be rendered per comment. If you want to add multiple code annotations, comments cannot be stripped for technical reasons.</p>"},{"location":"mkdocs/code-blocks/#_10","title":"\u6dfb\u52a0\u884c\u53f7","text":"<p>\u53ef\u4ee5\u5728\u8bed\u8a00\u7801\u540e\u4f7f\u7528 <code>linenums=\"&lt;start&gt;\"</code> \u9009\u9879\uff0c<code>&lt;start&gt;</code> \u4ee3\u8868\u8d77\u59cb\u884c\u53f7\u3002 \u4e00\u4e2a\u4ee3\u7801\u5757\u53ef\u4ee5\u4f7f\u7528 <code>1</code> \u4ee5\u5916\u7684\u8d77\u59cb\u884c\u53f7\uff0c\u8fd9\u901a\u5e38\u88ab\u7528\u6765\u5207\u5206\u5927\u4ee3\u7801\u5757\u4ee5\u589e\u52a0\u53ef\u8bfb\u6027:</p> \u5e26\u884c\u53f7\u4ee3\u7801\u5757<pre><code>``` py linenums=\"1\"\ndef bubble_sort(items):\n    for i in range(len(items)):\n        for j in range(len(items) - 1 - i):\n            if items[j] &gt; items[j + 1]:\n                items[j], items[j + 1] = items[j + 1], items[j]\n```\n</code></pre> <pre><code>def bubble_sort(items):\n    for i in range(len(items)):\n        for j in range(len(items) - 1 - i):\n            if items[j] &gt; items[j + 1]:\n                items[j], items[j + 1] = items[j + 1], items[j]\n</code></pre>"},{"location":"mkdocs/code-blocks/#_11","title":"\u9ad8\u4eae\u6307\u5b9a\u884c","text":"<p>Specific lines can be highlighted by passing the line numbers to the <code>hl_lines</code> argument placed right after the language shortcode. Note that line counts start at <code>1</code>, regardless of the starting line number specified a art of <code>linenums</code>:</p> \u5e26\u9ad8\u4eae\u884c\u7684\u4ee3\u7801\u5757<pre><code>``` py hl_lines=\"2 3\"\ndef bubble_sort(items):\n    for i in range(len(items)):\n        for j in range(len(items) - 1 - i):\n            if items[j] &gt; items[j + 1]:\n                items[j], items[j + 1] = items[j + 1], items[j]\n```\n</code></pre> <pre><code>def bubble_sort(items):\nfor i in range(len(items)):\nfor j in range(len(items) - 1 - i):\nif items[j] &gt; items[j + 1]:\n                items[j], items[j + 1] = items[j + 1], items[j]\n</code></pre>"},{"location":"mkdocs/code-blocks/#_12","title":"\u9ad8\u4eae\u884c\u5185\u4ee3\u7801\u5757","text":"<p>\u5f53 InlineHilite \u88ab\u542f\u7528\u65f6\uff0c\u8bed\u6cd5\u9ad8\u4eae\u53ef\u4ee5\u88ab\u5e94\u7528\u5230\u884c\u5185\u4ee3\u7801\u5757\uff0c\u901a\u8fc7\u5728\u524d\u9762\u52a0\u4e0a <code>#!</code> \u548c\u8bed\u8a00\u7801:</p> Inline code block<pre><code>The `#!python range()` function is used to generate a sequence of numbers.\n</code></pre> <p>The <code>range()</code> function is used to generate a sequence of numbers.</p>"},{"location":"mkdocs/code-blocks/#_13","title":"\u5d4c\u5165\u5916\u90e8\u6587\u4ef6","text":"<p>\u5f53 Snippets \u88ab\u542f\u7528\uff0c\u5176\u4ed6\u6587\u4ef6\u7684\u5185\u5bb9\uff08\u5305\u62ec\u6e90\u6587\u4ef6\uff09 \u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 <code>--8&lt;--</code> notation \u5d4c\u5165\u5230\u4e00\u4e2a\u4ee3\u7801\u5757\u4e2d from within a code block:</p> \u5e26\u6709\u5916\u90e8\u6587\u4ef6\u7684\u4ee3\u7801\u5757<pre><code>``` title=\".browserslistrc\"\n.--8&lt;-- \".browserslistrc\"\n```\n</code></pre> hello.txt<pre><code>atguigu atguigu\nss ss\ncls cls\njiao\nbanzhang\nxue\nhadoop\n</code></pre> <ol> <li> <p>Code annotations require syntax highlighting with [Pygments] \u2013 they're currently not compatible with JavaScript syntax highlighters, or languages that do not have comments in their grammar. However, we're actively working on supporting alternate ways of defining code annotations, allowing to always place code annotations at the end of lines.\u00a0\u21a9</p> </li> </ol>"},{"location":"mkdocs/content-tabs/","title":"\u5185\u5bb9\u6807\u7b7e\u9875","text":"<p>\u6709\u65f6\uff0c\u5f88\u9700\u8981\u5728\u4e0d\u540c\u7684\u6807\u7b7e\u9875\u4e0b\u7ec4\u7ec7\u4e0d\u540c\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u5f53\u63cf\u8ff0\u5982\u4f55\u4f7f\u7528\u4e0d\u540c\u7684\u8bed\u8a00\u6216\u73af\u5883\u8bbf\u95ee\u4e00\u4e2a API\uff0cMaterial for MkDocs \u5141\u8bb8\u4f7f\u7528\u6f02\u4eae\u7684\u529f\u80fd\u6027\u6807\u7b7e\u6765\u7ec4\u7ec7\u4ee3\u7801\u5757\u6216\u5176\u4ed6\u5185\u5bb9\u3002 </p>"},{"location":"mkdocs/content-tabs/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u5c06\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- pymdownx.superfences\n- pymdownx.tabbed:\nalternate_style: true </code></pre>"},{"location":"mkdocs/content-tabs/#_3","title":"\u8fde\u63a5\u5185\u5bb9\u6807\u7b7e\u9875","text":"<p>\u5f53\u542f\u7528\u65f6\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u4e00\u4e2a\u6807\u7b7e\u9875\u65f6\uff0c\u6574\u4e2a\u6587\u6863\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u6807\u7b7e\u9875\u90fd\u4f1a\u88ab\u94fe\u63a5\u548c\u5207\u6362\u5230\u540c\u4e00\u4e2a\u6807\u7b7e\u3002\u6dfb\u52a0\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code>:</p> <pre><code>theme:\nfeatures:\n- content.tabs.link\n</code></pre> <p>\u5185\u5bb9\u6807\u7b7e\u9875\u6839\u636e\u5b83\u4eec\u7684\u6807\u7b7e\u88ab\u94fe\u63a5\uff0c\u800c\u4e0d\u662f\u504f\u79fb\u91cf\u3002\u8fd9\u610f\u5473\u7740\u6240\u6709\u7684\u5e26\u6709\u76f8\u540c\u6807\u7b7e\u7684\u6807\u7b7e\u9875\u5f53\u7528\u6237\u70b9\u51fb\u4e00\u4e2a\u5185\u5bb9\u6807\u7b7e\u9875\u65f6\u4f1a\u88ab\u6fc0\u6d3b\uff0c\u65e0\u8bba\u5b83\u4eec\u5728\u5757\u4e2d\u7684\u987a\u5e8f\u3002\u800c\u4e14\u8fd9\u4e2a\u7279\u6027\u5b8c\u5168\u548c [instant loading] \u96c6\u6210\u5e76\u4e14\u5728\u6574\u4e2a\u9875\u9762\u52a0\u8f7d\u65f6\u751f\u6548\u3002</p> Feature enabledFeature disabled <p></p> <p></p>"},{"location":"mkdocs/content-tabs/#_4","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/content-tabs/#_5","title":"\u5206\u7ec4\u4ee3\u7801\u5757","text":"<p>\u4ee3\u7801\u5757\u662f\u88ab\u5206\u7ec4\u7684\u9996\u8981\u76ee\u6807\u4e4b\u4e00\uff0c\u53ef\u4ee5\u88ab\u8ba4\u4e3a\u662f\u5185\u5bb9\u6807\u7b7e\u9875\u7684\u4e00\u4e2a\u7279\u4f8b\uff0c\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u4ee3\u7801\u5757\u7684\u6807\u7b7e\u9875\u603b\u662f\u88ab\u6e32\u67d3\u4e3a\u4e0d\u5e26\u6c34\u5e73\u5206\u5272\u7684\u6837\u5f0f:</p> \u542b\u6709\u4ee3\u7801\u5757\u7684\u5185\u5bb9\u6807\u7b7e\u9875<pre><code>=== \"C\"\n\n    ``` c\n    #include &lt;stdio.h&gt;\n\n    int main(void) {\n      printf(\"Hello world!\\n\");\n      return 0;\n    }\n    ```\n\n=== \"C++\"\n\n    ``` c++\n    #include &lt;iostream&gt;\n\n    int main(void) {\n      std::cout &lt;&lt; \"Hello world!\" &lt;&lt; std::endl;\n      return 0;\n    }\n    ```\n</code></pre> CC++ <pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\nprintf(\"Hello world!\\n\");\nreturn 0;\n}\n</code></pre> <pre><code>#include &lt;iostream&gt;\n\nint main(void) {\nstd::cout &lt;&lt; \"Hello world!\" &lt;&lt; std::endl;\nreturn 0;\n}\n</code></pre>"},{"location":"mkdocs/content-tabs/#_6","title":"\u5206\u7ec4\u5176\u4ed6\u5185\u5bb9","text":"<p>\u5f53\u4e00\u4e2a\u5185\u5bb9\u6807\u7b7e\u9875\u5305\u542b\u4e0d\u6b62\u4e00\u4e2a\u4ee3\u7801\u5757\uff0c\u5b83\u4eec\u4f1a\u88ab\u6e32\u67d3\u6210\u6c34\u5e73\u5206\u5e03\u3002\u5782\u76f4\u5206\u5e03\u6ca1\u6709\u88ab\u6dfb\u52a0\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u5728\u5176\u4ed6\u5757\u4e2d\u5d4c\u5957\u6807\u7b7e\u9875\u5b9e\u73b0:</p> \u5185\u5bb9\u6807\u7b7e\u9875<pre><code>=== \"Unordered list\"\n\n    * Sed sagittis eleifend rutrum\n    * Donec vitae suscipit est\n    * Nulla tempor lobortis orci\n\n=== \"Ordered list\"\n\n    1. Sed sagittis eleifend rutrum\n    2. Donec vitae suscipit est\n    3. Nulla tempor lobortis orci\n</code></pre> Unordered listOrdered list <ul> <li>Sed sagittis eleifend rutrum</li> <li>Donec vitae suscipit est</li> <li>Nulla tempor lobortis orci</li> </ul> <ol> <li>Sed sagittis eleifend rutrum</li> <li>Donec vitae suscipit est</li> <li>Nulla tempor lobortis orci</li> </ol>"},{"location":"mkdocs/content-tabs/#_7","title":"\u5d4c\u5165\u5185\u5bb9","text":"<p>\u5f53 SuperFences \u88ab\u8d77\u7528\u65f6\uff0c\u5185\u5bb9\u6807\u7b7e\u9875\u53ef\u4ee5\u5305\u542b\u5d4c\u5957\u5185\u5bb9\uff0c\u5305\u62ec\u66f4\u6df1\u7684\u5185\u5bb9\u6807\u7b7e\u9875\uff0c\u5e76\u4e14\u4e5f\u53ef\u4ee5\u88ab\u5176\u4ed6\u5757\uff08\u4f8b\u5982\u63d0\u793a\u6216\u5757\u5f15\u7528\uff09\u5d4c\u5957:</p> \u63d0\u793a\u4e2d\u7684\u5185\u5bb9\u6807\u7b7e\u9875<pre><code>!!! example\n\n    === \"Unordered List\"\n\n        ``` markdown\n        * Sed sagittis eleifend rutrum\n        * Donec vitae suscipit est\n        * Nulla tempor lobortis orci\n        ```\n\n    === \"Ordered List\"\n\n        ``` markdown\n        1. Sed sagittis eleifend rutrum\n        2. Donec vitae suscipit est\n        3. Nulla tempor lobortis orci\n        ```\n</code></pre> <p>Example</p> Unordered ListOrdered List <pre><code>* Sed sagittis eleifend rutrum\n* Donec vitae suscipit est\n* Nulla tempor lobortis orci\n</code></pre> <pre><code>1. Sed sagittis eleifend rutrum\n2. Donec vitae suscipit est\n3. Nulla tempor lobortis orci\n</code></pre>"},{"location":"mkdocs/data-tables/","title":"\u6570\u636e\u8868\u683c","text":"<p>Material for MkDocs \u4e3a\u6570\u636e\u8868\u683c\u5b9a\u4e49\u4e86\u9ed8\u8ba4\u98ce\u683c \u2013 \u4e00\u4e2a\u6781\u597d\u7684\u6e32\u67d3\u9879\u76ee\u6587\u6863\u4e2d\u8868\u683c\u5f0f\u6570\u636e\u7684\u65b9\u5f0f\u3002</p>"},{"location":"mkdocs/data-tables/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u6dfb\u52a0\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- tables\n</code></pre>"},{"location":"mkdocs/data-tables/#_3","title":"\u4f7f\u7528","text":"<p>\u6570\u636e\u8868\u683c\u53ef\u4ee5\u5728\u4f60\u7684\u9879\u76ee\u6587\u6863\u4e2d\u7684\u4efb\u4f55\u5730\u65b9\uff0c\u5e76\u4e14\u53ef\u4ee5\u5305\u542b\u5d4c\u5957 Markdown\uff0c\u5305\u62ec\u884c\u5185\u4ee3\u7801\u5757\u548c\u8868\u60c5\u56fe\u6807:</p> \u6570\u636e\u8868\u683c<pre><code>| Method      | Description                          |\n| ----------- | ------------------------------------ |\n| `GET`       | :material-check:     Fetch resource  |\n| `PUT`       | :material-check-all: Update resource |\n| `DELETE`    | :material-close:     Delete resource |\n</code></pre> Method Description <code>GET</code>      Fetch resource <code>PUT</code>  Update resource <code>DELETE</code>      Delete resource"},{"location":"mkdocs/data-tables/#_4","title":"\u5217\u5bf9\u9f50","text":"<p>\u5982\u679c\u4f60\u60f3\u5bf9\u9f50\u7279\u5b9a\u5217\u5230 <code>left</code>, <code>center</code> \u6216 <code>right</code>\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5e38\u89c4\u7684Markdown \u8bed\u6cd5\u2014\u2014\u5728\u5206\u5272\u7ebf\u7684\u5f00\u5934/\u7ed3\u5c3e\u6dfb\u52a0\u4e00\u4e2a <code>:</code> \u5b57\u7b26\u3002</p> LeftCenterRight Data table, columns aligned to left<pre><code>| Method      | Description                          |\n| :---------- | :----------------------------------- |\n| `GET`       | :material-check:     Fetch resource  |\n| `PUT`       | :material-check-all: Update resource |\n| `DELETE`    | :material-close:     Delete resource |\n</code></pre> Method Description <code>GET</code>      Fetch resource <code>PUT</code>  Update resource <code>DELETE</code>      Delete resource Data table, columns centered<pre><code>| Method      | Description                          |\n| :---------: | :----------------------------------: |\n| `GET`       | :material-check:     Fetch resource  |\n| `PUT`       | :material-check-all: Update resource |\n| `DELETE`    | :material-close:     Delete resource |\n</code></pre> Method Description <code>GET</code>      Fetch resource <code>PUT</code>  Update resource <code>DELETE</code>      Delete resource Data table, columns aligned to right<pre><code>| Method      | Description                          |\n| ----------: | -----------------------------------: |\n| `GET`       | :material-check:     Fetch resource  |\n| `PUT`       | :material-check-all: Update resource |\n| `DELETE`    | :material-close:     Delete resource |\n</code></pre> Method Description <code>GET</code>      Fetch resource <code>PUT</code>  Update resource <code>DELETE</code>      Delete resource"},{"location":"mkdocs/diagrams/","title":"\u56fe\u8868","text":"<p>\u56fe\u8868\u6709\u52a9\u4e8e\u8868\u8fbe\u4e0d\u540c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u590d\u6742\u5173\u7cfb\u548c\u8054\u7cfb\uff0c\u5e76\u4e14\u662f\u5bf9\u9879\u76ee\u6587\u6863\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u8865\u5145\u3002Material for MkDocs \u96c6\u6210\u4e86 Mermaid.js\uff0c\u8fd9\u662f\u4e00\u79cd\u975e\u5e38\u6d41\u884c\u4e14\u7075\u6d3b\u7684\u7ed8\u56fe\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"mkdocs/diagrams/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u5c06\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- pymdownx.superfences:\ncustom_fences:\n- name: mermaid\nclass: mermaid\nformat: !!python/name:pymdownx.superfences.fence_code_format\n</code></pre> <p>\u4e0d\u9700\u8981\u8fdb\u4e00\u6b65\u914d\u7f6e\u3002\u76f8\u5bf9\u4e8e\u81ea\u5b9a\u4e49\u96c6\u6210\u6709\u5982\u4e0b\u4f18\u52bf:</p> <ul> <li> \u4f7f\u7528\u5373\u65f6\u52a0\u8f7d\uff0c\u65e0\u9700\u4efb\u4f55\u989d\u5916\u7684\u5de5\u4f5c</li> <li> \u56fe\u8868\u81ea\u52a8\u4f7f\u7528 <code>mkdocs.yml</code>1 \u4e2d\u5b9a\u4e49\u7684\u5b57\u4f53\u548c\u989c\u8272</li> <li> \u540c\u65f6\u652f\u6301\u6d45\u8272\u548c\u6df1\u8272\u914d\u8272\u65b9\u6848\u2014\u2014\u5728\u672c\u9875\u8bd5\u8bd5\u5427!</li> </ul>"},{"location":"mkdocs/diagrams/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/diagrams/#_4","title":"\u4f7f\u7528\u6d41\u7a0b\u56fe","text":"<p>\u6d41\u7a0b\u56fe \u662f\u8868\u793a\u5de5\u4f5c\u6d41\u6216\u6d41\u7a0b\u7684\u56fe\u3002\u6b65\u9aa4\u88ab\u5448\u73b0\u4e3a\u5404\u79cd\u7c7b\u578b\u7684\u8282\u70b9\uff0c\u5e76\u7531\u8fb9\u8fde\u63a5\uff0c\u63cf\u8ff0\u4e86\u6b65\u9aa4\u7684\u5fc5\u8981\u987a\u5e8f:</p> \u6d41\u7a0b\u56fe<pre><code>``` mermaid\ngraph LR\n  A[Start] --&gt; B{Error?};\n  B --&gt;|Yes| C[Hmm...];\n  C --&gt; D[Debug];\n  D --&gt; B;\n  B ----&gt;|No| E[Yay!];\n```\n</code></pre> <pre><code>graph LR\n  A[Start] --&gt; B{Error?};\n  B --&gt;|Yes| C[Hmm...];\n  C --&gt; D[Debug];\n  D --&gt; B;\n  B ----&gt;|No| E[Yay!];</code></pre>"},{"location":"mkdocs/diagrams/#_5","title":"\u4f7f\u7528\u5e8f\u5217\u56fe","text":"<p>\u5e8f\u5217\u56fe \u5c06\u7279\u5b9a\u573a\u666f\u63cf\u8ff0\u4e3a\u591a\u4e2a\u5bf9\u8c61\u6216\u53c2\u4e0e\u8005\u4e4b\u95f4\u7684\u987a\u5e8f\u4ea4\u4e92\uff0c\u5305\u62ec\u5728\u8fd9\u4e9b\u53c2\u4e0e\u8005\u4e4b\u95f4\u4ea4\u6362\u7684\u6d88\u606f:</p> \u5e8f\u5217\u56fe<pre><code>``` mermaid\nsequenceDiagram\n  autonumber\n  Alice-&gt;&gt;John: Hello John, how are you?\n  loop Healthcheck\n      John-&gt;&gt;John: Fight against hypochondria\n  end\n  Note right of John: Rational thoughts!\n  John--&gt;&gt;Alice: Great!\n  John-&gt;&gt;Bob: How about you?\n  Bob--&gt;&gt;John: Jolly good!\n```\n</code></pre> <pre><code>sequenceDiagram\n  autonumber\n  Alice-&gt;&gt;John: Hello John, how are you?\n  loop Healthcheck\n      John-&gt;&gt;John: Fight against hypochondria\n  end\n  Note right of John: Rational thoughts!\n  John--&gt;&gt;Alice: Great!\n  John-&gt;&gt;Bob: How about you?\n  Bob--&gt;&gt;John: Jolly good!</code></pre>"},{"location":"mkdocs/diagrams/#_6","title":"\u4f7f\u7528\u72b6\u6001\u56fe","text":"<p>\u72b6\u6001\u56fe \u662f\u63cf\u8ff0\u7cfb\u7edf\u884c\u4e3a\u3001\u5c06\u5176\u5206\u89e3\u4e3a\u6709\u9650\u6570\u91cf\u7684\u72b6\u6001\u4ee5\u53ca\u8fd9\u4e9b\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\u7684\u7edd\u4f73\u5de5\u5177:</p> \u72b6\u6001\u56fe<pre><code>``` mermaid\nstateDiagram-v2\n  state fork_state &lt;&lt;fork&gt;&gt;\n    [*] --&gt; fork_state\n    fork_state --&gt; State2\n    fork_state --&gt; State3\n\n    state join_state &lt;&lt;join&gt;&gt;\n    State2 --&gt; join_state\n    State3 --&gt; join_state\n    join_state --&gt; State4\n    State4 --&gt; [*]\n```\n</code></pre> <pre><code>stateDiagram-v2\n  state fork_state &lt;&lt;fork&gt;&gt;\n    [*] --&gt; fork_state\n    fork_state --&gt; State2\n    fork_state --&gt; State3\n\n    state join_state &lt;&lt;join&gt;&gt;\n    State2 --&gt; join_state\n    State3 --&gt; join_state\n    join_state --&gt; State4\n    State4 --&gt; [*]</code></pre>"},{"location":"mkdocs/diagrams/#_7","title":"\u4f7f\u7528\u7c7b\u56fe","text":"<p>\u7c7b\u56fe \u662f\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u7684\u6838\u5fc3\uff0c\u901a\u8fc7\u5c06\u5b9e\u4f53\u5efa\u6a21\u4e3a\u7c7b\u53ca\u5176\u4e4b\u95f4\u7684\u5173\u7cfb\u6765\u63cf\u8ff0\u7cfb\u7edf\u7684\u7ed3\u6784:</p> \u7c7b\u56fe<pre><code>``` mermaid\nclassDiagram\n  Person &lt;|-- Student\n  Person &lt;|-- Professor\n  Person : +String name\n  Person : +String phoneNumber\n  Person : +String emailAddress\n  Person: +purchaseParkingPass()\n  Address \"1\" &lt;-- \"0..1\" Person:lives at\n  class Student{\n    +int studentNumber\n    +int averageMark\n    +isEligibleToEnrol()\n    +getSeminarsTaken()\n  }\n  class Professor{\n    +int salary\n  }\n  class Address{\n    +String street\n    +String city\n    +String state\n    +int postalCode\n    +String country\n    -validate()\n    +outputAsLabel()  \n  }\n```\n</code></pre> <pre><code>classDiagram\n  Person &lt;|-- Student\n  Person &lt;|-- Professor\n  Person : +String name\n  Person : +String phoneNumber\n  Person : +String emailAddress\n  Person: +purchaseParkingPass()\n  Address \"1\" &lt;-- \"0..1\" Person:lives at\n  class Student{\n    +int studentNumber\n    +int averageMark\n    +isEligibleToEnrol()\n    +getSeminarsTaken()\n  }\n  class Professor{\n    +int salary\n  }\n  class Address{\n    +String street\n    +String city\n    +String state\n    +int postalCode\n    +String country\n    -validate()\n    +outputAsLabel()  \n  }</code></pre>"},{"location":"mkdocs/diagrams/#er","title":"\u4f7f\u7528 ER \u56fe","text":"<p>ER\u56fe \u7531\u5b9e\u4f53\u7c7b\u578b\u7ec4\u6210\uff0c\u5e76\u6307\u5b9a\u5b9e\u4f53\u4e4b\u95f4\u5b58\u5728\u7684\u5173\u7cfb\u3002\u5b83\u63cf\u8ff0\u4e86\u7279\u5b9a\u77e5\u8bc6\u9886\u57df\u4e2d\u76f8\u4e92\u5173\u8054\u7684\u4e8b\u7269:</p> ER\u56fe<pre><code>``` mermaid\nerDiagram\n  CUSTOMER ||--o{ ORDER : places\n  ORDER ||--|{ LINE-ITEM : contains\n  CUSTOMER }|..|{ DELIVERY-ADDRESS : uses\n```\n</code></pre> <pre><code>erDiagram\n  CUSTOMER ||--o{ ORDER : places\n  ORDER ||--|{ LINE-ITEM : contains\n  CUSTOMER }|..|{ DELIVERY-ADDRESS : uses</code></pre>"},{"location":"mkdocs/diagrams/#_8","title":"\u5176\u4ed6\u56fe\u8868\u7c7b\u578b","text":"<p>\u9664\u4e86\u4e0a\u9762\u5217\u51fa\u7684\u56fe\u8868\u7c7b\u578b\u4e4b\u5916, Mermaid.js \u5bf9 pie charts, gantt charts, user journeys, git graphs and requirement diagrams \u63d0\u4f9b\u4e86\u652f\u6301\uff0c\u8fd9\u4e5f\u6ca1\u6709\u88ab Material for MkDocs \u5b98\u65b9\u652f\u6301\u3002\u8fd9\u4e9b\u56fe\u5e94\u8be5\u4ecd\u7136\u53ef\u4ee5\u50cf Mermaid.js \u6240\u5ba3\u4f20\u7684\u90a3\u6837\u5de5\u4f5c\uff0c\u4f46\u6211\u4eec\u8ba4\u4e3a\u5b83\u4eec\u4e0d\u662f\u4e00\u4e2a\u597d\u7684\u9009\u62e9\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5b83\u4eec\u5728\u79fb\u52a8\u8bbe\u5907\u4e0a\u5de5\u4f5c\u4e0d\u597d\u3002</p> <ol> <li> <p>\u867d\u7136\u6240\u6709\u7684 Mermaid.js \u7279\u6027\u90fd\u662f\u5f00\u7bb1\u5373\u7528\u7684\uff0c\u4f46\u662f Material for MkDocs \u76ee\u524d\u53ea\u4f1a\u8c03\u6574\u6d41\u7a0b\u56fe\u3001\u5e8f\u5217\u56fe\u3001\u7c7b\u56fe\u3001\u72b6\u6001\u56fe\u548c\u5b9e\u4f53\u5173\u7cfb\u56fe\u7684\u5b57\u4f53\u548c\u989c\u8272\u3002\u8bf7\u53c2\u9605\u5176\u4ed6\u56fe\u8868\u7c7b\u578b\u90e8\u5206\uff0c\u4e86\u89e3\u4e3a\u4ec0\u4e48\u76ee\u524d\u6ca1\u6709\u4e3a\u6240\u6709\u56fe\u8868\u5b9e\u73b0\u6b64\u529f\u80fd\u7684\u66f4\u591a\u4fe1\u606f\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"mkdocs/footnotes/","title":"\u89d2\u6ce8","text":"<p>\u811a\u6ce8\u662f\u4e3a\u7279\u5b9a\u7684\u5355\u8bcd\u3001\u77ed\u8bed\u6216\u53e5\u5b50\u6dfb\u52a0\u8865\u5145\u6216\u989d\u5916\u4fe1\u606f\u7684\u597d\u65b9\u6cd5\uff0c\u800c\u4e0d\u4f1a\u6253\u65ad\u6587\u6863\u7684\u6d41\u7a0b\u3002Material for MkDocs \u63d0\u4f9b\u4e86\u5b9a\u4e49\u3001\u5f15\u7528\u548c\u6e32\u67d3\u811a\u6ce8\u7684\u80fd\u529b\u3002</p>"},{"location":"mkdocs/footnotes/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u5c06\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- footnotes\n</code></pre>"},{"location":"mkdocs/footnotes/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/footnotes/#_4","title":"\u6dfb\u52a0\u89d2\u6ce8\u5f15\u7528","text":"<p>\u811a\u6ce8\u5f15\u7528\u5fc5\u987b\u62ec\u5728\u65b9\u62ec\u53f7\u4e2d\uff0c\u5e76\u4e14\u5fc5\u987b\u4ee5\u7b26\u53f7 <code>^</code> \u5f00\u5934\uff0c\u540e\u9762\u76f4\u63a5\u8ddf\u4e00\u4e2a\u4efb\u610f\u6807\u8bc6\u7b26\uff0c\u8fd9\u7c7b\u4f3c\u4e8e\u6807\u51c6 Markdown \u94fe\u63a5\u8bed\u6cd5\u3002</p> Text with footnote references<pre><code>Lorem ipsum[^1] dolor sit amet, consectetur adipiscing elit.[^2]\n</code></pre> <p>Lorem ipsum1 dolor sit amet, consectetur adipiscing elit.2</p>"},{"location":"mkdocs/footnotes/#_5","title":"\u6dfb\u52a0\u89d2\u6ce8\u5185\u5bb9","text":"<p>\u811a\u6ce8\u5185\u5bb9\u5fc5\u987b\u58f0\u660e\u4e3a\u4e0e\u5f15\u7528\u76f8\u540c\u7684\u6807\u8bc6\u7b26\u3002\u5b83\u53ef\u4ee5\u88ab\u63d2\u5165\u5230\u6587\u6863\u4e2d\u7684\u4efb\u610f\u4f4d\u7f6e\uff0c\u5e76\u4e14\u603b\u662f\u5448\u73b0\u5728\u9875\u9762\u7684\u5e95\u90e8\u3002\u6b64\u5916\uff0c\u8fd8\u4f1a\u81ea\u52a8\u6dfb\u52a0\u5230\u811a\u6ce8\u5f15\u7528\u7684\u53cd\u5411\u94fe\u63a5\u3002</p>"},{"location":"mkdocs/footnotes/#_6","title":"\u5728\u4e00\u884c\u4e0a","text":"<p>\u77ed\u811a\u6ce8\u53ef\u4ee5\u5199\u5728\u540c\u4e00\u884c\u4e0a:</p> Footnote<pre><code>[^1]: Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n</code></pre> <p> Jump to footnote</p>"},{"location":"mkdocs/footnotes/#_7","title":"\u5728\u591a\u884c\u4e0a","text":"<p>\u6bb5\u843d\u53ef\u4ee5\u5199\u5728\u4e0b\u4e00\u884c\uff0c\u5e76\u4e14\u5fc5\u987b\u7f29\u8fdb\u56db\u4e2a\u7a7a\u683c:</p> Footnote<pre><code>[^2]:\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> <p> Jump to footnote</p> <ol> <li> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.\u00a0\u21a9</p> </li> <li> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.\u00a0\u21a9</p> </li> </ol>"},{"location":"mkdocs/formatting/","title":"\u683c\u5f0f","text":"<p>Material for MkDocs \u63d0\u4f9b\u4e86\u5bf9\u51e0\u79cd HTML \u5143\u7d20\u7684\u652f\u6301\uff0c\u8fd9\u4e9b\u5143\u7d20\u53ef\u7528\u4e8e\u7a81\u51fa\u663e\u793a\u6587\u6863\u7684\u90e8\u5206\u6216\u5e94\u7528\u7279\u5b9a\u7684\u683c\u5f0f\u3002</p>"},{"location":"mkdocs/formatting/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u5c06\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- pymdownx.critic\n- pymdownx.caret\n- pymdownx.keys\n- pymdownx.mark\n- pymdownx.tilde\n</code></pre>"},{"location":"mkdocs/formatting/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/formatting/#_4","title":"\u9ad8\u4eae\u6539\u53d8","text":"<p>\u542f\u7528 Critic \u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 CriticMarkup\uff0c\u8fd9\u589e\u52a0\u4e86\u7a81\u51fa\u663e\u793a\u5efa\u8bae\u66f4\u6539\u4ee5\u53ca\u5411\u6587\u6863\u6dfb\u52a0\u5185\u8054\u6ce8\u91ca\u7684\u80fd\u529b\uff1a</p> Text with suggested changes<pre><code>Text can be deleted and replacement text added. This can also be\ncombined into onea single operation. Highlighting is also\npossible and comments can be added inline.\n\n\n\nFormatting can also be applied to blocks by putting the opening and closing\ntags on separate lines and adding new lines between the tags and the content.\n\n\n</code></pre> <p>Text can be deleted and replacement text added. This can also be combined into onea single operation. Highlighting is also possible and comments can be added inline.</p> <p>       Formatting can also be applied to blocks by putting the opening and       closing tags on separate lines and adding new lines between the tags and       the content.     </p>"},{"location":"mkdocs/formatting/#_5","title":"\u9ad8\u4eae\u6587\u672c","text":"<p>\u542f\u7528 Caret\uff0cMark&amp;Tilde \u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u7b80\u5355\u7684\u8bed\u6cd5\u7a81\u51fa\u663e\u793a\u6587\u672c\uff0c\u8fd9\u6bd4\u76f4\u63a5\u4f7f\u7528\u76f8\u5e94\u7684 <code>mark</code>, <code>ins</code> and <code>del</code> HTML \u6807\u8bb0\u66f4\u65b9\u4fbf:</p> Text with highlighting<pre><code>- ==This was marked==\n- ^^This was inserted^^\n- ~~This was deleted~~\n</code></pre> <ul> <li>This was marked</li> <li>This was inserted</li> <li>This was deleted</li> </ul>"},{"location":"mkdocs/formatting/#_6","title":"\u4e0b\u6807\u548c\u4e0a\u6807","text":"<p>\u5f53\u542f\u7528 Caret&amp;Tilde Caret\uff0cMark&amp;Tilde \u65f6\uff0c\u6587\u672c\u53ef\u4ee5\u7528\u7b80\u5355\u7684\u8bed\u6cd5\u8fdb\u884c\u4e0b\u6807\u548c\u4e0a\u6807\uff0c\u8fd9\u6bd4\u76f4\u63a5\u4f7f\u7528\u76f8\u5e94\u7684 <code>sub</code> and <code>sup</code> HTML \u6807\u8bb0\u66f4\u65b9\u4fbf:</p> Text with sub- und superscripts<pre><code>- H~2~O\n- A^T^A\n</code></pre> <ul> <li>H2O</li> <li>ATA</li> </ul>"},{"location":"mkdocs/formatting/#_7","title":"\u6dfb\u52a0\u952e\u76d8\u952e","text":"<p>\u542f\u7528 Key \u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u7b80\u5355\u8bed\u6cd5\u6e32\u67d3\u952e\u76d8\u952e\u3002\u8bf7\u53c2\u9605 Python Markdown Extensions \u6587\u6863\u4ee5\u4e86\u89e3\u6240\u6709\u53ef\u7528\u7684\u5feb\u6377\u65b9\u5f0f\uff1a</p> Keyboard keys<pre><code>++ctrl+alt+del++\n</code></pre> <p>Ctrl+Alt+Del</p>"},{"location":"mkdocs/grids/","title":"\u7f51\u683c","text":"<p>Material for MkDocs \u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5c06\u6bb5\u843d\u6392\u5217\u5230\u7f51\u683c\u4e2d\uff0c\u5c06\u4f20\u8fbe\u76f8\u4f3c\u542b\u4e49\u6216\u540c\u7b49\u91cd\u8981\u6027\u7684\u5757\u5206\u7ec4\u3002\u7f51\u683c\u975e\u5e38\u9002\u5408\u7528\u4e8e\u6784\u5efa\u7d22\u5f15\u9875\u9762\uff0c\u4ee5\u663e\u793a\u6587\u6863\u4e2d\u8f83\u5927\u90e8\u5206\u7684\u7b80\u8981\u6982\u8ff0\u3002</p>"},{"location":"mkdocs/grids/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u5c06\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions: - attr_list\n- md_in_html\n</code></pre>"},{"location":"mkdocs/grids/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/grids/#_4","title":"\u5217\u8868\u8bed\u6cd5","text":"<p>\u5217\u8868\u8bed\u6cd5\u672c\u8d28\u4e0a\u662f card grids \u7684\u5feb\u6377\u65b9\u5f0f\uff0c\u7531\u4e00\u4e2a\u65e0\u5e8f\uff08\u6216\u6709\u5e8f\uff09\u5217\u8868\u7ec4\u6210\uff0c\u8be5\u5217\u8868\u7531\u4e00\u4e2a\u540c\u65f6\u5305\u542b grid \u548c cards \u7c7b\u7684div\u5305\u88c5\uff1a</p> Card grid<pre><code>&lt;div class=\"grid cards\" markdown&gt;\n\n- :fontawesome-brands-html5: __HTML__ for content and structure\n- :fontawesome-brands-js: __JavaScript__ for interactivity\n- :fontawesome-brands-css3: __CSS__ for text running out of boxes\n- :fontawesome-brands-internet-explorer: __Internet Explorer__ ... huh?\n\n&lt;/div&gt;\n</code></pre> <ul> <li> HTML for content and structure</li> <li> JavaScript for interactivity</li> <li> CSS for text running out of boxes</li> <li> Internet Explorer ... huh?</li> </ul> <p>\u5217\u8868\u5143\u7d20\u53ef\u4ee5\u5305\u542b\u4efb\u610f Markdown\uff0c\u53ea\u8981\u5468\u56f4\u7684 div \u5b9a\u4e49\u4e86 Markdown \u5c5e\u6027\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u66f4\u590d\u6742\u7684\u793a\u4f8b\uff0c\u5176\u4e2d\u5305\u62ec\u56fe\u6807\u548c\u94fe\u63a5\uff1a</p> Card grid, complex example<pre><code>&lt;div class=\"grid cards\" markdown&gt;\n\n-   :material-clock-fast:{ .lg .middle } __Set up in 5 minutes__\n\n    ---\n\n    Install [`mkdocs-material`](#) with [`pip`](#) and get up\n    and running in minutes\n\n    [:octicons-arrow-right-24: Getting started](#)\n\n-   :fontawesome-brands-markdown:{ .lg .middle } __It's just Markdown__\n\n    ---\n\n    Focus on your content and generate a responsive and searchable static site\n\n    [:octicons-arrow-right-24: Reference](#)\n\n-   :material-format-font:{ .lg .middle } __Made to measure__\n\n    ---\n\n    Change the colors, fonts, language, icons, logo and more with a few lines\n\n    [:octicons-arrow-right-24: Customization](#)\n\n-   :material-scale-balance:{ .lg .middle } __Open Source, MIT__\n\n    ---\n\n    Material for MkDocs is licensed under MIT and available on [GitHub]\n\n    [:octicons-arrow-right-24: License](#)\n\n&lt;/div&gt;\n</code></pre> <ul> <li> <p> Set up in 5 minutes</p> <p>Install <code>mkdocs-material</code> with <code>pip</code> and get up and running in minutes</p> <p>[ Getting started][getting started]</p> </li> <li> <p> It's just Markdown</p> <p>Focus on your content and generate a responsive and searchable static site</p> <p> Reference</p> </li> <li> <p> Made to measure</p> <p>Change the colors, fonts, language, icons, logo and more with a few lines</p> <p> Customization</p> </li> <li> <p> Open Source, MIT</p> <p>Material for MkDocs is licensed under MIT and available on GitHub</p> <p> License</p> </li> </ul> <p>\u5982\u679c\u6ca1\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u6765\u6e32\u67d3\u5f7c\u6b64\u76f8\u90bb\u7684\u7f51\u683c\u9879\uff0c\u5219\u8fd9\u4e9b\u9879\u5c06\u5ef6\u4f38\u5230\u89c6\u53e3\u7684\u6574\u4e2a\u5bbd\u5ea6\uff0c\u4f8b\u5982\u5728\u79fb\u52a8\u89c6\u53e3\u4e0a\u3002\u5982\u679c\u6709\u66f4\u591a\u7684\u53ef\u7528\u7a7a\u95f4\uff0c\u7f51\u683c\u5c06\u5448\u73b03\u9879\u6216\u66f4\u591a\u9879\u3002</p>"},{"location":"mkdocs/grids/#_5","title":"\u5757\u8bed\u6cd5","text":"<p>\u5757\u8bed\u6cd5\u5141\u8bb8\u5c06\u5361\u7247\u4e0e\u5176\u4ed6\u5143\u7d20\u4e00\u8d77\u6392\u5217\u5728\u7f51\u683c\u4e2d\u3002\u53ea\u9700\u5c06 card \u7c7b\u6dfb\u52a0\u5230\u7f51\u683c\u4e2d\u7684\u4efb\u4f55\u5757\u5143\u7d20\u4e2d:</p> Card grid, blocks<pre><code>&lt;div class=\"grid\" markdown&gt;\n\n:fontawesome-brands-html5: __HTML__ for content and structure\n{ .card }\n\n:fontawesome-brands-js: __JavaScript__ for interactivity\n{ .card }\n\n:fontawesome-brands-css3: __CSS__ for text running out of boxes\n{ .card }\n\n&gt; :fontawesome-brands-internet-explorer: __Internet Explorer__ ... huh?\n\n&lt;/div&gt;\n</code></pre> <p> HTML for content and structure</p> <p> JavaScript for interactivity</p> <p> CSS for text running out of boxes</p> <p> Internet Explorer ... huh?</p>"},{"location":"mkdocs/icons-emojis/","title":"\u56fe\u6807\uff0c\u8868\u60c5","text":"<p>Material for MkDocs \u6700\u597d\u7684\u7279\u6027\u4e4b\u4e00\u662f\u53ef\u4ee5\u5728\u4f60\u7684\u9879\u76ee\u6587\u6863\u4e2d\u4f7f\u7528\u8d85\u8fc7 10000 \u4e2a\u56fe\u6807\u548c\u6570\u5343\u4e2a\u8868\u60c5\uff0c\u800c\u65e0\u9700\u989d\u5916\u7684\u52aa\u529b\u3002</p>"},{"location":"mkdocs/icons-emojis/#_2","title":"\u641c\u7d22","text":"<p> \u63d0\u793a: \u8f93\u5165\u4e00\u4e9b\u5173\u952e\u8bcd\u6765\u627e\u5230\u8868\u60c5\u548c\u56fe\u6807\uff0c\u70b9\u51fb\u8868\u60c5\u7801\u53ef\u4ee5\u628a\u5b83\u590d\u5236\u5230\u526a\u8d34\u677f\u3002 </p>"},{"location":"mkdocs/icons-emojis/#_3","title":"\u914d\u7f6e","text":"<p>\u8bf7\u5c06\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- attr_list\n- pymdownx.emoji:\nemoji_index: !!python/name:materialx.emoji.twemoji\nemoji_generator: !!python/name:materialx.emoji.to_svg\n</code></pre> <p>Material for MkDocs \u81ea\u5e26\u4e86\u4e0b\u9762\u7684\u56fe\u6807\u96c6:</p> <ul> <li> \u2013 Material Design</li> <li> \u2013 FontAwesome</li> <li> \u2013 Octicons</li> <li> \u2013 Simple Icons</li> </ul>"},{"location":"mkdocs/icons-emojis/#_4","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/icons-emojis/#_5","title":"\u4f7f\u7528\u8868\u60c5","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u4e24\u4e2a <code>:</code>  \u52a0\u4e0a\u4e2d\u95f4\u7684\u8868\u60c5\u7801\u5728 Markdown \u4e2d\u96c6\u6210\u8868\u60c5\u3002 \u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 Twemoji (\u63a8\u8350), \u4f60\u53ef\u4ee5\u5728 Emojipedia \u67e5\u770b\u8868\u60c5\u7801:</p> \u8868\u60c5<pre><code>:smile: \n</code></pre> <p></p>"},{"location":"mkdocs/icons-emojis/#_6","title":"\u4f7f\u7528\u56fe\u6807","text":"<p>\u5f53\u8868\u60c5\u88ab\u542f\u7528\u65f6\uff0c\u56fe\u6807\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7c7b\u4f3c\u4e8e\u8868\u60c5\u7684\u65b9\u5f0f\u4f7f\u7528\uff0c\u901a\u8fc7\u5f15\u7528\u4e00\u4e2a\u4e0e\u4e3b\u9898\u7ed1\u5b9a\u7684\u6709\u6548\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u4f4d\u4e8e <code>.icons</code> \u6587\u4ef6\u5939\uff0c\u5e76\u4e14\u9700\u8981\u7528 <code>-</code> \u66ff\u4ee3 <code>/</code>:</p> \u56fe\u6807<pre><code>:fontawesome-regular-face-laugh-wink:\n</code></pre> <p></p>"},{"location":"mkdocs/images/","title":"\u56fe\u50cf","text":"<p>\u7531\u4e8e\u56fe\u50cf\u662f Markdown \u7684\u4e00\u7b49\u516c\u6c11\u4e5f\u662f\u6838\u5fc3\u8bed\u6cd5\u7684\u4e00\u90e8\u5206\uff0c\u5904\u7406\u5b83\u4eec\u53ef\u80fd\u6bd4\u8f83\u56f0\u96be\u3002 Material for MkDocs \u8ba9\u5904\u7406\u56fe\u50cf\u66f4\u52a0\u8f7b\u677e\uff0c\u901a\u8fc7\u63d0\u4f9b\u4e0d\u540c\u98ce\u683c\u7684\u56fe\u50cf\u6837\u5f0f\u548c\u56fe\u50cf\u90a3\u4e2a\u8bf4\u660e\u3002</p>"},{"location":"mkdocs/images/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u6dfb\u52a0\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code> \u4ee5\u652f\u6301\u5c06\u56fe\u7247\u8f6c\u6362\u4e3a\u6570\u5b57\u5e76\u4e3a\u5927\u56fe\u7247\u5f00\u542f\u61d2\u52a0\u8f7d:</p> <pre><code>markdown_extensions:\n- attr_list\n- md_in_html\n</code></pre>"},{"location":"mkdocs/images/#lightbox","title":"Lightbox","text":"<p>\u5982\u679c\u4f60\u60f3\u4e3a\u4f60\u7684\u6587\u6863\u6dfb\u52a0\u56fe\u50cf\u7f29\u653e\u7684\u529f\u80fd,  [glightbox] \u63d2\u4ef6\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9,\u56e0\u4e3a\u5b83\u548c Material for MkDocs \u96c6\u6210\u5f97\u5f88\u597d\u3002\u4f7f\u7528 <code>pip</code> \u5b89\u88c5\u5b83:</p> <pre><code>pip install mkdocs-glightbox\n</code></pre> <p>\u7136\u540e\uff0c\u628a\u4e0b\u9762\u51e0\u884c\u6dfb\u52a0\u5230 <code>mkdocs.yml</code>:</p> <pre><code>plugins:\n- glightbox\n</code></pre>"},{"location":"mkdocs/images/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/images/#_4","title":"\u56fe\u50cf\u5bf9\u9f50","text":"<p>\u5f53 [Attribute Lists] \u88ab\u542f\u7528\uff0c\u56fe\u50cf\u53ef\u4ee5\u901a\u8fc7 <code>align</code> \u5c5e\u6027\u6dfb\u52a0\u5bf9\u9f50\u65b9\u5411 \uff0c\u4f8b\u5982 <code>align=left</code> \u6216 <code>align=right</code>:</p> LeftRight Image, aligned to left<pre><code>![Image title](https://dummyimage.com/600x400/eee/aaa){ align=left }\n</code></pre> <p></p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> Image, aligned to right<pre><code>![Image title](https://dummyimage.com/600x400/eee/aaa){ align=right }\n</code></pre> <p></p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <p>\u5982\u679c\u6ca1\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u6e32\u67d3\u5728\u5185\u5bb9\u65c1\u8fb9\u7684\u56fe\u50cf, \u56fe\u50cf\u4f1a\u81a8\u80c0\u5230\u6574\u4e2a\u89c6\u56fe\u5927\u5c0f, \u4f8b\u5982\u79fb\u52a8\u8bbe\u5907\u8bd5\u56fe</p> \u4e3a\u4ec0\u4e48\u6ca1\u6709\u5c45\u4e2d\u5bf9\u9f50? <p><code>align</code> \u5c5e\u6027\u4e0d\u5141\u8bb8\u5c45\u4e2d\u5bf9\u9f50\uff0c\u8fd9\u5c31\u662f\u8fd9\u4e2a\u9009\u9879\u4e0d\u88ab Material for MkDocs \u652f\u6301\u7684\u539f\u56e0\u30021 \u76f8\u53cd\uff0c \u56fe\u50cf\u8bf4\u660e\u8bed\u6cd5\u53ef\u4ee5\u4f7f\u7528\uff0c\u56e0\u4e3a\u8bf4\u660e\u662f\u53ef\u9009\u9879\u3002</p>"},{"location":"mkdocs/images/#_5","title":"\u56fe\u50cf\u8bf4\u660e","text":"<p>\u4ee4\u4eba\u5931\u671b\u7684\u662f\uff0cMarkDown \u8bed\u6cd5\u5e76\u4e0d\u539f\u751f\u652f\u6301\u56fe\u50cf\u8bf4\u660e\uff0c\u4f46\u662f\u4f7f\u7528 [Markdown in HTML] \u63d2\u4ef6\u7684 <code>figure</code> \u548c <code>figcaption</code> \u6807\u7b7e\u4f7f\u6dfb\u52a0\u56fe\u50cf\u8bf4\u660e\u53d8\u4e3a\u53ef\u80fd:</p> \u5e26\u8bf4\u660e\u7684\u56fe\u50cf<pre><code>&lt;figure markdown&gt;\n  ![Image title](https://dummyimage.com/600x400/){ width=\"300\" }\n  &lt;figcaption&gt;Image caption&lt;/figcaption&gt;\n&lt;/figure&gt;\n</code></pre> Image caption"},{"location":"mkdocs/images/#_6","title":"\u56fe\u50cf\u61d2\u52a0\u8f7d","text":"<p>\u73b0\u4ee3\u6d4f\u89c8\u5668\u63d0\u4f9b\u5bf9\u61d2\u52a0\u8f7d\u56fe\u50cf\u7684\u539f\u751f\u652f\u6301 lazy-loading \u901a\u8fc7 <code>loading=lazy</code> \u6807\u7b7e\uff0c\u5bf9\u4e8e\u4e0d\u652f\u6301\u61d2\u52a0\u8f7d\u7684\u6d4f\u89c8\u5668\u4f1a\u964d\u7ea7\u4e3a\u76f4\u63a5\u52a0\u8f7d:</p> Image, lazy-loaded<pre><code>![Image title](https://dummyimage.com/600x400/){ loading=lazy }\n</code></pre> <p></p> <ol> <li> <p>\u4f60\u53ef\u80fd\u4e5f\u610f\u8bc6\u5230 <code>align</code> \u6570\u5f62\u5df2\u7ecf\u88ab HTML5 \u5f03\u7528\uff0c\u6240\u4ee5\u4e3a\u4ec0\u4e48\u603b\u662f\u4f7f\u7528\u5b83\u5462? \u5f88\u53ef\u80fd\u7684\u539f\u56e0\u662f \u2013 \u5b83\u4ecd\u7136\u88ab\u5927\u591a\u6570\u7684\u6d4f\u89c8\u5668\u548c\u5ba2\u6237\u7aef\u652f\u6301\uff0c\u5e76\u4e14\u51e0\u4e4e\u4e0d\u53ef\u80fd\u88ab\u5b8c\u5168\u79fb\u9664\uff0c\u56e0\u4e3a\u8bb8\u591a\u66f4\u8001\u7684\u7f51\u7ad9\u4ecd\u7136\u5728\u4f7f\u7528\u3002\u8fd9\u786e\u4fdd\u4e86\u5728 Material for MkDocs \u751f\u6210\u7684\u7f51\u7ad9\u4e4b\u5916\u67e5\u770b\u5e26\u6709\u8fd9\u4e9b\u5c5e\u6027\u7684 Markdown \u6587\u4ef6\u65f6\u5916\u89c2\u4e00\u81f4\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"mkdocs/lists/","title":"\u5217\u8868","text":"<p>Material for MkDocs \u652f\u6301\u51e0\u79cd\u7279\u8272\u7684\u5217\u8868\u4ee5\u6ee1\u8db3\u4e0d\u540c\u573a\u666f\u7684\u5e94\u7528\uff0c\u5305\u62ec \u65e0\u5e8f\u5217\u8868 \u548c \u6709\u5e8f\u5217\u8868\uff0c\u8fd9\u4e24\u79cd\u88ab\u6807\u51c6\u7684 Markdown \u652f\u6301\uff0c\u4e5f\u5305\u62ec \u5b9a\u4e49\u5217\u8868 \u548c \u4efb\u52a1\u5217\u8868\uff0c\u901a\u8fc7\u63d2\u4ef6\u652f\u6301\u3002</p>"},{"location":"mkdocs/lists/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u52a0\u5165\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code> \u4ee5\u652f\u6301\u5b9a\u4e49\u5217\u8868\u548c\u4efb\u52a1\u5217\u8868:</p> <pre><code>markdown_extensions:\n- def_list\n- pymdownx.tasklist:\ncustom_checkbox: true\n</code></pre>"},{"location":"mkdocs/lists/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/lists/#_4","title":"\u4f7f\u7528\u65e0\u5e8f\u5217\u8868","text":"<p>\u65e0\u5e8f\u5217\u8868\u53ef\u4ee5\u901a\u8fc7\u5728\u524d\u7f00\u52a0\u4e0a\u4e00\u4e2a <code>-</code>, <code>*</code> \u6216 <code>+</code> \u5217\u8868\u6807\u8bb0, \u8fd9\u4e9b\u6807\u8bb0\u53ef\u4ee5\u4e92\u76f8\u4ea4\u6362\u3002 \u66f4\u8fdb\u4e00\u6b65\uff0c\u6240\u6709\u7684\u5217\u8868\u53ef\u4ee5\u4e92\u76f8\u5d4c\u5957:</p> List, unordered<pre><code>- Nulla et rhoncus turpis. Mauris ultricies elementum leo. Duis efficitur\n  accumsan nibh eu mattis. Vivamus tempus velit eros, porttitor placerat nibh\n  lacinia sed. Aenean in finibus diam.\n\n    * Duis mollis est eget nibh volutpat, fermentum aliquet dui mollis.\n    * Nam vulputate tincidunt fringilla.\n    * Nullam dignissim ultrices urna non auctor.\n</code></pre> <ul> <li> <p>Nulla et rhoncus turpis. Mauris ultricies elementum leo. Duis efficitur   accumsan nibh eu mattis. Vivamus tempus velit eros, porttitor placerat nibh   lacinia sed. Aenean in finibus diam.</p> <ul> <li>Duis mollis est eget nibh volutpat, fermentum aliquet dui mollis.</li> <li>Nam vulputate tincidunt fringilla.</li> <li>Nullam dignissim ultrices urna non auctor.</li> </ul> </li> </ul>"},{"location":"mkdocs/lists/#_5","title":"\u4f7f\u7528\u6709\u5e8f\u5217\u8868","text":"<p>\u6709\u5e8f\u5217\u8868\u4ee5\u6570\u5b57\u52a0\u4e0a\u540e\u9762\u7684\u70b9(.)\u5f00\u59cb,\u6570\u5b57\u4e0d\u9700\u8981\u662f\u8fde\u7eed\u7684\u5e76\u4e14\u53ef\u4ee5\u90fd\u8bbe\u7f6e\u4e3a <code>1.</code>, \u56e0\u4e3a\u5b83\u4eec\u88ab\u6e32\u67d3\u7684\u65f6\u5019\u4f1a\u91cd\u65b0\u7f16\u53f7:</p> \u6709\u5e8f\u5217\u8868<pre><code>1.  Vivamus id mi enim. Integer id turpis sapien. Ut condimentum lobortis\n    sagittis. Aliquam purus tellus, faucibus eget urna at, iaculis venenatis\n    nulla. Vivamus a pharetra leo.\n\n    1.  Vivamus venenatis porttitor tortor sit amet rutrum. Pellentesque aliquet\n        quam enim, eu volutpat urna rutrum a. Nam vehicula nunc mauris, a\n        ultricies libero efficitur sed.\n\n    2.  Morbi eget dapibus felis. Vivamus venenatis porttitor tortor sit amet\n        rutrum. Pellentesque aliquet quam enim, eu volutpat urna rutrum a.\n\n        1.  Mauris dictum mi lacus\n        2.  Ut sit amet placerat ante\n        3.  Suspendisse ac eros arcu\n</code></pre> <ol> <li> <p>Vivamus id mi enim. Integer id turpis sapien. Ut condimentum lobortis     sagittis. Aliquam purus tellus, faucibus eget urna at, iaculis venenatis     nulla. Vivamus a pharetra leo.</p> <ol> <li> <p>Vivamus venenatis porttitor tortor sit amet rutrum. Pellentesque aliquet     quam enim, eu volutpat urna rutrum a. Nam vehicula nunc mauris, a     ultricies libero efficitur sed.</p> </li> <li> <p>Morbi eget dapibus felis. Vivamus venenatis porttitor tortor sit amet     rutrum. Pellentesque aliquet quam enim, eu volutpat urna rutrum a.</p> <ol> <li>Mauris dictum mi lacus</li> <li>Ut sit amet placerat ante</li> <li>Suspendisse ac eros arcu</li> </ol> </li> </ol> </li> </ol>"},{"location":"mkdocs/lists/#_6","title":"\u4f7f\u7528\u5b9a\u4e49\u5217\u8868","text":"<p>\u5f53\u5b9a\u4e49\u5217\u8868\u88ab\u542f\u7528\uff0c\u952e\u503c\u5bf9\u5217\u8868\uff0c\u4f8b\u5982\u51fd\u6570\u6216\u6a21\u5757\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e00\u79cd\u7b80\u5355\u7684\u8bed\u6cd5\u5217\u4e3e:</p> \u5b9a\u4e49\u5217\u8868<pre><code>`Lorem ipsum dolor sit amet`\n\n:   Sed sagittis eleifend rutrum. Donec vitae suscipit est. Nullam tempus\n    tellus non sem sollicitudin, quis rutrum leo facilisis.\n\n`Cras arcu libero`\n\n:   Aliquam metus eros, pretium sed nulla venenatis, faucibus auctor ex. Proin\n    ut eros sed sapien ullamcorper consequat. Nunc ligula ante.\n\n    Duis mollis est eget nibh volutpat, fermentum aliquet dui mollis.\n    Nam vulputate tincidunt fringilla.\n    Nullam dignissim ultrices urna non auctor.\n</code></pre> <code>Lorem ipsum dolor sit amet</code> <p>Sed sagittis eleifend rutrum. Donec vitae suscipit est. Nullam tempus tellus non sem sollicitudin, quis rutrum leo facilisis.</p> <code>Cras arcu libero</code> <p>Aliquam metus eros, pretium sed nulla venenatis, faucibus auctor ex. Proin ut eros sed sapien ullamcorper consequat. Nunc ligula ante.</p> <p>Duis mollis est eget nibh volutpat, fermentum aliquet dui mollis. Nam vulputate tincidunt fringilla. Nullam dignissim ultrices urna non auctor.</p>"},{"location":"mkdocs/lists/#_7","title":"\u4f7f\u7528\u4efb\u52a1\u5217\u8868","text":"<p>\u5f53\u4efb\u52a1\u5217\u8868\u88ab\u542f\u7528\uff0c\u65e0\u5e8f\u5217\u8868\u4e2d\u7684\u6761\u76ee\u53ef\u4ee5\u52a0\u4e0a <code>[ ]</code> \u524d\u7f00\uff0c\u6765\u6e32\u67d3\u4e00\u4e2a\u672a\u52fe\u9009\u7684\u9009\u9879\u6846\u6216\u8005\u7528 <code>[x]</code> \u6765\u6e32\u67d3\u4e00\u4e2a\u52fe\u9009\u4e86\u7684\u9009\u9879\u6846:</p> Task list<pre><code>- [x] Lorem ipsum dolor sit amet, consectetur adipiscing elit\n- [ ] Vestibulum convallis sit amet nisi a tincidunt\n    * [x] In hac habitasse platea dictumst\n    * [x] In scelerisque nibh non dolor mollis congue sed et metus\n    * [ ] Praesent sed risus massa\n- [ ] Aenean pretium efficitur erat, donec pharetra, ligula non scelerisque\n</code></pre> <ul> <li> Lorem ipsum dolor sit amet, consectetur adipiscing elit</li> <li> Vestibulum convallis sit amet nisi a tincidunt<ul> <li> In hac habitasse platea dictumst</li> <li> In scelerisque nibh non dolor mollis congue sed et metus</li> <li> Praesent sed risus massa</li> </ul> </li> <li> Aenean pretium efficitur erat, donec pharetra, ligula non scelerisque</li> </ul>"},{"location":"mkdocs/mathjax/","title":"MathJax","text":"<p>MathJax \u662f\u4e00\u4e2a\u4f18\u96c5\u7684\u53ef\u7528\u7684\u5728\u6d4f\u89c8\u5668\u4e2d\u5c55\u793a\u6570\u5b66\u7c7b\u5185\u5bb9\u7684\u65b9\u5f0f\uff0c\u4e3a\u5305\u542b\u4e0d\u540c\u7b26\u53f7\u6570\u5b66\u6392\u7248\u6dfb\u52a0\u652f\u6301(\u4f8b\u5982 LaTeX, MathML, AsciiMath)\uff0c\u5e76\u4e14\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u4e0e Material for MkDocs \u96c6\u6210.</p>"},{"location":"mkdocs/mathjax/#_1","title":"\u914d\u7f6e","text":"<p>\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u5e76\u4e14\u6dfb\u52a0\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code>:</p> <code>docs/javascripts/mathjax.js</code> <code>mkdocs.yml</code> <pre><code>window.MathJax = {\ntex: {\ninlineMath: [[\"\\\\(\", \"\\\\)\"]],\ndisplayMath: [[\"\\\\[\", \"\\\\]\"]],\nprocessEscapes: true,\nprocessEnvironments: true\n},\noptions: {\nignoreHtmlClass: \".*|\",\nprocessHtmlClass: \"arithmatex\"\n}\n};\n\ndocument$.subscribe(() =&gt; { // (1)!\nMathJax.typesetPromise()\n})\n</code></pre> <pre><code>markdown_extensions:\n- pymdownx.arithmatex:\ngeneric: true\n\nextra_javascript:\n- javascripts/mathjax.js\n- https://polyfill.io/v3/polyfill.min.js?features=es6\n- https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\n</code></pre>"},{"location":"mkdocs/mathjax/#_2","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/mathjax/#_3","title":"\u4f7f\u7528\u5757\u8bed\u6cd5","text":"<p>\u5757\u5fc5\u987b\u88ab\u5305\u542b\u5728 <code>$$...$$</code> \u6216 <code>\\[...\\]</code> \u4e2d:</p> MathJax, block syntax<pre><code>$$\n\\operatorname{ker} f=\\{g\\in G:f(g)=e_{H}\\}{\\mbox{.}}\n$$\n</code></pre> \\[ \\operatorname{ker} f=\\{g\\in G:f(g)=e_{H}\\}{\\mbox{.}} \\]"},{"location":"mkdocs/mathjax/#_4","title":"\u4f7f\u7528\u884c\u5185\u5757\u8bed\u6cd5","text":"<p>\u884c\u5185\u5757\u5fc5\u987b\u88ab\u5305\u542b\u5728 <code>$...$</code> \u6216 <code>\\(...\\)</code> \u4e2d:</p> MathJax, inline syntax<pre><code>The homomorphism $f$ is injective if and only if its kernel is only the \nsingleton set $e_G$, because otherwise $\\exists a,b\\in G$ with $a\\neq b$ such \nthat $f(a)=f(b)$.\n</code></pre> <p>The homomorphism \\(f\\) is injective if and only if its kernel is only the  singleton set \\(e_G\\), because otherwise \\(\\exists a,b\\in G\\) with \\(a\\neq b\\) such  that \\(f(a)=f(b)\\).</p>"},{"location":"mkdocs/termynal/","title":"Termynal","text":"<p>Termynal \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u5728\u7f51\u9875\u4e2d\u5d4c\u5165\u70ab\u9177\u7684\u52a8\u753b\u7ec8\u7aef\u7684\u524d\u7aef\u5de5\u5177\u3002</p>"},{"location":"mkdocs/termynal/#_1","title":"\u914d\u7f6e","text":"<ol> <li>\u4e0b\u8f7d js \u548c css \u6587\u4ef6\u5230\u672c\u5730</li> </ol> \u6587\u4ef6 \u94fe\u63a5 <code>termynal.css</code> termynal.css <code>custom.css</code> custom.css <code>termynal.js</code> termynal.js <code>custom.js</code> custom.js <ol> <li>\u6dfb\u52a0\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code> <pre><code>extra_css:\n- css/termynal.css\n- css/custom.css\nextra_javascript:\n- js/termynal.js\n- js/custom.js\n</code></pre></li> </ol>"},{"location":"mkdocs/termynal/#_2","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/termynal/#_3","title":"\u8bed\u6cd5","text":"<p>\u4f7f\u7528 Termynal \u65f6\u53ea\u9700\u8981\u5c06\u4ee3\u7801\u5757\u7684\u8bed\u8a00\u7801\u8bbe\u7f6e\u4e3a <code>console</code> ,\u5e76\u4f7f\u7528 \u5305\u542b <code>class=\"termy\"</code> \u7684 <code>&lt;div&gt;</code> \u6807\u7b7e\u5305\u56f4:</p> Termynal<pre><code>&lt;div class=\"termy\"&gt;\n```console\nHello termynal!\n```\n&lt;/div&gt;\n</code></pre> <pre><code>Hello termynal!\n</code></pre>"},{"location":"mkdocs/termynal/#_4","title":"\u547d\u4ee4","text":"<p>\u547d\u4ee4\u52a8\u753b\u9700\u8981\u52a0\u4e0a <code>$</code> \u524d\u7f00\u8fdb\u884c\u6307\u5b9a Termynal<pre><code>&lt;div class=\"termy\"&gt;\n```console\n$ pwd\n/root\n```\n&lt;/div&gt;\n</code></pre></p> <pre><code>$ pwd\n/root\n</code></pre>"},{"location":"mkdocs/termynal/#_5","title":"\u8fdb\u5ea6\u6761","text":"<p>\u8fdb\u5ea6\u6761\u52a8\u753b\u9700\u8981\u4f7f\u7528 <code>---&gt; 100%</code> \u7f6e\u4e8e\u5355\u72ec\u4e00\u884c\u8fdb\u884c\u8868\u793a Termynal<pre><code>&lt;div class=\"termy\"&gt;\n```console\n$ pip install mkdocs\n---&gt; 100%\nRequirement already satisfied!\n```\n&lt;/div&gt;\n</code></pre></p> <pre><code>$ pip install mkdocs\n---&gt; 100%\nRequirement already satisfied!\n</code></pre>"},{"location":"mkdocs/termynal/#_6","title":"\u6ce8\u91ca","text":"<p>\u6ce8\u91ca\u52a8\u753b\u9700\u8981\u52a0\u4e0a <code>//</code> \u524d\u7f00\u8fdb\u884c\u6307\u5b9a</p> Termynal<pre><code>&lt;div class=\"termy\"&gt;\n```console\n# test\n$ ping baidu.com\n```\n&lt;/div&gt;\n</code></pre> <pre><code>// ping test\n$ ping baidu.com\nPING baidu.com (198.18.3.115): 56 data bytes\n64 bytes from 198.18.3.115: icmp_seq=0 ttl=63 time=0.138 ms\n64 bytes from 198.18.3.115: icmp_seq=1 ttl=63 time=0.366 ms\n64 bytes from 198.18.3.115: icmp_seq=2 ttl=63 time=0.468 ms\n64 bytes from 198.18.3.115: icmp_seq=3 ttl=63 time=0.490 ms\n--- baidu.com ping statistics ---\n4 packets transmitted, 4 packets received, 0.0% packet loss\n</code></pre>"},{"location":"mkdocs/tooltips/","title":"\u5de5\u5177\u63d0\u793a","text":"<p>\u6280\u672f\u9879\u76ee\u6587\u6863\u901a\u5e38\u5305\u542b\u8bb8\u591a\u7f29\u5199\uff0c\u8fd9\u4e9b\u7f29\u5199\u9700\u8981\u901a\u5e38\u9700\u8981\u989d\u5916\u7684\u89e3\u91ca\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u9879\u76ee\u7684\u65b0\u7528\u6237\u3002\u56e0\u4e3a\u8fd9\u4e9b\u539f\u56e0\uff0cMaterial for MkDocs \u7ed3\u5408\u4e86 Markdown \u6269\u5c55\u4ee5\u5728\u6574\u4e2a\u9875\u9762\u542f\u7528\u672f\u8bed\u3002</p>"},{"location":"mkdocs/tooltips/#_2","title":"\u914d\u7f6e","text":"<p>\u8bf7\u6dfb\u52a0\u4e0b\u9762\u51e0\u884c\u5230 <code>mkdocs.yml</code>:</p> <pre><code>markdown_extensions:\n- abbr\n- attr_list\n- pymdownx.snippets\n</code></pre>"},{"location":"mkdocs/tooltips/#_3","title":"\u4f7f\u7528","text":""},{"location":"mkdocs/tooltips/#_4","title":"\u6dfb\u52a0\u5de5\u5177\u63d0\u793a","text":"<p>Markdown \u8bed\u6cd5\u5141\u8bb8\u4e3a\u6bcf\u4e00\u4e2a\u94fe\u63a5\u6307\u5b9a\u4e00\u4e2a <code>title</code> \u3002\u4f7f\u7528\u4e0b\u9762\u51e0\u884c\u7ed9\u94fe\u63a5\u6dfb\u52a0\u4e00\u4e2a\u5de5\u5177\u63d0\u793a:</p> \u5e26\u5de5\u5177\u63d0\u793a\u7684\u94fe\u63a5\uff08\u884c\u5185\u8bed\u6cd5\uff09<pre><code>[Hover me](https://example.com \"I'm a tooltip!\")\n</code></pre> <p>Hover me</p> <p>\u5de5\u5177\u63d0\u793a\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5f15\u7528\u6dfb\u52a0:</p> \u5e26\u5de5\u5177\u63d0\u793a\u7684\u94fe\u63a5\uff08\u5f15\u7528\u8bed\u6cd5\uff09<pre><code>[Hover me][example]\n\n  [example]: https://example.com \"I'm a tooltip!\"\n</code></pre> <p>Hover me</p> <p>\u5bf9\u4e8e\u5176\u4ed6\u6240\u6709\u5143\u7d20, \u4e00\u4e2a <code>title</code> \u53ef\u4ee5\u901a\u8fc7 [Attribute Lists] \u63d2\u4ef6\u6dfb\u52a0:</p> \u5e26\u5de5\u5177\u63d0\u793a\u7684\u56fe\u6807<pre><code>:material-information-outline:{ title=\"Important information\" }\n</code></pre> <p></p>"},{"location":"mkdocs/tooltips/#_5","title":"\u6dfb\u52a0\u7f29\u5199","text":"<p>\u7f29\u5199\u53ef\u4ee5\u901a\u8fc7\u4e00\u79cd\u7c7b\u4f3c\u4e8e URL \u548c\u89d2\u6ce8\u7684\u8bed\u6cd5\u5b9a\u4e49\uff0c\u4ee5 <code>*</code> \u5f00\u59cb\u5e76\u4e14\u540e\u9762\u7d27\u8ddf\u7740\u7d27\u63a5\u65b9\u62ec\u53f7\u5185\u7684\u672f\u8bed\u6216\u7f29\u7565\u8bed:</p> \u5e26\u7f29\u5199\u7684\u6587\u672c<pre><code>The HTML specification is maintained by the W3C.\n\n*[HTML]: Hyper Text Markup Language\n*[W3C]: World Wide Web Consortium\n</code></pre> <p>The HTML specification is maintained by the W3C.</p>"},{"location":"mkdocs/tooltips/#_6","title":"\u6dfb\u52a0\u672f\u8bed\u8868","text":"<p>Snippets \u63d2\u4ef6\u53ef\u4ee5\u901a\u8fc7\u628a\u6240\u6709\u7684\u7f29\u5199\u79fb\u52a8\u5230\u4e00\u4e2a\u7279\u5b9a\u7684\u6587\u4ef6 1\uff0c\u5e76\u4e14\u4f7f\u7528 auto-append \u5c06\u8fd9\u4e2a\u6587\u4ef6\u6dfb\u52a0\u5230\u6240\u6709\u9875\u9762:</p> <code>includes/abbreviations.md</code> <code>mkdocs.yml</code> <pre><code>*[HTML]: Hyper Text Markup Language\n*[W3C]: World Wide Web Consortium\n</code></pre> <pre><code>markdown_extensions:\n- pymdownx.snippets:\nauto_append:\n- includes/abbreviations.md\n</code></pre> <ol> <li> <p>\u5f3a\u70c8\u5efa\u8bae\u5c06\u5305\u542b\u7f29\u5199\u7684 Markdown \u6587\u4ef6\u653e\u5728 docs \u6587\u4ef6\u5939\u4e4b\u5916(\u8fd9\u91cc\u4f7f\u7528\u4e86\u4e00\u4e2a\u540d\u4e3a includes \u7684\u6587\u4ef6\u5939)\uff0c\u5426\u5219 MkDocs \u53ef\u80fd\u4f1a\u51fa\u73b0\u672a\u5f15\u7528\u7684\u6587\u4ef6\u7684\u8b66\u544a\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"mq/kafka/kf_01/","title":"\u7b2c1\u7ae0 Kafka\u6982\u8ff0","text":""},{"location":"mq/kafka/kf_01/#11","title":"1.1 \u5b9a\u4e49","text":"Kafka \u7684\u5b9a\u4e49"},{"location":"mq/kafka/kf_01/#12","title":"1.2 \u6d88\u606f\u961f\u5217","text":"<p>\u76ee\u524d\u4f01\u4e1a\u4e2d\u6bd4\u8f83\u5e38\u89c1\u7684\u6d88\u606f\u961f\u5217\u4ea7\u54c1\u4e3b\u8981\u6709 Kafka\u3001ActiveMQ\u3001RabbitMQ\u3001RocketMQ \u7b49\u3002</p> <p>\u5728\u5927\u6570\u636e\u573a\u666f\u4e3b\u8981\u91c7\u7528 Kafka \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u3002\u5728 JavaEE \u5f00\u53d1\u4e2d\u4e3b\u8981\u91c7\u7528 ActiveMQ\u3001RabbitMQ\u3001RocketMQ\u3002</p>"},{"location":"mq/kafka/kf_01/#121","title":"1.2.1 \u4f20\u7edf\u6d88\u606f\u961f\u5217\u7684\u5e94\u7528\u573a\u666f","text":"<p>\u4f20\u7edf\u7684\u6d88\u606f\u961f\u5217\u7684\u4e3b\u8981\u5e94\u7528\u573a\u666f\u5305\u62ec\uff1a\u7f13\u5b58/\u6d88\u5cf0\u3001\u89e3\u8026\u548c\u5f02\u6b65\u901a\u4fe1\u3002</p> <p> </p> \u6d88\u5cf0 <p> </p> \u89e3\u8026 <p> </p> \u5f02\u6b65\u901a\u4fe1"},{"location":"mq/kafka/kf_01/#122","title":"1.2.2 \u6d88\u606f\u961f\u5217\u7684\u4e24\u79cd\u6a21\u5f0f","text":""},{"location":"mq/kafka/kf_01/#13-kafka","title":"1.3 Kafka\u57fa\u7840\u67b6\u6784","text":"<p>\uff081\uff09Producer\uff1a\u6d88\u606f\u751f\u4ea7\u8005\uff0c\u5c31\u662f\u5411 Kafka broker \u53d1\u6d88\u606f\u7684\u5ba2\u6237\u7aef\u3002</p> <p>\uff082\uff09Consumer\uff1a\u6d88\u606f\u6d88\u8d39\u8005\uff0c\u4ece Kafka broker \u53d6\u6d88\u606f\u7684\u5ba2\u6237\u7aef\u3002</p> <p>\uff083\uff09Consumer Group\uff08CG\uff09\uff1a\u6d88\u8d39\u8005\u7ec4\uff0c\u7531\u591a\u4e2a Consumer \u7ec4\u6210\u3002\u6d88\u8d39\u8005\u7ec4\u5185\u6bcf\u4e2a\u6d88\u8d39\u8005\u8d1f\u8d23\u6d88\u8d39\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\uff0c\u4e00\u4e2a\u5206\u533a\u53ea\u80fd\u7531\u4e00\u4e2a\u7ec4\u5185\u6d88\u8d39\u8005\u6d88\u8d39\uff1b\u6d88\u8d39\u8005\u7ec4\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd\u3002\u6240\u6709\u7684\u6d88\u8d39\u8005\u90fd\u5c5e\u4e8e\u67d0\u4e2a\u6d88\u8d39\u8005\u7ec4\uff0c\u5373\u6d88\u8d39\u8005\u7ec4\u662f\u903b\u8f91\u4e0a\u7684\u4e00\u4e2a\u8ba2\u9605\u8005\u3002</p> <p>\uff084\uff09Broker\uff1a\u4e00\u53f0 Kafka \u670d\u52a1\u5668\u5c31\u662f\u4e00\u4e2a broker\u3002\u4e00\u4e2a\u96c6\u7fa4\u7531\u591a\u4e2a broker \u7ec4\u6210\u3002\u4e00\u4e2a broker \u53ef\u4ee5\u5bb9\u7eb3\u591a\u4e2a topic\u3002</p> <p>\uff085\uff09Topic\uff1a\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u961f\u5217\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u9762\u5411\u7684\u90fd\u662f\u4e00\u4e2a topic\u3002</p> <p>\uff086\uff09Partition\uff1a\u4e3a\u4e86\u5b9e\u73b0\u6269\u5c55\u6027\uff0c\u4e00\u4e2a\u975e\u5e38\u5927\u7684 topic \u53ef\u4ee5\u5206\u5e03\u5230\u591a\u4e2a broker\uff08\u5373\u670d\u52a1\u5668\uff09\u4e0a\uff0c\u4e00\u4e2a topic \u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a partition\uff0c\u6bcf\u4e2a partition \u662f\u4e00\u4e2a\u6709\u5e8f\u7684\u961f\u5217\u3002</p> <p>\uff087\uff09Replica\uff1a\u526f\u672c\u3002\u4e00\u4e2a topic \u7684\u6bcf\u4e2a\u5206\u533a\u90fd\u6709\u82e5\u5e72\u4e2a\u526f\u672c\uff0c\u4e00\u4e2a Leader \u548c\u82e5\u5e72\u4e2a Follower\u3002</p> <p>\uff088\uff09Leader\uff1a\u6bcf\u4e2a\u5206\u533a\u591a\u4e2a\u526f\u672c\u7684\u201c\u4e3b\u201d\uff0c\u751f\u4ea7\u8005\u53d1\u9001\u6570\u636e\u7684\u5bf9\u8c61\uff0c\u4ee5\u53ca\u6d88\u8d39\u8005\u6d88\u8d39\u6570\u636e\u7684\u5bf9\u8c61\u90fd\u662f Leader\u3002</p> <p>\uff089\uff09Follower\uff1a\u6bcf\u4e2a\u5206\u533a\u591a\u4e2a\u526f\u672c\u4e2d\u7684\u201c\u4ece\u201d\uff0c\u5b9e\u65f6\u4ece Leader \u4e2d\u540c\u6b65\u6570\u636e\uff0c\u4fdd\u6301\u548c Leader \u6570\u636e\u7684\u540c\u6b65\u3002Leader \u53d1\u751f\u6545\u969c\u65f6\uff0c\u67d0\u4e2a Follower \u4f1a\u6210\u4e3a\u65b0\u7684 Leader\u3002</p>"},{"location":"mq/kafka/kf_02/","title":"\u7b2c2\u7ae0 Kafka\u5feb\u901f\u5165\u95e8","text":""},{"location":"mq/kafka/kf_02/#21","title":"2.1 \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"mq/kafka/kf_02/#211","title":"2.1.1 \u96c6\u7fa4\u89c4\u5212","text":"hadoop102 hadoop103 hadoop104 zk zk zk kafka kafka kafka"},{"location":"mq/kafka/kf_02/#212","title":"2.1.2 \u96c6\u7fa4\u90e8\u7f72","text":"<p>0\uff09\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740\uff1ahttp://kafka.apache.org/downloads.html</p> <p>1\uff09\u89e3\u538b\u5b89\u88c5\u5305</p> <pre><code>tar -zxvf kafka_2.12-3.0.0.tgz -C /opt/module/\n</code></pre> <p>2\uff09\u4fee\u6539\u89e3\u538b\u540e\u7684\u6587\u4ef6\u540d\u79f0</p> <pre><code>mv kafka_2.12-3.0.0/ kafka\n</code></pre> <p>3\uff09\u8fdb\u5165\u5230 /opt/module/kafka \u76ee\u5f55\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6</p> <pre><code>cd config/\nvim server.properties\n</code></pre> server.properties<pre><code>#broker\u7684\u5168\u5c40\u552f\u4e00\u7f16\u53f7\uff0c\u4e0d\u80fd\u91cd\u590d\uff0c\u53ea\u80fd\u662f\u6570\u5b57\u3002\nbroker.id=0\n#\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\u7ebf\u7a0b\u6570\u91cf\nnum.network.threads=3\n#\u7528\u6765\u5904\u7406\u78c1\u76d8IO\u7684\u7ebf\u7a0b\u6570\u91cf\nnum.io.threads=8\n#\u53d1\u9001\u5957\u63a5\u5b57\u7684\u7f13\u51b2\u533a\u5927\u5c0f\nsocket.send.buffer.bytes=102400\n#\u63a5\u6536\u5957\u63a5\u5b57\u7684\u7f13\u51b2\u533a\u5927\u5c0f\nsocket.receive.buffer.bytes=102400\n#\u8bf7\u6c42\u5957\u63a5\u5b57\u7684\u7f13\u51b2\u533a\u5927\u5c0f\nsocket.request.max.bytes=104857600\n#kafka\u8fd0\u884c\u65e5\u5fd7(\u6570\u636e)\u5b58\u653e\u7684\u8def\u5f84\uff0c\u8def\u5f84\u4e0d\u9700\u8981\u63d0\u524d\u521b\u5efa\uff0ckafka\u81ea\u52a8\u5e2e\u4f60\u521b\u5efa\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u78c1\u76d8\u8def\u5f84\uff0c\u8def\u5f84\u4e0e\u8def\u5f84\u4e4b\u95f4\u53ef\u4ee5\u7528\"\uff0c\"\u5206\u9694\nlog.dirs=/opt/module/kafka/datas\n#topic\u5728\u5f53\u524dbroker\u4e0a\u7684\u5206\u533a\u4e2a\u6570\nnum.partitions=1\n#\u7528\u6765\u6062\u590d\u548c\u6e05\u7406data\u4e0b\u6570\u636e\u7684\u7ebf\u7a0b\u6570\u91cf\nnum.recovery.threads.per.data.dir=1\n# \u6bcf\u4e2atopic\u521b\u5efa\u65f6\u7684\u526f\u672c\u6570\uff0c\u9ed8\u8ba4\u65f61\u4e2a\u526f\u672c\noffsets.topic.replication.factor=1\n#segment\u6587\u4ef6\u4fdd\u7559\u7684\u6700\u957f\u65f6\u95f4\uff0c\u8d85\u65f6\u5c06\u88ab\u5220\u9664\nlog.retention.hours=168\n#\u6bcf\u4e2asegment\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u6700\u59271G\nlog.segment.bytes=1073741824\n# \u68c0\u67e5\u8fc7\u671f\u6570\u636e\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba45\u5206\u949f\u68c0\u67e5\u4e00\u6b21\u662f\u5426\u6570\u636e\u8fc7\u671f\nlog.retention.check.interval.ms=300000\n#\u914d\u7f6e\u8fde\u63a5Zookeeper\u96c6\u7fa4\u5730\u5740\uff08\u5728zk\u6839\u76ee\u5f55\u4e0b\u521b\u5efa/kafka\uff0c\u65b9\u4fbf\u7ba1\u7406\uff09\nzookeeper.connect=hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka\n</code></pre> <p>4\uff09\u5206\u53d1\u5b89\u88c5\u5305</p> <pre><code>xsync kafka/\n</code></pre> <p>5\uff09\u5206\u522b\u5728 hadoop103 \u548c hadoop104 \u4e0a\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 /opt/module/kafka/config/server.properties \u4e2d\u7684 broker.id=1\u3001broker.id=2</p> <p>\u6ce8\u610f</p> <p>broker.id\u4e0d\u5f97\u91cd\u590d\uff0c\u6574\u4e2a\u96c6\u7fa4\u4e2d\u552f\u4e00\u3002</p> <p>6\uff09\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> <p>\uff081\uff09\u5728 /etc/profile.d/my_env.sh \u6587\u4ef6\u4e2d\u589e\u52a0 kafka \u73af\u5883\u53d8\u91cf\u914d\u7f6e</p> <pre><code>sudo vim /etc/profile.d/my_env.sh\n</code></pre> env.sh<pre><code>#KAFKA_HOME\nexport KAFKA_HOME=/opt/module/kafka\nexport PATH=$PATH:$KAFKA_HOME/bin\n</code></pre> <p>\uff082\uff09\u5237\u65b0\u4e00\u4e0b\u73af\u5883\u53d8\u91cf</p> <pre><code>source /etc/profile\n</code></pre> <p>\uff083\uff09\u5206\u53d1\u73af\u5883\u53d8\u91cf\u6587\u4ef6\u5230\u5176\u4ed6\u8282\u70b9\uff0c\u5e76 source\u3002</p> <p>7\uff09\u542f\u52a8\u96c6\u7fa4</p> <p>\uff081\uff09\u5148\u542f\u52a8 Zookeeper \u96c6\u7fa4\uff0c\u7136\u540e\u542f\u52a8 Kafka\u3002</p> <pre><code>zk.sh start </code></pre> <p>\uff082\uff09\u4f9d\u6b21\u5728 hadoop102\u3001hadoop103\u3001hadoop104 \u8282\u70b9\u4e0a\u542f\u52a8 Kafka\u3002</p> <pre><code>bin/kafka-server-start.sh -daemon config/server.properties\n</code></pre> <p>8\uff09\u5173\u95ed\u96c6\u7fa4</p> <pre><code>bin/kafka-server-stop.sh </code></pre>"},{"location":"mq/kafka/kf_02/#213","title":"2.1.3 \u96c6\u7fa4\u542f\u505c\u811a\u672c","text":"<p>1\uff09\u5728 /home/atguigu/bin \u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6 kf.sh \u811a\u672c\u6587\u4ef6</p> <pre><code>vim kf.sh\n</code></pre> kf.sh<pre><code>#! /bin/bash\n\ncase $1 in\n\"start\"){\nfor i in hadoop102 hadoop103 hadoop104\n    do\necho \" --------\u542f\u52a8 $i Kafka-------\"\nssh $i \"/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties\"\ndone\n};;\n\"stop\"){\nfor i in hadoop102 hadoop103 hadoop104\n    do\necho \" --------\u505c\u6b62 $i Kafka-------\"\nssh $i \"/opt/module/kafka/bin/kafka-server-stop.sh \"\ndone\n};;\nesac\n</code></pre> <p>2\uff09\u6dfb\u52a0\u6267\u884c\u6743\u9650</p> <pre><code>chmod +x kf.sh\n</code></pre> <p>3\uff09\u542f\u52a8\u96c6\u7fa4\u547d\u4ee4</p> <pre><code>kf.sh start\n</code></pre> <p>4\uff09\u505c\u6b62\u96c6\u7fa4\u547d\u4ee4</p> <pre><code>kf.sh stop\n</code></pre> <p>\u6ce8\u610f</p> <p>\u505c\u6b62 Kafka \u96c6\u7fa4\u65f6\uff0c\u4e00\u5b9a\u8981\u7b49 Kafka \u6240\u6709\u8282\u70b9\u8fdb\u7a0b\u5168\u90e8\u505c\u6b62\u540e\u518d\u505c\u6b62 Zookeeper \u96c6\u7fa4\u3002\u56e0\u4e3a Zookeeper \u96c6\u7fa4\u5f53\u4e2d\u8bb0\u5f55\u7740 Kafka \u96c6\u7fa4\u76f8\u5173\u4fe1\u606f\uff0cZookeeper \u96c6\u7fa4\u4e00\u65e6\u5148\u505c\u6b62\uff0cKafka \u96c6\u7fa4\u5c31\u6ca1\u6709\u529e\u6cd5\u518d\u83b7\u53d6\u505c\u6b62\u8fdb\u7a0b\u7684\u4fe1\u606f\uff0c\u53ea\u80fd\u624b\u52a8\u6740\u6b7b Kafka \u8fdb\u7a0b\u4e86\u3002</p>"},{"location":"mq/kafka/kf_02/#22-kafka","title":"2.2 Kafka\u547d\u4ee4\u884c\u64cd\u4f5c","text":""},{"location":"mq/kafka/kf_02/#221","title":"2.2.1 \u4e3b\u9898\u547d\u4ee4\u884c\u64cd\u4f5c","text":"<p>1\uff09\u67e5\u770b\u64cd\u4f5c\u4e3b\u9898\u547d\u4ee4\u53c2\u6570</p> <pre><code>bin/kafka-topics.sh\n</code></pre> \u53c2\u6570 \u63cf\u8ff0 --bootstrap-server  \u8fde\u63a5\u7684Kafka Broker\u4e3b\u673a\u540d\u79f0\u548c\u7aef\u53e3\u53f7\u3002 --topic  \u64cd\u4f5c\u7684topic\u540d\u79f0\u3002 --create \u521b\u5efa\u4e3b\u9898\u3002 --delete \u5220\u9664\u4e3b\u9898\u3002 --alter \u4fee\u6539\u4e3b\u9898\u3002 --list \u67e5\u770b\u6240\u6709\u4e3b\u9898\u3002 --describe \u67e5\u770b\u4e3b\u9898\u8be6\u7ec6\u63cf\u8ff0\u3002 --partitions  \u8bbe\u7f6e\u5206\u533a\u6570\u3002 --replication-factor \u8bbe\u7f6e\u5206\u533a\u526f\u672c\u3002 --config  \u66f4\u65b0\u7cfb\u7edf\u9ed8\u8ba4\u7684\u914d\u7f6e\u3002 <p>2\uff09\u67e5\u770b\u5f53\u524d\u670d\u52a1\u5668\u4e2d\u7684\u6240\u6709 topic</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --list\n</code></pre> <p>3\uff09\u521b\u5efa first topic</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --create --partitions 1 --replication-factor 3 --topic first\n</code></pre> <p>\u9009\u9879\u8bf4\u660e\uff1a</p> <ul> <li><code>--topic</code> \u5b9a\u4e49 topic \u540d</li> <li><code>--replication-factor</code>  \u5b9a\u4e49\u526f\u672c\u6570</li> <li><code>--partitions</code>  \u5b9a\u4e49\u5206\u533a\u6570</li> </ul> <p>4\uff09\u67e5\u770b first \u4e3b\u9898\u7684\u8be6\u60c5</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --describe --topic first\n</code></pre> <p>5\uff09\u4fee\u6539\u5206\u533a\u6570\uff08\u6ce8\u610f\uff1a\u5206\u533a\u6570\u53ea\u80fd\u589e\u52a0\uff0c\u4e0d\u80fd\u51cf\u5c11\uff09</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --alter --topic first --partitions 3\n</code></pre> <p>6\uff09\u518d\u6b21\u67e5\u770b first \u4e3b\u9898\u7684\u8be6\u60c5</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --describe --topic firstbin/kafka-topics.sh --bootstrap-server hadoop102:9092 --describe --topic first\n</code></pre> <p>7\uff09\u5220\u9664 topic</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --delete --topic first\n</code></pre>"},{"location":"mq/kafka/kf_02/#222","title":"2.2.2 \u751f\u4ea7\u8005\u547d\u4ee4\u884c\u64cd\u4f5c","text":"<p>1\uff09\u67e5\u770b\u64cd\u4f5c\u751f\u4ea7\u8005\u547d\u4ee4\u53c2\u6570</p> <pre><code>bin/kafka-console-producer.sh\n</code></pre> \u53c2\u6570 \u63cf\u8ff0 --bootstrap-server  \u8fde\u63a5\u7684Kafka Broker\u4e3b\u673a\u540d\u79f0\u548c\u7aef\u53e3\u53f7\u3002 --topic  \u64cd\u4f5c\u7684topic\u540d\u79f0\u3002 <p>2\uff09\u53d1\u9001\u6d88\u606f</p> <pre><code>bin/kafka-console-producer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre>"},{"location":"mq/kafka/kf_02/#223","title":"2.2.3 \u6d88\u8d39\u8005\u547d\u4ee4\u884c\u64cd\u4f5c","text":"<p>1\uff09\u67e5\u770b\u64cd\u4f5c\u6d88\u8d39\u8005\u547d\u4ee4\u53c2\u6570</p> <pre><code>bin/kafka-console-consumer.sh\n</code></pre> \u53c2\u6570 \u63cf\u8ff0 --bootstrap-server  \u8fde\u63a5\u7684Kafka Broker\u4e3b\u673a\u540d\u79f0\u548c\u7aef\u53e3\u53f7\u3002 --topic  \u64cd\u4f5c\u7684topic\u540d\u79f0\u3002 --from-beginning \u4ece\u5934\u5f00\u59cb\u6d88\u8d39\u3002 --group  \u6307\u5b9a\u6d88\u8d39\u8005\u7ec4\u540d\u79f0\u3002 <p>2\uff09\u6d88\u8d39\u6d88\u606f</p> <p>\uff081\uff09\u6d88\u8d39 first \u4e3b\u9898\u4e2d\u7684\u6570\u636e\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\uff082\uff09\u628a\u4e3b\u9898\u4e2d\u6240\u6709\u7684\u6570\u636e\u90fd\u8bfb\u53d6\u51fa\u6765\uff08\u5305\u62ec\u5386\u53f2\u6570\u636e\uff09\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --from-beginning --topic first\n</code></pre>"},{"location":"mq/kafka/kf_03/","title":"\u7b2c3\u7ae0 Kafka\u751f\u4ea7\u8005","text":""},{"location":"mq/kafka/kf_03/#31","title":"3.1 \u751f\u4ea7\u8005\u6d88\u606f\u53d1\u9001\u6d41\u7a0b","text":""},{"location":"mq/kafka/kf_03/#311","title":"3.1.1 \u53d1\u9001\u539f\u7406","text":"<p>\u5728\u6d88\u606f\u53d1\u9001\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6d89\u53ca\u5230\u4e86\u4e24\u4e2a\u7ebf\u7a0b\u2014\u2014 main \u7ebf\u7a0b\u548c Sender \u7ebf\u7a0b\u3002\u5728 main \u7ebf\u7a0b\u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u53cc\u7aef\u961f\u5217 RecordAccumulator\u3002main \u7ebf\u7a0b\u5c06\u6d88\u606f\u53d1\u9001\u7ed9 RecordAccumulator\uff0cSender \u7ebf\u7a0b\u4e0d\u65ad\u4ece RecordAccumulator \u4e2d\u62c9\u53d6\u6d88\u606f\u53d1\u9001\u5230 Kafka Broker\u3002</p> <p></p>"},{"location":"mq/kafka/kf_03/#312","title":"3.1.2 \u751f\u4ea7\u8005\u91cd\u8981\u53c2\u6570\u5217\u8868","text":"\u53c2\u6570\u540d\u79f0 \u63cf\u8ff0 bootstrap.servers \u751f\u4ea7\u8005\u8fde\u63a5\u96c6\u7fa4\u6240\u9700\u7684 broker \u5730\u5740\u6e05\u5355\u3002\u4f8b\u5982hadoop102:9092,hadoop103:9092,hadoop104:9092\uff0c\u53ef\u4ee5\u8bbe\u7f6e 1 \u4e2a\u6216\u8005\u591a\u4e2a\uff0c\u4e2d\u95f4\u7528\u9017\u53f7\u9694\u5f00\u3002\u6ce8\u610f\u8fd9\u91cc\u5e76\u975e\u9700\u8981\u6240\u6709\u7684 broker \u5730\u5740\uff0c\u56e0\u4e3a\u751f\u4ea7\u8005\u4ece\u7ed9\u5b9a\u7684 broker \u91cc\u67e5\u627e\u5230\u5176\u4ed6 broker \u4fe1\u606f\u3002 key.serializer\u548cvalue.serializer \u6307\u5b9a\u53d1\u9001\u6d88\u606f\u7684 key \u548c value \u7684\u5e8f\u5217\u5316\u7c7b\u578b\u3002\u4e00\u5b9a\u8981\u5199\u5168\u7c7b\u540d\u3002 buffer.memory RecordAccumulator \u7f13\u51b2\u533a\u603b\u5927\u5c0f\uff0c\u9ed8\u8ba4 32m\u3002 batch.size \u7f13\u51b2\u533a\u4e00\u6279\u6570\u636e\u6700\u5927\u503c\uff0c\u9ed8\u8ba4 16k\u3002\u9002\u5f53\u589e\u52a0\u8be5\u503c\uff0c\u53ef\u4ee5\u63d0\u9ad8\u541e\u5410\u91cf\uff0c\u4f46\u662f\u5982\u679c\u8be5\u503c\u8bbe\u7f6e\u592a\u5927\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u4f20\u8f93\u5ef6\u8fdf\u589e\u52a0\u3002 linger.ms \u5982\u679c\u6570\u636e\u8fdf\u8fdf\u672a\u8fbe\u5230 batch.size\uff0csender \u7b49\u5f85 linger.ms \u4e4b\u540e\u5c31\u4f1a\u53d1\u9001\u6570\u636e\u3002\u5355\u4f4d ms\uff0c\u9ed8\u8ba4\u503c\u662f 0ms\uff0c\u8868\u793a\u6ca1\u6709\u5ef6\u8fdf\u3002\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u8be5\u503c\u5927\u5c0f\u4e3a 5 - 100 ms \u4e4b\u95f4\u3002 acks 0\uff1a\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\uff0c\u4e0d\u9700\u8981\u7b49\u6570\u636e\u843d\u76d8\u5e94\u7b54\u30021\uff1a\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\uff0cLeader \u6536\u5230\u6570\u636e\u540e\u5e94\u7b54\u3002-1\uff08all\uff09\uff1a\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\uff0cLeader \u548c isr \u961f\u5217\u91cc\u9762\u7684\u6240\u6709\u8282\u70b9\u6536\u9f50\u6570\u636e\u540e\u5e94\u7b54\u3002\u9ed8\u8ba4\u503c\u662f -1\uff0c-1 \u548c all \u662f\u7b49\u4ef7\u7684\u3002 max.in.flight.requests.per.connection \u5141\u8bb8\u6700\u591a\u6ca1\u6709\u8fd4\u56de ack \u7684\u6b21\u6570\uff0c\u9ed8\u8ba4\u4e3a 5\uff0c\u5f00\u542f\u5e42\u7b49\u6027\u8981\u4fdd\u8bc1\u8be5\u503c\u662f 1 - 5 \u7684\u6570\u5b57\u3002 retries \u5f53\u6d88\u606f\u53d1\u9001\u51fa\u73b0\u9519\u8bef\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u91cd\u53d1\u6d88\u606f\u3002retries \u8868\u793a\u91cd\u8bd5\u6b21\u6570\u3002\u9ed8\u8ba4\u662f int \u6700\u5927\u503c\uff0c2147483647\u3002\u5982\u679c\u8bbe\u7f6e\u4e86\u91cd\u8bd5\uff0c\u8fd8\u60f3\u4fdd\u8bc1\u6d88\u606f\u7684\u6709\u5e8f\u6027\uff0c\u9700\u8981\u8bbe\u7f6e MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION=1 \u5426\u5219\u5728\u91cd\u8bd5\u6b64\u5931\u8d25\u6d88\u606f\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u7684\u6d88\u606f\u53ef\u80fd\u53d1\u9001\u6210\u529f\u4e86\u3002 retry.backoff.ms \u4e24\u6b21\u91cd\u8bd5\u4e4b\u95f4\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba4\u662f 100ms\u3002 enable.idempotence \u662f\u5426\u5f00\u542f\u5e42\u7b49\u6027\uff0c\u9ed8\u8ba4 true\uff0c\u5f00\u542f\u5e42\u7b49\u6027\u3002 compression.type \u751f\u4ea7\u8005\u53d1\u9001\u7684\u6240\u6709\u6570\u636e\u7684\u538b\u7f29\u65b9\u5f0f\u3002\u9ed8\u8ba4\u662f none\uff0c\u4e5f\u5c31\u662f\u4e0d\u538b\u7f29\u3002 \u652f\u6301\u538b\u7f29\u7c7b\u578b\uff1anone\u3001gzip\u3001snappy\u3001lz4 \u548c zstd\u3002"},{"location":"mq/kafka/kf_03/#32-api","title":"3.2 \u5f02\u6b65\u53d1\u9001API","text":""},{"location":"mq/kafka/kf_03/#321","title":"3.2.1 \u666e\u901a\u5f02\u6b65\u53d1\u9001","text":"<p>1\uff09\u9700\u6c42\uff1a\u521b\u5efa Kafka \u751f\u4ea7\u8005\uff0c\u91c7\u7528\u5f02\u6b65\u7684\u65b9\u5f0f\u53d1\u9001\u5230 Kafka Broker</p> <p>2\uff09\u4ee3\u7801\u7f16\u5199</p> <p>\uff081\uff09\u521b\u5efa\u5de5\u7a0bkafka</p> <p>\uff082\uff09\u5bfc\u5165\u4f9d\u8d56</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;\n&lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;\n&lt;version&gt;3.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>\uff083\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.kafka.producer</p> <p>\uff084\uff09\u7f16\u5199\u4e0d\u5e26\u56de\u8c03\u51fd\u6570\u7684 API \u4ee3\u7801</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.KafkaProducer;\nimport org.apache.kafka.clients.producer.ProducerRecord;\n\nimport java.util.Properties;\n\npublic class CustomProducer {\n\npublic static void main(String[] args) throws InterruptedException {\n\n// 1. \u521b\u5efakafka\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2. \u7ed9kafka\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u914d\u7f6e\u4fe1\u606f\uff1abootstrap.servers\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// key,value\u5e8f\u5217\u5316\uff08\u5fc5\u987b\uff09\uff1akey.serializer\uff0cvalue.serializer\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\n// 3. \u521b\u5efakafka\u751f\u4ea7\u8005\u5bf9\u8c61\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;String, String&gt;(properties);\n\n// 4. \u8c03\u7528send\u65b9\u6cd5,\u53d1\u9001\u6d88\u606f\nfor (int i = 0; i &lt; 5; i++) {\n\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\",\"atguigu \" + i));\n\n}\n\n// 5. \u5173\u95ed\u8d44\u6e90\nkafkaProducer.close();\n}\n} </code></pre> <p>\u6d4b\u8bd5\uff1a \u2460 \u5728hadoop102 \u4e0a\u5f00\u542f Kafka \u6d88\u8d39\u8005\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\u2461\u5728 IDEA \u4e2d\u6267\u884c\u4ee3\u7801\uff0c\u89c2\u5bdf hadoop102 \u63a7\u5236\u53f0\u4e2d\u662f\u5426\u63a5\u6536\u5230\u6d88\u606f\u3002</p>"},{"location":"mq/kafka/kf_03/#322","title":"3.2.2 \u5e26\u56de\u8c03\u51fd\u6570\u7684\u5f02\u6b65\u53d1\u9001","text":"<p>\u56de\u8c03\u51fd\u6570\u4f1a\u5728 producer \u6536\u5230 ack \u65f6\u8c03\u7528\uff0c\u4e3a\u5f02\u6b65\u8c03\u7528\uff0c\u8be5\u65b9\u6cd5\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f\u5143\u6570\u636e\u4fe1\u606f\uff08RecordMetadata\uff09\u548c\u5f02\u5e38\u4fe1\u606f\uff08Exception\uff09\uff0c\u5982\u679c Exception \u4e3a null\uff0c\u8bf4\u660e\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0c\u5982\u679c Exception \u4e0d\u4e3a null\uff0c\u8bf4\u660e\u6d88\u606f\u53d1\u9001\u5931\u8d25\u3002</p> <p>\u6ce8\u610f</p> <p>\u6d88\u606f\u53d1\u9001\u5931\u8d25\u4f1a\u81ea\u52a8\u91cd\u8bd5\uff0c\u4e0d\u9700\u8981\u6211\u4eec\u5728\u56de\u8c03\u51fd\u6570\u4e2d\u624b\u52a8\u91cd\u8bd5\u3002</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.*;\nimport java.util.Properties;\n\npublic class CustomProducerCallback {\n\npublic static void main(String[] args) throws InterruptedException {\n\n// 1. \u521b\u5efakafka\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2. \u7ed9kafka\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u914d\u7f6e\u4fe1\u606f\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// key,value\u5e8f\u5217\u5316\uff08\u5fc5\u987b\uff09\uff1akey.serializer\uff0cvalue.serializer\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\n// 3. \u521b\u5efakafka\u751f\u4ea7\u8005\u5bf9\u8c61\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;String, String&gt;(properties);\n\n// 4. \u8c03\u7528send\u65b9\u6cd5,\u53d1\u9001\u6d88\u606f\nfor (int i = 0; i &lt; 5; i++) {\n\n// \u6dfb\u52a0\u56de\u8c03\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\", \"atguigu \" + i), new Callback() {\n\n// \u8be5\u65b9\u6cd5\u5728Producer\u6536\u5230ack\u65f6\u8c03\u7528\uff0c\u4e3a\u5f02\u6b65\u8c03\u7528\n@Override\npublic void onCompletion(RecordMetadata metadata, Exception exception) {\n\nif (exception == null) {\n// \u6ca1\u6709\u5f02\u5e38,\u8f93\u51fa\u4fe1\u606f\u5230\u63a7\u5236\u53f0\nSystem.out.println(\"\u4e3b\u9898\uff1a\" + metadata.topic() + \"-&gt;\"  + \"\u5206\u533a\uff1a\" + metadata.partition());\n} else {\n// \u51fa\u73b0\u5f02\u5e38\u6253\u5370\nexception.printStackTrace();\n}\n}\n});\n\n// \u5ef6\u8fdf\u4e00\u4f1a\u4f1a\u770b\u5230\u6570\u636e\u53d1\u5f80\u4e0d\u540c\u5206\u533a\nThread.sleep(2);\n}\n\n// 5. \u5173\u95ed\u8d44\u6e90\nkafkaProducer.close();\n}\n}\n</code></pre> <p>\u6d4b\u8bd5\uff1a</p> <p>\u2460 \u5728 hadoop102 \u4e0a\u5f00\u542f Kafka \u6d88\u8d39\u8005\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\u2461 \u5728 IDEA \u4e2d\u6267\u884c\u4ee3\u7801\uff0c\u89c2\u5bdf hadoop102 \u63a7\u5236\u53f0\u4e2d\u662f\u5426\u63a5\u6536\u5230\u6d88\u606f\u3002</p> <p>\u2462 \u5728 IDEA \u63a7\u5236\u53f0\u89c2\u5bdf\u56de\u8c03\u4fe1\u606f\u3002</p>"},{"location":"mq/kafka/kf_03/#33-api","title":"3.3 \u540c\u6b65\u53d1\u9001API","text":"<p>\u53ea\u9700\u5728\u5f02\u6b65\u53d1\u9001\u7684\u57fa\u7840\u4e0a\uff0c\u518d\u8c03\u7528\u4e00\u4e0b get() \u65b9\u6cd5\u5373\u53ef\u3002</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.KafkaProducer;\nimport org.apache.kafka.clients.producer.ProducerConfig;\nimport org.apache.kafka.clients.producer.ProducerRecord;\nimport java.util.Properties;\nimport java.util.concurrent.ExecutionException;\n\npublic class CustomProducerSync {\n\npublic static void main(String[] args) throws InterruptedException, ExecutionException {\n\n// 1. \u521b\u5efakafka\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2. \u7ed9kafka\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u914d\u7f6e\u4fe1\u606f\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092\");\n\n// key,value\u5e8f\u5217\u5316\uff08\u5fc5\u987b\uff09\uff1akey.serializer\uff0cvalue.serializer\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\n// 3. \u521b\u5efakafka\u751f\u4ea7\u8005\u5bf9\u8c61\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;String, String&gt;(properties);\n\n// 4. \u8c03\u7528send\u65b9\u6cd5,\u53d1\u9001\u6d88\u606f\nfor (int i = 0; i &lt; 10; i++) {\n\n// \u5f02\u6b65\u53d1\u9001 \u9ed8\u8ba4\n//            kafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\",\"kafka\" + i));\n// \u540c\u6b65\u53d1\u9001\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\",\"kafka\" + i)).get();\n\n}\n\n// 5. \u5173\u95ed\u8d44\u6e90\nkafkaProducer.close();\n}\n}\n</code></pre> <p>\u6d4b\u8bd5\uff1a</p> <p>\u2460 \u5728 hadoop102 \u4e0a\u5f00\u542f Kafka \u6d88\u8d39\u8005\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\u2461\u5728 IDEA \u4e2d\u6267\u884c\u4ee3\u7801\uff0c\u89c2\u5bdf hadoop102 \u63a7\u5236\u53f0\u4e2d\u662f\u5426\u63a5\u6536\u5230\u6d88\u606f\u3002</p>"},{"location":"mq/kafka/kf_03/#34","title":"3.4 \u751f\u4ea7\u8005\u5206\u533a","text":""},{"location":"mq/kafka/kf_03/#341","title":"3.4.1 \u5206\u533a\u597d\u5904","text":""},{"location":"mq/kafka/kf_03/#342","title":"3.4.2 \u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u5206\u533a\u7b56\u7565","text":"<p>1\uff09\u9ed8\u8ba4\u7684\u5206\u533a\u5668 DefaultPartitioner</p> <p>\u200b   \u5728 IDEA \u4e2d Ctrl+N\uff0c\u5168\u5c40\u67e5\u627e DefaultPartitioner\u3002</p> <pre><code>/**\n * The default partitioning strategy:\n * &lt;ul&gt;\n * &lt;li&gt;If a partition is specified in the record, use it\n * &lt;li&gt;If no partition is specified but a key is present choose a partition based on a hash of the key\n * &lt;li&gt;If no partition or key is present choose the sticky partition that changes when the batch is full.\n * \n * See KIP-480 for details about sticky partitioning.\n */\npublic class DefaultPartitioner implements Partitioner {\n\n\u2026 \u2026\n}\n</code></pre> <p></p> <p>2\uff09\u6848\u4f8b\u4e00</p> <p>\u5c06\u6570\u636e\u53d1\u5f80\u6307\u5b9a partition \u7684\u60c5\u51b5\u4e0b\uff0c\u4f8b\u5982\uff0c\u5c06\u6240\u6709\u6570\u636e\u53d1\u5f80\u5206\u533a 1 \u4e2d\u3002</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.*;\n\nimport java.util.Properties;\n\npublic class CustomProducerCallbackPartitions {\n\npublic static void main(String[] args) {\n\n// 1. \u521b\u5efakafka\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2. \u7ed9kafka\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u914d\u7f6e\u4fe1\u606f\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092\");\n\n// key,value\u5e8f\u5217\u5316\uff08\u5fc5\u987b\uff09\uff1akey.serializer\uff0cvalue.serializer\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties);\n\nfor (int i = 0; i &lt; 5; i++) {\n// \u6307\u5b9a\u6570\u636e\u53d1\u9001\u52301\u53f7\u5206\u533a\uff0ckey\u4e3a\u7a7a\uff08IDEA\u4e2dctrl + p\u67e5\u770b\u53c2\u6570\uff09\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\", 1,\"\",\"atguigu \" + i), new Callback() {\n@Override\npublic void onCompletion(RecordMetadata metadata, Exception e) {\nif (e == null){\nSystem.out.println(\"\u4e3b\u9898\uff1a\" + metadata.topic() + \"-&gt;\"  + \"\u5206\u533a\uff1a\" + metadata.partition()\n);\n}else {\ne.printStackTrace();\n}\n}\n});\n}\n\nkafkaProducer.close();\n}\n}\n</code></pre> <p>\u6d4b\u8bd5\uff1a</p> <p>\u2460 \u5728hadoop102 \u4e0a\u5f00\u542f Kafka \u6d88\u8d39\u8005\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\u2461 \u5728 IDEA \u4e2d\u6267\u884c\u4ee3\u7801\uff0c\u89c2\u5bdf hadoop102 \u63a7\u5236\u53f0\u4e2d\u662f\u5426\u63a5\u6536\u5230\u6d88\u606f\u3002</p> <p>\u2462 \u5728 IDEA \u63a7\u5236\u53f0\u89c2\u5bdf\u56de\u8c03\u4fe1\u606f\u3002</p> <p>3\uff09\u6848\u4f8b\u4e8c</p> <p>\u6ca1\u6709\u6307\u660e partition \u503c\u4f46\u6709 key \u7684\u60c5\u51b5\u4e0b\uff0c\u5c06 key \u7684 hash \u503c\u4e0e topic \u7684 partition \u6570\u8fdb\u884c\u53d6\u4f59\u5f97\u5230 partition \u503c\u3002</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.*;\nimport java.util.Properties;\n\npublic class CustomProducerCallback {\n\npublic static void main(String[] args) {\n\nProperties properties = new Properties();\n\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092\");\n\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties);\n\nfor (int i = 0; i &lt; 5; i++) {\n// \u4f9d\u6b21\u6307\u5b9akey\u503c\u4e3aa,b,f \uff0c\u6570\u636ekey\u7684hash\u503c\u4e0e3\u4e2a\u5206\u533a\u6c42\u4f59\uff0c\u5206\u522b\u53d1\u5f801\u30012\u30010\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\", \"a\",\"atguigu \" + i), new Callback() {\n@Override\npublic void onCompletion(RecordMetadata metadata, Exception e) {\nif (e == null){\nSystem.out.println(\"\u4e3b\u9898\uff1a\" + metadata.topic() + \"-&gt;\" + \"\u5206\u533a\uff1a\" + metadata.partition()\n);\n}else {\ne.printStackTrace();\n}\n}\n});\n}\n\nkafkaProducer.close();\n}\n}\n</code></pre> <p>\u6d4b\u8bd5\uff1a \u2460 key=\"a\" \u65f6\uff0c\u5728\u63a7\u5236\u53f0\u67e5\u770b\u7ed3\u679c\u3002</p> <p>\u2461 key=\"b\" \u65f6\uff0c\u5728\u63a7\u5236\u53f0\u67e5\u770b\u7ed3\u679c\u3002</p> <p>\u2462 key=\"f\" \u65f6\uff0c\u5728\u63a7\u5236\u53f0\u67e5\u770b\u7ed3\u679c\u3002</p>"},{"location":"mq/kafka/kf_03/#343","title":"3.4.3 \u81ea\u5b9a\u4e49\u5206\u533a\u5668","text":"<p>\u200b   \u5982\u679c\u7814\u53d1\u4eba\u5458\u53ef\u4ee5\u6839\u636e\u4f01\u4e1a\u9700\u6c42\uff0c\u81ea\u5df1\u91cd\u65b0\u5b9e\u73b0\u5206\u533a\u5668\u3002</p> <p>1\uff09\u9700\u6c42</p> <p>\u4f8b\u5982\u6211\u4eec\u5b9e\u73b0\u4e00\u4e2a\u5206\u533a\u5668\u5b9e\u73b0\uff0c\u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\u4e2d\u5982\u679c\u5305\u542b atguigu\uff0c\u5c31\u53d1\u5f80 0 \u53f7\u5206\u533a\uff0c\u4e0d\u5305\u542b atguigu\uff0c\u5c31\u53d1\u5f80 1 \u53f7\u5206\u533a\u3002</p> <p>2\uff09\u5b9e\u73b0\u6b65\u9aa4</p> <p>\uff081\uff09\u5b9a\u4e49\u7c7b\u5b9e\u73b0 Partitioner \u63a5\u53e3\u3002</p> <p>\uff082\uff09\u91cd\u5199 partition() \u65b9\u6cd5\u3002</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.Partitioner;\nimport org.apache.kafka.common.Cluster;\n\nimport java.util.Map;\n\n/**\n * 1. \u5b9e\u73b0\u63a5\u53e3Partitioner\n * 2. \u5b9e\u73b03\u4e2a\u65b9\u6cd5:partition,close,configure\n * 3. \u7f16\u5199partition\u65b9\u6cd5,\u8fd4\u56de\u5206\u533a\u53f7\n */\npublic class MyPartitioner implements Partitioner {\n\n/**\n     * \u8fd4\u56de\u4fe1\u606f\u5bf9\u5e94\u7684\u5206\u533a\n     * @param topic         \u4e3b\u9898\n     * @param key           \u6d88\u606f\u7684key\n     * @param keyBytes      \u6d88\u606f\u7684key\u5e8f\u5217\u5316\u540e\u7684\u5b57\u8282\u6570\u7ec4\n     * @param value         \u6d88\u606f\u7684value\n     * @param valueBytes    \u6d88\u606f\u7684value\u5e8f\u5217\u5316\u540e\u7684\u5b57\u8282\u6570\u7ec4\n     * @param cluster       \u96c6\u7fa4\u5143\u6570\u636e\u53ef\u4ee5\u67e5\u770b\u5206\u533a\u4fe1\u606f\n     * @return\n     */\n@Override\npublic int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster) {\n\n// \u83b7\u53d6\u6d88\u606f\nString msgValue = value.toString();\n\n// \u521b\u5efapartition\nint partition;\n\n// \u5224\u65ad\u6d88\u606f\u662f\u5426\u5305\u542batguigu\nif (msgValue.contains(\"atguigu\")){\npartition = 0;\n}else {\npartition = 1;\n}\n\n// \u8fd4\u56de\u5206\u533a\u53f7\nreturn partition;\n}\n\n// \u5173\u95ed\u8d44\u6e90\n@Override\npublic void close() {\n\n}\n\n// \u914d\u7f6e\u65b9\u6cd5\n@Override\npublic void configure(Map&lt;String, ?&gt; configs) {\n\n}\n}\n</code></pre> <p>\uff083\uff09\u4f7f\u7528\u5206\u533a\u5668\u7684\u65b9\u6cd5\uff0c\u5728\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u4e2d\u6dfb\u52a0\u5206\u533a\u5668\u53c2\u6570\u3002</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.*;\n\nimport java.util.Properties;\n\npublic class CustomProducerCallbackPartitions {\n\npublic static void main(String[] args) throws InterruptedException {\n\nProperties properties = new Properties();\n\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,\"hadoop102:9092\");\n\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\n// \u6dfb\u52a0\u81ea\u5b9a\u4e49\u5206\u533a\u5668\nproperties.put(ProducerConfig.PARTITIONER_CLASS_CONFIG,\"com.atguigu.kafka.producer.MyPartitioner\");\n\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties);\n\nfor (int i = 0; i &lt; 5; i++) {\n\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\", \"atguigu \" + i), new Callback() {\n@Override\npublic void onCompletion(RecordMetadata metadata, Exception e) {\nif (e == null){\nSystem.out.println(\"\u4e3b\u9898\uff1a\" + metadata.topic() + \"-&gt;\" + \"\u5206\u533a\uff1a\" + metadata.partition()\n);\n}else {\ne.printStackTrace();\n}\n}\n});\n}\n\nkafkaProducer.close();\n}\n}\n</code></pre> <p>\uff084\uff09\u6d4b\u8bd5</p> <p>\u2460 \u5728 hadoop102 \u4e0a\u5f00\u542f Kafka \u6d88\u8d39\u8005\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\u2461 \u5728 IDEA \u63a7\u5236\u53f0\u89c2\u5bdf\u56de\u8c03\u4fe1\u606f\u3002</p>"},{"location":"mq/kafka/kf_03/#35","title":"3.5 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u751f\u4ea7\u8005\u5982\u4f55\u63d0\u9ad8\u541e\u5410\u91cf","text":"<pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.KafkaProducer;\nimport org.apache.kafka.clients.producer.ProducerRecord;\n\nimport java.util.Properties;\n\npublic class CustomProducerParameters {\n\npublic static void main(String[] args) throws InterruptedException {\n\n// 1. \u521b\u5efakafka\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2. \u7ed9kafka\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u914d\u7f6e\u4fe1\u606f\uff1abootstrap.servers\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// key,value\u5e8f\u5217\u5316\uff08\u5fc5\u987b\uff09\uff1akey.serializer\uff0cvalue.serializer\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\n// batch.size\uff1a\u6279\u6b21\u5927\u5c0f\uff0c\u9ed8\u8ba416K\nproperties.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);\n\n// linger.ms\uff1a\u7b49\u5f85\u65f6\u95f4\uff0c\u9ed8\u8ba40\nproperties.put(ProducerConfig.LINGER_MS_CONFIG, 1);\n\n// RecordAccumulator\uff1a\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u9ed8\u8ba432M\uff1abuffer.memory\nproperties.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 33554432);\n\n// compression.type\uff1a\u538b\u7f29\uff0c\u9ed8\u8ba4none\uff0c\u53ef\u914d\u7f6e\u503cgzip\u3001snappy\u3001lz4\u548czstd\nproperties.put(ProducerConfig.COMPRESSION_TYPE_CONFIG,\"snappy\");\n\n// 3. \u521b\u5efakafka\u751f\u4ea7\u8005\u5bf9\u8c61\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;String, String&gt;(properties);\n\n// 4. \u8c03\u7528send\u65b9\u6cd5,\u53d1\u9001\u6d88\u606f\nfor (int i = 0; i &lt; 5; i++) {\n\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\",\"atguigu \" + i));\n\n}\n\n// 5. \u5173\u95ed\u8d44\u6e90\nkafkaProducer.close();\n}\n} </code></pre> <p>\u6d4b\u8bd5\uff1a</p> <p>\u2460 \u5728 hadoop102 \u4e0a\u5f00\u542f Kafka \u6d88\u8d39\u8005\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\u2461 \u5728 IDEA \u4e2d\u6267\u884c\u4ee3\u7801\uff0c\u89c2\u5bdf hadoop102 \u63a7\u5236\u53f0\u4e2d\u662f\u5426\u63a5\u6536\u5230\u6d88\u606f\u3002</p>"},{"location":"mq/kafka/kf_03/#36","title":"3.6 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u6570\u636e\u53ef\u9760\u6027","text":"<p>0\uff09\u56de\u987e\u53d1\u9001\u6d41\u7a0b</p> <p></p> <p>1\uff09ack \u5e94\u7b54\u539f\u7406</p> <p> </p> ACK \u5e94\u7b54\u7ea7\u522b <p> </p> \u6570\u636e\u53ef\u9760\u6027\u5206\u6790 <p> </p> \u6570\u636e\u53ef\u9760\u6027\u6bd4\u8f83 <p>2\uff09\u4ee3\u7801\u914d\u7f6e</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.KafkaProducer;\nimport org.apache.kafka.clients.producer.ProducerRecord;\n\nimport java.util.Properties;\n\npublic class CustomProducerAck {\n\npublic static void main(String[] args) throws InterruptedException {\n\n// 1. \u521b\u5efakafka\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2. \u7ed9kafka\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u914d\u7f6e\u4fe1\u606f\uff1abootstrap.servers\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// key,value\u5e8f\u5217\u5316\uff08\u5fc5\u987b\uff09\uff1akey.serializer\uff0cvalue.serializer\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\n// \u8bbe\u7f6eacks\nproperties.put(ProducerConfig.ACKS_CONFIG, \"all\");\n\n// \u91cd\u8bd5\u6b21\u6570retries\uff0c\u9ed8\u8ba4\u662fint\u6700\u5927\u503c\uff0c2147483647\nproperties.put(ProducerConfig.RETRIES_CONFIG, 3);\n\n// 3. \u521b\u5efakafka\u751f\u4ea7\u8005\u5bf9\u8c61\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;String, String&gt;(properties);\n\n// 4. \u8c03\u7528send\u65b9\u6cd5,\u53d1\u9001\u6d88\u606f\nfor (int i = 0; i &lt; 5; i++) {\n\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\",\"atguigu \" + i));\n\n}\n\n// 5. \u5173\u95ed\u8d44\u6e90\nkafkaProducer.close();\n}\n} </code></pre>"},{"location":"mq/kafka/kf_03/#37","title":"3.7 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u6570\u636e\u53bb\u91cd","text":""},{"location":"mq/kafka/kf_03/#371","title":"3.7.1 \u6570\u636e\u4f20\u9012\u8bed\u4e49","text":""},{"location":"mq/kafka/kf_03/#372","title":"3.7.2 \u5e42\u7b49\u6027","text":"<p>1\uff09\u5e42\u7b49\u6027\u539f\u7406</p> <p></p> <p>2\uff09\u5982\u4f55\u4f7f\u7528\u5e42\u7b49\u6027</p> <p>\u5f00\u542f\u53c2\u6570 <code>enable.idempotence</code>  \u9ed8\u8ba4\u4e3a true\uff0cfalse \u5173\u95ed\u3002</p>"},{"location":"mq/kafka/kf_03/#373","title":"3.7.3 \u751f\u4ea7\u8005\u4e8b\u52a1","text":"<p>1\uff09Kafka\u4e8b\u52a1\u4ecb\u7ecd</p> <p>0.11 \u7248\u672c\u7684 Kafka \u540c\u65f6\u5f15\u5165\u4e86\u4e8b\u52a1\u7684\u7279\u6027\uff0c\u4e3a\u4e86\u5b9e\u73b0\u8de8\u5206\u533a\u8de8\u4f1a\u8bdd\u7684\u4e8b\u52a1\uff0c\u9700\u8981\u5f15\u5165\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 Transaction ID\uff0c\u5e76\u5c06 Producer \u83b7\u5f97\u7684 PID \u548c Transaction ID \u7ed1\u5b9a\u3002\u8fd9\u6837\u5f53 Producer \u91cd\u542f\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u6b63\u5728\u8fdb\u884c\u7684 Transaction ID \u83b7\u5f97\u539f\u6765\u7684 PID\u3002</p> <p>\u4e3a\u4e86\u7ba1\u7406 Transaction\uff0cKafka \u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u7ec4\u4ef6 Transaction Coordinator\u3002Producer \u5c31\u662f\u901a\u8fc7\u548c Transaction Coordinator \u4ea4\u4e92\u83b7\u5f97 Transaction ID \u5bf9\u5e94\u7684\u4efb\u52a1\u72b6\u6001\u3002Transaction Coordinator \u8fd8\u8d1f\u8d23\u5c06\u4e8b\u52a1\u6240\u6709\u5199\u5165 Kafka \u7684\u4e00\u4e2a\u5185\u90e8 Topic\uff0c\u8fd9\u6837\u5373\u4f7f\u6574\u4e2a\u670d\u52a1\u91cd\u542f\uff0c\u7531\u4e8e\u4e8b\u52a1\u72b6\u6001\u5f97\u5230\u4fdd\u5b58\uff0c\u8fdb\u884c\u4e2d\u7684\u4e8b\u52a1\u72b6\u6001\u53ef\u4ee5\u5f97\u5230\u6062\u590d\uff0c\u4ece\u800c\u7ee7\u7eed\u8fdb\u884c\u3002</p> <p>\u6ce8\u610f</p> <p>\u63d0\u524d\u5f00\u542f\u5e42\u7b49\u6027!!!</p>"},{"location":"mq/kafka/kf_03/#38","title":"3.8 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u6570\u636e\u6709\u5e8f","text":""},{"location":"mq/kafka/kf_03/#39","title":"3.9 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u6570\u636e\u4e71\u5e8f","text":""},{"location":"mq/kafka/kf_04/","title":"\u7b2c4\u7ae0 Kafka Broker","text":""},{"location":"mq/kafka/kf_04/#41-kafka-broker","title":"4.1 Kafka Broker\u5de5\u4f5c\u6d41\u7a0b","text":""},{"location":"mq/kafka/kf_04/#411-zookeeperkafka","title":"4.1.1 Zookeeper\u5b58\u50a8\u7684Kafka\u4fe1\u606f","text":"<p>\uff081\uff09\u542f\u52a8 Zookeeper \u5ba2\u6237\u7aef\u3002</p> <pre><code>bin/zkCli.sh\n</code></pre> <p>\uff082\uff09\u901a\u8fc7 ls \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b Kafka \u76f8\u5173\u4fe1\u606f\u3002</p> <pre><code>[zk: localhost:2181(CONNECTED) 2] ls /kafka\n</code></pre> <p></p>"},{"location":"mq/kafka/kf_04/#412-kafka-broker","title":"4.1.2 Kafka Broker\u603b\u4f53\u5de5\u4f5c\u6d41\u7a0b","text":"<p>1\uff09\u6a21\u62df Kafka \u4e0a\u4e0b\u7ebf\uff0cZookeeper \u4e2d\u6570\u636e\u53d8\u5316</p> <p>\u200b   \uff081\uff09\u67e5\u770b /kafka/brokers/ids \u8def\u5f84\u4e0a\u7684\u8282\u70b9\u3002</p> <pre><code>[zk: localhost:2181(CONNECTED) 2] ls /kafka/brokers/ids\n</code></pre> <p>\u200b   \uff082\uff09\u67e5\u770b /kafka/controller \u8def\u5f84\u4e0a\u7684\u6570\u636e\u3002</p> <pre><code>[zk: localhost:2181(CONNECTED) 15] get /kafka/controller\n</code></pre> <p>\u200b   \uff083\uff09\u67e5\u770b /kafka/brokers/topics/first/partitions/0/state \u8def\u5f84\u4e0a\u7684\u6570\u636e\u3002</p> <pre><code>[zk: localhost:2181(CONNECTED) 16] get /kafka/brokers/topics/first/partitions/0/state\n</code></pre> <p>\uff084\uff09\u505c\u6b62 hadoop104 \u4e0a\u7684 Kafka\u3002</p> <pre><code>bin/kafka-server-stop.sh\n</code></pre> <p>\uff085\uff09\u518d\u6b21\u67e5\u770b /kafka/brokers/ids \u8def\u5f84\u4e0a\u7684\u8282\u70b9\u3002</p> <pre><code>[zk: localhost:2181(CONNECTED) 3] ls /kafka/brokers/ids\n</code></pre> <p>\uff086\uff09\u518d\u6b21\u67e5\u770b /kafka/controller \u8def\u5f84\u4e0a\u7684\u6570\u636e\u3002</p> <pre><code>[zk: localhost:2181(CONNECTED) 15] get /kafka/controller\n</code></pre> <p>\uff087\uff09\u518d\u6b21\u67e5\u770b /kafka/brokers/topics/first/partitions/0/state \u8def\u5f84\u4e0a\u7684\u6570\u636e\u3002</p> <pre><code>[zk: localhost:2181(CONNECTED) 16] get /kafka/brokers/topics/first/partitions/0/state\n</code></pre> <p>\uff088\uff09\u542f\u52a8 hadoop104 \u4e0a\u7684 Kafka\u3002 <pre><code>bin/kafka-server-start.sh -daemon ./config/server.properties\n</code></pre></p> <p>\uff089\uff09\u518d\u6b21\u89c2\u5bdf\uff081\uff09\u3001\uff082\uff09\u3001\uff083\uff09\u6b65\u9aa4\u4e2d\u7684\u5185\u5bb9\u3002</p>"},{"location":"mq/kafka/kf_04/#413-broker","title":"4.1.3 Broker\u91cd\u8981\u53c2\u6570","text":"\u53c2\u6570\u540d\u79f0 \u63cf\u8ff0 replica.lag.time.max.ms ISR \u4e2d\uff0c\u5982\u679c Follower \u957f\u65f6\u95f4\u672a\u5411 Leader \u53d1\u9001\u901a\u4fe1\u8bf7\u6c42\u6216\u540c\u6b65\u6570\u636e\uff0c\u5219\u8be5 Follower \u5c06\u88ab\u8e22\u51fa ISR\u3002\u8be5\u65f6\u95f4\u9608\u503c\uff0c\u9ed8\u8ba4 30s\u3002 auto.leader.rebalance.enable \u9ed8\u8ba4\u662f true\u3002 \u81ea\u52a8 Leader Partition \u5e73\u8861\u3002 leader.imbalance.per.broker.percentage \u9ed8\u8ba4\u662f 10%\u3002\u6bcf\u4e2a broker \u5141\u8bb8\u7684\u4e0d\u5e73\u8861\u7684 leader \u7684\u6bd4\u7387\u3002\u5982\u679c\u6bcf\u4e2a broker \u8d85\u8fc7\u4e86\u8fd9\u4e2a\u503c\uff0c\u63a7\u5236\u5668\u4f1a\u89e6\u53d1 leader \u7684\u5e73\u8861\u3002 leader.imbalance.check.interval.seconds \u9ed8\u8ba4\u503c 300 \u79d2\u3002\u68c0\u67e5 leader \u8d1f\u8f7d\u662f\u5426\u5e73\u8861\u7684\u95f4\u9694\u65f6\u95f4\u3002 log.segment.bytes Kafka \u4e2d log \u65e5\u5fd7\u662f\u5206\u6210\u4e00\u5757\u5757\u5b58\u50a8\u7684\uff0c\u6b64\u914d\u7f6e\u662f\u6307 log \u65e5\u5fd7\u5212\u5206\u6210\u5757\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c 1G\u3002 log.index.interval.bytes \u9ed8\u8ba4 4kb\uff0cKafka \u91cc\u9762\u6bcf\u5f53\u5199\u5165\u4e86 4kb \u5927\u5c0f\u7684\u65e5\u5fd7\uff08.log\uff09\uff0c\u7136\u540e\u5c31\u5f80 index \u6587\u4ef6\u91cc\u9762\u8bb0\u5f55\u4e00\u4e2a\u7d22\u5f15\u3002 log.retention.hours Kafka \u4e2d\u6570\u636e\u4fdd\u5b58\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4 7\u5929\u3002 log.retention.minutes Kafka \u4e2d\u6570\u636e\u4fdd\u5b58\u7684\u65f6\u95f4\uff0c\u5206\u949f\u7ea7\u522b\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002 log.retention.ms Kafka \u4e2d\u6570\u636e\u4fdd\u5b58\u7684\u65f6\u95f4\uff0c\u6beb\u79d2\u7ea7\u522b\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002 log.retention.check.interval.ms \u68c0\u67e5\u6570\u636e\u662f\u5426\u4fdd\u5b58\u8d85\u65f6\u7684\u95f4\u9694\uff0c\u9ed8\u8ba4\u662f 5 \u5206\u949f\u3002 log.retention.bytes \u9ed8\u8ba4\u7b49\u4e8e -1\uff0c\u8868\u793a\u65e0\u7a77\u5927\u3002\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6240\u6709\u65e5\u5fd7\u603b\u5927\u5c0f\uff0c\u5220\u9664\u6700\u65e9\u7684 segment\u3002 log.cleanup.policy \u9ed8\u8ba4\u662f delete\uff0c\u8868\u793a\u6240\u6709\u6570\u636e\u542f\u7528\u5220\u9664\u7b56\u7565\uff1b\u5982\u679c\u8bbe\u7f6e\u503c\u4e3a compact\uff0c\u8868\u793a\u6240\u6709\u6570\u636e\u542f\u7528\u538b\u7f29\u7b56\u7565\u3002 num.io.threads \u9ed8\u8ba4\u662f 8\u3002\u8d1f\u8d23\u5199\u78c1\u76d8\u7684\u7ebf\u7a0b\u6570\u3002\u8fd9\u4e2a\u53c2\u6570\u503c\u8981\u5360\u603b\u6838\u6570\u7684 50%\u3002 num.replica.fetchers \u526f\u672c\u62c9\u53d6\u7ebf\u7a0b\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u5360\u603b\u6838\u6570\u7684 50% \u7684 \u2153 num.network.threads \u9ed8\u8ba4\u662f 3\u3002\u6570\u636e\u4f20\u8f93\u7ebf\u7a0b\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u5360\u603b\u6838\u6570\u7684 50% \u7684 \u2154 \u3002 log.flush.interval.messages \u5f3a\u5236\u9875\u7f13\u5b58\u5237\u5199\u5230\u78c1\u76d8\u7684\u6761\u6570\uff0c\u9ed8\u8ba4\u662f long \u7684\u6700\u5927\u503c\uff0c9223372036854775807\u3002\u4e00\u822c\u4e0d\u5efa\u8bae\u4fee\u6539\uff0c\u4ea4\u7ed9\u7cfb\u7edf\u81ea\u5df1\u7ba1\u7406\u3002 log.flush.interval.ms \u6bcf\u9694\u591a\u4e45\uff0c\u5237\u6570\u636e\u5230\u78c1\u76d8\uff0c\u9ed8\u8ba4\u662f null\u3002\u4e00\u822c\u4e0d\u5efa\u8bae\u4fee\u6539\uff0c\u4ea4\u7ed9\u7cfb\u7edf\u81ea\u5df1\u7ba1\u7406\u3002"},{"location":"mq/kafka/kf_04/#42-kafka","title":"4.2 Kafka \u526f\u672c","text":""},{"location":"mq/kafka/kf_04/#421","title":"4.2.1 \u526f\u672c\u57fa\u672c\u4fe1\u606f","text":"<p>\uff081\uff09Kafka \u526f\u672c\u4f5c\u7528\uff1a\u63d0\u9ad8\u6570\u636e\u53ef\u9760\u6027\u3002</p> <p>\uff082\uff09Kafka \u9ed8\u8ba4\u526f\u672c 1 \u4e2a\uff0c\u751f\u4ea7\u73af\u5883\u4e00\u822c\u914d\u7f6e\u4e3a 2 \u4e2a\uff0c\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff1b\u592a\u591a\u526f\u672c\u4f1a\u589e\u52a0\u78c1\u76d8\u5b58\u50a8\u7a7a\u95f4\uff0c\u589e\u52a0\u7f51\u7edc\u4e0a\u6570\u636e\u4f20\u8f93\uff0c\u964d\u4f4e\u6548\u7387\u3002</p> <p>\uff083\uff09Kafka \u4e2d\u526f\u672c\u5206\u4e3a\uff1aLeader \u548c Follower\u3002Kafka \u751f\u4ea7\u8005\u53ea\u4f1a\u628a\u6570\u636e\u53d1\u5f80 Leader\uff0c\u7136\u540e Follower \u627e Leader \u8fdb\u884c\u540c\u6b65\u6570\u636e\u3002</p> <p>\uff084\uff09Kafka \u5206\u533a\u4e2d\u7684\u6240\u6709\u526f\u672c\u7edf\u79f0\u4e3a AR\uff08Assigned Repllicas\uff09\u3002</p> \\[ AR = ISR + OSR \\] <ul> <li>ISR\uff1a\u8868\u793a\u548c Leader \u4fdd\u6301\u540c\u6b65\u7684 Follower \u548c Leader \u96c6\u5408\u3002\u5982\u679c Follower \u957f\u65f6\u95f4\u672a\u5411 Leader \u53d1\u9001\u901a\u4fe1\u8bf7\u6c42\u6216\u540c\u6b65\u6570\u636e\uff0c\u5219\u8be5 Follower \u5c06\u88ab\u8e22\u51fa ISR\u3002\u8be5\u65f6\u95f4\u9608\u503c\u7531 replica.lag.time.max.ms \u53c2\u6570\u8bbe\u5b9a\uff0c\u9ed8\u8ba4 30s\u3002Leader \u53d1\u751f\u6545\u969c\u4e4b\u540e\uff0c\u5c31\u4f1a\u4ece ISR \u4e2d\u9009\u4e3e\u65b0\u7684 Leader\u3002</li> <li>OSR\uff1a\u8868\u793a Follower \u4e0e Leader \u526f\u672c\u540c\u6b65\u65f6\uff0c\u5ef6\u8fdf\u8fc7\u591a\u7684\u526f\u672c\u3002</li> </ul>"},{"location":"mq/kafka/kf_04/#422-leader","title":"4.2.2 Leader\u9009\u4e3e\u6d41\u7a0b","text":"<p>Kafka \u96c6\u7fa4\u4e2d\u6709\u4e00\u4e2a broker \u7684 Controller \u4f1a\u88ab\u9009\u4e3e\u4e3a Controller  Leader\uff0c\u8d1f\u8d23\u7ba1\u7406\u96c6\u7fa4 broker \u7684\u4e0a\u4e0b\u7ebf\uff0c\u6240\u6709 topic \u7684\u5206\u533a\u526f\u672c\u5206\u914d\u548c Leader \u9009\u4e3e\u7b49\u5de5\u4f5c\u3002</p> <p>Controller \u7684\u4fe1\u606f\u540c\u6b65\u5de5\u4f5c\u662f\u4f9d\u8d56\u4e8e Zookeeper \u7684\u3002</p> <p></p> <p>\u5047\u8bbe\u6709 hadoop102\u3001hadoop103\u3001hadoop104\u3001hadoop105 \u7b49 4 \u53f0\u670d\u52a1\u5668\u3002</p> <p>\uff081\uff09\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 topic\uff0c4 \u4e2a\u5206\u533a\uff0c4 \u4e2a\u526f\u672c</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --create --topic atguigu1 --partitions 4 --replication-factor 4\n</code></pre> <p>\uff082\uff09\u67e5\u770b Leader \u5206\u5e03\u60c5\u51b5</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --describe --topic atguigu1\n</code></pre> <p>\uff083\uff09\u505c\u6b62\u6389 hadoop105 \u7684 Kafka \u8fdb\u7a0b\uff0c\u5e76\u67e5\u770b Leader \u5206\u533a\u60c5\u51b5</p> <pre><code>bin/kafka-server-stop.sh\n</code></pre> <p>\uff084\uff09\u505c\u6b62\u6389 hadoop104 \u7684 Kafka \u8fdb\u7a0b\uff0c\u5e76\u67e5\u770b Leader \u5206\u533a\u60c5\u51b5</p> <pre><code>bin/kafka-server-stop.sh\n</code></pre> <p>\uff085\uff09\u542f\u52a8 hadoop105 \u7684 Kafka \u8fdb\u7a0b\uff0c\u5e76\u67e5\u770b Leader \u5206\u533a\u60c5\u51b5</p> <pre><code>bin/kafka-server-start.sh -daemon config/server.properties\n</code></pre> <p>\uff086\uff09\u542f\u52a8 hadoop104 \u7684 Kafka \u8fdb\u7a0b\uff0c\u5e76\u67e5\u770b Leader \u5206\u533a\u60c5\u51b5</p> <pre><code>bin/kafka-server-start.sh -daemon config/server.properties\n</code></pre> <p>\uff087\uff09\u505c\u6b62\u6389 hadoop103 \u7684 Kafka \u8fdb\u7a0b\uff0c\u5e76\u67e5\u770b Leader \u5206\u533a\u60c5\u51b5</p> <pre><code>bin/kafka-server-stop.sh\n</code></pre>"},{"location":"mq/kafka/kf_04/#423-leaderfollower","title":"4.2.3 Leader\u548cFollower\u6545\u969c\u5904\u7406\u7ec6\u8282","text":""},{"location":"mq/kafka/kf_04/#43","title":"4.3 \u6587\u4ef6\u5b58\u50a8","text":""},{"location":"mq/kafka/kf_04/#431","title":"4.3.1 \u6587\u4ef6\u5b58\u50a8\u673a\u5236","text":"<p>1\uff09Topic \u6570\u636e\u7684\u5b58\u50a8\u673a\u5236</p> <p></p> <p>\u601d\u8003</p> <p>Topic \u6570\u636e\u5230\u5e95\u5b58\u50a8\u5728\u4ec0\u4e48\u4f4d\u7f6e\uff1f</p> <p>\uff081\uff09\u542f\u52a8\u751f\u4ea7\u8005\uff0c\u5e76\u53d1\u9001\u6d88\u606f\u3002</p> <pre><code>bin/kafka-console-producer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\uff082\uff09\u67e5\u770b hadoop102\uff08\u6216\u8005 hadoop103\u3001hadoop104 \uff09\u7684 /opt/module/kafka/datas/first-1\uff08first-0\u3001first-2\uff09\u8def\u5f84\u4e0a\u7684\u6587\u4ef6\u3002</p> <pre><code>$ ls\n\n00000000000000000092.index\n00000000000000000092.log\n00000000000000000092.snapshot\n00000000000000000092.timeindex\nleader-epoch-checkpoint\npartition.metadata\n</code></pre> <p>\uff083\uff09\u76f4\u63a5\u67e5\u770b log \u65e5\u5fd7\uff0c\u53d1\u73b0\u662f\u4e71\u7801\u3002</p> <p>\uff084\uff09\u901a\u8fc7\u5de5\u5177\u67e5\u770b index \u548c log \u4fe1\u606f\u3002</p> <pre><code>kafka-run-class.sh kafka.tools.DumpLogSegments --files ./00000000000000000000.index </code></pre> <p>3\uff09index \u6587\u4ef6\u548c log \u6587\u4ef6\u8be6\u89e3</p> <p></p> <p>\u8bf4\u660e\uff1a\u65e5\u5fd7\u5b58\u50a8\u53c2\u6570\u914d\u7f6e</p> \u53c2\u6570 \u63cf\u8ff0 log.segment.bytes Kafka\u4e2dlog\u65e5\u5fd7\u662f\u5206\u6210\u4e00\u5757\u5757\u5b58\u50a8\u7684\uff0c\u6b64\u914d\u7f6e\u662f\u6307log\u65e5\u5fd7\u5212\u5206 \u6210\u5757\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c1G\u3002 log.index.interval.bytes \u9ed8\u8ba44kb\uff0ckafka\u91cc\u9762\u6bcf\u5f53\u5199\u5165\u4e864kb\u5927\u5c0f\u7684\u65e5\u5fd7\uff08.log\uff09\uff0c\u7136\u540e\u5c31\u5f80index\u6587\u4ef6\u91cc\u9762\u8bb0\u5f55\u4e00\u4e2a\u7d22\u5f15\u3002 \u7a00\u758f\u7d22\u5f15\u3002"},{"location":"mq/kafka/kf_04/#432","title":"4.3.2 \u6587\u4ef6\u6e05\u7406\u7b56\u7565","text":"<p>Kafka \u4e2d\u9ed8\u8ba4\u7684\u65e5\u5fd7\u4fdd\u5b58\u65f6\u95f4\u4e3a 7 \u5929\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u5982\u4e0b\u53c2\u6570\u4fee\u6539\u4fdd\u5b58\u65f6\u95f4\u3002</p> <ul> <li><code>log.retention.hours</code>\uff1a\u6700\u4f4e\u4f18\u5148\u7ea7\u5c0f\u65f6\uff0c\u9ed8\u8ba4 7 \u5929\u3002</li> <li><code>log.retention.minutes</code>\uff1a\u5206\u949f</li> <li><code>log.retention.ms</code>\uff1a\u6700\u9ad8\u4f18\u5148\u7ea7\u6beb\u79d2</li> <li><code>log.retention.check.interval.ms</code>\uff1a\u8d1f\u8d23\u8bbe\u7f6e\u68c0\u67e5\u5468\u671f\uff0c\u9ed8\u8ba45\u5206\u949f</li> </ul> <p>Question</p> <p>\u90a3\u4e48\u65e5\u5fd7\u4e00\u65e6\u8d85\u8fc7\u4e86\u8bbe\u7f6e\u7684\u65f6\u95f4\uff0c\u600e\u4e48\u5904\u7406\u5462\uff1f</p> <p>Kafka \u4e2d\u63d0\u4f9b\u7684\u65e5\u5fd7\u6e05\u7406\u7b56\u7565\u6709 delete \u548c compact \u4e24\u79cd\u3002</p> <p>1\uff09delete \u65e5\u5fd7\u5220\u9664\uff1a\u5c06\u8fc7\u671f\u6570\u636e\u5220\u9664</p> <p><code>log.cleanup.policy = delete</code>    \u6240\u6709\u6570\u636e\u542f\u7528\u5220\u9664\u7b56\u7565</p> <p>\uff081\uff09\u57fa\u4e8e\u65f6\u95f4\uff1a\u9ed8\u8ba4\u6253\u5f00\u3002\u4ee5 segment \u4e2d\u6240\u6709\u8bb0\u5f55\u4e2d\u7684\u6700\u5927\u65f6\u95f4\u6233\u4f5c\u4e3a\u8be5\u6587\u4ef6\u65f6\u95f4\u6233\u3002</p> <p>\uff082\uff09\u57fa\u4e8e\u5927\u5c0f\uff1a\u9ed8\u8ba4\u5173\u95ed\u3002\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6240\u6709\u65e5\u5fd7\u603b\u5927\u5c0f\uff0c\u5220\u9664\u6700\u65e9\u7684 segment\u3002</p> <p><code>log.retention.bytes</code> \u9ed8\u8ba4\u7b49\u4e8e -1\uff0c\u8868\u793a\u65e0\u7a77\u5927\u3002</p> <p>\u601d\u8003</p> <p>\u5982\u679c\u4e00\u4e2a segment \u4e2d\u6709\u4e00\u90e8\u5206\u6570\u636e\u8fc7\u671f\uff0c\u4e00\u90e8\u5206\u6ca1\u6709\u8fc7\u671f\uff0c\u600e\u4e48\u5904\u7406\uff1f</p> <p>2\uff09compact \u65e5\u5fd7\u538b\u7f29</p> <p></p>"},{"location":"mq/kafka/kf_04/#44","title":"4.4 \u9ad8\u6548\u8bfb\u5199\u6570\u636e","text":"<p>1\uff09Kafka \u672c\u8eab\u662f\u5206\u5e03\u5f0f\u96c6\u7fa4\uff0c\u53ef\u4ee5\u91c7\u7528\u5206\u533a\u6280\u672f\uff0c\u5e76\u884c\u5ea6\u9ad8</p> <p>2\uff09\u8bfb\u6570\u636e\u91c7\u7528\u7a00\u758f\u7d22\u5f15\uff0c\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u8981\u6d88\u8d39\u7684\u6570\u636e</p> <p>3\uff09\u987a\u5e8f\u5199\u78c1\u76d8</p> <p>Kafka \u7684 producer \u751f\u4ea7\u6570\u636e\uff0c\u8981\u5199\u5165\u5230 log \u6587\u4ef6\u4e2d\uff0c\u5199\u7684\u8fc7\u7a0b\u662f\u4e00\u76f4\u8ffd\u52a0\u5230\u6587\u4ef6\u672b\u7aef\uff0c\u4e3a\u987a\u5e8f\u5199\u3002\u5b98\u7f51\u6709\u6570\u636e\u8868\u660e\uff0c\u540c\u6837\u7684\u78c1\u76d8\uff0c\u987a\u5e8f\u5199\u80fd\u5230 600M/s\uff0c\u800c\u968f\u673a\u5199\u53ea\u6709 100K/s\u3002\u8fd9\u4e0e\u78c1\u76d8\u7684\u673a\u68b0\u673a\u6784\u6709\u5173\uff0c\u987a\u5e8f\u5199\u4e4b\u6240\u4ee5\u5feb\uff0c\u662f\u56e0\u4e3a\u5176\u7701\u53bb\u4e86\u5927\u91cf\u78c1\u5934\u5bfb\u5740\u7684\u65f6\u95f4\u3002</p> <p></p> <p>4\uff09\u9875\u7f13\u5b58 + \u96f6\u62f7\u8d1d\u6280\u672f</p> <p></p> \u53c2\u6570 \u63cf\u8ff0 log.flush.interval.messages \u5f3a\u5236\u9875\u7f13\u5b58\u5237\u5199\u5230\u78c1\u76d8\u7684\u6761\u6570\uff0c\u9ed8\u8ba4\u662flong\u7684\u6700\u5927\u503c\uff0c9223372036854775807\u3002\u4e00\u822c\u4e0d\u5efa\u8bae\u4fee\u6539\uff0c\u4ea4\u7ed9\u7cfb\u7edf\u81ea\u5df1\u7ba1\u7406\u3002 log.flush.interval.ms \u6bcf\u9694\u591a\u4e45\uff0c\u5237\u6570\u636e\u5230\u78c1\u76d8\uff0c\u9ed8\u8ba4\u662fnull\u3002\u4e00\u822c\u4e0d\u5efa\u8bae\u4fee\u6539\uff0c\u4ea4\u7ed9\u7cfb\u7edf\u81ea\u5df1\u7ba1\u7406\u3002"},{"location":"mq/kafka/kf_05/","title":"\u7b2c5\u7ae0 Kafka\u6d88\u8d39\u8005","text":""},{"location":"mq/kafka/kf_05/#51-kafka","title":"5.1 Kafka\u6d88\u8d39\u65b9\u5f0f","text":""},{"location":"mq/kafka/kf_05/#52-kafka","title":"5.2 Kafka\u6d88\u8d39\u8005\u5de5\u4f5c\u6d41\u7a0b","text":""},{"location":"mq/kafka/kf_05/#521","title":"5.2.1 \u6d88\u8d39\u8005\u603b\u4f53\u5de5\u4f5c\u6d41\u7a0b","text":""},{"location":"mq/kafka/kf_05/#522","title":"5.2.2 \u6d88\u8d39\u8005\u7ec4\u539f\u7406","text":""},{"location":"mq/kafka/kf_05/#523","title":"5.2.3 \u6d88\u8d39\u8005\u91cd\u8981\u53c2\u6570","text":"\u53c2\u6570\u540d\u79f0 \u63cf\u8ff0 bootstrap.servers \u5411 Kafka \u96c6\u7fa4\u5efa\u7acb\u521d\u59cb\u8fde\u63a5\u7528\u5230\u7684 host/port \u5217\u8868\u3002 key.deserializer\u548cvalue.deserializer \u6307\u5b9a\u63a5\u6536\u6d88\u606f\u7684 key \u548c value \u7684\u53cd\u5e8f\u5217\u5316\u7c7b\u578b\u3002\u4e00\u5b9a\u8981\u5199\u5168\u7c7b\u540d\u3002 group.id \u6807\u8bb0\u6d88\u8d39\u8005\u6240\u5c5e\u7684\u6d88\u8d39\u8005\u7ec4\u3002 enable.auto.commit \u9ed8\u8ba4\u503c\u4e3atrue\uff0c\u6d88\u8d39\u8005\u4f1a\u81ea\u52a8\u5468\u671f\u6027\u5730\u5411\u670d\u52a1\u5668\u63d0\u4ea4\u504f\u79fb\u91cf\u3002 auto.commit.interval.ms \u5982\u679c\u8bbe\u7f6e\u4e86 enable.auto.commit \u7684\u503c\u4e3a true\uff0c \u5219\u8be5\u503c\u5b9a\u4e49\u4e86\u6d88\u8d39\u8005\u504f\u79fb\u91cf\u5411 Kafka \u63d0\u4ea4\u7684\u9891\u7387\uff0c\u9ed8\u8ba4 5s\u3002 auto.offset.reset \u5f53 Kafka \u4e2d\u6ca1\u6709\u521d\u59cb\u504f\u79fb\u91cf\u6216\u5f53\u524d\u504f\u79fb\u91cf\u5728\u670d\u52a1\u5668\u4e2d\u4e0d\u5b58\u5728\uff08\u5982\uff0c\u6570\u636e\u88ab\u5220\u9664\u4e86\uff09\uff0c\u8be5\u5982\u4f55\u5904\u7406\uff1f  earliest\uff1a\u81ea\u52a8\u91cd\u7f6e\u504f\u79fb\u91cf\u5230\u6700\u65e9\u7684\u504f\u79fb\u91cf\u3002 latest\uff1a\u9ed8\u8ba4\uff0c\u81ea\u52a8\u91cd\u7f6e\u504f\u79fb\u91cf\u4e3a\u6700\u65b0\u7684\u504f\u79fb\u91cf\u3002  none\uff1a\u5982\u679c\u6d88\u8d39\u7ec4\u539f\u6765\u7684\uff08previous\uff09\u504f\u79fb\u91cf\u4e0d\u5b58\u5728\uff0c\u5219\u5411\u6d88\u8d39\u8005\u629b\u5f02\u5e38\u3002  anything\uff1a\u5411\u6d88\u8d39\u8005\u629b\u5f02\u5e38\u3002 offsets.topic.num.partitions __consumer_offsets\u7684\u5206\u533a\u6570\uff0c\u9ed8\u8ba4\u662f 50 \u4e2a\u5206\u533a\u3002 heartbeat.interval.ms Kafka \u6d88\u8d39\u8005\u548c coordinator \u4e4b\u95f4\u7684\u5fc3\u8df3\u65f6\u95f4\uff0c\u9ed8\u8ba4 3s\u3002\u8be5\u6761\u76ee\u7684\u503c\u5fc5\u987b\u5c0f\u4e8e  session.timeout.ms \uff0c\u4e5f\u4e0d\u5e94\u8be5\u9ad8\u4e8e session.timeout.ms \u7684\u2153\u3002 session.timeout.ms Kafka \u6d88\u8d39\u8005\u548c coordinator \u4e4b\u95f4\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 45s\u3002\u8d85\u8fc7\u8be5\u503c\uff0c\u8be5\u6d88\u8d39\u8005\u88ab\u79fb\u9664\uff0c\u6d88\u8d39\u8005\u7ec4\u6267\u884c\u518d\u5e73\u8861\u3002 max.poll.interval.ms \u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\u7684\u6700\u5927\u65f6\u957f\uff0c\u9ed8\u8ba4\u662f 5 \u5206\u949f\u3002\u8d85\u8fc7\u8be5\u503c\uff0c\u8be5\u6d88\u8d39\u8005\u88ab\u79fb\u9664\uff0c\u6d88\u8d39\u8005\u7ec4\u6267\u884c\u518d\u5e73\u8861\u3002 fetch.min.bytes \u9ed8\u8ba4 1 \u4e2a\u5b57\u8282\u3002\u6d88\u8d39\u8005\u83b7\u53d6\u670d\u52a1\u5668\u7aef\u4e00\u6279\u6d88\u606f\u6700\u5c0f\u7684\u5b57\u8282\u6570\u3002 fetch.max.wait.ms \u9ed8\u8ba4 500 ms\u3002\u5982\u679c\u6ca1\u6709\u4ece\u670d\u52a1\u5668\u7aef\u83b7\u53d6\u5230\u4e00\u6279\u6570\u636e\u7684\u6700\u5c0f\u5b57\u8282\u6570\u3002\u8be5\u65f6\u95f4\u5230\uff0c\u4ecd\u7136\u4f1a\u8fd4\u56de\u6570\u636e\u3002 fetch.max.bytes \u9ed8\u8ba4 Default:    52428800\uff0850 m\uff09\u3002\u6d88\u8d39\u8005\u83b7\u53d6\u670d\u52a1\u5668\u7aef\u4e00\u6279\u6d88\u606f\u6700\u5927\u7684\u5b57\u8282\u6570\u3002\u5982\u679c\u670d\u52a1\u5668\u7aef\u4e00\u6279\u6b21\u7684\u6570\u636e\u5927\u4e8e\u8be5\u503c\uff0850m\uff09\u4ecd\u7136\u53ef\u4ee5\u62c9\u53d6\u56de\u6765\u8fd9\u6279\u6570\u636e\uff0c\u56e0\u6b64\uff0c\u8fd9\u4e0d\u662f\u4e00\u4e2a\u7edd\u5bf9\u6700\u5927\u503c\u3002\u4e00\u6279\u6b21\u7684\u5927\u5c0f\u53d7 message.max.bytes \uff08broker config\uff09\u6216 max.message.bytes \uff08topic config\uff09\u5f71\u54cd\u3002 max.poll.records \u4e00\u6b21 poll \u62c9\u53d6\u6570\u636e\u8fd4\u56de\u6d88\u606f\u7684\u6700\u5927\u6761\u6570\uff0c\u9ed8\u8ba4\u662f 500\u6761\u3002"},{"location":"mq/kafka/kf_05/#53-api","title":"5.3 \u6d88\u8d39\u8005API","text":""},{"location":"mq/kafka/kf_05/#531","title":"5.3.1 \u72ec\u7acb\u6d88\u8d39\u8005\u6848\u4f8b\uff08\u8ba2\u9605\u4e3b\u9898\uff09","text":"<p>1\uff09\u9700\u6c42\uff1a</p> <p>\u200b   \u521b\u5efa\u4e00\u4e2a\u72ec\u7acb\u6d88\u8d39\u8005\uff0c\u6d88\u8d39 first \u4e3b\u9898\u4e2d\u6570\u636e\u3002</p> <p></p> <p>\u6ce8\u610f</p> <p>\u5728\u6d88\u8d39\u8005 API \u4ee3\u7801\u4e2d\u5fc5\u987b\u914d\u7f6e\u6d88\u8d39\u8005\u7ec4 id\u3002\u547d\u4ee4\u884c\u542f\u52a8\u6d88\u8d39\u8005\u4e0d\u586b\u5199\u6d88\u8d39\u8005\u7ec4 id \u4f1a\u88ab\u81ea\u52a8\u586b\u5199\u968f\u673a\u7684\u6d88\u8d39\u8005\u7ec4 id\u3002</p> <p>2\uff09\u5b9e\u73b0\u6b65\u9aa4</p> <p>\u200b   \uff081\uff09\u521b\u5efa\u5305\u540d\uff1acom.atguigu.kafka.consumer</p> <p>\u200b   \uff082\uff09\u7f16\u5199\u4ee3\u7801</p> <pre><code>package com.atguigu.kafka.consumer;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.kafka.clients.consumer.ConsumerRecords;\nimport org.apache.kafka.clients.consumer.KafkaConsumer;\n\nimport java.time.Duration;\nimport java.util.ArrayList;\nimport java.util.Properties;\n\npublic class CustomConsumer {\n\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u6d88\u8d39\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2.\u7ed9\u6d88\u8d39\u8005\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u53c2\u6570\nproperties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// \u914d\u7f6e\u5e8f\u5217\u5316 \u5fc5\u987b\nproperties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\nproperties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n\n// \u914d\u7f6e\u6d88\u8d39\u8005\u7ec4\uff08\u7ec4\u540d\u4efb\u610f\u8d77\u540d\uff09 \u5fc5\u987b\nproperties.put(ConsumerConfig.GROUP_ID_CONFIG, \"test\");\n\n// \u521b\u5efa\u6d88\u8d39\u8005\u5bf9\u8c61\nKafkaConsumer&lt;String, String&gt; kafkaConsumer = new KafkaConsumer&lt;String, String&gt;(properties);\n\n// \u6ce8\u518c\u8981\u6d88\u8d39\u7684\u4e3b\u9898\uff08\u53ef\u4ee5\u6d88\u8d39\u591a\u4e2a\u4e3b\u9898\uff09\nArrayList&lt;String&gt; topics = new ArrayList&lt;&gt;();\ntopics.add(\"first\");\nkafkaConsumer.subscribe(topics);\n\n// \u62c9\u53d6\u6570\u636e\u6253\u5370\nwhile (true) {\n// \u8bbe\u7f6e1s\u4e2d\u6d88\u8d39\u4e00\u6279\u6570\u636e\nConsumerRecords&lt;String, String&gt; consumerRecords = kafkaConsumer.poll(Duration.ofSeconds(1));\n\n// \u6253\u5370\u6d88\u8d39\u5230\u7684\u6570\u636e\nfor (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) {\nSystem.out.println(consumerRecord);\n}\n}\n}\n}\n</code></pre> <p>3\uff09\u6d4b\u8bd5</p> <p>\uff081\uff09\u5728 IDEA \u4e2d\u6267\u884c\u6d88\u8d39\u8005\u7a0b\u5e8f\u3002</p> <p>\uff082\uff09\u5728 Kafka \u96c6\u7fa4\u63a7\u5236\u53f0\uff0c\u521b\u5efa Kafka \u751f\u4ea7\u8005\uff0c\u5e76\u8f93\u5165\u6570\u636e\u3002</p> <pre><code>bin/kafka-console-producer.sh --bootstrap-server hadoop102:9092 --topic first\n</code></pre> <p>\u200b   \uff083\uff09\u5728 IDEA \u63a7\u5236\u53f0\u89c2\u5bdf\u63a5\u6536\u5230\u7684\u6570\u636e\u3002</p>"},{"location":"mq/kafka/kf_05/#532","title":"5.3.2 \u6d88\u8d39\u8005\u7ec4\u6848\u4f8b","text":"<p>1\uff09\u9700\u6c42\uff1a\u6d4b\u8bd5\u540c\u4e00\u4e2a\u4e3b\u9898\u7684\u5206\u533a\u6570\u636e\uff0c\u53ea\u80fd\u7531\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u4e2d\u7684\u4e00\u4e2a\u6d88\u8d39\u3002 </p> <p></p> <p>2\uff09\u6848\u4f8b\u5b9e\u64cd</p> <p>\u200b   \uff081\uff09\u590d\u5236\u4e00\u4efd\u57fa\u7840\u6d88\u8d39\u8005\u7684\u4ee3\u7801\uff0c\u5728IDEA\u4e2d\u540c\u65f6\u542f\u52a8\uff0c\u5373\u53ef\u542f\u52a8\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u4e2d\u7684\u4e24\u4e2a\u6d88\u8d39\u8005\u3002</p> <pre><code>package com.atguigu.kafka.consumer;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.kafka.clients.consumer.ConsumerRecords;\nimport org.apache.kafka.clients.consumer.KafkaConsumer;\n\nimport java.time.Duration;\nimport java.util.ArrayList;\nimport java.util.Properties;\n\npublic class CustomConsumer1 {\n\npublic static void main(String[] args) {\n\n// 1.\u521b\u5efa\u6d88\u8d39\u8005\u7684\u914d\u7f6e\u5bf9\u8c61\nProperties properties = new Properties();\n\n// 2.\u7ed9\u6d88\u8d39\u8005\u914d\u7f6e\u5bf9\u8c61\u6dfb\u52a0\u53c2\u6570\nproperties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// \u914d\u7f6e\u5e8f\u5217\u5316 \u5fc5\u987b\nproperties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\nproperties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n\n// \u914d\u7f6e\u6d88\u8d39\u8005\u7ec4 \u5fc5\u987b\nproperties.put(ConsumerConfig.GROUP_ID_CONFIG, \"test\");\n\n// \u521b\u5efa\u6d88\u8d39\u8005\u5bf9\u8c61\nKafkaConsumer&lt;String, String&gt; kafkaConsumer = new KafkaConsumer&lt;String, String&gt;(properties);\n\n// \u6ce8\u518c\u4e3b\u9898\nArrayList&lt;String&gt; topics = new ArrayList&lt;&gt;();\ntopics.add(\"first\");\nkafkaConsumer.subscribe(topics);\n\n// \u62c9\u53d6\u6570\u636e\u6253\u5370\nwhile (true) {\n// \u8bbe\u7f6e1s\u4e2d\u6d88\u8d39\u4e00\u6279\u6570\u636e\nConsumerRecords&lt;String, String&gt; consumerRecords = kafkaConsumer.poll(Duration.ofSeconds(1));\n\n// \u6253\u5370\u6d88\u8d39\u5230\u7684\u6570\u636e\nfor (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) {\nSystem.out.println(consumerRecord);\n}\n}\n}\n}\n</code></pre> <p>\u200b   \uff082\uff09\u542f\u52a8\u4ee3\u7801\u4e2d\u7684\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\uff0c\u5728 IDEA \u63a7\u5236\u53f0\u5373\u53ef\u770b\u5230\u4e24\u4e2a\u6d88\u8d39\u8005\u5728\u6d88\u8d39\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\uff08\u5982\u679c\u53ea\u53d1\u751f\u5230\u4e00\u4e2a\u5206\u533a\uff0c\u53ef\u4ee5\u5728\u53d1\u9001\u65f6\u589e\u52a0\u5ef6\u8fdf\u4ee3\u7801 <code>Thread.sleep(2);</code>\uff09\u3002</p> <p>\u200b   \uff083\uff09\u91cd\u65b0\u53d1\u9001\u5230\u4e00\u4e2a\u5168\u65b0\u7684\u4e3b\u9898\u4e2d\uff0c\u7531\u4e8e\u9ed8\u8ba4\u521b\u5efa\u7684\u4e3b\u9898\u5206\u533a\u6570\u4e3a 1\uff0c\u53ef\u4ee5\u770b\u5230\u53ea\u80fd\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u5230\u6570\u636e\u3002</p> <p></p> <p></p>"},{"location":"mq/kafka/kf_05/#54","title":"5.4 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u5206\u533a\u7684\u5206\u914d\u4ee5\u53ca\u518d\u5e73\u8861","text":"\u53c2\u6570\u540d\u79f0 \u63cf\u8ff0 heartbeat.interval.ms Kafka\u6d88\u8d39\u8005\u548c coordinator \u4e4b\u95f4\u7684\u5fc3\u8df3\u65f6\u95f4\uff0c\u9ed8\u8ba4 3s\u3002\u8be5\u6761\u76ee\u7684\u503c\u5fc5\u987b\u5c0f\u4e8e session.timeout.ms\uff0c\u4e5f\u4e0d\u5e94\u8be5\u9ad8\u4e8e session.timeout.ms \u7684\u2153\u3002 session.timeout.ms Kafka \u6d88\u8d39\u8005\u548c coordinator \u4e4b\u95f4\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 45s\u3002\u8d85\u8fc7\u8be5\u503c\uff0c\u8be5\u6d88\u8d39\u8005\u88ab\u79fb\u9664\uff0c\u6d88\u8d39\u8005\u7ec4\u6267\u884c\u518d\u5e73\u8861\u3002 max.poll.interval.ms \u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\u7684\u6700\u5927\u65f6\u957f\uff0c\u9ed8\u8ba4\u662f 5 \u5206\u949f\u3002\u8d85\u8fc7\u8be5\u503c\uff0c\u8be5\u6d88\u8d39\u8005\u88ab\u79fb\u9664\uff0c\u6d88\u8d39\u8005\u7ec4\u6267\u884c\u518d\u5e73\u8861\u3002 partition.assignment.strategy \u6d88\u8d39\u8005\u5206\u533a\u5206\u914d\u7b56\u7565\uff0c\u9ed8\u8ba4\u7b56\u7565\u662f Range +  CooperativeSticky\u3002Kafka \u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u591a\u4e2a\u5206\u533a\u5206\u914d\u7b56\u7565\u3002\u53ef\u4ee5\u9009\u62e9\u7684\u7b56\u7565\u5305\u62ec\uff1aRange\u3001RoundRobin\u3001Sticky\u3001CooperativeSticky"},{"location":"mq/kafka/kf_05/#541-range","title":"5.4.1 Range\u4ee5\u53ca\u518d\u5e73\u8861","text":"<p>1\uff09Range \u5206\u533a\u7b56\u7565\u539f\u7406</p> <p></p> <p>2\uff09Range \u5206\u533a\u5206\u914d\u7b56\u7565\u6848\u4f8b</p> <p>\uff081\uff09\u4fee\u6539\u4e3b\u9898 first \u4e3a 7 \u4e2a\u5206\u533a\u3002</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --alter --topic first --partitions 7\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5206\u533a\u6570\u53ef\u4ee5\u589e\u52a0\uff0c\u4f46\u662f\u4e0d\u80fd\u51cf\u5c11\u3002</p> <p>\uff082\uff09\u590d\u5236 CustomConsumer \u7c7b\uff0c\u521b\u5efa CustomConsumer2\u3002\u8fd9\u6837\u53ef\u4ee5\u7531\u4e09\u4e2a\u6d88\u8d39\u8005 CustomConsumer\u3001CustomConsumer1\u3001CustomConsumer2 \u7ec4\u6210\u6d88\u8d39\u8005\u7ec4\uff0c\u7ec4\u540d\u90fd\u4e3a \u201ctest\u201d\uff0c\u540c\u65f6\u542f\u52a8 3 \u4e2a\u6d88\u8d39\u8005\u3002</p> <p></p> <p>\uff083\uff09\u542f\u52a8 CustomProducer \u751f\u4ea7\u8005\uff0c\u53d1\u9001 500 \u6761\u6d88\u606f\uff0c\u968f\u673a\u53d1\u9001\u5230\u4e0d\u540c\u7684\u5206\u533a\u3002</p> <pre><code>package com.atguigu.kafka.producer;\n\nimport org.apache.kafka.clients.producer.KafkaProducer;\nimport org.apache.kafka.clients.producer.ProducerConfig;\nimport org.apache.kafka.clients.producer.ProducerRecord;\n\nimport java.util.Properties;\n\npublic class CustomProducer {\n\npublic static void main(String[] args) throws InterruptedException {\n\nProperties properties = new Properties();\n\nproperties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\nproperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\nproperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n\nKafkaProducer&lt;String, String&gt; kafkaProducer = new KafkaProducer&lt;&gt;(properties);\n\nfor (int i = 0; i &lt; 7; i++) {\nkafkaProducer.send(new ProducerRecord&lt;&gt;(\"first\", i, \"test\", \"atguigu\"));\n}\n\nkafkaProducer.close();\n}\n}\n</code></pre> <p>\u8bf4\u660e</p> <p>Kafka \u9ed8\u8ba4\u7684\u5206\u533a\u5206\u914d\u7b56\u7565\u5c31\u662f Range + CooperativeSticky\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u4fee\u6539\u7b56\u7565\u3002</p> <p>\uff084\uff09\u89c2\u5bdf 3 \u4e2a\u6d88\u8d39\u8005\u5206\u522b\u6d88\u8d39\u54ea\u4e9b\u5206\u533a\u7684\u6570\u636e\u3002</p> <p></p> <p></p> <p></p> <p>3\uff09Range \u5206\u533a\u5206\u914d\u518d\u5e73\u8861\u6848\u4f8b</p> <p>\uff081\uff09\u505c\u6b62\u6389 0 \u53f7\u6d88\u8d39\u8005\uff0c\u5feb\u901f\u91cd\u65b0\u53d1\u9001\u6d88\u606f\u89c2\u770b\u7ed3\u679c\uff0845 s \u4ee5\u5185\uff0c\u8d8a\u5feb\u8d8a\u597d\uff09\u3002</p> <p>1 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 3\u30014 \u53f7\u5206\u533a\u6570\u636e\u3002</p> <p>2 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 5\u30016 \u53f7\u5206\u533a\u6570\u636e\u3002</p> <p>0 \u53f7\u6d88\u8d39\u8005\u7684\u4efb\u52a1\u4f1a\u6574\u4f53\u88ab\u5206\u914d\u5230 1 \u53f7\u6d88\u8d39\u8005\u6216\u8005 2 \u53f7\u6d88\u8d39\u8005\u3002</p> <p>\u8bf4\u660e</p> <p>0 \u53f7\u6d88\u8d39\u8005\u6302\u6389\u540e\uff0c\u6d88\u8d39\u8005\u7ec4\u9700\u8981\u6309\u7167\u8d85\u65f6\u65f6\u95f4 45s \u6765\u5224\u65ad\u5b83\u662f\u5426\u9000\u51fa\uff0c\u6240\u4ee5\u9700\u8981\u7b49\u5f85\uff0c\u65f6\u95f4\u5230\u4e86 45s \u540e\uff0c\u5224\u65ad\u5b83\u771f\u7684\u9000\u51fa\u5c31\u4f1a\u628a\u4efb\u52a1\u5206\u914d\u7ed9\u5176\u4ed6 broker \u6267\u884c\u3002</p> <p>\uff082\uff09\u518d\u6b21\u91cd\u65b0\u53d1\u9001\u6d88\u606f\u89c2\u770b\u7ed3\u679c\uff0845 s \u4ee5\u540e\uff09\u3002</p> <p>1 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 0\u30011\u30012\u30013 \u53f7\u5206\u533a\u6570\u636e\u3002 2 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 4\u30015\u30016 \u53f7\u5206\u533a\u6570\u636e\u3002</p> <p>\u8bf4\u660e</p> <p>\u6d88\u8d39\u8005 0 \u5df2\u7ecf\u88ab\u8e22\u51fa\u6d88\u8d39\u8005\u7ec4\uff0c\u6240\u4ee5\u91cd\u65b0\u6309\u7167 range \u65b9\u5f0f\u5206\u914d\u3002</p>"},{"location":"mq/kafka/kf_05/#542-roundrobin","title":"5.4.2 RoundRobin\u4ee5\u53ca\u518d\u5e73\u8861","text":"<p>1\uff09RoundRobin \u5206\u533a\u7b56\u7565\u539f\u7406</p> <p></p> <p>2\uff09RoundRobin \u5206\u533a\u5206\u914d\u7b56\u7565\u6848\u4f8b</p> <p>\uff081\uff09\u4f9d\u6b21\u5728 CustomConsumer\u3001CustomConsumer1\u3001CustomConsumer2 \u4e09\u4e2a\u6d88\u8d39\u8005\u4ee3\u7801\u4e2d\u4fee\u6539\u5206\u533a\u5206\u914d\u7b56\u7565\u4e3a RoundRobin\u3002</p> <pre><code>// \u4fee\u6539\u5206\u533a\u5206\u914d\u7b56\u7565\nproperties.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, \"org.apache.kafka.clients.consumer.RoundRobinAssignor\");\n</code></pre> <p>\uff082\uff09\u91cd\u542f 3 \u4e2a\u6d88\u8d39\u8005\uff0c\u91cd\u590d\u53d1\u9001\u6d88\u606f\u7684\u6b65\u9aa4\uff0c\u89c2\u5bdf\u5206\u533a\u7ed3\u679c\u3002</p> <p></p> <p></p> <p></p> <p>3\uff09RoundRobin \u5206\u533a\u5206\u914d\u518d\u5e73\u8861\u6848\u4f8b</p> <p>\uff081\uff09\u505c\u6b62\u6389 0 \u53f7\u6d88\u8d39\u8005\uff0c\u5feb\u901f\u91cd\u65b0\u53d1\u9001\u6d88\u606f\u89c2\u770b\u7ed3\u679c\uff0845 s \u4ee5\u5185\uff0c\u8d8a\u5feb\u8d8a\u597d\uff09\u3002 1 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 2\u30015 \u53f7\u5206\u533a\u6570\u636e 2 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 4\u30011 \u53f7\u5206\u533a\u6570\u636e</p> <p>0 \u53f7\u6d88\u8d39\u8005\u7684\u4efb\u52a1\u4f1a\u6309\u7167 RoundRobin \u7684\u65b9\u5f0f\uff0c\u628a\u6570\u636e\u8f6e\u8be2\u5206\u6210 0 \u30016 \u548c 3 \u53f7\u5206\u533a\u6570\u636e\uff0c\u5206\u522b\u7531 1 \u53f7\u6d88\u8d39\u8005\u6216\u8005 2 \u53f7\u6d88\u8d39\u8005\u6d88\u8d39\u3002</p> <p>\uff082\uff09\u518d\u6b21\u91cd\u65b0\u53d1\u9001\u6d88\u606f\u89c2\u770b\u7ed3\u679c\uff0845 s \u4ee5\u540e\uff09\u3002 1 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 0\u30012\u30014\u30016 \u53f7\u5206\u533a\u6570\u636e 2 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 1\u30013\u30015 \u53f7\u5206\u533a\u6570\u636e</p>"},{"location":"mq/kafka/kf_05/#543-sticky","title":"5.4.3 Sticky\u4ee5\u53ca\u518d\u5e73\u8861","text":"<p>\u7c98\u6027\u5206\u533a\u5b9a\u4e49\uff1a\u53ef\u4ee5\u7406\u89e3\u4e3a\u5206\u914d\u7684\u7ed3\u679c\u5e26\u6709\u201c\u7c98\u6027\u7684\u201d\u3002\u5373\u5728\u6267\u884c\u4e00\u6b21\u65b0\u7684\u5206\u914d\u4e4b\u524d\uff0c\u8003\u8651\u4e0a\u4e00\u6b21\u5206\u914d\u7684\u7ed3\u679c\uff0c\u5c3d\u91cf\u5c11\u7684\u8c03\u6574\u5206\u914d\u7684\u53d8\u52a8\uff0c\u53ef\u4ee5\u8282\u7701\u5927\u91cf\u7684\u5f00\u9500\u3002</p> <p>\u7c98\u6027\u5206\u533a\u662f Kafka \u4ece 0.11.x \u7248\u672c\u5f00\u59cb\u5f15\u5165\u8fd9\u79cd\u5206\u914d\u7b56\u7565\uff0c\u9996\u5148\u4f1a\u5c3d\u91cf\u5747\u8861\u7684\u653e\u7f6e\u5206\u533a\u5230\u6d88\u8d39\u8005\u4e0a\u9762\uff0c\u5728\u51fa\u73b0\u540c\u4e00\u6d88\u8d39\u8005\u7ec4\u5185\u6d88\u8d39\u8005\u51fa\u73b0\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4f1a\u5c3d\u91cf\u4fdd\u6301\u539f\u6709\u5206\u914d\u7684\u5206\u533a\u4e0d\u53d8\u5316\u3002</p> <p>1\uff09\u9700\u6c42</p> <p>\u200b   \u8bbe\u7f6e\u4e3b\u9898\u4e3a first\uff0c7 \u4e2a\u5206\u533a\uff1b\u51c6\u5907 3 \u4e2a\u6d88\u8d39\u8005\uff0c\u91c7\u7528\u7c98\u6027\u5206\u533a\u7b56\u7565\uff0c\u5e76\u8fdb\u884c\u6d88\u8d39\uff0c\u89c2\u5bdf\u6d88\u8d39\u5206\u914d\u60c5\u51b5\u3002\u7136\u540e\u518d\u505c\u6b62\u5176\u4e2d\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u518d\u6b21\u89c2\u5bdf\u6d88\u8d39\u5206\u914d\u60c5\u51b5\u3002</p> <p>2\uff09\u6b65\u9aa4</p> <p>\uff081\uff09\u4fee\u6539\u5206\u533a\u5206\u914d\u7b56\u7565\u4e3a\u7c98\u6027\u3002</p> <p>\u6ce8\u610f</p> <p>3 \u4e2a\u6d88\u8d39\u8005\u90fd\u5e94\u8be5\u6ce8\u91ca\u6389\uff0c\u4e4b\u540e\u91cd\u542f 3 \u4e2a\u6d88\u8d39\u8005\uff0c\u5982\u679c\u51fa\u73b0\u62a5\u9519\uff0c\u5168\u90e8\u505c\u6b62\u7b49\u4f1a\u518d\u91cd\u542f\uff0c\u6216\u8005\u4fee\u6539\u4e3a\u5168\u65b0\u7684\u6d88\u8d39\u8005\u7ec4\u3002</p> <pre><code>// \u4fee\u6539\u5206\u533a\u5206\u914d\u7b56\u7565\nArrayList&lt;String&gt; startegys = new ArrayList&lt;&gt;();\nstartegys.add(\"org.apache.kafka.clients.consumer.StickyAssignor\");\n\nproperties.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, startegys);\n</code></pre> <p>\uff082\uff09\u4f7f\u7528\u540c\u6837\u7684\u751f\u4ea7\u8005\u53d1\u9001 500 \u6761\u6d88\u606f\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u4f1a\u5c3d\u91cf\u4fdd\u6301\u5206\u533a\u7684\u4e2a\u6570\u8fd1\u4f3c\u5212\u5206\u5206\u533a\u3002</p> <p></p> <p></p> <p></p> <p>3\uff09Sticky \u5206\u533a\u5206\u914d\u518d\u5e73\u8861\u6848\u4f8b</p> <p>\uff081\uff09\u505c\u6b62\u6389 0 \u53f7\u6d88\u8d39\u8005\uff0c\u5feb\u901f\u91cd\u65b0\u53d1\u9001\u6d88\u606f\u89c2\u770b\u7ed3\u679c\uff0845 s \u4ee5\u5185\uff0c\u8d8a\u5feb\u8d8a\u597d\uff09\u3002</p> <p>1 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 2\u30015\u30013 \u53f7\u5206\u533a\u6570\u636e\u3002 2 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 4\u30016 \u53f7\u5206\u533a\u6570\u636e\u3002</p> <p>0 \u53f7\u6d88\u8d39\u8005\u7684\u4efb\u52a1\u4f1a\u6309\u7167\u7c98\u6027\u89c4\u5219\uff0c\u5c3d\u53ef\u80fd\u5747\u8861\u7684\u968f\u673a\u5206\u6210 0 \u548c 1 \u53f7\u5206\u533a\u6570\u636e\uff0c\u5206\u522b\u7531 1 \u53f7\u6d88\u8d39\u8005\u6216\u8005 2 \u53f7\u6d88\u8d39\u8005\u6d88\u8d39\u3002</p> <p>\uff082\uff09\u518d\u6b21\u91cd\u65b0\u53d1\u9001\u6d88\u606f\u89c2\u770b\u7ed3\u679c\uff0845 s \u4ee5\u540e\uff09\u3002 1 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 2\u30013\u30015 \u53f7\u5206\u533a\u6570\u636e\u3002 2 \u53f7\u6d88\u8d39\u8005\uff1a\u6d88\u8d39\u5230 0\u30011\u30014\u30016 \u53f7\u5206\u533a\u6570\u636e\u3002</p>"},{"location":"mq/kafka/kf_05/#55-offset","title":"5.5 offset\u4f4d\u79fb","text":""},{"location":"mq/kafka/kf_05/#551-offset","title":"5.5.1 offset\u7684\u9ed8\u8ba4\u7ef4\u62a4\u4f4d\u7f6e","text":"<p>__consumer_offsets \u4e3b\u9898\u91cc\u9762\u91c7\u7528 key \u548c value \u7684\u65b9\u5f0f\u5b58\u50a8\u6570\u636e\u3002key \u662f group.id + topic + \u5206\u533a\u53f7\uff0cvalue \u5c31\u662f\u5f53\u524d offset \u7684\u503c\u3002\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff0cKafka \u5185\u90e8\u4f1a\u5bf9\u8fd9\u4e2a topic \u8fdb\u884c compact\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a group.id + topic + \u5206\u533a\u53f7\u5c31\u4fdd\u7559\u6700\u65b0\u6570\u636e\u3002</p> <p>1\uff09\u6d88\u8d39 offset \u6848\u4f8b</p> <p>\uff080\uff09\u601d\u60f3\uff1a__consumer_offsets \u4e3a Kafka \u4e2d\u7684 topic\uff0c\u90a3\u5c31\u53ef\u4ee5\u901a\u8fc7\u6d88\u8d39\u8005\u8fdb\u884c\u6d88\u8d39\u3002</p> <p>\uff081\uff09\u5728\u914d\u7f6e\u6587\u4ef6 config/consumer.properties \u4e2d\u6dfb\u52a0\u914d\u7f6e <code>exclude.internal.topics=false</code>\uff0c\u9ed8\u8ba4\u662f true\uff0c\u8868\u793a\u4e0d\u80fd\u6d88\u8d39\u7cfb\u7edf\u4e3b\u9898\u3002\u4e3a\u4e86\u67e5\u770b\u8be5\u7cfb\u7edf\u4e3b\u9898\u6570\u636e\uff0c\u6240\u4ee5\u8be5\u53c2\u6570\u4fee\u6539\u4e3a false\u3002</p> <p>\uff082\uff09\u91c7\u7528\u547d\u4ee4\u884c\u65b9\u5f0f\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 topic\u3002</p> <pre><code>bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --create --topic atguigu --partitions 2 --replication-factor 2\n</code></pre> <p>\uff083\uff09\u542f\u52a8\u751f\u4ea7\u8005\u5f80 atguigu \u751f\u4ea7\u6570\u636e\u3002</p> <pre><code>bin/kafka-console-producer.sh --topic atguigu --bootstrap-server  hadoop102:9092\n</code></pre> <p>\uff084\uff09\u542f\u52a8\u6d88\u8d39\u8005\u6d88\u8d39 atguigu \u6570\u636e\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic atguigu --group test\n</code></pre> <p>\u6ce8\u610f</p> <p>\u6307\u5b9a\u6d88\u8d39\u8005\u7ec4\u540d\u79f0\uff0c\u66f4\u597d\u89c2\u5bdf\u6570\u636e\u5b58\u50a8\u4f4d\u7f6e\uff08 key \u662f group.id + topic + \u5206\u533a\u53f7\uff09\u3002</p> <p>\uff085\uff09\u67e5\u770b\u6d88\u8d39\u8005\u6d88\u8d39\u4e3b\u9898 __consumer_offsets\u3002</p> <pre><code>bin/kafka-console-consumer.sh --topic __consumer_offsets --bootstrap-server  hadoop102:9092 --consumer.config config/consumer.properties  --formatter \"kafka.coordinator.group.GroupMetadataManager\\$OffsetsMessageFormatter\" --from-beginning\n</code></pre>"},{"location":"mq/kafka/kf_05/#552-offset","title":"5.5.2 \u81ea\u52a8\u63d0\u4ea4offset","text":"\u53c2\u6570\u540d\u79f0 \u63cf\u8ff0 enable.auto.commit \u9ed8\u8ba4\u503c\u4e3a true\uff0c\u6d88\u8d39\u8005\u4f1a\u81ea\u52a8\u5468\u671f\u6027\u5730\u5411\u670d\u52a1\u5668\u63d0\u4ea4\u504f\u79fb\u91cf\u3002 auto.commit.interval.ms \u5982\u679c\u8bbe\u7f6e\u4e86 enable.auto.commit \u7684\u503c\u4e3a true\uff0c \u5219\u8be5\u503c\u5b9a\u4e49\u4e86\u6d88\u8d39\u8005\u504f\u79fb\u91cf\u5411 Kafka \u63d0\u4ea4\u7684\u9891\u7387\uff0c\u9ed8\u8ba4 5s\u3002 <p>1\uff09\u6d88\u8d39\u8005\u81ea\u52a8\u63d0\u4ea4 offset</p> <pre><code>package com.atguigu.kafka.consumer;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.kafka.clients.consumer.ConsumerRecords;\nimport org.apache.kafka.clients.consumer.KafkaConsumer;\n\nimport java.util.Arrays;\nimport java.util.Properties;\n\npublic class CustomConsumerAutoOffset {\n\npublic static void main(String[] args) {\n\n// 1. \u521b\u5efakafka\u6d88\u8d39\u8005\u914d\u7f6e\u7c7b\nProperties properties = new Properties();\n\n// 2. \u6dfb\u52a0\u914d\u7f6e\u53c2\u6570\n// \u6dfb\u52a0\u8fde\u63a5\nproperties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// \u914d\u7f6e\u5e8f\u5217\u5316 \u5fc5\u987b\nproperties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nproperties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\n// \u914d\u7f6e\u6d88\u8d39\u8005\u7ec4\nproperties.put(ConsumerConfig.GROUP_ID_CONFIG, \"test\");\n\n// \u662f\u5426\u81ea\u52a8\u63d0\u4ea4offset\nproperties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, true);\n// \u63d0\u4ea4offset\u7684\u65f6\u95f4\u5468\u671f1000ms\uff0c\u9ed8\u8ba45s\nproperties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, 1000);\n\n//3. \u521b\u5efakafka\u6d88\u8d39\u8005\nKafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(properties);\n\n//4. \u8bbe\u7f6e\u6d88\u8d39\u4e3b\u9898  \u5f62\u53c2\u662f\u5217\u8868\nconsumer.subscribe(Arrays.asList(\"first\"));\n\n//5. \u6d88\u8d39\u6570\u636e\nwhile (true){\n// \u8bfb\u53d6\u6d88\u606f\nConsumerRecords&lt;String, String&gt; consumerRecords = consumer.poll(Duration.ofSeconds(1));\n\n// \u8f93\u51fa\u6d88\u606f\nfor (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) {\nSystem.out.println(consumerRecord.value());\n}\n}\n}\n}\n</code></pre>"},{"location":"mq/kafka/kf_05/#553-offset","title":"5.5.3 \u624b\u52a8\u63d0\u4ea4offset","text":"<p>1\uff09\u540c\u6b65\u63d0\u4ea4 offset</p> <p>\u7531\u4e8e\u540c\u6b65\u63d0\u4ea4 offset \u6709\u5931\u8d25\u91cd\u8bd5\u673a\u5236\uff0c\u6545\u66f4\u52a0\u53ef\u9760\uff0c\u4f46\u662f\u7531\u4e8e\u4e00\u76f4\u7b49\u5f85\u63d0\u4ea4\u7ed3\u679c\uff0c\u63d0\u4ea4\u7684\u6548\u7387\u6bd4\u8f83\u4f4e\u3002\u4ee5\u4e0b\u4e3a\u540c\u6b65\u63d0\u4ea4 offset \u7684\u793a\u4f8b\u3002</p> <pre><code>package com.atguigu.kafka.consumer;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.kafka.clients.consumer.ConsumerRecords;\nimport org.apache.kafka.clients.consumer.KafkaConsumer;\n\nimport java.util.Arrays;\nimport java.util.Properties;\n\npublic class CustomConsumerByHandSync {\n\npublic static void main(String[] args) {\n// 1. \u521b\u5efakafka\u6d88\u8d39\u8005\u914d\u7f6e\u7c7b\nProperties properties = new Properties();\n// 2. \u6dfb\u52a0\u914d\u7f6e\u53c2\u6570\n// \u6dfb\u52a0\u8fde\u63a5\nproperties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// \u914d\u7f6e\u5e8f\u5217\u5316 \u5fc5\u987b\nproperties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nproperties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\n// \u914d\u7f6e\u6d88\u8d39\u8005\u7ec4\nproperties.put(ConsumerConfig.GROUP_ID_CONFIG, \"test\");\n\n// \u662f\u5426\u81ea\u52a8\u63d0\u4ea4offset\nproperties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);\n\n//3. \u521b\u5efakafka\u6d88\u8d39\u8005\nKafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(properties);\n\n//4. \u8bbe\u7f6e\u6d88\u8d39\u4e3b\u9898  \u5f62\u53c2\u662f\u5217\u8868\nconsumer.subscribe(Arrays.asList(\"first\"));\n\n//5. \u6d88\u8d39\u6570\u636e\nwhile (true){\n\n// \u8bfb\u53d6\u6d88\u606f\nConsumerRecords&lt;String, String&gt; consumerRecords = consumer.poll(Duration.ofSeconds(1));\n\n// \u8f93\u51fa\u6d88\u606f\nfor (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) {\nSystem.out.println(consumerRecord.value());\n} // \u540c\u6b65\u63d0\u4ea4offset\nconsumer.commitSync();\n}\n}\n}\n</code></pre> <p>2\uff09\u5f02\u6b65\u63d0\u4ea4 offset</p> <p>\u867d\u7136\u540c\u6b65\u63d0\u4ea4 offset \u66f4\u53ef\u9760\u4e00\u4e9b\uff0c\u4f46\u662f\u7531\u4e8e\u5176\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u76f4\u5230\u63d0\u4ea4\u6210\u529f\u3002\u56e0\u6b64\u541e\u5410\u91cf\u4f1a\u53d7\u5230\u5f88\u5927\u7684\u5f71\u54cd\u3002\u56e0\u6b64\u66f4\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u9009\u7528\u5f02\u6b65\u63d0\u4ea4 offset \u7684\u65b9\u5f0f\u3002</p> <p>\u4ee5\u4e0b\u4e3a\u5f02\u6b65\u63d0\u4ea4 offset \u7684\u793a\u4f8b\uff1a</p> <pre><code>package com.atguigu.kafka.consumer;\n\nimport org.apache.kafka.clients.consumer.*;\nimport org.apache.kafka.common.TopicPartition;\n\nimport java.util.Arrays;\nimport java.util.Map;\nimport java.util.Properties;\n\npublic class CustomConsumerByHandAsync {\n\npublic static void main(String[] args) {\n\n// 1. \u521b\u5efakafka\u6d88\u8d39\u8005\u914d\u7f6e\u7c7b\nProperties properties = new Properties();\n\n// 2. \u6dfb\u52a0\u914d\u7f6e\u53c2\u6570\n// \u6dfb\u52a0\u8fde\u63a5\nproperties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"hadoop102:9092\");\n\n// \u914d\u7f6e\u5e8f\u5217\u5316 \u5fc5\u987b\nproperties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\nproperties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\n// \u914d\u7f6e\u6d88\u8d39\u8005\u7ec4\nproperties.put(ConsumerConfig.GROUP_ID_CONFIG, \"test\");\n\n// \u662f\u5426\u81ea\u52a8\u63d0\u4ea4offset\nproperties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"false\");\n\n//3. \u521b\u5efaKafka\u6d88\u8d39\u8005\nKafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(properties);\n\n//4. \u8bbe\u7f6e\u6d88\u8d39\u4e3b\u9898  \u5f62\u53c2\u662f\u5217\u8868\nconsumer.subscribe(Arrays.asList(\"first\"));\n\n//5. \u6d88\u8d39\u6570\u636e\nwhile (true){\n\n// \u8bfb\u53d6\u6d88\u606f\nConsumerRecords&lt;String, String&gt; consumerRecords = consumer.poll(Duration.ofSeconds(1));\n\n// \u8f93\u51fa\u6d88\u606f\nfor (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) {\nSystem.out.println(consumerRecord.value());\n}\n\n// \u5f02\u6b65\u63d0\u4ea4offset\nconsumer.commitAsync();\n}\n}\n}\n</code></pre>"},{"location":"mq/kafka/kf_05/#554-offset","title":"5.5.4 \u6307\u5b9aOffset\u6d88\u8d39","text":"<p><code>auto.offset.reset = earliest | latest | none</code>    \u9ed8\u8ba4\u662f latest\u3002</p> <p>Question</p> <p>\u5f53 Kafka \u4e2d\u6ca1\u6709\u521d\u59cb\u504f\u79fb\u91cf\uff08\u6d88\u8d39\u8005\u7ec4\u7b2c\u4e00\u6b21\u6d88\u8d39\uff09\u6216\u670d\u52a1\u5668\u4e0a\u4e0d\u518d\u5b58\u5728\u5f53\u524d\u504f\u79fb\u91cf\u65f6\uff08\u4f8b\u5982\u8be5\u6570\u636e\u5df2\u88ab\u5220\u9664\uff09\uff0c\u8be5\u600e\u4e48\u529e\uff1f</p> <p>\uff081\uff09earliest\uff1a\u81ea\u52a8\u5c06\u504f\u79fb\u91cf\u91cd\u7f6e\u4e3a\u6700\u65e9\u7684\u504f\u79fb\u91cf\uff0c<code>--from-beginning</code>\u3002</p> <p>\uff082\uff09latest\uff08\u9ed8\u8ba4\u503c\uff09\uff1a\u81ea\u52a8\u5c06\u504f\u79fb\u91cf\u91cd\u7f6e\u4e3a\u6700\u65b0\u504f\u79fb\u91cf\u3002</p> <p>\uff083\uff09none\uff1a\u5982\u679c\u672a\u627e\u5230\u6d88\u8d39\u8005\u7ec4\u7684\u5148\u524d\u504f\u79fb\u91cf\uff0c\u5219\u5411\u6d88\u8d39\u8005\u629b\u51fa\u5f02\u5e38\u3002</p> <p></p>"},{"location":"mq/kafka/kf_05/#555","title":"5.5.5 \u6f0f\u6d88\u8d39\u548c\u91cd\u590d\u6d88\u8d39","text":"<ul> <li>\u91cd\u590d\u6d88\u8d39\uff1a\u5df2\u7ecf\u6d88\u8d39\u4e86\u6570\u636e\uff0c\u4f46\u662f offset \u6ca1\u63d0\u4ea4\u3002</li> <li>\u6f0f\u6d88\u8d39\uff1a\u5148\u63d0\u4ea4 offset \u540e\u6d88\u8d39\uff0c\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u6570\u636e\u7684\u6f0f\u6d88\u8d39\u3002</li> </ul> <p>\u601d\u8003</p> <p>\u600e\u4e48\u80fd\u505a\u5230\u65e2\u4e0d\u6f0f\u6d88\u8d39\u4e5f\u4e0d\u91cd\u590d\u6d88\u8d39\u5462\uff1f\u8be6\u770b\u6d88\u8d39\u8005\u4e8b\u52a1\u3002</p>"},{"location":"mq/kafka/kf_05/#56","title":"5.6 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u6d88\u8d39\u8005\u4e8b\u52a1","text":""},{"location":"mq/kafka/kf_05/#57","title":"5.7 \u751f\u4ea7\u7ecf\u9a8c\u2014\u2014\u6570\u636e\u79ef\u538b\uff08\u6d88\u8d39\u8005\u5982\u4f55\u63d0\u9ad8\u541e\u5410\u91cf\uff09","text":"\u53c2\u6570\u540d\u79f0 \u63cf\u8ff0 fetch.max.bytes \u9ed8\u8ba4Default: 52428800\uff0850 m\uff09\u3002\u6d88\u8d39\u8005\u83b7\u53d6\u670d\u52a1\u5668\u7aef\u4e00\u6279\u6d88\u606f\u6700\u5927\u7684\u5b57\u8282\u6570\u3002\u5982\u679c\u670d\u52a1\u5668\u7aef\u4e00\u6279\u6b21\u7684\u6570\u636e\u5927\u4e8e\u8be5\u503c\uff0850m\uff09\u4ecd\u7136\u53ef\u4ee5\u62c9\u53d6\u56de\u6765\u8fd9\u6279\u6570\u636e\uff0c\u56e0\u6b64\uff0c\u8fd9\u4e0d\u662f\u4e00\u4e2a\u7edd\u5bf9\u6700\u5927\u503c\u3002\u4e00\u6279\u6b21\u7684\u5927\u5c0f\u53d7message.max.bytes \uff08broker config\uff09or max.message.bytes \uff08topic config\uff09\u5f71\u54cd\u3002 max.poll.records \u4e00\u6b21 poll \u62c9\u53d6\u6570\u636e\u8fd4\u56de\u6d88\u606f\u7684\u6700\u5927\u6761\u6570\uff0c\u9ed8\u8ba4\u662f 500\u6761"},{"location":"project/dataware_01/","title":"\u7b2c1\u7ae0 \u6570\u636e\u4ed3\u5e93\u6982\u8ff0","text":""},{"location":"project/dataware_01/#11","title":"1.1 \u6570\u636e\u4ed3\u5e93\u6982\u5ff5","text":"<p>\u6570\u636e\u4ed3\u5e93\u662f\u4e00\u4e2a\u4e3a\u6570\u636e\u5206\u6790\u800c\u8bbe\u8ba1\u7684\u4f01\u4e1a\u7ea7\u6570\u636e\u7ba1\u7406\u7cfb\u7edf\u3002\u6570\u636e\u4ed3\u5e93\u53ef\u96c6\u4e2d\u3001\u6574\u5408\u591a\u4e2a\u4fe1\u606f\u6e90\u7684\u5927\u91cf\u6570\u636e\uff0c\u501f\u52a9\u6570\u636e\u4ed3\u5e93\u7684\u5206\u6790\u80fd\u529b\uff0c\u4f01\u4e1a\u53ef\u4ece\u6570\u636e\u4e2d\u83b7\u5f97\u5b9d\u8d35\u7684\u4fe1\u606f\u8fdb\u800c\u6539\u8fdb\u51b3\u7b56\u3002\u540c\u65f6\uff0c\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u6570\u636e\u4ed3\u5e93\u4e2d\u79ef\u7d2f\u7684\u5927\u91cf\u5386\u53f2\u6570\u636e\u5bf9\u4e8e\u6570\u636e\u79d1\u5b66\u5bb6\u548c\u4e1a\u52a1\u5206\u6790\u5e08\u4e5f\u662f\u5341\u5206\u5b9d\u8d35\u7684\u3002</p>"},{"location":"project/dataware_01/#12","title":"1.2 \u6570\u636e\u4ed3\u5e93\u6838\u5fc3\u67b6\u6784","text":""},{"location":"project/dataware_02/","title":"\u7b2c2\u7ae0 \u6570\u636e\u4ed3\u5e93\u5efa\u6a21\u6982\u8ff0","text":""},{"location":"project/dataware_02/#21","title":"2.1 \u6570\u636e\u4ed3\u5e93\u5efa\u6a21\u7684\u610f\u4e49","text":"<p>\u5982\u679c\u628a\u6570\u636e\u770b\u4f5c\u56fe\u4e66\u9986\u91cc\u7684\u4e66\uff0c\u6211\u4eec\u5e0c\u671b\u770b\u5230\u5b83\u4eec\u5728\u4e66\u67b6\u4e0a\u5206\u95e8\u522b\u7c7b\u5730\u653e\u7f6e\uff1b\u5982\u679c\u628a\u6570\u636e\u770b\u4f5c\u57ce\u5e02\u7684\u5efa\u7b51\uff0c\u6211\u4eec\u5e0c\u671b\u57ce\u5e02\u89c4\u5212\u5e03\u5c40\u5408\u7406\uff1b\u5982\u679c\u628a\u6570\u636e\u770b\u4f5c\u7535\u8111\u6587\u4ef6\u548c\u6587\u4ef6\u5939\uff0c\u6211\u4eec\u5e0c\u671b\u6309\u7167\u81ea\u5df1\u7684\u4e60\u60ef\u6709\u5f88\u597d\u7684\u6587\u4ef6\u5939\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u800c\u4e0d\u662f\u7cdf\u7cd5\u6df7\u4e71\u7684\u684c\u9762\uff0c\u7ecf\u5e38\u4e3a\u627e\u4e00\u4e2a\u6587\u4ef6\u800c\u4e0d\u77e5\u6240\u63aa\u3002</p> <p>\u6570\u636e\u6a21\u578b\u5c31\u662f\u6570\u636e\u7ec4\u7ec7\u548c\u5b58\u50a8\u65b9\u6cd5\uff0c\u5b83\u5f3a\u8c03\u4ece\u4e1a\u52a1\u3001\u6570\u636e\u5b58\u53d6\u548c\u4f7f\u7528\u89d2\u5ea6\u5408\u7406\u5b58\u50a8\u6570\u636e\u3002\u53ea\u6709\u5c06\u6570\u636e\u6709\u5e8f\u7684\u7ec4\u7ec7\u548c\u5b58\u50a8\u8d77\u6765\u4e4b\u540e\uff0c\u6570\u636e\u624d\u80fd\u5f97\u5230\u9ad8\u6027\u80fd\u3001\u4f4e\u6210\u672c\u3001\u9ad8\u6548\u7387\u3001\u9ad8\u8d28\u91cf\u7684\u4f7f\u7528\u3002</p> <ul> <li>\u9ad8\u6027\u80fd\uff1a\u826f\u597d\u7684\u6570\u636e\u6a21\u578b\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u5feb\u901f\u67e5\u8be2\u6240\u9700\u8981\u7684\u6570\u636e</li> <li>\u4f4e\u6210\u672c\uff1a\u826f\u597d\u7684\u6570\u636e\u6a21\u578b\u80fd\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\uff0c\u5b9e\u73b0\u8ba1\u7b97\u7ed3\u679c\u7684\u590d\u7528\uff0c\u964d\u4f4e\u8ba1\u7b97\u6210\u672c</li> <li>\u9ad8\u6548\u7387\uff1a\u826f\u597d\u7684\u6570\u636e\u6a21\u578b\u80fd\u6781\u5927\u7684\u6539\u5584\u7528\u6237\u4f7f\u7528\u6570\u636e\u7684\u4f53\u9a8c\uff0c\u63d0\u9ad8\u4f7f\u7528\u6570\u636e\u7684\u6548\u7387</li> <li>\u9ad8\u8d28\u91cf\uff1a\u826f\u597d\u7684\u6570\u636e\u6a21\u578b\u80fd\u6539\u5584\u6570\u636e\u7edf\u8ba1\u53e3\u5f84\u7684\u6df7\u4e71\uff0c\u51cf\u5c11\u8ba1\u7b97\u9519\u8bef\u7684\u53ef\u80fd\u6027</li> </ul>"},{"location":"project/dataware_02/#22","title":"2.2 \u6570\u636e\u4ed3\u5e93\u5efa\u6a21\u65b9\u6cd5\u8bba","text":""},{"location":"project/dataware_02/#221-er","title":"2.2.1 ER\u6a21\u578b","text":"<p>\u6570\u636e\u4ed3\u5e93\u4e4b\u7236 Bill Inmon \u63d0\u51fa\u7684\u5efa\u6a21\u65b9\u6cd5\u662f\u4ece\u5168\u4f01\u4e1a\u7684\u9ad8\u5ea6\uff0c\u7528\u5b9e\u4f53\u5173\u7cfb\uff08Entity Relationship\uff0cER\uff09\u6a21\u578b\u6765\u63cf\u8ff0\u4f01\u4e1a\u4e1a\u52a1\uff0c\u5e76\u7528\u89c4\u8303\u5316\u7684\u65b9\u5f0f\u8868\u793a\u51fa\u6765\uff0c\u5728\u8303\u5f0f\u7406\u8bba\u4e0a\u7b26\u5408 3NF\u3002</p> <p>1\uff09\u5b9e\u4f53\u5173\u7cfb\u6a21\u578b</p> <p>\u5b9e\u4f53\u5173\u7cfb\u6a21\u578b\u5c06\u590d\u6742\u7684\u6570\u636e\u62bd\u8c61\u4e3a\u4e24\u4e2a\u6982\u5ff5\u2014\u2014\u5b9e\u4f53\u548c\u5173\u7cfb\u3002\u5b9e\u4f53\u8868\u793a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f8b\u5982\u5b66\u751f\u3001\u73ed\u7ea7\uff0c\u5173\u7cfb\u662f\u6307\u4e24\u4e2a\u5b9e\u4f53\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u4f8b\u5982\u5b66\u751f\u548c\u73ed\u7ea7\u4e4b\u95f4\u7684\u4ece\u5c5e\u5173\u7cfb\u3002</p> <p>2\uff09\u6570\u636e\u5e93\u89c4\u8303\u5316</p> <p>\u6570\u636e\u5e93\u89c4\u8303\u5316\u662f\u4f7f\u7528\u4e00\u7cfb\u5217\u8303\u5f0f\u8bbe\u8ba1\u6570\u636e\u5e93\uff08\u901a\u5e38\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff09\u7684\u8fc7\u7a0b\uff0c\u5176\u76ee\u7684\u662f\u51cf\u5c11\u6570\u636e\u5197\u4f59\uff0c\u589e\u5f3a\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002</p> <p>\u8fd9\u4e00\u7cfb\u5217\u8303\u5f0f\u5c31\u662f\u6307\u5728\u8bbe\u8ba1\u5173\u7cfb\u578b\u6570\u636e\u5e93\u65f6\uff0c\u9700\u8981\u9075\u4ece\u7684\u4e0d\u540c\u7684\u89c4\u8303\u3002\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u8303\u5f0f\u4e00\u5171\u6709\u516d\u79cd\uff0c\u5206\u522b\u662f\u7b2c\u4e00\u8303\u5f0f\uff081NF\uff09\u3001\u7b2c\u4e8c\u8303\u5f0f\uff082NF\uff09\u3001\u7b2c\u4e09\u8303\u5f0f\uff083NF\uff09\u3001\u5df4\u65af-\u79d1\u5fb7\u8303\u5f0f\uff08BCNF\uff09\u3001\u7b2c\u56db\u8303\u5f0f(4NF\uff09\u548c\u7b2c\u4e94\u8303\u5f0f\uff085NF\uff09\u3002\u9075\u5faa\u7684\u8303\u5f0f\u7ea7\u522b\u8d8a\u9ad8\uff0c\u6570\u636e\u5197\u4f59\u6027\u5c31\u8d8a\u4f4e\u3002</p> <p>3\uff09\u4e09\u8303\u5f0f</p> <p>\uff081\uff09\u51fd\u6570\u4f9d\u8d56</p> <p></p> <p>\uff082\uff09\u7b2c\u4e00\u8303\u5f0f</p> <p></p> <p>\uff083\uff09\u7b2c\u4e8c\u8303\u5f0f</p> <p></p> <p>\uff084\uff09\u7b2c\u4e09\u8303\u5f0f</p> <p></p> <p>\u4e0b\u56fe\u4e3a\u4e00\u4e2a\u91c7\u7528 Bill Inmon \u5021\u5bfc\u7684\u5efa\u6a21\u65b9\u6cd5\u6784\u5efa\u7684\u6a21\u578b\uff0c\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u8f83\u4e3a\u677e\u6563\u3001\u96f6\u788e\uff0c\u7269\u7406\u8868\u6570\u91cf\u591a\u3002</p> <p></p> <p>\u8fd9\u79cd\u5efa\u6a21\u65b9\u6cd5\u7684\u51fa\u53d1\u70b9\u662f\u6574\u5408\u6570\u636e\uff0c\u5176\u76ee\u7684\u662f\u5c06\u6574\u4e2a\u4f01\u4e1a\u7684\u6570\u636e\u8fdb\u884c\u7ec4\u5408\u548c\u5408\u5e76\uff0c\u5e76\u8fdb\u884c\u89c4\u8303\u5904\u7406\uff0c\u51cf\u5c11\u6570\u636e\u5197\u4f59\u6027\uff0c\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\u8fd9\u79cd\u6a21\u578b\u5e76\u4e0d\u9002\u5408\u76f4\u63a5\u7528\u4e8e\u5206\u6790\u7edf\u8ba1\u3002</p>"},{"location":"project/dataware_02/#222","title":"2.2.2 \u7ef4\u5ea6\u6a21\u578b","text":"<p>\u6570\u636e\u4ed3\u5e93\u9886\u57df\u7684\u4ee4\u4e00\u4f4d\u5927\u5e08\u2014\u2014 Ralph Kimball \u5021\u5bfc\u7684\u5efa\u6a21\u65b9\u6cd5\u4e3a\u7ef4\u5ea6\u5efa\u6a21\u3002\u7ef4\u5ea6\u6a21\u578b\u5c06\u590d\u6742\u7684\u4e1a\u52a1\u901a\u8fc7\u4e8b\u5b9e\u548c\u7ef4\u5ea6\u4e24\u4e2a\u6982\u5ff5\u8fdb\u884c\u5448\u73b0\u3002\u4e8b\u5b9e\u901a\u5e38\u5bf9\u5e94\u4e1a\u52a1\u8fc7\u7a0b\uff0c\u800c\u7ef4\u5ea6\u901a\u5e38\u5bf9\u5e94\u4e1a\u52a1\u8fc7\u7a0b\u53d1\u751f\u65f6\u6240\u5904\u7684\u73af\u5883\u3002</p> <p>\u6ce8</p> <p>\u4e1a\u52a1\u8fc7\u7a0b\u53ef\u4ee5\u6982\u62ec\u4e3a\u4e00\u4e2a\u4e2a\u4e0d\u53ef\u62c6\u5206\u7684\u884c\u4e3a\u4e8b\u4ef6\uff0c\u4f8b\u5982\u7535\u5546\u4ea4\u6613\u4e2d\u7684\u4e0b\u5355\uff0c\u53d6\u6d88\u8ba2\u5355\uff0c\u4ed8\u6b3e\uff0c\u9000\u5355\u7b49\uff0c\u90fd\u662f\u4e1a\u52a1\u8fc7\u7a0b\u3002</p> <p>\u4e0b\u56fe\u4e3a\u4e00\u4e2a\u5178\u578b\u7684\u7ef4\u5ea6\u6a21\u578b\uff0c\u5176\u4e2d\u4f4d\u4e8e\u4e2d\u5fc3\u7684 SalesOrder \u4e3a\u4e8b\u5b9e\u8868\uff0c\u5176\u4e2d\u4fdd\u5b58\u7684\u662f\u4e0b\u5355\u8fd9\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u7684\u6240\u6709\u8bb0\u5f55\u3002\u4f4d\u4e8e\u5468\u56f4\u6bcf\u5f20\u8868\u90fd\u662f\u7ef4\u5ea6\u8868\uff0c\u5305\u62ec Date\uff08\u65e5\u671f\uff09\uff0cCustomer\uff08\u987e\u5ba2\uff09\uff0cProduct\uff08\u4ea7\u54c1\uff09\uff0cLocation\uff08\u5730\u533a\uff09\u7b49\uff0c\u8fd9\u4e9b\u7ef4\u5ea6\u8868\u5c31\u7ec4\u6210\u4e86\u6bcf\u4e2a\u8ba2\u5355\u53d1\u751f\u65f6\u6240\u5904\u7684\u73af\u5883\uff0c\u5373\u4f55\u4eba\u3001\u4f55\u65f6\u3001\u5728\u4f55\u5730\u4e0b\u5355\u4e86\u4f55\u79cd\u4ea7\u54c1\u3002\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u6a21\u578b\u76f8\u5bf9\u6e05\u6670\u3001\u7b80\u6d01\u3002</p> <p></p> <p>\u7ef4\u5ea6\u5efa\u6a21\u4ee5\u6570\u636e\u5206\u6790\u4f5c\u4e3a\u51fa\u53d1\u70b9\uff0c\u4e3a\u6570\u636e\u5206\u6790\u670d\u52a1\uff0c\u56e0\u6b64\u5b83\u5173\u6ce8\u7684\u91cd\u70b9\u7684\u7528\u6237\u5982\u4f55\u66f4\u5feb\u7684\u5b8c\u6210\u9700\u6c42\u5206\u6790\u4ee5\u53ca\u5982\u4f55\u5b9e\u73b0\u8f83\u597d\u7684\u5927\u89c4\u6a21\u590d\u6742\u67e5\u8be2\u7684\u54cd\u5e94\u6027\u80fd\u3002</p>"},{"location":"project/dataware_03/","title":"\u7b2c3\u7ae0 \u7ef4\u5ea6\u5efa\u6a21\u7406\u8bba\u4e4b\u4e8b\u5b9e\u8868","text":""},{"location":"project/dataware_03/#31","title":"3.1 \u4e8b\u5b9e\u8868\u6982\u8ff0","text":"<p>\u4e8b\u5b9e\u8868\u4f5c\u4e3a\u6570\u636e\u4ed3\u5e93\u7ef4\u5ea6\u5efa\u6a21\u7684\u6838\u5fc3\uff0c\u7d27\u7d27\u56f4\u7ed5\u7740\u4e1a\u52a1\u8fc7\u7a0b\u6765\u8bbe\u8ba1\u3002\u5176\u5305\u542b\u4e0e\u8be5\u4e1a\u52a1\u8fc7\u7a0b\u6709\u5173\u7684\u7ef4\u5ea6\u5f15\u7528\uff08\u7ef4\u5ea6\u8868\u5916\u952e\uff09\u4ee5\u53ca\u8be5\u4e1a\u52a1\u8fc7\u7a0b\u7684\u5ea6\u91cf\uff08\u901a\u5e38\u662f\u53ef\u7d2f\u52a0\u7684\u6570\u5b57\u7c7b\u578b\u5b57\u6bb5\uff09\u3002</p>"},{"location":"project/dataware_03/#311","title":"3.1.1 \u4e8b\u5b9e\u8868\u7279\u70b9","text":"<p>\u4e8b\u5b9e\u8868\u901a\u5e38\u6bd4\u8f83\u201c\u7ec6\u957f\u201d\uff0c\u5373\u5217\u8f83\u5c11\uff0c\u4f46\u884c\u8f83\u591a\uff0c\u4e14\u884c\u7684\u589e\u901f\u5feb\u3002</p>"},{"location":"project/dataware_03/#312","title":"3.1.2 \u4e8b\u5b9e\u8868\u5206\u7c7b","text":"<p>\u4e8b\u5b9e\u8868\u6709\u4e09\u79cd\u7c7b\u578b\uff1a\u5206\u522b\u662f\u4e8b\u52a1\u4e8b\u5b9e\u8868\u3001\u5468\u671f\u5feb\u7167\u4e8b\u5b9e\u8868\u548c\u7d2f\u79ef\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u6bcf\u79cd\u4e8b\u5b9e\u8868\u90fd\u5177\u6709\u4e0d\u540c\u7684\u7279\u70b9\u548c\u9002\u7528\u573a\u666f\uff0c\u4e0b\u9762\u9010\u4e2a\u4ecb\u7ecd\u3002</p>"},{"location":"project/dataware_03/#32","title":"3.2 \u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868","text":""},{"location":"project/dataware_03/#321","title":"3.2.1 \u6982\u8ff0","text":"<p>\u4e8b\u52a1\u4e8b\u5b9e\u8868\u7528\u6765\u8bb0\u5f55\u5404\u4e1a\u52a1\u8fc7\u7a0b\uff0c\u5b83\u4fdd\u5b58\u7684\u662f\u5404\u4e1a\u52a1\u8fc7\u7a0b\u7684\u539f\u5b50\u64cd\u4f5c\u4e8b\u4ef6\uff0c\u5373\u6700\u7ec6\u7c92\u5ea6\u7684\u64cd\u4f5c\u4e8b\u4ef6\u3002\u7c92\u5ea6\u662f\u6307\u4e8b\u5b9e\u8868\u4e2d\u4e00\u884c\u6570\u636e\u6240\u8868\u8fbe\u7684\u4e1a\u52a1\u7ec6\u8282\u7a0b\u5ea6\u3002</p> <p>\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u53ef\u7528\u4e8e\u5206\u6790\u4e0e\u5404\u4e1a\u52a1\u8fc7\u7a0b\u76f8\u5173\u7684\u5404\u9879\u7edf\u8ba1\u6307\u6807\uff0c\u7531\u4e8e\u5176\u4fdd\u5b58\u4e86\u6700\u7ec6\u7c92\u5ea6\u7684\u8bb0\u5f55\uff0c\u53ef\u4ee5\u63d0\u4f9b\u6700\u5927\u9650\u5ea6\u7684\u7075\u6d3b\u6027\uff0c\u53ef\u4ee5\u652f\u6301\u65e0\u6cd5\u9884\u671f\u7684\u5404\u79cd\u7ec6\u8282\u5c42\u6b21\u7684\u7edf\u8ba1\u9700\u6c42\u3002</p>"},{"location":"project/dataware_03/#322","title":"3.2.2 \u8bbe\u8ba1\u6d41\u7a0b","text":"<p>\u8bbe\u8ba1\u4e8b\u52a1\u4e8b\u5b9e\u8868\u65f6\u4e00\u822c\u53ef\u9075\u5faa\u4ee5\u4e0b\u56db\u4e2a\u6b65\u9aa4\uff1a</p> <pre><code>graph LR\n  A[\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b] --&gt; B[\u58f0\u660e\u7c92\u5ea6];\n  B --&gt; C[\u786e\u8ba4\u7ef4\u5ea6];\n  C --&gt; D[\u786e\u8ba4\u4e8b\u5b9e];</code></pre> <p>1\uff09\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b</p> <p>\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\uff0c\u6311\u9009\u6211\u4eec\u611f\u5174\u8da3\u7684\u4e1a\u52a1\u8fc7\u7a0b\uff0c\u4e1a\u52a1\u8fc7\u7a0b\u53ef\u4ee5\u6982\u62ec\u4e3a\u4e00\u4e2a\u4e2a\u4e0d\u53ef\u62c6\u5206\u7684\u884c\u4e3a\u4e8b\u4ef6\uff0c\u4f8b\u5982\u7535\u5546\u4ea4\u6613\u4e2d\u7684\u4e0b\u5355\uff0c\u53d6\u6d88\u8ba2\u5355\uff0c\u4ed8\u6b3e\uff0c\u9000\u5355\u7b49\uff0c\u90fd\u662f\u4e1a\u52a1\u8fc7\u7a0b\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u5bf9\u5e94\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002</p> <p>2\uff09\u58f0\u660e\u7c92\u5ea6</p> <p>\u4e1a\u52a1\u8fc7\u7a0b\u786e\u5b9a\u540e\uff0c\u9700\u8981\u4e3a\u6bcf\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u58f0\u660e\u7c92\u5ea6\u3002\u5373\u7cbe\u786e\u5b9a\u4e49\u6bcf\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u6bcf\u884c\u6570\u636e\u8868\u793a\u4ec0\u4e48\uff0c\u5e94\u8be5\u5c3d\u53ef\u80fd\u9009\u62e9\u6700\u7ec6\u7c92\u5ea6\uff0c\u4ee5\u6b64\u6765\u5e94\u5404\u79cd\u7ec6\u8282\u7a0b\u5ea6\u7684\u9700\u6c42\u3002</p> <p>\u5178\u578b\u7684\u7c92\u5ea6\u58f0\u660e\u5982\u4e0b\uff1a\u8ba2\u5355\u4e8b\u5b9e\u8868\u4e2d\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u4e00\u4e2a\u8ba2\u5355\u4e2d\u7684\u4e00\u4e2a\u5546\u54c1\u9879\u3002</p> <p>3\uff09\u786e\u5b9a\u7ef4\u5ea6</p> <p>\u786e\u5b9a\u7ef4\u5ea6\u5177\u4f53\u662f\u6307\uff0c\u786e\u5b9a\u4e0e\u6bcf\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u76f8\u5173\u7684\u7ef4\u5ea6\u6709\u54ea\u4e9b\u3002 \u786e\u5b9a\u7ef4\u5ea6\u65f6\u5e94\u5c3d\u91cf\u591a\u5730\u9009\u62e9\u4e0e\u4e1a\u52a1\u8fc7\u7a0b\u76f8\u5173\u7684\u73af\u5883\u4fe1\u606f\u3002\u56e0\u4e3a\u7ef4\u5ea6\u7684\u4e30\u5bcc\u7a0b\u5ea6\u5c31\u51b3\u5b9a\u4e86\u7ef4\u5ea6\u6a21\u578b\u80fd\u591f\u652f\u6301\u7684\u6307\u6807\u4e30\u5bcc\u7a0b\u5ea6\u3002</p> <p>4\uff09\u786e\u5b9a\u4e8b\u5b9e</p> <p>\u6b64\u5904\u7684\u201c\u4e8b\u5b9e\u201d\u4e00\u8bcd\uff0c\u6307\u7684\u662f\u6bcf\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u7684\u5ea6\u91cf\u503c\uff08\u901a\u5e38\u662f\u53ef\u7d2f\u52a0\u7684\u6570\u5b57\u7c7b\u578b\u7684\u503c\uff0c\u4f8b\u5982\uff1a\u6b21\u6570\u3001\u4e2a\u6570\u3001\u4ef6\u6570\u3001\u91d1\u989d\u7b49\uff09\u3002</p> <p>\u7ecf\u8fc7\u4e0a\u8ff0\u56db\u4e2a\u6b65\u9aa4\uff0c\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u5c31\u57fa\u672c\u8bbe\u8ba1\u5b8c\u6210\u4e86\u3002</p> <ul> <li>\u7b2c\u4e00\u6b65\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b\u53ef\u4ee5\u786e\u5b9a\u6709\u54ea\u4e9b\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868</li> <li>\u7b2c\u4e8c\u6b65\u53ef\u4ee5\u786e\u5b9a\u6bcf\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u6bcf\u884c\u6570\u636e\u662f\u4ec0\u4e48</li> <li>\u7b2c\u4e09\u6b65\u53ef\u4ee5\u786e\u5b9a\u6bcf\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u7ef4\u5ea6\u5916\u952e</li> <li>\u7b2c\u56db\u6b65\u53ef\u4ee5\u786e\u5b9a\u6bcf\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u5b57\u6bb5</li> </ul>"},{"location":"project/dataware_03/#323","title":"3.2.3 \u4e0d\u8db3","text":"<p>\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u53ef\u4ee5\u4fdd\u5b58\u6240\u6709\u4e1a\u52a1\u8fc7\u7a0b\u7684\u6700\u7ec6\u7c92\u5ea6\u7684\u64cd\u4f5c\u4e8b\u4ef6\uff0c\u6545\u7406\u8bba\u4e0a\u5176\u53ef\u4ee5\u652f\u6491\u4e0e\u5404\u4e1a\u52a1\u8fc7\u7a0b\u76f8\u5173\u7684\u5404\u79cd\u7edf\u8ba1\u7c92\u5ea6\u7684\u9700\u6c42\u3002\u4f46\u5bf9\u4e8e\u67d0\u4e9b\u7279\u5b9a\u7c7b\u578b\u7684\u9700\u6c42\uff0c\u5176\u903b\u8f91\u53ef\u80fd\u4f1a\u6bd4\u8f83\u590d\u6742\uff0c\u6216\u8005\u6548\u7387\u4f1a\u6bd4\u8f83\u4f4e\u4e0b\u3002\u4f8b\u5982\uff1a</p> <p>1\uff09\u5b58\u91cf\u578b\u6307\u6807</p> <p>\u4f8b\u5982\u5546\u54c1\u5e93\u5b58\uff0c\u8d26\u6237\u4f59\u989d\u7b49\u3002\u6b64\u5904\u4ee5\u7535\u5546\u4e2d\u7684\u865a\u62df\u8d27\u5e01\u4e3a\u4f8b\uff0c\u865a\u62df\u8d27\u5e01\u4e1a\u52a1\u5305\u542b\u7684\u4e1a\u52a1\u8fc7\u7a0b\u4e3b\u8981\u5305\u62ec\u83b7\u53d6\u8d27\u5e01\u548c\u4f7f\u7528\u8d27\u5e01\uff0c\u4e24\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u5404\u81ea\u5bf9\u5e94\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u4e00\u5f20\u5b58\u50a8\u6240\u6709\u7684\u83b7\u53d6\u8d27\u5e01\u7684\u539f\u5b50\u64cd\u4f5c\u4e8b\u4ef6\uff0c\u53e6\u4e00\u5f20\u5b58\u50a8\u6240\u6709\u4f7f\u7528\u8d27\u5e01\u7684\u539f\u5b50\u64cd\u4f5c\u4e8b\u4ef6\u3002</p> <p>\u5047\u5b9a\u73b0\u6709\u4e00\u4e2a\u9700\u6c42\uff0c\u8981\u6c42\u7edf\u8ba1\u622a\u81f3\u5f53\u65e5\u7684\u5404\u7528\u6237\u865a\u62df\u8d27\u5e01\u4f59\u989d\u3002\u7531\u4e8e\u83b7\u53d6\u8d27\u5e01\u548c\u4f7f\u7528\u8d27\u5e01\u5747\u4f1a\u5f71\u54cd\u5230\u4f59\u989d\uff0c\u6545\u9700\u8981\u5bf9\u4e24\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u8fdb\u884c\u805a\u5408\uff0c\u4e14\u9700\u8981\u533a\u5206\u4e24\u8005\u5bf9\u4f59\u989d\u7684\u5f71\u54cd\uff08\u52a0\u6216\u51cf\uff09\uff0c\u53e6\u5916\u9700\u8981\u5bf9\u4e24\u5f20\u8868\u7684\u5168\u8868\u6570\u636e\u805a\u5408\u624d\u80fd\u5f97\u5230\u7edf\u8ba1\u7ed3\u679c\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0d\u8bba\u662f\u4ece\u903b\u8f91\u4e0a\u8fd8\u662f\u6548\u7387\u4e0a\u8003\u8651\uff0c\u8fd9\u90fd\u4e0d\u662f\u4e00\u4e2a\u597d\u7684\u65b9\u6848\u3002</p> <p>2\uff09\u591a\u4e8b\u52a1\u5173\u8054\u7edf\u8ba1</p> <p>\u4f8b\u5982\uff0c\u73b0\u9700\u8981\u7edf\u8ba1\u6700\u8fd1 30 \u5929\uff0c\u7528\u6237\u4e0b\u5355\u5230\u652f\u4ed8\u7684\u65f6\u95f4\u95f4\u9694\u7684\u5e73\u5747\u503c\u3002\u7edf\u8ba1\u601d\u8def\u5e94\u8be5\u662f\u627e\u5230\u4e0b\u5355\u4e8b\u52a1\u4e8b\u5b9e\u8868\u548c\u652f\u4ed8\u4e8b\u52a1\u4e8b\u5b9e\u8868\uff0c\u8fc7\u6ee4\u51fa\u6700\u8fd1 30 \u5929\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u6309\u7167\u8ba2\u5355 id \u5bf9\u4e24\u5f20\u4e8b\u5b9e\u8868\u8fdb\u884c\u5173\u8054\uff0c\u4e4b\u540e\u7528\u652f\u4ed8\u65f6\u95f4\u51cf\u53bb\u4e0b\u5355\u65f6\u95f4\uff0c\u7136\u540e\u518d\u6c42\u5e73\u5747\u503c\u3002</p> <p>\u903b\u8f91\u4e0a\u867d\u7136\u5e76\u4e0d\u590d\u6742\uff0c\u4f46\u662f\u5176\u6548\u7387\u8f83\u4f4e\uff0c\u5e94\u4e3a\u4e0b\u5355\u4e8b\u52a1\u4e8b\u5b9e\u8868\u548c\u652f\u4ed8\u4e8b\u52a1\u4e8b\u5b9e\u8868\u5747\u4e3a\u5927\u8868\uff0c\u5927\u8868 join \u5927\u8868\u7684\u64cd\u4f5c\u5e94\u5c3d\u91cf\u907f\u514d\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u4e0a\u8ff0\u4e24\u79cd\u573a\u666f\u4e0b\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u8868\u73b0\u5e76\u4e0d\u7406\u60f3\u3002\u4e0b\u9762\u8981\u4ecb\u7ecd\u7684\u53e6\u5916\u4e24\u79cd\u7c7b\u578b\u7684\u4e8b\u5b9e\u8868\u5c31\u662f\u4e3a\u4e86\u5f25\u8865\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u4e0d\u8db3\u7684\u3002</p>"},{"location":"project/dataware_03/#33","title":"3.3 \u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868","text":""},{"location":"project/dataware_03/#331","title":"3.3.1 \u6982\u8ff0","text":"<p>\u5468\u671f\u5feb\u7167\u4e8b\u5b9e\u8868\u4ee5\u5177\u6709\u89c4\u5f8b\u6027\u7684\u3001\u53ef\u9884\u89c1\u7684\u65f6\u95f4\u95f4\u9694\u6765\u8bb0\u5f55\u4e8b\u5b9e\uff0c\u4e3b\u8981\u7528\u4e8e\u5206\u6790\u4e00\u4e9b\u5b58\u91cf\u578b\uff08\u4f8b\u5982\u5546\u54c1\u5e93\u5b58\uff0c\u8d26\u6237\u4f59\u989d\uff09\u6216\u8005\u72b6\u6001\u578b\uff08\u7a7a\u6c14\u6e29\u5ea6\uff0c\u884c\u9a76\u901f\u5ea6\uff09\u6307\u6807\u3002</p> <p>\u5bf9\u4e8e\u5546\u54c1\u5e93\u5b58\u3001\u8d26\u6237\u4f59\u989d\u8fd9\u4e9b\u5b58\u91cf\u578b\u6307\u6807\uff0c\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u901a\u5e38\u5c31\u4f1a\u8ba1\u7b97\u5e76\u4fdd\u5b58\u6700\u65b0\u7ed3\u679c\uff0c\u6240\u4ee5\u5b9a\u671f\u540c\u6b65\u4e00\u4efd\u5168\u91cf\u6570\u636e\u5230\u6570\u636e\u4ed3\u5e93\uff0c\u6784\u5efa\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5c31\u80fd\u8f7b\u677e\u5e94\u5bf9\u6b64\u7c7b\u7edf\u8ba1\u9700\u6c42\uff0c\u800c\u65e0\u9700\u518d\u5bf9\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u4e2d\u5927\u91cf\u7684\u5386\u53f2\u8bb0\u5f55\u8fdb\u884c\u805a\u5408\u4e86\u3002</p> <p>\u5bf9\u4e8e\u7a7a\u6c14\u6e29\u5ea6\u3001\u884c\u9a76\u901f\u5ea6\u8fd9\u4e9b\u72b6\u6001\u578b\u6307\u6807\uff0c\u7531\u4e8e\u5b83\u4eec\u7684\u503c\u5f80\u5f80\u662f\u8fde\u7eed\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u6355\u83b7\u5176\u53d8\u52a8\u7684\u539f\u5b50\u4e8b\u52a1\u64cd\u4f5c\uff0c\u6240\u4ee5\u65e0\u6cd5\u4f7f\u7528\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7edf\u8ba1\u6b64\u7c7b\u9700\u6c42\u3002\u800c\u53ea\u80fd\u5b9a\u671f\u5bf9\u5176\u8fdb\u884c\u91c7\u6837\uff0c\u6784\u5efa\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002</p>"},{"location":"project/dataware_03/#332","title":"3.3.2 \u8bbe\u8ba1\u6d41\u7a0b","text":"<p>1\uff09\u786e\u5b9a\u7c92\u5ea6</p> <p>\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u7c92\u5ea6\u53ef\u7531\u91c7\u6837\u5468\u671f\u548c\u7ef4\u5ea6\u63cf\u8ff0\uff0c\u6545\u786e\u5b9a\u91c7\u6837\u5468\u671f\u548c\u7ef4\u5ea6\u540e\u5373\u53ef\u786e\u5b9a\u7c92\u5ea6\u3002</p> <p>\u91c7\u6837\u5468\u671f\u901a\u5e38\u9009\u62e9\u6bcf\u65e5\u3002</p> <p>\u7ef4\u5ea6\u53ef\u6839\u636e\u7edf\u8ba1\u6307\u6807\u51b3\u5b9a\uff0c\u4f8b\u5982\u6307\u6807\u4e3a\u7edf\u8ba1\u6bcf\u4e2a\u4ed3\u5e93\u4e2d\u6bcf\u79cd\u5546\u54c1\u7684\u5e93\u5b58\uff0c\u5219\u53ef\u786e\u5b9a\u7ef4\u5ea6\u4e3a\u4ed3\u5e93\u548c\u5546\u54c1\u3002</p> <p>\u786e\u5b9a\u5b8c\u91c7\u6837\u5468\u671f\u548c\u7ef4\u5ea6\u540e\uff0c\u5373\u53ef\u786e\u5b9a\u8be5\u8868\u7c92\u5ea6\u4e3a\u6bcf\u65e5-\u4ed3\u5e93-\u5546\u54c1\u3002</p> <p>2\uff09\u786e\u8ba4\u4e8b\u5b9e</p> <p>\u4e8b\u5b9e\u4e5f\u53ef\u6839\u636e\u7edf\u8ba1\u6307\u6807\u51b3\u5b9a\uff0c\u4f8b\u5982\u6307\u6807\u4e3a\u7edf\u8ba1\u6bcf\u4e2a\u4ed3\u5e93\u4e2d\u6bcf\u79cd\u5546\u54c1\u7684\u5e93\u5b58\uff0c\u5219\u4e8b\u5b9e\u4e3a\u5546\u54c1\u5e93\u5b58\u3002</p>"},{"location":"project/dataware_03/#333","title":"3.3.3 \u4e8b\u5b9e\u7c7b\u578b","text":"<p>\u6b64\u5904\u7684\u4e8b\u5b9e\u7c7b\u578b\u662f\u6307\u5ea6\u91cf\u503c\u7684\u7c7b\u578b\uff0c\u800c\u975e\u4e8b\u5b9e\u8868\u7684\u7c7b\u578b\u3002\u4e8b\u5b9e\uff08\u5ea6\u91cf\u503c\uff09\u5171\u5206\u4e3a\u4e09\u7c7b\uff0c\u5206\u522b\u662f\u53ef\u52a0\u4e8b\u5b9e\uff0c\u534a\u53ef\u52a0\u4e8b\u5b9e\u548c\u4e0d\u53ef\u52a0\u4e8b\u5b9e\u3002</p> <p>1\uff09\u53ef\u52a0\u4e8b\u5b9e</p> <p>\u53ef\u52a0\u4e8b\u5b9e\u662f\u6307\u53ef\u4ee5\u6309\u7167\u4e0e\u4e8b\u5b9e\u8868\u76f8\u5173\u7684\u6240\u6709\u7ef4\u5ea6\u8fdb\u884c\u7d2f\u52a0\uff0c\u4f8b\u5982\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u4e2d\u7684\u4e8b\u5b9e\u3002</p> <p>2\uff09\u534a\u53ef\u52a0\u4e8b\u5b9e</p> <p>\u534a\u53ef\u52a0\u4e8b\u5b9e\u662f\u6307\u53ea\u80fd\u6309\u7167\u4e0e\u4e8b\u5b9e\u8868\u76f8\u5173\u7684\u4e00\u90e8\u5206\u7ef4\u5ea6\u8fdb\u884c\u7d2f\u52a0\uff0c\u4f8b\u5982\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e2d\u7684\u4e8b\u5b9e\u3002\u4ee5\u4e0a\u8ff0\u5404\u4ed3\u5e93\u4e2d\u5404\u5546\u54c1\u7684\u5e93\u5b58\u6bcf\u5929\u5feb\u7167\u4e8b\u5b9e\u8868\u4e3a\u4f8b\uff0c\u8fd9\u5f20\u8868\u4e2d\u7684\u5e93\u5b58\u4e8b\u5b9e\u53ef\u4ee5\u6309\u7167\u4ed3\u5e93\u6216\u8005\u5546\u54c1\u7ef4\u5ea6\u8fdb\u884c\u7d2f\u52a0\uff0c\u4f46\u662f\u4e0d\u80fd\u6309\u7167\u65f6\u95f4\u7ef4\u5ea6\u8fdb\u884c\u7d2f\u52a0\uff0c\u56e0\u4e3a\u5c06\u6bcf\u5929\u7684\u5e93\u5b58\u7d2f\u52a0\u8d77\u6765\u662f\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u7684\u3002</p> <p>3\uff09\u4e0d\u53ef\u52a0\u4e8b\u5b9e</p> <p>\u4e0d\u53ef\u52a0\u4e8b\u5b9e\u662f\u6307\u5b8c\u5168\u4e0d\u5177\u5907\u53ef\u52a0\u6027\uff0c\u4f8b\u5982\u6bd4\u7387\u578b\u4e8b\u5b9e\u3002\u4e0d\u53ef\u52a0\u4e8b\u5b9e\u901a\u5e38\u9700\u8981\u8f6c\u5316\u4e3a\u53ef\u52a0\u4e8b\u5b9e\uff0c\u4f8b\u5982\u6bd4\u7387\u53ef\u8f6c\u5316\u4e3a\u5206\u5b50\u548c\u5206\u6bcd\u3002</p>"},{"location":"project/dataware_03/#34","title":"3.4 \u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868","text":""},{"location":"project/dataware_03/#341","title":"3.4.1 \u6982\u8ff0","text":"<p>\u7d2f\u8ba1\u5feb\u7167\u4e8b\u5b9e\u8868\u662f\u57fa\u4e8e\u4e00\u4e2a\u4e1a\u52a1\u6d41\u7a0b\u4e2d\u7684\u591a\u4e2a\u5173\u952e\u4e1a\u52a1\u8fc7\u7a0b\u8054\u5408\u5904\u7406\u800c\u6784\u5efa\u7684\u4e8b\u5b9e\u8868\uff0c\u5982\u4ea4\u6613\u6d41\u7a0b\u4e2d\u7684\u4e0b\u5355\u3001\u652f\u4ed8\u3001\u53d1\u8d27\u3001\u786e\u8ba4\u6536\u8d27\u4e1a\u52a1\u8fc7\u7a0b\u3002</p> <p>\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u901a\u5e38\u5177\u6709\u591a\u4e2a\u65e5\u671f\u5b57\u6bb5\uff0c\u6bcf\u4e2a\u65e5\u671f\u5bf9\u5e94\u4e1a\u52a1\u6d41\u7a0b\u4e2d\u7684\u4e00\u4e2a\u5173\u952e\u4e1a\u52a1\u8fc7\u7a0b\uff08\u91cc\u7a0b\u7891\uff09\u3002</p> \u8ba2\u5355id \u7528\u6237id \u4e0b\u5355\u65e5\u671f \u652f\u4ed8\u65e5\u671f \u53d1\u8d27\u65e5\u671f \u786e\u8ba4\u6536\u8d27\u65e5\u671f \u8ba2\u5355\u91d1\u989d \u652f\u4ed8\u91d1\u989d 1001 1234 2020-06-14 2020-06-15 2020-06-16 2020-06-17 1000 1000 <p>\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e3b\u8981\u7528\u4e8e\u5206\u6790\u4e1a\u52a1\u8fc7\u7a0b\uff08\u91cc\u7a0b\u7891\uff09\u4e4b\u95f4\u7684\u65f6\u95f4\u95f4\u9694\u7b49\u9700\u6c42\u3002\u4f8b\u5982\u524d\u6587\u63d0\u5230\u7684\u7528\u6237\u4e0b\u5355\u5230\u652f\u4ed8\u7684\u5e73\u5747\u65f6\u95f4\u95f4\u9694\uff0c\u4f7f\u7528\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u8fdb\u884c\u7edf\u8ba1\uff0c\u5c31\u80fd\u907f\u514d\u4e24\u4e2a\u4e8b\u52a1\u4e8b\u5b9e\u8868\u7684\u5173\u8054\u64cd\u4f5c\uff0c\u4ece\u800c\u53d8\u5f97\u5341\u5206\u7b80\u5355\u9ad8\u6548\u3002</p>"},{"location":"project/dataware_03/#342","title":"3.4.2 \u8bbe\u8ba1\u6d41\u7a0b","text":"<p>\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u8bbe\u8ba1\u6d41\u7a0b\u540c\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7c7b\u4f3c\uff0c\u4e5f\u53ef\u91c7\u7528\u4ee5\u4e0b\u56db\u4e2a\u6b65\u9aa4\uff0c\u4e0b\u9762\u91cd\u70b9\u63cf\u8ff0\u4e0e\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u4e0d\u540c\u4e4b\u5904\u3002</p> <pre><code>graph LR\n  A[\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b] --&gt; B[\u58f0\u660e\u7c92\u5ea6];\n  B --&gt; C[\u786e\u8ba4\u7ef4\u5ea6];\n  C --&gt; D[\u786e\u8ba4\u4e8b\u5b9e];</code></pre> <p>1\uff09\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b</p> <p>\u9009\u62e9\u4e00\u4e2a\u4e1a\u52a1\u6d41\u7a0b\u4e2d\u9700\u8981\u5173\u8054\u5206\u6790\u7684\u591a\u4e2a\u5173\u952e\u4e1a\u52a1\u8fc7\u7a0b\uff0c\u591a\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u5bf9\u5e94\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002</p> <p>2\uff09\u58f0\u660e\u7c92\u5ea6</p> <p>\u7cbe\u786e\u5b9a\u4e49\u6bcf\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u4ec0\u4e48\uff0c\u5c3d\u91cf\u9009\u62e9\u6700\u5c0f\u7c92\u5ea6\u3002</p> <p>3\uff09\u786e\u8ba4\u7ef4\u5ea6</p> <p>\u9009\u62e9\u4e0e\u5404\u4e1a\u52a1\u8fc7\u7a0b\u76f8\u5173\u7684\u7ef4\u5ea6\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6bcf\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u5747\u9700\u8981\u4e00\u4e2a\u65e5\u671f\u7ef4\u5ea6\u3002</p> <p>4\uff09\u786e\u8ba4\u4e8b\u5b9e</p> <p>\u9009\u62e9\u5404\u4e1a\u52a1\u8fc7\u7a0b\u7684\u5ea6\u91cf\u503c\u3002</p>"},{"location":"project/dataware_04/","title":"\u7b2c4\u7ae0 \u7ef4\u5ea6\u5efa\u6a21\u7406\u8bba\u4e4b\u7ef4\u5ea6\u8868","text":""},{"location":"project/dataware_04/#41","title":"4.1 \u7ef4\u5ea6\u8868\u6982\u8ff0","text":"<p>\u7ef4\u5ea6\u8868\u662f\u7ef4\u5ea6\u5efa\u6a21\u7684\u57fa\u7840\u548c\u7075\u9b42\u3002\u524d\u6587\u63d0\u5230\uff0c\u4e8b\u5b9e\u8868\u7d27\u7d27\u56f4\u7ed5\u4e1a\u52a1\u8fc7\u7a0b\u8fdb\u884c\u8bbe\u8ba1\uff0c\u800c\u7ef4\u5ea6\u8868\u5219\u56f4\u7ed5\u4e1a\u52a1\u8fc7\u7a0b\u6240\u5904\u7684\u73af\u5883\u8fdb\u884c\u8bbe\u8ba1\u3002\u7ef4\u5ea6\u8868\u4e3b\u8981\u5305\u542b\u4e00\u4e2a\u4e3b\u952e\u548c\u5404\u79cd\u7ef4\u5ea6\u5b57\u6bb5\uff0c\u7ef4\u5ea6\u5b57\u6bb5\u79f0\u4e3a\u7ef4\u5ea6\u5c5e\u6027\u3002</p>"},{"location":"project/dataware_04/#42","title":"4.2 \u7ef4\u5ea6\u8868\u8bbe\u8ba1\u6b65\u9aa4","text":"<p>1\uff09\u786e\u5b9a\u7ef4\u5ea6\uff08\u8868\uff09</p> <p>\u5728\u8bbe\u8ba1\u4e8b\u5b9e\u8868\u65f6\uff0c\u5df2\u7ecf\u786e\u5b9a\u4e86\u4e0e\u6bcf\u4e2a\u4e8b\u5b9e\u8868\u76f8\u5173\u7684\u7ef4\u5ea6\uff0c\u7406\u8bba\u4e0a\u6bcf\u4e2a\u76f8\u5173\u7ef4\u5ea6\u5747\u9700\u5bf9\u5e94\u4e00\u5f20\u7ef4\u5ea6\u8868\u3002\u9700\u8981\u6ce8\u610f\u5230\uff0c\u53ef\u80fd\u5b58\u5728\u591a\u4e2a\u4e8b\u5b9e\u8868\u4e0e\u540c\u4e00\u4e2a\u7ef4\u5ea6\u90fd\u76f8\u5173\u7684\u60c5\u51b5\uff0c\u8fd9\u79cd\u60c5\u51b5\u9700\u4fdd\u8bc1\u7ef4\u5ea6\u7684\u552f\u4e00\u6027\uff0c\u5373\u53ea\u521b\u5efa\u4e00\u5f20\u7ef4\u5ea6\u8868\u3002\u53e6\u5916\uff0c\u5982\u679c\u67d0\u4e9b\u7ef4\u5ea6\u8868\u7684\u7ef4\u5ea6\u5c5e\u6027\u5f88\u5c11\uff0c\u4f8b\u5982\u53ea\u6709\u4e00\u4e2a**\u540d\u79f0\uff0c\u5219\u53ef\u4e0d\u521b\u5efa\u8be5\u7ef4\u5ea6\u8868\uff0c\u800c\u628a\u8be5\u8868\u7684\u7ef4\u5ea6\u5c5e\u6027\u76f4\u63a5\u589e\u52a0\u5230\u4e0e\u4e4b\u76f8\u5173\u7684\u4e8b\u5b9e\u8868\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u79f0\u4e3a\u7ef4\u5ea6\u9000\u5316\u3002</p> <p>2\uff09\u786e\u5b9a\u4e3b\u7ef4\u8868\u548c\u76f8\u5173\u7ef4\u8868</p> <p>\u6b64\u5904\u7684\u4e3b\u7ef4\u8868\u548c\u76f8\u5173\u7ef4\u8868\u5747\u6307\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u4e0e\u67d0\u7ef4\u5ea6\u76f8\u5173\u7684\u8868\u3002\u4f8b\u5982\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u4e0e\u5546\u54c1\u76f8\u5173\u7684\u8868\u6709 sku_info\uff0cspu_info\uff0cbase_trademark\uff0cbase_category3\uff0cbase_category2\uff0cbase_category1 \u7b49\uff0c\u5176\u4e2d sku_info \u5c31\u79f0\u4e3a\u5546\u54c1\u7ef4\u5ea6\u7684\u4e3b\u7ef4\u8868\uff0c\u5176\u4f59\u8868\u79f0\u4e3a\u5546\u54c1\u7ef4\u5ea6\u7684\u76f8\u5173\u7ef4\u8868\u3002\u7ef4\u5ea6\u8868\u7684\u7c92\u5ea6\u901a\u5e38\u4e0e\u4e3b\u7ef4\u8868\u76f8\u540c\u3002</p> <p>3\uff09\u786e\u5b9a\u7ef4\u5ea6\u5c5e\u6027</p> <p>\u786e\u5b9a\u7ef4\u5ea6\u5c5e\u6027\u5373\u786e\u5b9a\u7ef4\u5ea6\u8868\u5b57\u6bb5\u3002\u7ef4\u5ea6\u5c5e\u6027\u4e3b\u8981\u6765\u81ea\u4e8e\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u4e0e\u8be5\u7ef4\u5ea6\u5bf9\u5e94\u7684\u4e3b\u7ef4\u8868\u548c\u76f8\u5173\u7ef4\u8868\u3002\u7ef4\u5ea6\u5c5e\u6027\u53ef\u76f4\u63a5\u4ece\u4e3b\u7ef4\u8868\u6216\u76f8\u5173\u7ef4\u8868\u4e2d\u9009\u62e9\uff0c\u4e5f\u53ef\u901a\u8fc7\u8fdb\u4e00\u6b65\u52a0\u5de5\u5f97\u5230\u3002</p> <p>\u786e\u5b9a\u7ef4\u5ea6\u5c5e\u6027\u65f6\uff0c\u9700\u8981\u9075\u5faa\u4ee5\u4e0b\u8981\u6c42\uff1a</p> <p>\uff081\uff09\u5c3d\u53ef\u80fd\u751f\u6210\u4e30\u5bcc\u7684\u7ef4\u5ea6\u5c5e\u6027</p> <p>\u7ef4\u5ea6\u5c5e\u6027\u662f\u540e\u7eed\u505a\u5206\u6790\u7edf\u8ba1\u65f6\u7684\u67e5\u8be2\u7ea6\u675f\u6761\u4ef6\u3001\u5206\u7ec4\u5b57\u6bb5\u7684\u57fa\u672c\u6765\u6e90\uff0c\u662f\u6570\u636e\u6613\u7528\u6027\u7684\u5173\u952e\u3002\u7ef4\u5ea6\u5c5e\u6027\u7684\u4e30\u5bcc\u7a0b\u5ea6\u76f4\u63a5\u5f71\u54cd\u5230\u6570\u636e\u6a21\u578b\u80fd\u591f\u652f\u6301\u7684\u6307\u6807\u7684\u4e30\u5bcc\u7a0b\u5ea6\u3002</p> <p>\uff082\uff09\u5c3d\u91cf\u4e0d\u4f7f\u7528\u7f16\u7801\uff0c\u800c\u4f7f\u7528\u660e\u786e\u7684\u6587\u5b57\u8bf4\u660e\uff0c\u4e00\u822c\u53ef\u4ee5\u7f16\u7801\u548c\u6587\u5b57\u5171\u5b58\u3002</p> <p>\uff083\uff09\u5c3d\u91cf\u6c89\u6dc0\u51fa\u901a\u7528\u7684\u7ef4\u5ea6\u5c5e\u6027</p> <p>\u6709\u4e9b\u7ef4\u5ea6\u5c5e\u6027\u7684\u83b7\u53d6\u9700\u8981\u8fdb\u884c\u6bd4\u8f83\u590d\u6742\u7684\u903b\u8f91\u5904\u7406\uff0c\u4f8b\u5982\u9700\u8981\u901a\u8fc7\u591a\u4e2a\u5b57\u6bb5\u62fc\u63a5\u5f97\u5230\u3002\u4e3a\u907f\u514d\u540e\u7eed\u6bcf\u6b21\u4f7f\u7528\u65f6\u7684\u91cd\u590d\u5904\u7406\uff0c\u53ef\u5c06\u8fd9\u4e9b\u7ef4\u5ea6\u5c5e\u6027\u6c89\u6dc0\u5230\u7ef4\u5ea6\u8868\u4e2d\u3002</p>"},{"location":"project/dataware_04/#43","title":"4.3 \u7ef4\u5ea6\u8bbe\u8ba1\u8981\u70b9","text":""},{"location":"project/dataware_04/#431","title":"4.3.1 \u89c4\u8303\u5316\u4e0e\u53cd\u89c4\u8303\u5316","text":"<p>\u89c4\u8303\u5316\u6307\u4f7f\u7528\u4e00\u7cfb\u5217\u8303\u5f0f\u8bbe\u8ba1\u6570\u636e\u5e93\u7684\u8fc7\u7a0b\uff0c\u5176\u76ee\u7684\u662f\u51cf\u5c11\u6570\u636e\u5197\u4f59\uff0c\u589e\u5f3a\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u89c4\u8303\u5316\u4e4b\u540e\uff0c\u4e00\u5f20\u8868\u7684\u5b57\u6bb5\u4f1a\u62c6\u5206\u5230\u591a\u5f20\u8868\u3002</p> <p>\u53cd\u89c4\u8303\u5316\u662f\u6307\u5c06\u591a\u5f20\u8868\u7684\u6570\u636e\u5197\u4f59\u5230\u4e00\u5f20\u8868\uff0c\u5176\u76ee\u7684\u662f\u51cf\u5c11 join \u64cd\u4f5c\uff0c\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u3002 \u5728\u8bbe\u8ba1\u7ef4\u5ea6\u8868\u65f6\uff0c\u5982\u679c\u5bf9\u5176\u8fdb\u884c\u89c4\u8303\u5316\uff0c\u5f97\u5230\u7684\u7ef4\u5ea6\u6a21\u578b\u79f0\u4e3a\u96ea\u82b1\u6a21\u578b\uff0c\u5982\u679c\u5bf9\u5176\u8fdb\u884c\u53cd\u89c4\u8303\u5316\uff0c\u5f97\u5230\u7684\u6a21\u578b\u79f0\u4e3a\u661f\u578b\u6a21\u578b\u3002</p> \u96ea\u82b1\u6a21\u578b\u661f\u578b\u6a21\u578b <p></p> <p></p> <p>\u6570\u636e\u4ed3\u5e93\u7cfb\u7edf\u7684\u4e3b\u8981\u76ee\u7684\u662f\u7528\u4e8e\u6570\u636e\u5206\u6790\u548c\u7edf\u8ba1\uff0c\u6240\u4ee5\u662f\u5426\u65b9\u4fbf\u7528\u6237\u8fdb\u884c\u7edf\u8ba1\u5206\u6790\u51b3\u5b9a\u4e86\u6a21\u578b\u7684\u4f18\u52a3\u3002\u91c7\u7528\u96ea\u82b1\u6a21\u578b\uff0c\u7528\u6237\u5728\u7edf\u8ba1\u5206\u6790\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u5927\u91cf\u7684\u5173\u8054\u64cd\u4f5c\uff0c\u4f7f\u7528\u590d\u6742\u5ea6\u9ad8\uff0c\u540c\u65f6\u67e5\u8be2\u6027\u80fd\u5f88\u5dee\uff0c\u800c\u91c7\u7528\u661f\u578b\u6a21\u578b\uff0c\u5219\u65b9\u4fbf\u3001\u6613\u7528\u4e14\u6027\u80fd\u597d\u3002\u6240\u4ee5\u51fa\u4e8e\u6613\u7528\u6027\u548c\u6027\u80fd\u7684\u8003\u8651\uff0c\u7ef4\u5ea6\u8868\u4e00\u822c\u662f\u5f88\u4e0d\u89c4\u8303\u5316\u7684\u3002</p>"},{"location":"project/dataware_04/#432","title":"4.3.2 \u7ef4\u5ea6\u53d8\u5316","text":"<p>\u7ef4\u5ea6\u5c5e\u6027\u901a\u5e38\u4e0d\u662f\u9759\u6001\u7684\uff0c\u800c\u662f\u4f1a\u968f\u65f6\u95f4\u53d8\u5316\u7684\uff0c\u6570\u636e\u4ed3\u5e93\u7684\u4e00\u4e2a\u91cd\u8981\u7279\u70b9\u5c31\u662f\u53cd\u6620\u5386\u53f2\u7684\u53d8\u5316\uff0c\u6240\u4ee5\u5982\u4f55\u4fdd\u5b58\u7ef4\u5ea6\u7684\u5386\u53f2\u72b6\u6001\u662f\u7ef4\u5ea6\u8bbe\u8ba1\u7684\u91cd\u8981\u5de5\u4f5c\u4e4b\u4e00\u3002\u4fdd\u5b58\u7ef4\u5ea6\u6570\u636e\u7684\u5386\u53f2\u72b6\u6001\uff0c\u901a\u5e38\u6709\u4ee5\u4e0b\u4e24\u79cd\u505a\u6cd5\uff0c\u5206\u522b\u662f\u5168\u91cf\u5feb\u7167\u8868\u548c\u62c9\u94fe\u8868\u3002</p> <p>1\uff09\u5168\u91cf\u5feb\u7167\u8868</p> <p>\u79bb\u7ebf\u6570\u636e\u4ed3\u5e93\u7684\u8ba1\u7b97\u5468\u671f\u901a\u5e38\u4e3a\u6bcf\u5929\u4e00\u6b21\uff0c\u6240\u4ee5\u53ef\u4ee5\u6bcf\u5929\u4fdd\u5b58\u4e00\u4efd\u5168\u91cf\u7684\u7ef4\u5ea6\u6570\u636e\u3002\u8fd9\u79cd\u65b9\u5f0f\u7684\u4f18\u70b9\u548c\u7f3a\u70b9\u90fd\u5f88\u660e\u663e\u3002</p> <p>\u4f18\u70b9\uff1a\u7b80\u5355\u800c\u6709\u6548\uff0c\u5f00\u53d1\u548c\u7ef4\u62a4\u6210\u672c\u4f4e\uff0c\u4e14\u65b9\u4fbf\u7406\u89e3\u548c\u4f7f\u7528   </p> <p>\u7f3a\u70b9\uff1a\u6d6a\u8d39\u5b58\u50a8\u7a7a\u95f4\uff0c\u5c24\u5176\u662f\u5f53\u6570\u636e\u7684\u53d8\u5316\u6bd4\u4f8b\u6bd4\u8f83\u4f4e\u65f6</p> <p>2\uff09\u62c9\u94fe\u8868</p> <p>\u62c9\u94fe\u8868\u7684\u610f\u4e49\u5c31\u5728\u4e8e\u80fd\u591f\u66f4\u52a0\u9ad8\u6548\u7684\u4fdd\u5b58\u7ef4\u5ea6\u4fe1\u606f\u7684\u5386\u53f2\u72b6\u6001</p> <p>\uff081\uff09\u4ec0\u4e48\u662f\u62c9\u94fe\u8868</p> <p></p> <p>\uff082\uff09\u4e3a\u4ec0\u4e48\u8981\u505a\u62c9\u94fe\u8868</p> <p></p> <p>\uff083\uff09\u5982\u4f55\u4f7f\u7528\u62c9\u94fe\u8868</p> <p></p>"},{"location":"project/dataware_04/#433","title":"4.3.3 \u591a\u503c\u7ef4\u5ea6","text":"<p>\u5982\u679c\u4e8b\u5b9e\u8868\u4e2d\u4e00\u6761\u8bb0\u5f55\u5728\u67d0\u4e2a\u7ef4\u5ea6\u8868\u4e2d\u6709\u591a\u6761\u8bb0\u5f55\u4e0e\u4e4b\u5bf9\u5e94\uff0c\u79f0\u4e3a\u591a\u503c\u7ef4\u5ea6\u3002\u4f8b\u5982\uff0c\u4e0b\u5355\u4e8b\u5b9e\u8868\u4e2d\u7684\u4e00\u6761\u8bb0\u5f55\u4e3a\u4e00\u4e2a\u8ba2\u5355\uff0c\u4e00\u4e2a\u8ba2\u5355\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u5546\u54c1\uff0c\u6240\u4f1a\u5546\u54c1\u7ef4\u5ea6\u8868\u4e2d\u5c31\u53ef\u80fd\u6709\u591a\u6761\u6570\u636e\u4e0e\u4e4b\u5bf9\u5e94\u3002</p> <p>\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u901a\u5e38\u91c7\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u6848\u89e3\u51b3\u3002</p> <p>\u7b2c\u4e00\u79cd\uff1a\u964d\u4f4e\u4e8b\u5b9e\u8868\u7684\u7c92\u5ea6\uff0c\u4f8b\u5982\u5c06\u8ba2\u5355\u4e8b\u5b9e\u8868\u7684\u7c92\u5ea6\u7531\u4e00\u4e2a\u8ba2\u5355\u964d\u4f4e\u4e3a\u4e00\u4e2a\u8ba2\u5355\u4e2d\u7684\u4e00\u4e2a\u5546\u54c1\u9879\u3002</p> <p>\u7b2c\u4e8c\u79cd\uff1a\u5728\u4e8b\u5b9e\u8868\u4e2d\u91c7\u7528\u591a\u5b57\u6bb5\u4fdd\u5b58\u591a\u4e2a\u7ef4\u5ea6\u503c\uff0c\u6bcf\u4e2a\u5b57\u6bb5\u4fdd\u5b58\u4e00\u4e2a\u7ef4\u5ea6 id\u3002\u8fd9\u79cd\u65b9\u6848\u53ea\u9002\u7528\u4e8e\u591a\u503c\u7ef4\u5ea6\u4e2a\u6570\u56fa\u5b9a\u7684\u60c5\u51b5\u3002</p> <p>\u5efa\u8bae\u5c3d\u91cf\u91c7\u7528\u7b2c\u4e00\u79cd\u65b9\u6848\u89e3\u51b3\u591a\u503c\u7ef4\u5ea6\u95ee\u9898\u3002</p>"},{"location":"project/dataware_04/#434","title":"4.3.4 \u591a\u503c\u5c5e\u6027","text":"<p>\u7ef4\u8868\u4e2d\u7684\u67d0\u4e2a\u5c5e\u6027\u540c\u65f6\u6709\u591a\u4e2a\u503c\uff0c\u79f0\u4e4b\u4e3a\u201c\u591a\u503c\u5c5e\u6027\u201d\uff0c\u4f8b\u5982\u5546\u54c1\u7ef4\u5ea6\u7684\u5e73\u53f0\u5c5e\u6027\u548c\u9500\u552e\u5c5e\u6027\uff0c\u6bcf\u4e2a\u5546\u54c1\u5747\u6709\u591a\u4e2a\u5c5e\u6027\u503c\u3002</p> <p>\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u901a\u5e38\u6709\u53ef\u4ee5\u91c7\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u6848\u3002</p> <p>\u7b2c\u4e00\u79cd\uff1a\u5c06\u591a\u503c\u5c5e\u6027\u653e\u5230\u4e00\u4e2a\u5b57\u6bb5\uff0c\u8be5\u5b57\u6bb5\u5185\u5bb9\u4e3a key1:value1\uff0ckey2:value2 \u7684\u5f62\u5f0f\uff0c\u4f8b\u5982\u4e00\u4e2a\u624b\u673a\u5546\u54c1\u7684\u5e73\u53f0\u5c5e\u6027\u503c\u4e3a\u201c\u54c1\u724c:\u534e\u4e3a\uff0c\u7cfb\u7edf:\u9e3f\u8499\uff0cCPU:\u9e92\u9e9f990\u201d\u3002</p> <p>\u7b2c\u4e8c\u79cd\uff1a\u5c06\u591a\u503c\u5c5e\u6027\u653e\u5230\u591a\u4e2a\u5b57\u6bb5\uff0c\u6bcf\u4e2a\u5b57\u6bb5\u5bf9\u5e94\u4e00\u4e2a\u5c5e\u6027\u3002\u8fd9\u79cd\u65b9\u6848\u53ea\u9002\u7528\u4e8e\u591a\u503c\u5c5e\u6027\u4e2a\u6570\u56fa\u5b9a\u7684\u60c5\u51b5\u3002</p>"},{"location":"project/dataware_05/","title":"\u7b2c5\u7ae0 \u6570\u636e\u4ed3\u5e93\u8bbe\u8ba1","text":""},{"location":"project/dataware_05/#51","title":"5.1 \u6570\u636e\u4ed3\u5e93\u5206\u5c42\u89c4\u5212","text":"<p>\u4f18\u79c0\u53ef\u9760\u7684\u6570\u4ed3\u4f53\u7cfb\uff0c\u9700\u8981\u826f\u597d\u7684\u6570\u636e\u5206\u5c42\u7ed3\u6784\u3002\u5408\u7406\u7684\u5206\u5c42\uff0c\u80fd\u591f\u4f7f\u6570\u636e\u4f53\u7cfb\u66f4\u52a0\u6e05\u6670\uff0c\u4f7f\u590d\u6742\u95ee\u9898\u5f97\u4ee5\u7b80\u5316\u3002\u4ee5\u4e0b\u662f\u8be5\u9879\u76ee\u7684\u5206\u5c42\u89c4\u5212\u3002</p> <p></p>"},{"location":"project/dataware_05/#52","title":"5.2 \u6570\u636e\u4ed3\u5e93\u6784\u5efa\u6d41\u7a0b","text":"\u6784\u5efa\u6570\u636e\u4ed3\u5e93\u7684\u5b8c\u6574\u6d41\u7a0b"},{"location":"project/dataware_05/#521","title":"5.2.1 \u6570\u636e\u8c03\u7814","text":"<p>\u6570\u636e\u8c03\u7814\u91cd\u70b9\u8981\u505a\u4e24\u9879\u5de5\u4f5c\uff0c\u5206\u522b\u662f\u4e1a\u52a1\u8c03\u7814\u548c\u9700\u6c42\u5206\u6790\u3002\u8fd9\u4e24\u9879\u5de5\u4f5c\u505a\u7684\u662f\u5426\u5145\u5206\uff0c\u76f4\u63a5\u5f71\u54cd\u7740\u6570\u636e\u4ed3\u5e93\u7684\u8d28\u91cf\u3002</p> <p>1\uff09\u4e1a\u52a1\u8c03\u7814</p> <p>\u4e1a\u52a1\u8c03\u7814\u7684\u4e3b\u8981\u76ee\u6807\u662f\u719f\u6089\u4e1a\u52a1\u6d41\u7a0b\u3001\u719f\u6089\u4e1a\u52a1\u6570\u636e\u3002</p> <p>\u719f\u6089\u4e1a\u52a1\u6d41\u7a0b\u8981\u6c42\u505a\u5230\uff0c\u660e\u786e\u6bcf\u4e2a\u4e1a\u52a1\u7684\u5177\u4f53\u6d41\u7a0b\uff0c\u9700\u8981\u5c06\u8be5\u4e1a\u52a1\u6240\u5305\u542b\u7684\u6bcf\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u4e00\u4e00\u5217\u4e3e\u51fa\u6765\u3002</p> <p>\u719f\u6089\u4e1a\u52a1\u6570\u636e\u8981\u6c42\u505a\u5230\uff0c\u5c06\u6570\u636e\uff08\u5305\u62ec\u57cb\u70b9\u65e5\u5fd7\u548c\u4e1a\u52a1\u6570\u636e\u8868\uff09\u4e0e\u4e1a\u52a1\u8fc7\u7a0b\u5bf9\u5e94\u8d77\u6765\uff0c\u660e\u786e\u6bcf\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u4f1a\u5bf9\u54ea\u4e9b\u8868\u7684\u6570\u636e\u4ea7\u751f\u5f71\u54cd\uff0c\u4ee5\u53ca\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u3002\u4ea7\u751f\u7684\u5f71\u54cd\uff0c\u9700\u8981\u5177\u4f53\u5230\uff0c\u662f\u65b0\u589e\u4e00\u6761\u6570\u636e\uff0c\u8fd8\u662f\u4fee\u6539\u4e00\u6761\u6570\u636e\uff0c\u5e76\u4e14\u9700\u8981\u660e\u786e\u65b0\u589e\u7684\u5185\u5bb9\u6216\u8005\u662f\u4fee\u6539\u7684\u903b\u8f91\u3002</p> <p>\u4e0b\u9762\u4e1a\u52a1\u7535\u5546\u4e2d\u7684\u4ea4\u6613\u4e3a\u4f8b\u8fdb\u884c\u6f14\u793a\uff0c\u4ea4\u6613\u4e1a\u52a1\u6d89\u53ca\u5230\u7684\u4e1a\u52a1\u8fc7\u7a0b\u6709\u4e70\u5bb6\u4e0b\u5355\u3001\u4e70\u5bb6\u652f\u4ed8\u3001\u5356\u5bb6\u53d1\u8d27\uff0c\u4e70\u5bb6\u6536\u8d27\uff0c\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p>\u5178\u578b\u7684\u9700\u6c42\u6307\u6807\u5982\uff0c\u6700\u8fd1\u4e00\u5929\u5404\u7701\u4efd\u624b\u673a\u54c1\u7c7b\u8ba2\u5355\u603b\u989d\u3002</p> <p>\u5206\u6790\u9700\u6c42\u65f6\uff0c\u9700\u8981\u660e\u786e\u9700\u6c42\u6240\u9700\u7684\u4e1a\u52a1\u8fc7\u7a0b\u53ca\u7ef4\u5ea6\uff0c\u4f8b\u5982\u8be5\u9700\u6c42\u6240\u9700\u7684\u4e1a\u52a1\u8fc7\u7a0b\u5c31\u662f\u4e70\u5bb6\u4e0b\u5355\uff0c\u6240\u9700\u7684\u7ef4\u5ea6\u6709\u65e5\u671f\uff0c\u7701\u4efd\uff0c\u5546\u54c1\u54c1\u7c7b\u3002</p> <p>3\uff09\u603b\u7ed3</p> <p>\u505a\u5b8c\u4e1a\u52a1\u5206\u6790\u548c\u9700\u6c42\u5206\u6790\u4e4b\u540e\uff0c\u8981\u4fdd\u8bc1\u6bcf\u4e2a\u9700\u6c42\u90fd\u80fd\u627e\u5230\u4e0e\u4e4b\u5bf9\u5e94\u7684\u4e1a\u52a1\u8fc7\u7a0b\u53ca\u7ef4\u5ea6\u3002\u82e5\u73b0\u6709\u6570\u636e\u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\uff0c\u5219\u9700\u8981\u548c\u4e1a\u52a1\u65b9\u8fdb\u884c\u6c9f\u901a\uff0c\u4f8b\u5982\u67d0\u4e2a\u9875\u9762\u9700\u8981\u65b0\u589e\u67d0\u4e2a\u884c\u4e3a\u7684\u57cb\u70b9\u3002</p>"},{"location":"project/dataware_05/#522","title":"5.2.2 \u660e\u786e\u6570\u636e\u57df","text":"<p>\u6570\u636e\u4ed3\u5e93\u6a21\u578b\u8bbe\u8ba1\u9664\u6a2a\u5411\u7684\u5206\u5c42\u5916\uff0c\u901a\u5e38\u4e5f\u9700\u8981\u6839\u636e\u4e1a\u52a1\u60c5\u51b5\u8fdb\u884c\u7eb5\u5411\u5212\u5206\u6570\u636e\u57df\u3002 \u5212\u5206\u6570\u636e\u57df\u7684\u610f\u4e49\u662f\u4fbf\u4e8e\u6570\u636e\u7684\u7ba1\u7406\u548c\u5e94\u7528\u3002</p> <p>\u901a\u5e38\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u8fc7\u7a0b\u6216\u8005\u90e8\u95e8\u8fdb\u884c\u5212\u5206\uff0c\u672c\u9879\u76ee\u6839\u636e\u4e1a\u52a1\u8fc7\u7a0b\u8fdb\u884c\u5212\u5206\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e00\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u53ea\u80fd\u5c5e\u4e8e\u4e00\u4e2a\u6570\u636e\u57df\u3002</p> <p>\u4e0b\u9762\u662f\u672c\u9879\u76ee\u6240\u6709\u4e1a\u52a1\u8fc7\u7a0b\u53ca\u6570\u636e\u57df\u5212\u5206\u8be6\u60c5\u3002</p> \u6570\u636e\u57df \u4e1a\u52a1\u8fc7\u7a0b \u4ea4\u6613\u57df \u52a0\u8d2d\u7269\u8f66\u3001\u51cf\u8d2d\u7269\u8f66\u3001\u4e0b\u5355\u3001\u652f\u4ed8\u5b8c\u6210\u3001\u786e\u8ba4\u6536\u8d27\u3001\u9000\u5355\u3001\u9000\u6b3e\u5b8c\u6210 \u6d41\u91cf\u57df \u9875\u9762\u6d4f\u89c8\u3001\u542f\u52a8\u5e94\u7528\u3001\u52a8\u4f5c\u3001\u66dd\u5149\u3001\u9519\u8bef \u7528\u6237\u57df \u6ce8\u518c\u3001\u767b\u5f55 \u4e92\u52a8\u57df \u6536\u85cf\u3001\u8bc4\u4ef7 \u5de5\u5177\u57df \u4f18\u60e0\u5238\u9886\u53d6\u3001\u4f18\u60e0\u5238\u4f7f\u7528\uff08\u4e0b\u5355\uff09\u3001\u4f18\u60e0\u5238\u4f7f\u7528\uff08\u652f\u4ed8\uff09"},{"location":"project/dataware_05/#523","title":"5.2.3 \u6784\u5efa\u4e1a\u52a1\u603b\u7ebf\u77e9\u9635","text":"<p>\u4e1a\u52a1\u603b\u7ebf\u77e9\u9635\u4e2d\u5305\u542b\u7ef4\u5ea6\u6a21\u578b\u6240\u9700\u7684\u6240\u6709\u4e8b\u5b9e\uff08\u4e1a\u52a1\u8fc7\u7a0b\uff09\u4ee5\u53ca\u7ef4\u5ea6\uff0c\u4ee5\u53ca\u5404\u4e1a\u52a1\u8fc7\u7a0b\u4e0e\u5404\u7ef4\u5ea6\u7684\u5173\u7cfb\u3002\u77e9\u9635\u7684\u884c\u662f\u4e00\u4e2a\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\uff0c\u77e9\u9635\u7684\u5217\u662f\u4e00\u4e2a\u4e2a\u7684\u7ef4\u5ea6\uff0c\u884c\u5217\u7684\u4ea4\u70b9\u8868\u793a\u4e1a\u52a1\u8fc7\u7a0b\u4e0e\u7ef4\u5ea6\u7684\u5173\u7cfb\u3002</p> <p></p> <p>\u4e00\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u5bf9\u5e94\u7ef4\u5ea6\u6a21\u578b\u4e2d\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u4e00\u4e2a\u7ef4\u5ea6\u5219\u5bf9\u5e94\u7ef4\u5ea6\u6a21\u578b\u4e2d\u7684\u4e00\u5f20\u7ef4\u5ea6\u8868\u3002\u6240\u4ee5\u6784\u5efa\u4e1a\u52a1\u603b\u7ebf\u77e9\u9635\u7684\u8fc7\u7a0b\u5c31\u662f\u8bbe\u8ba1\u7ef4\u5ea6\u6a21\u578b\u7684\u8fc7\u7a0b\u3002\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u603b\u7ebf\u77e9\u9635\u4e2d\u901a\u5e38\u53ea\u5305\u542b\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u53e6\u5916\u4e24\u79cd\u7c7b\u578b\u7684\u4e8b\u5b9e\u8868\u9700\u5355\u72ec\u8bbe\u8ba1\u3002\u5f97\u5230\u7684\u6700\u7ec8\u7684\u4e1a\u52a1\u603b\u7ebf\u77e9\u9635\u89c1\u4ee5\u4e0b\u8868\u683c\u3002</p> <p></p> <p>\u540e\u7eed\u7684 DWD \u5c42\u4ee5\u53ca DIM \u5c42\u7684\u642d\u5efa\u9700\u53c2\u8003\u4e1a\u52a1\u603b\u7ebf\u77e9\u9635\u3002</p>"},{"location":"project/dataware_05/#524","title":"5.2.4 \u660e\u786e\u7edf\u8ba1\u6307\u6807","text":"<p>\u660e\u786e\u7edf\u8ba1\u6307\u6807\u5177\u4f53\u7684\u5de5\u4f5c\u662f\uff0c\u6df1\u5165\u5206\u6790\u9700\u6c42\uff0c\u6784\u5efa\u6307\u6807\u4f53\u7cfb\u3002\u6784\u5efa\u6307\u6807\u4f53\u7cfb\u7684\u4e3b\u8981\u610f\u4e49\u5c31\u662f\u6307\u6807\u5b9a\u4e49\u6807\u51c6\u5316\u3002\u6240\u6709\u6307\u6807\u7684\u5b9a\u4e49\uff0c\u90fd\u5fc5\u987b\u9075\u5faa\u540c\u4e00\u5957\u6807\u51c6\uff0c\u8fd9\u6837\u80fd\u6709\u6548\u7684\u907f\u514d\u6307\u6807\u5b9a\u4e49\u5b58\u5728\u6b67\u4e49\uff0c\u6307\u6807\u5b9a\u4e49\u91cd\u590d\u7b49\u95ee\u9898\u3002</p> <p>1\uff09\u6307\u6807\u4f53\u7cfb\u76f8\u5173\u6982\u5ff5</p> <p>\uff081\uff09\u539f\u5b50\u6307\u6807</p> <p>\u539f\u5b50\u6307\u6807\u57fa\u4e8e\u67d0\u4e00\u4e1a\u52a1\u8fc7\u7a0b\u7684\u5ea6\u91cf\u503c\uff0c\u662f\u4e1a\u52a1\u5b9a\u4e49\u4e2d\u4e0d\u53ef\u518d\u62c6\u89e3\u7684\u6307\u6807\uff0c\u539f\u5b50\u6307\u6807\u7684\u6838\u5fc3\u529f\u80fd\u5c31\u662f\u5bf9\u6307\u6807\u7684\u805a\u5408\u903b\u8f91\u8fdb\u884c\u4e86\u5b9a\u4e49\u3002\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u7ed3\u8bba\uff0c\u539f\u5b50\u6307\u6807\u5305\u542b\u4e09\u8981\u7d20\uff0c\u5206\u522b\u662f\u4e1a\u52a1\u8fc7\u7a0b\u3001\u5ea6\u91cf\u503c\u548c\u805a\u5408\u903b\u8f91\u3002</p> <p>\u4f8b\u5982\u8ba2\u5355\u603b\u989d\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684\u539f\u5b50\u6307\u6807\uff0c\u5176\u4e2d\u7684\u4e1a\u52a1\u8fc7\u7a0b\u4e3a\u7528\u6237\u4e0b\u5355\u3001\u5ea6\u91cf\u503c\u4e3a\u8ba2\u5355\u91d1\u989d\uff0c\u805a\u5408\u903b\u8f91\u4e3a sum() \u6c42\u548c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u539f\u5b50\u6307\u6807\u53ea\u662f\u7528\u6765\u8f85\u52a9\u5b9a\u4e49\u6307\u6807\u4e00\u4e2a\u6982\u5ff5\uff0c\u901a\u5e38\u4e0d\u4f1a\u5bf9\u5e94\u6709\u5b9e\u9645\u7edf\u8ba1\u9700\u6c42\u4e0e\u4e4b\u5bf9\u5e94\u3002</p> <p>\uff082\uff09\u6d3e\u751f\u6307\u6807 \u6d3e\u751f\u6307\u6807\u57fa\u4e8e\u539f\u5b50\u6307\u6807\uff0c\u5176\u4e0e\u539f\u5b50\u6307\u6807\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u4e0e\u539f\u5b50\u6307\u6807\u4e0d\u540c\uff0c\u6d3e\u751f\u6307\u6807\u901a\u5e38\u4f1a\u5bf9\u5e94\u5b9e\u9645\u7684\u7edf\u8ba1\u9700\u6c42\u3002\u8bf7\u4ece\u56fe\u4e2d\u7684\u4f8b\u5b50\u4e2d\uff0c\u4f53\u4f1a\u6307\u6807\u5b9a\u4e49\u6807\u51c6\u5316\u7684\u542b\u4e49\u3002</p> <p>\uff083\uff09\u884d\u751f\u6307\u6807 \u884d\u751f\u6307\u6807\u662f\u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u6d3e\u751f\u6307\u6807\u7684\u57fa\u7840\u4e0a\uff0c\u901a\u8fc7\u5404\u79cd\u903b\u8f91\u8fd0\u7b97\u590d\u5408\u800c\u6210\u7684\u3002\u4f8b\u5982\u6bd4\u7387\u3001\u6bd4\u4f8b\u7b49\u7c7b\u578b\u7684\u6307\u6807\u3002\u884d\u751f\u6307\u6807\u4e5f\u4f1a\u5bf9\u5e94\u5b9e\u9645\u7684\u7edf\u8ba1\u9700\u6c42\u3002</p> <p></p> <p>2\uff09\u6307\u6807\u4f53\u7cfb\u5bf9\u4e8e\u6570\u4ed3\u5efa\u6a21\u7684\u610f\u4e49</p> <p>\u901a\u8fc7\u4e0a\u8ff0\u4e24\u4e2a\u5177\u4f53\u7684\u6848\u4f8b\u53ef\u4ee5\u770b\u51fa\uff0c\u7edd\u5927\u591a\u6570\u7684\u7edf\u8ba1\u9700\u6c42\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528\u539f\u5b50\u6307\u6807\u3001\u6d3e\u751f\u6307\u6807\u4ee5\u53ca\u884d\u751f\u6307\u6807\u8fd9\u5957\u6807\u51c6\u53bb\u5b9a\u4e49\u3002\u540c\u65f6\u80fd\u591f\u53d1\u73b0\u8fd9\u4e9b\u7edf\u8ba1\u9700\u6c42\u90fd\u76f4\u63a5\u7684\u6216\u95f4\u63a5\u7684\u5bf9\u5e94\u4e00\u4e2a\u6216\u8005\u662f\u591a\u4e2a\u6d3e\u751f\u6307\u6807\u3002</p> <p>\u5f53\u7edf\u8ba1\u9700\u6c42\u8db3\u591f\u591a\u65f6\uff0c\u5fc5\u7136\u4f1a\u51fa\u73b0\u90e8\u5206\u7edf\u8ba1\u9700\u6c42\u5bf9\u5e94\u7684\u6d3e\u751f\u6307\u6807\u76f8\u540c\u7684\u60c5\u51b5\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u5c06\u8fd9\u4e9b\u516c\u5171\u7684\u6d3e\u751f\u6307\u6807\u4fdd\u5b58\u4e0b\u6765\uff0c\u8fd9\u6837\u505a\u7684\u4e3b\u8981\u76ee\u7684\u5c31\u662f\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\uff0c\u63d0\u9ad8\u6570\u636e\u7684\u590d\u7528\u6027\u3002</p> <p>\u8fd9\u4e9b\u516c\u5171\u7684\u6d3e\u751f\u6307\u6807\u7edf\u4e00\u4fdd\u5b58\u5728\u6570\u636e\u4ed3\u5e93\u7684 DWS \u5c42\u3002\u56e0\u6b64 DWS \u5c42\u8bbe\u8ba1\uff0c\u5c31\u53ef\u4ee5\u53c2\u8003\u6211\u4eec\u6839\u636e\u73b0\u6709\u7684\u7edf\u8ba1\u9700\u6c42\u6574\u7406\u51fa\u7684\u6d3e\u751f\u6307\u6807\u3002</p> <p>\u6309\u7167\u4e0a\u8ff0\u6807\u51c6\u6574\u7406\u51fa\u7684\u6307\u6807\u4f53\u7cfb\u5982\u4e0b\uff1a</p> \u8868\u683c\u601d\u7ef4\u5bfc\u56fe <p></p> <p></p>"},{"location":"project/dataware_05/#524_1","title":"5.2.4 \u7ef4\u5ea6\u6a21\u578b\u8bbe\u8ba1","text":"<p>\u7ef4\u5ea6\u6a21\u578b\u7684\u8bbe\u8ba1\u53c2\u7167\u4e0a\u8ff0\u5f97\u5230\u7684\u4e1a\u52a1\u603b\u7ebf\u77e9\u9635\u5373\u53ef\u3002\u4e8b\u5b9e\u8868\u5b58\u50a8\u5728 DWD \u5c42\uff0c\u7ef4\u5ea6\u8868\u5b58\u50a8\u5728 DIM \u5c42\u3002</p>"},{"location":"project/dataware_05/#525","title":"5.2.5 \u6c47\u603b\u6a21\u578b\u8bbe\u8ba1","text":"<p>\u6c47\u603b\u6a21\u578b\u7684\u8bbe\u8ba1\u53c2\u8003\u4e0a\u8ff0\u6574\u7406\u51fa\u7684\u6307\u6807\u4f53\u7cfb\uff08\u4e3b\u8981\u662f\u6d3e\u751f\u6307\u6807\uff09\u5373\u53ef\u3002\u6c47\u603b\u8868\u4e0e\u6d3e\u751f\u6307\u6807\u7684\u5bf9\u5e94\u5173\u7cfb\u662f\uff0c\u4e00\u5f20\u6c47\u603b\u8868\u901a\u5e38\u5305\u542b\u4e1a\u52a1\u8fc7\u7a0b\u76f8\u540c\u3001\u7edf\u8ba1\u5468\u671f\u76f8\u540c\u3001\u7edf\u8ba1\u7c92\u5ea6\u76f8\u540c\u7684\u591a\u4e2a\u6d3e\u751f\u6307\u6807\u3002</p>"},{"location":"schedule/ds/01/","title":"\u7b2c1\u7ae0 DolphinScheduler\u7b80\u4ecb","text":""},{"location":"schedule/ds/01/#11-dolphinscheduler","title":"1.1 DolphinScheduler\u6982\u8ff0","text":"<p>Apache DolphinScheduler \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u3001\u6613\u6269\u5c55\u7684\u53ef\u89c6\u5316 DAG \u5de5\u4f5c\u6d41\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\u3002\u81f4\u529b\u4e8e\u89e3\u51b3\u6570\u636e\u5904\u7406\u6d41\u7a0b\u4e2d\u9519\u7efc\u590d\u6742\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u4f7f\u8c03\u5ea6\u7cfb\u7edf\u5728\u6570\u636e\u5904\u7406\u6d41\u7a0b\u4e2d\u5f00\u7bb1\u5373\u7528\u3002</p>"},{"location":"schedule/ds/01/#12-dolphinscheduler","title":"1.2 DolphinScheduler\u6838\u5fc3\u67b6\u6784","text":"<p>DolphinScheduler \u7684\u4e3b\u8981\u89d2\u8272\u5982\u4e0b\uff1a</p> <ul> <li>MasterServer \u91c7\u7528\u5206\u5e03\u5f0f\u65e0\u4e2d\u5fc3\u8bbe\u8ba1\u7406\u5ff5\uff0cMasterServer \u4e3b\u8981\u8d1f\u8d23 DAG \u4efb\u52a1\u5207\u5206\u3001\u4efb\u52a1\u63d0\u4ea4\u3001\u4efb\u52a1\u76d1\u63a7\uff0c\u5e76\u540c\u65f6\u76d1\u542c\u5176\u5b83 MasterServer \u548c WorkerServer \u7684\u5065\u5eb7\u72b6\u6001\u3002</li> <li>WorkerServer \u4e5f\u91c7\u7528\u5206\u5e03\u5f0f\u65e0\u4e2d\u5fc3\u8bbe\u8ba1\u7406\u5ff5\uff0cWorkerServer \u4e3b\u8981\u8d1f\u8d23\u4efb\u52a1\u7684\u6267\u884c\u548c\u63d0\u4f9b\u65e5\u5fd7\u670d\u52a1\u3002</li> <li>ZooKeeper \u670d\u52a1\uff0c\u7cfb\u7edf\u4e2d\u7684 MasterServer \u548c WorkerServer \u8282\u70b9\u90fd\u901a\u8fc7 ZooKeeper \u6765\u8fdb\u884c\u96c6\u7fa4\u7ba1\u7406\u548c\u5bb9\u9519\u3002</li> <li>Alert \u670d\u52a1\uff0c\u63d0\u4f9b\u544a\u8b66\u76f8\u5173\u670d\u52a1\u3002</li> <li>API \u63a5\u53e3\u5c42\uff0c\u4e3b\u8981\u8d1f\u8d23\u5904\u7406\u524d\u7aef UI \u5c42\u7684\u8bf7\u6c42\u3002</li> <li>UI\uff0c\u7cfb\u7edf\u7684\u524d\u7aef\u9875\u9762\uff0c\u63d0\u4f9b\u7cfb\u7edf\u7684\u5404\u79cd\u53ef\u89c6\u5316\u64cd\u4f5c\u754c\u9762\u3002</li> </ul> <p> </p> DophinScheduler\u6838\u5fc3\u67b6\u6784"},{"location":"schedule/ds/02/","title":"\u7b2c2\u7ae0 DolphinScheduler\u90e8\u7f72\u8bf4\u660e","text":""},{"location":"schedule/ds/02/#21","title":"2.1 \u8f6f\u786c\u4ef6\u73af\u5883\u8981\u6c42","text":""},{"location":"schedule/ds/02/#211","title":"2.1.1 \u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u8981\u6c42","text":"\u64cd\u4f5c\u7cfb\u7edf \u7248\u672c Red Hat Enterprise Linux 7.0 \u53ca\u4ee5\u4e0a CentOS 7.0 \u53ca\u4ee5\u4e0a Oracle Enterprise Linux 7.0 \u53ca\u4ee5\u4e0a Ubuntu LTS 16.04 \u53ca\u4ee5\u4e0a"},{"location":"schedule/ds/02/#212","title":"2.1.2 \u670d\u52a1\u5668\u786c\u4ef6\u8981\u6c42","text":"CPU \u5185\u5b58 \u786c\u76d8\u7c7b\u578b \u7f51\u7edc \u5b9e\u4f8b\u6570\u91cf 4\u6838+ 8 GB+ SAS \u5343\u5146\u7f51\u5361 1+"},{"location":"schedule/ds/02/#22","title":"2.2 \u90e8\u7f72\u6a21\u5f0f","text":"<p>DolphinScheduler \u652f\u6301\u591a\u79cd\u90e8\u7f72\u6a21\u5f0f\uff0c\u5305\u62ec\u5355\u673a\u6a21\u5f0f\uff08Standalone\uff09\u3001\u4f2a\u96c6\u7fa4\u6a21\u5f0f\uff08Pseudo-Cluster\uff09\u3001\u96c6\u7fa4\u6a21\u5f0f\uff08Cluster\uff09\u7b49\u3002</p>"},{"location":"schedule/ds/02/#221","title":"2.2.1 \u5355\u673a\u6a21\u5f0f","text":"<p>\u5355\u673a\u6a21\u5f0f\uff08standalone\uff09\u6a21\u5f0f\u4e0b\uff0c\u6240\u6709\u670d\u52a1\u5747\u96c6\u4e2d\u4e8e\u4e00\u4e2a StandaloneServer \u8fdb\u7a0b\u4e2d\uff0c\u5e76\u4e14\u5176\u4e2d\u5185\u7f6e\u4e86\u6ce8\u518c\u4e2d\u5fc3 Zookeeper \u548c\u6570\u636e\u5e93 H2\u3002\u53ea\u9700\u914d\u7f6e JDK \u73af\u5883\uff0c\u5c31\u53ef\u4e00\u952e\u542f\u52a8 DolphinScheduler\uff0c\u5feb\u901f\u4f53\u9a8c\u5176\u529f\u80fd\u3002</p>"},{"location":"schedule/ds/02/#222","title":"2.2.2 \u4f2a\u96c6\u7fa4\u6a21\u5f0f","text":"<p>\u4f2a\u96c6\u7fa4\u6a21\u5f0f\uff08Pseudo-Cluster\uff09\u662f\u5728\u5355\u53f0\u673a\u5668\u90e8\u7f72 DolphinScheduler \u5404\u9879\u670d\u52a1\uff0c\u8be5\u6a21\u5f0f\u4e0b master\u3001worker\u3001api server\u3001logger server \u7b49\u670d\u52a1\u90fd\u53ea\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u3002Zookeeper \u548c\u6570\u636e\u5e93\u9700\u5355\u72ec\u5b89\u88c5\u5e76\u8fdb\u884c\u76f8\u5e94\u914d\u7f6e\u3002</p>"},{"location":"schedule/ds/02/#223","title":"2.2.3 \u96c6\u7fa4\u6a21\u5f0f","text":"<p>\u96c6\u7fa4\u6a21\u5f0f\uff08Cluster\uff09\u4e0e\u4f2a\u96c6\u7fa4\u6a21\u5f0f\u7684\u533a\u522b\u5c31\u662f\u5728\u591a\u53f0\u673a\u5668\u90e8\u7f72 DolphinScheduler \u5404\u9879\u670d\u52a1\uff0c\u5e76\u4e14 Master\u3001Worker \u7b49\u670d\u52a1\u53ef\u914d\u7f6e\u591a\u4e2a\u3002</p>"},{"location":"schedule/ds/03/","title":"\u7b2c3\u7ae0 DolphinScheduler\u96c6\u7fa4\u6a21\u5f0f\u90e8\u7f72","text":""},{"location":"schedule/ds/03/#31","title":"3.1 \u96c6\u7fa4\u89c4\u5212","text":"<p>\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0c\u53ef\u914d\u7f6e\u591a\u4e2a Master \u53ca\u591a\u4e2a Worker\u3002\u901a\u5e38\u53ef\u914d\u7f6e 2 ~ 3 \u4e2a Master\uff0c\u82e5\u5e72\u4e2a Worker\u3002\u7531\u4e8e\u96c6\u7fa4\u8d44\u6e90\u6709\u9650\uff0c\u6b64\u5904\u914d\u7f6e\u4e00\u4e2a Master\uff0c\u4e09\u4e2a Worker\uff0c\u96c6\u7fa4\u89c4\u5212\u5982\u4e0b\u3002</p> hadoop102 master\u3001worker hadoop103 worker hadoop104 worker"},{"location":"schedule/ds/03/#32","title":"3.2 \u524d\u7f6e\u51c6\u5907\u5de5\u4f5c","text":"<p>\uff081\uff09\u4e09\u53f0\u8282\u70b9\u5747\u9700\u90e8\u7f72 JDK\uff081.8+\uff09\uff0c\u5e76\u914d\u7f6e\u76f8\u5173\u73af\u5883\u53d8\u91cf\u3002</p> <p>\uff082\uff09\u9700\u90e8\u7f72\u6570\u636e\u5e93\uff0c\u652f\u6301 MySQL\uff085.7+\uff09\u6216\u8005 PostgreSQL\uff088.2.15+\uff09\u3002</p> <p>\uff083\uff09\u9700\u90e8\u7f72 Zookeeper\uff083.4.6+\uff09\u3002</p> <p>\uff084\uff09\u4e09\u53f0\u8282\u70b9\u5747\u9700\u5b89\u88c5\u8fdb\u7a0b\u6811\u5206\u6790\u5de5\u5177 psmisc\u3002</p> <pre><code>sudo yum install -y psmisc\n</code></pre>"},{"location":"schedule/ds/03/#33-dolphinscheduler","title":"3.3 \u89e3\u538bDolphinScheduler\u5b89\u88c5\u5305","text":"<p>\uff081\uff09\u4e0a\u4f20 DolphinScheduler \u5b89\u88c5\u5305\u5230 hadoop102 \u8282\u70b9\u7684 /opt/software \u76ee\u5f55</p> <p>\uff082\uff09\u89e3\u538b\u5b89\u88c5\u5305\u5230\u5f53\u524d\u76ee\u5f55</p> <p>\u6ce8</p> <p>\u89e3\u538b\u76ee\u5f55\u5e76\u975e\u6700\u7ec8\u7684\u5b89\u88c5\u76ee\u5f55</p> <pre><code>tar -zxvf apache-dolphinscheduler-2.0.5-bin </code></pre>"},{"location":"schedule/ds/03/#34","title":"3.4 \u521b\u5efa\u5143\u6570\u636e\u5e93\u53ca\u7528\u6237","text":"<p>DolphinScheduler \u5143\u6570\u636e\u5b58\u50a8\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\uff0c\u6545\u9700\u521b\u5efa\u76f8\u5e94\u7684\u6570\u636e\u5e93\u548c\u7528\u6237\u3002</p> <p>\uff081\uff09\u521b\u5efa\u6570\u636e\u5e93</p> <pre><code>CREATE DATABASE dolphinscheduler DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;\n</code></pre> <p>\uff082\uff09\u521b\u5efa\u7528\u6237</p> <pre><code>CREATE USER 'dolphinscheduler'@'%' IDENTIFIED BY 'dolphinscheduler';\n</code></pre> <p>\u6ce8</p> <p>\u82e5\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef\u4fe1\u606f\uff0c\u8868\u660e\u65b0\u5efa\u7528\u6237\u7684\u5bc6\u7801\u8fc7\u4e8e\u7b80\u5355\u3002</p> <pre><code>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements\n</code></pre> <p>\u53ef\u63d0\u9ad8\u5bc6\u7801\u590d\u6742\u5ea6\u6216\u8005\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u964d\u4f4e MySQL \u5bc6\u7801\u5f3a\u5ea6\u7ea7\u522b\u3002</p> <pre><code>set global validate_password_policy=0;\nset global validate_password_length=4;\n</code></pre> <p>\uff083\uff09\u8d4b\u4e88\u7528\u6237\u76f8\u5e94\u6743\u9650</p> <pre><code>GRANT ALL PRIVILEGES ON dolphinscheduler.* TO 'dolphinscheduler'@'%';\nflush privileges;\n</code></pre>"},{"location":"schedule/ds/03/#35","title":"3.5 \u914d\u7f6e\u4e00\u952e\u90e8\u7f72\u811a\u672c","text":"<p>\u4fee\u6539\u89e3\u538b\u76ee\u5f55\u4e0b\u7684 conf/config \u76ee\u5f55\u4e0b\u7684 install_config.conf \u6587\u4ef6\u3002</p> <pre><code>vim conf/config/install_config.conf </code></pre> <p>\u4fee\u6539\u5185\u5bb9\u5982\u4e0b\u3002</p> install_config.conf<pre><code>#\n# Licensed to the Apache Software Foundation (ASF) under one or more\n# contributor license agreements.  See the NOTICE file distributed with\n# this work for additional information regarding copyright ownership.\n# The ASF licenses this file to You under the Apache License, Version 2.0\n# (the \"License\"); you may not use this file except in compliance with\n# the License.  You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n#\n\n# ---------------------------------------------------------\n# INSTALL MACHINE\n# ---------------------------------------------------------\n# A comma separated list of machine hostname or IP would be installed DolphinScheduler,\n# including master, worker, api, alert. If you want to deploy in pseudo-distributed\n# mode, just write a pseudo-distributed hostname\n# Example for hostnames: ips=\"ds1,ds2,ds3,ds4,ds5\", Example for IPs: ips=\"192.168.8.1,192.168.8.2,192.168.8.3,192.168.8.4,192.168.8.5\"\nips=\"hadoop102,hadoop103,hadoop104\" \n# \u5c06\u8981\u90e8\u7f72\u4efb\u4e00 DolphinScheduler \u670d\u52a1\u7684\u670d\u52a1\u5668\u4e3b\u673a\u540d\u6216 ip \u5217\u8868\n\n# Port of SSH protocol, default value is 22. For now we only support same port in all `ips` machine\n# modify it if you use different ssh port\nsshPort=\"22\"\n\n# A comma separated list of machine hostname or IP would be installed Master server, it\n# must be a subset of configuration `ips`.\n# Example for hostnames: masters=\"ds1,ds2\", Example for IPs: masters=\"192.168.8.1,192.168.8.2\"\nmasters=\"hadoop102\" \n# master \u6240\u5728\u4e3b\u673a\u540d\u5217\u8868\uff0c\u5fc5\u987b\u662f ips \u7684\u5b50\u96c6\n\n# A comma separated list of machine &lt;hostname&gt;:&lt;workerGroup&gt; or &lt;IP&gt;:&lt;workerGroup&gt;.All hostname or IP must be a\n# subset of configuration `ips`, And workerGroup have default value as `default`, but we recommend you declare behind the hosts\n# Example for hostnames: workers=\"ds1:default,ds2:default,ds3:default\", Example for IPs: workers=\"192.168.8.1:default,192.168.8.2:default,192.168.8.3:default\"\nworkers=\"hadoop102:default,hadoop103:default,hadoop104:default\" \n# worker\u4e3b\u673a\u540d\u53ca\u961f\u5217\uff0c\u6b64\u5904\u7684 ip \u5fc5\u987b\u5728 ips \u5217\u8868\u4e2d\n\n# A comma separated list of machine hostname or IP would be installed Alert server, it\n# must be a subset of configuration `ips`.\n# Example for hostname: alertServer=\"ds3\", Example for IP: alertServer=\"192.168.8.3\"\nalertServer=\"hadoop102\"\n# \u544a\u8b66\u670d\u52a1\u6240\u5728\u670d\u52a1\u5668\u4e3b\u673a\u540d\n# A comma separated list of machine hostname or IP would be installed API server, it\n# must be a subset of configuration `ips`.\n# Example for hostname: apiServers=\"ds1\", Example for IP: apiServers=\"192.168.8.1\"\napiServers=\"hadoop102\"\n# api\u670d\u52a1\u6240\u5728\u670d\u52a1\u5668\u4e3b\u673a\u540d\n\n# A comma separated list of machine hostname or IP would be installed Python gateway server, it\n# must be a subset of configuration `ips`.\n# Example for hostname: pythonGatewayServers=\"ds1\", Example for IP: pythonGatewayServers=\"192.168.8.1\"\n# pythonGatewayServers=\"ds1\" \n# \u4e0d\u9700\u8981\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u4fdd\u7559\u9ed8\u8ba4\u503c\uff0c\u4e5f\u53ef\u4ee5\u7528 # \u6ce8\u91ca\n\n# The directory to install DolphinScheduler for all machine we config above. It will automatically be created by `install.sh` script if not exists.\n# Do not set this configuration same as the current path (pwd)\ninstallPath=\"/opt/module/dolphinscheduler\"\n# DS \u5b89\u88c5\u8def\u5f84\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u4f1a\u521b\u5efa\n\n# The user to deploy DolphinScheduler for all machine we config above. For now user must create by yourself before running `install.sh`\n# script. The user needs to have sudo privileges and permissions to operate hdfs. If hdfs is enabled than the root directory needs\n# to be created by this user\ndeployUser=\"atguigu\"\n# \u90e8\u7f72\u7528\u6237\uff0c\u4efb\u52a1\u6267\u884c\u670d\u52a1\u662f\u4ee5 sudo -u {linux-user} \u5207\u6362\u4e0d\u540c Linux \u7528\u6237\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u591a\u79df\u6237\u8fd0\u884c\u4f5c\u4e1a\uff0c\u56e0\u6b64\u8be5\u7528\u6237\u5fc5\u987b\u6709\u514d\u5bc6\u7684 sudo \u6743\u9650\u3002\n\n# The directory to store local data for all machine we config above. Make sure user `deployUser` have permissions to read and write this directory.\ndataBasedirPath=\"/tmp/dolphinscheduler\"\n# \u524d\u6587\u914d\u7f6e\u7684\u6240\u6709\u8282\u70b9\u7684\u672c\u5730\u6570\u636e\u5b58\u50a8\u8def\u5f84\uff0c\u9700\u8981\u786e\u4fdd\u90e8\u7f72\u7528\u6237\u62e5\u6709\u8be5\u76ee\u5f55\u7684\u8bfb\u5199\u6743\u9650\n\n# ---------------------------------------------------------\n# DolphinScheduler ENV\n# ---------------------------------------------------------\n# JAVA_HOME, we recommend use same JAVA_HOME in all machine you going to install DolphinScheduler\n# and this configuration only support one parameter so far.\njavaHome=\"/opt/module/jdk1.8.0_212\"\n# JAVA_HOME \u8def\u5f84\n\n# DolphinScheduler API service port, also this is your DolphinScheduler UI component's URL port, default value is 12345\napiServerPort=\"12345\"\n\n# ---------------------------------------------------------\n# Database\n# NOTICE: If database value has special characters, such as `.*[]^${}\\+?|()@#&amp;`, Please add prefix `\\` for escaping.\n# ---------------------------------------------------------\n# The type for the metadata database\n# Supported values: ``postgresql``, ``mysql`, `h2``.\n# \u6ce8\u610f\uff1a\u6570\u636e\u5e93\u76f8\u5173\u914d\u7f6e\u7684 value \u5fc5\u987b\u52a0\u5f15\u53f7\uff0c\u5426\u5219\u914d\u7f6e\u65e0\u6cd5\u751f\u6548\n\nDATABASE_TYPE=\"mysql\"\n# \u6570\u636e\u5e93\u7c7b\u578b\n\n# Spring datasource url, following &lt;HOST&gt;:&lt;PORT&gt;/&lt;database&gt;?&lt;parameter&gt; format, If you using mysql, you could use jdbc\n# string jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=true&amp;characterEncoding=UTF-8 as example\n# SPRING_DATASOURCE_URL=${SPRING_DATASOURCE_URL:-\"jdbc:h2:mem:dolphinscheduler;MODE=MySQL;DB_CLOSE_DELAY=-1;DATABASE_TO_LOWER=true\"}\nSPRING_DATASOURCE_URL=\"jdbc:mysql://hadoop102:3306/dolphinscheduler?useUnicode=true&amp;characterEncoding=UTF-8\"\n# \u6570\u636e\u5e93 URL\n\n# Spring datasource username\n# SPRING_DATASOURCE_USERNAME=${SPRING_DATASOURCE_USERNAME:-\"sa\"}\nSPRING_DATASOURCE_USERNAME=\"dolphinscheduler\"\n# \u6570\u636e\u5e93\u7528\u6237\u540d\n\n# Spring datasource password\n# SPRING_DATASOURCE_PASSWORD=${SPRING_DATASOURCE_PASSWORD:-\"\"}\nSPRING_DATASOURCE_PASSWORD=\"dolphinscheduler\"\n# \u6570\u636e\u5e93\u5bc6\u7801\n\n# ---------------------------------------------------------\n# Registry Server\n# ---------------------------------------------------------\n# Registry Server plugin name, should be a substring of `registryPluginDir`, DolphinScheduler use this for verifying configuration consistency\nregistryPluginName=\"zookeeper\"\n# \u6ce8\u518c\u4e2d\u5fc3\u63d2\u4ef6\u540d\u79f0\uff0cDS \u901a\u8fc7\u6ce8\u518c\u4e2d\u5fc3\u6765\u786e\u4fdd\u96c6\u7fa4\u914d\u7f6e\u7684\u4e00\u81f4\u6027\n\n# Registry Server address.\nregistryServers=\"hadoop102:2181,hadoop103:2181,hadoop104:2181\"\n# \u6ce8\u518c\u4e2d\u5fc3\u5730\u5740\uff0c\u5373 Zookeeper \u96c6\u7fa4\u7684\u5730\u5740\n\n# Registry Namespace\nregistryNamespace=\"dolphinscheduler\"\n# DS \u5728 Zookeeper \u7684\u7ed3\u70b9\u540d\u79f0\n\n# ---------------------------------------------------------\n# Worker Task Server\n# ---------------------------------------------------------\n# Worker Task Server plugin dir. DolphinScheduler will find and load the worker task plugin jar package from this dir.\ntaskPluginDir=\"lib/plugin/task\"\n\n# resource storage type: HDFS, S3, NONE\nresourceStorageType=\"HDFS\"  \n# \u8d44\u6e90\u5b58\u50a8\u7c7b\u578b\n\n# resource store on HDFS/S3 path, resource file will store to this hdfs path, self configuration, please make sure the directory exists on hdfs and has read write permissions. \"/dolphinscheduler\" is recommended\nresourceUploadPath=\"/dolphinscheduler\"\n# \u8d44\u6e90\u4e0a\u4f20\u8def\u5f84\n\n# if resourceStorageType is HDFS\uff0cdefaultFS write namenode address\uff0cHA, you need to put core-site.xml and hdfs-site.xml in the conf directory.\n# if S3\uff0cwrite S3 address\uff0cHA\uff0cfor example \uff1as3a://dolphinscheduler\uff0c\n# Note\uff0cS3 be sure to create the root directory /dolphinscheduler\ndefaultFS=\"hdfs://hadoop102:8020\"\n# \u9ed8\u8ba4\u6587\u4ef6\u7cfb\u7edf\n\n# if resourceStorageType is S3, the following three configuration is required, otherwise please ignore\ns3Endpoint=\"http://192.168.xx.xx:9010\"\ns3AccessKey=\"xxxxxxxxxx\"\ns3SecretKey=\"xxxxxxxxxx\"\n\n# resourcemanager port, the default value is 8088 if not specified\nresourceManagerHttpAddressPort=\"8088\"\n# yarn RM http \u8bbf\u95ee\u7aef\u53e3\n\n# if resourcemanager HA is enabled, please set the HA IPs; if resourcemanager is single node, keep this value empty\nyarnHaIps=\n# Yarn RM \u9ad8\u53ef\u7528 ip\uff0c\u82e5\u672a\u542f\u7528 RM \u9ad8\u53ef\u7528\uff0c\u5219\u5c06\u8be5\u503c\u7f6e\u7a7a\n\n# if resourcemanager HA is enabled or not use resourcemanager, please keep the default value; If resourcemanager is single node, you only need to replace 'yarnIp1' to actual resourcemanager hostname\nsingleYarnIp=\"hadoop103\"\n# Yarn RM \u4e3b\u673a\u540d\uff0c\u82e5\u542f\u7528\u4e86 HA \u6216\u672a\u542f\u7528 RM\uff0c\u4fdd\u7559\u9ed8\u8ba4\u503c\n\n# who has permission to create directory under HDFS/S3 root path\n# Note: if kerberos is enabled, please config hdfsRootUser=\nhdfsRootUser=\"atguigu\"\n# \u62e5\u6709 HDFS \u6839\u76ee\u5f55\u64cd\u4f5c\u6743\u9650\u7684\u7528\u6237\n\n# kerberos config\n# whether kerberos starts, if kerberos starts, following four items need to config, otherwise please ignore\nkerberosStartUp=\"false\"\n# kdc krb5 config file path\nkrb5ConfPath=\"$installPath/conf/krb5.conf\"\n# keytab username,watch out the @ sign should followd by \\\\\nkeytabUserName=\"hdfs-mycluster\\\\@ESZ.COM\"\n# username keytab path\nkeytabPath=\"$installPath/conf/hdfs.headless.keytab\"\n# kerberos expire time, the unit is hour\nkerberosExpireTime=\"2\"\n\n# use sudo or not\nsudoEnable=\"true\"\n\n# worker tenant auto create\nworkerTenantAutoCreate=\"false\"\n</code></pre>"},{"location":"schedule/ds/03/#36","title":"3.6 \u521d\u59cb\u5316\u6570\u636e\u5e93","text":"<p>\uff081\uff09\u62f7\u8d1d MySQL \u9a71\u52a8\u5230 DolphinScheduler \u7684\u89e3\u538b\u76ee\u5f55\u4e0b\u7684 lib \u4e2d\uff0c\u8981\u6c42\u4f7f\u7528 MySQL JDBC Driver 8.0.16\u3002</p> <pre><code>cp /opt/software/mysql-connector-java-8.0.16.jar lib/\n</code></pre> <p>\uff082\uff09\u6267\u884c\u6570\u636e\u5e93\u521d\u59cb\u5316\u811a\u672c</p> <p>\u6570\u636e\u5e93\u521d\u59cb\u5316\u811a\u672c\u4f4d\u4e8e DolphinScheduler \u89e3\u538b\u76ee\u5f55\u4e0b\u7684 script \u76ee\u5f55\u4e2d\uff0c\u5373 /opt/software/ds/apache-dolphinscheduler-2.0.5-bin/script/\u3002</p> <pre><code>script/create-dolphinscheduler.sh\n</code></pre>"},{"location":"schedule/ds/03/#37-dolphinscheduler","title":"3.7 \u4e00\u952e\u90e8\u7f72DolphinScheduler","text":"<p>\uff081\uff09\u542f\u52a8 Zookeeper \u96c6\u7fa4</p> <pre><code>zk.sh start\n</code></pre> <p>\uff082\uff09\u4e00\u952e\u90e8\u7f72\u5e76\u542f\u52a8 DolphinScheduler</p> <pre><code>./install.sh\n</code></pre> <p>\uff083\uff09\u67e5\u770b DolphinScheduler \u8fdb\u7a0b</p> <pre><code>--------- hadoop102 ----------\n29139 ApiApplicationServer\n28963 WorkerServer\n3332 QuorumPeerMain\n2100 DataNode\n28902 MasterServer\n29081 AlertServer\n1978 NameNode\n29018 LoggerServer\n2493 NodeManager\n29551 Jps\n--------- hadoop103 ----------\n29568 Jps\n29315 WorkerServer\n2149 NodeManager\n1977 ResourceManager\n2969 QuorumPeerMain\n29372 LoggerServer\n1903 DataNode\n--------- hadoop104 ----------\n1905 SecondaryNameNode\n27074 WorkerServer\n2050 NodeManager\n2630 QuorumPeerMain\n1817 DataNode\n27354 Jps\n27133 LoggerServer\n</code></pre> <p>(4\uff09\u8bbf\u95ee DolphinScheduler UI</p> <p>DolphinScheduler UI \u5730\u5740\u4e3a http://hadoop102:12345/dolphinscheduler</p> <p>\u521d\u59cb\u7528\u6237\u7684\u7528\u6237\u540d\u4e3a\uff1aadmin\uff0c\u5bc6\u7801\u4e3a dolphinscheduler123</p>"},{"location":"schedule/ds/03/#38-dolphinscheduler","title":"3.8 DolphinScheduler\u542f\u505c\u547d\u4ee4","text":"<p>DolphinScheduler \u7684\u542f\u505c\u811a\u672c\u5747\u4f4d\u4e8e\u5176\u5b89\u88c5\u76ee\u5f55\u7684 bin \u76ee\u5f55\u4e0b\u3002</p> <p>1\uff09\u4e00\u952e\u542f\u505c\u6240\u6709\u670d\u52a1</p> <pre><code>./bin/start-all.sh\n./bin/stop-all.sh\n</code></pre> <p>\u6ce8\u610f\u540c Hadoop \u7684\u542f\u505c\u811a\u672c\u8fdb\u884c\u533a\u5206\u3002</p> <p>2\uff09\u542f\u505c Master</p> <pre><code>./bin/dolphinscheduler-daemon.sh start master-server\n./bin/dolphinscheduler-daemon.sh stop master-server\n</code></pre> <p>3\uff09\u542f\u505c Worker</p> <pre><code>./bin/dolphinscheduler-daemon.sh start worker-server\n./bin/dolphinscheduler-daemon.sh stop worker-server\n</code></pre> <p>4\uff09\u542f\u505c Api</p> <pre><code>./bin/dolphinscheduler-daemon.sh start api-server\n./bin/dolphinscheduler-daemon.sh stop api-server\n</code></pre> <p>5\uff09\u542f\u505c Logger</p> <pre><code>./bin/dolphinscheduler-daemon.sh start logger-server\n./bin/dolphinscheduler-daemon.sh stop logger-server\n</code></pre> <p>6\uff09\u542f\u505c Alert</p> <pre><code>./bin/dolphinscheduler-daemon.sh start alert-server\n./bin/dolphinscheduler-daemon.sh stop alert-server\n</code></pre>"},{"location":"schedule/ds/04/","title":"\u7b2c4\u7ae0 DolphinScheduler\u5165\u95e8","text":""},{"location":"schedule/ds/04/#41","title":"4.1 \u5b89\u5168\u4e2d\u5fc3\u914d\u7f6e","text":"<p>\u5b89\u5168\u4e2d\u5fc3\u4e3b\u8981\u6709\u79df\u6237\u7ba1\u7406\u3001\u7528\u6237\u7ba1\u7406\u3001\u544a\u8b66\u7ec4\u7ba1\u7406\u3001\u544a\u8b66\u5b9e\u4f8b\u7ba1\u7406\u3001Worker \u5206\u7ec4\u7ba1\u7406\u3001Yarn \u961f\u5217\u7ba1\u7406\u3001\u73af\u5883\u7ba1\u7406\u3001\u4ee4\u724c\u7ba1\u7406\u7b49\u529f\u80fd\u3002</p> <p></p>"},{"location":"schedule/ds/04/#411-yarn","title":"4.1.1 Yarn \u961f\u5217\u7ba1\u7406","text":"<p>\u961f\u5217\u662f\u5728\u6267\u884c spark\u3001mapreduce \u7b49\u7a0b\u5e8f\uff0c\u9700\u8981\u7528\u5230\u201c\u961f\u5217\u201d\u53c2\u6570\u65f6\u4f7f\u7528\u7684\u3002</p> <p>\u6b64\u5904\u7684\u961f\u5217\u5bf9\u5e94\u7684\u662f Yarn \u8c03\u5ea6\u5668\u7684\u8d44\u6e90\u961f\u5217\u3002\u6545\u961f\u5217\u6982\u5ff5\u53ea\u5bf9\u8dd1\u5728 Yarn \u4e0a\u7684\u4efb\u52a1\u7c7b\u578b\u6709\u6548\u3002\u6b64\u5904\u521b\u5efa\u51fa\u7684\u961f\u5217\uff0c\u53ef\u4f9b\u540e\u7eed\u4efb\u52a1\u8fdb\u884c\u9009\u62e9\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728 DolphinScheduler \u4e2d\u521b\u5efa\u961f\u5217\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5230 Yarn \u8c03\u5ea6\u5668\u7684\u961f\u5217\u914d\u7f6e\u3002</p> <p>\u6b64\u5904\u53ef\u4e0d\u521b\u5efa\u961f\u5217\u3002</p> <p></p> <p>\u6ce8</p> <p>\u540d\u79f0\uff1aDS \u6267\u884c\u4efb\u52a1\u65f6\u53ef\u4ee5\u9009\u62e9\u7684\u961f\u5217\u540d\u79f0\u3002</p> <p>\u961f\u5217\u503c\uff1a\u4e0e\u540d\u79f0\u76f8\u5bf9\u5e94\u7684 Yarn \u8c03\u5ea6\u961f\u5217\u7684\u540d\u79f0\u3002</p>"},{"location":"schedule/ds/04/#412","title":"4.1.2 \u79df\u6237\u7ba1\u7406","text":"<p>\u79df\u6237\u5bf9\u5e94\u7684\u662f Linux \u7684\u7528\u6237\uff0c\u7528\u4e8e worker \u63d0\u4ea4\u4f5c\u4e1a\u6240\u4f7f\u7528\u7684\u7528\u6237\u3002\u5982\u679c linux \u6ca1\u6709\u8fd9\u4e2a\u7528\u6237\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u4efb\u52a1\u8fd0\u884c\u5931\u8d25\u3002\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 worker.properties  \u914d\u7f6e\u6587\u4ef6\u4e2d\u53c2\u6570 worker.tenant.auto.create=true\uff08\u9ed8\u8ba4\u503c\u4e3a false\uff09\u5b9e\u73b0\u5f53 linux \u7528\u6237\u4e0d\u5b58\u5728\u65f6\u81ea\u52a8\u521b\u5efa\u8be5\u7528\u6237\u3002worker.tenant.auto.create=true \u53c2\u6570\u4f1a\u8981\u6c42 worker \u53ef\u4ee5\u514d\u5bc6\u8fd0\u884c sudo \u547d\u4ee4\u3002</p> <p>\u6b64\u5904\u521b\u5efa\u4e00\u4e2a atguigu \u79df\u6237\uff0c\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u6ce8\uff1a</p> <ul> <li>\u79df\u6237\u7f16\u7801\uff1a\u79df\u6237\u7f16\u7801\u662f Linux \u4e0a\u7684\u7528\u6237\uff0c\u552f\u4e00\uff0c\u4e0d\u80fd\u91cd\u590d\u3002</li> <li>\u961f\u5217\uff1a\u8be5\u79df\u6237\u63d0\u4ea4 Yarn \u4efb\u52a1\u65f6\u7684\u9ed8\u8ba4\u961f\u5217\u3002</li> </ul>"},{"location":"schedule/ds/04/#413","title":"4.1.3 \u7528\u6237\u7ba1\u7406","text":"<p>\u7528\u6237\u5bf9\u5e94\u7684\u662f DolphinScheduler \u7684\u7528\u6237\uff0c\u7528\u4e8e\u767b\u5f55 DolphinScheduler\u3002\u7528\u6237\u5206\u7ba1\u7406\u5458\u7528\u6237\u548c\u666e\u901a\u7528\u6237\u3002</p> <p>\u7ba1\u7406\u5458\u6709\u6388\u6743\u548c\u7528\u6237\u7ba1\u7406\u7b49\u6743\u9650\uff0c\u6ca1\u6709\u521b\u5efa\u9879\u76ee\u548c\u5de5\u4f5c\u6d41\u5b9a\u4e49\u7684\u64cd\u4f5c\u7684\u6743\u9650\u3002</p> <p>\u666e\u901a\u7528\u6237\u53ef\u4ee5\u521b\u5efa\u9879\u76ee\u548c\u5bf9\u5de5\u4f5c\u6d41\u5b9a\u4e49\u7684\u521b\u5efa\uff0c\u7f16\u8f91\uff0c\u6267\u884c\u7b49\u64cd\u4f5c\u3002</p> <p>\u6b64\u5904\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7528\u6237 atguigu\uff0c\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u6ce8\uff1a</p> <ul> <li>\u7528\u6237\u540d\uff1aDolphinScheduler \u767b\u5f55\u8d26\u6237</li> <li>\u79df\u6237\uff1a\u8be5\u7528\u6237\u5173\u8054\u7684\u79df\u6237</li> <li>\u961f\u5217\uff1a\u9ed8\u8ba4\u4e3a\u79df\u6237\u6240\u5173\u8054\u7684\u961f\u5217\u3002</li> <li>\u90ae\u4ef6\u3001\u624b\u673a\u53f7\uff1a\u4e3b\u8981\u7528\u4e8e\u544a\u8b66\u901a\u77e5\u3002</li> </ul>"},{"location":"schedule/ds/04/#414","title":"4.1.4 \u544a\u8b66\u5b9e\u4f8b\u7ba1\u7406\u4e0e\u544a\u8b66\u7ec4\u7ba1\u7406","text":"<p>\u544a\u8b66\u5b9e\u4f8b\u4e0e\u544a\u8b66\u7ec4\u7528\u4e8e\u4efb\u52a1\u8fd0\u884c\u6210\u529f\u6216\u8005\u5931\u8d25\u4e4b\u540e\u7684\u544a\u8b66\u901a\u77e5\u3002\u4e00\u4e2a\u544a\u8b66\u7ec4\u53ef\u5305\u542b\u591a\u4e2a\u544a\u8b66\u5b9e\u4f8b\uff0c\u4e00\u4e2a\u544a\u8b66\u5b9e\u4f8b\uff0c\u9700\u9009\u62e9\u4e00\u4e2a\u544a\u8b66\u63d2\u4ef6\uff0c\u5e76\u914d\u7f6e\u76f8\u5e94\u53c2\u6570\uff0c\u76ee\u524d\u652f\u6301\u7684\u544a\u8b66\u63d2\u4ef6\u6709\u7535\u5b50\u90ae\u4ef6\u3001\u9489\u9489\u3001\u4f01\u4e1a\u5fae\u4fe1\u3001\u98de\u4e66\u7b49\u3002</p>"},{"location":"schedule/ds/04/#415-worker","title":"4.1.5 Worker\u5206\u7ec4\u7ba1\u7406","text":"<p>\u4e00\u4e2a Worker \u5206\u7ec4\u7531\u591a\u4e2a Worker \u7ec4\u6210\u3002\u5728\u4efb\u52a1\u6267\u884c\u65f6\uff0c\u53ef\u4ee5\u5c06\u4efb\u52a1\u5206\u914d\u7ed9\u6307\u5b9a Worker \u7ec4\uff0c\u7531\u8be5\u7ec4\u4e2d\u7684 Worker \u8282\u70b9\u6267\u884c\u8be5\u4efb\u52a1\u3002\u6bcf\u4e2a Worker \u81f3\u5c11\u5c5e\u4e8e\u4e00\u4e2a\u7ec4\uff0c\u9ed8\u8ba4\u4e3a default \u7ec4\u3002Worker \u6240\u5c5e\u5206\u7ec4\u53ef\u4ee5\u8c03\u6574\uff0c\u8c03\u6574\u65b9\u5f0f\u5982\u4e0b\uff1a</p> \u65b9\u5f0f\u4e00\u65b9\u5f0f\u4e8c <p>\u6253\u5f00\u8981\u8bbe\u7f6e\u5206\u7ec4\u7684 Worker \u8282\u70b9\u4e0a\u7684 worker.properties \u914d\u7f6e\u6587\u4ef6\uff0c\u4fee\u6539 worker.groups \u53c2\u6570\uff0cworker.groups \u53c2\u6570\u7684\u503c\u4e3a\u8be5 Worker \u8282\u70b9\u5bf9\u5e94\u7684\u5206\u7ec4\u540d\u79f0,\u9ed8\u8ba4\u4e3a default\uff0c\u5982\u679c\u8be5 worker \u8282\u70b9\u5c5e\u4e8e\u591a\u4e2a\u5206\u7ec4\uff0c\u5219\u591a\u4e2a\u5206\u7ec4\u540d\u79f0\u4ee5\u9017\u53f7\u9694\u5f00\u3002 \u793a\u4f8b: </p> <pre><code>worker.groups=default,test\n</code></pre> <p>\u5728 Web UI \u7684\u5b89\u5168\u4e2d\u5fc3\u7684 Workder \u5206\u7ec4\u7ba1\u7406\u4e2d\u4fee\u6539\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"schedule/ds/04/#416","title":"4.1.6 \u73af\u5883\u7ba1\u7406","text":"<p>\u6b64\u5904\u53ef\u914d\u7f6e Worker \u8fd0\u884c\u73af\u5883\uff08\u4efb\u52a1\u8fd0\u884c\u65f6\u6240\u9700\u7684\u73af\u5883\u53d8\u91cf\uff09\uff0c\u9ed8\u8ba4\u7684\u8fd0\u884c\u73af\u5883\u7531 Worker \u8282\u70b9\u4e2d\uff0cdolphinscheduler \u5b89\u88c5\u76ee\u5f55\u4e0b\u7684 conf/env/dolphinscheduler_env.sh \u51b3\u5b9a\u3002</p> <p>\u521b\u5efa\u73af\u5883\u7684\u64cd\u4f5c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u73af\u5883\u521b\u5efa\u5b8c\u6bd5\u4e4b\u540e\uff0c\u5c31\u53ef\u4f9b Worker \u8fd0\u884c\u4efb\u52a1\u65f6\u9009\u62e9\u3002</p> <p></p> <p>\u6ce8\uff1a</p> <ul> <li>\u73af\u5883\u540d\u79f0\uff1a\u7528\u6237\u81ea\u5b9a\u4e49\u540d\u79f0\u3002</li> <li>\u73af\u5883\u914d\u7f6e\uff1a\u4e0e dolphinscheduler_env.sh \u914d\u7f6e\u683c\u5f0f\u76f8\u540c\u3002</li> <li>\u8be6\u7ec6\u63cf\u8ff0\uff1a\u73af\u5883\u7684\u8be6\u7ec6\u63cf\u8ff0\uff0c\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u5426\u5219\u65e0\u6cd5\u521b\u5efa</li> <li>Worker \u7ec4\uff1a\u73af\u5883\u6240\u5c5e\u7684 Worker \u7ec4\u3002</li> </ul>"},{"location":"schedule/ds/04/#417","title":"4.1.7 \u4ee4\u724c\u7ba1\u7406","text":"<p>\u4ee4\u724c\u7528\u4e8e\u901a\u8fc7\u63a5\u53e3\u8bbf\u95ee DolphinScheduler \u5404\u9879\u670d\u52a1\u65f6\u7684\u7528\u6237\u9a8c\u8bc1\u3002\u666e\u901a\u7528\u6237\u901a\u8fc7 UI \u9875\u9762\u8bbf\u95ee\u5404\u9879\u670d\u52a1\u65f6\uff0c\u65e0\u9700\u4f7f\u7528\u4ee4\u724c\u3002\u82e5\u9700\u5c06 DolphinScheduler \u4e0e\u7b2c\u4e09\u65b9\u670d\u52a1\u8fdb\u884c\u96c6\u6210\uff0c\u5219\u9700\u8c03\u7528\u5176\u63a5\u53e3\uff0c\u6b64\u65f6\u9700\u4f7f\u7528\u4ee4\u724c\u3002</p>"},{"location":"schedule/ds/04/#42","title":"4.2 \u9879\u76ee\u7ba1\u7406","text":""},{"location":"schedule/ds/04/#421","title":"4.2.1 \u5207\u6362\u7528\u6237","text":"<p>\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u7ba1\u7406\u5458\u7528\u6237\u64cd\u4f5c\u9879\u76ee\u548c\u5de5\u4f5c\u6d41\u7b49\uff0c\u6545\u9700\u5148\u5207\u6362\u5230\u666e\u901a\u7528\u6237 atguigu\u3002</p> <p>1\uff09admin \u7528\u6237\u9000\u51fa</p> <p></p> <p>2\uff09\u4f7f\u7528 atguigu \u7528\u6237\u767b\u5f55</p> <p></p>"},{"location":"schedule/ds/04/#422","title":"4.2.2 \u521b\u5efa\u9879\u76ee","text":""},{"location":"schedule/ds/04/#423","title":"4.2.3 \u67e5\u770b\u9879\u76ee","text":""},{"location":"schedule/ds/04/#43","title":"4.3 \u5de5\u4f5c\u6d41\u57fa\u7840\u914d\u7f6e","text":"<p>\u4e0b\u56fe\u4e3a\u5de5\u4f5c\u6d41\u914d\u7f6e\u9875\u9762\uff0c\u5171\u5305\u542b\u4e09\u4e2a\u6a21\u5feb\uff0c\u5206\u522b\u4e3a\u5de5\u4f5c\u6d41\u5b9a\u4e49\u3001\u5de5\u4f5c\u6d41\u5b9e\u4f8b\u548c\u4efb\u52a1\u5b9e\u4f8b\u3002</p> <p>\u5de5\u4f5c\u6d41\u5b9a\u4e49\uff1a\u7528\u4e8e\u5b9a\u4e49\u5de5\u4f5c\u6d41\uff0c\u5305\u62ec\u5de5\u4f5c\u6d41\u5404\u8282\u70b9\u4efb\u52a1\u8be6\u60c5\u53ca\u5404\u8282\u70b9\u4f9d\u8d56\u5173\u7cfb\u7b49\u3002</p> <p>\u5de5\u4f5c\u6d41\u5b9e\u4f8b\uff1a\u5de5\u4f5c\u6d41\u6bcf\u6267\u884c\u4e00\u6b21\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a\u5de5\u4f5c\u6d41\u5b9e\u4f8b\u3002\u6b64\u5904\u53ef\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u5de5\u4f5c\u6d41\u4ee5\u53ca\u5df2\u7ecf\u5b8c\u6210\u7684\u5de5\u4f5c\u6d41\u3002</p> <p>\u4efb\u52a1\u5b9e\u4f8b\uff1a\u5de5\u4f5c\u6d41\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\u4efb\u52a1\uff0c\u6bcf\u6267\u884c\u4e00\u6b21\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a\u4efb\u52a1\u5b9e\u4f8b\u3002\u6b64\u5904\u53ef\u7528\u4e8e\u67e5\u770b\u6b63\u5728\u6267\u884c\u7684\u8282\u70b9\u4efb\u52a1\u4ee5\u53ca\u5df2\u7ecf\u5b8c\u6210\u7684\u8282\u70b9\u4efb\u52a1\u3002</p> <p></p>"},{"location":"schedule/ds/04/#431","title":"4.3.1 \u5de5\u4f5c\u6d41\u5b9a\u4e49","text":"<p>\u5de5\u4f5c\u6d41\u8981\u6c42\uff1a\u5de5\u4f5c\u6d41\u9700\u5305\u542b\u4e09\u4e2a Shell \u7c7b\u578b\u7684\u4efb\u52a1\u8282\u70b9\uff0c\u5206\u522b\u662f A\uff0cB\uff0cC\u3002\u4e09\u4e2a\u4efb\u52a1\u7684\u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>1\uff09\u521b\u5efa\u5de5\u4f5c\u6d41</p> <p></p> <p>2\uff09\u914d\u7f6e\u4efb\u52a1\u8282\u70b9</p> <p>\uff081\uff09\u8282\u70b9 A</p> <p></p> <p>\uff082\uff09\u8282\u70b9 B</p> <p></p> <p>\uff083\uff09\u8282\u70b9 C</p> <p></p> <p>3\uff09\u914d\u7f6e\u4efb\u52a1\u8282\u70b9\u7684\u4f9d\u8d56\u5173\u7cfb</p> <p>\u914d\u7f6e\u4f9d\u8d56\u7684\u5173\u7cfb\u7684\u65b9\u5f0f\u5982\u4e0b\u4e24\u79cd\uff1a</p> <p>\uff081\uff09\u76f4\u63a5\u5bf9 DAG \u56fe\u8fdb\u884c\u62d6\u62fd\u64cd\u4f5c</p> <p></p> <p>\uff082\uff09\u5728\u8282\u70b9\u8bbe\u7f6e\u4e2d\u9009\u62e9 \u201c\u524d\u7f6e\u4efb\u52a1\u201d</p> <p></p> <p>4\uff09\u4fdd\u5b58\u5de5\u4f5c\u6d41\u5b9a\u4e49</p> <p></p>"},{"location":"schedule/ds/04/#432","title":"4.3.2 \u6267\u884c\u5de5\u4f5c\u6d41","text":"<p>1\uff09\u4e0a\u7ebf\u5de5\u4f5c\u6d41</p> <p>\u5de5\u4f5c\u6d41\u987b\u4e0a\u7ebf\u4e4b\u540e\u624d\u80fd\u6267\u884c\u3002\u5904\u4e8e\u4e0a\u7ebf\u72b6\u6001\u7684\u5de5\u4f5c\u6d41\u5b9a\u4e49\u4e0d\u53ef\u4fee\u6539\uff0c\u5982\u9700\u4fee\u6539\uff0c\u987b\u5148\u4e0b\u7ebf\u3002</p> <p></p> <p>2\uff09\u5355\u6b21\u8fd0\u884c\u5de5\u4f5c\u6d41</p> <p></p> <p>3\uff09\u5b9a\u65f6\u6267\u884c\u5de5\u4f5c\u6d41</p> <p>\uff081\uff09\u70b9\u51fb\u5b9a\u65f6</p> <p></p> <p>\uff082\uff09\u914d\u7f6e\u5b9a\u65f6\u89c4\u5219</p> <p>\u6b64\u5904\u793a\u4f8b\u4e3a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21</p> <p></p> <p>\uff083\uff09\u5b9a\u65f6\u7ba1\u7406</p> <p></p> <p>\uff084\uff09\u5b9a\u65f6\u4e0a\u7ebf</p> <p></p>"},{"location":"schedule/ds/04/#433","title":"4.3.3 \u67e5\u770b\u5de5\u4f5c\u6d41\u5b9e\u4f8b","text":"<p>1\uff09\u67e5\u770b\u6240\u6709\u5de5\u4f5c\u6d41\u5b9e\u4f8b</p> <p></p> <p>2\uff09\u67e5\u770b\u5de5\u4f5c\u6d41\u6267\u884c\u72b6\u6001</p> <p></p>"},{"location":"schedule/ds/04/#434","title":"4.3.4 \u67e5\u770b\u4efb\u52a1\u5b9e\u4f8b","text":"<p>1\uff09\u67e5\u770b\u6240\u6709\u4efb\u52a1\u5b9e\u4f8b</p> <p></p> <p>2\uff09\u67e5\u770b\u4efb\u52a1\u5b9e\u4f8b\u65e5\u5fd7</p> <p></p> <p></p>"},{"location":"schedule/ds/05/","title":"\u7b2c5\u7ae0 DolphinScheduler\u8fdb\u9636","text":""},{"location":"schedule/ds/05/#51","title":"5.1 \u5de5\u4f5c\u6d41\u4f20\u53c2","text":""},{"location":"schedule/ds/05/#511","title":"5.1.1 \u672c\u5730\u53c2\u6570\u548c\u5168\u5c40\u53c2\u6570","text":"<p>DolphinScheduler \u652f\u6301\u5bf9\u4efb\u52a1\u8282\u70b9\u8fdb\u884c\u7075\u6d3b\u7684\u4f20\u53c2\uff0c\u4efb\u52a1\u8282\u70b9\u53ef\u901a\u8fc7<code>${\u53c2\u6570\u540d}</code>\u5f15\u7528\u53c2\u6570\u503c\u3002</p> <p>1\uff09\u672c\u5730\u53c2\u6570</p> <p>\u672c\u5730\u53c2\u6570\u662f\u6307\u53ea\u9488\u5bf9\u5355\u4e2a\u4efb\u52a1\u8282\u70b9\u6709\u6548\u7684\u53c2\u6570\u3002</p> <p>\uff081\uff09\u4fee\u6539 helloworld \u5de5\u4f5c\u6d41 Node-A \u8282\u70b9\u5982\u4e0b</p> <p></p> <ul> <li>dt\uff1a\u53c2\u6570\u540d</li> <li>IN / OUT\uff1aIN \u8868\u793a\u5411\u5f53\u524d\u8282\u70b9\u4f20\u53c2\uff0cOUT \u8868\u793a\u5411\u4e0b\u6e38\u8282\u70b9\u4f20\u53c2</li> <li>VARCHAR\uff1a\u53c2\u6570\u503c\u7c7b\u578b</li> <li>2020-06-14\uff1a\u53c2\u6570\u503c</li> </ul> <p>\uff082\uff09\u4fdd\u5b58\u5de5\u4f5c\u6d41\u5e76\u8fd0\u884c\uff0c\u67e5\u770b Node-A \u8f93\u51fa\u65e5\u5fd7\u3002</p> <p>2\uff09\u5168\u5c40\u53c2\u6570</p> <p>\u5168\u5c40\u53c2\u6570\u662f\u6307\u9488\u5bf9\u6574\u4e2a\u5de5\u4f5c\u6d41\u7684\u6240\u6709\u4efb\u52a1\u8282\u70b9\u90fd\u6709\u6548\u7684\u53c2\u6570\u3002</p> <p>\uff081\uff09\u4fee\u6539 helloworld \u5de5\u4f5c\u6d41\u6bcf\u4e2a\u4efb\u52a1\u8282\u70b9\u5982\u4e0b</p> <p>\u8282\u70b9 A \u914d\u7f6e</p> <p></p> <p>\u8282\u70b9 B \u914d\u7f6e</p> <p></p> <p>\u8282\u70b9 C \u914d\u7f6e</p> <p></p> <p>\uff082\uff09\u4fdd\u5b58\u5de5\u4f5c\u6d41\uff0c\u5e76\u8bbe\u7f6e\u5168\u5c40\u53c2\u6570</p> <p></p> <p>\uff083\uff09\u6267\u884c\u5de5\u4f5c\u6d41\uff0c\u67e5\u770b\u4e09\u4e2a\u4efb\u52a1\u8282\u70b9\u8f93\u51fa\u65e5\u5fd7\u3002</p>"},{"location":"schedule/ds/05/#512","title":"5.1.2 \u53c2\u6570\u4f20\u9012","text":"<p>DolphinScheduler \u652f\u6301\u4e0a\u6e38\u4efb\u52a1\u8282\u70b9\u5411\u4e0b\u6e38\u4efb\u52a1\u8282\u70b9\u4f20\u53c2\u3002\u76ee\u524d\u652f\u6301\u8fd9\u4e2a\u7279\u6027\u7684\u4efb\u52a1\u7c7b\u578b\u6709\uff1aShell\u3001SQL\u3001Procedure\u3002\u4ee5\u4e0b\u6848\u4f8b\u4f7f\u7528 Shell \u7c7b\u578b\u7684\u4efb\u52a1\u8282\u70b9\u8fdb\u884c\u6f14\u793a\u3002</p> <p>1\uff09\u8bbe\u7f6e\u4e0a\u6e38\u8282\u70b9 Node-A</p> <p></p> <p>\u6ce8</p> <p><code>echo '${setValue(key=value)}'</code> \u4e3a\u56fa\u5b9a\u5199\u6cd5</p> <p>2\uff09\u8bbe\u7f6e\u4e0b\u6e38\u8282\u70b9 Node-C</p> <p></p> <p>3\uff09\u67e5\u770b\u8f93\u51fa\u65e5\u5fd7</p> <p>\u53ef\u4ee5\u770b\u5230\u5bf9\u5e94\u8282\u70b9\u65e5\u5fd7\u4e2d\u8f93\u51fa\u4e86\u5176\u8c03\u7528\u53c2\u6570\u7684\u503c\u3002</p>"},{"location":"schedule/ds/05/#513","title":"5.1.3 \u53c2\u6570\u4f18\u5148\u7ea7","text":"<p>\u4e00\u4e2a\u4efb\u52a1\u8282\u70b9\u5f15\u7528\u7684\u53c2\u6570\u53ef\u80fd\u6765\u81ea\u4e09\u79cd\u7c7b\u578b\uff1a\u5206\u522b\u662f\u5168\u5c40\u53c2\u6570 \u3001\u4e0a\u6e38\u4efb\u52a1\u4f20\u9012\u7684\u53c2\u6570\u3001\u672c\u5730\u53c2\u6570\u3002\u56e0\u4e3a\u53c2\u6570\u7684\u503c\u5b58\u5728\u591a\u4e2a\u6765\u6e90\uff0c\u5f53\u53c2\u6570\u540d\u76f8\u540c\u65f6\uff0c\u5c31\u9700\u8981\u8003\u8651\u53c2\u6570\u4f18\u5148\u7ea7\u7684\u95ee\u9898\u3002DolphinScheduler \u53c2\u6570\u7684\u4f18\u5148\u7ea7\u4ece\u4f4e\u5230\u9ad8\u4e3a\uff1a\u4e0a\u6e38\u4efb\u52a1\u4f20\u9012\u7684\u53c2\u6570 &lt; \u5168\u5c40\u53c2\u6570 &lt; \u672c\u5730\u53c2\u6570\u3002</p> <p>\u5728\u4e0a\u6e38\u4efb\u52a1\u4f20\u9012\u7684\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0c\u7531\u4e8e\u4e0a\u6e38\u53ef\u80fd\u5b58\u5728\u591a\u4e2a\u4efb\u52a1\u5411\u4e0b\u6e38\u4f20\u9012\u53c2\u6570\u3002\u5f53\u4e0a\u6e38\u4f20\u9012\u7684\u53c2\u6570\u540d\u79f0\u76f8\u540c\u65f6\uff1a</p> <p>\u4e0b\u6e38\u8282\u70b9\u4f1a\u4f18\u5148\u4f7f\u7528\u503c\u4e3a\u975e\u7a7a\u7684\u53c2\u6570\u3002</p> <p>\u5982\u679c\u5b58\u5728\u591a\u4e2a\u503c\u4e3a\u975e\u7a7a\u7684\u53c2\u6570\uff0c\u5219\u6309\u7167\u4e0a\u6e38\u4efb\u52a1\u7684\u5b8c\u6210\u65f6\u95f4\u6392\u5e8f\uff0c\u9009\u62e9\u5b8c\u6210\u65f6\u95f4\u6700\u65e9\u7684\u4e0a\u6e38\u4efb\u52a1\u5bf9\u5e94\u7684\u53c2\u6570\u3002</p>"},{"location":"schedule/ds/05/#514","title":"5.1.4 \u5185\u7f6e\u53c2\u6570","text":"<p>DolphinScheduler \u63d0\u4f9b\u4e86\u4e00\u4e9b\u65f6\u95f4\u76f8\u5173\u7684\u7cfb\u7edf\u53c2\u6570\uff0c\u65b9\u4fbf\u5b9a\u65f6\u8c03\u5ea6\u4f7f\u7528\u3002</p> <p>1\uff09\u57fa\u7840\u5185\u7f6e\u53c2\u6570</p> \u53d8\u91cf\u540d \u53c2\u6570 \u8bf4\u660e system.biz.date ${system.biz.date} \u5b9a\u65f6\u65f6\u95f4\u524d\u4e00\u5929\uff0c\u683c\u5f0f\u4e3a yyyyMMdd system.biz.curdate ${system.biz.curdate} \u5b9a\u65f6\u65f6\u95f4\uff0c\u683c\u5f0f\u4e3a yyyyMMdd system.datetime ${system.datetime} \u5b9a\u65f6\u65f6\u95f4\uff0c\u683c\u5f0f\u4e3a yyyyMMddHHmmss <p>2\uff09\u884d\u751f\u5185\u7f6e\u53c2\u6570</p> <p>\u53ef\u901a\u8fc7\u884d\u751f\u5185\u7f6e\u53c2\u6570\uff0c\u8bbe\u7f6e\u4efb\u610f\u683c\u5f0f\u3001\u4efb\u610f\u65f6\u95f4\u7684\u65e5\u671f\u3002</p> <p>\uff081\uff09\u81ea\u5b9a\u4e49\u65e5\u671f\u683c\u5f0f</p> <p>\u53ef\u4ee5\u5bf9 <code>$[yyyyMMddHHmmss]</code> \u4efb\u610f\u5206\u89e3\u7ec4\u5408\uff0c\u5982 <code>$[yyyyMMdd]</code>,<code>$[HHmmss]</code>,<code>$[yyyy-MM-dd]</code>\u3002</p> <p>\uff082\uff09\u4f7f\u7528 add_months() \u51fd\u6570</p> <p>\u8be5\u51fd\u6570\u7528\u4e8e\u52a0\u51cf\u6708\u4efd\uff0c \u7b2c\u4e00\u4e2a\u5165\u53e3\u53c2\u6570\u4e3a<code>[yyyyMMdd]</code>\uff0c\u8868\u793a\u8fd4\u56de\u65f6\u95f4\u7684\u683c\u5f0f \u7b2c\u4e8c\u4e2a\u5165\u53e3\u53c2\u6570\u4e3a\u6708\u4efd\u504f\u79fb\u91cf\uff0c\u8868\u793a\u52a0\u51cf\u591a\u5c11\u4e2a\u6708\u3002</p> \u53c2\u6570 \u8bf4\u660e $[add_months(yyyyMMdd,12*N)] \u540e N \u5e74 $[add_months(yyyyMMdd,-12*N)] \u524d N \u5e74 $[add_months(yyyyMMdd,N)] \u540e N \u6708 $[add_months(yyyyMMdd,-N)] \u524d N \u6708 <p>\uff083\uff09\u76f4\u63a5\u52a0\u51cf\u6570\u5b57</p> <p>\u5728\u81ea\u5b9a\u4e49\u683c\u5f0f\u540e\u76f4\u63a5 \u201c\u00b1\u201d \u6570\u5b57\uff0c\u5355\u4f4d\u4e3a\u201c\u5929\u201d\u3002</p> \u53c2\u6570 \u8bf4\u660e $[yyyyMMdd+7*N] \u540e N \u5468 $[yyyyMMdd-7*N] \u524d N \u5468 $[yyyyMMdd+N] \u540e N \u5929 $[yyyyMMdd-N] \u524d N \u5929 $[HHmmss+N/24] \u540e N \u5c0f\u65f6 $[HHmmss-N/24] \u524d N \u5c0f\u65f6 $[HHmmss+N/24/60] \u540e N \u5206\u949f $[HHmmss-N/24/60] \u524d N \u5206\u949f <p>3\uff09\u914d\u7f6e\u793a\u4f8b</p> <p>\u82e5\u6267\u884c\u7684\u811a\u672c\u9700\u8981\u4e00\u4e2a\u683c\u5f0f\u4e3a yyyy-MM-dd \u7684\u524d\u4e00\u5929\u65e5\u671f\u7684\u53c2\u6570\uff0c\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u5373\u53ef\u3002</p> <p></p>"},{"location":"schedule/ds/05/#52","title":"5.2 \u5f15\u7528\u4f9d\u8d56\u8d44\u6e90","text":"<p>\u6709\u4e9b\u4efb\u52a1\u9700\u8981\u5f15\u7528\u4e00\u4e9b\u989d\u5916\u7684\u8d44\u6e90\uff0c\u4f8b\u5982 MR\u3001Spark \u7b49\u4efb\u52a1\u987b\u5f15\u7528 jar \u5305\uff0cShell \u4efb\u52a1\u9700\u8981\u5f15\u7528\u5176\u4ed6\u811a\u672c\u7b49\u3002DolphinScheduler \u63d0\u4f9b\u4e86\u8d44\u6e90\u4e2d\u5fc3\u6765\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\u3002\u8d44\u6e90\u4e2d\u5fc3\u5b58\u50a8\u7cfb\u7edf\u53ef\u9009\u62e9\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216\u8005 HDFS \u7b49\u3002\u8d44\u6e90\u4e2d\u5fc3\u9664\u4e86\u63d0\u4f9b\u6587\u4ef6\u8d44\u6e90\u7ba1\u7406\u529f\u80fd\uff0c\u8fd8\u63d0\u4f9b\u4e86 Hive \u81ea\u5b9a\u4e49\u51fd\u6570\u7ba1\u7406\u7684\u529f\u80fd\u3002</p> <p>\u4e0b\u9762\u4ee5 Shell \u4efb\u52a1\u4e3a\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5f15\u7528\u8d44\u6e90\u4e2d\u5fc3\u7684\u5176\u4ed6\u811a\u672c\u3002</p> <p>1\uff09\u5728\u8d44\u6e90\u4e2d\u5fc3\u521b\u5efa\u811a\u672c</p> <p></p> <p>2\uff09\u914d\u7f6e Shell \u4efb\u52a1\u5f15\u7528\u811a\u672c</p> <p>\u4fee\u6539\u5de5\u4f5c\u6d41\u8282\u70b9 Node-A\uff0c\u5f15\u7528\u4e0a\u8ff0\u811a\u672c</p> <p></p> <p>3\uff09\u4fdd\u5b58\u5de5\u4f5c\u6d41\u5e76\u6267\u884c\uff0c\u67e5\u770b\u5bf9\u5e94\u8282\u70b9\u8f93\u51fa\u65e5\u5fd7\u3002</p>"},{"location":"schedule/ds/05/#53","title":"5.3 \u544a\u8b66\u901a\u77e5","text":"<p>Dolphinscheduler \u652f\u6301\u591a\u79cd\u544a\u8b66\u5a92\u4ecb\uff0c\u6b64\u5904\u4ee5\u7535\u5b50\u90ae\u4ef6\u4e3a\u4f8b\u8fdb\u884c\u6f14\u793a\u3002</p> <p>1\uff09\u51c6\u5907\u90ae\u7bb1</p> <p>\u5982\u9700\u4f7f\u7528 DolphinScheduler \u7684\u7535\u5b50\u90ae\u4ef6\u544a\u8b66\u901a\u77e5\u529f\u80fd\uff0c\u9700\u8981\u51c6\u5907\u4e00\u4e2a\u7535\u5b50\u90ae\u7bb1\u8d26\u53f7\uff0c\u5e76\u542f\u7528 SMTP \u670d\u52a1\u3002\u6b64\u5904\u4ee5 QQ \u90ae\u7bb1\u4e3a\u4f8b\u3002</p> <p>\uff081\uff09\u5f00\u542f SMTP \u670d\u52a1</p> <p></p> <p>\u62d6\u52a8\u8fdb\u5ea6\u6761\u5728\u9875\u9762\u4e0b\u65b9\u627e\u5230\u4e0b\u56fe\u6240\u793a\u5185\u5bb9\uff0c\u5f00\u542f POP3/SMTP | IMAP/SMTP \u4efb\u4e00\u670d\u52a1\u5373\u53ef\u3002</p> <p></p> <p>\uff082\uff09\u83b7\u5f97\u6388\u6743\u7801</p> <p></p> <p>2\uff09DolphinScheduler \u914d\u7f6e</p> <p>\uff081\uff09\u5207\u6362\u7ba1\u7406\u5458\u7528\u6237</p> <p>\uff082\uff09\u521b\u5efa\u544a\u8b66\u5b9e\u4f8b</p> <p>\u7b2c\u4e00\u6b65\uff1a\u70b9\u51fb\u521b\u5efa\u544a\u8b66\u5b9e\u4f8b</p> <p></p> <p>\u7b2c\u4e8c\u6b65\uff1a\u7f16\u8f91\u544a\u8b66\u5b9e\u4f8b</p> <p></p> <p>\uff083\uff09\u521b\u5efa\u544a\u8b66\u7ec4</p> <p>\u7b2c\u4e00\u6b65\uff1a\u70b9\u51fb\u521b\u5efa\u544a\u8b66\u7ec4</p> <p></p> <p>\u7b2c\u4e8c\u6b65\uff1a\u7f16\u8f91\u544a\u8b66\u7ec4</p> <p></p> <p>3\uff09\u6d4b\u8bd5\u544a\u8b66\u901a\u77e5</p> <p>\uff081\uff09\u5207\u6362\u666e\u901a\u7528\u6237</p> <p>\uff082\uff09\u6267\u884c\u5de5\u4f5c\u6d41\u6d4b\u8bd5</p> <p></p> <p>\uff083\uff09\u7b49\u5f85\u63a5\u53d7\u90ae\u4ef6</p>"},{"location":"schedule/ds/05/#54","title":"5.4 \u5de5\u4f5c\u6d41\u5931\u8d25\u91cd\u8dd1","text":"<p>\u82e5\u5de5\u4f5c\u6d41\u6267\u884c\u5230\u4e00\u534a\u5931\u8d25\u4e86\uff0c\u9700\u8981\u91cd\u65b0\u542f\u52a8\u5de5\u4f5c\u6d41\u3002\u91cd\u65b0\u542f\u52a8\u65f6\u53ef\u9009\u62e9\u4ece\u8d77\u70b9\u5f00\u59cb\u6267\u884c\uff0c\u4e5f\u53ef\u9009\u62e9\u4ece\u65ad\u70b9\u5f00\u59cb\u6267\u884c\u3002</p> <p>1\uff09\u6a21\u62df\u5931\u8d25\u573a\u666f</p> <p>\uff081\uff09\u4fee\u6539 Node-A \u914d\u7f6e\u5982\u4e0b</p> <p></p> <p>\uff082\uff09\u4fee\u6539\u8d44\u6e90\u4e2d\u5fc3\u7684 test.sh \u6587\u4ef6\u5982\u4e0b</p> <p></p> <p>2\uff09\u8fd0\u884c\u5de5\u4f5c\u6d41</p> <p></p> <p>3\uff09\u67e5\u770b\u5de5\u4f5c\u6d41\u5b9e\u4f8b</p> <p></p> <p>4\uff09\u5de5\u4f5c\u5931\u8d25\u91cd\u8dd1</p> <p>\uff081\uff09\u4ece\u8d77\u70b9\u5f00\u59cb</p> <p></p> <p>\uff082\uff09\u4ece\u65ad\u70b9\u5f00\u59cb</p> <p></p>"},{"location":"sync/datax/01/","title":"\u7b2c1\u7ae0 DataX\u7b80\u4ecb","text":""},{"location":"sync/datax/01/#11-datax","title":"1.1 DataX\u6982\u8ff0","text":"<p>DataX \u662f\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u4e00\u4e2a\u5f02\u6784\u6570\u636e\u6e90\u79bb\u7ebf\u540c\u6b65\u5de5\u5177\uff0c\u81f4\u529b\u4e8e\u5b9e\u73b0\u5305\u62ec\u5173\u7cfb\u578b\u6570\u636e\u5e93( MySQL\u3001Oracle \u7b49)\u3001HDFS\u3001Hive\u3001ODPS\u3001HBase\u3001FTP \u7b49\u5404\u79cd\u5f02\u6784\u6570\u636e\u6e90\u4e4b\u95f4\u7a33\u5b9a\u9ad8\u6548\u7684\u6570\u636e\u540c\u6b65\u529f\u80fd\u3002</p> <p>\u6e90\u7801\u5730\u5740</p>"},{"location":"sync/datax/01/#12-datax","title":"1.2 DataX\u652f\u6301\u7684\u6570\u636e\u6e90","text":"<p>DataX \u76ee\u524d\u5df2\u7ecf\u6709\u4e86\u6bd4\u8f83\u5168\u9762\u7684\u63d2\u4ef6\u4f53\u7cfb\uff0c\u4e3b\u6d41\u7684 RDBMS \u6570\u636e\u5e93\u3001NOSQL\u3001\u5927\u6570\u636e\u8ba1\u7b97\u7cfb\u7edf\u90fd\u5df2\u7ecf\u63a5\u5165\uff0c\u76ee\u524d\u652f\u6301\u6570\u636e\u5982\u4e0b\u56fe\u3002</p> \u7c7b\u578b \u6570\u636e\u6e90 Reader(\u8bfb) Writer(\u5199) RDBMS \u5173\u7cfb\u578b\u6570\u636e\u5e93 MySQL \u221a \u221a Oracle \u221a \u221a OceanBase \u221a \u221a SQLServer \u221a \u221a PostgreSQL \u221a \u221a DRDS \u221a \u221a \u901a\u7528RDBMS \u221a \u221a \u963f\u91cc\u4e91\u6570\u4ed3\u6570\u636e\u5b58\u50a8 ODPS \u221a \u221a ADS \u221a OSS \u221a \u221a OCS \u221a \u221a NoSQL\u6570\u636e\u5b58\u50a8 OTS \u221a \u221a Hbase0.94 \u221a \u221a Hbase1.1 \u221a \u221a Phoenix4.x \u221a \u221a Phoenix5.x \u221a \u221a MongoDB \u221a \u221a Hive \u221a \u221a Cassandra \u221a \u221a \u65e0\u7ed3\u6784\u5316\u6570\u636e\u5b58\u50a8 TxtFile \u221a \u221a FTP \u221a \u221a HDFS \u221a \u221a Elasticsearch \u221a \u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e93 OpenTSDB \u221a TSDB \u221a \u221a"},{"location":"sync/datax/02/","title":"\u7b2c2\u7ae0 DataX\u67b6\u6784\u539f\u7406","text":""},{"location":"sync/datax/02/#21-datax","title":"2.1 DataX\u8bbe\u8ba1\u7406\u5ff5","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u5f02\u6784\u6570\u636e\u6e90\u540c\u6b65\u95ee\u9898\uff0cDataX \u5c06\u590d\u6742\u7684\u7f51\u72b6\u7684\u540c\u6b65\u94fe\u8def\u53d8\u6210\u4e86\u661f\u578b\u6570\u636e\u94fe\u8def\uff0cDataX \u4f5c\u4e3a\u4e2d\u95f4\u4f20\u8f93\u8f7d\u4f53\u8d1f\u8d23\u8fde\u63a5\u5404\u79cd\u6570\u636e\u6e90\u3002\u5f53\u9700\u8981\u63a5\u5165\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u6e90\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5c06\u6b64\u6570\u636e\u6e90\u5bf9\u63a5\u5230 DataX\uff0c\u4fbf\u80fd\u8ddf\u5df2\u6709\u7684\u6570\u636e\u6e90\u505a\u5230\u65e0\u7f1d\u6570\u636e\u540c\u6b65\u3002</p> <p></p>"},{"location":"sync/datax/02/#22-datax","title":"2.2 DataX\u6846\u67b6\u8bbe\u8ba1","text":"<p>DataX \u672c\u8eab\u4f5c\u4e3a\u79bb\u7ebf\u6570\u636e\u540c\u6b65\u6846\u67b6\uff0c\u91c7\u7528 Framework + plugin \u67b6\u6784\u6784\u5efa\u3002\u5c06\u6570\u636e\u6e90\u8bfb\u53d6\u548c\u5199\u5165\u62bd\u8c61\u6210\u4e3a Reader / Writer \u63d2\u4ef6\uff0c\u7eb3\u5165\u5230\u6574\u4e2a\u540c\u6b65\u6846\u67b6\u4e2d\u3002</p> <p> </p> DataX\u539f\u7406"},{"location":"sync/datax/02/#23-datax","title":"2.3 DataX\u8fd0\u884c\u6d41\u7a0b","text":"<p>\u4e0b\u9762\u7528\u4e00\u4e2a DataX \u4f5c\u4e1a\u751f\u547d\u5468\u671f\u7684\u65f6\u5e8f\u56fe\u8bf4\u660e DataX \u7684\u8fd0\u884c\u6d41\u7a0b\u3001\u6838\u5fc3\u6982\u5ff5\u4ee5\u53ca\u6bcf\u4e2a\u6982\u5ff5\u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p> <p></p>"},{"location":"sync/datax/02/#24-datax","title":"2.4 DataX\u8c03\u5ea6\u51b3\u7b56\u601d\u8def","text":"<p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u7528\u6237\u63d0\u4ea4\u4e86\u4e00\u4e2a DataX \u4f5c\u4e1a\uff0c\u5e76\u4e14\u914d\u7f6e\u4e86\u603b\u7684\u5e76\u53d1\u5ea6\u4e3a 20\uff0c\u76ee\u7684\u662f\u5bf9\u4e00\u4e2a\u6709 100 \u5f20\u5206\u8868\u7684 mysql \u6570\u636e\u6e90\u8fdb\u884c\u540c\u6b65\u3002DataX \u7684\u8c03\u5ea6\u51b3\u7b56\u601d\u8def\u662f\uff1a</p> <p>1\uff09DataX Job \u6839\u636e\u5206\u5e93\u5206\u8868\u5207\u5206\u7b56\u7565\uff0c\u5c06\u540c\u6b65\u5de5\u4f5c\u5206\u6210 100 \u4e2a Task\u3002</p> <p>2\uff09\u6839\u636e\u914d\u7f6e\u7684\u603b\u7684\u5e76\u53d1\u5ea6 20\uff0c\u4ee5\u53ca\u6bcf\u4e2a Task Group \u7684\u5e76\u53d1\u5ea6 5\uff0cDataX \u8ba1\u7b97\u5171\u9700\u8981\u5206\u914d 4 \u4e2a TaskGroup\u3002</p> <p>3\uff094 \u4e2a TaskGroup \u5e73\u5206 100 \u4e2a Task\uff0c\u6bcf\u4e00\u4e2a TaskGroup \u8d1f\u8d23\u8fd0\u884c 25 \u4e2a Task\u3002</p>"},{"location":"sync/datax/02/#25-dataxsqoop","title":"2.5 DataX\u4e0eSqoop\u5bf9\u6bd4","text":"\u529f\u80fd DataX Sqoop \u8fd0\u884c\u6a21\u5f0f \u5355\u8fdb\u7a0b\u591a\u7ebf\u7a0b MR \u5206\u5e03\u5f0f \u4e0d\u652f\u6301\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u5ea6\u7cfb\u7edf\u89c4\u907f \u652f\u6301 \u6d41\u63a7 \u6709\u6d41\u63a7\u529f\u80fd \u9700\u8981\u5b9a\u5236 \u7edf\u8ba1\u4fe1\u606f \u5df2\u6709\u4e00\u4e9b\u7edf\u8ba1\uff0c\u4e0a\u62a5\u9700\u5b9a\u5236 \u6ca1\u6709\uff0c\u5206\u5e03\u5f0f\u7684\u6570\u636e\u6536\u96c6\u4e0d\u65b9\u4fbf \u6570\u636e\u6821\u9a8c \u5728core\u90e8\u5206\u6709\u6821\u9a8c\u529f\u80fd \u6ca1\u6709\uff0c\u5206\u5e03\u5f0f\u7684\u6570\u636e\u6536\u96c6\u4e0d\u65b9\u4fbf \u76d1\u63a7 \u9700\u8981\u5b9a\u5236 \u9700\u8981\u5b9a\u5236"},{"location":"sync/datax/03/","title":"\u7b2c3\u7ae0 DataX\u90e8\u7f72","text":"<p>1\uff09\u4e0b\u8f7d DataX \u5b89\u88c5\u5305\u5e76\u4e0a\u4f20\u5230 hadoop102 \u7684 /opt/software</p> <p>\u4e0b\u8f7d\u5730\u5740</p> <p>2\uff09\u89e3\u538b datax.tar.gz \u5230 /opt/module</p> <pre><code>tar -zxvf datax.tar.gz -C /opt/module/\n</code></pre> <p>3\uff09\u81ea\u68c0\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>python /opt/module/datax/bin/datax.py /opt/module/datax/job/job.json\n</code></pre> <p>\u51fa\u73b0\u5982\u4e0b\u5185\u5bb9\uff0c\u5219\u8868\u660e\u5b89\u88c5\u6210\u529f</p> <pre><code>\u2026\u2026\n2021-10-12 21:51:12.335 [job-0] INFO  JobContainer - \n\u4efb\u52a1\u542f\u52a8\u65f6\u523b                    : 2021-10-12 21:51:02\n\u4efb\u52a1\u7ed3\u675f\u65f6\u523b                    : 2021-10-12 21:51:12\n\u4efb\u52a1\u603b\u8ba1\u8017\u65f6                    :                 10s\n\u4efb\u52a1\u5e73\u5747\u6d41\u91cf                    :          253.91KB/s\n\u8bb0\u5f55\u5199\u5165\u901f\u5ea6                    :          10000rec/s\n\u8bfb\u51fa\u8bb0\u5f55\u603b\u6570                    :              100000\n\u8bfb\u5199\u5931\u8d25\u603b\u6570                    :                   0\n</code></pre>"},{"location":"sync/datax/04/","title":"\u7b2c4\u7ae0 DataX\u4f7f\u7528","text":""},{"location":"sync/datax/04/#41-datax","title":"4.1 DataX\u4f7f\u7528\u6982\u8ff0","text":""},{"location":"sync/datax/04/#411-datax","title":"4.1.1 DataX\u4efb\u52a1\u63d0\u4ea4\u547d\u4ee4","text":"<p>DataX \u7684\u4f7f\u7528\u5341\u5206\u7b80\u5355\uff0c\u7528\u6237\u53ea\u9700\u6839\u636e\u81ea\u5df1\u540c\u6b65\u6570\u636e\u7684\u6570\u636e\u6e90\u548c\u76ee\u7684\u5730\u9009\u62e9\u76f8\u5e94\u7684 Reader \u548c Writer\uff0c\u5e76\u5c06 Reader \u548c Writer \u7684\u4fe1\u606f\u914d\u7f6e\u5728\u4e00\u4e2a json \u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u63d0\u4ea4\u6570\u636e\u540c\u6b65\u4efb\u52a1\u5373\u53ef\u3002</p> <pre><code>python bin/datax.py path/to/your/job.json\n</code></pre>"},{"location":"sync/datax/04/#422-datax","title":"4.2.2 DataX\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u540d\u67e5\u770b DataX \u914d\u7f6e\u6587\u4ef6\u6a21\u677f\u3002</p> <pre><code> python bin/datax.py -r mysqlreader -w hdfswriter\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6\u6a21\u677f\u5982\u4e0b\uff0cjson \u6700\u5916\u5c42\u662f\u4e00\u4e2a job\uff0cjob \u5305\u542b setting \u548c content \u4e24\u90e8\u5206\uff0c\u5176\u4e2d setting \u7528\u4e8e\u5bf9\u6574\u4e2a job \u8fdb\u884c\u914d\u7f6e\uff0ccontent \u7528\u6237\u914d\u7f6e\u6570\u636e\u6e90\u548c\u76ee\u7684\u5730\u3002</p> <p></p> <p>Reader \u548c Writer \u7684\u5177\u4f53\u53c2\u6570\u53ef\u53c2\u8003\u5b98\u65b9\u6587\u6863</p> <p></p>"},{"location":"sync/datax/04/#42-mysqlhdfs","title":"4.2 \u540c\u6b65MySQL\u6570\u636e\u5230HDFS\u6848\u4f8b","text":"<p>\u6848\u4f8b\u8981\u6c42\uff1a\u540c\u6b65 gmall \u6570\u636e\u5e93\u4e2d base_province \u8868\u6570\u636e\u5230 HDFS \u7684 /base_province \u76ee\u5f55</p> <p>\u9700\u6c42\u5206\u6790\uff1a\u8981\u5b9e\u73b0\u8be5\u529f\u80fd\uff0c\u9700\u9009\u7528 MySQLReader \u548c HDFSWriter\uff0cMySQLReader \u5177\u6709\u4e24\u79cd\u6a21\u5f0f\u5206\u522b\u662f TableMode \u548c  QuerySQLMode\uff0c\u524d\u8005\u4f7f\u7528 table\uff0ccolumn\uff0cwhere \u7b49\u5c5e\u6027\u58f0\u660e\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\uff1b\u540e\u8005\u4f7f\u7528\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u58f0\u660e\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u3002\u9700\u6c42\u5206\u6790\uff1a\u8981\u5b9e\u73b0\u8be5\u529f\u80fd\uff0c\u9700\u9009\u7528 MySQLReader \u548c HDFSWriter\uff0cMySQLReader \u5177\u6709\u4e24\u79cd\u6a21\u5f0f\u5206\u522b\u662f TableMode \u548c QuerySQLMode\uff0c\u524d\u8005\u4f7f\u7528 table\uff0ccolumn\uff0cwhere \u7b49\u5c5e\u6027\u58f0\u660e\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\uff1b\u540e\u8005\u4f7f\u7528\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u58f0\u660e\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u3002</p> <p>\u4e0b\u9762\u5206\u522b\u4f7f\u7528\u4e24\u79cd\u6a21\u5f0f\u8fdb\u884c\u6f14\u793a\u3002</p>"},{"location":"sync/datax/04/#421-mysqlreadertablemode","title":"4.2.1 MySQLReader\u4e4bTableMode","text":"<p>1\uff09\u7f16\u5199\u914d\u7f6e\u6587\u4ef6</p> <p>\uff081\uff09\u521b\u5efa\u914d\u7f6e\u6587\u4ef6 base_province.json</p> <pre><code>vim /opt/module/datax/job/base_province.json\n</code></pre> <p>\uff082\uff09\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b</p> base_province.json<pre><code>{\n\"job\": {\n\"content\": [\n{\n\"reader\": {\n\"name\": \"mysqlreader\",\n\"parameter\": {\n\"column\": [\n\"id\",\n\"name\",\n\"region_id\",\n\"area_code\",\n\"iso_code\",\n\"iso_3166_2\"\n],\n\"where\": \"id&gt;=3\",\n\"connection\": [\n{\n\"jdbcUrl\": [\n\"jdbc:mysql://hadoop102:3306/gmall\"\n],\n\"table\": [\n\"base_province\"\n]\n}\n],\n\"password\": \"000000\",\n\"splitPk\": \"\",\n\"username\": \"root\"\n}\n},\n\"writer\": {\n\"name\": \"hdfswriter\",\n\"parameter\": {\n\"column\": [\n{\n\"name\": \"id\",\n\"type\": \"bigint\"\n},\n{\n\"name\": \"name\",\n\"type\": \"string\"\n},\n{\n\"name\": \"region_id\",\n\"type\": \"string\"\n},\n{\n\"name\": \"area_code\",\n\"type\": \"string\"\n},\n{\n\"name\": \"iso_code\",\n\"type\": \"string\"\n},\n{\n\"name\": \"iso_3166_2\",\n\"type\": \"string\"\n}\n],\n\"compress\": \"gzip\",\n\"defaultFS\": \"hdfs://hadoop102:8020\",\n\"fieldDelimiter\": \"\\t\",\n\"fileName\": \"base_province\",\n\"fileType\": \"text\",\n\"path\": \"/base_province\",\n\"writeMode\": \"append\"\n}\n}\n}\n],\n\"setting\": {\n\"speed\": {\n\"channel\": 1\n}\n}\n}\n}\n</code></pre> <p>2\uff09\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e</p> <p>\uff081\uff09Reader \u53c2\u6570\u8bf4\u660e</p> <p></p> <p>\uff082\uff09Writer \u53c2\u6570\u8bf4\u660e</p> <p></p> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>HFDS Writer \u5e76\u672a\u63d0\u4f9b nullFormat \u53c2\u6570\uff1a\u4e5f\u5c31\u662f\u7528\u6237\u5e76\u4e0d\u80fd\u81ea\u5b9a\u4e49 null \u503c\u5199\u5230 HFDS \u6587\u4ef6\u4e2d\u7684\u5b58\u50a8\u683c\u5f0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cHFDS Writer \u4f1a\u5c06 null \u503c\u5b58\u50a8\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff08''\uff09\uff0c\u800c Hive \u9ed8\u8ba4\u7684 null \u503c\u5b58\u50a8\u683c\u5f0f\u4e3a \\N\u3002\u6240\u4ee5\u540e\u671f\u5c06 DataX \u540c\u6b65\u7684\u6587\u4ef6\u5bfc\u5165 Hive \u8868\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</p> <p>\u89e3\u51b3\u8be5\u95ee\u9898\u7684\u65b9\u6848\u6709\u4e24\u4e2a\uff1a</p> <p>\u4e00\u662f\u4fee\u6539 DataX HDFS Writer \u7684\u6e90\u7801\uff0c\u589e\u52a0\u81ea\u5b9a\u4e49 null \u503c\u5b58\u50a8\u683c\u5f0f\u7684\u903b\u8f91\uff0c\u53ef\u53c2\u8003\u535a\u5ba2\u3002</p> <p>\u4e8c\u662f\u5728 Hive \u4e2d\u5efa\u8868\u65f6\u6307\u5b9a null \u503c\u5b58\u50a8\u683c\u5f0f\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff08''\uff09\uff0c\u4f8b\u5982\uff1a</p> <pre><code>DROP TABLE IF EXISTS base_province;\nCREATE EXTERNAL TABLE base_province\n(\n`id`         STRING COMMENT '\u7f16\u53f7',\n`name`       STRING COMMENT '\u7701\u4efd\u540d\u79f0',\n`region_id`  STRING COMMENT '\u5730\u533aID',\n`area_code`  STRING COMMENT '\u5730\u533a\u7f16\u7801',\n`iso_code`   STRING COMMENT '\u65e7\u7248ISO-3166-2\u7f16\u7801\uff0c\u4f9b\u53ef\u89c6\u5316\u4f7f\u7528',\n`iso_3166_2` STRING COMMENT '\u65b0\u7248IOS-3166-2\u7f16\u7801\uff0c\u4f9b\u53ef\u89c6\u5316\u4f7f\u7528'\n) COMMENT '\u7701\u4efd\u8868'\nROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t'\nNULL DEFINED AS ''\nLOCATION '/base_province/';\n</code></pre> <p>\uff083\uff09Setting \u53c2\u6570\u8bf4\u660e</p> <p></p> <p>3\uff09\u63d0\u4ea4\u4efb\u52a1</p> <p>\uff081\uff09\u5728 HDFS \u521b\u5efa /base_province \u76ee\u5f55</p> <p>\u4f7f\u7528 DataX \u5411 HDFS \u540c\u6b65\u6570\u636e\u65f6\uff0c\u9700\u786e\u4fdd\u76ee\u6807\u8def\u5f84\u5df2\u5b58\u5728</p> <pre><code>hadoop fs -mkdir /base_province\n</code></pre> <p>\uff082\uff09\u8fdb\u5165 DataX \u6839\u76ee\u5f55</p> <pre><code>cd /opt/module/datax </code></pre> <p>\uff083\uff09\u6267\u884c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>python bin/datax.py job/base_province.json\n</code></pre> <p>4\uff09\u67e5\u770b\u7ed3\u679c</p> <p>\uff081\uff09DataX \u6253\u5370\u65e5\u5fd7</p> <pre><code>2021-10-13 11:13:14.930 [job-0] INFO  JobContainer - \n\u4efb\u52a1\u542f\u52a8\u65f6\u523b                    : 2021-10-13 11:13:03\n\u4efb\u52a1\u7ed3\u675f\u65f6\u523b                    : 2021-10-13 11:13:14\n\u4efb\u52a1\u603b\u8ba1\u8017\u65f6                    :                 11s\n\u4efb\u52a1\u5e73\u5747\u6d41\u91cf                    :               66B/s\n\u8bb0\u5f55\u5199\u5165\u901f\u5ea6                    :              3rec/s\n\u8bfb\u51fa\u8bb0\u5f55\u603b\u6570                    :                  32\n\u8bfb\u5199\u5931\u8d25\u603b\u6570                    :                   0\n</code></pre> <p>\uff082\uff09\u67e5\u770b HDFS \u6587\u4ef6</p> <pre><code>hadoop fs -cat /base_province/* | zcat\n\n3   \u5c71\u897f  1   140000  CN-14   CN-SX\n4   \u5185\u8499\u53e4 1   150000  CN-15   CN-NM\n5   \u6cb3\u5317  1   130000  CN-13   CN-HE\n6   \u4e0a\u6d77  2   310000  CN-31   CN-SH\n7   \u6c5f\u82cf  2   320000  CN-32   CN-JS\n8   \u6d59\u6c5f  2   330000  CN-33   CN-ZJ\n9   \u5b89\u5fbd  2   340000  CN-34   CN-AH\n10  \u798f\u5efa  2   350000  CN-35   CN-FJ\n11  \u6c5f\u897f  2   360000  CN-36   CN-JX\n12  \u5c71\u4e1c  2   370000  CN-37   CN-SD\n14  \u53f0\u6e7e  2   710000  CN-71   CN-TW\n15  \u9ed1\u9f99\u6c5f 3   230000  CN-23   CN-HL\n16  \u5409\u6797  3   220000  CN-22   CN-JL\n17  \u8fbd\u5b81  3   210000  CN-21   CN-LN\n18  \u9655\u897f  7   610000  CN-61   CN-SN\n19  \u7518\u8083  7   620000  CN-62   CN-GS\n20  \u9752\u6d77  7   630000  CN-63   CN-QH\n21  \u5b81\u590f  7   640000  CN-64   CN-NX\n22  \u65b0\u7586  7   650000  CN-65   CN-XJ\n23  \u6cb3\u5357  4   410000  CN-41   CN-HA\n24  \u6e56\u5317  4   420000  CN-42   CN-HB\n25  \u6e56\u5357  4   430000  CN-43   CN-HN\n26  \u5e7f\u4e1c  5   440000  CN-44   CN-GD\n27  \u5e7f\u897f  5   450000  CN-45   CN-GX\n28  \u6d77\u5357  5   460000  CN-46   CN-HI\n29  \u9999\u6e2f  5   810000  CN-91   CN-HK\n30  \u6fb3\u95e8  5   820000  CN-92   CN-MO\n31  \u56db\u5ddd  6   510000  CN-51   CN-SC\n32  \u8d35\u5dde  6   520000  CN-52   CN-GZ\n33  \u4e91\u5357  6   530000  CN-53   CN-YN\n13  \u91cd\u5e86  6   500000  CN-50   CN-CQ\n34  \u897f\u85cf  6   540000  CN-54   CN-XZ\n</code></pre>"},{"location":"sync/datax/04/#422-mysqlreaderquerysqlmode","title":"4.2.2 MySQLReader\u4e4bQuerySQLMode","text":"<p>1\uff09\u7f16\u5199\u914d\u7f6e\u6587\u4ef6</p> <p>\uff081\uff09\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 base_province.json</p> <pre><code>vim /opt/module/datax/job/base_province.json\n</code></pre> <p>\uff082\uff09\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b</p> base_province.json<pre><code>{\n\"job\": {\n\"content\": [\n{\n\"reader\": {\n\"name\": \"mysqlreader\",\n\"parameter\": {\n\"connection\": [\n{\n\"jdbcUrl\": [\n\"jdbc:mysql://hadoop102:3306/gmall\"\n],\n\"querySql\": [\n\"select id,name,region_id,area_code,iso_code,iso_3166_2 from base_province where id&gt;=3\"\n]\n}\n],\n\"password\": \"000000\",\n\"username\": \"root\"\n}\n},\n\"writer\": {\n\"name\": \"hdfswriter\",\n\"parameter\": {\n\"column\": [\n{\n\"name\": \"id\",\n\"type\": \"bigint\"\n},\n{\n\"name\": \"name\",\n\"type\": \"string\"\n},\n{\n\"name\": \"region_id\",\n\"type\": \"string\"\n},\n{\n\"name\": \"area_code\",\n\"type\": \"string\"\n},\n{\n\"name\": \"iso_code\",\n\"type\": \"string\"\n},\n{\n\"name\": \"iso_3166_2\",\n\"type\": \"string\"\n}\n],\n\"compress\": \"gzip\",\n\"defaultFS\": \"hdfs://hadoop102:8020\",\n\"fieldDelimiter\": \"\\t\",\n\"fileName\": \"base_province\",\n\"fileType\": \"text\",\n\"path\": \"/base_province\",\n\"writeMode\": \"append\"\n}\n}\n}\n],\n\"setting\": {\n\"speed\": {\n\"channel\": 1\n}\n}\n}\n}\n</code></pre> <p>2\uff09\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e</p> <p>\uff081\uff09Reader \u53c2\u6570\u8bf4\u660e</p> <p></p> <p>3\uff09\u63d0\u4ea4\u4efb\u52a1</p> <p>\uff081\uff09\u6e05\u7a7a\u5386\u53f2\u6570\u636e</p> <pre><code>hadoop fs -rm -r -f /base_province/*\n</code></pre> <p>\uff082\uff09\u8fdb\u5165 DataX \u6839\u76ee\u5f55</p> <pre><code>cd /opt/module/datax </code></pre> <p>\uff083\uff09\u6267\u884c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>python bin/datax.py job/base_province.json\n</code></pre> <p>4\uff09\u67e5\u770b\u7ed3\u679c</p> <p>\uff081\uff09DataX \u6253\u5370\u65e5\u5fd7</p> <pre><code>2021-10-13 11:13:14.930 [job-0] INFO  JobContainer - \n\u4efb\u52a1\u542f\u52a8\u65f6\u523b                    : 2021-10-13 11:13:03\n\u4efb\u52a1\u7ed3\u675f\u65f6\u523b                    : 2021-10-13 11:13:14\n\u4efb\u52a1\u603b\u8ba1\u8017\u65f6                    :                 11s\n\u4efb\u52a1\u5e73\u5747\u6d41\u91cf                    :               66B/s\n\u8bb0\u5f55\u5199\u5165\u901f\u5ea6                    :              3rec/s\n\u8bfb\u51fa\u8bb0\u5f55\u603b\u6570                    :                  32\n\u8bfb\u5199\u5931\u8d25\u603b\u6570                    :                   0\n</code></pre> <p>\uff082\uff09\u67e5\u770b HDFS \u6587\u4ef6</p> <pre><code>hadoop fs -cat /base_province/* | zcat\n\n3   \u5c71\u897f  1   140000  CN-14   CN-SX\n4   \u5185\u8499\u53e4 1   150000  CN-15   CN-NM\n5   \u6cb3\u5317  1   130000  CN-13   CN-HE\n6   \u4e0a\u6d77  2   310000  CN-31   CN-SH\n7   \u6c5f\u82cf  2   320000  CN-32   CN-JS\n8   \u6d59\u6c5f  2   330000  CN-33   CN-ZJ\n9   \u5b89\u5fbd  2   340000  CN-34   CN-AH\n10  \u798f\u5efa  2   350000  CN-35   CN-FJ\n11  \u6c5f\u897f  2   360000  CN-36   CN-JX\n12  \u5c71\u4e1c  2   370000  CN-37   CN-SD\n14  \u53f0\u6e7e  2   710000  CN-71   CN-TW\n15  \u9ed1\u9f99\u6c5f 3   230000  CN-23   CN-HL\n16  \u5409\u6797  3   220000  CN-22   CN-JL\n17  \u8fbd\u5b81  3   210000  CN-21   CN-LN\n18  \u9655\u897f  7   610000  CN-61   CN-SN\n19  \u7518\u8083  7   620000  CN-62   CN-GS\n20  \u9752\u6d77  7   630000  CN-63   CN-QH\n21  \u5b81\u590f  7   640000  CN-64   CN-NX\n22  \u65b0\u7586  7   650000  CN-65   CN-XJ\n23  \u6cb3\u5357  4   410000  CN-41   CN-HA\n24  \u6e56\u5317  4   420000  CN-42   CN-HB\n25  \u6e56\u5357  4   430000  CN-43   CN-HN\n26  \u5e7f\u4e1c  5   440000  CN-44   CN-GD\n27  \u5e7f\u897f  5   450000  CN-45   CN-GX\n28  \u6d77\u5357  5   460000  CN-46   CN-HI\n29  \u9999\u6e2f  5   810000  CN-91   CN-HK\n30  \u6fb3\u95e8  5   820000  CN-92   CN-MO\n31  \u56db\u5ddd  6   510000  CN-51   CN-SC\n32  \u8d35\u5dde  6   520000  CN-52   CN-GZ\n33  \u4e91\u5357  6   530000  CN-53   CN-YN\n13  \u91cd\u5e86  6   500000  CN-50   CN-CQ\n34  \u897f\u85cf  6   540000  CN-54   CN-XZ\n</code></pre>"},{"location":"sync/datax/04/#423-datax","title":"4.2.3 DataX\u4f20\u53c2","text":"<p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u79bb\u7ebf\u6570\u636e\u540c\u6b65\u4efb\u52a1\u9700\u8981\u6bcf\u65e5\u5b9a\u65f6\u91cd\u590d\u6267\u884c\uff0c\u6545 HDFS \u4e0a\u7684\u76ee\u6807\u8def\u5f84\u901a\u5e38\u4f1a\u5305\u542b\u4e00\u5c42\u65e5\u671f\uff0c\u4ee5\u5bf9\u6bcf\u65e5\u540c\u6b65\u7684\u6570\u636e\u52a0\u4ee5\u533a\u5206\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u65e5\u540c\u6b65\u6570\u636e\u7684\u76ee\u6807\u8def\u5f84\u4e0d\u662f\u56fa\u5b9a\u4e0d\u53d8\u7684\uff0c\u56e0\u6b64 DataX \u914d\u7f6e\u6587\u4ef6\u4e2d HDFS Writer \u7684 path \u53c2\u6570\u7684\u503c\u5e94\u8be5\u662f\u52a8\u6001\u7684\u3002\u4e3a\u5b9e\u73b0\u8fd9\u4e00\u6548\u679c\uff0c\u5c31\u9700\u8981\u4f7f\u7528 DataX \u4f20\u53c2\u7684\u529f\u80fd\u3002</p> <p>DataX \u4f20\u53c2\u7684\u7528\u6cd5\u5982\u4e0b\uff0c\u5728 JSON \u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 <code>${param}</code> \u5f15\u7528\u53c2\u6570\uff0c\u5728\u63d0\u4ea4\u4efb\u52a1\u65f6\u4f7f\u7528 <code>-p\"-Dparam=value\"</code> \u4f20\u5165\u53c2\u6570\u503c\uff0c\u5177\u4f53\u793a\u4f8b\u5982\u4e0b\u3002</p> <p>1\uff09\u7f16\u5199\u914d\u7f6e\u6587\u4ef6</p> <p>\uff081\uff09\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 base_province.json</p> <pre><code>vim /opt/module/datax/job/base_province.json\n</code></pre> <p>\uff082\uff09\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b</p> base_province.json<pre><code>{\n\"job\": {\n\"content\": [\n{\n\"reader\": {\n\"name\": \"mysqlreader\",\n\"parameter\": {\n\"connection\": [\n{\n\"jdbcUrl\": [\n\"jdbc:mysql://hadoop102:3306/gmall\"\n],\n\"querySql\": [\n\"select id,name,region_id,area_code,iso_code,iso_3166_2 from base_province where id&gt;=3\"\n]\n}\n],\n\"password\": \"000000\",\n\"username\": \"root\"\n}\n},\n\"writer\": {\n\"name\": \"hdfswriter\",\n\"parameter\": {\n\"column\": [\n{\n\"name\": \"id\",\n\"type\": \"bigint\"\n},\n{\n\"name\": \"name\",\n\"type\": \"string\"\n},\n{\n\"name\": \"region_id\",\n\"type\": \"string\"\n},\n{\n\"name\": \"area_code\",\n\"type\": \"string\"\n},\n{\n\"name\": \"iso_code\",\n\"type\": \"string\"\n},\n{\n\"name\": \"iso_3166_2\",\n\"type\": \"string\"\n}\n],\n\"compress\": \"gzip\",\n\"defaultFS\": \"hdfs://hadoop102:8020\",\n\"fieldDelimiter\": \"\\t\",\n\"fileName\": \"base_province\",\n\"fileType\": \"text\",\n\"path\": \"/base_province/${dt}\",\n\"writeMode\": \"append\"\n}\n}\n}\n],\n\"setting\": {\n\"speed\": {\n\"channel\": 1\n}\n}\n}\n}\n</code></pre> <p>2\uff09\u63d0\u4ea4\u4efb\u52a1</p> <p>\uff081\uff09\u521b\u5efa\u76ee\u6807\u8def\u5f84</p> <pre><code>hadoop fs -mkdir /base_province/2020-06-14\n</code></pre> <p>\uff082\uff09\u8fdb\u5165 DataX \u6839\u76ee\u5f55</p> <pre><code>cd /opt/module/datax </code></pre> <p>\uff083\uff09\u6267\u884c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>python bin/datax.py -p\"-Ddt=2020-06-14\" job/base_province.json\n</code></pre> <p>3\uff09\u67e5\u770b\u7ed3\u679c</p> <pre><code>hadoop fs -ls /base_province\n\nFound 2 items\ndrwxr-xr-x   - atguigu supergroup          0 2021-10-15 21:41 /base_province/2020-06-14\n</code></pre>"},{"location":"sync/datax/04/#43-hdfsmysql","title":"4.3 \u540c\u6b65HDFS\u6570\u636e\u5230MySQL\u6848\u4f8b","text":"<p>\u6848\u4f8b\u8981\u6c42\uff1a\u540c\u6b65 HDFS \u4e0a\u7684 /base_province \u76ee\u5f55\u4e0b\u7684\u6570\u636e\u5230 MySQL gmall  \u6570\u636e\u5e93\u4e0b\u7684 test_province \u8868\u3002</p> <p>\u9700\u6c42\u5206\u6790\uff1a\u8981\u5b9e\u73b0\u8be5\u529f\u80fd\uff0c\u9700\u9009\u7528 HDFSReader \u548c MySQLWriter\u3002</p> <p>1\uff09\u7f16\u5199\u914d\u7f6e\u6587\u4ef6</p> <p>\uff081\uff09\u521b\u5efa\u914d\u7f6e\u6587\u4ef6 test_province.json</p> <pre><code>vim /opt/module/datax/job/base_province.json\n</code></pre> <p>\uff082\uff09\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b</p> base_province.json<pre><code>{\n\"job\": {\n\"content\": [\n{\n\"reader\": {\n\"name\": \"hdfsreader\",\n\"parameter\": {\n\"defaultFS\": \"hdfs://hadoop102:8020\",\n\"path\": \"/base_province\",\n\"column\": [\n\"*\"\n],\n\"fileType\": \"text\",\n\"compress\": \"gzip\",\n\"encoding\": \"UTF-8\",\n\"nullFormat\": \"\\\\N\",\n\"fieldDelimiter\": \"\\t\",\n}\n},\n\"writer\": {\n\"name\": \"mysqlwriter\",\n\"parameter\": {\n\"username\": \"root\",\n\"password\": \"000000\",\n\"connection\": [\n{\n\"table\": [\n\"test_province\"\n],\n\"jdbcUrl\": \"jdbc:mysql://hadoop102:3306/gmall?useUnicode=true&amp;characterEncoding=utf-8\"\n}\n],\n\"column\": [\n\"id\",\n\"name\",\n\"region_id\",\n\"area_code\",\n\"iso_code\",\n\"iso_3166_2\"\n],\n\"writeMode\": \"replace\"\n}\n}\n}\n],\n\"setting\": {\n\"speed\": {\n\"channel\": 1\n}\n}\n}\n}\n</code></pre> <p>2\uff09\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e</p> <p>\uff081\uff09Reader \u53c2\u6570\u8bf4\u660e</p> <p></p> <p>\uff082\uff09Writer \u53c2\u6570\u8bf4\u660e</p> <p></p> <p>3\uff09\u63d0\u4ea4\u4efb\u52a1</p> <p>\uff081\uff09\u5728 MySQL \u4e2d\u521b\u5efa gmall.test_province \u8868</p> <pre><code>DROP TABLE IF EXISTS `test_province`;\nCREATE TABLE `test_province`  (\n`id` bigint(20) NOT NULL,\n`name` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n`region_id` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n`area_code` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n`iso_code` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\n`iso_3166_2` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,\nPRIMARY KEY (`id`)\n) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;\n</code></pre> <p>\uff082\uff09\u8fdb\u5165 DataX \u6839\u76ee\u5f55</p> <pre><code>cd /opt/module/datax\n</code></pre> <p>\uff083\uff09\u6267\u884c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>python bin/datax.py job/test_province.json </code></pre> <p>4\uff09\u67e5\u770b\u7ed3\u679c</p> <p>\uff081\uff09DataX \u6253\u5370\u65e5\u5fd7</p> <pre><code>2021-10-13 15:21:35.006 [job-0] INFO  JobContainer - \n\u4efb\u52a1\u542f\u52a8\u65f6\u523b                    : 2021-10-13 15:21:23\n\u4efb\u52a1\u7ed3\u675f\u65f6\u523b                    : 2021-10-13 15:21:35\n\u4efb\u52a1\u603b\u8ba1\u8017\u65f6                    :                 11s\n\u4efb\u52a1\u5e73\u5747\u6d41\u91cf                    :               70B/s\n\u8bb0\u5f55\u5199\u5165\u901f\u5ea6                    :              3rec/s\n\u8bfb\u51fa\u8bb0\u5f55\u603b\u6570                    :                  34\n\u8bfb\u5199\u5931\u8d25\u603b\u6570                    :                   0\n</code></pre> <p>\uff082\uff09\u67e5\u770b MySQL \u76ee\u6807\u8868\u6570\u636e</p> <p></p>"},{"location":"sync/datax/05/","title":"\u7b2c5\u7ae0 DataX\u4f18\u5316","text":""},{"location":"sync/datax/05/#51","title":"5.1 \u901f\u5ea6\u63a7\u5236","text":"<p>DataX 3.0 \u63d0\u4f9b\u4e86\u5305\u62ec\u901a\u9053(\u5e76\u53d1)\u3001\u8bb0\u5f55\u6d41\u3001\u5b57\u8282\u6d41\u4e09\u79cd\u6d41\u63a7\u6a21\u5f0f\uff0c\u53ef\u4ee5\u968f\u610f\u63a7\u5236\u4f60\u7684\u4f5c\u4e1a\u901f\u5ea6\uff0c\u8ba9\u4f60\u7684\u4f5c\u4e1a\u5728\u6570\u636e\u5e93\u53ef\u4ee5\u627f\u53d7\u7684\u8303\u56f4\u5185\u8fbe\u5230\u6700\u4f73\u7684\u540c\u6b65\u901f\u5ea6\u3002</p> <p>\u5173\u952e\u4f18\u5316\u53c2\u6570\u5982\u4e0b\uff1a</p> \u53c2\u6570 \u8bf4\u660e job.setting.speed.channel \u5e76\u53d1\u6570 job.setting.speed.record \u603brecord\u9650\u901f job.setting.speed.byte \u603bbyte\u9650\u901f core.transport.channel.speed.record \u5355\u4e2achannel\u7684record\u9650\u901f\uff0c\u9ed8\u8ba4\u503c\u4e3a10000\uff0810000\u6761/s\uff09 core.transport.channel.speed.byte \u5355\u4e2achannel\u7684byte\u9650\u901f\uff0c\u9ed8\u8ba4\u503c1024*1024\uff081M/s\uff09 <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ol> <li> <p>\u82e5\u914d\u7f6e\u4e86\u603b record \u9650\u901f\uff0c\u5219\u5fc5\u987b\u914d\u7f6e\u5355\u4e2a channel \u7684 record \u9650\u901f</p> </li> <li> <p>\u82e5\u914d\u7f6e\u4e86\u603b byte \u9650\u901f\uff0c\u5219\u5fc5\u987b\u914d\u7f6e\u5355\u4e2a channe \u7684 byte \u9650\u901f</p> </li> <li> <p>\u82e5\u914d\u7f6e\u4e86\u603b record \u9650\u901f\u548c\u603b byte \u9650\u901f\uff0cchannel \u5e76\u53d1\u6570\u53c2\u6570\u5c31\u4f1a\u5931\u6548\u3002\u56e0\u4e3a\u914d\u7f6e\u4e86\u603b record \u9650\u901f\u548c\u603b byte \u9650\u901f\u4e4b\u540e\uff0c\u5b9e\u9645 channel \u5e76\u53d1\u6570\u662f\u901a\u8fc7\u8ba1\u7b97\u5f97\u5230\u7684\uff1a</p> </li> </ol> <p>\u8ba1\u7b97\u516c\u5f0f\u4e3a:</p> <p>min(\u603b byte \u9650\u901f/\u5355\u4e2a channel \u7684 byte \u9650\u901f\uff0c\u603b record \u9650\u901f/\u5355\u4e2a channel \u7684 record \u9650\u901f)</p> <p>\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>{\n\"core\": {\n\"transport\": {\n\"channel\": {\n\"speed\": {\n\"byte\": 1048576 //\u5355\u4e2achannel byte\u9650\u901f1M/s\n}\n}\n}\n},\n\"job\": {\n\"setting\": {\n\"speed\": {\n\"byte\" : 5242880 //\u603bbyte\u9650\u901f5M/s\n}\n},\n...\n}\n}\n</code></pre>"},{"location":"sync/datax/05/#52","title":"5.2 \u5185\u5b58\u8c03\u6574","text":"<p>\u5f53\u63d0\u5347 DataX Job \u5185 Channel \u5e76\u53d1\u6570\u65f6\uff0c\u5185\u5b58\u7684\u5360\u7528\u4f1a\u663e\u8457\u589e\u52a0\uff0c\u56e0\u4e3a DataX \u4f5c\u4e3a\u6570\u636e\u4ea4\u6362\u901a\u9053\uff0c\u5728\u5185\u5b58\u4e2d\u4f1a\u7f13\u5b58\u8f83\u591a\u7684\u6570\u636e\u3002\u4f8b\u5982 Channel \u4e2d\u4f1a\u6709\u4e00\u4e2a Buffer\uff0c\u4f5c\u4e3a\u4e34\u65f6\u7684\u6570\u636e\u4ea4\u6362\u7684\u7f13\u51b2\u533a\uff0c\u800c\u5728\u90e8\u5206 Reader \u548c Writer \u7684\u4e2d\uff0c\u4e5f\u4f1a\u5b58\u5728\u4e00\u4e9b Buffer\uff0c\u4e3a\u4e86\u9632\u6b62 OOM \u7b49\u9519\u8bef\uff0c\u9700\u8c03\u5927 JVM \u7684\u5806\u5185\u5b58\u3002</p> <p>\u5efa\u8bae\u5c06\u5185\u5b58\u8bbe\u7f6e\u4e3a 4G \u6216\u8005 8G\uff0c\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u8c03\u6574\u3002</p> <p>\u8c03\u6574 JVM xms xmx \u53c2\u6570\u7684\u4e24\u79cd\u65b9\u5f0f\uff1a\u4e00\u79cd\u662f\u76f4\u63a5\u66f4\u6539 datax.py \u811a\u672c\uff1b\u53e6\u4e00\u79cd\u662f\u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u52a0\u4e0a\u5bf9\u5e94\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a</p> <pre><code>python datax/bin/datax.py --jvm=\"-Xms8G -Xmx8G\" /path/to/your/job.json\n</code></pre>"},{"location":"sync/flinkcdc/01/","title":"\u7b2c1\u7ae0 CDC\u7b80\u4ecb","text":""},{"location":"sync/flinkcdc/01/#11-cdc","title":"1.1 \u4ec0\u4e48\u662fCDC","text":"<p>CDC \u662f Change Data Capture (\u53d8\u66f4\u6570\u636e\u83b7\u53d6)\u7684\u7b80\u79f0\u3002\u6838\u5fc3\u601d\u60f3\u662f\uff0c\u76d1\u6d4b\u5e76\u6355\u83b7\u6570\u636e\u5e93\u7684\u53d8\u52a8\uff08\u5305\u62ec\u6570\u636e\u6216\u6570\u636e\u8868\u7684\u63d2\u5165\u3001\u66f4\u65b0\u4ee5\u53ca\u5220\u9664\u7b49\uff09\uff0c\u5c06\u8fd9\u4e9b\u53d8\u66f4\u6309\u53d1\u751f\u7684\u987a\u5e8f\u5b8c\u6574\u8bb0\u5f55\u4e0b\u6765\uff0c\u5199\u5165\u5230\u6d88\u606f\u4e2d\u95f4\u4ef6\u4e2d\u4ee5\u4f9b\u5176\u4ed6\u670d\u52a1\u8fdb\u884c\u8ba2\u9605\u53ca\u6d88\u8d39\u3002</p>"},{"location":"sync/flinkcdc/01/#12-cdc","title":"1.2 CDC\u7684\u79cd\u7c7b","text":"<p>CDC \u4e3b\u8981\u5206\u4e3a\u57fa\u4e8e{=+\u67e5++}\u8be2\u548c\u57fa\u4e8e Binlog \u4e24\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u4e3b\u8981\u4e86\u89e3\u4e00\u4e0b\u8fd9\u4e24\u79cd\u4e4b\u95f4\u7684\u533a\u522b\uff1a</p> \u57fa\u4e8e\u67e5\u8be2\u7684CDC \u57fa\u4e8eBinlog\u7684CDC \u5f00\u6e90\u4ea7\u54c1 Sqoop\u3001Kafka JDBC Source Canal\u3001Maxwell\u3001Debezium \u6267\u884c\u6a21\u5f0f Batch Streaming \u662f\u5426\u53ef\u4ee5\u6355\u83b7\u6240\u6709\u6570\u636e\u53d8\u5316 \u5426 \u662f \u5ef6\u8fdf\u6027 \u9ad8\u5ef6\u8fdf \u4f4e\u5ef6\u8fdf \u662f\u5426\u589e\u52a0\u6570\u636e\u5e93\u538b\u529b \u662f \u5426"},{"location":"sync/flinkcdc/01/#13-flink-cdc","title":"1.3 Flink-CDC","text":"<p>Flink \u793e\u533a\u5f00\u53d1\u4e86 flink-cdc-connectors \u7ec4\u4ef6\uff0c\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u76f4\u63a5\u4ece MySQL\u3001PostgreSQL \u7b49\u6570\u636e\u5e93\u76f4\u63a5\u8bfb\u53d6\u5168\u91cf\u6570\u636e\u548c\u589e\u91cf\u53d8\u66f4\u6570\u636e\u7684 source \u7ec4\u4ef6\u3002\u76ee\u524d\u4e5f\u5df2\u5f00\u6e90\uff0c</p> <p>\u53c2\u8003\u6587\u7ae0</p> <p>Github\u4ed3\u5e93</p> <p></p>"},{"location":"sync/flinkcdc/02/","title":"\u7b2c2\u7ae0 FlinkCDC\u6848\u4f8b\u5b9e\u64cd","text":""},{"location":"sync/flinkcdc/02/#21-mysql-binlogmysql","title":"2.1 \u5f00\u542fMySQL Binlog\u5e76\u91cd\u542fMySQL","text":""},{"location":"sync/flinkcdc/02/#22-datastream","title":"2.2 DataStream\u65b9\u5f0f\u7684\u5e94\u7528","text":""},{"location":"sync/flinkcdc/02/#221","title":"2.2.1 \u5bfc\u5165\u4f9d\u8d56","text":"pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n&lt;artifactId&gt;flink-java&lt;/artifactId&gt;\n&lt;version&gt;1.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n&lt;artifactId&gt;flink-streaming-java_2.12&lt;/artifactId&gt;\n&lt;version&gt;1.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n&lt;artifactId&gt;flink-clients_2.12&lt;/artifactId&gt;\n&lt;version&gt;1.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n&lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n&lt;version&gt;3.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;mysql&lt;/groupId&gt;\n&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n&lt;version&gt;8.0.16&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;com.ververica&lt;/groupId&gt;\n&lt;artifactId&gt;flink-connector-mysql-cdc&lt;/artifactId&gt;\n&lt;version&gt;2.1.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;!-- \u5982\u679c\u4e0d\u5f15\u5165 flink-table \u76f8\u5173\u4f9d\u8d56\uff0c\u5219\u4f1a\u62a5\u9519\uff1a\nCaused by: java.lang.ClassNotFoundException: \norg.apache.flink.connector.base.source.reader.RecordEmitter\n\u5f15\u5165\u5982\u4e0b\u4f9d\u8d56\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff08\u5f15\u5165\u67d0\u4e9b\u5176\u5b83\u7684 flink-table \u76f8\u5173\u4f9d\u8d56\u4e5f\u53ef\uff09\n--&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n&lt;artifactId&gt;flink-table-api-java-bridge_2.12&lt;/artifactId&gt;\n&lt;version&gt;1.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n&lt;artifactId&gt;fastjson&lt;/artifactId&gt;\n&lt;version&gt;1.2.68&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n&lt;build&gt;\n&lt;plugins&gt;\n&lt;plugin&gt;\n&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;\n&lt;version&gt;3.0.0&lt;/version&gt;\n&lt;configuration&gt;\n&lt;descriptorRefs&gt;\n&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;\n&lt;/descriptorRefs&gt;\n&lt;/configuration&gt;\n&lt;executions&gt;\n&lt;execution&gt;\n&lt;id&gt;make-assembly&lt;/id&gt;\n&lt;phase&gt;package&lt;/phase&gt;\n&lt;goals&gt;\n&lt;goal&gt;single&lt;/goal&gt;\n&lt;/goals&gt;\n&lt;/execution&gt;\n&lt;/executions&gt;\n&lt;/plugin&gt;\n&lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>"},{"location":"sync/flinkcdc/02/#222","title":"2.2.2 \u7f16\u5199\u4ee3\u7801","text":"<pre><code>import com.ververica.cdc.connectors.mysql.source.MySqlSource;\nimport com.ververica.cdc.connectors.mysql.table.StartupOptions;\nimport com.ververica.cdc.debezium.JsonDebeziumDeserializationSchema;\nimport org.apache.flink.api.common.eventtime.WatermarkStrategy;\nimport org.apache.flink.api.common.restartstrategy.RestartStrategies;\nimport org.apache.flink.api.common.time.Time;\nimport org.apache.flink.runtime.state.hashmap.HashMapStateBackend;\nimport org.apache.flink.streaming.api.CheckpointingMode;\nimport org.apache.flink.streaming.api.datastream.DataStreamSource;\nimport org.apache.flink.streaming.api.environment.CheckpointConfig;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\n\nimport java.util.Properties;\n\npublic class FlinkCDC_01_DS {\npublic static void main(String[] args) throws Exception {\n// TODO 1. \u51c6\u5907\u6d41\u5904\u7406\u73af\u5883\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nenv.setParallelism(1);\n\n// TODO 2. \u5f00\u542f\u68c0\u67e5\u70b9   Flink-CDC\u5c06\u8bfb\u53d6binlog\u7684\u4f4d\u7f6e\u4fe1\u606f\u4ee5\u72b6\u6001\u7684\u65b9\u5f0f\u4fdd\u5b58\u5728CK,\u5982\u679c\u60f3\u8981\u505a\u5230\u65ad\u70b9\u7eed\u4f20,\n// \u9700\u8981\u4eceCheckpoint\u6216\u8005Savepoint\u542f\u52a8\u7a0b\u5e8f\n// 2.1 \u5f00\u542fCheckpoint,\u6bcf\u96945\u79d2\u949f\u505a\u4e00\u6b21CK  ,\u5e76\u6307\u5b9aCK\u7684\u4e00\u81f4\u6027\u8bed\u4e49\nenv.enableCheckpointing(3000L, CheckpointingMode.EXACTLY_ONCE);\n// 2.2 \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u4e3a 1 \u5206\u949f\nenv.getCheckpointConfig().setCheckpointTimeout(60 * 1000L);\n// 2.3 \u8bbe\u7f6e\u4e24\u6b21\u91cd\u542f\u7684\u6700\u5c0f\u65f6\u95f4\u95f4\u9694\nenv.getCheckpointConfig().setMinPauseBetweenCheckpoints(3000L);\n// 2.4 \u8bbe\u7f6e\u4efb\u52a1\u5173\u95ed\u7684\u65f6\u5019\u4fdd\u7559\u6700\u540e\u4e00\u6b21 CK \u6570\u636e\nenv.getCheckpointConfig().enableExternalizedCheckpoints(\nCheckpointConfig.ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);\n// 2.5 \u6307\u5b9a\u4ece CK \u81ea\u52a8\u91cd\u542f\u7b56\u7565\nenv.setRestartStrategy(RestartStrategies.failureRateRestart(\n3, Time.days(1L), Time.minutes(1L)\n));\n// 2.6 \u8bbe\u7f6e\u72b6\u6001\u540e\u7aef\nenv.setStateBackend(new HashMapStateBackend());\nenv.getCheckpointConfig().setCheckpointStorage(\n\"hdfs://hadoop102:8020/flinkCDC\"\n);\n// 2.7 \u8bbe\u7f6e\u8bbf\u95eeHDFS\u7684\u7528\u6237\u540d\nSystem.setProperty(\"HADOOP_USER_NAME\", \"atguigu\");\n\n// TODO 3. \u521b\u5efa Flink-MySQL-CDC \u7684 Source\n// initial:Performs an initial snapshot on the monitored database tables upon first startup, and continue to read the latest binlog.\n// earliest:Never to perform snapshot on the monitored database tables upon first startup, just read from the beginning of the binlog. This should be used with care, as it is only valid when the binlog is guaranteed to contain the entire history of the database.\n// latest:Never to perform snapshot on the monitored database tables upon first startup, just read from the end of the binlog which means only have the changes since the connector was started.\n// specificOffset:Never to perform snapshot on the monitored database tables upon first startup, and directly read binlog from the specified offset.\n// timestamp:Never to perform snapshot on the monitored database tables upon first startup, and directly read binlog from the specified timestamp.The consumer will traverse the binlog from the beginning and ignore change events whose timestamp is smaller than the specified timestamp.\nMySqlSource&lt;String&gt; mySqlSource = MySqlSource.&lt;String&gt;builder()\n.hostname(\"hadoop102\")\n.port(3306)\n.databaseList(\"gmall_config\") // set captured database\n.tableList(\"gmall_config.t_user\") // set captured table\n.username(\"root\")\n.password(\"000000\")\n.deserializer(new JsonDebeziumDeserializationSchema()) // converts SourceRecord to JSON String\n.startupOptions(StartupOptions.initial())\n.build();\n\n// TODO 4.\u4f7f\u7528CDC Source\u4eceMySQL\u8bfb\u53d6\u6570\u636e\nDataStreamSource&lt;String&gt; mysqlDS =\nenv.fromSource(\nmySqlSource,\nWatermarkStrategy.noWatermarks(),\n\"MysqlSource\");\n\n// TODO 5.\u6253\u5370\u8f93\u51fa\nmysqlDS.print();\n\n// TODO 6.\u6267\u884c\u4efb\u52a1\nenv.execute();\n}\n}\n</code></pre>"},{"location":"sync/flinkcdc/02/#223","title":"2.2.3\u6848\u4f8b\u6d4b\u8bd5","text":"<p>1\uff09\u6253\u5305\u5e76\u4e0a\u4f20\u81f3 Linux</p> <p></p> <p>2\uff09\u542f\u52a8 HDFS \u96c6\u7fa4</p> <pre><code>start-dfs.sh\n</code></pre> <p>3\uff09\u542f\u52a8 Flink \u96c6\u7fa4</p> <pre><code>bin/start-cluster.sh\n</code></pre> <p>4\uff09\u542f\u52a8\u7a0b\u5e8f</p> <pre><code>bin/flink run -m hadoop102:8081 -c com.atguigu.cdc.FlinkCDC_01_DS ./gmall-flink-cdc.jar\n</code></pre> <p>5\uff09\u89c2\u5bdf taskManager \u65e5\u5fd7\uff0c\u4f1a\u4ece\u5934\u8bfb\u53d6\u8868\u6570\u636e</p> <p>6\uff09\u7ed9\u5f53\u524d\u7684 Flink \u7a0b\u5e8f\u521b\u5efa Savepoint </p> <pre><code>bin/flink savepoint JobId hdfs://hadoop102:8020/flinkCDC/save\n</code></pre> <p>\u5728 WebU I\u4e2d cancelJob</p> <p>\u5728 MySQL \u7684 gmall_config.t_user \u8868\u4e2d\u6dfb\u52a0\u3001\u4fee\u6539\u6216\u8005\u5220\u9664\u6570\u636e</p> <p>\u4ece Savepoint \u91cd\u542f\u7a0b\u5e8f</p> <pre><code>bin/flink run -s hdfs://hadoop102:8020/flink/save/... -c com.atguigu.cdc.FlinkCDC_01_DS ./gmall-flink-cdc.jar\n</code></pre> <p>\u89c2\u5bdf taskManager \u65e5\u5fd7\uff0c\u4f1a\u4ece\u68c0\u67e5\u70b9\u8bfb\u53d6\u8868\u6570\u636e</p>"},{"location":"sync/flinkcdc/02/#23-flinksql","title":"2.3 FlinkSQL\u65b9\u5f0f\u7684\u5e94\u7528","text":""},{"location":"sync/flinkcdc/02/#231","title":"2.3.1 \u6dfb\u52a0\u4f9d\u8d56","text":"pom.xml<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n&lt;artifactId&gt;flink-table-planner-blink_2.12&lt;/artifactId&gt;\n&lt;version&gt;1.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"sync/flinkcdc/02/#232","title":"2.3.2 \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.table.api.bridge.java.StreamTableEnvironment;\n\npublic class FlinkCDC_02_SQL {\npublic static void main(String[] args) throws Exception {\n// TODO 1. \u51c6\u5907\u73af\u5883\n// 1.1 \u6d41\u5904\u7406\u73af\u5883\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nenv.setParallelism(1);\n// 1.2 \u8868\u6267\u884c\u73af\u5883\nStreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);\n\n// TODO 2. \u521b\u5efa\u52a8\u6001\u8868\ntableEnv.executeSql(\"CREATE TABLE user_info (\\n\" +\n\"id INT,\\n\" +\n\"name STRING,\\n\" +\n\"age INT,\\n\" +\n\"primary key(id) not enforced\\n\" +\n\") WITH (\" +\n\"'connector' = 'mysql-cdc',\" +\n\"'hostname' = 'hadoop102',\" +\n\"'port' = '3306',\" +\n\"'username' = 'root',\" +\n\"'password' = '000000',\" +\n\"'database-name' = 'gmall_config',\" +\n\"'table-name' = 't_user'\" +\n\")\");\n\ntableEnv.executeSql(\"select * from user_info\").print();\n\n// TODO 3. \u6267\u884c\u4efb\u52a1\nenv.execute();\n}\n}\n</code></pre>"},{"location":"sync/flume/fl_01/","title":"\u7b2c1\u7ae0 Flume\u6982\u8ff0","text":""},{"location":"sync/flume/fl_01/#11-flume","title":"1.1 Flume\u5b9a\u4e49","text":"<p>Flume \u662f Cloudera \u63d0\u4f9b\u7684\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\uff0c\u9ad8\u53ef\u9760\u7684\uff0c\u5206\u5e03\u5f0f\u7684\u6d77\u91cf\u65e5\u5fd7\u91c7\u96c6\u3001\u805a\u5408\u548c\u4f20\u8f93\u7684\u7cfb\u7edf\u3002Flume \u57fa\u4e8e\u6d41\u5f0f\u67b6\u6784\uff0c\u7075\u6d3b\u7b80\u5355\u3002</p> <p></p>"},{"location":"sync/flume/fl_01/#12-flume","title":"1.2 Flume\u57fa\u7840\u67b6\u6784","text":"<p>Flume \u7ec4\u6210\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"sync/flume/fl_01/#121-agent","title":"1.2.1 Agent","text":"<p>Agent \u662f\u4e00\u4e2a JVM \u8fdb\u7a0b\uff0c\u5b83\u4ee5\u4e8b\u4ef6\u7684\u5f62\u5f0f\u5c06\u6570\u636e\u4ece\u6e90\u5934\u9001\u81f3\u76ee\u7684\u5730\u3002</p> <p>Agent \u4e3b\u8981\u6709 3 \u4e2a\u90e8\u5206\u7ec4\u6210\uff0cSource\u3001Channel\u3001Sink\u3002</p>"},{"location":"sync/flume/fl_01/#122-source","title":"1.2.2 Source","text":"<p>Source \u662f\u8d1f\u8d23\u63a5\u6536\u6570\u636e\u5230 Flume Agent \u7684\u7ec4\u4ef6\u3002Source \u7ec4\u4ef6\u53ef\u4ee5\u5904\u7406\u5404\u79cd\u7c7b\u578b\u3001\u5404\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7\u6570\u636e </p>"},{"location":"sync/flume/fl_01/#123-sink","title":"1.2.3 Sink","text":"<p>Sink \u4e0d\u65ad\u5730\u8f6e\u8be2 Channel \u4e2d\u7684\u4e8b\u4ef6\u4e14\u6279\u91cf\u5730\u79fb\u9664\u5b83\u4eec\uff0c\u5e76\u5c06\u8fd9\u4e9b\u4e8b\u4ef6\u6279\u91cf\u5199\u5165\u5230\u5b58\u50a8\u6216\u7d22\u5f15\u7cfb\u7edf\u3001\u6216\u8005\u88ab\u53d1\u9001\u5230\u53e6\u4e00\u4e2a Flume Agent\u3002</p>"},{"location":"sync/flume/fl_01/#124-channel","title":"1.2.4 Channel","text":"<p>Channel \u662f\u4f4d\u4e8e Source \u548c Sink \u4e4b\u95f4\u7684\u7f13\u51b2\u533a\u3002\u56e0\u6b64\uff0cChannel \u5141\u8bb8 Source \u548c Sink \u8fd0\u4f5c\u5728\u4e0d\u540c\u7684\u901f\u7387\u4e0a\u3002Channel \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u51e0\u4e2a Source \u7684\u5199\u5165\u64cd\u4f5c\u548c\u51e0\u4e2a Sink \u7684\u8bfb\u53d6\u64cd\u4f5c\u3002</p> <p>Flume \u81ea\u5e26\u4e24\u79cd Channel\uff1aMemory Channel \u548c File Channel\u3002</p> <p>Memory Channel \u662f\u5185\u5b58\u4e2d\u7684\u961f\u5217\u3002Memory Channel \u5728\u4e0d\u9700\u8981\u5173\u5fc3\u6570\u636e\u4e22\u5931\u7684\u60c5\u666f\u4e0b\u9002\u7528\u3002\u5982\u679c\u9700\u8981\u5173\u5fc3\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48 Memory Channel \u5c31\u4e0d\u5e94\u8be5\u4f7f\u7528\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u6b7b\u4ea1\u3001\u673a\u5668\u5b95\u673a\u6216\u8005\u91cd\u542f\u90fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002</p> <p>File Channel \u5c06\u6240\u6709\u4e8b\u4ef6\u5199\u5230\u78c1\u76d8\u3002\u56e0\u6b64\u5728\u7a0b\u5e8f\u5173\u95ed\u6216\u673a\u5668\u5b95\u673a\u7684\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\u3002</p>"},{"location":"sync/flume/fl_01/#125-event","title":"1.2.5 Event","text":"<p>\u4f20\u8f93\u5355\u5143\uff0cFlume \u6570\u636e\u4f20\u8f93\u7684\u57fa\u672c\u5355\u5143\uff0c\u4ee5 Event \u7684\u5f62\u5f0f\u5c06\u6570\u636e\u4ece\u6e90\u5934\u9001\u81f3\u76ee\u7684\u5730\u3002Event \u7531 Header \u548c Body \u4e24\u90e8\u5206\u7ec4\u6210\uff0cHeader \u7528\u6765\u5b58\u653e\u8be5 event \u7684\u4e00\u4e9b\u5c5e\u6027\uff0c\u4e3aK-V\u7ed3\u6784\uff0cBody\u7528\u6765\u5b58\u653e\u8be5\u6761\u6570\u636e\uff0c\u5f62\u5f0f\u4e3a\u5b57\u8282\u6570\u7ec4\u3002</p> <p></p>"},{"location":"sync/flume/fl_02/","title":"\u7b2c2\u7ae0 Flume\u5165\u95e8","text":""},{"location":"sync/flume/fl_02/#21-flume","title":"2.1 Flume\u5b89\u88c5\u90e8\u7f72","text":""},{"location":"sync/flume/fl_02/#211","title":"2.1.1 \u5b89\u88c5\u5730\u5740","text":"<p>\uff081\uff09Flume \u5b98\u7f51\u5730\u5740</p> <p>\uff082\uff09\u6587\u6863\u67e5\u770b\u5730\u5740</p> <p>\uff083\uff09\u4e0b\u8f7d\u5730\u5740</p>"},{"location":"sync/flume/fl_02/#212","title":"2.1.2 \u5b89\u88c5\u90e8\u7f72","text":"<p>\uff081\uff09\u5c06 apache-flume-1.9.0-bin.tar.gz \u4e0a\u4f20\u5230 linux \u7684 /opt/software \u76ee\u5f55\u4e0b</p> <p>\uff082\uff09\u89e3\u538b apache-flume-1.9.0-bin.tar.gz \u5230 /opt/module/ \u76ee\u5f55\u4e0b</p> <pre><code>tar -zxvf /opt/software/apache-flume-1.9.0-bin.tar.gz -C /opt/module/\n</code></pre> <p>\uff083\uff09\u4fee\u6539 apache-flume-1.9.0-bin \u7684\u540d\u79f0\u4e3a flume</p> <pre><code>mv /opt/module/apache-flume-1.9.0-bin /opt/module/flume\n</code></pre> <p>\uff084\uff09\u5c06 lib \u6587\u4ef6\u5939\u4e0b\u7684 guava-11.0.2.jar \u5220\u9664\u4ee5\u517c\u5bb9 Hadoop 3.1.3</p> <pre><code>rm /opt/module/flume/lib/guava-11.0.2.jar\n</code></pre> <p>\uff085\uff09\u4fee\u6539 conf \u4e0b\u7684 log4j.properties \u786e\u5b9a\u65e5\u5fd7\u6253\u5370\u7684\u4f4d\u7f6e</p> log4j.properties<pre><code>#console\u8868\u793a\u540c\u65f6\u5c06\u65e5\u5fd7\u8f93\u51fa\u5230\u63a7\u5236\u53f0\nflume.root.logger=INFO,LOGFILE,console\n#\u56fa\u5b9a\u65e5\u5fd7\u8f93\u51fa\u7684\u4f4d\u7f6e\nflume.log.dir=/opt/module/flume/logs\n#\u65e5\u5fd7\u6587\u4ef6\u7684\u540d\u79f0\nflume.log.file=flume.log\n</code></pre>"},{"location":"sync/flume/fl_02/#22-flume","title":"2.2 Flume\u5165\u95e8\u6848\u4f8b","text":""},{"location":"sync/flume/fl_02/#221","title":"2.2.1 \u76d1\u63a7\u7aef\u53e3\u6570\u636e\u5b98\u65b9\u6848\u4f8b","text":"<p>1\uff09\u6848\u4f8b\u9700\u6c42\uff1a</p> <p>\u4f7f\u7528 Flume \u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\uff0c\u6536\u96c6\u8be5\u7aef\u53e3\u6570\u636e\uff0c\u5e76\u6253\u5370\u5230\u63a7\u5236\u53f0\u3002 </p> <p>2\uff09\u5b9e\u73b0\u6b65\u9aa4\uff1a</p> <p>\uff081\uff09\u5b89\u88c5 netcat \u5de5\u5177</p> <pre><code>sudo yum install -y nc\n</code></pre> <p>\uff082\uff09\u5224\u65ad 44444 \u7aef\u53e3\u662f\u5426\u88ab\u5360\u7528</p> <pre><code>sudo netstat -nlp | grep 44444\n</code></pre> <p>\uff083\uff09\u5728 conf \u6587\u4ef6\u5939\u4e0b\u521b\u5efa Flume Agent \u914d\u7f6e\u6587\u4ef6 nc-flume-log.conf</p> nc-flume-log.conf<pre><code>\u6dfb\u52a0\u5185\u5bb9\u5982\u4e0b\uff1a\n# Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre> <p>\u6ce8</p> <p>\u914d\u7f6e\u6587\u4ef6\u6765\u6e90\u4e8e\u5b98\u65b9\u624b\u518c</p> <p>\uff084\uff09\u5148\u5f00\u542f flume \u76d1\u542c\u7aef\u53e3</p> <p>\u7b2c\u4e00\u79cd\u5199\u6cd5\uff1a</p> <pre><code>bin/flume-ng agent --conf conf/ --name a1 --conf-file conf/nc-flume-log.conf -Dflume.root.logger=INFO,console\n</code></pre> <p>\u7b2c\u4e8c\u79cd\u5199\u6cd5\uff1a</p> <pre><code>bin/flume-ng agent -c conf/ -n a1 -f conf/nc-flume-log.conf -Dflume.root.logger=INFO,console\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>--conf / -c\uff1a\u8868\u793a\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\u5728 conf/ \u76ee\u5f55</li> <li>--name / -n\uff1a\u8868\u793a\u7ed9 agent \u8d77\u540d\u4e3a a1</li> <li>--conf-file / -f\uff1aflume \u672c\u6b21\u542f\u52a8\u8bfb\u53d6\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u5728 conf \u6587\u4ef6\u5939\u4e0b\u7684 nc-flume-log.conf \u6587\u4ef6\u3002</li> <li>-Dflume.root.logger=INFO,console \uff1a-D \u8868\u793a flume \u8fd0\u884c\u65f6\u52a8\u6001\u4fee\u6539 flume.root.logger \u53c2\u6570\u5c5e\u6027\u503c\uff0c\u5e76\u5c06\u63a7\u5236\u53f0\u65e5\u5fd7\u6253\u5370\u7ea7\u522b\u8bbe\u7f6e\u4e3a INFO \u7ea7\u522b\u3002\u65e5\u5fd7\u7ea7\u522b\u5305\u62ec:log\u3001info\u3001warn\u3001error\u3002\u65e5\u5fd7\u53c2\u6570\u5df2\u7ecf\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4fee\u6539\u4e86\uff0c\u4e0d\u518d\u9700\u8981\u91cd\u590d\u8f93\u5165\u3002</li> </ul> <p>\uff085\uff09\u4f7f\u7528 netcat \u5de5\u5177\u5411\u672c\u673a\u7684 44444 \u7aef\u53e3\u53d1\u9001\u5185\u5bb9</p> <pre><code>nc localhost 44444\n</code></pre> <p>\uff086\uff09\u5728 Flume \u76d1\u542c\u9875\u9762\u89c2\u5bdf\u63a5\u6536\u6570\u636e\u60c5\u51b5</p> <pre><code>2021-07-15 13:51:00,236 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:95)] Event: { headers:{} body: 31 30                                           10 }\n</code></pre> <p>\uff087\uff09event \u6253\u5370\u7684\u6e90\u7801\u4ecb\u7ecd</p> <p>LoggerSink \u7684 process \u65b9\u6cd5\uff1a</p> <pre><code>if (event != null) {\nif (logger.isInfoEnabled()) {\nlogger.info(\"Event: \" + EventHelper.dumpEvent(event, maxBytesToLog));\n}\n}\n</code></pre> <p>dumpEvent \u65b9\u6cd5\u8fd4\u56de\u503c\uff1abuffer \u662f\u56fa\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\uff0c\u524d\u7aef\u662f 16 \u8fdb\u5236\u8868\u793a\u7684\u5b57\u7b26\u7684 ASCII \u503c\u3002</p> <pre><code>return \"{ headers:\" + event.getHeaders() + \" body:\" + buffer + \" }\";\n</code></pre>"},{"location":"sync/flume/fl_02/#222","title":"2.2.2 \u5b9e\u65f6\u76d1\u63a7\u76ee\u5f55\u4e0b\u7684\u591a\u4e2a\u8ffd\u52a0\u6587\u4ef6","text":"<p>Taildir Source \u9002\u5408\u7528\u4e8e\u76d1\u542c\u591a\u4e2a\u5b9e\u65f6\u8ffd\u52a0\u7684\u6587\u4ef6\uff0c\u5e76\u4e14\u80fd\u591f\u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\u3002</p> <p>1\uff09\u6848\u4f8b\u9700\u6c42:\u4f7f\u7528 Flume \u76d1\u542c\u6574\u4e2a\u76ee\u5f55\u7684\u5b9e\u65f6\u8ffd\u52a0\u6587\u4ef6\uff0c\u5e76\u4e0a\u4f20\u81f3 HDFS </p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p></p> <p>3\uff09\u5b9e\u73b0\u6b65\u9aa4</p> <p>\uff081\uff09\u5728 conf \u76ee\u5f55\u4e0b\u521b\u5efa\u914d\u7f6e\u6587\u4ef6 taildir-flume-hdfs.conf</p> <p>\u2460\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6</p> <pre><code>vim taildir-flume-hdfs.conf\n</code></pre> <p>\u2461\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> taildir-flume-hdfs.conf<pre><code>a1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = TAILDIR\na1.sources.r1.filegroups = f1 f2\n# \u5fc5\u987b\u7cbe\u786e\u5230\u6587\u4ef6\uff0c\u53ef\u4ee5\u5199\u5339\u914d\u8868\u8fbe\u5f0f\u5339\u914d\u591a\u4e2a\u6587\u4ef6\na1.sources.r1.filegroups.f1 = /opt/module/flume/files1/.*file.*\na1.sources.r1.filegroups.f2 = /opt/module/flume/files2/.*log.*\n# \u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\u7684\u6587\u4ef6\u5b58\u653e\u4f4d\u7f6e \u4e0d\u6539\u6709\u9ed8\u8ba4\u4f4d\u7f6e\u4e5f\u80fd\u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\na1.sources.r1.positionFile = /opt/module/flume/taildir_position.json\n\n\n# Describe the sink\na1.sinks.k1.type = hdfs\n# \u5730\u5740\u503c\u53ef\u4ee5\u586b\u5199hdfs://hadoop102:8020\u4e5f\u53ef\u4ee5\u7701\u7565,flume\u4f1a\u81ea\u52a8\u8bfb\u53d6hadoop\u914d\u7f6e\u6587\u4ef6\u4fe1\u606f\u83b7\u53d6\u5730\u5740\na1.sinks.k1.hdfs.path = hdfs://hadoop102:8020/flume/%Y%m%d/%H\n#\u4e0a\u4f20\u6587\u4ef6\u7684\u524d\u7f00\na1.sinks.k1.hdfs.filePrefix = log-\n\n#\u662f\u5426\u4f7f\u7528\u672c\u5730\u65f6\u95f4\u6233\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n\n#\u8bbe\u7f6e\u6587\u4ef6\u7c7b\u578b \u5206\u4e3a\u4e8c\u8fdb\u5236\u6587\u4ef6SequenceFile\u548c\u6587\u672c\u6587\u4ef6DataStream(\u4e0d\u80fd\u538b\u7f29) \u548cCompressedStream(\u53ef\u4ee5\u538b\u7f29)\na1.sinks.k1.hdfs.fileType = DataStream\n\n#\u591a\u4e45\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\na1.sinks.k1.hdfs.rollInterval = 30\n#\u8bbe\u7f6e\u6bcf\u4e2a\u6587\u4ef6\u7684\u6eda\u52a8\u5927\u5c0f\u5927\u6982\u662f128M\na1.sinks.k1.hdfs.rollSize = 134217700\n#\u6587\u4ef6\u7684\u6eda\u52a8\u4e0eEvent\u6570\u91cf\u65e0\u5173\na1.sinks.k1.hdfs.rollCount = 0 \n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre> <p>\uff082\uff09\u5411 files \u6587\u4ef6\u5939\u4e2d\u8ffd\u52a0\u5185\u5bb9</p> <p>\u5728 /opt/module/flume \u76ee\u5f55\u4e0b\u521b\u5efa files1 \u6587\u4ef6\u5939</p> <pre><code>mkdir files1\nmkdir files2\n</code></pre> <p>\uff083\uff09\u542f\u52a8\u76d1\u63a7\u6587\u4ef6\u5939\u547d\u4ee4</p> <pre><code>bin/flume-ng agent --conf conf/ --name a1 --conf-file conf/taildir-flume-hdfs.conf\n</code></pre> <p>\u5411 upload \u6587\u4ef6\u5939\u4e2d\u6dfb\u52a0\u6587\u4ef6</p> <pre><code>echo hello &gt;&gt; file1.txt\necho atguigu &gt;&gt; file2.txt\n</code></pre> <p>\uff084\uff09\u67e5\u770b HDFS \u4e0a\u7684\u6570\u636e</p> <p>Taildir \u8bf4\u660e\uff1a</p> <p>Taildir Source \u7ef4\u62a4\u4e86\u4e00\u4e2a json \u683c\u5f0f\u7684 position File\uff0c\u5176\u4f1a\u5b9a\u671f\u7684\u5f80 position File \u4e2d\u66f4\u65b0\u6bcf\u4e2a\u6587\u4ef6\u8bfb\u53d6\u5230\u7684\u6700\u65b0\u7684\u4f4d\u7f6e\uff0c\u56e0\u6b64\u80fd\u591f\u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\u3002Position File \u7684\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>{\"inode\":2496272,\"pos\":12,\"file\":\"/opt/module/flume/files1/file1.txt\"}\n{\"inode\":2496275,\"pos\":12,\"file\":\"/opt/module/flume/files1/file2.txt\"}\n</code></pre> <p>\u6ce8</p> <p>Linux \u4e2d\u50a8\u5b58\u6587\u4ef6\u5143\u6570\u636e\u7684\u533a\u57df\u5c31\u53eb\u505a inode\uff0c\u6bcf\u4e2a inode \u90fd\u6709\u4e00\u4e2a\u53f7\u7801\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7528 inode \u53f7\u7801\u6765\u8bc6\u522b\u4e0d\u540c\u7684\u6587\u4ef6\uff0cUnix/Linux \u7cfb\u7edf\u5185\u90e8\u4e0d\u4f7f\u7528\u6587\u4ef6\u540d\uff0c\u800c\u4f7f\u7528 inode \u53f7\u7801\u6765\u8bc6\u522b\u6587\u4ef6\u3002TailDir source \u4f7f\u7528 inode \u548c\u6587\u4ef6\u7684\u5168\u8def\u5f84\u4e00\u8d77\u8bc6\u522b\u540c\u4e00\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\u4fee\u6539\u6587\u4ef6\u540d\u4e4b\u540e\u5982\u679c\u8868\u8fbe\u5f0f\u4e5f\u80fd\u591f\u5339\u914d\u4e0a\uff0c\u4f1a\u518d\u91cd\u65b0\u8bfb\u53d6\u4e00\u4efd\u6587\u4ef6\u7684\u6570\u636e\u3002</p>"},{"location":"sync/flume/fl_03/","title":"\u7b2c3\u7ae0 Flume\u8fdb\u9636","text":""},{"location":"sync/flume/fl_03/#31-flume","title":"3.1 Flume\u4e8b\u52a1","text":""},{"location":"sync/flume/fl_03/#32-flume-agent","title":"3.2 Flume Agent\u5185\u90e8\u539f\u7406","text":"<p>\u7ec4\u4ef6\u4ecb\u7ecd\uff1a</p> <p>1\uff09ChannelSelector</p> <p>ChannelSelector \u7684\u4f5c\u7528\u5c31\u662f\u9009\u51fa Event \u5c06\u8981\u88ab\u53d1\u5f80\u54ea\u4e2a Channel\u3002\u5176\u5171\u6709\u4e24\u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f Replicating\uff08\u590d\u5236\uff09\u548c Multiplexing\uff08\u591a\u8def\u590d\u7528\uff09\u3002</p> <p>ReplicatingSelector \u4f1a\u5c06\u540c\u4e00\u4e2a Event \u53d1\u5f80\u6240\u6709\u7684 Channel\uff0cMultiplexing \u4f1a\u6839\u636e\u76f8\u5e94\u7684\u539f\u5219\uff0c\u5c06\u4e0d\u540c\u7684 Event \u53d1\u5f80\u4e0d\u540c\u7684 Channel\u3002</p> <p>2\uff09SinkProcessor</p> <p>SinkProcessor \u5171\u6709\u4e09\u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f DefaultSinkProcessor(\u9ed8\u8ba4 1 \u5bf9 1)\u3001LoadBalancingSinkProcessor (\u8d1f\u8f7d\u5747\u8861)\u548c FailoverSinkProcessor(\u6545\u969c\u8f6c\u79fb)</p> <p>DefaultSinkProcessor \u5bf9\u5e94\u7684\u662f\u5355\u4e2a\u7684 Sink\uff0cLoadBalancingSinkProcessor \u548c FailoverSinkProcessor \u5bf9\u5e94\u7684\u662f Sink Group\uff0c</p> <p>LoadBalancingSinkProcessor \u53ef\u4ee5\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u7684\u529f\u80fd\uff0cFailoverSinkProcessor \u53ef\u4ee5\u9519\u8bef\u6062\u590d\u7684\u529f\u80fd\u3002</p>"},{"location":"sync/flume/fl_03/#33-flume","title":"3.3 Flume\u4f01\u4e1a\u5f00\u53d1\u6848\u4f8b","text":""},{"location":"sync/flume/fl_03/#331","title":"3.3.1 \u590d\u5236\u6848\u4f8b","text":"<p>1\uff09\u6848\u4f8b\u9700\u6c42</p> <p>\u4f7f\u7528 Flume-1 \u76d1\u63a7\u6587\u4ef6\u53d8\u52a8\uff0cFlume-1 \u5c06\u53d8\u52a8\u5185\u5bb9\u4f20\u9012\u7ed9 Flume-2\uff0cFlume-2 \u8d1f\u8d23\u5b58\u50a8\u5230 HDFS\u3002\u540c\u65f6 Flume-1 \u5c06\u53d8\u52a8\u5185\u5bb9\u4f20\u9012\u7ed9 Flume-3\uff0cFlume-3 \u8d1f\u8d23\u8f93\u51fa\u5230 Local FileSystem\u3002</p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p></p> <p>3\uff09\u5b9e\u73b0\u6b65\u9aa4</p> <p>\uff081\uff09\u51c6\u5907\u5de5\u4f5c</p> <p>\u5728 /opt/module/flume/conf \u76ee\u5f55\u4e0b\u521b\u5efa group1 \u6587\u4ef6\u5939\u3002</p> <pre><code>mkdir group1/\n</code></pre> <p>\u5728 /opt/module/flume/ \u76ee\u5f55\u4e0b\u521b\u5efa flume3datas \u6587\u4ef6\u5939\u3002</p> <pre><code>mkdir flume3datas\n</code></pre> <p>\uff082\uff09\u521b\u5efa flume1.conf</p> <p>\u914d\u7f6e 1 \u4e2a\u63a5\u6536\u65e5\u5fd7\u6587\u4ef6\u7684 source \u548c\u4e24\u4e2a channel\u3001\u4e24\u4e2a sink\uff0c\u5206\u522b\u8f93\u9001\u7ed9 flume2 \u548c flume3\u3002</p> <p>\u2460\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim flume1.conf\n</code></pre> <p>\u2461\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> flume1.conf<pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1 k2\na1.channels = c1 c2\n\n# Describe/configure the source\na1.sources.r1.type = TAILDIR\na1.sources.r1.filegroups = f1 f2\na1.sources.r1.filegroups.f1 = /opt/module/flume/files1/.*file.*\na1.sources.r1.filegroups.f2 = /opt/module/flume/files2/.*log.*\na1.sources.r1.positionFile = /opt/module/flume/taildir_position.json\n\n\n# \u5c06\u6570\u636e\u6d41\u590d\u5236\u7ed9\u6240\u6709channel \u9ed8\u8ba4\u53c2\u6570\u53ef\u4ee5\u4e0d\u5199\na1.sources.r1.selector.type = replicating\n\n\n# Describe the sink\n# sink\u7aef\u7684avro\u662f\u4e00\u4e2a\u6570\u636e\u53d1\u9001\u8005\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = hadoop102 \na1.sinks.k1.port = 4141\n\na1.sinks.k2.type = avro\na1.sinks.k2.hostname = hadoop102\na1.sinks.k2.port = 4142\n\n# Describe the channel\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\na1.channels.c2.type = memory\na1.channels.c2.capacity = 1000\na1.channels.c2.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1 c2\na1.sinks.k1.channel = c1\na1.sinks.k2.channel = c2\n</code></pre> <p>\uff083\uff09\u521b\u5efa flume2.conf</p> <p>\u914d\u7f6e\u4e0a\u7ea7 Flume \u8f93\u51fa\u7684 Source\uff0c\u8f93\u51fa\u662f\u5230 HDFS \u7684 Sink\u3002</p> <p>\u2460\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim flume2.conf\n</code></pre> <p>\u2461\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> flume2.conf<pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\n\na1.sources.r1.type = avro\na1.sources.r1.bind = hadoop102\na1.sources.r1.port = 4141\n\n\n# Describe the sink\na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = hdfs://hadoop102:8020/flume1/%Y%m%d/%H\n# \u6587\u4ef6\u7684\u524d\u7f00\na1.sinks.k1.hdfs.filePrefix = log-\n\n#\u591a\u4e45\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\na1.sinks.k1.hdfs.rollInterval = 30\n#\u8bbe\u7f6e\u6bcf\u4e2a\u6587\u4ef6\u7684\u6eda\u52a8\u5927\u5c0f\u5927\u6982\u662f128M\na1.sinks.k1.hdfs.rollSize = 134217700\n#\u6587\u4ef6\u7684\u6eda\u52a8\u4e0eEvent\u6570\u91cf\u65e0\u5173\na1.sinks.k1.hdfs.rollCount = 0\n# \u4f7f\u7528\u672c\u5730\u7684\u65f6\u95f4\u6233\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n\n#\u8bbe\u7f6e\u6587\u4ef6\u7c7b\u578b \u5206\u4e3a\u4e8c\u8fdb\u5236\u6587\u4ef6SequenceFile\u548c\u6587\u672c\u6587\u4ef6DataStream(\u4e0d\u80fd\u538b\u7f29) \u548cCompressedStream(\u53ef\u4ee5\u538b\u7f29)\na1.sinks.k1.hdfs.fileType = DataStream\n\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre> <p>\uff084\uff09\u521b\u5efa flume3.conf</p> <p>\u914d\u7f6e\u4e0a\u7ea7 Flume \u8f93\u51fa\u7684 Source\uff0c\u8f93\u51fa\u662f\u5230\u672c\u5730\u76ee\u5f55\u7684 Sink\u3002</p> <p>\u2460\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim flume3.conf\n</code></pre> <p>\u2461\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> flume3.conf<pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\n\na1.sources.r1.type = avro\na1.sources.r1.bind = hadoop102\na1.sources.r1.port = 4142\n\n\n# Describe the sink\na1.sinks.k1.type = file_roll\na1.sinks.k1.sink.directory = /opt/module/flume/flume3datas\n\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre> <p>\u63d0\u793a</p> <p>\u8f93\u51fa\u7684\u672c\u5730\u76ee\u5f55\u5fc5\u987b\u662f\u5df2\u7ecf\u5b58\u5728\u7684\u76ee\u5f55\uff0c\u5982\u679c\u8be5\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5e76\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u76ee\u5f55\u3002</p> <p>\uff085\uff09\u542f\u52a8 Hadoop</p> <pre><code>sbin/start-dfs.sh\nsbin/start-yarn.sh\n</code></pre> <p>\uff086\uff09\u6267\u884c\u914d\u7f6e\u6587\u4ef6</p> <p>\u5206\u522b\u542f\u52a8\u5bf9\u5e94\u7684 flume \u8fdb\u7a0b\uff1aflume1\uff0cflume2\uff0cflume3\u3002</p> <pre><code>bin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group1/flume3.conf\nbin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group1/flume2.conf\nbin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group1/flume1.conf\n</code></pre> <p>\uff087\uff09\u5411\u76d1\u63a7\u7684\u6587\u4ef6\u4f20\u5165\u6570\u636e</p> <pre><code>echo hello &gt;&gt; file1.txt\n</code></pre> <p>\uff088\uff09\u68c0\u67e5 HDFS \u4e0a\u6570\u636e</p> <p></p> <p>\uff088\uff09\u68c0\u67e5 /opt/module/datas/flume3 \u76ee\u5f55\u4e2d\u6570\u636e</p> <pre><code>ll\n\n\u603b\u7528\u91cf 8\n-rw-rw-r--. 1 atguigu atguigu 5942 5\u6708  22 00:09 1526918887550-3\n</code></pre>"},{"location":"sync/flume/fl_03/#332","title":"3.3.2 \u591a\u8def\u590d\u7528\u53ca\u62e6\u622a\u5668\u7684\u4f7f\u7528","text":"<p>1\uff09\u6848\u4f8b\u9700\u6c42</p> <p>\u4f7f\u7528 Flume \u91c7\u96c6\u670d\u52a1\u5668\u672c\u5730\u65e5\u5fd7\uff0c\u9700\u8981\u6309\u7167\u65e5\u5fd7\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u5c06\u4e0d\u540c\u79cd\u7c7b\u7684\u65e5\u5fd7\u53d1\u5f80\u4e0d\u540c\u7684\u5206\u6790\u7cfb\u7edf\u3002</p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p>\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u4ea7\u751f\u7684\u65e5\u5fd7\u7c7b\u578b\u53ef\u80fd\u6709\u5f88\u591a\u79cd\uff0c\u4e0d\u540c\u7c7b\u578b\u7684\u65e5\u5fd7\u53ef\u80fd\u9700\u8981\u53d1\u9001\u5230\u4e0d\u540c\u7684\u5206\u6790\u7cfb\u7edf\u3002\u6b64\u65f6\u4f1a\u7528\u5230 Flume \u7684channel selecter \u4e2d\u7684 Multiplexing \u7ed3\u6784\uff0cMultiplexing \u7684\u539f\u7406\u662f\uff0c\u6839\u636e event \u4e2d Header \u7684\u67d0\u4e2a key \u7684\u503c\uff0c\u5c06\u4e0d\u540c\u7684 event \u53d1\u9001\u5230\u4e0d\u540c\u7684 Channel \u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e2a Interceptor\uff0c\u4e3a\u4e0d\u540c\u7c7b\u578b\u7684 event \u7684 Header \u4e2d\u7684 key \u8d4b\u4e88\u4e0d\u540c\u7684\u503c\u3002</p> <p>\u5728\u8be5\u6848\u4f8b\u4e2d\uff0c\u6211\u4eec\u4ee5\u7aef\u53e3\u6570\u636e\u6a21\u62df\u65e5\u5fd7\uff0c\u4ee5\u6570\u5b57\uff08\u5355\u4e2a\uff09\u548c\u5b57\u6bcd\uff08\u5355\u4e2a\uff09\u6a21\u62df\u4e0d\u540c\u7c7b\u578b\u7684\u65e5\u5fd7\uff0c\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49 interceptor \u533a\u5206\u6570\u5b57\u548c\u5b57\u6bcd\uff0c\u5c06\u5176\u5206\u522b\u53d1\u5f80\u4e0d\u540c\u7684\u5206\u6790\u7cfb\u7edf\uff08Channel\uff09\u3002</p> <p></p> <p>3\uff09\u5b9e\u73b0\u6b65\u9aa4</p> <p>\uff081\uff09\u521b\u5efa\u4e00\u4e2a maven \u9879\u76ee\uff0c\u5e76\u5f15\u5165\u4ee5\u4e0b\u4f9d\u8d56\u3002</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.apache.flume&lt;/groupId&gt;\n&lt;artifactId&gt;flume-ng-core&lt;/artifactId&gt;\n&lt;version&gt;1.9.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>\uff082\uff09\u5b9a\u4e49 CustomInterceptor \u7c7b\u5e76\u5b9e\u73b0 Interceptor \u63a5\u53e3\u3002</p> <pre><code>package com.atguigu.flume;\n\nimport org.apache.flume.Context;\nimport org.apache.flume.Event;\nimport org.apache.flume.interceptor.Interceptor;\n\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * @author yhm\n * @create 2021-07-28 15:14\n *\n * 1. \u5b9e\u73b0interceptor\u63a5\u53e3\n * 2. \u5b9e\u73b0\u63a5\u53e3\u76844\u4e2a\u65b9\u6cd5\n * 3. \u5b9e\u73b0\u4e00\u4e2a\u9759\u6001\u5185\u90e8\u7c7b\u521b\u5efa\u62e6\u622a\u5668\n */\npublic class MyInterceptor implements Interceptor {\n/**\n     * \u521d\u59cb\u5316\u65b9\u6cd5\n     */\n@Override\npublic void initialize() {\n\n}\n\n/**\n     * \u5904\u7406\u5355\u6761event\n     * @param event\n     * @return\n     */\n@Override\npublic Event intercept(Event event) {\n// \u9700\u8981\u914d\u5408channel\u9009\u62e9\u5668\u4f7f\u7528  \u5411headers\u5f53\u4e2dput\u5bf9\u5e94\u7684\u53c2\u6570\n// \u6839\u636e\u4f20\u5165\u7684\u6570\u636e \u9996\u4f4d\u662f\u6570\u5b57\u8fd8\u662f\u5b57\u6bcd  \u5224\u65ad\u4ed6\u662f\u4e0d\u540c\u7c7b\u578b\u7684\u65e5\u5fd7\nbyte[] body = event.getBody();\nbyte b = body[0];\nMap&lt;String, String&gt; headers = event.getHeaders();\n\nif (b &gt;= '0' &amp;&amp; b &lt;= '9'){\n// b\u4e3a\u6570\u5b57\nheaders.put(\"type\",\"number\");\n}else if((b &gt;= 'a' &amp;&amp; b &lt;= 'z') || (b &gt;= 'A' &amp;&amp; b &lt;= 'Z')){\n// b \u4e3a\u5b57\u6bcd\nheaders.put(\"type\",\"letter\");\n}\n\n// \u53ef\u4ee5\u4e0d\u9700\u8981\u5728\u5199\u653e\u56deheaders\nevent.setHeaders(headers);\n\nreturn event;\n}\n\n/**\n     * \u5904\u7406\u591a\u6761evebt\n     * @param events\n     * @return\n     */\n@Override\npublic List&lt;Event&gt; intercept(List&lt;Event&gt; events) {\nfor (Event event : events) {\nintercept(event);\n}\nreturn events;\n}\n\n/**\n     * close\u65b9\u6cd5\n     */\n@Override\npublic void close() {\n\n}\n\n// \u9759\u6001\u5185\u90e8\u7c7b\npublic static class MyBuilder implements Builder{\n\n/**\n         * \u521b\u5efa\u62e6\u622a\u5668\n         * @return\n         */\n@Override\npublic Interceptor build() {\nreturn new MyInterceptor();\n}\n\n/**\n         * \u914d\u7f6e\u65b9\u6cd5\n         * @param context\n         */\n@Override\npublic void configure(Context context) {\n\n}\n}\n}\n</code></pre> <p>\u4ee3\u7801\u5b8c\u6210\u540e\uff0c\u5728 Idea \u6253\u6210 jar \u4e0a\u4f20\u5230 hadoop102 \u7684 /opt/module/flume/lib \u76ee\u5f55\u4e0b\u3002</p> <p>\uff083\uff09\u7f16\u8f91 flume \u914d\u7f6e\u6587\u4ef6</p> <p>\u521b\u5efa\u65b0\u6587\u4ef6 conf/group2/flume1\uff0c\u521b\u5efa\u65b0\u6587\u4ef6 conf/group2/flume2,\u521b\u5efa\u65b0\u6587\u4ef6 conf/group2/flume3\u3002 \u4e3a Flume1 \u914d\u7f6e 1 \u4e2a netcat source\uff0c1 \u4e2a sink group\uff082 \u4e2a avro sink\uff09\uff0c\u5e76\u914d\u7f6e\u76f8\u5e94\u7684 ChannelSelector \u548c interceptor\u3002</p> <pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1 k2\na1.channels = c1 c2\n\n# Describe/configure the source\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n\na1.sources.r1.selector.type = multiplexing\n# \u4f7f\u7528headers\u4e2d\u7684\u54ea\u4e9b\u53c2\u6570\na1.sources.r1.selector.header = type\na1.sources.r1.selector.mapping.number = c1\na1.sources.r1.selector.mapping.letter = c2\n\n# a1.sources.r1.selector.default = c4\n\n# \u62e6\u622a\u5668\u914d\u7f6e\na1.sources.r1.interceptors = i1\na1.sources.r1.interceptors.i1.type = com.atguigu.flume.MyInterceptor$MyBuilder\n\n# Describe the sink\n\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = hadoop102\na1.sinks.k1.port = 4141\n\na1.sinks.k2.type = avro\na1.sinks.k2.hostname = hadoop102\na1.sinks.k2.port = 4142\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\na1.channels.c2.type = memory\na1.channels.c2.capacity = 1000\na1.channels.c2.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1 c2\na1.sinks.k1.channel = c1\na1.sinks.k2.channel = c2\n</code></pre> <p>\u4e3a Flume2 \u914d\u7f6e\u4e00\u4e2a avro source \u548c\u4e00\u4e2a logger sink\u3002</p> <pre><code>a1.sources = r1\na1.sinks = k1\na1.channels = c1\n\na1.sources.r1.type = avro\na1.sources.r1.bind = hadoop102\na1.sources.r1.port = 4141\n\na1.sinks.k1.type = logger\n\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\na1.sinks.k1.channel = c1\na1.sources.r1.channels = c1\n</code></pre> <p>\u4e3a Flume3 \u914d\u7f6e\u4e00\u4e2a avro source \u548c\u4e00\u4e2a logger sink\u3002</p> <pre><code>a1.sources = r1\na1.sinks = k1\na1.channels = c1\n\na1.sources.r1.type = avro\na1.sources.r1.bind = hadoop102\na1.sources.r1.port = 4142\n\na1.sinks.k1.type = logger\n\n\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\na1.sinks.k1.channel = c1\na1.sources.r1.channels = c1\n</code></pre> <p>\uff084\uff09\u5206\u522b\u542f\u52a8 flume1\uff0cflume2 \u548c flume3\u3002</p> <pre><code>bin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group2/flume3.conf\nbin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group2/flume2.conf\nbin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group2/flume1.conf\n</code></pre> <p>\uff085\uff09\u5728 hadoop102 \u4f7f\u7528 netcat \u5411 localhost:44444 \u53d1\u9001\u5b57\u6bcd\u548c\u6570\u5b57\u3002</p> <p>\uff086\uff09\u89c2\u5bdf flume2 \u548c flume3 \u6253\u5370\u7684\u65e5\u5fd7\u3002</p>"},{"location":"sync/flume/fl_03/#333","title":"3.3.3 \u805a\u5408\u6848\u4f8b","text":"<p>1\uff09\u6848\u4f8b\u9700\u6c42\uff1a</p> <p>hadoop102 \u4e0a\u7684 Flume-1 \u76d1\u63a7\u6587\u4ef6 /opt/module/flume/files1/.file.\uff0c</p> <p>hadoop103 \u4e0a\u7684 Flume-2 \u76d1\u63a7\u67d0\u4e00\u4e2a\u7aef\u53e3\u7684\u6570\u636e\u6d41\uff0c</p> <p>Flume-1 \u4e0e Flume-2 \u5c06\u6570\u636e\u53d1\u9001\u7ed9 hadoop104 \u4e0a\u7684 Flume-3\uff0cFlume-3 \u5c06\u6700\u7ec8\u6570\u636e\u6253\u5370\u5230\u63a7\u5236\u53f0\u3002</p> <p>2\uff09\u9700\u6c42\u5206\u6790</p> <p></p> <p>3\uff09\u5b9e\u73b0\u6b65\u9aa4\uff1a</p> <p>\uff081\uff09\u51c6\u5907\u5de5\u4f5c</p> <p>\u2460\u5206\u53d1 Flume</p> <pre><code>xsync flume\n</code></pre> <p>\u2461\u5728 hadoop102\u3001hadoop103 \u4ee5\u53ca hadoop104 \u7684 /opt/module/flume/conf \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a group3 \u6587\u4ef6\u5939\u3002</p> <pre><code>mkdir group3\n</code></pre> <p>\uff082\uff09\u521b\u5efa flume1.conf</p> <p>\u914d\u7f6e Source \u7528\u4e8e\u76d1\u63a7\u672c\u5730\u6587\u4ef6\uff0c\u914d\u7f6e Sink \u8f93\u51fa\u6570\u636e\u5230\u4e0b\u4e00\u7ea7 Flume\u3002</p> <p>\u2460\u5728 hadoop102 \u4e0a\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim flume1.conf </code></pre> <p>\u2461\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> flume1.conf<pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = TAILDIR\na1.sources.r1.filegroups = f1 f2\na1.sources.r1.filegroups.f1 = /opt/module/flume/files1/.*file.*\na1.sources.r1.filegroups.f2 = /opt/module/flume/files2/.*log.*\na1.sources.r1.positionFile = /opt/module/flume/taildir_position.json\n\n\n# Describe the sink\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = hadoop104\na1.sinks.k1.port = 4141\n\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre> <p>\uff083\uff09\u521b\u5efa flume2.conf</p> <p>\u914d\u7f6e Source \u76d1\u63a7\u7aef\u53e3 44444 \u6570\u636e\u6d41\uff0c\u914d\u7f6e Sink \u6570\u636e\u5230\u4e0b\u4e00\u7ea7 Flume\uff1a</p> <p>\u2460\u5728 hadoop103 \u4e0a\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim flume2.conf\n</code></pre> <p>\u2461\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> flume2.conf<pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n# Describe the sink\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = hadoop104\na1.sinks.k1.port = 4141\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre> <p>\uff084\uff09\u521b\u5efa flume3.conf</p> <p>\u914d\u7f6e source \u7528\u4e8e\u63a5\u6536 flume1 \u4e0e flume2 \u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\u6d41\uff0c\u6700\u7ec8\u5408\u5e76\u540e sink \u5230\u63a7\u5236\u53f0\u3002</p> <p>\u2460\u5728 hadoop104 \u4e0a\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim flume3.conf\n</code></pre> <p>\u2461\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9</p> flume3.conf<pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\n\na1.sources.r1.type = avro\na1.sources.r1.bind = hadoop104\na1.sources.r1.port = 4141\n\n\n# Describe the sink\na1.sinks.k1.type = logger\n\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre> <p>\uff085\uff09\u6267\u884c\u914d\u7f6e\u6587\u4ef6</p> <p>\u5206\u522b\u5f00\u542f\u5bf9\u5e94\u914d\u7f6e\u6587\u4ef6\uff1aflume1.conf\uff0cflume2.conf\uff0cflume3.conf\u3002</p> <pre><code>bin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group3/flume1.conf\nbin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group3/flume2.conf\nbin/flume-ng agent --conf conf/ --name a1 --conf-file conf/group3/flume3.conf\n</code></pre> <p>\uff086\uff09\u5728 hadoop102 \u4e0a\u5411 /opt/module/flume \u76ee\u5f55\u4e0b\u7684 group.log \u8ffd\u52a0\u5185\u5bb9</p> <pre><code>echo 'hello' &gt; file1\n</code></pre> <p>\uff087\uff09\u5728 hadoop103 \u4e0a\u5411 44444 \u7aef\u53e3\u53d1\u9001\u6570\u636e</p> <pre><code>nc hadoop103 44444\n</code></pre> <p>\uff088\uff09\u68c0\u67e5 hadoop104 \u4e0a\u6570\u636e</p> <p></p>"},{"location":"sync/flume/fl_04/","title":"\u7b2c4\u7ae0 Flume\u6570\u636e\u6d41\u76d1\u63a7","text":""},{"location":"sync/flume/fl_04/#41-ganglia","title":"4.1 Ganglia\u7684\u5b89\u88c5\u4e0e\u90e8\u7f72","text":"<p>Ganglia \u7531 gmond\u3001gmetad \u548c gweb \u4e09\u90e8\u5206\u7ec4\u6210\u3002</p> <p>gmond\uff08Ganglia Monitoring Daemon\uff09\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u670d\u52a1 \uff0c\u5b89\u88c5\u5728\u6bcf\u53f0\u9700\u8981\u6536\u96c6\u6307\u6807\u6570\u636e\u7684\u8282\u70b9\u4e3b\u673a\u4e0a\u3002\u4f7f\u7528 gmond\uff0c\u4f60\u53ef\u4ee5\u5f88\u5bb9\u6613\u6536\u96c6\u5f88\u591a\u7cfb\u7edf\u6307\u6807\u6570\u636e\uff0c\u5982 CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u3001\u7f51\u7edc\u548c\u6d3b\u8dc3\u8fdb\u7a0b\u7684\u6570\u636e\u7b49\u3002</p> <p>gmetad\uff08Ganglia Meta Daemon\uff09\u6574\u5408\u6240\u6709\u4fe1\u606f\uff0c\u5e76\u5c06\u5176\u4ee5 RRD \u683c\u5f0f\u5b58\u50a8\u81f3\u78c1\u76d8\u7684\u670d\u52a1\u3002</p> <p>gweb\uff08Ganglia Web\uff09Ganglia \u53ef\u89c6\u5316\u5de5\u5177\uff0cgweb \u662f\u4e00\u79cd\u5229\u7528\u6d4f\u89c8\u5668\u663e\u793a gmetad \u6240\u5b58\u50a8\u6570\u636e\u7684 PHP \u524d\u7aef\u3002\u5728 Web \u754c\u9762\u4e2d\u4ee5\u56fe\u8868\u65b9\u5f0f\u5c55\u73b0\u96c6\u7fa4\u7684\u8fd0\u884c\u72b6\u6001\u4e0b\u6536\u96c6\u7684\u591a\u79cd\u4e0d\u540c\u6307\u6807\u6570\u636e\u3002</p> <p>1\uff09\u5b89\u88c5 ganglia</p> <p>\u200b   \uff081\uff09\u89c4\u5212</p> <pre><code>hadoop102:     web  gmetad gmod \nhadoop103:     gmod\nhadoop104:     gmod\n</code></pre> <p>\uff082\uff09\u5728 hadoop102\u3001hadoop103\u3001hadoop104 \u5206\u522b\u5b89\u88c5 epel-release \u4f9d\u8d56</p> <pre><code>sudo yum -y install epel-release\n</code></pre> <p>\uff083\uff09\u5728 102 \u5b89\u88c5</p> <pre><code>sudo yum -y install ganglia-gmetad \nsudo yum -y install ganglia-web\nsudo yum -y install ganglia-gmond\n</code></pre> <p>\uff084\uff09\u5728103 \u548c 104 \u5b89\u88c5</p> <pre><code>sudo yum -y install ganglia-gmond\n</code></pre> <p>2\uff09\u5728 102 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 /etc/httpd/conf.d/ganglia.conf</p> <pre><code>sudo vim /etc/httpd/conf.d/ganglia.conf\n</code></pre> <p>\u4fee\u6539\u4e3a\u7ea2\u989c\u8272\u7684\u914d\u7f6e\uff1a</p> ganglia.conf<pre><code>#\n# Ganglia monitoring system php web frontend\n#\n\nAlias /ganglia /usr/share/ganglia\n&lt;Location /ganglia&gt;\n  #Order deny,allow\n  #Deny from all\n  #Allow from 127.0.0.1\n  #Allow from ::1\n  # Allow from .example.com\n  Require all granted\n&lt;/Location&gt; \n</code></pre> <p>5\uff09\u5728 102 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 /etc/ganglia/gmetad.conf</p> gmetad.conf<pre><code>data_source \"hadoop102\" hadoop102\n</code></pre> <p>6\uff09\u5728 102 103 104 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 /etc/ganglia/gmond.conf</p> gmond.conf<pre><code>cluster {\n  name = \"hadoop102\"\n  owner = \"unspecified\"\n  latlong = \"unspecified\"\n  url = \"unspecified\"\n}\nudp_send_channel {\n  #bind_hostname = yes # Highly recommended, soon to be default.\n                       # This option tells gmond to use a source address\n                       # that resolves to the machine's hostname.  Without\n                       # this, the metrics may appear to come from any\n                       # interface and the DNS names associated with\n                       # those IPs will be used to create the RRDs.\n  # mcast_join = 239.2.11.71\n  # \u6570\u636e\u53d1\u9001\u7ed9hadoop102\n  host = hadoop102\n  port = 8649\n  ttl = 1\n}\nudp_recv_channel {\n  # mcast_join = 239.2.11.71\n  port = 8649\n  # \u63a5\u6536\u6765\u81ea\u4efb\u610f\u8fde\u63a5\u7684\u6570\u636e\n  bind = 0.0.0.0\n  retry_bind = true\n  # Size of the UDP buffer. If you are handling lots of metrics you really\n  # should bump it up to e.g. 10MB or even higher.\n  # buffer = 10485760\n}\n</code></pre> <p>7\uff09\u5728 102 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 /etc/selinux/config</p> config<pre><code>SELINUXTYPE=targeted\n</code></pre> <p>\u63d0\u793a</p> <p>selinux \u672c\u6b21\u751f\u6548\u5173\u95ed\u5fc5\u987b\u91cd\u542f\uff0c\u5982\u679c\u6b64\u65f6\u4e0d\u60f3\u91cd\u542f\uff0c\u53ef\u4ee5\u4e34\u65f6\u751f\u6548\u4e4b\uff1a</p> <pre><code>sudo setenforce 0\n</code></pre> <p>8\uff09\u542f\u52a8 ganglia</p> <p>\uff081\uff09\u5728102 103 104 \u542f\u52a8</p> <pre><code>sudo systemctl start gmond\n</code></pre> <p>\uff082\uff09\u5728102 \u542f\u52a8</p> <pre><code>sudo systemctl start httpd\nsudo systemctl start gmetad\n</code></pre> <p>9\uff09\u6253\u5f00\u7f51\u9875\u6d4f\u89c8 ganglia \u9875\u9762</p> <p>http://hadoop102/ganglia</p> <p>\u52a0\u8f7d\u901f\u5ea6\u8f83\u6162\u3002</p> <p>\u63d0\u793a</p> <p>\u5982\u679c\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c\u4f9d\u7136\u51fa\u73b0\u6743\u9650\u4e0d\u8db3\u9519\u8bef\uff0c\u8bf7\u4fee\u6539 /var/lib/ganglia \u76ee\u5f55\u7684\u6743\u9650\uff1a</p> <pre><code>sudo chmod -R 777 /var/lib/ganglia\n</code></pre>"},{"location":"sync/flume/fl_04/#42-flume","title":"4.2 \u64cd\u4f5cFlume\u6d4b\u8bd5\u76d1\u63a7","text":"<p>1\uff09\u542f\u52a8 Flume \u4efb\u52a1</p> <pre><code>bin/flume-ng agent \\\n-c conf/ \\\n-n a1 \\\n-f conf/nc-flume-log.conf \\\n-Dflume.monitoring.type=ganglia \\\n-Dflume.monitoring.hosts=hadoop102:8649\n</code></pre> <p>2\uff09\u53d1\u9001\u6570\u636e\u89c2\u5bdf ganglia \u76d1\u6d4b\u56fe</p> <pre><code>nc localhost 44444\n</code></pre> <p></p> \u5b57\u6bb5\uff08\u56fe\u8868\u540d\u79f0\uff09 \u5b57\u6bb5\u542b\u4e49 EventPutAttemptCount source\u5c1d\u8bd5\u5199\u5165channel\u7684\u4e8b\u4ef6\u603b\u6570\u91cf EventPutSuccessCount \u6210\u529f\u5199\u5165channel\u4e14\u63d0\u4ea4\u7684\u4e8b\u4ef6\u603b\u6570\u91cf EventTakeAttemptCount sink\u5c1d\u8bd5\u4ecechannel\u62c9\u53d6\u4e8b\u4ef6\u7684\u603b\u6570\u91cf\u3002 EventTakeSuccessCount sink\u6210\u529f\u8bfb\u53d6\u7684\u4e8b\u4ef6\u7684\u603b\u6570\u91cf StartTime channel\u542f\u52a8\u7684\u65f6\u95f4\uff08\u6beb\u79d2\uff09 StopTime channel\u505c\u6b62\u7684\u65f6\u95f4\uff08\u6beb\u79d2\uff09 ChannelSize \u76ee\u524dchannel\u4e2d\u4e8b\u4ef6\u7684\u603b\u6570\u91cf ChannelFillPercentage channel\u5360\u7528\u767e\u5206\u6bd4 ChannelCapacity channel\u7684\u5bb9\u91cf"},{"location":"sync/maxwell/01/","title":"\u7b2c1\u7ae0 Maxwell\u7b80\u4ecb","text":""},{"location":"sync/maxwell/01/#11-maxwell","title":"1.1 Maxwell\u6982\u8ff0","text":"<p>Maxwell \u662f\u7531\u7f8e\u56fd Zendesk \u516c\u53f8\u5f00\u6e90\uff0c\u7528 Java \u7f16\u5199\u7684 MySQL \u53d8\u66f4\u6570\u636e\u6293\u53d6\u8f6f\u4ef6\u3002\u5b83\u4f1a\u5b9e\u65f6\u76d1\u63a7 Mysql \u6570\u636e\u5e93\u7684\u6570\u636e\u53d8\u66f4\u64cd\u4f5c\uff08\u5305\u62ecinsert\u3001update\u3001delete\uff09\uff0c\u5e76\u5c06\u53d8\u66f4\u6570\u636e\u4ee5  JSON  \u683c\u5f0f\u53d1\u9001\u7ed9 Kafka\u3001Kinesi \u7b49\u6d41\u6570\u636e\u5904\u7406\u5e73\u53f0\u3002\u5b98\u7f51\u5730\u5740</p>"},{"location":"sync/maxwell/01/#12-maxwell","title":"1.2 Maxwell\u8f93\u51fa\u6570\u636e\u683c\u5f0f","text":"<p>\u6ce8</p> <p>Maxwell \u8f93\u51fa\u7684 json \u5b57\u6bb5\u8bf4\u660e\uff1a</p> \u5b57\u6bb5 \u89e3\u91ca database \u53d8\u66f4\u6570\u636e\u6240\u5c5e\u7684\u6570\u636e\u5e93 table \u8868\u66f4\u6570\u636e\u6240\u5c5e\u7684\u8868 type \u6570\u636e\u53d8\u66f4\u7c7b\u578b ts \u6570\u636e\u53d8\u66f4\u53d1\u751f\u7684\u65f6\u95f4 xid \u4e8b\u52a1 id commit \u4e8b\u52a1\u63d0\u4ea4\u6807\u5fd7\uff0c\u53ef\u7528\u4e8e\u91cd\u65b0\u7ec4\u88c5\u4e8b\u52a1 data \u5bf9\u4e8e insert \u7c7b\u578b\uff0c\u8868\u793a\u63d2\u5165\u7684\u6570\u636e\uff1b\u5bf9\u4e8e update \u7c7b\u578b\uff0c\u6807\u8bc6\u4fee\u6539\u4e4b\u540e\u7684\u6570\u636e\uff1b\u5bf9\u4e8e delete \u7c7b\u578b\uff0c\u8868\u793a\u5220\u9664\u7684\u6570\u636e old \u5bf9\u4e8e update \u7c7b\u578b\uff0c\u8868\u793a\u4fee\u6539\u4e4b\u524d\u7684\u6570\u636e\uff0c\u53ea\u5305\u542b\u53d8\u66f4\u5b57\u6bb5"},{"location":"sync/maxwell/02/","title":"\u7b2c2\u7ae0 Maxwell\u539f\u7406","text":"<p>Maxwell \u7684\u5de5\u4f5c\u539f\u7406\u662f\u5b9e\u65f6\u8bfb\u53d6 MySQL \u6570\u636e\u5e93\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff08 Binlog \uff09\uff0c\u4ece\u4e2d\u83b7\u53d6\u53d8\u66f4\u6570\u636e\uff0c\u518d\u5c06\u53d8\u66f4\u6570\u636e\u4ee5 JSON \u683c\u5f0f\u53d1\u9001\u81f3 Kafka \u7b49\u6d41\u5904\u7406\u5e73\u53f0\u3002</p>"},{"location":"sync/maxwell/02/#21-mysql","title":"2.1 MySQL\u4e8c\u8fdb\u5236\u65e5\u5fd7","text":"<p>\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff08 Binlog \uff09\u662f MySQL \u670d\u52a1\u7aef\u975e\u5e38\u91cd\u8981\u7684\u4e00\u79cd\u65e5\u5fd7\uff0c\u5b83\u4f1a\u4fdd\u5b58 MySQL \u6570\u636e\u5e93\u7684\u6240\u6709\u6570\u636e\u53d8\u66f4\u8bb0\u5f55\u3002Binlog \u7684\u4e3b\u8981\u4f5c\u7528\u5305\u62ec\u4e3b\u4ece\u590d\u5236\u548c\u6570\u636e\u6062\u590d\u3002Maxwell \u7684\u5de5\u4f5c\u539f\u7406\u548c\u4e3b\u4ece\u590d\u5236\u5bc6\u5207\u76f8\u5173\u3002</p>"},{"location":"sync/maxwell/02/#22-mysql","title":"2.2 MySQL\u4e3b\u4ece\u590d\u5236","text":"<p>MySQL \u7684\u4e3b\u4ece\u590d\u5236\uff0c\u5c31\u662f\u7528\u6765\u5efa\u7acb\u4e00\u4e2a\u548c\u4e3b\u6570\u636e\u5e93\u5b8c\u5168\u4e00\u6837\u7684\u6570\u636e\u5e93\u73af\u5883\uff0c\u8fd9\u4e2a\u6570\u636e\u5e93\u79f0\u4e3a\u4ece\u6570\u636e\u5e93\u3002</p> <p>1\uff09\u4e3b\u4ece\u590d\u5236\u7684\u5e94\u7528\u573a\u666f\u5982\u4e0b\uff1a</p> <p>\uff081\uff09\u505a\u6570\u636e\u5e93\u7684\u70ed\u5907\uff1a\u4e3b\u6570\u636e\u5e93\u670d\u52a1\u5668\u6545\u969c\u540e\uff0c\u53ef\u5207\u6362\u5230\u4ece\u6570\u636e\u5e93\u7ee7\u7eed\u5de5\u4f5c\u3002</p> <p>\uff082\uff09\u8bfb\u5199\u5206\u79bb\uff1a\u4e3b\u6570\u636e\u5e93\u53ea\u8d1f\u8d23\u4e1a\u52a1\u6570\u636e\u7684\u5199\u5165\u64cd\u4f5c\uff0c\u800c\u591a\u4e2a\u4ece\u6570\u636e\u5e93\u53ea\u8d1f\u8d23\u4e1a\u52a1\u6570\u636e\u7684\u67e5\u8be2\u5de5\u4f5c\uff0c\u5728\u8bfb\u591a\u5199\u5c11\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u63d0\u9ad8\u6570\u636e\u5e93\u5de5\u4f5c\u6548\u7387\u3002</p> <p>2\uff09\u4e3b\u4ece\u590d\u5236\u7684\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\uff1a</p> <p>\uff081\uff09Master \u4e3b\u5e93\u5c06\u6570\u636e\u53d8\u66f4\u8bb0\u5f55\uff0c\u5199\u5230\u4e8c\u8fdb\u5236\u65e5\u5fd7( binary log )\u4e2d</p> <p>\uff082\uff09Slave \u4ece\u5e93\u5411 mysql master \u53d1\u9001 dump \u534f\u8bae\uff0c\u5c06 master \u4e3b\u5e93\u7684 binary log events \u62f7\u8d1d\u5230\u5b83\u7684\u4e2d\u7ee7\u65e5\u5fd7( relay log )</p> <p>\uff083\uff09Slave \u4ece\u5e93\u8bfb\u53d6\u5e76\u56de\u653e\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u7684\u4e8b\u4ef6\uff0c\u5c06\u6539\u53d8\u7684\u6570\u636e\u540c\u6b65\u5230\u81ea\u5df1\u7684\u6570\u636e\u5e93\u3002</p> <p></p>"},{"location":"sync/maxwell/02/#23-maxwell","title":"2.3 Maxwell\u539f\u7406","text":"<p>\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5c06\u81ea\u5df1\u4f2a\u88c5\u6210 slave\uff0c\u5e76\u9075\u5faa MySQL \u4e3b\u4ece\u590d\u5236\u7684\u534f\u8bae\uff0c\u4ece master \u540c\u6b65\u6570\u636e\u3002</p>"},{"location":"sync/maxwell/03/","title":"\u7b2c3\u7ae0 Maxwell\u90e8\u7f72","text":""},{"location":"sync/maxwell/03/#31-maxwell","title":"3.1 \u5b89\u88c5Maxwell","text":"<p>1\uff09\u4e0b\u8f7d\u5b89\u88c5\u5305</p> <p>\uff081\uff09\u5730\u5740</p> <p>\u6ce8</p> <p>Maxwell-1.30.0 \u53ca\u4ee5\u4e0a\u7248\u672c\u4e0d\u518d\u652f\u6301 JDK1.8\u3002</p> <p>\uff082\uff09\u5c06\u5b89\u88c5\u5305\u4e0a\u4f20\u5230 hadoop102 \u8282\u70b9\u7684 /opt/software \u76ee\u5f55</p> <p>2\uff09\u5c06\u5b89\u88c5\u5305\u89e3\u538b\u81f3 /opt/module</p> <pre><code>tar -zxvf maxwell-1.29.2.tar.gz -C /opt/module/\n</code></pre> <p>3\uff09\u4fee\u6539\u540d\u79f0</p> <pre><code>mv maxwell-1.29.2/ maxwell\n</code></pre>"},{"location":"sync/maxwell/03/#32-mysql","title":"3.2 \u914d\u7f6eMySQL","text":""},{"location":"sync/maxwell/03/#321-mysql-binlog","title":"3.2.1 \u542f\u7528MySQL Binlog","text":"<p>MySQL \u670d\u52a1\u5668\u7684 Binlog \u9ed8\u8ba4\u662f\u672a\u5f00\u542f\u7684\uff0c\u5982\u9700\u8fdb\u884c\u540c\u6b65\uff0c\u9700\u8981\u5148\u8fdb\u884c\u5f00\u542f\u3002</p> <p>1\uff09\u4fee\u6539 MySQL \u914d\u7f6e\u6587\u4ef6 /etc/my.cnf</p> <pre><code>sudo vim /etc/my.cnf\n</code></pre> <p>2\uff09\u589e\u52a0\u5982\u4e0b\u914d\u7f6e</p> my.cnf<pre><code>[mysqld]\n\n#\u6570\u636e\u5e93id\nserver-id = 1\n#\u542f\u52a8binlog\uff0c\u8be5\u53c2\u6570\u7684\u503c\u4f1a\u4f5c\u4e3abinlog\u7684\u6587\u4ef6\u540d\nlog-bin=mysql-bin\n#binlog\u7c7b\u578b\uff0cmaxwell\u8981\u6c42\u4e3arow\u7c7b\u578b\nbinlog_format=row\n#\u542f\u7528binlog\u7684\u6570\u636e\u5e93\uff0c\u9700\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4f5c\u51fa\u4fee\u6539\nbinlog-do-db=gmall\n</code></pre> <p>MySQL Binlog \u6a21\u5f0f</p> <p>Statement-based\uff1a\u57fa\u4e8e\u8bed\u53e5\uff0cBinlog \u4f1a\u8bb0\u5f55\u6240\u6709\u5199\u64cd\u4f5c\u7684 SQL \u8bed\u53e5\uff0c\u5305\u62ec insert\u3001update\u3001delete \u7b49\u3002 \u4f18\u70b9\uff1a \u8282\u7701\u7a7a\u95f4 \u7f3a\u70b9\uff1a \u6709\u53ef\u80fd\u9020\u6210\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u4f8b\u5982 insert \u8bed\u53e5\u4e2d\u5305\u542b now() \u51fd\u6570\u3002 Row-based\uff1a\u57fa\u4e8e\u884c\uff0cBinlog \u4f1a\u8bb0\u5f55\u6bcf\u6b21\u5199\u64cd\u4f5c\u540e\u88ab\u64cd\u4f5c\u884c\u8bb0\u5f55\u7684\u53d8\u5316\u3002 \u4f18\u70b9\uff1a\u4fdd\u6301\u6570\u636e\u7684\u7edd\u5bf9\u4e00\u81f4\u6027\u3002 \u7f3a\u70b9\uff1a\u5360\u7528\u8f83\u5927\u7a7a\u95f4\u3002 mixed\uff1a\u6df7\u5408\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u662f Statement-based\uff0c\u5982\u679c SQL \u8bed\u53e5\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c31\u81ea\u52a8\u5207\u6362\u5230 Row-based\u3002 Maxwell \u8981\u6c42 Binlog \u91c7\u7528 Row-based \u6a21\u5f0f\u3002</p> <p>3\uff09\u91cd\u542f MySQL \u670d\u52a1</p> <pre><code>sudo systemctl restart mysqld\n</code></pre>"},{"location":"sync/maxwell/03/#322-maxwell","title":"3.2.2 \u521b\u5efaMaxwell\u6240\u9700\u6570\u636e\u5e93\u548c\u7528\u6237","text":"<p>Maxwell \u9700\u8981\u5728 MySQL \u4e2d\u5b58\u50a8\u5176\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u9700\u7684\u4e00\u4e9b\u6570\u636e\uff0c\u5305\u62ec binlog \u540c\u6b65\u7684\u65ad\u70b9\u4f4d\u7f6e\uff08 Maxwell \u652f\u6301\u65ad\u70b9\u7eed\u4f20\uff09\u7b49\u7b49\uff0c\u6545\u9700\u8981\u5728 MySQL \u4e3a Maxwell \u521b\u5efa\u6570\u636e\u5e93\u53ca\u7528\u6237\u3002</p> <p>1\uff09\u521b\u5efa\u6570\u636e\u5e93</p> <pre><code>CREATE DATABASE maxwell;\n</code></pre> <p>2\uff09\u8c03\u6574 MySQL \u6570\u636e\u5e93\u5bc6\u7801\u7ea7\u522b</p> <pre><code>set global validate_password_policy=0;\nset global validate_password_length=4;\n</code></pre> <p>3\uff09\u521b\u5efa Maxwell \u7528\u6237\u5e76\u8d4b\u4e88\u5176\u5fc5\u8981\u6743\u9650</p> <pre><code>CREATE USER 'maxwell'@'%' IDENTIFIED BY 'maxwell';\nGRANT ALL ON maxwell.* TO 'maxwell'@'%';\nGRANT SELECT, REPLICATION CLIENT, REPLICATION SLAVE ON *.* TO 'maxwell'@'%';\n</code></pre>"},{"location":"sync/maxwell/03/#33-maxwell","title":"3.3 \u914d\u7f6eMaxwell","text":"<p>1\uff09\u4fee\u6539 Maxwell \u914d\u7f6e\u6587\u4ef6\u540d\u79f0</p> <pre><code>cd /opt/module/maxwell\ncp config.properties.example config.properties\n</code></pre> <p>2\uff09\u4fee\u6539 Maxwell \u914d\u7f6e\u6587\u4ef6</p> config.properties<pre><code>#Maxwell\u6570\u636e\u53d1\u9001\u76ee\u7684\u5730\uff0c\u53ef\u9009\u914d\u7f6e\u6709stdout|file|kafka|kinesis|pubsub|sqs|rabbitmq|redis\nproducer=kafka\n#\u76ee\u6807Kafka\u96c6\u7fa4\u5730\u5740\nkafka.bootstrap.servers=hadoop102:9092,hadoop103:9092\n#\u76ee\u6807Kafka topic\uff0c\u53ef\u9759\u6001\u914d\u7f6e\uff0c\u4f8b\u5982:maxwell\uff0c\u4e5f\u53ef\u52a8\u6001\u914d\u7f6e\uff0c\u4f8b\u5982\uff1a%{database}_%{table}\nkafka_topic=maxwell\n\n#MySQL\u76f8\u5173\u914d\u7f6e\nhost=hadoop102\nuser=maxwell\npassword=maxwell\njdbc_options=useSSL=false&amp;serverTimezone=Asia/Shanghai\n</code></pre>"},{"location":"sync/maxwell/04/","title":"\u7b2c4\u7ae0 Maxwell\u4f7f\u7528","text":""},{"location":"sync/maxwell/04/#41-kafka","title":"4.1 \u542f\u52a8Kafka\u96c6\u7fa4","text":"<p>\u82e5 Maxwell \u53d1\u9001\u6570\u636e\u7684\u76ee\u7684\u5730\u4e3a Kafka \u96c6\u7fa4\uff0c\u5219\u9700\u8981\u5148\u786e\u4fdd Kafka \u96c6\u7fa4\u4e3a\u542f\u52a8\u72b6\u6001\u3002</p>"},{"location":"sync/maxwell/04/#42-maxwell","title":"4.2 Maxwell\u542f\u505c","text":"<p>1\uff09\u542f\u52a8 Maxwell</p> <pre><code>/opt/module/maxwell/bin/maxwell --config /opt/module/maxwell/config.properties --daemon\n</code></pre> <p>2\uff09\u505c\u6b62 Maxwell</p> <pre><code> ps -ef | grep maxwell | grep -v grep | grep maxwell | awk '{print $2}' | xargs kill -9\n</code></pre> <p>3\uff09Maxwell \u542f\u505c\u811a\u672c</p> <p>\uff081\uff09\u521b\u5efa\u5e76\u7f16\u8f91 Maxwell \u542f\u505c\u811a\u672c</p> mxw.sh<pre><code>#!/bin/bash\n\nMAXWELL_HOME=/opt/module/maxwell\n\nstatus_maxwell(){\nresult=`ps -ef | grep com.zendesk.maxwell.Maxwell | grep -v grep | wc -l`\nreturn $result\n}\n\n\nstart_maxwell(){\nstatus_maxwell\n    if [[ $? -lt 1 ]]; then\necho \"\u542f\u52a8Maxwell\"\n$MAXWELL_HOME/bin/maxwell --config $MAXWELL_HOME/config.properties --daemon\n    else\necho \"Maxwell\u6b63\u5728\u8fd0\u884c\"\nfi\n}\n\n\nstop_maxwell(){\nstatus_maxwell\n    if [[ $? -gt 0 ]]; then\necho \"\u505c\u6b62Maxwell\"\nps -ef | grep com.zendesk.maxwell.Maxwell | grep -v grep | awk '{print $2}' | xargs kill -9\n    else\necho \"Maxwell\u672a\u5728\u8fd0\u884c\"\nfi\n}\n\n\ncase $1 in\nstart )\nstart_maxwell\n    ;;\nstop )\nstop_maxwell\n    ;;\nrestart )\nstop_maxwell\n       start_maxwell\n    ;;\nesac\n</code></pre>"},{"location":"sync/maxwell/04/#43","title":"4.3 \u589e\u91cf\u6570\u636e\u540c\u6b65","text":"<p>1\uff09\u542f\u52a8 Kafka \u6d88\u8d39\u8005</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic maxwell\n</code></pre> <p>2\uff09\u6a21\u62df\u751f\u6210\u6570\u636e</p> <pre><code>java -jar gmall2020-mock-db-2021-01-22.jar\n</code></pre> <p>3\uff09\u89c2\u5bdf Kafka \u6d88\u8d39\u8005</p> <pre><code>{\"database\":\"gmall\",\"table\":\"comment_info\",\"type\":\"insert\",\"ts\":1634023510,\"xid\":1653373,\"xoffset\":11998,\"data\":{\"id\":1447825655672463369,\"user_id\":289,\"nick_name\":null,\"head_img\":null,\"sku_id\":11,\"spu_id\":3,\"order_id\":18440,\"appraise\":\"1204\",\"comment_txt\":\"\u8bc4\u8bba\u5185\u5bb9\uff1a12897688728191593794966121429786132276125164551411\",\"create_time\":\"2020-06-16 15:25:09\",\"operate_time\":null}}\n{\"database\":\"gmall\",\"table\":\"comment_info\",\"type\":\"insert\",\"ts\":1634023510,\"xid\":1653373,\"xoffset\":11999,\"data\":{\"id\":1447825655672463370,\"user_id\":774,\"nick_name\":null,\"head_img\":null,\"sku_id\":25,\"spu_id\":8,\"order_id\":18441,\"appraise\":\"1204\",\"comment_txt\":\"\u8bc4\u8bba\u5185\u5bb9\uff1a67552221621263422568447438734865327666683661982185\",\"create_time\":\"2020-06-16 15:25:09\",\"operate_time\":null}}\n</code></pre>"},{"location":"sync/maxwell/04/#44","title":"4.4 \u5386\u53f2\u6570\u636e\u5168\u91cf\u540c\u6b65","text":"<p>\u4e0a\u4e00\u8282\uff0c\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u4f7f\u7528 Maxwell \u5b9e\u65f6\u589e\u91cf\u540c\u6b65 MySQL \u53d8\u66f4\u6570\u636e\u7684\u529f\u80fd\u3002\u4f46\u6709\u65f6\u53ea\u6709\u589e\u91cf\u6570\u636e\u662f\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5230 MySQL \u6570\u636e\u5e93\u4e2d\u4ece\u5386\u53f2\u81f3\u4eca\u7684\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u96c6\u3002\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u5728\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u4e4b\u524d\uff0c\u5148\u8fdb\u884c\u4e00\u6b21\u5386\u53f2\u6570\u636e\u7684\u5168\u91cf\u540c\u6b65\u3002\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u5f97\u5230\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u96c6\u3002</p>"},{"location":"sync/maxwell/04/#45","title":"4.5 \u63d0\u9ad8\u5e76\u884c\u5ea6","text":"<p>\u5982\u679c\u8981\u63d0\u9ad8\u5e76\u884c\u5ea6\uff0c\u9996\u5148\u8bbe\u7f6e kafka \u7684\u5206\u533a\u6570 &gt; 1,\u7136\u540e\u8bbe\u7f6e <code>producer_partition_by</code> \u5c5e\u6027 \u53ef\u9009\u503c producer_partition_by=database|table|primary_key|random|column</p> \u914d\u7f6e\u9879 \u8bf4\u660e database \u6570\u636e\u5e93\u540d table \u8868\u540d primary_key \u4e3b\u952e\u540d random \u968f\u673a column \u5217\u540d"},{"location":"sync/maxwell/04/#441-maxwell-bootstrap","title":"4.4.1 Maxwell-bootstrap","text":"<p>Maxwell \u63d0\u4f9b\u4e86 bootstrap \u529f\u80fd\u6765\u8fdb\u884c\u5386\u53f2\u6570\u636e\u7684\u5168\u91cf\u540c\u6b65\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>/opt/module/maxwell/bin/maxwell-bootstrap --database gmall --table user_info --config /opt/module/maxwell/config.properties\n</code></pre>"},{"location":"sync/maxwell/04/#442-boostrap","title":"4.4.2 boostrap\u6570\u636e\u683c\u5f0f","text":"<p>\u91c7\u7528 bootstrap \u65b9\u5f0f\u540c\u6b65\u7684\u8f93\u51fa\u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>{\n\"database\": \"fooDB\",\n\"table\": \"barTable\",\n\"type\": \"bootstrap-start\",\n\"ts\": 1450557744,\n\"data\": {}\n}\n{\n\"database\": \"fooDB\",\n\"table\": \"barTable\",\n\"type\": \"bootstrap-insert\",\n\"ts\": 1450557744,\n\"data\": {\n\"txt\": \"hello\"\n}\n}\n{\n\"database\": \"fooDB\",\n\"table\": \"barTable\",\n\"type\": \"bootstrap-insert\",\n\"ts\": 1450557744,\n\"data\": {\n\"txt\": \"bootstrap!\"\n}\n}\n{\n\"database\": \"fooDB\",\n\"table\": \"barTable\",\n\"type\": \"bootstrap-complete\",\n\"ts\": 1450557744,\n\"data\": {}\n}\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>1\uff09\u7b2c\u4e00\u6761 type \u4e3a bootstrap-start \u548c\u6700\u540e\u4e00\u6761 type \u4e3a bootstrap-complete \u7684\u6570\u636e\uff0c\u662f bootstrap \u5f00\u59cb\u548c\u7ed3\u675f\u7684\u6807\u5fd7\uff0c\u4e0d\u5305\u542b\u6570\u636e\uff0c\u4e2d\u95f4\u7684 type \u4e3a bootstrap-insert \u7684\u6570\u636e\u624d\u5305\u542b\u6570\u636e\u3002</p> <p>2\uff09\u4e00\u6b21 bootstrap \u8f93\u51fa\u7684\u6240\u6709\u8bb0\u5f55\u7684 ts \u90fd\u76f8\u540c\uff0c\u4e3a bootstrap \u5f00\u59cb\u7684\u65f6\u95f4\u3002</p>"},{"location":"vcs/git/git_01/","title":"\u7b2c\u4e00\u7ae0 Git \u7b80\u4ecb","text":""},{"location":"vcs/git/git_01/#11-git","title":"1.1  \u4e3a\u4ec0\u4e48\u8981\u5b66\u4e60Git","text":"<p>\u5fc5\u70b9\u5929\u8d4b \u5fc5\u7136\u8d8b\u52bf</p>"},{"location":"vcs/git/git_01/#12-git","title":"1.2  Git\u662f\u4ec0\u4e48","text":"<p>Git \u662f\u76ee\u524d\u4e16\u754c\u4e0a\u6700\u5148\u8fdb\u7684\u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u3002</p> <p></p> <p>\u6ce8</p> <p>BitKeepper \u662f\u975e\u81ea\u7531\u8f6f\u4ef6\uff0c\u521d\u671f Linux \u6838\u5fc3\u5f00\u53d1\u662f\u57fa\u4e8e BitKeeper \u8fdb\u884c\u7ba1\u7406\u3002</p>"},{"location":"vcs/git/git_01/#13-git","title":"1.3  Git\u80fd\u5e72\u4ec0\u4e48","text":""},{"location":"vcs/git/git_01/#14","title":"1.4  \u96c6\u4e2d\u7ba1\u7406\u578b\u7248\u672c\u63a7\u5236\u5de5\u5177","text":"<p>1\uff09\u4f18\u70b9</p> <p>\uff081\uff09\u5b9e\u73b0\u4e86\u5927\u90e8\u5206\u5f00\u53d1\u4e2d\u5bf9\u7248\u672c\u7ba1\u7406\u7684\u9700\u6c42</p> <p>\uff082\uff09\u7ed3\u6784\u7b80\u5355\uff0c\u4e0a\u624b\u5bb9\u6613\u3002</p> <p>2\uff09\u7f3a\u70b9</p> <p>\uff081\uff09\u7248\u672c\u7ba1\u7406\u7684\u670d\u52a1\u5668\u4e00\u65e6\u5d29\u6e83\uff0c\u786c\u76d8\u635f\u574f\uff0c\u4ee3\u7801\u65e0\u6cd5\u6062\u590d.</p> <p>\uff082\uff09\u7a0b\u5e8f\u5458\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u7684\u4ee3\u7801\u8981\u6c42\u662f\u5b8c\u6574\u7248\u672c\uff0c\u65e0\u6cd5\u5b8c\u6210\u7a0b\u5e8f\u5458\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u60f3\u505a\u5c0f\u7248\u672c\u7684\u7ba1\u7406\u3002</p> <p>\uff083\uff09\u7cfb\u7edf\u6b63\u5728\u4e0a\u7ebf\u8fd0\u884c\uff0c\u65f6\u4e0d\u65f6\u8fd8\u8981\u4fee\u6539 bug\uff0c\u8981\u589e\u52a0\u597d\u51e0\u4e2a\u529f\u80fd\u8981\u51e0\u4e2a\u6708\uff0c\u65e0\u6cd5\u540c\u65f6\u7ba1\u7406\u591a\u4e2a\u7248\u672c\u3002</p> <p>\uff084\uff09\u65e0\u6cd5\u7ba1\u7406\u4e00\u4e2a\u5206\u5e03\u5728\u4e16\u754c\u5404\u5730\u3001\u4e92\u4e0d\u76f8\u8bc6\u7684\u5927\u578b\u5f00\u53d1\u56e2\u961f</p>"},{"location":"vcs/git/git_01/#15","title":"1.5  \u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236\u5de5\u5177","text":"<p>1\uff09\u4f18\u70b9:</p> <p>\uff081\uff09\u5bb9\u707e\u80fd\u529b\u5f3a</p> <p>\uff082\uff09\u672c\u5730\u7248\u672c\u7ba1\u7406</p> <p>\uff083\uff09\u5f02\u5730\u534f\u4f5c</p> <p>\uff084\uff09\u7075\u6d3b\u5206\u652f</p> <p>2\uff09\u7f3a\u70b9:</p> <p>\uff081\uff09GitHub\u662f\u56fd\u5916\u7684\u7f51\u7ad9,\u8bbf\u95ee\u6bd4\u8f83\u56f0\u96be.\u53ef\u4ee5\u4f7f\u7528\u56fd\u5185\u7684 gitee \u6765\u4ee3\u66ff. </p>"},{"location":"vcs/git/git_02/","title":"\u7b2c\u4e8c\u7ae0 \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"vcs/git/git_02/#git-init","title":"git init \u2014\u2014 \u521d\u59cb\u5316\u4ed3\u5e93","text":"<p>\u8981\u4f7f\u7528 Git \u8fdb\u884c\u7248\u672c\u7ba1\u7406\uff0c\u5fc5\u987b\u5148\u521d\u59cb\u5316\u4ed3\u5e93\u3002Git \u662f\u4f7f\u7528 git init \u547d\u4ee4\u8fdb\u884c\u521d\u59cb\u5316\u7684\u3002\u8bf7\u5b9e\u9645\u5efa\u7acb\u4e00\u4e2a\u76ee\u5f55\u5e76\u521d\u59cb\u5316\u4ed3\u5e93\u3002\u5982\u679c\u521d\u59cb\u5316\u6210\u529f\uff0c\u6267\u884c\u4e86 git init \u547d\u4ee4\u7684\u76ee\u5f55\u4e0b\u5c31\u4f1a\u751f\u6210 .git \u76ee\u5f55\u3002\u8fd9\u4e2a .git \u76ee\u5f55\u91cc\u5b58\u50a8\u7740\u7ba1\u7406\u5f53\u524d\u76ee\u5f55\u5185\u5bb9\u6240\u9700\u7684\u4ed3\u5e93\u6570\u636e\u3002</p> <pre><code>$ mkdir git-tutorial\n$ cd git-tutorial\n$ git init\n\nInitialized empty Git repository in /Users/hirocaster/github/github-book\n/git-tutorial/.git/\n</code></pre> <p>\u5728 Git \u4e2d\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a\u76ee\u5f55\u7684\u5185\u5bb9\u79f0\u4e3a\u201c\u9644\u5c5e\u4e8e\u8be5\u4ed3\u5e93\u7684\u5de5\u4f5c\u6811\u201d\u3002\u6587\u4ef6\u7684\u7f16\u8f91\u7b49\u64cd\u4f5c\u5728\u5de5\u4f5c\u6811\u4e2d\u8fdb\u884c\uff0c\u7136\u540e\u8bb0\u5f55\u5230\u4ed3\u5e93\u4e2d\uff0c\u4ee5\u6b64\u7ba1\u7406\u6587\u4ef6\u7684\u5386\u53f2\u5feb\u7167\u3002\u5982\u679c\u60f3\u5c06\u6587\u4ef6\u6062\u590d\u5230\u539f\u5148\u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u4ece\u4ed3\u5e93\u4e2d\u8c03\u53d6\u4e4b\u524d\u7684\u5feb\u7167\uff0c\u5728\u5de5\u4f5c\u6811\u4e2d\u6253\u5f00\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u83b7\u53d6\u4ee5\u5f80\u7684\u6587\u4ef6\u3002\u5177\u4f53\u64cd\u4f5c\u6307\u4ee4\u6211\u4eec\u5c06\u5728\u540e\u9762\u8be6\u7ec6\u89e3\u8bf4\u3002</p>"},{"location":"vcs/git/git_02/#git-status","title":"git status \u2014\u2014 \u67e5\u770b\u4ed3\u5e93\u7684\u72b6\u6001","text":"<p>git status \u547d\u4ee4\u7528\u4e8e\u663e\u793a Git \u4ed3\u5e93\u7684\u72b6\u6001\u3002\u8fd9\u662f\u4e00\u4e2a\u5341\u5206\u5e38\u7528\u7684\u547d\u4ee4\uff0c\u8bf7\u52a1\u5fc5\u7262\u8bb0\u3002 \u5de5\u4f5c\u6811\u548c\u4ed3\u5e93\u5728\u88ab\u64cd\u4f5c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u72b6\u6001\u4f1a\u4e0d\u65ad\u53d1\u751f\u53d8\u5316\u3002\u5728 Git \u64cd\u4f5c\u8fc7\u7a0b\u4e2d\u65f6\u5e38\u7528 git status \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u72b6\u6001\uff0c\u53ef\u8c13\u57fa\u672c\u4e2d\u7684\u57fa\u672c\u3002\u4e0b\u9762\uff0c\u5c31\u8ba9\u6211\u4eec\u6765\u5b9e\u9645\u67e5\u770b\u4e00\u4e0b\u5f53\u524d\u72b6\u6001\u3002</p> <p></p> <p>\u7ed3\u679c\u663e\u793a\u4e86\u6211\u4eec\u5f53\u524d\u6b63\u5904\u4e8e master \u5206\u652f\u4e0b\u3002\u5173\u4e8e\u5206\u652f\u6211\u4eec\u4f1a\u5728\u4e0d\u4e45\u540e\u8bb2\u5230\uff0c\u73b0\u5728\u4e0d\u5fc5\u6df1\u7a76\u3002\u63a5\u7740\u8fd8\u663e\u793a\u4e86\u6ca1\u6709\u53ef\u63d0\u4ea4\u7684\u5185\u5bb9\u3002\u6240\u8c13\u63d0\u4ea4\uff08Commit\uff09\uff0c\u662f\u6307\u201c\u8bb0\u5f55\u5de5\u4f5c\u6811\u4e2d\u6240\u6709\u6587\u4ef6\u7684\u5f53\u524d\u72b6\u6001\u201d\u3002 \u5c1a\u6ca1\u6709\u53ef\u63d0\u4ea4\u7684\u5185\u5bb9\uff0c\u5c31\u662f\u8bf4\u5f53\u524d\u6211\u4eec\u5efa\u7acb\u7684\u8fd9\u4e2a\u4ed3\u5e93\u4e2d\u8fd8\u6ca1\u6709\u8bb0\u5f55\u4efb\u4f55\u6587\u4ef6\u7684\u4efb\u4f55\u72b6\u6001\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u5efa\u7acb README.md \u6587\u4ef6\u4f5c\u4e3a\u7ba1\u7406\u5bf9\u8c61\uff0c\u4e3a\u7b2c\u4e00\u6b21\u63d0\u4ea4\u505a\u524d\u671f\u51c6\u5907\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5728 Untracked files \u4e2d\u663e\u793a\u4e86 README.md \u6587\u4ef6\u3002\u7c7b\u4f3c\u5730\uff0c\u53ea\u8981\u5bf9 Git \u7684\u5de5\u4f5c\u6811\u6216\u4ed3\u5e93\u8fdb\u884c\u64cd\u4f5c\uff0cgit status \u547d\u4ee4\u7684\u663e\u793a\u7ed3\u679c\u5c31\u4f1a\u53d1\u751f\u53d8\u5316\u3002</p>"},{"location":"vcs/git/git_02/#git-add","title":"git add \u2014\u2014 \u5411\u6682\u5b58\u533a\u4e2d\u6dfb\u52a0\u6587\u4ef6","text":"<p>\u5982\u679c\u53ea\u662f\u7528 Git \u4ed3\u5e93\u7684\u5de5\u4f5c\u6811\u521b\u5efa\u4e86\u6587\u4ef6\uff0c\u90a3\u4e48\u8be5\u6587\u4ef6\u5e76\u4e0d\u4f1a\u88ab\u8bb0\u5165 Git \u4ed3\u5e93\u7684\u7248\u672c\u7ba1\u7406\u5bf9\u8c61\u5f53\u4e2d\u3002\u56e0\u6b64\u6211\u4eec\u7528 git status \u547d\u4ee4\u67e5\u770b README.md \u6587\u4ef6\u65f6\uff0c\u5b83\u4f1a\u663e\u793a\u5728 Untracked files \u91cc\u3002</p> <p>\u8981\u60f3\u8ba9\u6587\u4ef6\u6210\u4e3a Git \u4ed3\u5e93\u7684\u7ba1\u7406\u5bf9\u8c61\uff0c\u5c31\u9700\u8981\u7528 git add \u547d\u4ee4\u5c06\u5176\u52a0\u5165\u6682\u5b58\u533a\uff08Stage \u6216\u8005 Index\uff09\u4e2d\u3002\u6682\u5b58\u533a\u662f\u63d0\u4ea4\u4e4b\u524d\u7684\u4e00\u4e2a\u4e34\u65f6\u533a\u57df\u3002</p> <p></p> <p>\u5c06 README.md \u6587\u4ef6\u52a0\u5165\u6682\u5b58\u533a\u540e\uff0c git status \u547d\u4ee4\u7684\u663e\u793a\u7ed3\u679c\u53d1\u751f\u4e86\u53d8\u5316\u3002 \u53ef\u4ee5\u770b\u5230\uff0cREADME.md \u6587\u4ef6\u663e\u793a\u5728 Changes to be committed \u4e2d\u4e86\u3002</p>"},{"location":"vcs/git/git_02/#git-commit","title":"git commit\u2014\u2014\u4fdd\u5b58\u4ed3\u5e93\u7684\u5386\u53f2\u8bb0\u5f55","text":"<p>git commit \u547d\u4ee4\u53ef\u4ee5\u5c06\u5f53\u524d\u6682\u5b58\u533a\u4e2d\u7684\u6587\u4ef6\u5b9e\u9645\u4fdd\u5b58\u5230\u4ed3\u5e93\u7684\u5386\u53f2\u8bb0\u5f55\u4e2d\u3002\u901a\u8fc7\u8fd9\u4e9b\u8bb0\u5f55\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u5de5\u4f5c\u6811\u4e2d\u590d\u539f\u6587\u4ef6\u3002</p>"},{"location":"vcs/git/git_02/#_2","title":"\u8bb0\u8ff0\u4e00\u884c\u63d0\u4ea4\u4fe1\u606f","text":"<p>\u6211\u4eec\u6765\u5b9e\u9645\u8fd0\u884c\u4e00\u4e0b git commit \u547d\u4ee4\u3002</p> <p></p> <p>-m \u53c2\u6570\u540e\u7684 \"First commit\" \u79f0\u4f5c\u63d0\u4ea4\u4fe1\u606f\uff0c\u662f\u5bf9\u8fd9\u4e2a\u63d0\u4ea4\u7684\u6982\u8ff0\u3002</p>"},{"location":"vcs/git/git_02/#_3","title":"\u8bb0\u8ff0\u8be6\u7ec6\u63d0\u4ea4\u4fe1\u606f","text":"<p>\u521a\u624d\u6211\u4eec\u53ea\u7b80\u6d01\u5730\u8bb0\u8ff0\u4e86\u4e00\u884c\u63d0\u4ea4\u4fe1\u606f\uff0c \u5982\u679c\u60f3\u8981\u8bb0\u8ff0\u5f97\u66f4\u52a0\u8be6\u7ec6\uff0c\u8bf7\u4e0d\u52a0 -m \uff0c\u76f4\u63a5\u6267\u884c git commit \u547d\u4ee4\u3002\u6267\u884c\u540e\u7f16\u8f91\u5668\u5c31\u4f1a\u542f\u52a8\uff0c\u5e76\u663e\u793a\u5982\u4e0b\u7ed3\u679c\u3002</p> <p></p> <p>\u5728\u7f16\u8f91\u5668\u4e2d\u8bb0\u8ff0\u63d0\u4ea4\u4fe1\u606f\u7684\u683c\u5f0f\u5982\u4e0b\u3002</p> <ul> <li>\u7b2c\u4e00\u884c\uff1a\u7528\u4e00\u884c\u6587\u5b57\u7b80\u8ff0\u63d0\u4ea4\u7684\u66f4\u6539\u5185\u5bb9</li> <li>\u7b2c\u4e8c\u884c\uff1a\u7a7a\u884c</li> <li>\u7b2c\u4e09\u884c\u4ee5\u540e\uff1a\u8bb0\u8ff0\u66f4\u6539\u7684\u539f\u56e0\u548c\u8be6\u7ec6\u5185\u5bb9</li> </ul> <p>\u53ea\u8981\u6309\u7167\u4e0a\u9762\u7684\u683c\u5f0f\u8f93\u5165\uff0c\u4eca\u540e\u4fbf\u53ef\u4ee5\u901a\u8fc7\u786e\u8ba4\u65e5\u5fd7\u7684\u547d\u4ee4\u6216\u5de5\u5177\u770b\u5230\u8fd9\u4e9b\u8bb0\u5f55\u3002</p> <p>\u5728\u4ee5 #\uff08\u4e95\u53f7\uff09\u6807\u4e3a\u6ce8\u91ca\u7684 Changes to be committed \uff08\u8981\u63d0\u4ea4\u7684\u66f4\u6539\uff09\u680f\u4e2d\uff0c\u53ef\u4ee5\u67e5\u770b\u672c\u6b21\u63d0\u4ea4\u4e2d\u5305\u542b\u7684\u6587\u4ef6\u3002\u5c06\u63d0\u4ea4\u4fe1\u606f\u6309\u683c\u5f0f\u8bb0\u8ff0\u5b8c\u6bd5\u540e\uff0c\u8bf7\u4fdd\u5b58\u5e76\u5173\u95ed\u7f16\u8f91\u5668\uff0c\u4ee5 #\uff08\u4e95\u53f7\uff09\u6807\u4e3a\u6ce8\u91ca\u7684\u884c\u4e0d\u5fc5\u5220\u9664\u3002\u968f\u540e\uff0c\u521a\u624d\u8bb0\u8ff0\u7684\u63d0\u4ea4\u4fe1\u606f\u5c31\u4f1a\u88ab\u63d0\u4ea4\u3002</p>"},{"location":"vcs/git/git_02/#_4","title":"\u4e2d\u6b62\u63d0\u4ea4","text":"<p>\u5982\u679c\u5728\u7f16\u8f91\u5668\u542f\u52a8\u540e\u60f3\u4e2d\u6b62\u63d0\u4ea4\uff0c\u8bf7\u5c06\u63d0\u4ea4\u4fe1\u606f\u7559\u7a7a\u5e76\u76f4\u63a5\u5173\u95ed\u7f16\u8f91\u5668\uff0c\u968f\u540e\u63d0\u4ea4\u5c31\u4f1a\u88ab\u4e2d\u6b62\u3002</p>"},{"location":"vcs/git/git_02/#_5","title":"\u67e5\u770b\u63d0\u4ea4\u540e\u7684\u72b6\u6001","text":"<p>\u6267\u884c\u5b8c git commit \u547d\u4ee4\u540e\u518d\u6765\u67e5\u770b\u5f53\u524d\u72b6\u6001\u3002</p> <p></p> <p>\u5f53\u524d\u5de5\u4f5c\u6811\u5904\u4e8e\u521a\u521a\u5b8c\u6210\u63d0\u4ea4\u7684\u6700\u65b0\u72b6\u6001\uff0c\u6240\u4ee5\u7ed3\u679c\u663e\u793a\u6ca1\u6709\u66f4\u6539\u3002</p>"},{"location":"vcs/git/git_02/#git-log","title":"git log \u2014\u2014 \u67e5\u770b\u63d0\u4ea4\u65e5\u5fd7","text":"<p>git log \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u4ee5\u5f80\u4ed3\u5e93\u4e2d\u63d0\u4ea4\u7684\u65e5\u5fd7\u3002\u5305\u62ec\u53ef\u4ee5\u67e5\u770b\u4ec0\u4e48\u4eba\u5728\u4ec0\u4e48\u65f6\u5019\u8fdb\u884c\u4e86\u63d0\u4ea4\u6216\u5408\u5e76\uff0c\u4ee5\u53ca\u64cd\u4f5c\u524d\u540e\u6709\u600e\u6837\u7684\u5dee\u522b\u3002\u5173\u4e8e\u5408\u5e76\u6211\u4eec\u4f1a\u5728\u540e\u9762\u89e3\u8bf4\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\u521a\u624d\u7684 git commit \u547d\u4ee4\u662f\u5426\u88ab\u8bb0\u5f55\u4e86\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c \u5c4f\u5e55\u663e\u793a\u4e86\u521a\u521a\u7684\u63d0\u4ea4\u64cd\u4f5c\u3002commit \u680f\u65c1\u8fb9\u663e\u793a\u7684 \u201c9f129b\u2026\u2026\u201d\u662f\u6307\u5411\u8fd9\u4e2a\u63d0\u4ea4\u7684\u54c8\u5e0c\u503c\u3002Git \u7684\u5176\u4ed6\u547d\u4ee4\u4e2d\uff0c\u5728\u6307\u5411\u63d0\u4ea4\u65f6\u4f1a\u7528\u5230\u8fd9\u4e2a\u54c8\u5e0c\u503c\u3002</p> <p>Author \u680f\u4e2d\u663e\u793a\u6211\u4eec\u7ed9 Git \u8bbe\u7f6e\u7684\u7528\u6237\u540d\u548c\u90ae\u7bb1\u5730\u5740\u3002Date \u680f\u4e2d\u663e\u793a\u63d0\u4ea4\u6267\u884c\u7684\u65e5\u671f\u548c\u65f6\u95f4\u3002\u518d\u5f80\u4e0b\u5c31\u662f\u8be5\u63d0\u4ea4\u7684\u63d0\u4ea4\u4fe1\u606f\u3002</p>"},{"location":"vcs/git/git_02/#_6","title":"\u53ea\u663e\u793a\u63d0\u4ea4\u4fe1\u606f\u7684\u7b2c\u4e00\u884c","text":"<p>\u5982\u679c\u53ea\u60f3\u8ba9\u7a0b\u5e8f\u663e\u793a\u7b2c\u4e00\u884c\u7b80\u8ff0\u4fe1\u606f\uff0c\u53ef\u4ee5\u5728 git log \u547d\u4ee4\u540e\u52a0 \u4e0a --pretty=short \u3002 \u8fd9\u6837\u4e00\u6765\u5f00\u53d1\u4eba\u5458\u5c31\u80fd\u591f\u66f4\u8f7b\u677e\u5730\u628a\u63e1\u591a\u4e2a\u63d0\u4ea4\u3002</p> <p></p>"},{"location":"vcs/git/git_02/#_7","title":"\u53ea\u663e\u793a\u6307\u5b9a\u76ee\u5f55\u3001\u6587\u4ef6\u7684\u65e5\u5fd7","text":"<p>\u53ea\u8981\u5728 git log \u547d\u4ee4\u540e\u52a0\u4e0a\u76ee\u5f55\u540d\uff0c\u4fbf\u4f1a\u53ea\u663e\u793a\u8be5\u76ee\u5f55\u4e0b\u7684\u65e5\u5fd7\u3002\u5982\u679c\u52a0\u7684\u662f\u6587\u4ef6\u540d\uff0c\u5c31\u4f1a\u53ea\u663e\u793a\u4e0e\u8be5\u6587\u4ef6\u76f8\u5173\u7684\u65e5\u5fd7\u3002</p> <p></p>"},{"location":"vcs/git/git_02/#_8","title":"\u663e\u793a\u6587\u4ef6\u7684\u6539\u52a8","text":"<p>\u5982\u679c\u60f3\u67e5\u770b\u63d0\u4ea4\u6240\u5e26\u6765\u7684\u6539\u52a8\uff0c\u53ef\u4ee5\u52a0\u4e0a -p \u53c2\u6570\uff0c\u6587\u4ef6\u7684\u524d\u540e\u5dee\u522b\u5c31\u4f1a\u663e\u793a\u5728\u63d0\u4ea4\u4fe1\u606f\u4e4b\u540e\u3002</p> <p></p> <p>\u6bd4\u5982\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u53ea\u67e5\u770b README.md \u6587\u4ef6\u7684\u63d0\u4ea4\u65e5\u5fd7\u4ee5\u53ca\u63d0\u4ea4\u524d\u540e\u7684\u5dee\u522b\u3002</p> <p></p> <p>\u5982\u4e0a\u6240\u8ff0\uff0c git log \u547d\u4ee4\u53ef\u4ee5\u5229\u7528\u591a\u79cd\u53c2\u6570\u5e2e\u52a9\u5f00\u53d1\u8005\u628a\u63e1\u4ee5\u5f80\u63d0\u4ea4\u7684\u5185\u5bb9\u3002\u4e0d\u5fc5\u52c9\u5f3a\u81ea\u5df1\u4e00\u6b21\u8bb0\u4e0b\u5168\u90e8\u53c2\u6570\uff0c\u6bcf\u5f53\u6709\u60f3\u67e5\u770b\u7684\u65e5\u5fd7\u5c31\u79ef\u6781\u53bb\u67e5\uff0c\u6162\u6162\u5c31\u80fd\u5f97\u5fc3\u5e94\u624b\u4e86\u3002</p>"},{"location":"vcs/git/git_02/#git-diff","title":"git diff \u2014\u2014 \u67e5\u770b\u66f4\u6539\u524d\u540e\u7684\u5dee\u522b","text":"<p>git diff \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u5de5\u4f5c\u6811\u3001\u6682\u5b58\u533a\u3001\u6700\u65b0\u63d0\u4ea4\u4e4b\u95f4\u7684\u5dee\u522b\u3002 \u5355\u4ece\u5b57\u9762\u4e0a\u53ef\u80fd\u5f88\u96be\u7406\u89e3\uff0c\u5404\u4f4d\u4e0d\u59a8\u8ddf\u7740\u7b14\u8005\u7684\u89e3\u8bf4\u4eb2\u624b\u8bd5\u4e00\u8bd5\u3002 </p> <p>\u6211\u4eec\u5728\u521a\u521a\u63d0\u4ea4\u7684 README.md \u4e2d\u5199\u70b9\u4e1c\u897f\u3002</p> <pre><code># Git\u6559\u7a0b\n</code></pre> <p>\u8fd9\u91cc\u7528 Markdown \u8bed\u6cd5\u5199\u4e0b\u4e86\u4e00\u884c\u9898\u76ee\u3002</p>"},{"location":"vcs/git/git_02/#_9","title":"\u67e5\u770b\u5de5\u4f5c\u6811\u548c\u6682\u5b58\u533a\u7684\u5dee\u522b","text":"<p>\u6267\u884c git diff \u547d\u4ee4\uff0c\u67e5\u770b\u5f53\u524d\u5de5\u4f5c\u6811\u4e0e\u6682\u5b58\u533a\u7684\u5dee\u522b\u3002</p> <p></p> <p>\u7531\u4e8e\u6211\u4eec\u5c1a\u672a\u7528 git add \u547d\u4ee4\u5411\u6682\u5b58\u533a\u6dfb\u52a0\u4efb\u4f55\u4e1c\u897f\uff0c\u6240\u4ee5\u7a0b\u5e8f\u53ea\u4f1a\u663e\u793a\u5de5\u4f5c\u6811\u4e0e\u6700\u65b0\u63d0\u4ea4\u72b6\u6001\u4e4b\u95f4\u7684\u5dee\u522b\u3002</p> <p>\u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0b\u663e\u793a\u7684\u5185\u5bb9\u3002\u201c+\u201d\u53f7\u6807\u51fa\u7684\u662f\u65b0\u6dfb\u52a0\u7684\u884c\uff0c\u88ab\u5220\u9664\u7684 \u884c\u5219\u7528 \u201c-\u201d \u53f7\u6807\u51fa\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u6b21\u53ea\u6dfb\u52a0\u4e86\u4e00\u884c\u3002 </p> <p>\u7528 git add \u547d\u4ee4\u5c06 README.md \u6587\u4ef6\u52a0\u5165\u6682\u5b58\u533a\u3002</p> <p></p>"},{"location":"vcs/git/git_02/#_10","title":"\u67e5\u770b\u5de5\u4f5c\u6811\u548c\u6700\u65b0\u63d0\u4ea4\u7684\u5dee\u522b","text":"<p>\u5982\u679c\u73b0\u5728\u6267\u884c git diff \u547d\u4ee4\uff0c\u7531\u4e8e\u5de5\u4f5c\u6811\u548c\u6682\u5b58\u533a\u7684\u72b6\u6001\u5e76\u65e0\u5dee\u522b\uff0c \u7ed3\u679c\u4ec0\u4e48\u90fd\u4e0d\u4f1a\u663e\u793a\u3002 \u8981\u67e5\u770b\u4e0e\u6700\u65b0\u63d0\u4ea4\u7684\u5dee\u522b\uff0c \u8bf7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002</p> <p></p> <p>\u4e0d\u59a8\u517b\u6210\u8fd9\u6837\u4e00\u4e2a\u597d\u4e60\u60ef\uff1a\u5728\u6267\u884c git commit \u547d\u4ee4\u4e4b\u524d\u5148\u6267\u884c git diff HEAD \u547d\u4ee4\uff0c\u67e5\u770b\u672c\u6b21\u63d0\u4ea4\u4e0e\u4e0a\u6b21\u63d0\u4ea4\u4e4b\u95f4\u6709\u4ec0\u4e48\u5dee\u522b\uff0c\u7b49\u786e\u8ba4\u5b8c\u6bd5\u540e\u518d\u8fdb\u884c\u63d0\u4ea4\u3002\u8fd9\u91cc\u7684 HEAD \u662f\u6307\u5411\u5f53\u524d\u5206\u652f\u4e2d\u6700\u65b0\u4e00\u6b21\u63d0\u4ea4\u7684\u6307\u9488\u3002</p> <p>\u7531\u4e8e\u6211\u4eec\u521a\u521a\u786e\u8ba4\u8fc7\u4e24\u4e2a\u63d0\u4ea4\u4e4b\u95f4\u7684\u5dee\u522b\uff0c \u6240\u4ee5\u76f4\u63a5\u8fd0\u884c git commit \u547d\u4ee4\u3002</p> <p></p> <p>\u4fdd\u9669\u8d77\u89c1\uff0c\u6211\u4eec\u67e5\u770b\u4e00\u4e0b\u63d0\u4ea4\u65e5\u5fd7\uff0c\u786e\u8ba4\u63d0\u4ea4\u662f\u5426\u6210\u529f\u3002</p> <p></p> <p>\u6210\u529f\u67e5\u5230\u4e86\u7b2c\u4e8c\u4e2a\u63d0\u4ea4\u3002</p>"},{"location":"vcs/git/git_03/","title":"\u7b2c\u4e09\u7ae0 \u5206\u652f\u7684\u64cd\u4f5c","text":"<p>\u5728\u8fdb\u884c\u591a\u4e2a\u5e76\u884c\u4f5c\u4e1a\u65f6\uff0c\u6211\u4eec\u4f1a\u7528\u5230\u5206\u652f\u3002\u5728\u8fd9\u7c7b\u5e76\u884c\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5f80\u5f80\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u6700\u65b0\u4ee3\u7801\u72b6\u6001\u3002\u5982\u56fe\u6240\u793a\uff0c\u4ece master \u5206\u652f\u521b\u5efa feature-A \u5206\u652f\u548c fix-B \u5206\u652f\u540e\uff0c\u6bcf\u4e2a\u5206\u652f\u4e2d\u90fd\u62e5\u6709\u81ea\u5df1\u7684\u6700\u65b0\u4ee3\u7801\u3002 master \u5206\u652f\u662f Git \u9ed8\u8ba4\u521b\u5efa\u7684\u5206\u652f\uff0c\u56e0\u6b64\u57fa\u672c\u4e0a\u6240\u6709\u5f00\u53d1\u90fd\u662f\u4ee5\u8fd9\u4e2a\u5206\u652f\u4e3a\u4e2d\u5fc3\u8fdb\u884c\u7684\u3002</p> <p></p> <p>\u4e0d\u540c\u5206\u652f\u4e2d\uff0c\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u5b8c\u5168\u4e0d\u540c\u7684\u4f5c\u4e1a\u3002\u7b49\u8be5\u5206\u652f\u7684\u4f5c\u4e1a\u5b8c\u6210\u4e4b\u540e\u518d\u4e0e master \u5206\u652f\u5408\u5e76\u3002\u6bd4\u5982 feature-A \u5206\u652f\u7684\u4f5c\u4e1a\u7ed3\u675f\u540e\u4e0e master \u5408\u5e76\u3002</p> <p>\u901a\u8fc7\u7075\u6d3b\u8fd0\u7528\u5206\u652f\uff0c \u53ef\u4ee5\u8ba9\u591a\u4eba\u540c\u65f6\u9ad8\u6548\u5730\u8fdb\u884c\u5e76\u884c\u5f00\u53d1\u3002 \u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u5e26\u5927\u5bb6\u5b66\u4e60\u4e0e\u5206\u652f\u76f8\u5173\u7684 Git \u64cd\u4f5c\u3002</p> <p></p>"},{"location":"vcs/git/git_03/#git-branch","title":"git branch \u2014\u2014 \u663e\u793a\u5206\u652f\u4e00\u89c8\u8868","text":"<p>git branch \u547d\u4ee4\u53ef\u4ee5\u5c06\u5206\u652f\u540d\u5217\u8868\u663e\u793a\uff0c\u540c\u65f6\u53ef\u4ee5\u786e\u8ba4\u5f53\u524d\u6240\u5728\u5206\u652f\u3002\u8ba9\u6211\u4eec\u6765\u5b9e\u9645\u8fd0\u884c git branch \u547d\u4ee4\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 master \u5206\u652f\u5de6\u4fa7\u6807\u6709 \u201c*\u201d\uff08\u661f\u53f7\uff09\uff0c\u8868\u793a\u8fd9\u662f\u6211\u4eec\u5f53\u524d\u6240\u5728\u7684\u5206\u652f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u6b63\u5728 master \u5206\u652f\u4e0b\u8fdb\u884c\u5f00\u53d1\u3002\u7ed3\u679c\u4e2d\u6ca1\u6709\u663e\u793a\u5176\u4ed6\u5206\u652f\u540d\uff0c\u8868\u793a\u672c\u5730\u4ed3\u5e93\u4e2d\u53ea\u5b58\u5728 master \u4e00\u4e2a\u5206\u652f\u3002</p>"},{"location":"vcs/git/git_03/#git-checkout-b","title":"git checkout -b \u2014\u2014 \u521b\u5efa\u3001\u5207\u6362\u5206\u652f","text":"<p>\u5982\u679c\u60f3\u4ee5\u5f53\u524d\u7684 master \u5206\u652f\u4e3a\u57fa\u7840\u521b\u5efa\u65b0\u7684\u5206\u652f\uff0c \u6211\u4eec\u9700\u8981\u7528\u5230 git checkout -b \u547d\u4ee4\u3002</p>"},{"location":"vcs/git/git_03/#feature-a","title":"\u5207\u6362\u5230 feature-A \u5206\u652f\u5e76\u8fdb\u884c\u63d0\u4ea4","text":"<p>\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u540d\u4e3a feature-A \u7684\u5206\u652f\u3002</p> <p></p> <p>\u5b9e\u9645\u4e0a\uff0c\u8fde\u7eed\u6267\u884c\u4e0b\u9762\u4e24\u6761\u547d\u4ee4\u4e5f\u80fd\u6536\u5230\u540c\u6837\u6548\u679c\u3002</p> <p></p> <p>\u521b\u5efa feature-A \u5206\u652f\uff0c\u5e76\u5c06\u5f53\u524d\u5206\u652f\u5207\u6362\u4e3a feature-A \u5206\u652f\u3002\u8fd9\u65f6\u518d\u6765\u67e5\u770b\u5206\u652f\u5217\u8868\uff0c\u4f1a\u663e\u793a\u6211\u4eec\u5904\u4e8e feature-A \u5206\u652f\u4e0b\u3002</p> <p></p> <p>feature-A \u5206\u652f\u5de6\u4fa7\u6807\u6709 \u201c*\u201d\uff0c\u8868\u793a\u5f53\u524d\u5206\u652f\u4e3a feature-A\u3002\u5728\u8fd9\u4e2a\u72b6\u6001\u4e0b\u50cf\u6b63\u5e38\u5f00\u53d1\u90a3\u6837\u4fee\u6539\u4ee3\u7801\u3001\u6267\u884c git add \u547d\u4ee4\u5e76\u8fdb\u884c\u63d0\u4ea4\u7684\u8bdd\uff0c \u4ee3\u7801\u5c31\u4f1a\u63d0\u4ea4\u81f3 feature-A \u5206\u652f\u3002 \u50cf\u8fd9\u6837\u4e0d\u65ad\u5bf9\u4e00\u4e2a\u5206\u652f\uff08\u4f8b\u5982 feature-A\uff09\u8fdb\u884c\u63d0\u4ea4\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u79f0\u4e3a\u201c\u57f9\u80b2\u5206\u652f\u201d\u3002</p> <p>\u4e0b\u9762\u6765\u5b9e\u9645\u64cd\u4f5c\u4e00\u4e0b\u3002\u5728 README.md \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u884c\u3002</p> <pre><code># Git\u6559\u7a0b\n\n- feature-A\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u6dfb\u52a0\u4e86 feature-A \u8fd9\u6837\u4e00\u884c\u5b57\u6bcd\uff0c\u7136\u540e\u8fdb\u884c\u63d0\u4ea4\u3002</p> <p></p> <p>\u4e8e\u662f\uff0c\u8fd9\u4e00\u884c\u5c31\u6dfb\u52a0\u5230 feature-A \u5206\u652f\u4e2d\u4e86\u3002</p>"},{"location":"vcs/git/git_03/#master","title":"\u5207\u6362\u5230 master \u5206\u652f","text":"<p>\u73b0\u5728\u6211\u4eec\u518d\u6765\u770b\u4e00\u770b master \u5206\u652f\u6709\u6ca1\u6709\u53d7\u5230\u5f71\u54cd\u3002\u9996\u5148\u5207\u6362\u81f3 master \u5206\u652f\u3002</p> <p></p> <p>\u7136\u540e\u67e5\u770b README.md \u6587\u4ef6\uff0c\u4f1a\u53d1\u73b0 README.md \u6587\u4ef6\u4ecd\u7136\u4fdd\u6301\u539f\u5148\u7684\u72b6\u6001\uff0c \u5e76\u6ca1\u6709\u88ab\u6dfb\u52a0\u6587\u5b57\u3002feature-A \u5206\u652f\u7684\u66f4\u6539\u4e0d\u4f1a\u5f71\u54cd\u5230 master \u5206\u652f\uff0c\u8fd9\u6b63\u662f\u5728\u5f00\u53d1\u4e2d\u521b\u5efa\u5206\u652f\u7684\u4f18\u70b9\u3002\u53ea\u8981\u521b\u5efa\u591a\u4e2a\u5206\u652f\uff0c\u5c31\u53ef\u4ee5\u5728\u4e0d\u4e92\u76f8\u5f71\u54cd\u7684\u60c5\u51b5\u4e0b\u540c\u65f6\u8fdb\u884c\u591a\u4e2a\u529f\u80fd\u7684\u5f00\u53d1\u3002</p>"},{"location":"vcs/git/git_03/#_2","title":"\u5207\u6362\u56de\u4e0a\u4e00\u4e2a\u5206\u652f","text":"<p>\u73b0\u5728\uff0c\u6211\u4eec\u518d\u5207\u6362\u56de feature-A \u5206\u652f\u3002</p> <p></p> <p>\u50cf\u4e0a\u9762\u8fd9\u6837\u7528 \u201c-\u201d\uff08\u8fde\u5b57\u7b26\uff09\u4ee3\u66ff\u5206\u652f\u540d\uff0c\u5c31\u53ef\u4ee5\u5207\u6362\u81f3\u4e0a\u4e00\u4e2a\u5206 \u652f\u3002\u5f53\u7136\uff0c\u5c06 \u201c-\u201d \u66ff\u6362\u6210 feature-A \u540c\u6837\u53ef\u4ee5\u5207\u6362\u5230 feature-A \u5206\u652f\u3002</p>"},{"location":"vcs/git/git_03/#_3","title":"\u7279\u6027\u5206\u652f","text":"<p>Git \u4e0e Subversion\uff08SVN\uff09\u7b49\u96c6\u4e2d\u578b\u7248\u672c\u7ba1\u7406\u7cfb\u7edf\u4e0d\u540c\uff0c\u521b\u5efa\u5206\u652f\u65f6\u4e0d\u9700\u8981\u8fde\u63a5\u4e2d\u592e\u4ed3\u5e93\uff0c\u6240\u4ee5\u80fd\u591f\u76f8\u5bf9\u8f7b\u677e\u5730\u521b\u5efa\u5206\u652f\u3002\u56e0\u6b64\uff0c\u5f53\u4eca\u5927\u90e8\u5206\u5de5\u4f5c\u6d41\u7a0b\u4e2d\u90fd\u7528\u5230\u4e86\u7279\u6027\uff08Topic\uff09\u5206\u652f\u3002</p> <p>\u7279\u6027\u5206\u652f\u987e\u540d\u601d\u4e49\uff0c \u662f\u96c6\u4e2d\u5b9e\u73b0\u5355\u4e00\u7279\u6027\uff08\u4e3b\u9898\uff09\uff0c \u9664\u6b64\u4e4b\u5916\u4e0d\u8fdb\u884c\u4efb\u4f55\u4f5c\u4e1a\u7684\u5206\u652f\u3002\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u4f1a\u521b\u5efa\u6570\u4e2a\u7279\u6027\u5206\u652f\uff0c\u540c\u65f6\u5728\u6b64\u4e4b\u5916\u518d\u4fdd\u7559\u4e00\u4e2a\u968f\u65f6\u53ef\u4ee5\u53d1\u5e03\u8f6f\u4ef6\u7684\u7a33\u5b9a\u5206\u652f\u3002\u7a33\u5b9a\u5206\u652f\u7684\u89d2\u8272\u901a\u5e38\u7531 master \u5206\u652f\u62c5\u5f53\u3002</p> <p></p> <p>\u4e4b\u524d\u6211\u4eec\u521b\u5efa\u4e86 feature-A \u5206\u652f\uff0c\u8fd9\u4e00\u5206\u652f\u4e3b\u8981\u5b9e\u73b0 feature-A\uff0c\u9664 feature-A \u7684\u5b9e\u73b0\u4e4b\u5916\u4e0d\u8fdb\u884c\u4efb\u4f55\u4f5c\u4e1a\u3002\u5373\u4fbf\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u4e86 BUG\uff0c \u4e5f\u9700\u8981\u518d\u521b\u5efa\u65b0\u7684\u5206\u652f\uff0c\u5728\u65b0\u5206\u652f\u4e2d\u8fdb\u884c\u4fee\u6b63\u3002</p> <p>\u57fa\u4e8e\u7279\u5b9a\u4e3b\u9898\u7684\u4f5c\u4e1a\u5728\u7279\u6027\u5206\u652f\u4e2d\u8fdb\u884c\uff0c\u4e3b\u9898\u5b8c\u6210\u540e\u518d\u4e0e master \u5206\u652f\u5408\u5e76\u3002\u53ea\u8981\u4fdd\u6301\u8fd9\u6837\u4e00\u4e2a\u5f00\u53d1\u6d41\u7a0b\uff0c\u5c31\u80fd\u4fdd\u8bc1 master \u5206\u652f\u53ef\u4ee5\u968f\u65f6\u4f9b\u4eba\u67e5\u770b\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5176\u4ed6\u5f00\u53d1\u8005\u4e5f\u53ef\u4ee5\u653e\u5fc3\u5927\u80c6\u5730\u4ece master \u5206\u652f\u521b\u5efa\u65b0\u7684\u7279\u6027\u5206\u652f\u3002</p>"},{"location":"vcs/git/git_03/#_4","title":"\u4e3b\u5e72\u5206\u652f","text":"<p>\u4e3b\u5e72\u5206\u652f\u662f\u521a\u624d\u6211\u4eec\u8bb2\u89e3\u7684\u7279\u6027\u5206\u652f\u7684\u539f\u70b9\uff0c \u540c\u65f6\u4e5f\u662f\u5408\u5e76\u7684\u7ec8\u70b9\u3002\u901a\u5e38\u4eba\u4eec\u4f1a\u7528 master \u5206\u652f\u4f5c\u4e3a\u4e3b\u5e72\u5206\u652f\u3002\u4e3b\u5e72\u5206\u652f\u4e2d\u5e76\u6ca1\u6709\u5f00\u53d1\u5230\u4e00\u534a\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u968f\u65f6\u4f9b\u4ed6\u4eba\u67e5\u770b\u3002</p> <p>\u6709\u65f6\u6211\u4eec\u9700\u8981\u8ba9\u8fd9\u4e2a\u4e3b\u5e72\u5206\u652f\u603b\u662f\u914d\u7f6e\u5728\u6b63\u5f0f\u73af\u5883\u4e2d\uff0c\u6709\u65f6\u53c8\u9700\u8981\u7528\u6807\u7b7e Tag \u7b49\u521b\u5efa\u7248\u672c\u4fe1\u606f\uff0c\u540c\u65f6\u7ba1\u7406\u591a\u4e2a\u7248\u672c\u53d1\u5e03\u3002\u62e5\u6709\u591a\u4e2a\u7248\u672c\u53d1 \u5e03\u65f6\uff0c\u4e3b\u5e72\u5206\u652f\u4e5f\u6709\u591a\u4e2a\u3002</p>"},{"location":"vcs/git/git_03/#git-merge","title":"git merge \u2014\u2014 \u5408\u5e76\u5206\u652f","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5047\u8bbe feature-A \u5df2\u7ecf\u5b9e\u73b0\u5b8c\u6bd5\uff0c\u60f3\u8981\u5c06\u5b83\u5408\u5e76\u5230\u4e3b\u5e72\u5206\u652f master \u4e2d\u3002\u9996\u5148\u5207\u6362\u5230 master \u5206\u652f\u3002</p> <p></p> <p>\u7136\u540e\u5408\u5e76 feature-A \u5206\u652f\u3002\u4e3a\u4e86\u5728\u5386\u53f2\u8bb0\u5f55\u4e2d\u660e\u786e\u8bb0\u5f55\u4e0b\u672c\u6b21\u5206\u652f\u5408\u5e76\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u5408\u5e76\u63d0\u4ea4\u3002\u56e0\u6b64\uff0c\u5728\u5408\u5e76\u65f6\u52a0\u4e0a --no-ff \u53c2\u6570\u3002</p> <p></p> <p>\u968f\u540e\u7f16\u8f91\u5668\u4f1a\u542f\u52a8\uff0c\u7528\u4e8e\u5f55\u5165\u5408\u5e76\u63d0\u4ea4\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u9ed8\u8ba4\u4fe1\u606f\u4e2d\u5df2\u7ecf\u5305\u542b\u4e86\u662f\u4ece feature-A \u5206\u652f\u5408\u5e76\u8fc7\u6765\u7684\u76f8\u5173\u5185\u5bb9\uff0c\u6240\u4ee5\u53ef\u4e0d\u5fc5\u505a\u4efb\u4f55\u66f4\u6539\u3002\u5c06\u7f16\u8f91\u5668\u4e2d\u663e\u793a\u7684\u5185\u5bb9\u4fdd\u5b58\uff0c\u5173\u95ed\u7f16\u8f91\u5668\uff0c\u7136\u540e\u5c31\u4f1a\u770b\u5230\u4e0b\u9762\u7684\u7ed3\u679c\u3002</p> <p></p> <p>\u8fd9\u6837\u4e00\u6765\uff0cfeature-A \u5206\u652f\u7684\u5185\u5bb9\u5c31\u5408\u5e76\u5230 master \u5206\u652f\u4e2d\u4e86\u3002</p>"},{"location":"vcs/git/git_03/#git-log-graph","title":"git log --graph \u2014\u2014 \u4ee5\u56fe\u8868\u5f62\u5f0f\u67e5\u770b\u5206\u652f","text":"<p>\u7528 git log --graph \u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u7684\u8bdd\uff0c\u80fd\u5f88\u6e05\u695a\u5730\u770b\u5230\u7279\u6027\u5206\u652f\uff08feature-A\uff09\u63d0\u4ea4\u7684\u5185\u5bb9\u5df2\u88ab\u5408\u5e76\u3002\u9664\u6b64\u4ee5\u5916\uff0c\u7279\u6027\u5206\u652f\u7684\u521b\u5efa\u4ee5\u53ca\u5408\u5e76\u4e5f\u90fd\u6e05\u695a\u660e\u4e86\u3002</p> <p></p> <p>git log --graph \u547d\u4ee4\u53ef\u4ee5\u7528\u56fe\u8868\u5f62\u5f0f\u8f93\u51fa\u63d0\u4ea4\u65e5\u5fd7\uff0c\u975e\u5e38\u76f4 \u89c2\uff0c\u8bf7\u5927\u5bb6\u52a1\u5fc5\u8bb0\u4f4f\u3002</p>"},{"location":"vcs/git/git_04/","title":"\u7b2c\u56db\u7ae0 \u66f4\u6539\u63d0\u4ea4\u7684\u64cd\u4f5c","text":""},{"location":"vcs/git/git_04/#git-reset","title":"git reset \u2014\u2014 \u56de\u6eaf\u5386\u53f2\u7248\u672c","text":"<p>\u901a\u8fc7\u524d\u9762\u5b66\u4e60\u7684\u64cd\u4f5c\uff0c \u6211\u4eec\u5df2\u7ecf\u5b66\u4f1a\u5982\u4f55\u5728\u5b9e\u73b0\u529f\u80fd\u540e\u8fdb\u884c\u63d0\u4ea4\uff0c \u7d2f\u79ef\u63d0\u4ea4\u65e5\u5fd7\u4f5c\u4e3a\u5386\u53f2\u8bb0\u5f55\uff0c\u501f\u6b64\u4e0d\u65ad\u57f9\u80b2\u4e00\u6b3e\u8f6f\u4ef6\u3002</p> <p>Git \u7684\u53e6\u4e00\u7279\u5f81\u4fbf\u662f\u53ef\u4ee5\u7075\u6d3b\u64cd\u4f5c\u5386\u53f2\u7248\u672c\u3002\u501f\u52a9\u5206\u6563\u4ed3\u5e93\u7684\u4f18\u52bf\uff0c \u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u5176\u4ed6\u4ed3\u5e93\u7684\u524d\u63d0\u4e0b\u5bf9\u5386\u53f2\u7248\u672c\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c \u4e3a\u4e86\u8ba9\u5404\u4f4d\u719f\u6089\u5bf9\u5386\u53f2\u7248\u672c\u7684\u64cd\u4f5c\uff0c \u6211\u4eec\u5148\u56de\u6eaf\u5386\u53f2\u7248\u672c\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a fix-B \u7684\u7279\u6027\u5206\u652f\u3002</p> <p></p>"},{"location":"vcs/git/git_04/#feature-a","title":"\u56de\u6eaf\u5230\u521b\u5efa feature-A \u5206\u652f\u524d","text":"<p>\u8ba9\u6211\u4eec\u5148\u56de\u6eaf\u5230\u4e0a\u4e00\u8282 feature-A \u5206\u652f\u521b\u5efa\u4e4b\u524d\uff0c \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a fix-B \u7684\u7279\u6027\u5206\u652f\u3002</p> <p>\u8981\u8ba9\u4ed3\u5e93\u7684 HEAD\u3001\u6682\u5b58\u533a\u3001\u5f53\u524d\u5de5\u4f5c\u6811\u56de\u6eaf\u5230\u6307\u5b9a\u72b6\u6001\uff0c\u9700\u8981\u7528\u5230 git rest --hard \u547d\u4ee4\u3002\u53ea\u8981\u63d0\u4f9b\u76ee\u6807\u65f6\u95f4\u70b9\u7684\u54c8\u5e0c\u503c  \uff0c\u5c31\u53ef\u4ee5\u5b8c\u5168\u6062\u590d\u81f3\u8be5\u65f6\u95f4\u70b9\u7684\u72b6\u6001\u3002\u4e8b\u4e0d\u5b9c\u8fdf\uff0c\u8ba9\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u3002</p> <p></p> <p>\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u56de\u6eaf\u5230\u7279\u6027\u5206\u652f\uff08feature-A\uff09\u521b\u5efa\u4e4b\u524d\u7684\u72b6\u6001\u3002\u7531\u4e8e\u6240\u6709\u6587\u4ef6\u90fd\u56de\u6eaf\u5230\u4e86\u6307\u5b9a\u54c8\u5e0c\u503c\u5bf9\u5e94\u7684\u65f6\u95f4\u70b9\u4e0a\uff0cREADME.md \u6587\u4ef6\u7684\u5185\u5bb9\u4e5f\u6062\u590d\u5230\u4e86\u5f53\u65f6\u7684\u72b6\u6001\u3002</p>"},{"location":"vcs/git/git_04/#fix-b","title":"\u521b\u5efa fix-B \u5206\u652f","text":"<p>\u73b0\u5728\u6211\u4eec\u6765\u521b\u5efa\u7279\u6027\u5206\u652f\uff08fix-B\uff09\u3002</p> <p></p> <p>\u4f5c\u4e3a\u8fd9\u4e2a\u4e3b\u9898\u7684\u4f5c\u4e1a\u5185\u5bb9\uff0c\u6211\u4eec\u5728 README.md \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u884c\u6587\u5b57\u3002</p> <pre><code># Git\u6559\u7a0b\n\n- fix-B\n</code></pre> <p>\u7136\u540e\u76f4\u63a5\u63d0\u4ea4 README.md \u6587\u4ef6\u3002</p> <p></p> <p>\u73b0\u5728\u7684\u72b6\u6001\u5982\u56fe1\u6240\u793a\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u7684\u76ee\u6807\u662f\u56fe2\u4e2d\u6240\u793a\u7684\u72b6\u6001\uff0c\u5373\u4e3b\u5e72\u5206\u652f\u5408\u5e76 feature-A \u5206\u652f\u7684\u4fee\u6539\u540e\uff0c\u53c8\u5408\u5e76\u4e86 fix-B \u7684\u4fee\u6539\u3002</p> \u56fe1\u56fe2 <p> \u5f53\u524dfix-B\u72b6\u6001 </p> <p> fix-\u76ee\u6807 </p>"},{"location":"vcs/git/git_04/#feature-a_1","title":"\u63a8\u8fdb\u81f3 feature-A \u5206\u652f\u5408\u5e76\u540e\u7684\u72b6\u6001","text":"<p>\u9996\u5148\u6062\u590d\u5230 feature-A \u5206\u652f\u5408\u5e76\u540e\u7684\u72b6\u6001\u3002\u4e0d\u59a8\u79f0\u8fd9\u4e00\u64cd\u4f5c\u4e3a\u201c\u63a8\u8fdb\u5386\u53f2\u201d\u3002</p> <p>git log \u547d\u4ee4\u53ea\u80fd\u67e5\u770b\u4ee5\u5f53\u524d\u72b6\u6001\u4e3a\u7ec8\u70b9\u7684\u5386\u53f2\u65e5\u5fd7\u3002\u6240\u4ee5\u8fd9\u91cc \u8981\u4f7f\u7528 git reflog \u547d\u4ee4\uff0c\u67e5\u770b\u5f53\u524d\u4ed3\u5e93\u7684\u64cd\u4f5c\u65e5\u5fd7\u3002\u5728\u65e5\u5fd7\u4e2d\u627e\u51fa\u56de\u6eaf\u5386\u53f2\u4e4b\u524d\u7684\u54c8\u5e0c\u503c\uff0c\u901a\u8fc7 git reset --hard \u547d\u4ee4\u6062\u590d\u5230\u56de\u6eaf\u5386\u53f2\u524d\u7684\u72b6\u6001\u3002</p> <p>\u9996\u5148\u6267\u884c git reflog \u547d\u4ee4\uff0c\u67e5\u770b\u5f53\u524d\u4ed3\u5e93\u6267\u884c\u8fc7\u7684\u64cd\u4f5c\u7684\u65e5\u5fd7\u3002</p> <p></p> <p>\u5728\u65e5\u5fd7\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 commit\u3001checkout\u3001reset\u3001merge \u7b49 Git \u547d\u4ee4\u7684\u6267\u884c\u8bb0\u5f55\u3002\u53ea\u8981\u4e0d\u8fdb\u884c Git \u7684 GC\uff08Garbage Collection\uff0c\u5783\u573e\u56de\u6536\uff09\uff0c \u5c31\u53ef\u4ee5\u901a\u8fc7\u65e5\u5fd7\u968f\u610f\u8c03\u53d6\u8fd1\u671f\u7684\u5386\u53f2\u72b6\u6001\uff0c\u5c31\u50cf\u7ed9\u65f6\u95f4\u673a\u5668\u6307\u5b9a\u4e00\u4e2a\u65f6\u95f4\u70b9\uff0c \u5728\u8fc7\u53bb\u672a\u6765\u4e2d\u81ea\u7531\u7a7f\u68ad\u4e00\u822c\u3002 \u5373\u4fbf\u5f00\u53d1\u8005\u9519\u8bef\u6267\u884c\u4e86 Git \u64cd\u4f5c\uff0c \u57fa\u672c\u4e5f\u90fd\u53ef\u4ee5\u5229\u7528 git reflog \u547d\u4ee4\u6062\u590d\u5230\u539f\u5148\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u8bf7\u5404\u4f4d\u8bfb\u8005\u52a1\u5fc5\u7262\u8bb0\u672c\u90e8\u5206\u3002</p> <p>\u4ece\u4e0a\u9762\u6570\u7b2c\u56db\u884c\u8868\u793a feature-A \u7279\u6027\u5206\u652f\u5408\u5e76\u540e\u7684\u72b6\u6001\uff0c\u5bf9\u5e94\u54c8\u5e0c\u503c\u4e3a 83b0b94 \u3002\u6211\u4eec\u5c06 HEAD\u3001\u6682\u5b58\u533a\u3001\u5de5\u4f5c\u6811\u6062\u590d\u5230\u8fd9\u4e2a\u65f6\u95f4\u70b9\u7684\u72b6\u6001\u3002</p> <p></p> <p>\u4e4b\u524d\u6211\u4eec\u4f7f\u7528 git reset --hard \u547d\u4ee4\u56de\u6eaf\u4e86\u5386\u53f2\uff0c\u8fd9\u91cc\u53c8\u518d\u6b21\u901a\u8fc7\u5b83\u6062\u590d\u5230\u4e86\u56de\u6eaf\u524d\u7684\u5386\u53f2\u72b6\u6001\u3002\u5f53\u524d\u7684\u72b6\u6001\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"vcs/git/git_04/#_2","title":"\u6d88\u9664\u51b2\u7a81","text":"<p>\u73b0\u5728\u53ea\u8981\u5408\u5e76 fix-B \u5206\u652f\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\u72b6\u6001\u3002\u8ba9\u6211\u4eec\u8d76\u5feb\u8fdb\u884c\u5408\u5e76\u64cd\u4f5c\u3002</p> <p></p> <p>\u8fd9\u65f6\uff0c\u7cfb\u7edf\u544a\u8bc9\u6211\u4eec README.md \u6587\u4ef6\u53d1\u751f\u4e86\u51b2\u7a81\uff08Conflict\uff09\u3002\u7cfb\u7edf\u5728\u5408\u5e76 README.md \u6587\u4ef6\u65f6\uff0cfeature-A \u5206\u652f\u66f4\u6539\u7684\u90e8\u5206\u4e0e\u672c\u6b21\u60f3\u8981\u5408\u5e76\u7684 fix-B \u5206\u652f\u66f4\u6539\u7684\u90e8\u5206\u53d1\u751f\u4e86\u51b2\u7a81\u3002</p> <p>\u4e0d\u89e3\u51b3\u51b2\u7a81\u5c31\u65e0\u6cd5\u5b8c\u6210\u5408\u5e76\uff0c\u6240\u4ee5\u6211\u4eec\u6253\u5f00 README.md \u6587\u4ef6\uff0c\u89e3\u51b3\u8fd9\u4e2a\u51b2\u7a81\u3002</p>"},{"location":"vcs/git/git_04/#_3","title":"\u67e5\u770b\u51b2\u7a81\u90e8\u5206\u5e76\u5c06\u5176\u89e3\u51b3","text":"<p>\u7528\u7f16\u8f91\u5668\u6253\u5f00 README.md \u6587\u4ef6\uff0c\u5c31\u4f1a\u53d1\u73b0\u5176\u5185\u5bb9\u53d8\u6210\u4e86\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50\u3002</p> <p></p> <p>\u4ee5\u4e0a\u7684\u90e8\u5206\u662f\u5f53\u524d HEAD \u7684\u5185\u5bb9\uff0c\u4ee5\u4e0b\u7684\u90e8\u5206\u662f\u8981\u5408\u5e76\u7684 fix-B \u5206\u652f\u4e2d\u7684\u5185\u5bb9\u3002\u6211\u4eec\u5728\u7f16\u8f91\u5668\u4e2d\u5c06\u5176\u6539\u6210\u60f3\u8981\u7684\u6837\u5b50\u3002</p> <pre><code># Git\u6559\u7a0b\n\n- feature-A\n- fix-B\n</code></pre> <p>\u5982\u4e0a\u6240\u793a\uff0c\u672c\u6b21\u4fee\u6b63\u8ba9 feature-A \u4e0e fix-B \u7684\u5185\u5bb9\u5e76\u5b58\u4e8e\u6587\u4ef6\u4e4b\u4e2d\u3002 \u4f46\u662f\u5728\u5b9e\u9645\u7684\u8f6f\u4ef6\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u9700\u8981\u5220\u9664\u5176\u4e2d\u4e4b\u4e00\uff0c\u6240\u4ee5\u5404\u4f4d\u5728\u5904\u7406\u51b2\u7a81\u65f6\uff0c\u52a1\u5fc5\u8981\u4ed4\u7ec6\u5206\u6790\u51b2\u7a81\u90e8\u5206\u7684\u5185\u5bb9\u540e\u518d\u884c\u4fee\u6539\u3002</p>"},{"location":"vcs/git/git_04/#_4","title":"\u63d0\u4ea4\u89e3\u51b3\u540e\u7684\u7ed3\u679c","text":"<p>\u51b2\u7a81\u89e3\u51b3\u540e\uff0c\u6267\u884c git add \u547d\u4ee4\u4e0e git commit \u547d\u4ee4\u3002</p> <p></p> <p>\u7531\u4e8e\u672c\u6b21\u66f4\u6539\u89e3\u51b3\u4e86\u51b2\u7a81\uff0c\u6240\u4ee5\u63d0\u4ea4\u4fe1\u606f\u8bb0\u4e3a \" Fix conflict \" \u3002</p>"},{"location":"vcs/git/git_04/#git-commit-amend","title":"git commit --amend \u2014\u2014 \u4fee\u6539\u63d0\u4ea4\u4fe1\u606f","text":"<p>\u8981\u4fee\u6539\u4e0a\u4e00\u6761\u63d0\u4ea4\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 git commit --amend \u547d\u4ee4\u3002 </p> <p>\u6211\u4eec\u5c06\u4e0a\u4e00\u6761\u63d0\u4ea4\u4fe1\u606f\u8bb0\u4e3a\u4e86 \" Fix conflict \" \uff0c\u4f46\u5b83\u5176\u5b9e\u662f fix-B \u5206\u652f\u7684\u5408\u5e76\uff0c \u89e3\u51b3\u5408\u5e76\u65f6\u53d1\u751f\u7684\u51b2\u7a81\u53ea\u662f\u8fc7\u7a0b\u4e4b\u4e00\uff0c \u8fd9\u6837\u6807\u8bb0\u5b9e\u5728\u4e0d\u59a5\u3002 \u4e8e\u662f\uff0c\u6211\u4eec\u8981\u4fee\u6539\u8fd9\u6761\u63d0\u4ea4\u4fe1\u606f\u3002</p> <p></p> <p>\u6267\u884c\u4e0a\u9762\u7684\u547d\u4ee4\u540e\uff0c\u7f16\u8f91\u5668\u5c31\u4f1a\u542f\u52a8\u3002</p> <p></p> <p>\u7f16\u8f91\u5668\u4e2d\u663e\u793a\u7684\u5185\u5bb9\u5982\u4e0a\u6240\u793a\uff0c \u5176\u4e2d\u5305\u542b\u4e4b\u524d\u7684\u63d0\u4ea4\u4fe1\u606f\u3002 \u8bf7\u5c06\u63d0\u4ea4\u4fe1\u606f\u7684\u90e8\u5206\u4fee\u6539\u4e3a Merge branch 'fix-B'\uff0c\u7136\u540e\u4fdd\u5b58\u6587\u4ef6\uff0c\u5173\u95ed\u7f16 \u8f91\u5668\u3002</p> <p></p> <p>\u968f\u540e\u4f1a\u663e\u793a\u4e0a\u9762\u8fd9\u6761\u7ed3\u679c\u3002\u73b0\u5728\u6267\u884c git \u53ef\u4ee5\u770b\u5230\u63d0\u4ea4\u65e5\u5fd7\u4e2d\u7684\u76f8\u5e94\u5185\u5bb9\u4e5f\u5df2\u7ecf\u88ab\u4fee\u6539\u3002log --graph \u547d\u4ee4\uff0c</p> <p></p>"},{"location":"vcs/git/git_04/#git-rebase-i","title":"git rebase -i \u2014\u2014 \u538b\u7f29\u5386\u53f2","text":"<p>\u5728\u5408\u5e76\u7279\u6027\u5206\u652f\u4e4b\u524d\uff0c\u5982\u679c\u53d1\u73b0\u5df2\u63d0\u4ea4\u7684\u5185\u5bb9\u4e2d\u6709\u4e9b\u8bb8\u62fc\u5199\u9519\u8bef\u7b49\uff0c \u4e0d\u59a8\u63d0\u4ea4\u4e00\u4e2a\u4fee\u6539\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u4fee\u6539\u5305\u542b\u5230\u524d\u4e00\u4e2a\u63d0\u4ea4\u4e4b\u4e2d\uff0c\u538b\u7f29\u6210\u4e00\u4e2a\u5386\u53f2\u8bb0\u5f55\u3002\u8fd9\u662f\u4e2a\u4f1a\u7ecf\u5e38\u7528\u5230\u7684\u6280\u5de7\uff0c\u8ba9\u6211\u4eec\u6765\u5b9e\u9645\u64cd\u4f5c\u4f53\u4f1a\u4e00\u4e0b\u3002</p>"},{"location":"vcs/git/git_04/#feature-c","title":"\u521b\u5efa feature-C \u5206\u652f","text":"<p>\u9996\u5148\uff0c\u65b0\u5efa\u4e00\u4e2a feature-C \u7279\u6027\u5206\u652f\u3002</p> <p></p> <p>\u4f5c\u4e3a feature-C \u7684\u529f\u80fd\u5b9e\u73b0\uff0c\u6211\u4eec\u5728 README.md \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u884c\u6587\u5b57\uff0c\u5e76\u4e14\u6545\u610f\u7559\u4e0b\u62fc\u5199\u9519\u8bef\uff0c\u4ee5\u4fbf\u4e4b\u540e\u4fee\u6b63\u3002</p> <pre><code># Git\u6559\u7a0b\n\n- feature-A\n- fix-B\n- faeture-C\n</code></pre> <p>\u63d0\u4ea4\u8fd9\u90e8\u5206\u5185\u5bb9\u3002\u8fd9\u4e2a\u5c0f\u5c0f\u7684\u53d8\u66f4\u5c31\u6ca1\u5fc5\u8981\u5148\u6267\u884c git add \u547d\u4ee4 \u518d\u6267\u884c git commit \u547d\u4ee4\u4e86\uff0c\u6211\u4eec\u7528 git commit -am \u547d\u4ee4\u6765\u4e00\u6b21\u5b8c\u6210\u8fd9\u4e24\u6b65\u64cd\u4f5c\u3002</p> <p></p>"},{"location":"vcs/git/git_04/#_5","title":"\u4fee\u6b63\u62fc\u5199\u9519\u8bef","text":"<p>\u73b0\u5728\u6765\u4fee\u6b63\u521a\u624d\u9884\u7559\u7684\u62fc\u5199\u9519\u8bef\u3002\u8bf7\u5404\u4f4d\u81ea\u884c\u4fee\u6b63 README.md \u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u4fee\u6b63\u540e\u7684\u5dee\u522b\u5982\u4e0b\u6240\u793a\u3002</p> <p></p> <p>\u7136\u540e\u8fdb\u884c\u63d0\u4ea4\u3002</p> <p></p> <p>\u9519\u5b57\u6f0f\u5b57\u7b49\u5931\u8bef\u79f0\u4f5c typo\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u63d0\u4ea4\u4fe1\u606f\u8bb0\u4e3a \" Fix typo \" \u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u5728\u5386\u53f2\u8bb0\u5f55\u4e2d\u770b\u5230\u8fd9\u7c7b\u63d0\u4ea4\uff0c\u56e0\u4e3a\u5065\u5168\u7684\u5386\u53f2\u8bb0\u5f55\u5e76\u4e0d\u9700\u8981\u5b83\u4eec\u3002\u5982\u679c\u80fd\u5728\u6700\u521d\u63d0\u4ea4\u4e4b\u524d\u5c31\u53d1\u73b0\u5e76\u4fee\u6b63\u8fd9\u4e9b\u9519\u8bef\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u7c7b\u63d0\u4ea4\u4e86\u3002</p>"},{"location":"vcs/git/git_04/#_6","title":"\u66f4\u6539\u5386\u53f2","text":"<p>\u56e0\u6b64\uff0c \u6211\u4eec\u6765\u66f4\u6539\u5386\u53f2\u3002 \u5c06 \" Fix typo\"\u4fee\u6b63\u7684\u5185\u5bb9\u4e0e\u4e4b\u524d\u4e00\u6b21\u7684\u63d0\u4ea4\u5408\u5e76\uff0c \u5728\u5386\u53f2\u8bb0\u5f55\u4e2d\u5408\u5e76\u4e3a\u4e00\u6b21\u5b8c\u7f8e\u7684\u63d0\u4ea4\u3002 \u4e3a\u6b64\uff0c \u6211\u4eec\u8981\u7528\u5230 git rebase \u547d\u4ee4\u3002</p> <p></p> <p>\u7528\u4e0a\u8ff0\u65b9\u5f0f\u6267\u884c git rebase \u547d\u4ee4\uff0c \u53ef\u4ee5\u9009\u5b9a\u5f53\u524d\u5206\u652f\u4e2d\u5305\u542b HEAD\uff08\u6700\u65b0\u63d0\u4ea4\uff09\u5728\u5185\u7684\u4e24\u4e2a\u6700\u65b0\u5386\u53f2\u8bb0\u5f55\u4e3a\u5bf9\u8c61\uff0c \u5e76\u5728\u7f16\u8f91\u5668\u4e2d\u6253\u5f00\u3002</p> <p></p> <p>\u6211\u4eec\u5c06 6fba227 \u7684 Fix typo \u7684\u5386\u53f2\u8bb0\u5f55\u538b\u7f29\u5230 7a34294 \u7684 Add feature-C \u91cc\u3002\u6309\u7167\u4e0b\u56fe\u6240\u793a\uff0c\u5c06 6fba227 \u5de6\u4fa7\u7684 pick \u90e8\u5206\u5220\u9664\uff0c\u6539\u5199\u4e3a fixup\u3002</p> <p></p> <p>\u4fdd\u5b58\u7f16\u8f91\u5668\u91cc\u7684\u5185\u5bb9\uff0c\u5173\u95ed\u7f16\u8f91\u5668\u3002</p> <p></p> <p>\u7cfb\u7edf\u663e\u793a rebase \u6210\u529f\u3002\u4e5f\u5c31\u662f\u4ee5\u4e0b\u9762\u8fd9\u4e24\u4e2a\u63d0\u4ea4\u4f5c\u4e3a\u5bf9\u8c61\uff0c\u5c06 \" Fix typo \" \u7684\u5185\u5bb9\u5408\u5e76\u5230\u4e86\u4e0a\u4e00\u4e2a\u63d0\u4ea4 \" Add feature-C \" \u4e2d\uff0c\u6539\u5199\u6210\u4e86\u4e00\u4e2a\u65b0\u7684\u63d0\u4ea4\u3002</p> <ul> <li>7a34294 Add feature-C</li> <li>6fba227 Fix typo</li> </ul> <p>\u73b0\u5728\u518d\u67e5\u770b\u63d0\u4ea4\u65e5\u5fd7\u65f6\u4f1a\u53d1\u73b0 Add feature-C \u7684\u54c8\u5e0c\u503c\u5df2\u7ecf\u4e0d\u662f 7a34294 \u4e86\uff0c\u8fd9\u8bc1\u660e\u63d0\u4ea4\u5df2\u7ecf\u88ab\u66f4\u6539\u3002</p> <p></p> <p>\u8fd9\u6837\u4e00\u6765\uff0cFix typo \u5c31\u4ece\u5386\u53f2\u4e2d\u88ab\u62b9\u53bb\uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e Add feature-C \u4e2d\u4ece\u6765\u6ca1\u6709\u51fa\u73b0\u8fc7\u62fc\u5199\u9519\u8bef\u3002\u8fd9\u7b97\u662f\u4e00\u79cd\u826f\u6027\u7684\u5386\u53f2\u6539\u5199\u3002</p>"},{"location":"vcs/git/git_04/#master","title":"\u5408\u5e76\u81f3 master \u5206\u652f","text":"<p>feature-C \u5206\u652f\u7684\u4f7f\u547d\u544a\u4e00\u6bb5\u843d\uff0c\u6211\u4eec\u5c06\u5b83\u4e0e master \u5206\u652f\u5408\u5e76\u3002</p> <p></p> <p>master \u5206\u652f\u6574\u5408\u4e86 feature-C \u5206\u652f\u3002\u5f00\u53d1\u8fdb\u5c55\u987a\u5229\u3002</p>"},{"location":"vcs/git/git_05/","title":"\u7b2c\u4e94\u7ae0 \u63a8\u9001\u81f3\u8fdc\u7a0b\u4ed3\u5e93","text":"<p>Git \u662f\u5206\u6563\u578b\u7248\u672c\u7ba1\u7406\u7cfb\u7edf\uff0c\u4f46\u6211\u4eec\u524d\u9762\u6240\u5b66\u4e60\u7684\uff0c \u90fd\u662f\u9488\u5bf9\u5355\u4e00 \u672c\u5730\u4ed3\u5e93\u7684\u64cd\u4f5c\u3002 \u4e0b\u9762\uff0c\u6211\u4eec\u5c06\u5f00\u59cb\u63a5\u89e6\u8fdc\u5728\u7f51\u7edc\u53e6\u4e00\u5934\u7684\u8fdc\u7a0b\u4ed3 \u5e93\u3002 \u8fdc\u7a0b\u4ed3\u5e93\u987e\u540d\u601d\u4e49\uff0c \u662f\u4e0e\u6211\u4eec\u672c\u5730\u4ed3\u5e93\u76f8\u5bf9\u72ec\u7acb\u7684\u53e6\u4e00\u4e2a\u4ed3\u5e93\u3002 \u8ba9\u6211\u4eec\u5148\u5728 GitHub \u4e0a\u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93\uff0c \u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u672c\u5730\u4ed3\u5e93\u7684\u8fdc\u7a0b\u4ed3\u5e93\u3002</p>"},{"location":"vcs/git/git_05/#git-remote-add","title":"git remote add \u2014\u2014 \u6dfb\u52a0\u8fdc\u7a0b\u4ed3\u5e93","text":"<p>\u5728 GitHub \u4e0a\u521b\u5efa\u7684\u4ed3\u5e93\u8def\u5f84\u4e3a \u201c git@github.com: \u7528\u6237\u540d / git-tutorial.git \u201d\u3002\u73b0\u5728\u6211\u4eec\u7528 git remote add \u547d\u4ee4\u5c06\u5b83\u8bbe\u7f6e\u6210\u672c\u5730\u4ed3\u5e93\u7684\u8fdc\u7a0b\u4ed3\u5e93\u3002</p> <p></p> <p>\u6309\u7167\u4e0a\u8ff0\u683c\u5f0f\u6267\u884c git remote add \u547d\u4ee4\u4e4b\u540e\uff0cGit \u4f1a\u81ea\u52a8\u5c06 git@github.com:github-book/git-tutorial.git \u8fdc\u7a0b\u4ed3\u5e93\u7684\u540d\u79f0\u8bbe\u7f6e\u4e3a origin\uff08\u6807\u8bc6\u7b26\uff09\u3002</p>"},{"location":"vcs/git/git_05/#git-push","title":"git push \u2014\u2014 \u63a8\u9001\u81f3\u8fdc\u7a0b\u4ed3\u5e93","text":""},{"location":"vcs/git/git_05/#master","title":"\u63a8\u9001\u81f3 master \u5206\u652f","text":"<p>\u5982\u679c\u60f3\u5c06\u5f53\u524d\u5206\u652f\u4e0b\u672c\u5730\u4ed3\u5e93\u4e2d\u7684\u5185\u5bb9\u63a8\u9001\u7ed9\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u9700\u8981\u7528\u5230 git push \u547d\u4ee4\u3002\u73b0\u5728\u5047\u5b9a\u6211\u4eec\u5728 master \u5206\u652f\u4e0b\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p></p> <p>\u50cf\u8fd9\u6837\u6267\u884c git push \u547d\u4ee4\uff0c\u5f53\u524d\u5206\u652f\u7684\u5185\u5bb9\u5c31\u4f1a\u88ab\u63a8\u9001\u7ed9\u8fdc\u7a0b\u4ed3\u5e93 origin \u7684 master \u5206\u652f\u3002 -u \u53c2\u6570\u53ef\u4ee5\u5728\u63a8\u9001\u7684\u540c\u65f6\uff0c\u5c06 origin \u4ed3\u5e93\u7684 master \u5206\u652f\u8bbe\u7f6e\u4e3a\u672c\u5730\u4ed3\u5e93\u5f53\u524d\u5206\u652f\u7684 upstream\uff08\u4e0a\u6e38\uff09\u3002\u6dfb\u52a0\u4e86\u8fd9\u4e2a\u53c2\u6570\uff0c\u5c06\u6765\u8fd0\u884c git pull \u547d\u4ee4\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u83b7\u53d6\u5185\u5bb9\u65f6\uff0c\u672c\u5730\u4ed3\u5e93\u7684\u8fd9\u4e2a\u5206\u652f\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece origin \u7684 master \u5206\u652f\u83b7\u53d6\u5185\u5bb9\uff0c\u7701\u53bb\u4e86\u53e6\u5916\u6dfb\u52a0\u53c2\u6570\u7684\u9ebb\u70e6\u3002</p> <p>\u6267\u884c\u8be5\u64cd\u4f5c\u540e\uff0c \u5f53\u524d\u672c\u5730\u4ed3\u5e93 master \u5206\u652f\u7684\u5185\u5bb9\u5c06\u4f1a\u88ab\u63a8\u9001\u5230 GitHub \u7684\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u3002\u5728 GitHub \u4e0a\u4e5f\u53ef\u4ee5\u786e\u8ba4\u8fdc\u7a0b master \u5206\u652f\u7684\u5185\u5bb9\u548c\u672c\u5730 master \u5206\u652f\u76f8\u540c\u3002</p>"},{"location":"vcs/git/git_05/#master_1","title":"\u63a8\u9001\u81f3 master \u4ee5\u5916\u7684\u5206\u652f","text":"<p>\u9664\u4e86 master \u5206\u652f\u4e4b\u5916\uff0c\u8fdc\u7a0b\u4ed3\u5e93\u4e5f\u53ef\u4ee5\u521b\u5efa\u5176\u4ed6\u5206\u652f\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u521b\u5efa feature-D \u5206\u652f\uff0c\u5e76\u5c06\u5b83\u4ee5\u540c\u540d\u5f62\u5f0f push \u81f3\u8fdc\u7a0b\u4ed3\u5e93\u3002</p> <p></p> <p>\u6211\u4eec\u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u521b\u5efa\u4e86 feature-D \u5206\u652f\uff0c\u73b0\u5728\u5c06\u5b83 push \u7ed9\u8fdc\u7a0b\u4ed3\u5e93\u5e76\u4fdd\u6301\u5206\u652f\u540d\u79f0\u4e0d\u53d8\u3002</p> <p></p> <p>\u73b0\u5728\uff0c\u5728\u8fdc\u7a0b\u4ed3\u5e93\u7684 GitHub \u9875\u9762\u5c31\u53ef\u4ee5\u67e5\u770b\u5230 feature-D \u5206\u652f\u4e86\u3002</p>"},{"location":"vcs/git/git_06/","title":"\u7b2c\u516d\u7ae0 \u4ece\u8fdc\u7a0b\u4ed3\u5e93\u83b7\u53d6","text":"<p>\u4e0a\u4e00\u8282\u4e2d\u6211\u4eec\u628a\u5728 GitHub \u4e0a\u65b0\u5efa\u7684\u4ed3\u5e93\u8bbe\u7f6e\u6210\u4e86\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5e76\u5411\u8fd9\u4e2a\u4ed3\u5e93 push \u4e86 feature-D \u5206\u652f\u3002\u73b0\u5728\uff0c\u6240\u6709\u80fd\u591f\u8bbf\u95ee\u8fd9\u4e2a\u8fdc\u7a0b\u4ed3\u5e93\u7684\u4eba\u90fd\u53ef\u4ee5\u83b7\u53d6 feature-D \u5206\u652f\u5e76\u52a0\u4ee5\u4fee\u6539\u3002</p> <p>\u672c\u8282\u4e2d\u6211\u4eec\u4ece\u5b9e\u9645\u5f00\u53d1\u8005\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u5728\u53e6\u4e00\u4e2a\u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a\u672c\u5730\u4ed3\u5e93\uff0c\u5b66\u4e60\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u83b7\u53d6\u5185\u5bb9\u7684\u76f8\u5173\u64cd\u4f5c\u3002\u8fd9\u5c31\u76f8\u5f53\u4e8e\u6211\u4eec\u521a\u521a\u6267 \u884c\u8fc7 push \u64cd\u4f5c\u7684\u76ee\u6807\u4ed3\u5e93\u53c8\u6709\u4e86\u53e6\u4e00\u540d\u65b0\u5f00\u53d1\u8005\u6765\u5171\u540c\u5f00\u53d1\u3002</p>"},{"location":"vcs/git/git_06/#git-clone","title":"git clone \u2014\u2014 \u83b7\u53d6\u8fdc\u7a0b\u4ed3\u5e93","text":""},{"location":"vcs/git/git_06/#_2","title":"\u83b7\u53d6\u8fdc\u7a0b\u4ed3\u5e93","text":"<p>\u9996\u5148\u6211\u4eec\u6362\u5230\u5176\u4ed6\u76ee\u5f55\u4e0b\uff0c\u5c06 GitHub \u4e0a\u7684\u4ed3\u5e93 clone \u5230\u672c\u5730\u3002\u6ce8\u610f\u4e0d\u8981\u4e0e\u4e4b\u524d\u64cd\u4f5c\u7684\u4ed3\u5e93\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\u3002</p> <p></p> <p>\u6267\u884c git clone \u547d\u4ee4\u540e\u6211\u4eec\u4f1a\u9ed8\u8ba4\u5904\u4e8e master \u5206\u652f\u4e0b\uff0c\u540c\u65f6\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5c06 origin \u8bbe\u7f6e\u6210\u8be5\u8fdc\u7a0b\u4ed3\u5e93\u7684\u6807\u8bc6\u7b26\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u524d\u672c\u5730\u4ed3\u5e93 \u7684 master \u5206\u652f\u4e0e GitHub \u7aef\u8fdc\u7a0b\u4ed3\u5e93\uff08origin\uff09\u7684 master \u5206\u652f\u5728\u5185\u5bb9\u4e0a\u662f\u5b8c\u5168\u76f8\u540c\u7684\u3002</p> <p></p> <p>\u6211\u4eec\u7528 git branch -a \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u5206\u652f\u7684\u76f8\u5173\u4fe1\u606f\u3002\u6dfb\u52a0\u53c2\u6570\u53ef\u4ee5\u540c\u65f6\u663e\u793a\u672c\u5730\u4ed3\u5e93\u548c\u8fdc\u7a0b\u4ed3\u5e93\u7684\u5206\u652f\u4fe1\u606f\u3002</p> <p>\u7ed3\u679c\u4e2d\u663e\u793a\u4e86 remotes/origin/feature-D\uff0c\u8bc1\u660e\u6211\u4eec\u7684\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u5df2\u7ecf\u6709\u4e86 feature-D \u5206\u652f\u3002</p>"},{"location":"vcs/git/git_06/#feature-d","title":"\u83b7\u53d6\u8fdc\u7a0b\u7684 feature-D \u5206\u652f","text":"<p>\u6211\u4eec\u8bd5\u7740\u5c06 feature-D \u5206\u652f\u83b7\u53d6\u81f3\u672c\u5730\u4ed3\u5e93\u3002</p> <p></p> <p>-b \u53c2\u6570\u7684\u540e\u9762\u662f\u672c\u5730\u4ed3\u5e93\u4e2d\u65b0\u5efa\u5206\u652f\u7684\u540d\u79f0\u3002 \u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c \u6211\u4eec\u4ecd\u5c06\u5176\u547d\u540d\u4e3a feature-D\uff0c\u8ba9\u5b83\u4e0e\u8fdc\u7a0b\u4ed3\u5e93\u7684\u5bf9\u5e94\u5206\u652f\u4fdd\u6301\u540c\u540d\u3002\u65b0\u5efa\u5206\u652f\u540d\u79f0\u540e\u9762\u662f\u83b7\u53d6\u6765\u6e90\u7684\u5206\u652f\u540d\u79f0\u3002\u4f8b\u5b50\u4e2d\u6307\u5b9a\u4e86 origin/feature-D\uff0c \u5c31\u662f\u8bf4\u4ee5\u540d\u4e3a origin \u7684\u4ed3\u5e93\uff08\u8fd9\u91cc\u6307 GitHub \u7aef\u7684\u4ed3\u5e93\uff09\u7684 feature-D \u5206\u652f\u4e3a\u6765\u6e90\uff0c\u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u521b\u5efa feature-D \u5206\u652f\u3002</p>"},{"location":"vcs/git/git_06/#feature-d_1","title":"\u5411\u672c\u5730\u7684 feature-D \u5206\u652f\u63d0\u4ea4\u66f4\u6539","text":"<p>\u73b0\u5728\u5047\u5b9a\u6211\u4eec\u662f\u53e6\u4e00\u540d\u5f00\u53d1\u8005\uff0c\u8981\u505a\u4e00\u4e2a\u65b0\u7684\u63d0\u4ea4\u3002\u5728 README. md \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u884c\u6587\u5b57\uff0c\u67e5\u770b\u66f4\u6539\u3002</p> <p></p> <p>\u6309\u7167\u4e4b\u524d\u5b66\u8fc7\u7684\u65b9\u5f0f\u63d0\u4ea4\u5373\u53ef\u3002</p> <p></p>"},{"location":"vcs/git/git_06/#feature-d_2","title":"\u63a8\u9001 feature-D \u5206\u652f","text":"<p>\u73b0\u5728\u6765\u63a8\u9001 feature-D \u5206\u652f\u3002</p> <p></p> <p>\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u83b7\u53d6 feature-D \u5206\u652f\uff0c \u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u63d0\u4ea4\u66f4\u6539\uff0c \u518d\u5c06 feature-D \u5206\u652f\u63a8\u9001\u56de\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u901a\u8fc7\u8fd9\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u4e0e\u5176\u4ed6\u5f00\u53d1\u8005\u76f8\u4e92\u5408\u4f5c\uff0c\u5171\u540c\u57f9\u80b2 feature-D \u5206\u652f\uff0c\u5b9e\u73b0\u67d0\u4e9b\u529f\u80fd\u3002</p>"},{"location":"vcs/git/git_06/#git-pull","title":"git pull \u2014\u2014 \u83b7\u53d6\u6700\u65b0\u7684\u8fdc\u7a0b\u4ed3\u5e93\u5206\u652f","text":"<p>\u73b0\u5728\u6211\u4eec\u653e\u4e0b\u521a\u521a\u64cd\u4f5c\u7684\u76ee\u5f55\uff0c\u56de\u5230\u539f\u5148\u7684\u90a3\u4e2a\u76ee\u5f55\u4e0b\u3002\u8fd9\u8fb9\u7684\u672c\u5730\u4ed3\u5e93\u4e2d\u53ea\u521b\u5efa\u4e86 feature-D \u5206\u652f\uff0c\u5e76\u6ca1\u6709\u5728 feature-D \u5206\u652f\u4e2d\u8fdb\u884c\u4efb\u4f55\u63d0\u4ea4\u3002\u7136\u800c\u8fdc\u7a0b\u4ed3\u5e93\u7684 feature-D \u5206\u652f\u4e2d\u5df2\u7ecf\u6709\u4e86\u6211\u4eec\u521a\u521a\u63a8\u9001\u7684\u63d0\u4ea4\u3002 \u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 git pull \u547d\u4ee4\uff0c\u5c06\u672c\u5730\u7684 feature-D \u5206\u652f\u66f4\u65b0\u5230\u6700\u65b0\u72b6\u6001\u3002\u5f53\u524d\u5206\u652f\u4e3a feature-D \u5206\u652f\u3002</p> <p></p> <p>GitHub \u7aef\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u7684 feature-D \u5206\u652f\u662f\u6700\u65b0\u72b6\u6001\uff0c\u6240\u4ee5\u672c\u5730\u4ed3\u5e93\u4e2d\u7684 feature-D \u5206\u652f\u5c31\u5f97\u5230\u4e86\u66f4\u65b0\u3002\u4eca\u540e\u53ea\u9700\u8981\u50cf\u5e73\u5e38\u4e00\u6837\u5728\u672c\u5730\u8fdb\u884c\u63d0\u4ea4\u518d push \u7ed9\u8fdc\u7a0b\u4ed3\u5e93\uff0c \u5c31\u53ef\u4ee5\u4e0e\u5176\u4ed6\u5f00\u53d1\u8005\u540c\u65f6\u5728\u540c\u4e00\u4e2a\u5206\u652f\u4e2d\u8fdb\u884c\u4f5c\u4e1a\uff0c\u4e0d\u65ad\u7ed9 feature-D \u589e\u52a0\u65b0\u529f\u80fd\u3002</p> <p>\u5982\u679c\u4e24\u4eba\u540c\u65f6\u4fee\u6539\u4e86\u540c\u4e00\u90e8\u5206\u7684\u6e90\u4ee3\u7801\uff0cpush \u65f6\u5c31\u5f88\u5bb9\u6613\u53d1\u751f\u51b2\u7a81\u3002\u6240\u4ee5\u591a\u540d\u5f00\u53d1\u8005\u5728\u540c\u4e00\u4e2a\u5206\u652f\u4e2d\u8fdb\u884c\u4f5c\u4e1a\u65f6\uff0c\u4e3a\u51cf\u5c11\u51b2\u7a81\u60c5\u51b5\u7684\u53d1 \u751f\uff0c\u5efa\u8bae\u66f4\u9891\u7e41\u5730\u8fdb\u884c push \u548c pull \u64cd\u4f5c\u3002</p>"},{"location":"vcs/maven/mv_01/","title":"\u7b2c1\u7ae0 \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528Maven","text":"<p>Maven \u662f\u5e72\u4ec0\u4e48\u7528\u7684\uff1f\u6211\u4eec\u5148\u901a\u8fc7\u4f01\u4e1a\u5f00\u53d1\u4e2d\u7684\u5b9e\u9645\u9700\u6c42\u6765\u770b\u4e00\u770b\u54ea\u4e9b\u65b9\u9762\u662f\u6211\u4eec\u73b0\u6709\u6280\u672f\u7684\u4e0d\u8db3\u3002</p>"},{"location":"vcs/maven/mv_01/#11-jar","title":"1.1 \u7b2c\u4e09\u65b9Jar\u5305\u6dfb\u52a0","text":"<p>\u5728\u4eca\u5929\u7684 JavaEE \u5f00\u53d1\u9886\u57df\uff0c\u6709\u5927\u91cf\u7684\u7b2c\u4e09\u65b9\u6846\u67b6\u548c\u5de5\u5177\u53ef\u4ee5\u4f9b\u6211\u4eec\u4f7f\u7528\u3002\u8981\u4f7f\u7528\u8fd9\u4e9b jar \u5305\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u590d\u5236\u7c98\u8d34\u5230 WEB-INF \u76ee\u5f55\u4e0b\u7684 lib \u76ee\u5f55\u4e0b\u3002\u4f46\u662f\u8fd9\u4f1a\u5bfc\u81f4\u6bcf\u6b21\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5de5\u7a0b\u5c31\u9700\u8981\u5c06 jar \u5305\u91cd\u590d\u590d\u5236\u5230 lib \u76ee\u5f55\u4e0b\uff0c\u4ece\u800c\u9020\u6210\u5de5\u4f5c\u533a\u4e2d\u5b58\u5728\u5927\u91cf\u91cd\u590d\u7684\u6587\u4ef6\u3002</p> <p>\u800c\u4f7f\u7528 Maven \u540e\u6bcf\u4e2a jar \u5305\u53ea\u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u4fdd\u5b58\u4e00\u4efd\uff0c\u9700\u8981 jar \u5305\u7684\u5de5\u7a0b\u53ea\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u6587\u672c\u5f62\u5f0f\u7684 jar \u5305\u7684\u5f15\u7528\u2014\u2014\u6211\u4eec\u79f0\u4e4b\u4e3a\u201c\u5750\u6807\u201d\u3002\u4e0d\u4ec5\u6781\u5927\u7684\u8282\u7ea6\u4e86\u5b58\u50a8\u7a7a\u95f4\uff0c\u66f4\u907f\u514d\u4e86\u91cd\u590d\u6587\u4ef6\u592a\u591a\u800c\u9020\u6210\u7684\u6df7\u4e71\u3002</p>"},{"location":"vcs/maven/mv_01/#12-jar","title":"1.2 \u7b2c\u4e09\u65b9Jar\u5305\u83b7\u53d6","text":"<p>JavaEE \u5f00\u53d1\u4e2d\u9700\u8981\u4f7f\u7528\u5230\u7684 jar \u5305\u79cd\u7c7b\u7e41\u591a\uff0c\u51e0\u4e4e\u6bcf\u4e2a jar \u5305\u5728\u5176\u672c\u8eab\u7684\u5b98\u7f51\u4e0a\u7684\u83b7\u53d6\u65b9\u5f0f\u90fd\u4e0d\u5c3d\u76f8\u540c\u3002\u4e3a\u4e86\u67e5\u627e\u4e00\u4e2a jar \u5305\u627e\u904d\u4e92\u8054\u7f51\uff0c\u8eab\u5fc3\u4ff1\u75b2\uff0c\u6ca1\u6709\u7ecf\u5386\u8fc7\u7684\u4eba\u6216\u8bb8\u4f53\u4f1a\u4e0d\u5230\u8fd9\u79cd\u6298\u78e8\u3002\u4e0d\u4ec5\u5982\u6b64\uff0c\u8d39\u52b2\u5fc3\u8840\u627e\u7684 jar \u5305\u91cc\u6709\u7684\u65f6\u5019\u5e76\u6ca1\u6709\u4f60\u9700\u8981\u7684\u90a3\u4e2a\u7c7b\uff0c\u53c8\u6216\u8005\u6709\u540c\u540d\u7684\u7c7b\u6ca1\u6709\u4f60\u8981\u7684\u65b9\u6cd5\u2014\u2014\u4ee5\u4e0d\u89c4\u8303\u7684\u65b9\u5f0f\u83b7\u53d6\u7684 jar \u5305\u4e5f\u5f80\u5f80\u662f\u4e0d\u89c4\u8303\u7684\u3002</p> <p>\u4f7f\u7528 Maven \u6211\u4eec\u53ef\u4ee5\u4eab\u53d7\u5230\u4e00\u4e2a\u5b8c\u5168\u7edf\u4e00\u89c4\u8303\u7684 jar \u5305\u7ba1\u7406\u4f53\u7cfb\u3002\u4f60\u53ea\u9700\u8981\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u4ee5\u5750\u6807\u7684\u65b9\u5f0f\u4f9d\u8d56\u4e00\u4e2a jar \u5305\uff0cMaven \u5c31\u4f1a\u81ea\u52a8\u4ece\u4e2d\u592e\u4ed3\u5e93\u8fdb\u884c\u4e0b\u8f7d\uff0c\u5e76\u540c\u65f6\u4e0b\u8f7d\u8fd9\u4e2a jar \u5305\u6240\u4f9d\u8d56\u7684\u5176\u4ed6 jar \u5305\u2014\u2014\u89c4\u8303\u3001\u5b8c\u6574\u3001\u51c6\u786e\uff01\u4e00\u6b21\u6027\u89e3\u51b3\u6240\u6709\u95ee\u9898\uff01</p>"},{"location":"vcs/maven/mv_01/#13-jar","title":"1.3 Jar\u5305\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb","text":"<p>jar \u5305\u5f80\u5f80\u4e0d\u662f\u5b64\u7acb\u5b58\u5728\u7684\uff0c\u5f88\u591a jar \u5305\u90fd\u9700\u8981\u5728\u5176\u4ed6 jar \u5305\u7684\u652f\u6301\u4e0b\u624d\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a jar \u5305\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u3002\u6700\u5178\u578b\u7684\u4f8b\u5b50\u662f\uff1acommons-fileupload-1.3.jar \u4f9d\u8d56\u4e8e commons-io-2.0.1.jar\uff0c\u5982\u679c\u6ca1\u6709 IO \u5305\uff0cFileUpload \u5305\u5c31\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u4f60\u77e5\u9053\u4f60\u6240\u4f7f\u7528\u7684\u6240\u6709 jar \u5305\u7684\u4f9d\u8d56\u5173\u7cfb\u5417\uff1f\u5f53\u4f60\u62ff\u5230\u4e00\u4e2a\u65b0\u7684\u4ece\u672a\u4f7f\u7528\u8fc7\u7684 jar \u5305\uff0c\u4f60\u5982\u4f55\u5f97\u77e5\u4ed6\u9700\u8981\u54ea\u4e9b jar \u5305\u7684\u652f\u6301\u5462\uff1f\u5982\u679c\u4e0d\u4e86\u89e3\u8fd9\u4e2a\u60c5\u51b5\uff0c\u5bfc\u5165\u7684 jar \u5305\u4e0d\u591f\uff0c\u90a3\u4e48\u73b0\u6709\u7684\u7a0b\u5e8f\u5c06\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002\u518d\u8fdb\u4e00\u6b65\uff0c\u5f53\u4f60\u7684\u9879\u76ee\u4e2d\u9700\u8981\u7528\u5230\u4e0a\u767e\u4e2a jar \u5305\u65f6\uff0c\u4f60\u8fd8\u4f1a\u4eba\u4e3a\u7684\uff0c\u624b\u5de5\u7684\u9010\u4e00\u786e\u8ba4\u5b83\u4eec\u4f9d\u8d56\u7684\u5176\u4ed6 jar \u5305\u5417\uff1f\u8fd9\u7b80\u76f4\u662f\u4e0d\u53ef\u60f3\u8c61\u7684\u3002</p> <p>\u800c\u5f15\u5165 Maven \u540e\uff0cMaven \u5c31\u53ef\u4ee5\u66ff\u6211\u4eec\u81ea\u52a8\u7684\u5c06\u5f53\u524d jar \u5305\u6240\u4f9d\u8d56\u7684\u5176\u4ed6\u6240\u6709 jar \u5305\u5168\u90e8\u5bfc\u5165\u8fdb\u6765\uff0c\u65e0\u9700\u4eba\u5de5\u53c2\u4e0e\uff0c\u8282\u7ea6\u4e86\u6211\u4eec\u5927\u91cf\u7684\u65f6\u95f4\u548c\u7cbe\u529b\u3002\u7528\u5b9e\u9645\u4f8b\u5b50\u6765\u8bf4\u660e\u5c31\u662f\uff1a\u901a\u8fc7 Maven \u5bfc\u5165 commons-fileupload-1.3.jar \u540e\uff0ccommons-io-2.0.1.jar \u4f1a\u88ab\u81ea\u52a8\u5bfc\u5165\uff0c\u7a0b\u5e8f\u5458\u4e0d\u5fc5\u4e86\u89e3\u8fd9\u4e2a\u4f9d\u8d56\u5173\u7cfb\u3002</p>"},{"location":"vcs/maven/mv_01/#14-jar","title":"1.4 Jar\u5305\u4e4b\u95f4\u7684\u51b2\u7a81\u5904\u7406","text":"<p>\u4e0a\u4e00\u70b9\u8bf4\u7684\u662f jar \u5305\u4e0d\u8db3\u9879\u76ee\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u4f46\u5176\u5b9e\u6709\u7684\u65f6\u5019 jar \u5305\u591a\u4e86\u9879\u76ee\u4ecd\u7136\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u8fd9\u5c31\u662f jar \u5305\u4e4b\u95f4\u7684\u51b2\u7a81\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u6211\u4eec\u73b0\u5728\u6709\u4e09\u4e2a\u5de5\u7a0b MakeFriend\u3001HelloFriend \u548c Hello\u3002MakeFriend \u4f9d\u8d56 HelloFriend\uff0cHelloFriend \u4f9d\u8d56 Hello\u3002\u800c Hello \u4f9d\u8d56 log4j.1.2.17.jar\uff0cHelloFriend \u4f9d\u8d56 log4j.1.2.14.jar\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u90a3\u4e48 MakeFriend \u5de5\u7a0b\u7684\u8fd0\u884c\u65f6\u73af\u5883\u4e2d\u8be5\u5bfc\u5165 log4j.1.2.14.jar \u5462\u8fd8\u662f log4j.1.2.17.jar \u5462\uff1f</p> <p>\u8fd9\u6837\u7684\u95ee\u9898\u4e00\u4e2a\u4e24\u4e2a\u8fd8\u53ef\u4ee5\u624b\u5de5\u89e3\u51b3\uff0c\u4f46\u5982\u679c\u7cfb\u7edf\u4e2d\u5b58\u5728\u51e0\u5341\u4e0a\u767e\u7684 jar \u5305\uff0c\u4ed6\u4eec\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u4f1a\u975e\u5e38\u590d\u6742\uff0c\u51e0\u4e4e\u4e0d\u53ef\u80fd\u624b\u5de5\u5b9e\u73b0\u4f9d\u8d56\u5173\u7cfb\u7684\u68b3\u7406\u3002</p> <p>\u4f7f\u7528 Maven \u5c31\u53ef\u4ee5\u81ea\u52a8\u7684\u5904\u7406 jar \u5305\u4e4b\u95f4\u7684\u51b2\u7a81\u95ee\u9898\u3002\u56e0\u4e3a Maven \u4e2d\u5185\u7f6e\u4e86\u4e24\u6761\u4f9d\u8d56\u539f\u5219\uff1a\u6700\u77ed\u8def\u5f84\u8005\u4f18\u5148\u548c\u5148\u58f0\u660e\u8005\u4f18\u5148\uff0c\u4e0a\u8ff0\u95ee\u9898 MakeFriend \u5de5\u7a0b\u4f1a\u81ea\u52a8\u4f7f\u7528 log4j.1.2.14.jar\u3002</p>"},{"location":"vcs/maven/mv_01/#15","title":"1.5 \u5c06\u9879\u76ee\u62c6\u5206\u6210\u591a\u4e2a\u5de5\u7a0b\u6a21\u5757\uff08\u4e86\u89e3\uff09","text":"<p>\u968f\u7740 JavaEE \u9879\u76ee\u7684\u89c4\u6a21\u8d8a\u6765\u8d8a\u5e9e\u5927\uff0c\u5f00\u53d1\u56e2\u961f\u7684\u89c4\u6a21\u4e5f\u4e0e\u65e5\u4ff1\u589e\u3002\u4e00\u4e2a\u9879\u76ee\u4e0a\u5343\u4eba\u7684\u56e2\u961f\u6301\u7eed\u5f00\u53d1\u5f88\u591a\u5e74\u5bf9\u4e8e JavaEE \u9879\u76ee\u6765\u8bf4\u518d\u6b63\u5e38\u4e0d\u8fc7\u3002\u90a3\u4e48\u6211\u4eec\u60f3\u8c61\u4e00\u4e0b\uff1a\u51e0\u767e\u4e0a\u5343\u7684\u4eba\u5f00\u53d1\u7684\u9879\u76ee\u662f\u540c\u4e00\u4e2a Web \u5de5\u7a0b\u3002\u90a3\u4e48\u67b6\u6784\u5e08\u3001\u9879\u76ee\u7ecf\u7406\u8be5\u5982\u4f55\u5212\u5206\u9879\u76ee\u7684\u6a21\u5757\u3001\u5982\u4f55\u5206\u5de5\u5462\uff1f\u8fd9\u4e48\u5927\u7684\u9879\u76ee\u5df2\u7ecf\u4e0d\u53ef\u80fd\u901a\u8fc7 package \u7ed3\u6784\u6765\u5212\u5206\u6a21\u5757\uff0c\u5fc5\u987b\u5c06\u9879\u76ee\u62c6\u5206\u6210\u591a\u4e2a\u5de5\u7a0b\u534f\u540c\u5f00\u53d1\u3002\u591a\u4e2a\u6a21\u5757\u5de5\u7a0b\u4e2d\u6709\u7684\u662f Java \u5de5\u7a0b\uff0c\u6709\u7684\u662f Web \u5de5\u7a0b\u3002</p> <p>\u90a3\u4e48\u5de5\u7a0b\u62c6\u5206\u540e\u53c8\u5982\u4f55\u8fdb\u884c\u4e92\u76f8\u8c03\u7528\u548c\u8bbf\u95ee\u5462\uff1f\u8fd9\u5c31\u9700\u8981\u7528\u5230 Maven \u7684\u4f9d\u8d56\u7ba1\u7406\u673a\u5236\u3002\u4f8b\u5982\uff1a\u67d0\u9879\u76ee\u62c6\u5206\u7684\u60c5\u51b5\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u5c42\u6a21\u5757\u4f9d\u8d56\u4e0b\u5c42\uff0c\u6240\u4ee5\u4e0b\u5c42\u6a21\u5757\u4e2d\u5b9a\u4e49\u7684 API \u90fd\u53ef\u4ee5\u4e3a\u4e0a\u5c42\u6240\u8c03\u7528\u548c\u8bbf\u95ee\u3002</p>"},{"location":"vcs/maven/mv_01/#16","title":"1.6 \u5b9e\u73b0\u9879\u76ee\u7684\u5206\u5e03\u5f0f\u90e8\u7f72\uff08\u4e86\u89e3\uff09","text":"<p>\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u9879\u76ee\u89c4\u6a21\u589e\u52a0\u5230\u4e00\u5b9a\u7a0b\u5ea6\u540e\uff0c\u53ef\u80fd\u6bcf\u4e2a\u6a21\u5757\u90fd\u9700\u8981\u8fd0\u884c\u5728\u72ec\u7acb\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u8fd9\u91cc\u540c\u6837\u9700\u8981\u7528\u5230 Maven\u3002</p> <p></p>"},{"location":"vcs/maven/mv_02/","title":"\u7b2c2\u7ae0 Maven\u662f\u4ec0\u4e48\uff1f","text":"<p>\u5982\u679c\u4e0a\u9762\u7684\u63cf\u8ff0\u80fd\u591f\u4f7f\u4f60\u8ba4\u8bc6\u5230\u4f7f\u7528 Maven \u662f\u591a\u4e48\u7684\u91cd\u8981\uff0c\u6211\u4eec\u4e0b\u9762\u5c31\u6765\u4ecb\u7ecd\u4e00\u4e0b Maven \u662f\u4ec0\u4e48\u3002</p>"},{"location":"vcs/maven/mv_02/#21","title":"2.1 \u81ea\u52a8\u5316\u6784\u5efa\u5de5\u5177","text":"<p>\uff081\uff09Maven \u8fd9\u4e2a\u5355\u8bcd\u7684\u672c\u610f\u662f\uff1a\u4e13\u5bb6\uff0c\u5185\u884c\u3002\u8bfb\u97f3\u662f <code>['me\u026av(\u0259)n]</code> \u6216 <code>['mevn]</code>\uff0c\u4e0d\u8981\u8bfb\u4f5c\u201c\u5988\u6587\u201d\u3002</p> <p>\uff082\uff09Maven \u662f\u4e00\u6b3e\u81ea\u52a8\u5316\u6784\u5efa\u5de5\u5177\uff0c\u4e13\u6ce8\u670d\u52a1\u4e8e Java \u5e73\u53f0\u7684\u9879\u76ee\u6784\u5efa\u548c\u4f9d\u8d56\u7ba1\u7406\u3002\u5728 JavaEE \u5f00\u53d1\u7684\u5386\u53f2\u4e0a\u6784\u5efa\u5de5\u5177\u7684\u53d1\u5c55\u4e5f\u7ecf\u5386\u4e86\u4e00\u7cfb\u5217\u7684\u6f14\u5316\u548c\u53d8\u8fc1\uff1aMake\u2192Ant\u2192Maven\u2192Gradle\u2192\u5176\u4ed6\u2026\u2026</p>"},{"location":"vcs/maven/mv_02/#22","title":"2.2 \u6784\u5efa\u7684\u6982\u5ff5","text":"<p>\u6784\u5efa\u5e76\u4e0d\u662f\u521b\u5efa\uff0c\u521b\u5efa\u4e00\u4e2a\u5de5\u7a0b\u5e76\u4e0d\u7b49\u4e8e\u6784\u5efa\u4e00\u4e2a\u9879\u76ee\u3002\u8981\u4e86\u89e3\u6784\u5efa\u7684\u542b\u4e49\u6211\u4eec\u5e94\u8be5\u7531\u6d45\u5165\u6df1\u7684\u4ece\u4ee5\u4e0b\u4e09\u4e2a\u5c42\u9762\u6765\u770b\uff1a</p> <p>\uff081\uff09\u7eaf Java \u4ee3\u7801</p> <p>\u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u6211\u4eec Java \u662f\u4e00\u95e8\u7f16\u8bd1\u578b\u8bed\u8a00\uff0c.java \u6269\u5c55\u540d\u7684\u6e90\u6587\u4ef6\u9700\u8981\u7f16\u8bd1\u6210 .class \u6269\u5c55\u540d\u7684\u5b57\u8282\u7801\u6587\u4ef6\u624d\u80fd\u591f\u6267\u884c\u3002\u6240\u4ee5\u7f16\u5199\u4efb\u4f55 Java \u4ee3\u7801\u60f3\u8981\u6267\u884c\u7684\u8bdd\u5c31\u5fc5\u987b\u7ecf\u8fc7\u7f16\u8bd1\u5f97\u5230\u5bf9\u5e94\u7684 .class \u6587\u4ef6\u3002</p> <p>\uff082\uff09Web \u5de5\u7a0b</p> <p>\u5f53\u6211\u4eec\u9700\u8981\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee Java \u7a0b\u5e8f\u65f6\u5c31\u5fc5\u987b\u5c06\u5305\u542b Java \u7a0b\u5e8f\u7684 Web \u5de5\u7a0b\u7f16\u8bd1\u7684\u7ed3\u679c\u201c\u62ff\u201d\u5230\u670d\u52a1\u5668\u4e0a\u7684\u6307\u5b9a\u76ee\u5f55\u4e0b\uff0c\u5e76\u542f\u52a8\u670d\u52a1\u5668\u624d\u884c\u3002\u8fd9\u4e2a\u201c\u62ff\u201d\u7684\u8fc7\u7a0b\u6211\u4eec\u53eb\u90e8\u7f72\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u672a\u7f16\u8bd1\u7684 Web \u5de5\u7a0b\u6bd4\u55bb\u4e3a\u4e00\u53ea\u751f\u7684\u9e21\uff0c\u7f16\u8bd1\u597d\u7684 Web \u5de5\u7a0b\u662f\u4e00\u53ea\u716e\u719f\u7684\u9e21\uff0c\u7f16\u8bd1\u90e8\u7f72\u7684\u8fc7\u7a0b\u5c31\u662f\u5c06\u9e21\u7096\u719f\u3002</p> <p>Web \u5de5\u7a0b\u548c\u5176\u7f16\u8bd1\u7ed3\u679c\u7684\u76ee\u5f55\u7ed3\u6784\u5bf9\u6bd4\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <p>\uff083\uff09\u5b9e\u9645\u9879\u76ee</p> <p>\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u6574\u5408\u7b2c\u4e09\u65b9\u6846\u67b6\uff0cWeb \u5de5\u7a0b\u4e2d\u9664\u4e86 Java \u7a0b\u5e8f\u548c JSP \u9875\u9762\u3001\u56fe\u7247\u7b49\u9759\u6001\u8d44\u6e90\u4e4b\u5916\uff0c\u8fd8\u5305\u62ec\u7b2c\u4e09\u65b9\u6846\u67b6\u7684 jar \u5305\u4ee5\u53ca\u5404\u79cd\u5404\u6837\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u6240\u6709\u8fd9\u4e9b\u8d44\u6e90\u90fd\u5fc5\u987b\u6309\u7167\u6b63\u786e\u7684\u76ee\u5f55\u7ed3\u6784\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u9879\u76ee\u624d\u53ef\u4ee5\u8fd0\u884c\u3002</p> <p>\u6240\u4ee5\u7efc\u4e0a\u6240\u8ff0\uff1a\u6784\u5efa\u5c31\u662f\u4ee5\u6211\u4eec\u7f16\u5199\u7684 Java \u4ee3\u7801\u3001\u6846\u67b6\u914d\u7f6e\u6587\u4ef6\u3001\u56fd\u9645\u5316\u7b49\u5176\u4ed6\u8d44\u6e90\u6587\u4ef6\u3001JSP \u9875\u9762\u548c\u56fe\u7247\u7b49\u9759\u6001\u8d44\u6e90\u4f5c\u4e3a\u201c\u539f\u6750\u6599\u201d\uff0c\u53bb\u201c\u751f\u4ea7\u201d\u51fa\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u7684\u9879\u76ee\u7684\u8fc7\u7a0b\u3002</p> <p>\u90a3\u4e48\u9879\u76ee\u6784\u5efa\u7684\u5168\u8fc7\u7a0b\u4e2d\u90fd\u5305\u542b\u54ea\u4e9b\u73af\u8282\u5462\uff1f</p>"},{"location":"vcs/maven/mv_02/#23","title":"2.3 \u6784\u5efa\u73af\u8282","text":"<p>\uff081\uff09\u6e05\u7406\uff1a\u5220\u9664\u4ee5\u524d\u7684\u7f16\u8bd1\u7ed3\u679c\uff0c\u4e3a\u91cd\u65b0\u7f16\u8bd1\u505a\u597d\u51c6\u5907\u3002</p> <p>\uff082\uff09\u7f16\u8bd1\uff1a\u5c06 Java \u6e90\u7a0b\u5e8f\u7f16\u8bd1\u4e3a\u5b57\u8282\u7801\u6587\u4ef6\u3002</p> <p>\uff083\uff09\u6d4b\u8bd5\uff1a\u9488\u5bf9\u9879\u76ee\u4e2d\u7684\u5173\u952e\u70b9\u8fdb\u884c\u6d4b\u8bd5\uff0c\u786e\u4fdd\u9879\u76ee\u5728\u8fed\u4ee3\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5173\u952e\u70b9\u7684\u6b63\u786e\u6027\u3002</p> <p>\uff084\uff09\u62a5\u544a\uff1a\u5728\u6bcf\u4e00\u6b21\u6d4b\u8bd5\u540e\u4ee5\u6807\u51c6\u7684\u683c\u5f0f\u8bb0\u5f55\u548c\u5c55\u793a\u6d4b\u8bd5\u7ed3\u679c\u3002</p> <p>\uff085\uff09\u6253\u5305\uff1a\u5c06\u4e00\u4e2a\u5305\u542b\u8bf8\u591a\u6587\u4ef6\u7684\u5de5\u7a0b\u5c01\u88c5\u4e3a\u4e00\u4e2a\u538b\u7f29\u6587\u4ef6\u7528\u4e8e\u5b89\u88c5\u6216\u90e8\u7f72\u3002Java \u5de5\u7a0b\u5bf9\u5e94 jar \u5305\uff0cWeb \u5de5\u7a0b\u5bf9\u5e94 war \u5305\u3002</p> <p>\uff086\uff09\u5b89\u88c5\uff1a\u5728 Maven \u73af\u5883\u4e0b\u7279\u6307\u5c06\u6253\u5305\u7684\u7ed3\u679c\u2014\u2014jar \u5305\u6216 war \u5305\u5b89\u88c5\u5230\u672c\u5730\u4ed3\u5e93\u4e2d\u3002</p> <p>\uff087\uff09\u90e8\u7f72\uff1a\u5c06\u6253\u5305\u7684\u7ed3\u679c\u90e8\u7f72\u5230\u8fdc\u7a0b\u4ed3\u5e93\u6216\u5c06 war \u5305\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u3002</p>"},{"location":"vcs/maven/mv_02/#24","title":"2.4 \u81ea\u52a8\u5316\u6784\u5efa","text":"<p>\u5176\u5b9e\u4e0a\u8ff0\u73af\u8282\u6211\u4eec\u5728 IDEA \u4e2d\u90fd\u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u53ea\u662f\u4e0d\u592a\u6807\u51c6\u3002\u90a3\u4e48\u65e2\u7136 IDE \u5df2\u7ecf\u53ef\u4ee5\u8fdb\u884c\u6784\u5efa\u4e86\u6211\u4eec\u4e3a\u4ec0\u4e48\u8fd8\u8981\u4f7f\u7528 Maven \u8fd9\u6837\u7684\u6784\u5efa\u5de5\u5177\u5462\uff1f\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5c0f\u6545\u4e8b\uff1a</p> <p>\u8fd9\u662f\u9633\u5149\u660e\u5a9a\u7684\u4e00\u5929\u3002\u6258\u9a6c\u65af\u5411\u5f80\u5e38\u4e00\u6837\u65e9\u65e9\u7684\u6765\u5230\u4e86\u516c\u53f8\uff0c\u51b2\u597d\u4e00\u676f\u5496\u5561\uff0c\u8fdb\u5165\u4e86\u81ea\u5df1\u7684\u90ae\u7bb1\u2014\u2014\u5f88\u4e0d\u5e78\uff0cQA\u5c0f\u7ec4\u53d1\u6765\u4e86\u4e00\u5c01\u90ae\u4ef6\uff0c\u62a5\u544a\u4e86\u4ed6\u6628\u5929\u63d0\u4ea4\u7684\u6a21\u5757\u7684\u6d4b\u8bd5\u7ed3\u679c\u2014\u2014\u6709BUG\u3002\u201c\u597d\u5427\uff0c\u53cd\u6b63\u4e5f\u4e0d\u662f\u7b2c\u4e00\u6b21\u201d\uff0c\u6258\u9a6c\u65af\u6447\u6447\u5934\uff0c\u8fdb\u5165IDE\uff0c\u8fd0\u884c\u81ea\u5df1\u7684\u7a0b\u5e8f\uff0c\u7f16\u8bd1\u3001\u6253\u5305\u3001\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u7136\u540e\u6309\u7167\u90ae\u4ef6\u4e2d\u7684\u64cd\u4f5c\u8def\u5f84\u8fdb\u884c\u6d4b\u8bd5\u3002\u201c\u55ef\uff0c\u6ca1\u9519\uff0c\u8fd9\u4e2a\u5730\u65b9\u786e\u5b9e\u6709\u95ee\u9898\u201d\uff0c\u6258\u9a6c\u65af\u8bf4\u9053\u3002\u4e8e\u662f\u6258\u9a6c\u65af\u5f00\u59cb\u5c1d\u8bd5\u4fee\u590d\u8fd9\u4e2aBUG\uff0c\u5f53\u4ed6\u5dee\u4e0d\u591a\u6709\u7709\u76ee\u7684\u65f6\u5019\u5df2\u7ecf\u5230\u4e86\u5348\u996d\u65f6\u95f4\u3002</p> <p>\u4e0b\u5348\u7ee7\u7eed\u5de5\u4f5c\u3002BUG\u5f88\u5feb\u88ab\u4fee\u6b63\u4e86\uff0c\u63a5\u7740\u6258\u9a6c\u65af\u5bf9\u6a21\u5757\u91cd\u65b0\u8fdb\u884c\u4e86\u7f16\u8bd1\u3001\u6253\u5305\u3001\u90e8\u7f72\uff0c\u6d4b\u8bd5\u4e4b\u540e\u786e\u8ba4\u6ca1\u6709\u95ee\u9898\u4e86\uff0c\u56de\u590d\u4e86QA\u5c0f\u7ec4\u7684\u90ae\u4ef6\u3002</p> <p>\u4e00\u5929\u5c31\u8fd9\u6837\u8fc7\u53bb\u4e86\uff0c</p> <p>\u660e\u5a9a\u7684\u9633\u5149\u5316\u4f5c\u4e86\u7f8e\u4e3d\u7684\u665a\u971e\uff0c</p> <p>\u6258\u9a6c\u65af\u5374\u89c9\u5f97\u751f\u6d3b\u5e76\u4e0d\u50cf\u665a\u971e\u90a3\u6837\u7f8e\u597d\u554a\u3002</p> <p>\u8ba9\u6211\u4eec\u6765\u68b3\u7406\u4e00\u4e0b\u6258\u9a6c\u65af\u8fd9\u4e00\u5929\u4e2d\u7684\u5de5\u4f5c\u5185\u5bb9\u3002</p> <p></p> <p>\u4ece\u4e2d\u6211\u4eec\u53d1\u73b0\uff0c\u6258\u9a6c\u65af\u7684\u5f88\u5927\u4e00\u90e8\u5206\u65f6\u95f4\u82b1\u5728\u4e86\u201c\u7f16\u8bd1\u3001\u6253\u5305\u3001\u90e8\u7f72\u3001\u6d4b\u8bd5\u201d\u8fd9\u4e9b\u7a0b\u5f0f\u5316\u7684\u5de5\u4f5c\u4e0a\u9762\uff0c\u800c\u771f\u6b63\u9700\u8981\u7531\u201c\u4eba\u201d\u7684\u667a\u6167\u5b9e\u73b0\u7684\u5206\u6790\u95ee\u9898\u548c\u7f16\u7801\u5374\u53ea\u5360\u4e86\u5f88\u5c11\u4e00\u90e8\u5206\u3002</p> <p></p> <p>\u80fd\u5426\u5c06\u8fd9\u4e9b\u7a0b\u5f0f\u5316\u7684\u5de5\u4f5c\u4ea4\u7ed9\u673a\u5668\u81ea\u52a8\u5b8c\u6210\u5462\uff1f\u2014\u2014\u5f53\u7136\u53ef\u4ee5\uff01\u8fd9\u5c31\u662f\u81ea\u52a8\u5316\u6784\u5efa\u3002</p> <p></p> <p>\u90a3\u4e48 Maven \u53c8\u662f\u5982\u4f55\u5b9e\u73b0\u81ea\u52a8\u5316\u6784\u5efa\u7684\u5462\uff1f\u7b80\u5355\u7684\u8bf4\u6765\u5c31\u662f\u5b83\u53ef\u4ee5\u81ea\u52a8\u7684\u4ece\u6784\u5efa\u8fc7\u7a0b\u7684\u8d77\u70b9\u4e00\u76f4\u6267\u884c\u5230\u7ec8\u70b9\uff1a</p> <p></p>"},{"location":"vcs/maven/mv_03/","title":"\u7b2c3\u7ae0 Maven\u5982\u4f55\u4f7f\u7528","text":"<p>\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u6765\u770b\u770b Maven \u6838\u5fc3\u7a0b\u5e8f\u7684\u5b89\u88c5\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5fc5\u8981\u8bbe\u7f6e\u3002\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u7f16\u5199\u7b2c\u4e00\u4e2a Maven \u7a0b\u5e8f\u4e86\u3002</p>"},{"location":"vcs/maven/mv_03/#31-maven","title":"3.1 \u5b89\u88c5Maven\u6838\u5fc3\u7a0b\u5e8f","text":"<p>1\uff09\u68c0\u67e5 JAVA_HOME \u73af\u5883\u53d8\u91cf\u3002Maven \u662f\u4f7f\u7528 Java \u5f00\u53d1\u7684\uff0c\u6240\u4ee5\u5fc5\u987b\u77e5\u9053\u5f53\u524d\u7cfb\u7edf\u73af\u5883\u4e2d JDK \u7684\u5b89\u88c5\u76ee\u5f55\u3002</p> <pre><code>echo %JAVA_HOME%\nD:\\MyWork\\Program\\jdk1.8.0_211\n</code></pre> <p>2\uff09\u89e3\u538b Maven \u7684\u6838\u5fc3\u7a0b\u5e8f\u3002\u5c06 apache-maven-3.5.4-bin.zip \u89e3\u538b\u5230\u4e00\u4e2a\u975e\u4e2d\u6587\u65e0\u7a7a\u683c\u7684\u76ee\u5f55\u4e0b\u3002\u4f8b\u5982\uff1a</p> <pre><code>D:\\develop\\Maven\\apache-maven-3.5.4\n</code></pre> <p>3\uff09\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u3002</p> <p></p> <p>\uff081\uff09\u5728\u7cfb\u7edf\u53d8\u91cf\u91cc\u9762\u521b\u5efa MAVEN_HOME \u53d8\u91cf\uff0c\u5e76\u8d4b\u503c</p> <pre><code>\u53d8\u91cf\uff1aMAVEN_HOME\n\u503c\uff1aD:\\develop\\Maven\\apache-maven-3.5.4\n</code></pre> <p>\uff082\uff09\u5728 Path \u53d8\u91cf\u4e2d\uff0c\u6dfb\u52a0 maven \u73af\u5883\u53d8\u91cf</p> <pre><code>\u53d8\u91cf\uff1aPath\n\u503c\uff1a%MAVEN_HOME%\\bin\u6216D:\\develop\\Maven\\apache-maven-3.5.4\\bin\n</code></pre> <p>4\uff09\u67e5\u770b Maven \u7248\u672c\u4fe1\u606f\u9a8c\u8bc1\u5b89\u88c5\u662f\u5426\u6b63\u786e</p> <p>\uff081\uff09\u6309 ++Win +R++\uff0c\u8fdb\u5165\u7535\u8111\u8fd0\u884c\u6a21\u5f0f\uff1b</p> <p>\uff082\uff09\u5728\u6253\u5f00\u91cc\u9762\u8f93\u5165\uff1acmd</p> <p></p> <p>\uff083\uff09\u5728\u7ba1\u7406\u5458\u7a97\u53e3\u8f93\u5165</p> <pre><code>mvn -v\n</code></pre> <p></p>"},{"location":"vcs/maven/mv_03/#32-maven","title":"3.2 Maven\u8054\u7f51\u95ee\u9898","text":"<p>\uff081\uff09Maven \u9ed8\u8ba4\u7684\u672c\u5730\u4ed3\u5e93\uff1a~.m2\\repository \u76ee\u5f55\u3002</p> <p>\uff082\uff09Maven \u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff1a</p> <p>\uff083\uff09\u672c\u5730\u4ed3\u5e93\u5730\u5740\u66f4\u6539\u5230 D:\\develop\\RepMaven\uff0c\u9ed8\u8ba4\u5728 C:\\Users\\Administrator.m2\\repository</p> <pre><code>&lt;localRepository&gt;D:\\develop\\RepMaven&lt;/localRepository&gt;\n</code></pre> <p>\uff084\uff09\u914d\u7f6e\u963f\u91cc\u4e91\u955c\u50cf\uff08\u4e0b\u8f7d\u901f\u5ea6\u5feb\uff09</p> settings.xml<pre><code>&lt;mirror&gt;\n&lt;id&gt;aliyunmaven&lt;/id&gt;\n&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\n&lt;name&gt;\u963f\u91cc\u4e91\u516c\u5171\u4ed3\u5e93&lt;/name&gt;\n&lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;\n&lt;/mirror&gt;\n</code></pre>"},{"location":"vcs/maven/mv_03/#33-maven","title":"3.3 Maven\u7f16\u8bd1\u7248\u672c","text":"<p>\u5728 settings.xml \u4e2d\u7684 <code>&lt;profiles&gt;&lt;/profiles&gt;</code> \u6807\u7b7e\u4e2d\u52a0\u5165\u5982\u4e0b\u5185\u5bb9\u3002</p> settings.xml<pre><code>&lt;profile&gt;\n&lt;id&gt;jdk-1.8&lt;/id&gt;\n&lt;activation&gt;\n&lt;activeByDefault&gt;true&lt;/activeByDefault&gt;\n&lt;jdk&gt;1.8&lt;/jdk&gt;\n&lt;/activation&gt;\n&lt;properties&gt;\n&lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;\n&lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;\n&lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;\n&lt;/properties&gt;\n&lt;/profile&gt;\n</code></pre>"},{"location":"vcs/maven/mv_03/#34-ideamaven","title":"3.4 \u5728Idea\u4e2d\u914d\u7f6eMaven","text":"<p>1\uff09close project \u6240\u6709\u9879\u76ee\u540e\uff0c\u56de\u5230\u5982\u4e0b\u9875\u9762\uff0c\u70b9\u51fb\u53f3\u4e0b\u89d2\u7684 Configure  ---&gt; \u70b9\u51fb setting</p> <p></p> <p>2\uff09\u8bbe\u7f6e Maven \u7684\u5b89\u88c5\u76ee\u5f55\u53ca\u672c\u5730\u4ed3\u5e93</p> <p></p> <ul> <li>Maven home directory\uff1a\u53ef\u4ee5\u6307\u5b9a\u672c\u5730 Maven \u7684\u5b89\u88c5\u76ee\u5f55\u6240\u5728\uff0c\u56e0\u4e3a\u6211\u5df2\u7ecf\u914d\u7f6e\u4e86 MAVEN_HOME \u7cfb\u7edf\u53c2\u6570\uff0c\u6240\u4ee5\u76f4\u63a5\u8fd9\u6837\u914d\u7f6e IntelliJ IDEA \u662f\u53ef\u4ee5\u627e\u5230\u7684\u3002\u4f46\u662f\u5047\u5982\u4f60\u6ca1\u6709\u914d\u7f6e\u7684\u8bdd\uff0c\u8fd9\u91cc\u53ef\u4ee5\u9009\u62e9\u4f60\u7684 Maven \u5b89\u88c5\u76ee\u5f55\u3002\u6b64\u5916\uff0c\u8fd9\u91cc\u4e0d\u5efa\u8bae\u4f7f\u7528 IDEA \u9ed8\u8ba4\u7684\u3002</li> <li>User settings file / Local repository\uff1a\u6211\u4eec\u8fd8\u53ef\u4ee5\u6307\u5b9a Maven \u7684 settings.xml \u4f4d\u7f6e\u548c\u672c\u5730\u4ed3\u5e93\u4f4d\u7f6e\u3002</li> </ul> <p>3\uff09\u914d\u7f6e Maven \u81ea\u52a8\u5bfc\u5165\u4f9d\u8d56\u7684 jar \u5305</p> <p></p> <ul> <li>Import Maven projects automatically\uff1a\u8868\u793a IntelliJ IDEA \u4f1a\u5b9e\u65f6\u76d1\u63a7\u9879\u76ee\u7684 pom.xml \u6587\u4ef6\uff0c\u8fdb\u884c\u9879\u76ee\u53d8\u52a8\u8bbe\u7f6e\uff0c\u52fe\u9009\u4e0a\u3002</li> <li>Automatically download\uff1a\u5728 Maven \u5bfc\u5165\u4f9d\u8d56\u5305\u7684\u65f6\u5019\u662f\u5426\u81ea\u52a8\u4e0b\u8f7d\u6e90\u7801\u548c\u6587\u6863\u3002\u9ed8\u8ba4\u662f\u6ca1\u6709\u52fe\u9009\u7684\uff0c\u4e5f\u4e0d\u5efa\u8bae\u52fe\u9009\uff0c\u539f\u56e0\u662f\u8fd9\u6837\u53ef\u4ee5\u52a0\u5feb\u9879\u76ee\u4ece\u5916\u7f51\u5bfc\u5165\u4f9d\u8d56\u5305\u7684\u901f\u5ea6\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u6e90\u7801\u548c\u6587\u6863\u7684\u65f6\u5019\u6211\u4eec\u5230\u65f6\u5019\u518d\u9488\u5bf9\u67d0\u4e2a\u4f9d\u8d56\u5305\u8fdb\u884c\u8054\u7f51\u4e0b\u8f7d\u5373\u53ef\u3002IntelliJ IDEA \u652f\u6301\u76f4\u63a5\u4ece\u516c\u7f51\u4e0b\u8f7d\u6e90\u7801\u548c\u6587\u6863\u7684\u3002</li> <li>VM options for importer\uff1a\u53ef\u4ee5\u8bbe\u7f6e\u5bfc\u5165\u7684 VM \u53c2\u6570\u3002\u4e00\u822c\u8fd9\u4e2a\u90fd\u4e0d\u9700\u8981\u4e3b\u52a8\u6539\uff0c\u9664\u975e\u9879\u76ee\u771f\u7684\u5bfc\u5165\u592a\u6162\u4e86\u6211\u4eec\u518d\u589e\u5927\u6b64\u53c2\u6570\u3002</li> </ul>"},{"location":"vcs/maven/mv_03/#35-maven","title":"3.5 \u7b2c\u4e00\u4e2aMaven\u7a0b\u5e8f","text":"<p>1\uff09\u521b\u5efa Project</p> <p></p> <p>2\uff09\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684 Project</p> <p></p> <p>3\uff09\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684 Project</p> <p></p> <p></p> <p>4\uff09\u521b\u5efa\u4e00\u4e2a module</p> <p></p> <p>5\uff09\u53f3\u952e \u2192 new Module \u2192 Maven</p> <p></p> <p>6\uff09\u70b9\u51fb Next\uff0c\u914d\u7f6e\u5750\u6807</p> <p></p> <p>7\uff09\u70b9\u51fb Next\uff0c\u7ed9 Module \u547d\u540d</p> <p>\u76ee\u5f55\u7ed3\u6784\u53ca\u8bf4\u660e</p> <p></p> <ul> <li>main\u76ee\u5f55\u7528\u4e8e\u5b58\u653e\u4e3b\u7a0b\u5e8f\u3002</li> <li>java\u76ee\u5f55\u7528\u4e8e\u5b58\u653e\u6e90\u4ee3\u7801\u6587\u4ef6\u3002</li> <li>resources\u76ee\u5f55\u7528\u4e8e\u5b58\u653e\u914d\u7f6e\u6587\u4ef6\u548c\u8d44\u6e90\u6587\u4ef6\u3002</li> <li>test\u76ee\u5f55\u7528\u4e8e\u5b58\u653e\u6d4b\u8bd5\u7a0b\u5e8f\u3002</li> </ul> <p>4\uff09\u914d\u7f6e Maven \u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 pom.xml</p> pom.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n\n&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\nxsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;Hello&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n\n&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;version&gt;4.12&lt;/version&gt;\n&lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre> <p>5\uff09\u7f16\u5199\u4e3b\u4ee3\u7801</p> <p>\u5728 src/main/java \u76ee\u5f55\u4e0b\u65b0\u5efa\u6587\u4ef6 Hello.java</p> <pre><code>package com.atguigu.maven;\npublic class Hello {\npublic String sayHello(String name){\nreturn \"Hello \"+name+\"!\";\n}\n}\n</code></pre> <p>6\uff09\u7f16\u5199\u6d4b\u8bd5\u4ee3\u7801</p> <p>\u5728 /src/test/java \u76ee\u5f55\u4e0b\u65b0\u5efa\u6d4b\u8bd5\u6587\u4ef6 HelloTest.java</p> <pre><code>package com.atguigu.maven;  import org.junit.Test;\nimport static junit.framework.Assert.*;\n\npublic class HelloTest {\n@Test\npublic void testHello(){\nHello hello = new Hello();\nString results = hello.sayHello(\"atguigu\");\n//\u65ad\u8a00 \u5224\u65ad\u7ed3\u679c\u548c\u4f60\u9884\u60f3\u7684\u7ed3\u679c\u662f\u5426\u76f8\u540c\nassertEquals(\"Hello atguigu!\",results); }\n}\n</code></pre> <p>7\uff09\u4f7f\u7528 Maven \u7684\u65b9\u5f0f\u8fd0\u884c Maven \u5de5\u7a0b</p> <p></p> <p>\u6765\u5230 BigData \u9879\u76ee\u7684\u6839\u76ee\u5f55\uff08\u4f8b\u5982 E:\\ideaProject1\\BigData \uff09\u3002</p> <p>\uff081\uff09compile \u547d\u4ee4\uff0c\u67e5\u770b target \u76ee\u5f55\u7684\u53d8\u5316</p> \u7f16\u8bd1\u524d \u7f16\u8bd1\u540e <p></p> <p></p> <p>\uff082\uff09clean\uff0c\u7136\u540e\u518d\u6b21\u67e5\u770b\u6839\u76ee\u5f55\u53d8\u5316</p> clean \u524dclean \u540e <p></p> <p></p> <p>\uff083\uff09test \u547d\u4ee4\uff0c\u67e5\u770b target \u76ee\u5f55\u53d8\u5316</p> <p></p> <p>\uff084\uff09package \u547d\u4ee4\uff0c\u67e5\u770b target \u76ee\u5f55\u53d8\u5316</p> <p></p> <p>\uff085\uff09install \u547d\u4ee4\uff0c\u67e5\u770b\u672c\u5730\u4ed3\u5e93\u7684\u76ee\u5f55\u53d8\u5316</p> \u6267\u884c install \u547d\u4ee4\u524d\u6267\u884c install \u547d\u4ee4\u540e <p></p> <p></p>"},{"location":"vcs/maven/mv_03/#36-maven","title":"3.6 Maven\u6253\u5305\u63d2\u4ef6","text":"<p>Maven \u672c\u8eab\u7684\u6253\u5305\u63d2\u4ef6\u4e0d\u8d1f\u8d23\u5c06\u4f9d\u8d56\u7684 jar \u5305\u4e00\u5e76\u6253\u5165\u5230 jar \u5305\u4e2d\u3002\u5982\u679c\u9879\u76ee\u6240\u4f9d\u8d56\u7684 jar \u5305\u5728\u670d\u52a1\u5668\u73af\u5883\u4e2d\u63d0\u4f9b\u4e86\u8fd8\u597d\uff0c\u5982\u679c\u670d\u52a1\u5668\u73af\u5883\u4e2d\u6ca1\u6709\u63d0\u4f9b\uff0c\u5219\u6bd4\u8f83\u60b2\u60e8\uff0c\u8fd0\u884c\u5404\u79cd ClassNotFound\u2026. \u4f60\u4eec\u61c2\u7684!</p> <p>\u56e0\u6b64\u9700\u8981\u4e00\u6b3e\u80fd\u591f\u5c06\u9879\u76ee\u6240\u4f9d\u8d56\u7684 jar \u5305 \u4e00\u5e76\u6253\u5165\u5230 jar \u4e2d\u7684\u63d2\u4ef6\u6765\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898.</p> <p>\u5728 pom.xml \u4e2d\u52a0\u5165\u5982\u4e0b\u5185\u5bb9:</p> pom.xml<pre><code>&lt;build&gt;\n&lt;plugins&gt;\n&lt;plugin&gt;\n&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;\n&lt;configuration&gt;\n&lt;descriptorRefs&gt;\n&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;\n&lt;/descriptorRefs&gt;\n&lt;/configuration&gt;\n&lt;executions&gt;\n&lt;execution&gt;\n&lt;id&gt;make-assembly&lt;/id&gt;\n&lt;phase&gt;package&lt;/phase&gt;\n&lt;goals&gt;\n&lt;goal&gt;single&lt;/goal&gt;\n&lt;/goals&gt;\n&lt;/execution&gt;\n&lt;/executions&gt;\n&lt;/plugin&gt;\n&lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>"},{"location":"vcs/maven/mv_04/","title":"\u7b2c4\u7ae0 Maven\u6838\u5fc3\u6982\u5ff5","text":"<p>Maven \u7684\u6838\u5fc3\u6982\u5ff5\u5305\u62ec\uff1aPOM\u3001\u7ea6\u5b9a\u7684\u76ee\u5f55\u7ed3\u6784\u3001\u5750\u6807\u3001\u4f9d\u8d56\u3001\u4ed3\u5e93\u3001\u751f\u547d\u5468\u671f\u3001\u63d2\u4ef6\u548c\u76ee\u6807\u3001\u7ee7\u627f\u3001\u805a\u5408\u3002</p>"},{"location":"vcs/maven/mv_04/#41-pom","title":"4.1 POM","text":"<p>Project Object Model\uff1a\u9879\u76ee\u5bf9\u8c61\u6a21\u578b\u3002\u5c06 Java \u5de5\u7a0b\u7684\u76f8\u5173\u4fe1\u606f\u5c01\u88c5\u4e3a\u5bf9\u8c61\u4f5c\u4e3a\u4fbf\u4e8e\u64cd\u4f5c\u548c\u7ba1\u7406\u7684\u6a21\u578b\u3002Maven \u5de5\u7a0b\u7684\u6838\u5fc3\u914d\u7f6e\u3002\u53ef\u4ee5\u8bf4\u5b66\u4e60 Maven \u5c31\u662f\u5b66\u4e60 pom.xml \u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u3002</p>"},{"location":"vcs/maven/mv_04/#42","title":"4.2 \u7ea6\u5b9a\u7684\u76ee\u5f55\u7ed3\u6784","text":"<p>\u73b0\u5728 JavaEE \u5f00\u53d1\u9886\u57df\u666e\u904d\u8ba4\u540c\u4e00\u4e2a\u89c2\u70b9\uff1a\u7ea6\u5b9a &gt; \u914d\u7f6e &gt; \u7f16\u7801\u3002\u610f\u601d\u5c31\u662f\u80fd\u7528\u914d\u7f6e\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u4e0d\u7f16\u7801\uff0c\u80fd\u57fa\u4e8e\u7ea6\u5b9a\u7684\u5c31\u4e0d\u8fdb\u884c\u914d\u7f6e\u3002\u800c Maven \u6b63\u662f\u56e0\u4e3a\u6307\u5b9a\u4e86\u7279\u5b9a\u6587\u4ef6\u4fdd\u5b58\u7684\u76ee\u5f55\u624d\u80fd\u591f\u5bf9\u6211\u4eec\u7684 Java \u5de5\u7a0b\u8fdb\u884c\u81ea\u52a8\u5316\u6784\u5efa\u3002</p> <p></p>"},{"location":"vcs/maven/mv_04/#43","title":"4.3 \u5750\u6807","text":"<p>1\uff09\u51e0\u4f55\u4e2d\u7684\u5750\u6807</p> <p>\uff081\uff09\u5728\u4e00\u4e2a\u5e73\u9762\u4e2d\u4f7f\u7528 x\u3001y \u4e24\u4e2a\u5411\u91cf\u53ef\u4ee5\u552f\u4e00\u7684\u786e\u5b9a\u5e73\u9762\u4e2d\u7684\u4e00\u4e2a\u70b9\u3002</p> <p>\uff082\uff09\u5728\u7a7a\u95f4\u4e2d\u4f7f\u7528 x\u3001y\u3001z \u4e09\u4e2a\u5411\u91cf\u53ef\u4ee5\u552f\u4e00\u7684\u786e\u5b9a\u7a7a\u95f4\u4e2d\u7684\u4e00\u4e2a\u70b9\u3002</p> <p>2\uff09Maven \u7684\u5750\u6807</p> <p>\u4f7f\u7528\u5982\u4e0b\u4e09\u4e2a\u5411\u91cf\u5728 Maven \u7684\u4ed3\u5e93\u4e2d\u552f\u4e00\u7684\u786e\u5b9a\u4e00\u4e2a Maven \u5de5\u7a0b\u3002</p> <p>\uff081\uff09groupId\uff1a\u516c\u53f8\u6216\u7ec4\u7ec7\u7684\u57df\u540d\u5012\u5e8f+\u5f53\u524d\u9879\u76ee\u540d\u79f0</p> <p>\uff082\uff09artifactId\uff1a\u5f53\u524d\u9879\u76ee\u7684\u6a21\u5757\u540d\u79f0</p> <p>\uff083\uff09version\uff1a\u5f53\u524d\u6a21\u5757\u7684\u7248\u672c</p> <p>\u5728\u9879\u76ee\u7684 pom.xml \u6587\u4ef6\u4e2d\u5b58\u50a8\u5750\u6807</p> pom.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n\n&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\nxsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;Hello&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n&lt;/project&gt;\n</code></pre> <p>3\uff09\u5982\u4f55\u901a\u8fc7\u5750\u6807\u5230\u4ed3\u5e93\u4e2d\u67e5\u627e jar \u5305\uff1f</p> <p>\uff081\uff09\u5c06 gav \u4e09\u4e2a\u5411\u91cf\u8fde\u8d77\u6765</p> <pre><code>com.atguigu.maven + Hello + 1.0-SNAPSHOT\n</code></pre> <p>\uff082\uff09\u4ee5\u8fde\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u76ee\u5f55\u7ed3\u6784\u5230\u4ed3\u5e93\u4e2d\u67e5\u627e</p> <pre><code>com/atguigu/maven/Hello/1.0-SNAPSHOT/Hello-1.0-SNAPSHOT.jar\n</code></pre> <p>\u6ce8\u610f</p> <p>\u6211\u4eec\u81ea\u5df1\u7684 Maven \u5de5\u7a0b\u5fc5\u987b\u6267\u884c\u5b89\u88c5\u64cd\u4f5c\u624d\u4f1a\u8fdb\u5165\u4ed3\u5e93\u3002\u5b89\u88c5\u7684\u547d\u4ee4\u662f\uff1a<code>mvn install</code></p> <p></p>"},{"location":"vcs/maven/mv_04/#44-maven","title":"4.4 \u7b2c\u4e8c\u4e2aMaven\u5de5\u7a0b","text":"<p>1\uff09\u521b\u5efa HelloFriend Module</p> <p></p> <p></p> <p></p> <p>2\uff09\u5728 pom.xml \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u5f53\u524d\u5de5\u7a0b\u4f9d\u8d56 Hello</p> pom.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n\n&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\nxsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;HelloFriend&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n\n&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;Hello&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;version&gt;4.0&lt;/version&gt;\n&lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;/project&gt;\n</code></pre> <p>3\uff09\u4e3b\u7a0b\u5e8f</p> <p>\u5728 src/main/java \u76ee\u5f55\u4e0b\u65b0\u5efa\u6587\u4ef6 HelloFriend.java</p> <pre><code>package com.atguigu.maven\npublic class HelloFriend {\n\npublic String sayHelloToFriend(String name){\nHello hello = new Hello();\nString str = hello.sayHello(name)+\" I am \"+this.getMyName();\nreturn str;\n}\n\npublic String getMyName(){\nreturn \"Idea\";\n}\n}\n</code></pre> <p>4\uff09\u6d4b\u8bd5\u7a0b\u5e8f</p> <p>\u5728 /src/test/java \u76ee\u5f55\u4e0b\u65b0\u5efa\u6d4b\u8bd5\u6587\u4ef6 HelloFriendTest.java</p> <pre><code>package com.atguigu.maven\nimport org.junit.Test;\nimport static junit.framework.Assert.*;\n\npublic class HelloFriendTest {\n@Test\npublic void testHelloFriend(){\nHelloFriend helloFriend = new HelloFriend();\nString results = helloFriend.sayHelloToFriend(\"Maven\");\nassertEquals(\"Hello Maven! I am Idea\",results);\n}\n}\n</code></pre> <p>5\uff09\u5173\u952e\uff1a\u5bf9 Hello \u7684\u4f9d\u8d56</p> <p>\u8fd9\u91cc Hello \u5c31\u662f\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a Maven \u5de5\u7a0b\uff0c\u73b0\u5728 HelloFriend \u5bf9\u5b83\u6709\u4f9d\u8d56\u3002\u90a3\u4e48\u8fd9\u4e2a\u4f9d\u8d56\u80fd\u5426\u6210\u529f\u5462\uff1f\u66f4\u8fdb\u4e00\u6b65\u7684\u95ee\u9898\u662f\uff1aHelloFriend \u5de5\u7a0b\u4f1a\u5230\u54ea\u91cc\u53bb\u627e Hello \u5462\uff1f</p> <p>\u7b54\u6848\u662f\uff1a\u672c\u5730\u4ed3\u5e93\u3002\u4efb\u4f55\u4e00\u4e2a Maven \u5de5\u7a0b\u4f1a\u6839\u636e\u5750\u6807\u5230\u672c\u5730\u4ed3\u5e93\u4e2d\u53bb\u67e5\u627e\u5b83\u6240\u4f9d\u8d56\u7684 jar \u5305\u3002\u5982\u679c\u80fd\u591f\u627e\u5230\u5219\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u5426\u5219\u5c31\u4e0d\u884c\u3002</p>"},{"location":"vcs/maven/mv_04/#45","title":"4.5 \u4f9d\u8d56\u7ba1\u7406","text":"<p>1\uff09\u57fa\u672c\u6982\u5ff5</p> <p>\u5f53 A jar \u5305\u9700\u8981\u7528\u5230 B jar \u5305\u4e2d\u7684\u7c7b\u65f6\uff0c\u6211\u4eec\u5c31\u8bf4 A \u5bf9 B \u6709\u4f9d\u8d56\u3002\u4f8b\u5982\uff1aHelloFriend-1.0-SNAPSHOT.jar \u4f9d\u8d56\u4e8e Hello-1.0-SNAPSHOT.jar\u3002</p> <p>\u901a\u8fc7\u7b2c\u4e8c\u4e2a Maven \u5de5\u7a0b\u6211\u4eec\u5df2\u7ecf\u770b\u5230\uff0c\u5f53\u524d\u5de5\u7a0b\u4f1a\u5230\u672c\u5730\u4ed3\u5e93\u4e2d\u6839\u636e\u5750\u6807\u67e5\u627e\u5b83\u6240\u4f9d\u8d56\u7684 jar \u5305\u3002</p> <p>\u914d\u7f6e\u7684\u57fa\u672c\u5f62\u5f0f\u662f\u4f7f\u7528 dependency \u6807\u7b7e\u6307\u5b9a\u76ee\u6807 jar \u5305\u7684\u5750\u6807\u3002\u4f8b\u5982\uff1a</p> pom.xml<pre><code>&lt;dependencies&gt;\n&lt;!--\u5750\u6807--&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;Hello&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;version&gt;4.0&lt;/version&gt;\n&lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>2\uff09\u76f4\u63a5\u4f9d\u8d56\u548c\u95f4\u63a5\u4f9d\u8d56</p> <p>\u5982\u679c A \u4f9d\u8d56 B\uff0cB \u4f9d\u8d56 C\uff0c\u90a3\u4e48 A \u2192 B \u548c B \u2192 C \u90fd\u662f\u76f4\u63a5\u4f9d\u8d56\uff0c\u800c A \u2192 C \u662f\u95f4\u63a5\u4f9d\u8d56\u3002</p>"},{"location":"vcs/maven/mv_04/#451","title":"4.5.1 \u4f9d\u8d56\u7684\u8303\u56f4","text":"<p>1\uff09compile\uff08\u9ed8\u8ba4\u5c31\u662f\u8fd9\u4e2a\u8303\u56f4\uff09</p> <p>\uff081\uff09main \u76ee\u5f55\u4e0b\u7684 Java \u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u8303\u56f4\u7684\u4f9d\u8d56</p> <p>\uff082\uff09test \u76ee\u5f55\u4e0b\u7684 Java \u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u8303\u56f4\u7684\u4f9d\u8d56</p> <p>\uff083\uff09\u90e8\u7f72\u5230 Tomcat \u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u65f6\u8981\u653e\u5728 WEB-INF \u7684 lib \u76ee\u5f55\u4e0b</p> <p>\u4f8b\u5982\uff1a\u5bf9 Hello \u7684\u4f9d\u8d56\u3002\u4e3b\u7a0b\u5e8f\u3001\u6d4b\u8bd5\u7a0b\u5e8f\u548c\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u90fd\u9700\u8981\u7528\u5230\u3002</p> <p>2\uff09test</p> <p>\uff081\uff09main \u76ee\u5f55\u4e0b\u7684 Java \u4ee3\u7801\u4e0d\u80fd\u8bbf\u95ee\u8fd9\u4e2a\u8303\u56f4\u7684\u4f9d\u8d56</p> <p>\uff082\uff09test \u76ee\u5f55\u4e0b\u7684 Java \u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u8303\u56f4\u7684\u4f9d\u8d56</p> <p>\uff083\uff09\u90e8\u7f72\u5230 Tomcat \u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u65f6\u4e0d\u4f1a\u653e\u5728 WEB-INF \u7684 lib \u76ee\u5f55\u4e0b</p> <p>\u4f8b\u5982\uff1a\u5bf9 junit \u7684\u4f9d\u8d56\u3002\u4ec5\u4ec5\u662f\u6d4b\u8bd5\u7a0b\u5e8f\u90e8\u5206\u9700\u8981\u3002</p> <p>3\uff09provided</p> <p>\uff081\uff09main \u76ee\u5f55\u4e0b\u7684 Java \u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u8303\u56f4\u7684\u4f9d\u8d56</p> <p>\uff082\uff09test \u76ee\u5f55\u4e0b\u7684 Java \u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u8303\u56f4\u7684\u4f9d\u8d56</p> <p>\uff083\uff09\u90e8\u7f72\u5230 Tomcat \u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u65f6\u4e0d\u4f1a\u653e\u5728 WEB-INF \u7684 lib \u76ee\u5f55\u4e0b</p> <p>\u4f8b\u5982\uff1aservlet-api \u5728\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u65f6\uff0cServlet \u5bb9\u5668\u4f1a\u63d0\u4f9b\u76f8\u5173 API\uff0c\u6240\u4ee5\u90e8\u7f72\u7684\u65f6\u5019\u4e0d\u9700\u8981\u3002</p> <p>4\uff09\u5176\u4ed6\uff1aruntime\u3001import\u3001system \u7b49\u3002</p> <p>\u5404\u4e2a\u4f9d\u8d56\u8303\u56f4\u7684\u4f5c\u7528\u53ef\u4ee5\u6982\u62ec\u4e3a\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"vcs/maven/mv_04/#452","title":"4.5.2 \u4f9d\u8d56\u7684\u4f20\u9012\u6027","text":"<p>\u5f53\u5b58\u5728\u95f4\u63a5\u4f9d\u8d56\u7684\u60c5\u51b5\u65f6\uff0c\u4e3b\u5de5\u7a0b\u5bf9\u95f4\u63a5\u4f9d\u8d56\u7684 jar \u53ef\u4ee5\u8bbf\u95ee\u5417\uff1f\u8fd9\u8981\u770b\u95f4\u63a5\u4f9d\u8d56\u7684 jar \u5305\u5f15\u5165\u65f6\u7684\u4f9d\u8d56\u8303\u56f4\u2014\u2014\u53ea\u6709\u4f9d\u8d56\u8303\u56f4\u4e3a compile \u65f6\u53ef\u4ee5\u8bbf\u95ee\u3002\u4f8b\u5982\uff1a</p> <p></p>"},{"location":"vcs/maven/mv_04/#453-jar","title":"4.5.3 \u4f9d\u8d56\u7684\u539f\u5219\uff1a\u89e3\u51b3jar\u5305\u51b2\u7a81","text":"<p>1\uff09\u8def\u5f84\u6700\u77ed\u8005\u4f18\u5148</p> <p></p> <p>2\uff09\u8def\u5f84\u76f8\u540c\u65f6\u5148\u58f0\u660e\u8005\u4f18\u5148</p> <p></p> <p>\u8fd9\u91cc\u201c\u58f0\u660e\u201d\u7684\u5148\u540e\u987a\u5e8f\u6307\u7684\u662f dependency \u6807\u7b7e\u914d\u7f6e\u7684\u5148\u540e\u987a\u5e8f\u3002</p>"},{"location":"vcs/maven/mv_04/#454","title":"4.5.4 \u4f9d\u8d56\u7684\u6392\u9664","text":"<p>\u6709\u7684\u65f6\u5019\u4e3a\u4e86\u786e\u4fdd\u7a0b\u5e8f\u6b63\u786e\u53ef\u4ee5\u5c06\u6709\u53ef\u80fd\u91cd\u590d\u7684\u95f4\u63a5\u4f9d\u8d56\u6392\u9664\u3002\u8bf7\u770b\u5982\u4e0b\u7684\u4f8b\u5b50\uff1a</p> <p>\uff081\uff09\u5047\u8bbe\u5f53\u524d\u5de5\u7a0b\u4e3a MakeFriend\uff0c\u76f4\u63a5\u4f9d\u8d56 OurFriends\u3002</p> <p>\uff082\uff09OurFriends \u4f9d\u8d56 commons-logging \u7684 1.1.1 \u5bf9\u4e8e MakeFriend \u6765\u8bf4\u662f\u95f4\u63a5\u4f9d\u8d56\u3002</p> <p>\uff083\uff09\u5f53\u524d\u5de5\u7a0b MakeFriend \u76f4\u63a5\u4f9d\u8d56 commons-logging \u7684 1.1.2\u3002</p> <p>\uff084\uff09\u52a0\u5165 exclusions \u914d\u7f6e\u540e\u53ef\u4ee5\u5728\u4f9d\u8d56 OurFriends \u7684\u65f6\u5019\u6392\u9664\u7248\u672c\u4e3a 1.1.1 \u7684 commons-logging \u7684\u95f4\u63a5\u4f9d\u8d56\u3002</p> pom.xml<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;OurFriends&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n\n&lt;!--\u4f9d\u8d56\u6392\u9664--&gt;\n&lt;exclusions&gt;\n&lt;exclusion&gt;\n&lt;groupId&gt;commons-logging&lt;/groupId&gt;\n&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;\n&lt;/exclusion&gt;\n&lt;/exclusions&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;commons-logging&lt;/groupId&gt;\n&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;\n&lt;version&gt;1.1.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"vcs/maven/mv_04/#455-jar","title":"4.5.5 \u7edf\u4e00\u7ba1\u7406\u76ee\u6807Jar\u5305\u7684\u7248\u672c","text":"<p>\u4ee5\u5bf9 Spring \u7684 jar \u5305\u4f9d\u8d56\u4e3a\u4f8b\uff1aSpring \u7684\u6bcf\u4e00\u4e2a\u7248\u672c\u4e2d\u90fd\u5305\u542b spring-context\uff0cspringmvc \u7b49 jar \u5305\u3002\u6211\u4eec\u5e94\u8be5\u5bfc\u5165\u7248\u672c\u4e00\u81f4\u7684 Spring jar \u5305\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 4.0.0 \u7684 spring-context \u7684\u540c\u65f6\u4f7f\u7528 4.1.1 \u7684 springmvc\u3002</p> pom.xml<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n&lt;version&gt;4.0.0.RELEASE&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;\n&lt;version&gt;4.0.0.RELEASE&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;\n&lt;version&gt;4.0.0.RELEASE&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-orm&lt;/artifactId&gt;\n&lt;version&gt;4.0.0.RELEASE&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u95ee\u9898\u662f\u5982\u679c\u6211\u4eec\u60f3\u8981\u5c06\u8fd9\u4e9b jar \u5305\u7684\u7248\u672c\u7edf\u4e00\u5347\u7ea7\u4e3a 4.1.1\uff0c\u662f\u4e0d\u662f\u8981\u624b\u52a8\u4e00\u4e2a\u4e2a\u4fee\u6539\u5462\uff1f\u663e\u7136\uff0c\u6211\u4eec\u6709\u7edf\u4e00\u914d\u7f6e\u7684\u65b9\u5f0f\uff1a</p> pom.xml<pre><code>&lt;!--\u7edf\u4e00\u7ba1\u7406\u5f53\u524d\u6a21\u5757\u7684jar\u5305\u7684\u7248\u672c--&gt;\n&lt;properties&gt;\n&lt;spring.version&gt;4.0.0.RELEASE&lt;/spring.version&gt;\n&lt;/properties&gt;\n\n\u2026\u2026\n&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n&lt;version&gt;${spring.version}&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;\n&lt;version&gt;${spring.version}&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;\n&lt;version&gt;${spring.version}&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n&lt;artifactId&gt;spring-orm&lt;/artifactId&gt;\n&lt;version&gt;${spring.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u8fdb\u884c\u7248\u672c\u8c03\u6574\u7684\u65f6\u5019\u53ea\u6539\u4e00\u6539\u5730\u65b9\u5c31\u884c\u4e86\u3002</p>"},{"location":"vcs/maven/mv_04/#46","title":"4.6 \u4ed3\u5e93","text":"<p>1\uff09\u5206\u7c7b</p> <p>\uff081\uff09\u672c\u5730\u4ed3\u5e93\uff1a\u4e3a\u5f53\u524d\u672c\u673a\u7535\u8111\u4e0a\u7684\u6240\u6709 Maven \u5de5\u7a0b\u670d\u52a1\u3002</p> <p>\uff082\uff09\u8fdc\u7a0b\u4ed3\u5e93</p> <p>\u2460\u79c1\u670d\uff1a\u67b6\u8bbe\u5728\u5f53\u524d\u5c40\u57df\u7f51\u73af\u5883\u4e0b\uff0c\u4e3a\u5f53\u524d\u5c40\u57df\u7f51\u8303\u56f4\u5185\u7684\u6240\u6709 Maven \u5de5\u7a0b\u670d\u52a1\u3002</p> <p></p> <p>\u2461\u4e2d\u592e\u4ed3\u5e93\uff1a\u67b6\u8bbe\u5728 Internet \u4e0a\uff0c\u4e3a\u5168\u4e16\u754c\u6240\u6709 Maven \u5de5\u7a0b\u670d\u52a1\u3002</p> <p>\u2462\u4e2d\u592e\u4ed3\u5e93\u7684\u955c\u50cf\uff1a\u67b6\u8bbe\u5728\u5404\u4e2a\u5927\u6d32\uff0c\u4e3a\u4e2d\u592e\u4ed3\u5e93\u5206\u62c5\u6d41\u91cf\u3002\u51cf\u8f7b\u4e2d\u592e\u4ed3\u5e93\u7684\u538b\u529b\uff0c\u540c\u65f6\u66f4\u5feb\u7684\u54cd\u5e94\u7528\u6237\u8bf7\u6c42\u3002</p> <p>2\uff09\u4ed3\u5e93\u4e2d\u7684\u6587\u4ef6</p> <p>\uff081\uff09Maven \u7684\u63d2\u4ef6</p> <p>\uff082\uff09\u6211\u4eec\u81ea\u5df1\u5f00\u53d1\u7684\u9879\u76ee\u7684\u6a21\u5757</p> <p>\uff083\uff09\u7b2c\u4e09\u65b9\u6846\u67b6\u6216\u5de5\u5177\u7684 jar \u5305</p> <p>\u203b\u4e0d\u7ba1\u662f\u4ec0\u4e48\u6837\u7684 jar \u5305\uff0c\u5728\u4ed3\u5e93\u4e2d\u90fd\u662f\u6309\u7167\u5750\u6807\u751f\u6210\u76ee\u5f55\u7ed3\u6784\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u7edf\u4e00\u7684\u65b9\u5f0f\u67e5\u8be2\u6216\u4f9d\u8d56\u3002</p>"},{"location":"vcs/maven/mv_04/#47","title":"4.7 \u751f\u547d\u5468\u671f","text":"<p>1\uff09\u4ec0\u4e48\u662f Maven \u7684\u751f\u547d\u5468\u671f\uff1f</p> <p>Maven \u751f\u547d\u5468\u671f\u5b9a\u4e49\u4e86\u5404\u4e2a\u6784\u5efa\u73af\u8282\u7684\u6267\u884c\u987a\u5e8f\uff0c\u6709\u4e86\u8fd9\u4e2a\u6e05\u5355\uff0cMaven \u5c31\u53ef\u4ee5\u81ea\u52a8\u5316\u7684\u6267\u884c\u6784\u5efa\u547d\u4ee4\u4e86\u3002</p> <p>Maven \u6709\u4e09\u5957\u76f8\u4e92\u72ec\u7acb\u7684\u751f\u547d\u5468\u671f\uff0c\u5206\u522b\u662f\uff1a </p> <ul> <li>Clean Lifecycle \u5728\u8fdb\u884c\u771f\u6b63\u7684\u6784\u5efa\u4e4b\u524d\u8fdb\u884c\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\u3002</li> <li>Default Lifecycle \u6784\u5efa\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u7f16\u8bd1\uff0c\u6d4b\u8bd5\uff0c\u6253\u5305\uff0c\u5b89\u88c5\uff0c\u90e8\u7f72\u7b49\u7b49\u3002</li> <li>Site Lifecycle \u751f\u6210\u9879\u76ee\u62a5\u544a\uff0c\u7ad9\u70b9\uff0c\u53d1\u5e03\u7ad9\u70b9\u3002</li> </ul> <p>\u518d\u6b21\u5f3a\u8c03\u4e00\u4e0b\u5b83\u4eec\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u4f60\u53ef\u4ee5\u4ec5\u4ec5\u8c03\u7528 clean \u6765\u6e05\u7406\u5de5\u4f5c\u76ee\u5f55\uff0c\u4ec5\u4ec5\u8c03\u7528 site \u6765\u751f\u6210\u7ad9\u70b9\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c <code>mvn clean install site</code> \u8fd0\u884c\u6240\u6709\u8fd9\u4e09\u5957\u751f\u547d\u5468\u671f\u3002</p> <p>\u6bcf\u5957\u751f\u547d\u5468\u671f\u90fd\u7531\u4e00\u7ec4\u9636\u6bb5\uff08Phase\uff09\u7ec4\u6210\uff0c\u6211\u4eec\u5e73\u65f6\u5728\u547d\u4ee4\u884c\u8f93\u5165\u7684\u547d\u4ee4\u603b\u4f1a\u5bf9\u5e94\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684\u9636\u6bb5\u3002\u6bd4\u5982\uff0c\u8fd0\u884c <code>mvn clean</code>\uff0c\u8fd9\u4e2a clean \u662f Clean \u751f\u547d\u5468\u671f\u7684\u4e00\u4e2a\u9636\u6bb5\u3002\u6709 Clean \u751f\u547d\u5468\u671f\uff0c\u4e5f\u6709 clean \u9636\u6bb5\u3002</p> <p>2\uff09clean \u751f\u547d\u5468\u671f</p> <p>Clean \u751f\u547d\u5468\u671f\u4e00\u5171\u5305\u542b\u4e86\u4e09\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>pre-clean \u6267\u884c\u4e00\u4e9b\u9700\u8981\u5728 clean \u4e4b\u524d\u5b8c\u6210\u7684\u5de5\u4f5c </li> <li>clean \u79fb\u9664\u6240\u6709\u4e0a\u4e00\u6b21\u6784\u5efa\u751f\u6210\u7684\u6587\u4ef6 </li> <li>post-clean \u6267\u884c\u4e00\u4e9b\u9700\u8981\u5728 clean \u4e4b\u540e\u7acb\u523b\u5b8c\u6210\u7684\u5de5\u4f5c </li> </ul> <p>3\uff09Site \u751f\u547d\u5468\u671f</p> <ul> <li>pre-site \u6267\u884c\u4e00\u4e9b\u9700\u8981\u5728\u751f\u6210\u7ad9\u70b9\u6587\u6863\u4e4b\u524d\u5b8c\u6210\u7684\u5de5\u4f5c</li> <li>site \u751f\u6210\u9879\u76ee\u7684\u7ad9\u70b9\u6587\u6863</li> <li>post-site \u6267\u884c\u4e00\u4e9b\u9700\u8981\u5728\u751f\u6210\u7ad9\u70b9\u6587\u6863\u4e4b\u540e\u5b8c\u6210\u7684\u5de5\u4f5c\uff0c\u5e76\u4e14\u4e3a\u90e8\u7f72\u505a\u51c6\u5907</li> <li>site-deploy \u5c06\u751f\u6210\u7684\u7ad9\u70b9\u6587\u6863\u90e8\u7f72\u5230\u7279\u5b9a\u7684\u670d\u52a1\u5668\u4e0a</li> </ul> <p>\u8fd9\u91cc\u7ecf\u5e38\u7528\u5230\u7684\u662f site \u9636\u6bb5\u548c site-deploy \u9636\u6bb5\uff0c\u7528\u4ee5\u751f\u6210\u548c\u53d1\u5e03 Maven \u7ad9\u70b9\uff0c\u8fd9\u53ef\u662f Maven \u76f8\u5f53\u5f3a\u5927\u7684\u529f\u80fd\uff0cManager \u6bd4\u8f83\u559c\u6b22\uff0c\u6587\u6863\u53ca\u7edf\u8ba1\u6570\u636e\u81ea\u52a8\u751f\u6210\uff0c\u5f88\u597d\u770b\u3002</p> <p>4\uff09Default \u751f\u547d\u5468\u671f</p> <p>Default \u751f\u547d\u5468\u671f\u662f Maven \u751f\u547d\u5468\u671f\u4e2d\u6700\u91cd\u8981\u7684\u4e00\u4e2a\uff0c\u7edd\u5927\u90e8\u5206\u5de5\u4f5c\u90fd\u53d1\u751f\u5728\u8fd9\u4e2a\u751f\u547d\u5468\u671f\u4e2d\u3002\u8fd9\u91cc\uff0c\u53ea\u89e3\u91ca\u4e00\u4e9b\u6bd4\u8f83\u91cd\u8981\u548c\u5e38\u7528\u7684\u9636\u6bb5\uff1a</p> <pre><code>validate\ngenerate-sources\nprocess-sources\ngenerate-resources\nprocess-resources \u590d\u5236\u5e76\u5904\u7406\u8d44\u6e90\u6587\u4ef6\uff0c\u81f3\u76ee\u6807\u76ee\u5f55\uff0c\u51c6\u5907\u6253\u5305\u3002\ncompile \u7f16\u8bd1\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u3002\nprocess-classes\ngenerate-test-sources\nprocess-test-sources\ngenerate-test-resources\nprocess-test-resources \u590d\u5236\u5e76\u5904\u7406\u8d44\u6e90\u6587\u4ef6\uff0c\u81f3\u76ee\u6807\u6d4b\u8bd5\u76ee\u5f55\u3002\ntest-compile \u7f16\u8bd1\u6d4b\u8bd5\u6e90\u4ee3\u7801\u3002\nprocess-test-classes\ntest \u4f7f\u7528\u5408\u9002\u7684\u5355\u5143\u6d4b\u8bd5\u6846\u67b6\u8fd0\u884c\u6d4b\u8bd5\u3002\u8fd9\u4e9b\u6d4b\u8bd5\u4ee3\u7801\u4e0d\u4f1a\u88ab\u6253\u5305\u6216\u90e8\u7f72\u3002\nprepare-package\npackage \u63a5\u53d7\u7f16\u8bd1\u597d\u7684\u4ee3\u7801\uff0c\u6253\u5305\u6210\u53ef\u53d1\u5e03\u7684\u683c\u5f0f\uff0c\u5982JAR\u3002\npre-integration-test\nintegration-test\npost-integration-test\nverify\ninstall\u5c06\u5305\u5b89\u88c5\u81f3\u672c\u5730\u4ed3\u5e93\uff0c\u4ee5\u8ba9\u5176\u5b83\u9879\u76ee\u4f9d\u8d56\u3002\ndeploy\u5c06\u6700\u7ec8\u7684\u5305\u590d\u5236\u5230\u8fdc\u7a0b\u7684\u4ed3\u5e93\uff0c\u4ee5\u8ba9\u5176\u5b83\u5f00\u53d1\u4eba\u5458\u4e0e\u9879\u76ee\u5171\u4eab\u6216\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u3002\n</code></pre> <p>5\uff09\u751f\u547d\u5468\u671f\u4e0e\u81ea\u52a8\u5316\u6784\u5efa</p> <p>\u8fd0\u884c\u4efb\u4f55\u4e00\u4e2a\u9636\u6bb5\u7684\u65f6\u5019\uff0c\u5b83\u524d\u9762\u7684\u6240\u6709\u9636\u6bb5\u90fd\u4f1a\u88ab\u8fd0\u884c\uff0c\u4f8b\u5982\u6211\u4eec\u8fd0\u884c <code>mvn install</code> \u7684\u65f6\u5019\uff0c\u4ee3\u7801\u4f1a\u88ab\u7f16\u8bd1\uff0c\u6d4b\u8bd5\uff0c\u6253\u5305\u3002\u8fd9\u5c31\u662f Maven \u4e3a\u4ec0\u4e48\u80fd\u591f\u81ea\u52a8\u6267\u884c\u6784\u5efa\u8fc7\u7a0b\u7684\u5404\u4e2a\u73af\u8282\u7684\u539f\u56e0\u3002\u6b64\u5916\uff0cMaven \u7684\u63d2\u4ef6\u673a\u5236\u662f\u5b8c\u5168\u4f9d\u8d56 Maven \u7684\u751f\u547d\u5468\u671f\u7684\uff0c\u56e0\u6b64\u7406\u89e3\u751f\u547d\u5468\u671f\u81f3\u5173\u91cd\u8981\u3002</p>"},{"location":"vcs/maven/mv_04/#48","title":"4.8 \u63d2\u4ef6\u548c\u76ee\u6807","text":"<p>\uff081\uff09Maven \u7684\u6838\u5fc3\u4ec5\u4ec5\u5b9a\u4e49\u4e86\u62bd\u8c61\u7684\u751f\u547d\u5468\u671f\uff0c\u5177\u4f53\u7684\u4efb\u52a1\u90fd\u662f\u4ea4\u7531\u63d2\u4ef6\u5b8c\u6210\u7684\u3002</p> <p>\uff082\uff09\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u80fd\u5b9e\u73b0\u591a\u4e2a\u529f\u80fd\uff0c\u6bcf\u4e2a\u529f\u80fd\u5c31\u662f\u4e00\u4e2a\u63d2\u4ef6\u76ee\u6807\u3002</p> <p>\uff083\uff09Maven \u7684\u751f\u547d\u5468\u671f\u4e0e\u63d2\u4ef6\u76ee\u6807\u76f8\u4e92\u7ed1\u5b9a\uff0c\u4ee5\u5b8c\u6210\u67d0\u4e2a\u5177\u4f53\u7684\u6784\u5efa\u4efb\u52a1\u3002</p> <p>\u4f8b\u5982\uff1acompile \u5c31\u662f\u63d2\u4ef6 maven-compiler-plugin \u7684\u4e00\u4e2a\u529f\u80fd\uff1bpre-clean \u662f\u63d2\u4ef6 maven-clean-plugin \u7684\u4e00\u4e2a\u76ee\u6807\u3002</p>"},{"location":"vcs/maven/mv_05/","title":"\u7b2c5\u7ae0 \u7ee7\u627f","text":""},{"location":"vcs/maven/mv_05/#51","title":"5.1 \u4e3a\u4ec0\u4e48\u9700\u8981\u7ee7\u627f\u673a\u5236\uff1f","text":"<p>\u7531\u4e8e\u975e compile \u8303\u56f4\u7684\u4f9d\u8d56\u4fe1\u606f\u662f\u4e0d\u80fd\u5728\u201c\u4f9d\u8d56\u94fe\u201d\u4e2d\u4f20\u9012\u7684\uff0c\u6240\u4ee5\u6709\u9700\u8981\u7684\u5de5\u7a0b\u53ea\u80fd\u5355\u72ec\u914d\u7f6e\u3002\u4f8b\u5982\uff1a</p> Hello <code>&lt;dependency&gt;   &lt;groupId&gt;junit&lt;/groupId&gt;   &lt;artifactId&gt;junit&lt;/artifactId&gt;   &lt;version&gt;4.0&lt;/version&gt;   &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;</code> HelloFriend <code>&lt;dependency&gt;   &lt;groupId&gt;junit&lt;/groupId&gt;   &lt;artifactId&gt;junit&lt;/artifactId&gt;   &lt;version&gt;4.9&lt;/version&gt;   &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;</code> MakeFriend <code>&lt;dependency&gt;   &lt;groupId&gt;junit&lt;/groupId&gt;   &lt;artifactId&gt;junit&lt;/artifactId&gt;   &lt;version&gt;4.12&lt;/version&gt;   &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;</code> <p>\u6b64\u65f6\u5982\u679c\u9879\u76ee\u9700\u8981\u5c06\u5404\u4e2a\u6a21\u5757\u7684 junit \u7248\u672c\u7edf\u4e00\u4e3a 4.9\uff0c\u90a3\u4e48\u5230\u5404\u4e2a\u5de5\u7a0b\u4e2d\u624b\u52a8\u4fee\u6539\u65e0\u7591\u662f\u975e\u5e38\u4e0d\u53ef\u53d6\u7684\u3002\u4f7f\u7528\u7ee7\u627f\u673a\u5236\u5c31\u53ef\u4ee5\u5c06\u8fd9\u6837\u7684\u4f9d\u8d56\u4fe1\u606f\u7edf\u4e00\u63d0\u53d6\u5230\u7236\u5de5\u7a0b\u6a21\u5757\u4e2d\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\u3002</p>"},{"location":"vcs/maven/mv_05/#52","title":"5.2 \u521b\u5efa\u7236\u5de5\u7a0b","text":"<p>\uff081\uff09\u7236\u5de5\u7a0b\u7684\u6253\u5305\u65b9\u5f0f\u4e3a pom</p> pom.xml<pre><code>&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;Parent&lt;/artifactId&gt;\n&lt;packaging&gt;pom&lt;/packaging&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n</code></pre> <p>\uff082\uff09\u7236\u5de5\u7a0b\u53ea\u9700\u8981\u4fdd\u7559 pom.xml \u6587\u4ef6\u5373\u53ef\u3002</p>"},{"location":"vcs/maven/mv_05/#53","title":"5.3 \u5728\u5b50\u5de5\u7a0b\u4e2d\u5f15\u7528\u7236\u5de5\u7a0b","text":"<p>\uff081\uff09\u7236\u5de5\u7a0b\u5750\u6807</p> pom.xml<pre><code>&lt;parent&gt;\n&lt;!-- \u7236\u5de5\u7a0b\u5750\u6807 --&gt;\n&lt;groupId&gt;...&lt;/groupId&gt;\n&lt;artifactId&gt;...&lt;/artifactId&gt;\n&lt;version&gt;...&lt;/version&gt;\n\n&lt;!--\u6307\u5b9a\u4ece\u5f53\u524dpom.xml\u6587\u4ef6\u51fa\u53d1\u5bfb\u627e\u7236\u5de5\u7a0b\u7684pom.xml\u6587\u4ef6\u7684\u76f8\u5bf9\u8def\u5f84--&gt;\n&lt;relativePath&gt;..&lt;/relativePath&gt;\n&lt;/parent&gt;\n</code></pre> <p>\uff082\uff09\u7ee7\u627f</p> pom.xml<pre><code>&lt;!--\u7ee7\u627f--&gt;\n&lt;parent&gt;\n&lt;groupId&gt;com.atguigu.maven&lt;/groupId&gt;\n&lt;artifactId&gt;Parent&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n\n&lt;!--\u6307\u5b9a\u4ece\u5f53\u524dpom.xml\u6587\u4ef6\u51fa\u53d1\u5bfb\u627e\u7236\u5de5\u7a0b\u7684pom.xml\u6587\u4ef6\u7684\u76f8\u5bf9\u8def\u5f84--&gt;\n&lt;relativePath&gt;../Parent/pom.xml&lt;/relativePath&gt;\n&lt;/parent&gt;\n</code></pre> <p>\u6b64\u65f6\u5982\u679c\u5b50\u5de5\u7a0b\u7684 groupId \u548c version \u5982\u679c\u548c\u7236\u5de5\u7a0b\u91cd\u590d\u5219\u53ef\u4ee5\u5220\u9664\u3002</p>"},{"location":"vcs/maven/mv_05/#54","title":"5.4 \u5728\u7236\u5de5\u7a0b\u4e2d\u7ba1\u7406\u4f9d\u8d56","text":"<p>\uff081\uff09\u5c06 Parent \u9879\u76ee\u4e2d\u7684 dependencies \u6807\u7b7e\uff0c\u7528 dependencyManagement \u6807\u7b7e\u62ec\u8d77\u6765\u3002</p> pom.xml<pre><code>&lt;!--\u4f9d\u8d56\u7ba1\u7406--&gt;\n&lt;dependencyManagement&gt;\n&lt;dependencies&gt;\n&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;version&gt;4.0&lt;/version&gt;\n&lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;/dependencies&gt;\n&lt;/dependencyManagement&gt;\n</code></pre> <p>\uff082\uff09\u5728\u5b50\u9879\u76ee\u4e2d\u91cd\u65b0\u6307\u5b9a\u9700\u8981\u7684\u4f9d\u8d56\uff0c\u5220\u9664\u8303\u56f4\u548c\u7248\u672c\u53f7\u3002</p> pom.xml<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"vcs/maven/mv_06/","title":"\u7b2c6\u7ae0 \u805a\u5408","text":""},{"location":"vcs/maven/mv_06/#61","title":"6.1 \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u805a\u5408\uff1f","text":"<p>\u5c06\u591a\u4e2a\u5de5\u7a0b\u62c6\u5206\u4e3a\u6a21\u5757\u540e\uff0c\u9700\u8981\u624b\u52a8\u9010\u4e2a\u5b89\u88c5\u5230\u4ed3\u5e93\u540e\u4f9d\u8d56\u624d\u80fd\u591f\u751f\u6548\u3002\u4fee\u6539\u6e90\u7801\u540e\u4e5f\u9700\u8981\u9010\u4e2a\u624b\u52a8\u8fdb\u884c clean \u64cd\u4f5c\u3002\u800c\u4f7f\u7528\u4e86\u805a\u5408\u4e4b\u540e\u5c31\u53ef\u4ee5\u6279\u91cf\u8fdb\u884c Maven \u5de5\u7a0b\u7684\u5b89\u88c5\u3001\u6e05\u7406\u5de5\u4f5c\u3002</p>"},{"location":"vcs/maven/mv_06/#62","title":"6.2 \u5982\u4f55\u914d\u7f6e\u805a\u5408\uff1f","text":"<p>\u5728\u603b\u7684\u805a\u5408\u5de5\u7a0b\u4e2d\u4f7f\u7528 modules / module \u6807\u7b7e\u7ec4\u5408\uff0c\u6307\u5b9a\u6a21\u5757\u5de5\u7a0b\u7684\u76f8\u5bf9\u8def\u5f84\u5373\u53ef\u3002</p> pom.xml<pre><code>&lt;!--\u805a\u5408--&gt;\n&lt;modules&gt;\n&lt;module&gt;../MakeFriend&lt;/module&gt;\n&lt;module&gt;../OurFriends&lt;/module&gt;\n&lt;module&gt;../HelloFriend&lt;/module&gt;\n&lt;module&gt;../Hello&lt;/module&gt;\n&lt;/modules&gt;\n</code></pre> <p>Maven \u53ef\u4ee5\u6839\u636e\u5404\u4e2a\u6a21\u5757\u7684\u7ee7\u627f\u548c\u4f9d\u8d56\u5173\u7cfb\u81ea\u52a8\u9009\u62e9\u5b89\u88c5\u7684\u987a\u5e8f\u3002</p>"},{"location":"vcs/maven/mv_07/","title":"\u7b2c7\u7ae0 Maven\u9177\u7ad9","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5230Maven\u4e2d\u592e\u4ed3\u5e93 \u641c\u7d22\u9700\u8981\u7684 jar \u5305\u7684\u4f9d\u8d56\u4fe1\u606f\u3002</p> <p>\u524d\u5f80Maven\u4e2d\u592e\u4ed3\u5e93</p> <p>\u641c\u7d22Maven\u4f9d\u8d56</p>"},{"location":"vcs/maven/mv_08/","title":"\u7b2c8\u7ae0 Maven\u751f\u4ea7\u73af\u5883\u95ee\u9898\u89e3\u51b3","text":""},{"location":"vcs/maven/mv_08/#81-jar","title":"8.1 jar\u672a\u4e0b\u8f7d\u5b8c\u6210","text":"<p>\u5728\u4f7f\u7528 maven \u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u6240\u4f7f\u7528\u7684 jar \u5305\u662f\u4f1a\u5230\u4e2d\u592e\u4ed3\u5e93\u4e2d\u8fdb\u884c\u4e0b\u8f7d\u7684\uff0c\u4f46\u662f\u5982\u679c\u518d\u4e0b\u8f7d\u8fc7\u7a0b\u4e2d\u56e0\u4e3a\u7f51\u7edc\u4e0d\u901a\u7545\u7b49\u539f\u56e0\uff0c\u4f1a\u5bfc\u81f4 jar \u5305\u4e0b\u8f7d\u5931\u8d25\uff0c\u5e76\u4e14\u4f1a\u5f62\u6210\u4e00\u4e2a xxxx.lastupdated \u7684\u6587\u4ef6\uff0c\u4f46\u662f\u6b64\u65f6 maven \u5e76\u4e0d\u4f1a\u5c06\u5176\u5220\u6389\u540e\u91cd\u65b0\u4e0b\u8f7d\uff0c\u800c\u662f\u8ba4\u4e3a\u5b83\u4e0b\u8f7d\u8fc7\u4e86\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u662f\u5c06 .xxxxlastupdated \u6587\u4ef6\u624b\u52a8\u5220\u9664\u540e\uff0c\u518d\u6b21\u91cd\u65b0\u4e0b\u8f7d\u3002</p> pom.xml<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;junit&lt;/groupId&gt;\n&lt;artifactId&gt;junit&lt;/artifactId&gt;\n&lt;version&gt;4.0&lt;/version&gt;\n&lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre> <p>1\uff09\u95ee\u9898\u6a21\u62df</p> <p>\uff081\uff09\u5728\u9879\u76ee\u5bfc\u5165\u4e86 maven \u4f9d\u8d56\uff0c\u5728\u4ed3\u5e93\u4e2d\u53d1\u73b0\u76ee\u524d\u6ca1\u6709\u8fd9\u4e2a\u4f9d\u8d56\u3002</p> <p></p> <p>\uff082\uff09\u6b64\u523b\u7535\u8111\u6ca1\u6709\u7f51\u7edc\u3002</p> <p></p> <p>\uff083\uff09\u70b9\u51fb maven \u7684\u5237\u65b0\u540e\uff0cmaven \u4f1a\u53bb\u4e0b\u8f7d\uff0c\u4f46\u662f\u4e0b\u8f7d\u4e0d\u4e0b\u6765\u3002</p> <p></p> <p>\uff084\uff09\u6700\u7ec8\u5728\u672c\u5730\u4ed3\u5e93\u4f1a\u5f62\u6210\u4ee5\u4e0b\u6a21\u6837\u3002</p> <p></p> <p>\uff085\uff09\u5e76\u4e14\u8fde\u63a5\u4e0a\u7f51\u7edc\u540e\u5e76\u4e0d\u4f1a\u7ee7\u7eed\u4e0b\u8f7d\uff0c\u5f62\u6210\u5982\u4e0b\u6a21\u6837\u3002</p> <p>2\uff09\u89e3\u51b3\u65b9\u6848 1</p> <p>\u624b\u52a8\u5220\u9664 .lastupdate \u6587\u4ef6\uff0c\u8ba9\u5176\u91cd\u65b0\u4e0b\u8f7d\u5c31\u597d\u4e86\u3002</p> <p></p> <p>3\uff09\u89e3\u51b3\u65b9\u6848 2</p> <p>\u76f4\u63a5\u5728\u4ed3\u5e93\u4e0b\u641c\u7d22 .lastupdated \u6587\u4ef6\uff0c\u7136\u540e Ctrl+A \u5168\u9009\u540e Ctrl+D \u5220\u9664 \u5c31\u80fd\u76f4\u63a5\u5220\u6389\u6240\u6709\u6ca1\u4e0b\u8f7d\u53f7\u7684 jar \u5305\u3002</p>"},{"location":"vcs/maven/mv_08/#82-jar","title":"8.2 jar\u5305\u51b2\u7a81\u95ee\u9898","text":"<p>jar \u5305\u51b2\u7a81\u5f80\u5f80\u662f\u53d1\u751f\u5728\uff0c\u540c\u4e00\u4e2a\u9879\u76ee\u5728\u8fd0\u884c\u65f6\u5bfc\u5165\u4e86\u4e24\u4e2a\u76f8\u540c jar \u5305\u7684\u4e0d\u540c\u7248\u672c\uff0c\u53c8\u56e0\u4e3a\u4e24\u4e2a\u4e0d\u540c\u7248\u672c\u7684 jar \u5305\u4ee3\u7801\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u662f\u51b2\u7a81\u7684\uff0c\u5bfc\u81f4\u5728\u8fd0\u884c\u65f6\uff0c\u62a5\u51fa\u5404\u79cd\u83ab\u540d\u5176\u5999\u7684\u9519\u8bef\u3002</p> <p>1\uff09\u95ee\u9898\u63cf\u8ff0</p> <p></p> <p>\u4ee5\u4e0a\u4f9d\u8d56\u4e2d\uff0cthymeleaf-spring5--3.0.12 \u662f\u5929\u7136\u4f9d\u8d56\u4e8e thymeleaf \u7684 3.0.12 \u7248\u672c\u7684\u4f9d\u8d56\u7684\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u81ea\u5df1\u7684\u5bfc\u5165\u662f thymeleaf 3.0.11 \u7248\u672c\uff0c\u8fd9\u4e24\u4e2a\u7248\u672c\u4ee3\u7801\u5dee\u8ddd\u5de8\u5927\uff0c\u5c31\u4f1a\u5bfc\u81f4 jar \u5305\u51b2\u7a81\u95ee\u9898\u3002</p> <p>2\uff09\u89e3\u51b3\u65b9\u6848</p> <p>\u8981\u4e48\u4e0d\u8981\u5bfc\u5165 3.0.11 \u7248\u672c\u4f9d\u8d56\uff0c\u6216\u8005\u4f60\u9009\u5728\u5c06 thymeleaf-spring5--3.0.12 \u7684\u4f9d\u8d56\u4e2d\u7684 thymeleaf \u7684 3.0.12 \u7248\u672c\u6392\u9664\u6389\uff08\u56fe\u89e3\u662f\u6392\u9664\u7684\u65b9\u5f0f\uff09\u3002</p> <p></p>"},{"location":"zookeeper/zk_01/","title":"\u7b2c1\u7ae0 Zookeeper\u5165\u95e8","text":""},{"location":"zookeeper/zk_01/#11","title":"1.1 \u6982\u8ff0","text":"<p>Zookeeper \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u7684\uff0c\u4e3a\u5206\u5e03\u5f0f\u6846\u67b6\u63d0\u4f9b\u534f\u8c03\u670d\u52a1\u7684 Apache \u9879\u76ee\u3002</p> <p></p> <p> </p> Zookeeper\u5de5\u4f5c\u673a\u5236"},{"location":"zookeeper/zk_01/#12","title":"1.2 \u7279\u70b9","text":"Zookeeper \u7279\u70b9"},{"location":"zookeeper/zk_01/#13","title":"1.3 \u6570\u636e\u7ed3\u6784","text":"<p>ZooKeeper \u6570\u636e\u6a21\u578b\u7684\u7ed3\u6784\u4e0e Unix \u6587\u4ef6\u7cfb\u7edf}\u5f88\u7c7b\u4f3c\uff0c\u6574\u4f53\u4e0a\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u68f5\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u79f0\u505a\u4e00\u4e2a ZNode\u3002\u6bcf\u4e00\u4e2a ZNode \u9ed8\u8ba4\u80fd\u591f\u5b58\u50a8 {==1 MB\u7684\u6570\u636e\uff0c\u6bcf\u4e2a ZNode \u90fd\u53ef\u4ee5\u901a\u8fc7\u5176\u8def\u5f84\u552f\u4e00\u6807\u8bc6\u3002</p> <p></p>"},{"location":"zookeeper/zk_01/#14","title":"1.4 \u5e94\u7528\u573a\u666f","text":"<p>\u63d0\u4f9b\u7684\u670d\u52a1\u5305\u62ec\uff1a\u7edf\u4e00\u547d\u540d\u670d\u52a1\u3001\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406\u3001\u7edf\u4e00\u96c6\u7fa4\u7ba1\u7406\u3001\u670d\u52a1\u5668\u8282\u70b9\u52a8\u6001\u4e0a\u4e0b\u7ebf\u3001\u8f6f\u8d1f\u8f7d\u5747\u8861\u7b49\u3002</p> <p> </p> \u7edf\u4e00\u547d\u540d\u670d\u52a1 <p> </p> \u7edf\u4e00\u914d\u7f6e\u7ba1\u7406 <p> </p> \u7edf\u4e00\u96c6\u7fa4\u7ba1\u7406 <p> </p> \u670d\u52a1\u5668\u52a8\u6001\u4e0a\u4e0b\u7ebf <p> </p> \u8f6f\u8d1f\u8f7d\u5747\u8861"},{"location":"zookeeper/zk_01/#15","title":"1.5 \u4e0b\u8f7d\u5730\u5740","text":"<p>1\uff09\u5b98\u7f51\u9996\u9875</p> <p>2\uff09\u4e0b\u8f7d\u622a\u56fe</p> <p></p> <p></p> <p></p> <p>3\uff09\u4e0b\u8f7d Linux \u73af\u5883\u5b89\u88c5\u7684 tar \u5305</p> <p></p>"},{"location":"zookeeper/zk_02/","title":"\u7b2c2\u7ae0 Zookeeper\u5b89\u88c5","text":""},{"location":"zookeeper/zk_02/#21","title":"2.1 \u672c\u5730\u6a21\u5f0f\u5b89\u88c5","text":"<p>1\uff09\u5b89\u88c5\u524d\u51c6\u5907</p> <p>\uff081\uff09\u5b89\u88c5 JDK \uff082\uff09\u62f7\u8d1d apache-zookeeper-3.5.7-bin.tar.gz \u5b89\u88c5\u5305\u5230 Linux \u7cfb\u7edf\u4e0b \uff083\uff09\u89e3\u538b\u5230\u6307\u5b9a\u76ee\u5f55</p> <pre><code>tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/\n</code></pre> <p>\uff084\uff09\u4fee\u6539\u540d\u79f0</p> <pre><code>mv apache-zookeeper-3.5.7 -bin/ zookeeper-3.5.7\n</code></pre> <p>2\uff09\u914d\u7f6e\u4fee\u6539 \uff081\uff09\u5c06 /opt/module/zookeeper-3.5.7/conf \u8fd9\u4e2a\u8def\u5f84\u4e0b\u7684 zoo_sample.cfg \u4fee\u6539\u4e3a zoo.cfg\uff1b</p> <pre><code>mv zoo_sample.cfg zoo.cfg\n</code></pre> <p>\u200b   \uff082\uff09\u6253\u5f00 zoo.cfg \u6587\u4ef6\uff0c\u4fee\u6539 dataDir \u8def\u5f84\uff1a</p> zoo.cfg<pre><code>dataDir=/opt/module/zookeeper-3.5.7/zkData\n</code></pre> <p>\u200b   \uff083\uff09\u5728 /opt/module/zookeeper-3.5.7/ \u8fd9\u4e2a\u76ee\u5f55\u4e0a\u521b\u5efa zkData \u6587\u4ef6\u5939</p> <pre><code>mkdir zkData\n</code></pre> <p>3\uff09\u64cd\u4f5c Zookeeper</p> <p>\uff081\uff09\u542f\u52a8 Zookeeper</p> <p>```shell] bin/zkServer.sh start <pre><code>\uff082\uff09\u67e5\u770b\u8fdb\u7a0b\u662f\u5426\u542f\u52a8\n\n```shell\njps\n</code></pre></p> <p>\uff083\uff09\u67e5\u770b\u72b6\u6001</p> <pre><code>bin/zkServer.sh status\n</code></pre> <p>\uff084\uff09\u542f\u52a8\u5ba2\u6237\u7aef</p> <pre><code>bin/zkCli.sh\n</code></pre> <p>\uff085\uff09\u9000\u51fa\u5ba2\u6237\u7aef\uff1a</p> <pre><code>[zk: localhost:2181(CONNECTED) 0] quit\n</code></pre> <p>\uff086\uff09\u505c\u6b62 Zookeeper</p> <pre><code>bin/zkServer.sh stop\n</code></pre>"},{"location":"zookeeper/zk_02/#22","title":"2.2 \u914d\u7f6e\u53c2\u6570\u89e3\u8bfb","text":"<p>Zookeeper \u4e2d\u7684\u914d\u7f6e\u6587\u4ef6 zoo.cfg \u4e2d\u53c2\u6570\u542b\u4e49\u89e3\u8bfb\u5982\u4e0b\uff1a</p> <p>1\uff09tickTime = 2000\uff1a\u901a\u4fe1\u5fc3\u8df3\u65f6\u95f4\uff0cZookeeper \u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u5fc3\u8df3\u65f6\u95f4\uff0c\u5355\u4f4d\u6beb\u79d2</p> <p></p> <p>2\uff09initLimit = 10\uff1aLF \u521d\u59cb\u901a\u4fe1\u65f6\u9650</p> <p></p> <p>Leader \u548c Follower \u521d\u59cb\u8fde\u63a5\u65f6\u80fd\u5bb9\u5fcd\u7684\u6700\u591a\u5fc3\u8df3\u6570\uff08 tickTime \u7684\u6570\u91cf\uff09</p> <p>3\uff09syncLimit = 5\uff1aLF \u540c\u6b65\u901a\u4fe1\u65f6\u9650</p> <p></p> <p>Leader \u548c Follower \u4e4b\u95f4\u901a\u4fe1\u65f6\u95f4\u5982\u679c\u8d85\u8fc7 syncLimit * tickTime\uff0cLeader \u8ba4\u4e3a Follwer \u6b7b\u6389\uff0c\u4ece\u670d\u52a1\u5668\u5217\u8868\u4e2d\u5220\u9664 Follwer\u3002</p> <p>4\uff09dataDir\uff1a\u4fdd\u5b58 Zookeeper \u4e2d\u7684\u6570\u636e</p> <p>\u6ce8\u610f</p> <p>\u9ed8\u8ba4\u7684 tmp \u76ee\u5f55\uff0c\u5bb9\u6613\u88ab Linux \u7cfb\u7edf\u5b9a\u671f\u5220\u9664\uff0c\u6240\u4ee5\u4e00\u822c\u4e0d\u7528\u9ed8\u8ba4\u7684 tmp \u76ee\u5f55\u3002</p> <p>5\uff09clientPort = 2181\uff1a\u5ba2\u6237\u7aef\u8fde\u63a5\u7aef\u53e3\uff0c\u901a\u5e38\u4e0d\u505a\u4fee\u6539\u3002</p>"},{"location":"zookeeper/zk_03/","title":"\u7b2c3\u7ae0 Zookeeper\u5b9e\u6218\uff08\u5f00\u53d1\u91cd\u70b9\uff09","text":""},{"location":"zookeeper/zk_03/#31","title":"3.1 \u96c6\u7fa4\u64cd\u4f5c","text":""},{"location":"zookeeper/zk_03/#311","title":"3.1.1 \u96c6\u7fa4\u5b89\u88c5","text":"<p>1\uff09\u96c6\u7fa4\u89c4\u5212</p> <p>\u5728 hadoop102\u3001hadoop103 \u548c hadoop104 \u4e09\u4e2a\u8282\u70b9\u4e0a\u90fd\u90e8\u7f72 Zookeeper\u3002</p> <p>\u601d\u8003</p> <p>\u5982\u679c\u662f 10 \u53f0\u670d\u52a1\u5668\uff0c\u9700\u8981\u90e8\u7f72\u591a\u5c11\u53f0 Zookeeper\uff1f </p> <p>2\uff09\u89e3\u538b\u5b89\u88c5</p> <p>\uff081\uff09\u5728 hadoop102 \u89e3\u538b Zookeeper \u5b89\u88c5\u5305\u5230 /opt/module/ \u76ee\u5f55\u4e0b</p> <pre><code>tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/\n</code></pre> <p>\uff082\uff09\u4fee\u6539 apache-zookeeper-3.5.7-bin \u540d\u79f0\u4e3a zookeeper-3.5.7</p> <pre><code>mv apache-zookeeper-3.5.7-bin/ zookeeper-3.5.7\n</code></pre> <p>3\uff09\u914d\u7f6e\u670d\u52a1\u5668\u7f16\u53f7</p> <p>\uff081\uff09\u5728 /opt/module/zookeeper-3.5.7/ \u8fd9\u4e2a\u76ee\u5f55\u4e0b\u521b\u5efa zkData</p> <pre><code>mkdir zkData\n</code></pre> <p>\uff082\uff09\u5728 /opt/module/zookeeper-3.5.7/zkData \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a myid \u7684\u6587\u4ef6</p> <pre><code>vi myid\n</code></pre> <p>\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e0e server \u5bf9\u5e94\u7684\u7f16\u53f7\uff08\u6ce8\u610f\uff1a\u4e0a\u4e0b\u4e0d\u8981\u6709\u7a7a\u884c\uff0c\u5de6\u53f3\u4e0d\u8981\u6709\u7a7a\u683c\uff09</p> myid<pre><code>2\n</code></pre> <p>\u6ce8\u610f</p> <p>\u6dfb\u52a0 myid \u6587\u4ef6\uff0c\u4e00\u5b9a\u8981\u5728 Linux \u91cc\u9762\u521b\u5efa\uff0c\u5728 notepad++ \u91cc\u9762\u5f88\u53ef\u80fd\u4e71\u7801</p> <p>\uff083\uff09\u62f7\u8d1d\u914d\u7f6e\u597d\u7684 zookeeper \u5230\u5176\u4ed6\u673a\u5668\u4e0a</p> <pre><code> xsync  zookeeper-3.5.7\n</code></pre> <p>\u5e76\u5206\u522b\u5728 hadoop103\u3001hadoop104 \u4e0a\u4fee\u6539 myid \u6587\u4ef6\u4e2d\u5185\u5bb9\u4e3a 3\u30014</p> <p>4\uff09\u914d\u7f6e zoo.cfg \u6587\u4ef6</p> <p>\uff081\uff09\u91cd\u547d\u540d /opt/module/zookeeper-3.5.7/conf \u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684 zoo_sample.cfg \u4e3a zoo.cfg</p> <pre><code>mv zoo_sample.cfg zoo.cfg\n</code></pre> <p>\uff082\uff09\u4fee\u6539 zoo.cfg \u6587\u4ef6</p> zoo.cfg<pre><code>dataDir=/opt/module/zookeeper-3.5.7/zkData\n\n#######################cluster##########################\nserver.2=hadoop102:2888:3888\nserver.3=hadoop103:2888:3888\nserver.4=hadoop104:2888:3888\n</code></pre> <p>\uff083\uff09\u914d\u7f6e\u53c2\u6570\u89e3\u8bfb</p> <p><code>server.A=B:C:D</code></p> <p>A \u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u8fd9\u4e2a\u662f\u7b2c\u51e0\u53f7\u670d\u52a1\u5668\uff1b</p> <p>\u96c6\u7fa4\u6a21\u5f0f\u4e0b\u914d\u7f6e\u4e00\u4e2a\u6587\u4ef6 myid\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5728 dataDir \u76ee\u5f55\u4e0b\uff0c\u8fd9\u4e2a\u6587\u4ef6\u91cc\u9762\u6709\u4e00\u4e2a\u6570\u636e\u5c31\u662f A \u7684\u503c\uff0cZookeeper \u542f\u52a8\u65f6\u8bfb\u53d6\u6b64\u6587\u4ef6\uff0c\u62ff\u5230\u91cc\u9762\u7684\u6570\u636e\u4e0e zoo.cfg \u91cc\u9762\u7684\u914d\u7f6e\u4fe1\u606f\u6bd4\u8f83\u4ece\u800c\u5224\u65ad\u5230\u5e95\u662f\u54ea\u4e2a server\u3002</p> <p>B \u662f\u8fd9\u4e2a\u670d\u52a1\u5668\u7684\u5730\u5740</p> <p>C \u662f\u8fd9\u4e2a\u670d\u52a1\u5668 Follower \u4e0e\u96c6\u7fa4\u4e2d\u7684 Leader \u670d\u52a1\u5668\u4ea4\u6362\u4fe1\u606f\u7684\u7aef\u53e3</p> <p>D \u662f\u4e07\u4e00\u96c6\u7fa4\u4e2d\u7684 Leader \u670d\u52a1\u5668\u6302\u4e86\uff0c\u9700\u8981\u4e00\u4e2a\u7aef\u53e3\u6765\u91cd\u65b0\u8fdb\u884c\u9009\u4e3e\uff0c\u9009\u51fa\u4e00\u4e2a\u65b0\u7684 Leader\uff0c\u800c\u8fd9\u4e2a\u7aef\u53e3\u5c31\u662f\u7528\u6765\u6267\u884c\u9009\u4e3e\u65f6\u670d\u52a1\u5668\u76f8\u4e92\u901a\u4fe1\u7684\u7aef\u53e3</p> <p>\uff084\uff09\u540c\u6b65 zoo.cfg \u914d\u7f6e\u6587\u4ef6</p> <pre><code>xsync zoo.cfg\n</code></pre> <p>5\uff09\u96c6\u7fa4\u64cd\u4f5c</p> <p>\uff081\uff09\u5206\u522b\u542f\u52a8 Zookeeper</p> <pre><code>bin/zkServer.sh start\n</code></pre> <p>\uff082\uff09\u67e5\u770b\u72b6\u6001</p> <pre><code>bin/zkServer.sh status\n</code></pre>"},{"location":"zookeeper/zk_03/#312","title":"3.1.2 \u9009\u4e3e\u673a\u5236\uff08\u9762\u8bd5\u91cd\u70b9\uff09","text":"\u7b2c\u4e00\u6b21\u9009\u4e3e \u975e\u7b2c\u4e00\u6b21\u9009\u4e3e"},{"location":"zookeeper/zk_03/#313-zk","title":"3.1.3 ZK\u96c6\u7fa4\u542f\u52a8\u505c\u6b62\u811a\u672c","text":"<p>1\uff09\u5728 hadoop102 \u7684 /home/atguigu/bin \u76ee\u5f55\u4e0b\u521b\u5efa\u811a\u672c</p> <pre><code>vim zk.sh\n</code></pre> zk.sh<pre><code>#!/bin/bash\n\ncase $1 in\n\"start\"){\nfor i in hadoop102 hadoop103 hadoop104\n    do\necho ---------- zookeeper $i \u542f\u52a8 ------------\n        ssh $i \"/opt/module/zookeeper-3.5.7/bin/zkServer.sh start\"\ndone\n};;\n\"stop\"){\nfor i in hadoop102 hadoop103 hadoop104\n    do\necho ---------- zookeeper $i \u505c\u6b62 ------------    ssh $i \"/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop\"\ndone\n};;\n\"status\"){\nfor i in hadoop102 hadoop103 hadoop104\n    do\necho ---------- zookeeper $i \u72b6\u6001 ------------    ssh $i \"/opt/module/zookeeper-3.5.7/bin/zkServer.sh status\"\ndone\n};;\nesac\n</code></pre> <p>2\uff09\u589e\u52a0\u811a\u672c\u6267\u884c\u6743\u9650</p> <pre><code>chmod u+x zk.sh\n</code></pre> <p>3\uff09Zookeeper \u96c6\u7fa4\u542f\u52a8\u811a\u672c</p> <pre><code>zk.sh start\n</code></pre> <p>4\uff09Zookeeper \u96c6\u7fa4\u505c\u6b62\u811a\u672c</p> <pre><code>zk.sh stop\n</code></pre>"},{"location":"zookeeper/zk_03/#32","title":"3.2 \u5ba2\u6237\u7aef\u547d\u4ee4\u884c\u64cd\u4f5c","text":""},{"location":"zookeeper/zk_03/#321","title":"3.2.1 \u547d\u4ee4\u884c\u8bed\u6cd5","text":"\u547d\u4ee4\u57fa\u672c\u8bed\u6cd5 \u529f\u80fd\u63cf\u8ff0 help \u663e\u793a\u6240\u6709\u64cd\u4f5c\u547d\u4ee4 ls path \u4f7f\u7528 ls \u547d\u4ee4\u6765\u67e5\u770b\u5f53\u524dznode\u7684\u5b50\u8282\u70b9 [\u53ef\u76d1\u542c]-w \u76d1\u542c\u5b50\u8282\u70b9\u53d8\u5316-s  \u9644\u52a0\u6b21\u7ea7\u4fe1\u606f create \u666e\u901a\u521b\u5efa-s  \u542b\u6709\u5e8f\u5217-e  \u4e34\u65f6\uff08\u91cd\u542f\u6216\u8005\u8d85\u65f6\u6d88\u5931\uff09 get path \u83b7\u5f97\u8282\u70b9\u7684\u503c [\u53ef\u76d1\u542c]-w \u76d1\u542c\u8282\u70b9\u5185\u5bb9\u53d8\u5316-s  \u9644\u52a0\u6b21\u7ea7\u4fe1\u606f set \u8bbe\u7f6e\u8282\u70b9\u7684\u5177\u4f53\u503c stat \u67e5\u770b\u8282\u70b9\u72b6\u6001 delete \u5220\u9664\u8282\u70b9 deleteall \u9012\u5f52\u5220\u9664\u8282\u70b9 <p>1\uff09\u542f\u52a8\u5ba2\u6237\u7aef</p> <pre><code>bin/zkCli.sh -server hadoop102:2181\n</code></pre> <p>2\uff09\u663e\u793a\u6240\u6709\u64cd\u4f5c\u547d\u4ee4</p> <pre><code>[zk: hadoop102:2181(CONNECTED) 1] help\n</code></pre>"},{"location":"zookeeper/zk_03/#322-znode","title":"3.2.2 znode\u8282\u70b9\u6570\u636e\u4fe1\u606f","text":"<p>1\uff09\u67e5\u770b\u5f53\u524d znode \u4e2d\u6240\u5305\u542b\u7684\u5185\u5bb9</p> <pre><code>ls /\n</code></pre> <p>2\uff09\u67e5\u770b\u5f53\u524d\u8282\u70b9\u8be6\u7ec6\u6570\u636e</p> <pre><code>$ ls -s /\n\n[zookeeper]cZxid = 0x0\nctime = Thu Jan 01 08:00:00 CST 1970\nmZxid = 0x0\nmtime = Thu Jan 01 08:00:00 CST 1970\npZxid = 0x0\ncversion = -1\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 0\nnumChildren = 1\n</code></pre> <p>\uff081\uff09czxid\uff1a\u521b\u5efa\u8282\u70b9\u7684\u4e8b\u52a1 zxid \u6bcf\u6b21\u4fee\u6539 ZooKeeper \u72b6\u6001\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a ZooKeeper \u4e8b\u52a1 ID\u3002\u4e8b\u52a1 ID \u662f ZooKeeper \u4e2d\u6240\u6709\u4fee\u6539\u603b\u7684\u6b21\u5e8f\u3002\u6bcf\u6b21\u4fee\u6539\u90fd\u6709\u552f\u4e00\u7684 zxid\uff0c\u5982\u679c zxid1 \u5c0f\u4e8e zxid2\uff0c\u90a3\u4e48 zxid1 \u5728 zxid2 \u4e4b\u524d\u53d1\u751f\u3002</p> <p>\uff082\uff09ctime\uff1aznode \u88ab\u521b\u5efa\u7684\u6beb\u79d2\u6570\uff08\u4ece 1970 \u5e74\u5f00\u59cb\uff09</p> <p>\uff083\uff09mzxid\uff1aznode \u6700\u540e\u66f4\u65b0\u7684\u4e8b\u52a1 zxid</p> <p>\uff084\uff09mtime\uff1aznode \u6700\u540e\u4fee\u6539\u7684\u6beb\u79d2\u6570\uff08\u4ece 1970 \u5e74\u5f00\u59cb\uff09</p> <p>\uff085\uff09pZxid\uff1aznode \u6700\u540e\u66f4\u65b0\u7684\u5b50\u8282\u70b9 zxid</p> <p>\uff086\uff09cversion\uff1aznode \u5b50\u8282\u70b9\u53d8\u5316\u53f7\uff0cznode \u5b50\u8282\u70b9\u4fee\u6539\u6b21\u6570</p> <p>\uff087\uff09dataversion\uff1aznode \u6570\u636e\u53d8\u5316\u53f7</p> <p>\uff088\uff09aclVersion\uff1aznode \u8bbf\u95ee\u63a7\u5236\u5217\u8868\u7684\u53d8\u5316\u53f7</p> <p>\uff089\uff09ephemeralOwner\uff1a\u5982\u679c\u662f\u4e34\u65f6\u8282\u70b9\uff0c\u8fd9\u4e2a\u662f znode \u62e5\u6709\u8005\u7684 session id\u3002\u5982\u679c\u4e0d\u662f\u4e34\u65f6\u8282\u70b9\u5219\u662f 0</p> <p>\uff0810\uff09dataLength\uff1aznode \u7684\u6570\u636e\u957f\u5ea6</p> <p>\uff0811\uff09numChildren\uff1aznode\u5b50\u8282\u70b9\u6570\u91cf</p>"},{"location":"zookeeper/zk_03/#323","title":"3.2.3 \u8282\u70b9\u7c7b\u578b\uff08\u6301\u4e45/\u77ed\u6682/\u6709\u5e8f\u53f7/\u65e0\u5e8f\u53f7\uff09","text":"<p>1\uff09\u5206\u522b\u521b\u5efa 2 \u4e2a\u666e\u901a\u8282\u70b9\uff08\u6c38\u4e45\u8282\u70b9 + \u4e0d\u5e26\u5e8f\u53f7\uff09</p> <pre><code>[zk: localhost:2181(CONNECTED) 3] create /sanguo \"diaochan\"\nCreated /sanguo\n[zk: localhost:2181(CONNECTED) 4] create /sanguo/shuguo \"liubei\"\nCreated /sanguo/shuguo\n</code></pre> <p>\u6ce8\u610f</p> <p>\u521b\u5efa\u8282\u70b9\u65f6\uff0c\u8981\u8d4b\u503c\u3002</p> <p>2\uff09\u83b7\u5f97\u8282\u70b9\u7684\u503c</p> /sanguo/sanguo/shuguo <p> <pre><code>$ get -s /sanguo\n\ndiaochan\ncZxid = 0x100000003\nctime = Wed Aug 29 00:03:23 CST 2018\nmZxid = 0x100000003\nmtime = Wed Aug 29 00:03:23 CST 2018\npZxid = 0x100000004\ncversion = 1\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 7\nnumChildren = 1\n</code></pre> </p> <p> <pre><code>$ get -s /sanguo/shuguo\n\nliubei\ncZxid = 0x100000004\nctime = Wed Aug 29 00:04:35 CST 2018\nmZxid = 0x100000004\nmtime = Wed Aug 29 00:04:35 CST 2018\npZxid = 0x100000004\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 6\nnumChildren = 0\n</code></pre> </p> <p>3\uff09\u521b\u5efa\u5e26\u5e8f\u53f7\u7684\u8282\u70b9\uff08\u6c38\u4e45\u8282\u70b9 + \u5e26\u5e8f\u53f7\uff09</p> <p>\uff081\uff09\u5148\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7684\u6839\u8282\u70b9 /sanguo/weiguo</p> <pre><code>create /sanguo/weiguo \"caocao\"\nCreated /sanguo/weiguo\n</code></pre> <p>\uff082\uff09\u521b\u5efa\u5e26\u5e8f\u53f7\u7684\u8282\u70b9</p> <pre><code>[zk: localhost:2181(CONNECTED) 2] create -s /sanguo/weiguo/zhangliao \"zhangliao\"\nCreated /sanguo/weiguo/zhangliao0000000000\n\n[zk: localhost:2181(CONNECTED) 3] create -s /sanguo/weiguo/zhangliao \"zhangliao\"\nCreated /sanguo/weiguo/zhangliao0000000001\n\n[zk: localhost:2181(CONNECTED) 4] create -s /sanguo/weiguo/xuchu \"xuchu\"\nCreated /sanguo/weiguo/xuchu0000000002\n</code></pre> <p>\u5982\u679c\u539f\u6765\u6ca1\u6709\u5e8f\u53f7\u8282\u70b9\uff0c\u5e8f\u53f7\u4ece 0 \u5f00\u59cb\u4f9d\u6b21\u9012\u589e\u3002\u5982\u679c\u539f\u8282\u70b9\u4e0b\u5df2\u6709 2 \u4e2a\u8282\u70b9\uff0c\u5219\u518d\u6392\u5e8f\u65f6\u4ece 2 \u5f00\u59cb\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <p>4\uff09\u521b\u5efa\u77ed\u6682\u8282\u70b9\uff08\u77ed\u6682\u8282\u70b9 + \u4e0d\u5e26\u5e8f\u53f7 or \u5e26\u5e8f\u53f7\uff09</p> <p>\uff081\uff09\u521b\u5efa\u77ed\u6682\u7684\u4e0d\u5e26\u5e8f\u53f7\u7684\u8282\u70b9</p> <pre><code>create -e /sanguo/wuguo \"zhouyu\"\nCreated /sanguo/wuguo\n</code></pre> <p>\uff082\uff09\u521b\u5efa\u77ed\u6682\u7684\u5e26\u5e8f\u53f7\u7684\u8282\u70b9</p> <pre><code>create -e -s /sanguo/wuguo \"zhouyu\"\nCreated /sanguo/wuguo0000000001\n</code></pre> <p>\uff083\uff09\u5728\u5f53\u524d\u5ba2\u6237\u7aef\u662f\u80fd\u67e5\u770b\u5230\u7684</p> <pre><code>ls /sanguo [wuguo, wuguo0000000001, shuguo]\n</code></pre> <p>\uff084\uff09\u9000\u51fa\u5f53\u524d\u5ba2\u6237\u7aef\u7136\u540e\u518d\u91cd\u542f\u5ba2\u6237\u7aef</p> <pre><code>ls /sanguo\n[shuguo]\n</code></pre> <p>5\uff09\u4fee\u6539\u8282\u70b9\u6570\u636e\u503c</p> <pre><code>set /sanguo/weiguo \"simayi\"\n</code></pre>"},{"location":"zookeeper/zk_03/#324","title":"3.2.4 \u76d1\u542c\u5668\u539f\u7406","text":"<p>\u5ba2\u6237\u7aef\u6ce8\u518c\u76d1\u542c\u5b83\u5173\u5fc3\u7684\u76ee\u5f55\u8282\u70b9\uff0c\u5f53\u76ee\u5f55\u8282\u70b9\u53d1\u751f\u53d8\u5316\uff08\u6570\u636e\u6539\u53d8\u3001\u8282\u70b9\u5220\u9664\u3001\u5b50\u76ee\u5f55\u8282\u70b9\u589e\u52a0\u5220\u9664\uff09\u65f6\uff0cZooKeeper \u4f1a\u901a\u77e5\u5ba2\u6237\u7aef\u3002\u76d1\u542c\u673a\u5236\u4fdd\u8bc1 ZooKeeper \u4fdd\u5b58\u7684\u4efb\u4f55\u7684\u6570\u636e\u7684\u4efb\u4f55\u6539\u53d8\u90fd\u80fd\u5feb\u901f\u7684\u54cd\u5e94\u5230\u76d1\u542c\u4e86\u8be5\u8282\u70b9\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p></p> <p>1\uff09\u8282\u70b9\u7684\u503c\u53d8\u5316\u76d1\u542c</p> <p>\u200b   \uff081\uff09\u5728 hadoop104 \u4e3b\u673a\u4e0a\u6ce8\u518c\u76d1\u542c /sanguo \u8282\u70b9\u6570\u636e\u53d8\u5316</p> <pre><code>get -w /sanguo </code></pre> <p>\u200b   \uff082\uff09\u5728 hadoop103 \u4e3b\u673a\u4e0a\u4fee\u6539 /sanguo \u8282\u70b9\u7684\u6570\u636e</p> <pre><code>set /sanguo \"xisi\"\n</code></pre> <p>\u200b   \uff083\uff09\u89c2\u5bdf hadoop104 \u4e3b\u673a\u6536\u5230\u6570\u636e\u53d8\u5316\u7684\u76d1\u542c</p> <pre><code>WATCHER::\nWatchedEvent state:SyncConnected type:NodeDataChanged path:/sanguo\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5728 hadoop103 \u518d\u591a\u6b21\u4fee\u6539 /sanguo \u7684\u503c\uff0chadoop104 \u4e0a\u4e0d\u4f1a\u518d\u6536\u5230\u76d1\u542c\u3002\u56e0\u4e3a\u6ce8\u518c\u4e00\u6b21\uff0c\u53ea\u80fd\u76d1\u542c\u4e00\u6b21\u3002\u60f3\u518d\u6b21\u76d1\u542c\uff0c\u9700\u8981\u518d\u6b21\u6ce8\u518c\u3002</p> <p>\u200b    2\uff09\u8282\u70b9\u7684\u5b50\u8282\u70b9\u53d8\u5316\u76d1\u542c\uff08\u8def\u5f84\u53d8\u5316\uff09</p> <p>\u200b   \uff081\uff09\u5728 hadoop104 \u4e3b\u673a\u4e0a\u6ce8\u518c\u76d1\u542c /sanguo \u8282\u70b9\u7684\u5b50\u8282\u70b9\u53d8\u5316</p> <pre><code>ls -w /sanguo [shuguo, weiguo]\n</code></pre> <p>\u200b   \uff082\uff09\u5728 hadoop103 \u4e3b\u673a /sanguo \u8282\u70b9\u4e0a\u521b\u5efa\u5b50\u8282\u70b9</p> <pre><code>create /sanguo/jin \"simayi\"\nCreated /sanguo/jin\n</code></pre> <p>\u200b   \uff083\uff09\u89c2\u5bdf hadoop104 \u4e3b\u673a\u6536\u5230\u5b50\u8282\u70b9\u53d8\u5316\u7684\u76d1\u542c</p> <pre><code>WATCHER::\nWatchedEvent state:SyncConnected type:NodeChildrenChanged path:/sanguo\n</code></pre> <p>\u6ce8\u610f</p> <p>\u8282\u70b9\u7684\u8def\u5f84\u53d8\u5316\uff0c\u4e5f\u662f\u6ce8\u518c\u4e00\u6b21\uff0c\u751f\u6548\u4e00\u6b21\u3002\u60f3\u591a\u6b21\u751f\u6548\uff0c\u5c31\u9700\u8981\u591a\u6b21\u6ce8\u518c\u3002</p>"},{"location":"zookeeper/zk_03/#325","title":"3.2.5 \u8282\u70b9\u5220\u9664\u4e0e\u67e5\u770b","text":"<p>1\uff09\u5220\u9664\u8282\u70b9</p> <pre><code>delete /sanguo/jin\n</code></pre> <p>2\uff09\u9012\u5f52\u5220\u9664\u8282\u70b9</p> <pre><code>deleteall /sanguo/shuguo\n</code></pre> <p>3\uff09\u67e5\u770b\u8282\u70b9\u72b6\u6001</p> <pre><code>$ stat /sanguo\n\ncZxid = 0x100000003\nctime = Wed Aug 29 00:03:23 CST 2018\nmZxid = 0x100000011\nmtime = Wed Aug 29 00:21:23 CST 2018\npZxid = 0x100000014\ncversion = 9\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 4\nnumChildren = 1\n</code></pre>"},{"location":"zookeeper/zk_03/#33","title":"3.3 \u5199\u6570\u636e\u6d41\u7a0b","text":""}]}